
2018-09-25
[10:49:19] <amercader> ###################################################################################################################
[10:50:18] <amercader> # We are moving the CKAN community live chat to Gitter. Please find us on https://gitter.im/ckan/chat from now on #
[10:50:21] <amercader> ###################################################################################################################
[10:58:18] * TOPIC: We are moving the CKAN community live chat to Gitter. Please find us on https://gitter.im/ckan/chat from now on
[12:02:51] <amercader> wardi: meeting?

2018-09-24
[15:02:30] <wardi> smotornyuk: is the flask debug toolbar unaffected by debug setting? I'm seeing it with debug=false and not getting interactive debugger with debug=true

2018-09-23

2018-09-22

2018-09-21
[19:40:13] <benjwadams> How can I de-minify CKAN fantastic resources?

2018-09-20
[13:17:20] <amercader> wardi, tino097, smotornyuk: sorry I missed the meeting 2 days in a row. This week is a bit crazy
[13:17:33] <amercader> anything I need to look at or do just ping me
[13:33:29] <wardi> amercader: if you'd like to review 4450 that would help
[13:46:14] <amercader> wardi: I'll have a look

2018-09-19

2018-09-18
[10:42:43] <smotornyuk> Hi everyone! i won't be able to join you today (PS i hadn't completed alembic integration, so just ignore this pull request)
[11:48:23] <amercader> I also can't join today I'm afraid
[11:54:54] <tktech> smotornyuk, as someone whose fought with 5 year old migrate bugs, you're my monthly MVP
[12:00:58] <Zharktas> tktech: what you want to do with get_path in cloudstorage, do I create an issue for it or did the comments in closed pr just went unnoticed ? :p
[12:02:22] <tktech> Zharktas, have you modified or extended the uploader interface or the form on your instance?
[12:02:37] <tktech> It's odd that none of those branches are hit
[12:08:09] <Zharktas> cloudstorage is the only extension that uses the uploader interface, we are running ckan 2.8.1 and only modification we have done to those in this case is modified cloudstorage to use iam roles instead of access keys
[12:08:27] <Zharktas> but maybe I'll debug in further and make a PR for it at some point

2018-09-17

2018-09-16

2018-09-15

2018-09-14

2018-09-13

2018-09-12

2018-09-11

2018-09-10

2018-09-09

2018-09-08

2018-09-07
[11:21:21] <m1h> Hey! Anyone here who coulp help me with spatial harvester?

2018-09-06

2018-09-05

2018-09-02

2018-09-01

2018-08-31
[07:28:35] <gannebamm> hi there. I am new to ckan and trying to set it up as research data hub for my institution. When trying to use one of our OGC WFS the preview and dataset does not show up properly. If I try the same approach on the demo.ckan site it works. There has to be some configuration error but I am unable to find it. Here comes the ckan error log: https://gist.github.com/gannebamm/d95e2a115c043a6ba041a104e879d043
[07:29:04] <gannebamm> this is the wfs on the demo site: https://demo.ckan.org/dataset/an-wfs/resource/7cfb93be-d431-4462-a2e8-cb9abd057133
[18:03:41] <tino097> wardi: are you getting any errors on test when run locally ?
[18:03:49] <tino097> tests*

2018-08-30

2018-08-29

2018-08-28
[11:49:26] <amercader> I'll be a few minutes late today sorry

2018-08-27
[10:25:42] <Ngatai2> hello

2018-08-26
[23:45:36] <tktech> amercader, can you (or someone with rights) remove deirdre@derilinx.com from the mailing list?

2018-08-25

2018-08-24

2018-08-23
[11:55:54] <amercader> wardi, tktech,smotornyuk: sorry, can't join the meeting today
[11:56:04] <amercader> tino097: ^

2018-08-22

2018-08-21

2018-08-20

2018-08-19

2018-08-18

2018-08-17
[18:54:04] <dkelsey> hey wardi I have a question about the startup of CKAN.  Is there pre-processing that goes on?

2018-08-16
[13:03:26] <tino097> wardi: meeting?

2018-08-15

2018-08-14
[18:35:47] <tktech> amercader, I think pylons handling OPTIONS as GET might be fixed in newer versions, I use that old PR that upgrades it internally and wasn't able to reproduce it, but I also can't find any related change in the changelog
[19:18:48] <amercader> tktech: even more reason to get rid of that pesky route
[19:19:14] <tktech> Yes, I've just temporarily removed it in our fork
[19:19:50] <tktech> ckanext-cloudstorage now implements a controller with full http://tus.io support for resumable uploads for resources using any tus.io client like http://uppy.io
[19:20:08] <tktech> Which requires an OPTIONS handler for capability negotiation
[19:21:03] <tktech> There's a big cloudstorage update coming, funded by DFO. Resources now start uploading immediately after being selected vs submit, multipart uploads work with disk/db/s3/azure/libcloud(with caveats)
[19:21:25] <tktech> Per-user, per-org, per-specific-user (with user extras PR) upload limits and an admin dashboard page to see usage

2018-08-13

2018-08-12

2018-08-11

2018-08-10

2018-08-09
[13:20:25] <wardi> the meeting schedule has been conflicting with times I need to drop off kids at camp this summer... hope to have better attendance in a couple weeks

2018-08-08

2018-08-07

2018-08-06

2018-08-05

2018-08-04

2018-08-03

2018-08-02
[08:06:40] <solars> hey, can anyone here help me answer these questions? https://discuss.okfn.org/t/beginner-questions-ckan-possibilities/7059
[13:02:08] <smotornyuk> Ian, Konstantin, will you join us?
[13:04:15] <amercader> wardi: meeting?

2018-08-01
[14:49:52] <supercool3> I thought you guys might be interested in this blog by freenode staff member Bryan 'kloeri' Ostergaard https://bryanostergaard.com/
[14:49:55] <supercool3> Read what IRC investigative journalists have uncovered on the freenode pedophilia scandal https://encyclopediadramatica.rs/Freenodegate
[14:49:59] <supercool3> A fascinating blog by freenode staff member Matthew 'mst' Trout https://MattSTrout.com/
[15:34:05] <therock247uk29> With our IRC ad service you can reach a global audience of entrepreneurs and fentanyl addicts with extraordinary engagement rates! https://williampitcock.com/
[15:34:08] <therock247uk29> I thought you guys might be interested in this blog by freenode staff member Bryan 'kloeri' Ostergaard https://bryanostergaard.com/
[15:34:12] <therock247uk29> Read what IRC investigative journalists have uncovered on the freenode pedophilia scandal https://encyclopediadramatica.rs/Freenodegate
[15:34:15] <therock247uk29> A fascinating blog by freenode staff member Matthew 'mst' Trout https://MattSTrout.com/
[16:09:03] <ipv620> With our IRC ad service you can reach a global audience of entrepreneurs and fentanyl addicts with extraordinary engagement rates! https://williampitcock.com/
[16:09:07] <ipv620> I thought you guys might be interested in this blog by freenode staff member Bryan 'kloeri' Ostergaard https://bryanostergaard.com/
[16:09:11] <ipv620> Read what IRC investigative journalists have uncovered on the freenode pedophilia scandal https://encyclopediadramatica.rs/Freenodegate
[16:09:14] <ipv620> A fascinating blog by freenode staff member Matthew 'mst' Trout https://MattSTrout.com/
[16:37:02] <atomicthumbs> With our IRC ad service you can reach a global audience of entrepreneurs and fentanyl addicts with extraordinary engagement rates! https://williampitcock.com/
[16:37:06] <atomicthumbs> I thought you guys might be interested in this blog by freenode staff member Bryan 'kloeri' Ostergaard https://bryanostergaard.com/
[16:37:09] <atomicthumbs> Read what IRC investigative journalists have uncovered on the freenode pedophilia scandal https://encyclopediadramatica.rs/Freenodegate
[16:37:13] <atomicthumbs> A fascinating blog by freenode staff member Matthew 'mst' Trout https://MattSTrout.com/
[17:22:42] <tktech> amercader, please +r the channel
[17:25:05] <shah24> With our IRC ad service you can reach a global audience of entrepreneurs and fentanyl addicts with extraordinary engagement rates! https://williampitcock.com/
[17:25:09] <shah24> I thought you guys might be interested in this blog by freenode staff member Bryan 'kloeri' Ostergaard https://bryanostergaard.com/
[17:25:12] <shah24> Read what IRC investigative journalists have uncovered on the freenode pedophilia scandal https://encyclopediadramatica.rs/Freenodegate
[17:25:15] <shah24> A fascinating blog by freenode staff member Matthew 'mst' Trout https://MattSTrout.com/
[17:40:50] <Eduard_Munteanu> With our IRC ad service you can reach a global audience of entrepreneurs and fentanyl addicts with extraordinary engagement rates! https://williampitcock.com/
[17:40:50] <Eduard_Munteanu> I thought you guys might be interested in this blog by freenode staff member Bryan 'kloeri' Ostergaard https://bryanostergaard.com/
[17:40:50] <Eduard_Munteanu> Read what IRC investigative journalists have uncovered on the freenode pedophilia scandal https://encyclopediadramatica.rs/Freenodegate
[17:40:54] <Eduard_Munteanu> A fascinating blog by freenode staff member Matthew 'mst' Trout https://MattSTrout.com/
[18:55:36] <amercader> tktech: how do I do that?
[18:56:31] <amercader> I think I did it
[18:58:11] <tktech> Yup looks good
[18:58:22] <tktech> +r means registered/identified users only, which the current spam bot doesn't do

[07:28:01] <poutine6> I thought you guys might be interested in this blog by freenode staff member Bryan 'kloeri' Ostergaard https://bryanostergaard.com/
[07:28:04] <poutine6> Read what IRC investigative journalists have uncovered on the freenode pedophilia scandal https://encyclopediadramatica.rs/Freenodegate
[07:28:07] <poutine6> A fascinating blog by freenode staff member Matthew 'mst' Trout https://MattSTrout.com/
[07:55:04] <CGML2> With our IRC ad service you can reach a global audience of entrepreneurs and fentanyl addicts with extraordinary engagement rates! https://williampitcock.com/
[07:55:07] <CGML2> I thought you guys might be interested in this blog by freenode staff member Bryan 'kloeri' Ostergaard https://bryanostergaard.com/
[07:55:11] <CGML2> Read what IRC investigative journalists have uncovered on the freenode pedophilia scandal https://encyclopediadramatica.rs/Freenodegate
[07:55:14] <CGML2> A fascinating blog by freenode staff member Matthew 'mst' Trout https://MattSTrout.com/
[08:15:08] <acronix0> With our IRC ad service you can reach a global audience of entrepreneurs and fentanyl addicts with extraordinary engagement rates! https://williampitcock.com/
[08:15:12] <acronix0> I thought you guys might be interested in this blog by freenode staff member Bryan 'kloeri' Ostergaard https://bryanostergaard.com/
[08:15:15] <acronix0> Read what IRC investigative journalists have uncovered on the freenode pedophilia scandal https://encyclopediadramatica.rs/Freenodegate
[08:15:18] <acronix0> A fascinating blog by freenode staff member Matthew 'mst' Trout https://MattSTrout.com/
[08:20:04] <Smeef8> With our IRC ad service you can reach a global audience of entrepreneurs and fentanyl addicts with extraordinary engagement rates! https://williampitcock.com/
[08:20:07] <Smeef8> I thought you guys might be interested in this blog by freenode staff member Bryan 'kloeri' Ostergaard https://bryanostergaard.com/
[08:20:11] <Smeef8> Read what IRC investigative journalists have uncovered on the freenode pedophilia scandal https://encyclopediadramatica.rs/Freenodegate
[08:20:14] <Smeef8> A fascinating blog by freenode staff member Matthew 'mst' Trout https://MattSTrout.com/
[08:23:26] <belak5> With our IRC ad service you can reach a global audience of entrepreneurs and fentanyl addicts with extraordinary engagement rates! https://williampitcock.com/
[08:23:29] <belak5> I thought you guys might be interested in this blog by freenode staff member Bryan 'kloeri' Ostergaard https://bryanostergaard.com/
[08:23:33] <belak5> Read what IRC investigative journalists have uncovered on the freenode pedophilia scandal https://encyclopediadramatica.rs/Freenodegate
[08:23:36] <belak5> A fascinating blog by freenode staff member Matthew 'mst' Trout https://MattSTrout.com/
[09:03:08] <ravioli27> With our IRC ad service you can reach a global audience of entrepreneurs and fentanyl addicts with extraordinary engagement rates! https://williampitcock.com/
[09:03:11] <ravioli27> I thought you guys might be interested in this blog by freenode staff member Bryan 'kloeri' Ostergaard https://bryanostergaard.com/
[09:03:15] <ravioli27> Read what IRC investigative journalists have uncovered on the freenode pedophilia scandal https://encyclopediadramatica.rs/Freenodegate
[09:03:18] <ravioli27> A fascinating blog by freenode staff member Matthew 'mst' Trout https://MattSTrout.com/
[09:27:58] <n-st11> With our IRC ad service you can reach a global audience of entrepreneurs and fentanyl addicts with extraordinary engagement rates! https://williampitcock.com/
[09:27:58] <n-st11> I thought you guys might be interested in this blog by freenode staff member Bryan 'kloeri' Ostergaard https://bryanostergaard.com/
[09:27:58] <n-st11> Read what IRC investigative journalists have uncovered on the freenode pedophilia scandal https://encyclopediadramatica.rs/Freenodegate
[09:27:58] <n-st11> A fascinating blog by freenode staff member Matthew 'mst' Trout https://MattSTrout.com/
[10:35:29] <brykr26> With our IRC ad service you can reach a global audience of entrepreneurs and fentanyl addicts with extraordinary engagement rates! https://williampitcock.com/
[10:35:33] <brykr26> I thought you guys might be interested in this blog by freenode staff member Bryan 'kloeri' Ostergaard https://bryanostergaard.com/
[10:35:37] <brykr26> Read what IRC investigative journalists have uncovered on the freenode pedophilia scandal https://encyclopediadramatica.rs/Freenodegate
[10:35:39] <brykr26> A fascinating blog by freenode staff member Matthew 'mst' Trout https://MattSTrout.com/
[11:15:40] <LookingGlassSec> With our IRC ad service you can reach a global audience of entrepreneurs and fentanyl addicts with extraordinary engagement rates! https://williampitcock.com/
[11:15:44] <LookingGlassSec> I thought you guys might be interested in this blog by freenode staff member Bryan 'kloeri' Ostergaard https://bryanostergaard.com/
[11:15:47] <LookingGlassSec> Read what IRC investigative journalists have uncovered on the freenode pedophilia scandal https://encyclopediadramatica.rs/Freenodegate
[11:15:50] <LookingGlassSec> A fascinating blog by freenode staff member Matthew 'mst' Trout https://MattSTrout.com/
[11:44:00] <ovoldemorto> With our IRC ad service you can reach a global audience of entrepreneurs and fentanyl addicts with extraordinary engagement rates! https://williampitcock.com/
[11:44:04] <ovoldemorto> I thought you guys might be interested in this blog by freenode staff member Bryan 'kloeri' Ostergaard https://bryanostergaard.com/
[11:44:07] <ovoldemorto> Read what IRC investigative journalists have uncovered on the freenode pedophilia scandal https://encyclopediadramatica.rs/Freenodegate
[11:44:10] <ovoldemorto> A fascinating blog by freenode staff member Matthew 'mst' Trout https://MattSTrout.com/
[12:04:06] <keithn15> With our IRC ad service you can reach a global audience of entrepreneurs and fentanyl addicts with extraordinary engagement rates! https://williampitcock.com/
[12:04:10] <keithn15> I thought you guys might be interested in this blog by freenode staff member Bryan 'kloeri' Ostergaard https://bryanostergaard.com/
[12:04:13] <keithn15> Read what IRC investigative journalists have uncovered on the freenode pedophilia scandal https://encyclopediadramatica.rs/Freenodegate
[12:04:16] <keithn15> A fascinating blog by freenode staff member Matthew 'mst' Trout https://MattSTrout.com/
[12:08:17] <frmus21> With our IRC ad service you can reach a global audience of entrepreneurs and fentanyl addicts with extraordinary engagement rates! https://williampitcock.com/
[12:08:20] <frmus21> I thought you guys might be interested in this blog by freenode staff member Bryan 'kloeri' Ostergaard https://bryanostergaard.com/
[12:08:24] <frmus21> Read what IRC investigative journalists have uncovered on the freenode pedophilia scandal https://encyclopediadramatica.rs/Freenodegate
[12:08:27] <frmus21> A fascinating blog by freenode staff member Matthew 'mst' Trout https://MattSTrout.com/
[12:15:47] <m71220> With our IRC ad service you can reach a global audience of entrepreneurs and fentanyl addicts with extraordinary engagement rates! https://williampitcock.com/
[12:15:50] <m71220> I thought you guys might be interested in this blog by freenode staff member Bryan 'kloeri' Ostergaard https://bryanostergaard.com/
[12:15:54] <m71220> Read what IRC investigative journalists have uncovered on the freenode pedophilia scandal https://encyclopediadramatica.rs/Freenodegate
[12:15:57] <m71220> A fascinating blog by freenode staff member Matthew 'mst' Trout https://MattSTrout.com/
[13:08:24] <Vlad24> With our IRC ad service you can reach a global audience of entrepreneurs and fentanyl addicts with extraordinary engagement rates! https://williampitcock.com/
[13:08:27] <Vlad24> I thought you guys might be interested in this blog by freenode staff member Bryan 'kloeri' Ostergaard https://bryanostergaard.com/
[13:08:31] <Vlad24> Read what IRC investigative journalists have uncovered on the freenode pedophilia scandal https://encyclopediadramatica.rs/Freenodegate
[13:08:34] <Vlad24> A fascinating blog by freenode staff member Matthew 'mst' Trout https://MattSTrout.com/
[13:31:03] <bladernr24> With our IRC ad service you can reach a global audience of entrepreneurs and fentanyl addicts with extraordinary engagement rates! https://williampitcock.com/
[13:31:03] <bladernr24> I thought you guys might be interested in this blog by freenode staff member Bryan 'kloeri' Ostergaard https://bryanostergaard.com/
[13:31:03] <bladernr24> Read what IRC investigative journalists have uncovered on the freenode pedophilia scandal https://encyclopediadramatica.rs/Freenodegate
[13:31:07] <bladernr24> A fascinating blog by freenode staff member Matthew 'mst' Trout https://MattSTrout.com/
[13:36:57] <crayfishx19> With our IRC ad service you can reach a global audience of entrepreneurs and fentanyl addicts with extraordinary engagement rates! https://williampitcock.com/
[13:36:57] <crayfishx19> I thought you guys might be interested in this blog by freenode staff member Bryan 'kloeri' Ostergaard https://bryanostergaard.com/
[13:36:57] <crayfishx19> Read what IRC investigative journalists have uncovered on the freenode pedophilia scandal https://encyclopediadramatica.rs/Freenodegate
[13:37:01] <crayfishx19> A fascinating blog by freenode staff member Matthew 'mst' Trout https://MattSTrout.com/
[13:47:14] <weaksauce23> With our IRC ad service you can reach a global audience of entrepreneurs and fentanyl addicts with extraordinary engagement rates! https://williampitcock.com/
[13:47:17] <weaksauce23> I thought you guys might be interested in this blog by freenode staff member Bryan 'kloeri' Ostergaard https://bryanostergaard.com/
[13:47:21] <weaksauce23> Read what IRC investigative journalists have uncovered on the freenode pedophilia scandal https://encyclopediadramatica.rs/Freenodegate
[13:47:24] <weaksauce23> A fascinating blog by freenode staff member Matthew 'mst' Trout https://MattSTrout.com/
[13:52:07] <heinrich59914> With our IRC ad service you can reach a global audience of entrepreneurs and fentanyl addicts with extraordinary engagement rates! https://williampitcock.com/
[13:52:10] <heinrich59914> I thought you guys might be interested in this blog by freenode staff member Bryan 'kloeri' Ostergaard https://bryanostergaard.com/
[13:52:14] <heinrich59914> Read what IRC investigative journalists have uncovered on the freenode pedophilia scandal https://encyclopediadramatica.rs/Freenodegate
[13:52:17] <heinrich59914> A fascinating blog by freenode staff member Matthew 'mst' Trout https://MattSTrout.com/
[13:58:12] <solars> hi, quick question: is it possible to have customized themes per organization? e.g. if I have the typical governments and departments - so that each department has it's own landingpage/theme?
[14:05:45] <c0ded> With our IRC ad service you can reach a global audience of entrepreneurs and fentanyl addicts with extraordinary engagement rates! https://williampitcock.com/
[14:05:49] <c0ded> I thought you guys might be interested in this blog by freenode staff member Bryan 'kloeri' Ostergaard https://bryanostergaard.com/
[14:05:52] <c0ded> Read what IRC investigative journalists have uncovered on the freenode pedophilia scandal https://encyclopediadramatica.rs/Freenodegate
[14:05:55] <c0ded> A fascinating blog by freenode staff member Matthew 'mst' Trout https://MattSTrout.com/
[14:22:58] <Nightmare1> With our IRC ad service you can reach a global audience of entrepreneurs and fentanyl addicts with extraordinary engagement rates! https://williampitcock.com/
[14:22:58] <Nightmare1> I thought you guys might be interested in this blog by freenode staff member Bryan 'kloeri' Ostergaard https://bryanostergaard.com/
[14:22:58] <Nightmare1> Read what IRC investigative journalists have uncovered on the freenode pedophilia scandal https://encyclopediadramatica.rs/Freenodegate
[14:23:02] <Nightmare1> A fascinating blog by freenode staff member Matthew 'mst' Trout https://MattSTrout.com/
[14:43:02] <SakiiR9> With our IRC ad service you can reach a global audience of entrepreneurs and fentanyl addicts with extraordinary engagement rates! https://williampitcock.com/
[14:43:04] <SakiiR9> I thought you guys might be interested in this blog by freenode staff member Bryan 'kloeri' Ostergaard https://bryanostergaard.com/
[14:43:04] <SakiiR9> Read what IRC investigative journalists have uncovered on the freenode pedophilia scandal https://encyclopediadramatica.rs/Freenodegate
[14:43:09] <SakiiR9> A fascinating blog by freenode staff member Matthew 'mst' Trout https://MattSTrout.com/
[14:49:48] <supercool3> With our IRC ad service you can reach a global audience of entrepreneurs and fentanyl addicts with extraordinary engagement rates! https://williampitcock.com/

[01:44:50] <DanPin20> With our IRC ad service you can reach a global audience of entrepreneurs and fentanyl addicts with extraordinary engagement rates! https://williampitcock.com/
[01:44:50] <DanPin20> I thought you guys might be interested in this blog by freenode staff member Bryan 'kloeri' Ostergaard https://bryanostergaard.com/
[01:44:50] <DanPin20> Read what IRC investigative journalists have uncovered on the freenode pedophilia scandal https://encyclopediadramatica.rs/Freenodegate
[01:44:53] <DanPin20> A fascinating blog by freenode staff member Matthew 'mst' Trout https://MattSTrout.com/
[01:44:54] <his> With our IRC ad service you can reach a global audience of entrepreneurs and fentanyl addicts with extraordinary engagement rates! https://williampitcock.com/
[01:44:54] <his> I thought you guys might be interested in this blog by freenode staff member Bryan 'kloeri' Ostergaard https://bryanostergaard.com/
[01:44:56] <his> Read what IRC investigative journalists have uncovered on the freenode pedophilia scandal https://encyclopediadramatica.rs/Freenodegate
[01:45:00] <his> A fascinating blog by freenode staff member Matthew 'mst' Trout https://MattSTrout.com/
[01:50:46] <RoyK26> With our IRC ad service you can reach a global audience of entrepreneurs and fentanyl addicts with extraordinary engagement rates! https://williampitcock.com/
[01:50:46] <RoyK26> I thought you guys might be interested in this blog by freenode staff member Bryan 'kloeri' Ostergaard https://bryanostergaard.com/
[01:50:49] <RoyK26> Read what IRC investigative journalists have uncovered on the freenode pedophilia scandal https://encyclopediadramatica.rs/Freenodegate
[01:50:52] <RoyK26> A fascinating blog by freenode staff member Matthew 'mst' Trout https://MattSTrout.com/
[01:51:38] <jeggott23> With our IRC ad service you can reach a global audience of entrepreneurs and fentanyl addicts with extraordinary engagement rates! https://williampitcock.com/
[01:51:41] <jeggott23> I thought you guys might be interested in this blog by freenode staff member Bryan 'kloeri' Ostergaard https://bryanostergaard.com/
[01:51:45] <jeggott23> Read what IRC investigative journalists have uncovered on the freenode pedophilia scandal https://encyclopediadramatica.rs/Freenodegate
[01:51:48] <jeggott23> A fascinating blog by freenode staff member Matthew 'mst' Trout https://MattSTrout.com/
[02:21:01] <bananas18> With our IRC ad service you can reach a global audience of entrepreneurs and fentanyl addicts with extraordinary engagement rates! https://williampitcock.com/
[02:21:05] <bananas18> I thought you guys might be interested in this blog by freenode staff member Bryan 'kloeri' Ostergaard https://bryanostergaard.com/
[02:21:08] <bananas18> Read what IRC investigative journalists have uncovered on the freenode pedophilia scandal https://encyclopediadramatica.rs/Freenodegate
[02:21:11] <bananas18> A fascinating blog by freenode staff member Matthew 'mst' Trout https://MattSTrout.com/
[02:22:55] <wook_25> With our IRC ad service you can reach a global audience of entrepreneurs and fentanyl addicts with extraordinary engagement rates! https://williampitcock.com/
[02:22:55] <wook_25> I thought you guys might be interested in this blog by freenode staff member Bryan 'kloeri' Ostergaard https://bryanostergaard.com/
[02:22:55] <wook_25> Read what IRC investigative journalists have uncovered on the freenode pedophilia scandal https://encyclopediadramatica.rs/Freenodegate
[02:23:01] <wook_25> A fascinating blog by freenode staff member Matthew 'mst' Trout https://MattSTrout.com/
[02:43:18] <TReK5> With our IRC ad service you can reach a global audience of entrepreneurs and fentanyl addicts with extraordinary engagement rates! https://williampitcock.com/
[02:43:22] <TReK5> I thought you guys might be interested in this blog by freenode staff member Bryan 'kloeri' Ostergaard https://bryanostergaard.com/
[02:43:25] <TReK5> Read what IRC investigative journalists have uncovered on the freenode pedophilia scandal https://encyclopediadramatica.rs/Freenodegate
[02:43:28] <TReK5> A fascinating blog by freenode staff member Matthew 'mst' Trout https://MattSTrout.com/
[02:46:55] <RichiH29> With our IRC ad service you can reach a global audience of entrepreneurs and fentanyl addicts with extraordinary engagement rates! https://williampitcock.com/
[02:46:55] <RichiH29> I thought you guys might be interested in this blog by freenode staff member Bryan 'kloeri' Ostergaard https://bryanostergaard.com/
[02:46:55] <RichiH29> Read what IRC investigative journalists have uncovered on the freenode pedophilia scandal https://encyclopediadramatica.rs/Freenodegate
[02:46:58] <RichiH29> A fascinating blog by freenode staff member Matthew 'mst' Trout https://MattSTrout.com/
[03:02:45] <nullrouted> With our IRC ad service you can reach a global audience of entrepreneurs and fentanyl addicts with extraordinary engagement rates! https://williampitcock.com/
[03:02:45] <nullrouted> I thought you guys might be interested in this blog by freenode staff member Bryan 'kloeri' Ostergaard https://bryanostergaard.com/
[03:02:45] <nullrouted> Read what IRC investigative journalists have uncovered on the freenode pedophilia scandal https://encyclopediadramatica.rs/Freenodegate
[03:02:49] <nullrouted> A fascinating blog by freenode staff member Matthew 'mst' Trout https://MattSTrout.com/
[03:24:46] <planigan13> With our IRC ad service you can reach a global audience of entrepreneurs and fentanyl addicts with extraordinary engagement rates! https://williampitcock.com/
[03:24:46] <planigan13> I thought you guys might be interested in this blog by freenode staff member Bryan 'kloeri' Ostergaard https://bryanostergaard.com/
[03:24:50] <planigan13> Read what IRC investigative journalists have uncovered on the freenode pedophilia scandal https://encyclopediadramatica.rs/Freenodegate
[03:24:53] <planigan13> A fascinating blog by freenode staff member Matthew 'mst' Trout https://MattSTrout.com/
[03:41:09] <PrettyKittie12> With our IRC ad service you can reach a global audience of entrepreneurs and fentanyl addicts with extraordinary engagement rates! https://williampitcock.com/
[03:41:12] <PrettyKittie12> I thought you guys might be interested in this blog by freenode staff member Bryan 'kloeri' Ostergaard https://bryanostergaard.com/
[03:41:16] <PrettyKittie12> Read what IRC investigative journalists have uncovered on the freenode pedophilia scandal https://encyclopediadramatica.rs/Freenodegate
[03:41:19] <PrettyKittie12> A fascinating blog by freenode staff member Matthew 'mst' Trout https://MattSTrout.com/
[04:25:45] <dp312> With our IRC ad service you can reach a global audience of entrepreneurs and fentanyl addicts with extraordinary engagement rates! https://williampitcock.com/
[04:25:48] <dp312> I thought you guys might be interested in this blog by freenode staff member Bryan 'kloeri' Ostergaard https://bryanostergaard.com/
[04:25:52] <dp312> Read what IRC investigative journalists have uncovered on the freenode pedophilia scandal https://encyclopediadramatica.rs/Freenodegate
[04:25:55] <dp312> A fascinating blog by freenode staff member Matthew 'mst' Trout https://MattSTrout.com/
[04:53:43] <Adran26> With our IRC ad service you can reach a global audience of entrepreneurs and fentanyl addicts with extraordinary engagement rates! https://williampitcock.com/
[04:53:46] <Adran26> I thought you guys might be interested in this blog by freenode staff member Bryan 'kloeri' Ostergaard https://bryanostergaard.com/
[04:53:50] <Adran26> Read what IRC investigative journalists have uncovered on the freenode pedophilia scandal https://encyclopediadramatica.rs/Freenodegate
[04:53:53] <Adran26> A fascinating blog by freenode staff member Matthew 'mst' Trout https://MattSTrout.com/
[04:59:04] <hipp> With our IRC ad service you can reach a global audience of entrepreneurs and fentanyl addicts with extraordinary engagement rates! https://williampitcock.com/
[04:59:08] <hipp> I thought you guys might be interested in this blog by freenode staff member Bryan 'kloeri' Ostergaard https://bryanostergaard.com/
[04:59:11] <hipp> Read what IRC investigative journalists have uncovered on the freenode pedophilia scandal https://encyclopediadramatica.rs/Freenodegate
[04:59:14] <hipp> A fascinating blog by freenode staff member Matthew 'mst' Trout https://MattSTrout.com/
[05:58:52] <marcoslater> With our IRC ad service you can reach a global audience of entrepreneurs and fentanyl addicts with extraordinary engagement rates! https://williampitcock.com/
[05:58:52] <marcoslater> I thought you guys might be interested in this blog by freenode staff member Bryan 'kloeri' Ostergaard https://bryanostergaard.com/
[05:58:53] <marcoslater> Read what IRC investigative journalists have uncovered on the freenode pedophilia scandal https://encyclopediadramatica.rs/Freenodegate
[05:58:58] <marcoslater> A fascinating blog by freenode staff member Matthew 'mst' Trout https://MattSTrout.com/
[06:06:55] <strugee4> With our IRC ad service you can reach a global audience of entrepreneurs and fentanyl addicts with extraordinary engagement rates! https://williampitcock.com/
[06:06:55] <strugee4> I thought you guys might be interested in this blog by freenode staff member Bryan 'kloeri' Ostergaard https://bryanostergaard.com/
[06:06:55] <strugee4> Read what IRC investigative journalists have uncovered on the freenode pedophilia scandal https://encyclopediadramatica.rs/Freenodegate
[06:11:43] <soahccc0> With our IRC ad service you can reach a global audience of entrepreneurs and fentanyl addicts with extraordinary engagement rates! https://williampitcock.com/
[06:11:46] <soahccc0> I thought you guys might be interested in this blog by freenode staff member Bryan 'kloeri' Ostergaard https://bryanostergaard.com/
[06:11:50] <soahccc0> Read what IRC investigative journalists have uncovered on the freenode pedophilia scandal https://encyclopediadramatica.rs/Freenodegate
[06:11:53] <soahccc0> A fascinating blog by freenode staff member Matthew 'mst' Trout https://MattSTrout.com/
[06:23:07] <Edane11> With our IRC ad service you can reach a global audience of entrepreneurs and fentanyl addicts with extraordinary engagement rates! https://williampitcock.com/
[06:23:11] <Edane11> I thought you guys might be interested in this blog by freenode staff member Bryan 'kloeri' Ostergaard https://bryanostergaard.com/
[06:23:14] <Edane11> Read what IRC investigative journalists have uncovered on the freenode pedophilia scandal https://encyclopediadramatica.rs/Freenodegate
[06:23:17] <Edane11> A fascinating blog by freenode staff member Matthew 'mst' Trout https://MattSTrout.com/
[07:05:11] <nirel> With our IRC ad service you can reach a global audience of entrepreneurs and fentanyl addicts with extraordinary engagement rates! https://williampitcock.com/
[07:05:15] <nirel> I thought you guys might be interested in this blog by freenode staff member Bryan 'kloeri' Ostergaard https://bryanostergaard.com/
[07:05:18] <nirel> Read what IRC investigative journalists have uncovered on the freenode pedophilia scandal https://encyclopediadramatica.rs/Freenodegate
[07:05:21] <nirel> A fascinating blog by freenode staff member Matthew 'mst' Trout https://MattSTrout.com/
[07:13:05] <ome> With our IRC ad service you can reach a global audience of entrepreneurs and fentanyl addicts with extraordinary engagement rates! https://williampitcock.com/
[07:13:08] <ome> I thought you guys might be interested in this blog by freenode staff member Bryan 'kloeri' Ostergaard https://bryanostergaard.com/
[07:13:12] <ome> Read what IRC investigative journalists have uncovered on the freenode pedophilia scandal https://encyclopediadramatica.rs/Freenodegate
[07:13:15] <ome> A fascinating blog by freenode staff member Matthew 'mst' Trout https://MattSTrout.com/
[07:19:46] <Our> With our IRC ad service you can reach a global audience of entrepreneurs and fentanyl addicts with extraordinary engagement rates! https://williampitcock.com/
[07:19:51] <Our> I thought you guys might be interested in this blog by freenode staff member Bryan 'kloeri' Ostergaard https://bryanostergaard.com/
[07:19:51] <Our> Read what IRC investigative journalists have uncovered on the freenode pedophilia scandal https://encyclopediadramatica.rs/Freenodegate
[07:19:57] <Our> A fascinating blog by freenode staff member Matthew 'mst' Trout https://MattSTrout.com/
[07:27:57] <poutine6> With our IRC ad service you can reach a global audience of entrepreneurs and fentanyl addicts with extraordinary engagement rates! https://williampitcock.com/

2018-07-31
[07:14:18] <dancecommander> Haven't been able to find a clear answer to this in the docs. Would there be a succinct way to get a list of packages as dicts that the current user has a certain permission level to operate on?
[07:14:49] <dancecommander> For example, if I were to generate a page of every dataset that the current user can edit
[07:16:08] <dancecommander> I've hacked together a horribly inefficient but technically working series of api calls but I'm curious whether there is another way
[07:20:51] <Zharktas> there isn't an efficient api for that as far as i know
[07:21:53] <Zharktas> we have done it by fetching organization memberships for database but that too is horrible inefficient if user has membership in many organizations
[07:27:38] <Zharktas> dancecommander: https://github.com/vrk-kpa/opendata/blob/cfeec71112e33fce5de1bffa18d10f13ec68de31/modules/ckanext-ytp-main/ckanext/ytp/user/controller.py#L91 you can find our old implementation here, although it is horrible slow with hundreds of organizations when the user is admin in all of them
[07:27:42] <dancecommander> Hmm alright. The way I'm current doing it is by fetching a list of all packages and simply filtering by a check_access call, with the intention to cache the result somehow
[07:28:04] <dancecommander> Thanks for the link I'll check it out and see if it'll help
[07:29:22] <dancecommander> Trying to build a better interface for creating dataset relationships, the end result of which may not require this call anyway. Just working through the stages of piecing things together
[07:31:19] <Zharktas> the database query in that code is implemented for ckan 2.3 so it probably won't work for newer ckans anymore though
[12:02:20] <amercader> wardi: you around for the meeting?
[12:14:19] <amercader> https://demo.ckan.org/tag
[13:43:26] <amercader> dancecommander, Zharktas: Would organization_list_for_user + package_search filtering on these orgs work?
[13:43:28] <amercader> http://docs.ckan.org/en/2.8/api/index.html#ckan.logic.action.get.organization_list_for_user
[13:51:53] <Zharktas> amercader: actually that could handle it in efficient way
[13:52:20] <Zharktas> did not know that organization_list_for_user can handle different permissions
[16:22:40] <solars> hi, quick question regarding: http://docs.ckan.org/en/2.8/maintaining/installing/install-from-docker-compose.html
[16:23:16] <solars> I think there is a mistake, the containers created are called docker_ckan, docker_db etc - but when setting up the datastore, only 'db' is referenced, is this correct?
[16:24:35] <solars> hm ok actually I don't know where the docker prefix comes from
[16:25:53] <solars> nevermind it's just the image name
[16:28:24] <solars> anyway, I'm getting: sudo docker exec -it db psql -U ckan -f 00_create_datastore.sh; 00_create_datastore.sh: No such file or directory
[16:28:31] <solars> does anyone know what could cause this?
[18:59:04] <tktech> Zharktas, permission labels would probably accomplish the same with a single query to solr
[18:59:09] <tktech> Assuming you're using CKAN 2.7+
[19:00:00] <tktech> http://docs.ckan.org/en/ckan-2.7.3/extensions/plugin-interfaces.html#ckan.plugins.interfaces.IPermissionLabels
[23:41:32] <tktech> amercader, we link to http*s*://packaging.ckan.org, but https seems to be misconfigured
[23:41:50] <tktech> http works fine

2018-07-30

2018-07-29

2018-07-28

2018-07-27

2018-07-26

2018-07-25
[07:47:05] <smotornyuk> There are lot of articles about that in internet https://packaging.python.org/discussions/install-requires-vs-requirements/
[07:47:48] <smotornyuk> generally: . setup.py should list abstract requirements, without specifying concrete version.
[07:48:46] <smotornyuk> if you try to be to specific in your setup.py, it will results in a bunch of conflicts between different extensions.
[12:00:09] <tino097> are you guys get the announcement email for the patch release ?
[15:49:34] <thenets> tino097 yes! :)

2018-07-24
[12:02:30] <tino097> wardi: meeting today ?

2018-07-23
[19:16:48] <benjwadams> Why are dependent packages for ckanext extensions not installed via install_requires in setup.py?  I don't understand this design choice
[19:17:56] <benjwadams> Instead you have to go and pip install the requirements.txt file
[19:18:03] <benjwadams> From the docs:
[19:18:11] <benjwadams> "install_requires is a setuptools setup.py keyword that should be used to specify what a project minimally needs to run correctly. When the project is installed by pip, this is the specification that is used to install its dependencies."
[19:19:10] <benjwadams> the extensions do not run without using pip install -r, and hence, they do not constitute what the project needs to run minimally

2018-07-22

2018-07-21

2018-07-20
[04:23:16] <dansecommander> Anyone have any tips on resolving conflicts between extensions that override the same api method? For example, in my case ckanext-datasetversions and ckanext-restricted override package_show and create a name conflict
[04:50:18] <dansecommander_> Factoring out the logic that overrides the action might be viable

2018-07-19
[13:02:42] <tino097> wardi, smotornyuk, amercader: meeting ?!
[13:26:16] <Vic_> hi all, I am new to CKAN and trying to use the Spatial Search Widget to enable filter by map. the map shows well on the individual dataset page, however if I search it returns nothing (I selected the whole worrld ;)). Any idea or hint on what's wrong? Thanks!

2018-07-18

2018-07-17
[12:02:22] <amercader> wardi: you around for the meeting?
[12:11:02] <amercader> https://github.com/ckan/ckan/wiki/Migration-from-Pylons-to-Flask#controllers
[15:47:19] <benjwadams> Hi, I have an CKAN theme loaded.  For some reason, it picks up the template and CSS (via fantastic) changes, but it is not picking up static images
[15:48:30] <benjwadams> in update_config function, I have:
[15:48:51] <benjwadams> toolkit.add_template_directory(config_, 'templates'); toolkit.add_public_directory(config_, 'public'); toolkit.add_resource('fanstatic', 'theme_name')
[19:31:34] <zeplin> I followed the ckan installation guide with docker compose (http://docs.ckan.org/en/latest/maintaining/installing/install-from-docker-compose.html) - but I have an issue with ckan redirecting me to localhost when I make changes to organizations, groups, or datasets. I did change my ckan.site_url in the ckan config .ini and I also changed it in the .env file. Can anyone help out?
[19:32:50] <zeplin> I have ckan running in a vm. I'm navigating to the ckan site from my host machine.
[21:00:21] <ersin> @zeplin What URL are you expecting the redirect to go to?
[21:00:22] <ersin> If you are expecting to be redirect to the VM host  you should use the VM hostname (or IP)  in your `ckan.site_url` config.

2018-07-16
[17:38:03] <benjwadams> I keep getting "ImportError: No module named plugin" when running the docker image, despite the fact this should have been fixed by PR referenced in ImportError: No module named plugin
[17:38:13] <benjwadams> *referenced in https://github.com/ckan/ckan/issues/3146
[17:38:28] <benjwadams> Oh, lovely, GitHub is down
[17:52:42] <benjwadams> https://github.com/ckan/ckan/pull/3576   This one

2018-07-15

2018-07-14

2018-07-13

2018-07-12
[13:02:57] <tino097> amercader: meeting today ?
[13:05:38] <amercader> Sorry, I'm stuck on another call

2018-07-11
[16:32:15] <tktech> wardi, https://i.imgur.com/aZs0j7y.png thoughts? Cleaner version of the base template.
[16:32:41] <tktech> Adds support for field groups to the edit form (previously only used on display), field default values, collapsing sections
[16:34:15] <tktech> Also cleaned up a bit and merged the functionality from ckanext-composite and ckanext-repeating
[16:34:25] <tktech> There's also delayed validation which is a bit of a hack, not sure if it's worth doing a PR for.
[16:34:43] <tktech> They have hundred+ field schemas and want users to be able to start working on them and come back to them later
[16:35:18] <tktech> So if an ini setting is set the required validator only runs if the publish dropdown is set to true, but all other validators run
[17:55:09] <benjwadams> Is there anything that can tell you if/how an extension loaded?  I'm trying to load ckan's "harvest" extension.  The package is installed and the paster commands for it are present, but when i go to the webpage, the "/harvest" HTTP endpoint that ought to be there isn't.
[18:18:33] <benjwadams> ugh, never mind, I was pointing at the wrong .ini file
[18:41:53] <tktech> benjwadams, sure, there's an api endpoint
[18:43:04] <tktech> benjwadams, https://demo.ckan.org/api/action/status_show
[18:43:11] <tktech> See the "extensions" list
[18:46:52] <benjwadams> Perfect, that's exactly the sort of thing I was looking for.

2018-07-10
[11:52:11] <amercader> Sorry, I'll be a few minutes late to the meeting today
[20:58:34] <benjwadams> How can I show which extensions are actually enabled in the ckan application
[20:58:57] <benjwadams> don't say the .ini file -- I already have the extensions specified, but it appears some are not running
[21:11:59] <benjwadams> looks like `paster --plugin=ckan plugin-info`

2018-07-09
[00:27:34] <DrCuriosity> Eventually worked it out - needed to have the config in the right dir _and_ restart the server.

2018-07-08
[22:55:25] <DrCuriosity> Okay, further stupid question while try to get style order behaving: exactly where does the resource.config file go in a plugin?

2018-07-07
[20:52:45] <Guest69931> Has anyone run into a problem where the /group route leads to an infinite redirect loop?
[20:55:11] <tully> I've attempted to replicate our remote developer vm on my local machine (mac). Everything is mostly stable, with very few differences between environments, but haven't yet been able to track down exactly what is causing /group to error out in a redirect loop
[20:56:53] <tully> Also appears to be just on my local machine

2018-07-06

2018-07-05
[02:54:23] <DrCuriosity> Hello there. I've got an issue I was hoping for help with. I have a base template with a couple of CSS resources, and Fanstatic seems to bundle them in arbitrary order. Is there any way I can get it to explicitly do the first and then the second?
[22:12:24] <DrCuriosity> Okay, following up on yesterday's problem: I've now got a resource.config for my plugin, with "order = theme.css theme-overrides.css" in the main section, but the change isn't being reflected (overrides is still coming first). Are there other steps I need to do in order to get the config processed properly?

2018-07-04
[13:18:16] <rossjones> Is anybody working on replacing the ckan 'dataproxy' for recline previews?

2018-07-03
[11:52:06] <amercader> Hi, not sure if I mentioned it already but Konstantin and I are away on a retreat this week and won't be able to join on the meetings. Assign away if needed of course

2018-07-02

2018-07-01

2018-06-30

2018-06-29
[08:15:12] <rossjones> Bitten by the 'unable to re-use context because it's modified by the action method' bug :(
[08:43:11] <rossjones> @amercader how do I get hold of the CKAN Association members (by email) nowadays?  The global list seems to have shut down, and ckan-dev doesn't really seem like the best place for my email...
[08:46:16] <rossjones> Wonder if steering-group@ckan.org still works...
[09:04:18] <amercader> rossjones: that should definitely work
[09:05:17] <rossjones> I'm rethinking being lairy, I'll wait to discuss it at dev meeting on Tuesday.
[09:05:53] <rossjones> Just had too much coffee this morning ...
[09:06:25] <amercader> Come have a chat on Tue :)
[09:09:11] <rossjones> I shall. Should be a bit more regular attending now I'm mostly settled at defra

2018-06-28
[15:49:01] <wardi> amercader: summer schedule, had to drop kids off at camp
[15:49:59] <amercader> I could not attend either, as my internet was dead
[15:50:08] <wardi> oh that message wasn't today
[15:52:50] <amercader> Next week I'm away at a summit so I don't think I'll be able to attend meetings, but I can definitely be assigned stuff and comment/review

2018-06-27
[07:43:54] <rossjones> It looks like the cert on https://lists.okfn.org/mailman/listinfo/ckan-dev has expired :(
[08:25:59] <amercader> thanks rossjones, we noticed that yesterday and just been able to fix it yet
[08:36:19] <rossjones> Is it the usual 'hunt around for someone that still has access to the server' stuff? :)
[10:15:30] <rossjones> @amercader I can't make the dev meeting tomorrow (because London) but if you could consider https://github.com/ckan/ckan/issues/4308 I can try and get a PR in this week.
[10:21:34] <nigelb> I used to know which server it was on :D
[10:23:19] <amercader> it's all good now with the certs :)
[10:27:24] <amercader> rossjones: see my comment in #4308. If you feel like removing stuff https://github.com/ckan/ckan/issues/3879 might interest you.
[10:27:49] <amercader> or https://github.com/ckan/ckan/issues/4291 is definitely more fun, but requires more thought and work
[10:41:28] <rossjones> I like the idea of generally moving away from paster ...is the current plan to get rid of all the old unsupported stuff for CKAN3  ?
[10:44:54] <amercader> we are definitely getting rid of lots of stuff, or planning to (david is slowly grinding through revisions!). Depending on when it happens and how much of it we'll call it CKAN 2.9/10 or 3.0
[10:45:22] <rossjones> I was going to agitate for CKAN3 only running on Py3 :)
[10:45:52] <rossjones> Must remember to hassle dread some more about the revisions stuff :)
[10:48:35] <amercader> oh, that's definitely the idea. There has been a lot of work on py3 syntax chagnes submitted by members of the community
[10:49:01] <amercader> well, with a py2/py3 transition period of course
[10:54:11] <rossjones> Sounds good.  Hopefully these prototypes I'm building will leave me with more time to contribute, just need to clear it with el hefe
[10:56:15] <amercader> *jefe
[10:58:22] <rossjones> :(
[10:58:55] <rossjones> I'm learning my spanish from el ministerio del tiempo so my spelling is likely to be bad :(
[11:05:57] <amercader> I didn't know about this series, is it good?
[14:58:33] <rossjones> @amercader  It's interesting, and a bit funny. Learned a lot about iberian history :)

2018-06-26
[12:03:19] <amercader> wardi: meeting?

2018-06-25
[14:06:19] <gjlawran> Looking for a reference or example implementing a logging user searchers for datasets or  suggestions on best way to implement: e.g. web access logs, package_search action,  SOLR query logging.

2018-06-24

2018-06-23

2018-06-22

2018-06-21
[12:32:31] <wardi> can't make it to meeting today
[12:42:58] <amercader> me neither!
[12:43:15] <amercader> smotornyuk: let's postpone it until next week
[13:02:14] <smotornyuk> ok, rogger that

2018-06-20

2018-06-19
[11:42:25] <Mikaela_> Hi Guys! Do you know which version of Ubuntu I need to install to run CKAN version 2.8?
[11:44:04] <teemu> I think 16.04.4 is enough at least
[11:44:39] <teemu> not sure if there's a "preferred" version
[11:45:16] <Mikaela_> Thanks!
[11:45:30] <teemu> np
[11:45:40] <Mikaela_> How do I find out which is the preferred version?
[11:46:16] <teemu> I don't know if there is one, maybe someone else here does
[11:46:39] <Mikaela_> Hope so :-)
[11:57:52] <amercader> Mikaela_: 16.04 is the recommended one
[12:02:33] <amercader> wardi: you around for the meeting?
[12:36:06] <Mikaela_> Thanks @amercader!

2018-06-18

2018-06-17

2018-06-16

2018-06-15
[19:10:33] <benjwadams> So, uh... tagged CKAN versions have Docker/Docker-Compose builds that do not complete?
[19:10:56] <benjwadams> I tried git tag 2.8 and the setup scripts are trying to references fields that do not exist
[19:12:21] <benjwadams> running against postgres 10.4
[19:13:51] <wardi> benjwadams: it's possible. most people using docker aren't using the compose config in core, and it's not fully in CI yet. Care to help us with that? https://github.com/ckan/ckan/blob/master/.travis.yml
[19:15:29] <benjwadams> What are they using to build in its stead?
[19:16:03] <benjwadams> Yeah, I could take a look
[19:18:12] <wardi> Try asking on ckan-dev. Though, I'll bet you'll hear more methods than total people responding
[19:21:21] <benjwadams> that's the mailing list, I presume?
[19:21:26] <wardi> yes
[19:23:48] <benjwadams> if i might ask, what's the division between the ckan-dev list and GitHub issues?
[19:24:08] <benjwadams> division of tasks/info
[19:24:25] <wardi> we use issues for bug reports and ckan-dev for discussion
[19:25:05] <wardi> also issues on the ckan/ideas repo for proposed changes (that someone might not be immediately working on)
[19:26:40] <wardi> and google hangouts twice a week if you'd like to talk directly to the core team https://hack.allmende.io/ckan-meeting

2018-06-14
[08:11:07] <lolziac> hi all
[08:11:32] <lolziac> I have a question...has anybody made datagovuk/ckanext-hierarchy work with ckan 2.8.0
[08:12:05] <lolziac> Im getting an error when trying to load the main page
[08:12:10] <lolziac> File "/usr/lib/ckan/default/src/ckan/ckan/config/middleware/flask_app.py", line 334, in __getattr__     return getattr(app_globals.app_globals, name) AttributeError: '_Globals' object has no attribute 'fields'
[08:12:20] <lolziac> extra_vars = {u'code': e.code, u'content': e.description} AttributeError: 'exceptions.AttributeError' object has no attribute 'code'
[08:13:22] <lolziac> but I can visit other pages (/dataset, /organization, etc)....only the main page doesn't load
[09:01:21] <amercader> lolziac: ckanext-hierarchy probably needs to be updated to work with 2.8.0. It is trying to access `g.fields` somewhere and it is not set, causing the first part of the exception (`AttributeError: '_Globals' object has no attribute 'fields`). In parallel there is a bug in the error handling in 2.8.0. This is fixed in master (https://github.com/ckan/ckan/pull/4257) but needs to be backported to 2.8.1
[10:12:48] <lolziac> I see @amercader ... I guess better to go with 2.7.4 then as I may encounter ckanext that don't work with 2.8.0
[12:53:13] <rossjones> @amercader I missed the meeting on Tuesday :( Is there on today?
[13:01:22] <amercader> rossjones: starting now!
[13:01:28] <amercader> https://hangouts.google.com/hangouts/_/event/cb1vmkss426lkqicj94a3amvd1c?hl=en-GB&authuser=1
[13:01:33] <rossjones> Just installing Chrome, will be right there :)
[13:28:19] <amercader> rossjones (and others) slides for CKAConUS are here https://drive.google.com/drive/u/1/folders/1ycnhabOkwEVR9w7HcXP-yfmHoEE7poRz
[13:28:37] <rossjones> Great, thanks!
[14:27:12] <rossjones> I'm getting a test fail on master in ckan.tests.test_common.TestCommonG.test_accessing_missing_key_raises_error_on_flask_request ... ```    assert_raises(AttributeError, getattr, ckan_g, u'user')```
[14:35:31] <rossjones> fixing ...
[16:25:24] <rossjones> I noticed it's been noticed -> https://github.com/ckan/ckan/issues/4088

2018-06-13

2018-06-12
[12:01:49] <amercader> tino097, wardi: time for meeting?

2018-06-11

2018-06-10

2018-06-09

2018-06-08
[10:00:47] <rossjones> I'm running `pylint --py3k` on ckan ... started 4 minutes ago, it's still running :(
[10:04:51] <amercader> rossjones: cclauss has submitted lots of great work recently regarding py3 support : https://github.com/ckan/ckan/pulls?q=is%3Apr+author%3Acclauss
[10:05:13] <rossjones> Wow.
[10:05:48] <rossjones> I guess the problem will be extensions though even when core is on py3. Might be easier post-flask
[10:05:55] <amercader> there's talk to include a linter for py3 support on the CI runs, but first we need to move to Circle CI 2.0
[10:06:23] <amercader> extensions will require some work, yes
[10:07:22] <rossjones> Ah looks like https://github.com/ckan/ckan/issues/4060 is making a start on circle but I think they're waiting for you on https://github.com/ckan/ckan/pull/4227 ;)
[10:13:22] <rossjones> Maybe I should try and attend Tuesday rather than distracting you :) Is the Tuesday meeting likely to happen?
[10:13:22] <amercader> I got a bit lost on all these ci/py3 issues I'll put in on my list to revisit and un-block
[10:13:47] <amercader> still happening every Tuesday and every Thursday
[10:13:48] <amercader> come!
[10:14:23] <rossjones> Might be better to try and direct my contributions rather than just being scattergun and generating more work ... I'll add it to my calendar....

2018-06-07
[13:03:25] <amercader> wardi: meeting?

2018-06-06

2018-06-05
[12:02:26] <tino097> wardi, amercader: meeting?
[12:02:40] <wardi> I'm here
[12:02:52] <amercader> Sorry, coming

2018-06-04
[14:47:34] <rossjones> Has anyone been able to pip install ckan recently?  Trying with 2.8 (and pip 10.0.1) I get an error about 'ckan/requirement-setuptools.txt' not being found :(

2018-06-03

2018-06-02

2018-06-01

2018-05-31
[13:02:26] <tino097> amercader, wardi: meeting today ?
[13:03:23] <amercader> I can join in 5 min
[13:03:36] <tino097> ok

2018-05-30

2018-05-29
[12:02:15] <tino097> amercader, smotornyuk:  meeting today or ?
[12:03:02] <amercader> I'm finishing my presentation for ckanconus so I can't join
[12:03:21] <amercader> tino097: ^

2018-05-28

2018-05-27

2018-05-26

2018-05-25

2018-05-24

2018-05-23

2018-05-22

2018-05-21

2018-05-20

2018-05-19

2018-05-18
[12:02:35] <bartek> hello
[14:09:32] <wardi> amercader, tino097, smotornyuk: would you be availble to call in to CKANConUS on May 29 10:30-11am california time?
[14:10:48] <wardi> we're trying to move a panel discussion as early as possible in the day
[14:13:03] <smotornyuk> Unfortunately, I'll be attending another meeting around this time :(
[14:13:17] <wardi> smotornyuk: what times do work for you?
[14:14:02] <smotornyuk> I'll be occupied from 9am to 12am. Anything else will do
[14:31:19] <wardi> smotornyuk: noon california is really late your time isn't it?
[14:33:20] <smotornyuk> Yep, it's 10pm in ukraine. But i prefer to work that late and then sleep to early afternoon)
[14:55:06] <tino097> 10pm in ukraine is 9pm for me ,
[14:58:43] <tino097> wardi: https://www.worldtimebuddy.com/?qm=1&lid=5391959,792578,703448,3128760&h=792578&date=2018-5-18&sln=21-22
[15:57:53] <amercader> 12am Cali time works for me. Before than that 10:00 would be good, but I can make arrangements for 10:30 as well
[15:58:06] <amercader> wardi: ^
[16:01:22] <wardi> ok, will get back to you asap

2018-05-17
[09:08:41] <smotornyuk> hi everyone. I won't join you today on tech meeting/ Sorry:(
[12:47:31] <amercader> sorry I'm in the middle of a deployment gone awry and I also won't be able to join today
[12:56:25] <tktech> My only question for today was regarding...
[12:57:02] <tktech> https://github.com/ckan/ckan/pull/4243
[12:57:56] <tktech> I want to move the VALID_SOLR_PARAMETERS logic up a layer. Right now it's done inside search, and after plugin hooks. Should be done on user input.
[12:58:05] <tktech> Plugins should be able to do whatever they want to the search query
[13:16:53] <wardi> tktech: would you mind adding that as a comment?
[14:07:14] <tomkralidis> hi all: left field q: is CKAN's search index support Solr only? Is Elasticsearch supported (yet)?
[14:18:02] <wardi> tomkralidis: not yet, tktech had started some work in that direction though (making an interface so you could choose your own search backend)
[14:27:54] <tktech> Been paused for a fair time, don't have any funding/time towards it
[14:31:08] <tomkralidis> thanks @wardi.  We're going to implement Solr and ES backend support in pycsw so this will enable ckanext-spatial's pycsw offering to bind directly to the search index (and not create a duplicate PostgreSQL/PostGIS backend)

2018-05-16

2018-05-15
[11:47:47] <amercader> wardi, smotornyuk, tino097: I'll be a few minutes late to the meeting, sorry
[14:04:37] <rossjones> Anyone know of any people/orgs doing training for CKAN devs? Ideally in the UK ...
[22:20:22] <lelia345> blol

2018-05-14

2018-05-13

2018-05-12
[06:46:53] <TURTLE957> looking for someone with skills
[21:50:53] <tktech> I can cook a mean roast

2018-05-11
[00:09:58] <nathan> hello

2018-05-10
[08:30:14] <rossjones> Thanks for the speedy review @amercader
[08:37:41] <amercader> np rossjones, it's great that someone can look into ckanext-spatial again
[08:56:47] <rossjones> I expect we'll be doing more with it once we've got our infrastructure a bit more solid. Got 400+ harvesters to migrate yet 8|
[08:57:04] <rossjones> sources, not actual harvesters :)

2018-05-09
[09:37:34] <amercader> There is a problem with the mailing list and emails are not being received/sent. We are investigating the issue
[10:23:00] <amercader> Mailing list working again
[13:31:51] <amercader> 2.8 is out everybody!
[13:32:14] <amercader> also patch releases for 2.5, 2.6 and 2.7, please upgrade your sites
[13:32:22] <amercader> all details here: https://ckan.org/2018/05/09/new-ckan-version-2-8-0-released-patch-versions-for-2-5-x-2-6-x-and-2-7-x-available/
[18:19:17] <rossjones> Evening.
[18:19:42] <rossjones> I've got a problem with my kerbals, can you help?
[18:29:09] <tino097> rossjones: wrong ckan, sorry
[18:31:41] <rossjones> Heh I know, was just trying to wind up (jokingly annoy) someone :)
[18:32:36] <tino097> :)

2018-05-08
[13:05:38] <jdb_> Hi there - I created a PR to give a proposal on adding support for solr highlighting https://github.com/ckan/ckan/pull/4243
[13:06:13] <jdb_> it's not urgent - I currently override a bunch of code to make it work rather than forking, but it'd be nice to override less of the search code
[13:06:43] <jdb_> mainly just keen to hear your thoughts - if this is vaguely a sensible way to go about it, so that this could eventually be a sustainable plugin that fits nicely into ckan
[13:07:20] <jdb_> even if the plugin isn't a generic one - each user of highlighting might implement their own use of highlighting using the features exposed here
[13:07:42] <jdb_> even if the plugin isn't a generic one - each user of highlighting might implement their own use of highlighting using the features exposed here

2018-05-07

2018-05-06

2018-05-05

2018-05-04

2018-05-03
[13:02:38] <amercader> wardi: meeting? :)

2018-05-02

2018-05-01
[07:31:37] <MadsEnerginet> Hey folks! Wondering if someone could help me out with some CKAN development of mine? I was looking at writing a plugin that could intercept exceptions, log thme in a specific way, and then let CKAN do what CKAN does (Either report 500 back to the client or show the debug info)
[07:33:00] <MadsEnerginet> Found the IMiddleware interface, but can't find much documentation on it. Thought maybe that the "make_error_log_middleware" method could do it, but can't find any way to access the exception in that method (sys.exc-info() is just (None, None, None))
[07:33:05] <MadsEnerginet> Any advice?
[08:27:54] <MadsEnerginet> Never mind. Figured it out. make_error_log_middleware is the right way to do it (or rather, it works in that method. if it's THE right way, I'm not sure). You just need to wrap webob.Request(environ).get_response(self.app) in a try statement and you'll be able to catch the exception with sys.exc_info()
[12:03:59] <wardi> amercader: meeting?
[12:05:44] <amercader> Hey sorry, I'm off today, it's a bank holiday here
[12:05:48] <wardi> ok

2018-04-30
[15:56:07] <jdb_> hi there
[15:56:22] <jdb_> I wanna get highlighting information out of solr for package searches
[15:58:02] <jdb_> looks like the easiest way would be to monkeypatch ckan.lib.search._QUERIES to return a custom PackageSearchQuery
[15:58:59] <jdb_> that could just add solr_response.highlighting to the results dict
[15:59:03] <jdb_> does that make sense?
[16:01:40] <jdb_> perhaps the most "correct" way is to add a custom search action and just copy everything I need from package_search but that actually feels more brittle than the monkeypatch
[16:02:44] <jdb_> this is on 2.7
[16:02:54] <jdb_> there isn't an easier way that I'm totally missing, is there?
[16:03:18] <jdb_> I'll check back on botbot in a bit - have to disconnect

2018-04-29

2018-04-28

2018-04-27
[09:59:15] <travis-ci> ckan/ckan 2.5 6145b03 https://travis-ci.org/ckan/ckan/builds/371955556 Konstantin Sivakov: The build has errored.

2018-04-26
[11:07:36] <smotornyuk> Sorry, it seems like i won't be able to attend today's meeting.
[12:00:10] <amercader> no worries smotornyuk , speak next week

2018-04-25

2018-04-24

2018-04-23

2018-04-22

2018-04-21

2018-04-20

2018-04-19
[13:02:23] <wardi> amercader: meeting?
[13:02:33] <amercader> sorry, coming
[13:38:46] <travis-ci> ckan/ckan release-v2.5.9 9f03981 https://travis-ci.org/ckan/ckan/builds/368652561 Cheomm88: The build has errored.

2018-04-18
[08:00:32] <dancecommander> Does there exist a list of plugins that are written or have been updated for 2.7+? I may be on the wrong track, but it seems like most of the plugins I've been using thus far are not compatible.
[08:01:19] <dancecommander> From what I can tell, the main issue a difference in accessing template context, but haven't yet made it further

2018-04-17
[13:22:24] <gerbyzation> Hi guys, I have some questions regarding geojson and datastore/datapusher.
[13:23:31] <gerbyzation> In order to use the mapview, the ckan docs say the data is required to have the data in the datastore
[13:24:10] <gerbyzation> is it correct that the datapusher doesn't support uploading of geojson though, only tabular data?
[13:29:18] <gerbyzation> and what does datastore support? the docs and comments online don't really provide much clarity
[14:09:56] <amercader> gerbyzation: only tabular data (eg csv and excel) can be pushed to the datastore
[14:10:40] <amercader> the Recline mapview view renders tabular data with geospatial component (eg lat/lon columns) in  a map
[14:10:56] <amercader> for rendering geojson check ckanext-geoview
[14:31:23] <gerbyzation> amercader: thans for your clarification. Wouldn't it be better to hide the upload to datastore button if these files are not supported anyway?
[14:50:13] <amercader> you mean showing the DataStore tab depending on the resource format? That sounds like a good approach

2018-04-16

2018-04-15

2018-04-14

2018-04-13

2018-04-12
[14:01:48] <tino097> wardi, smotornyuk: meeting today ?

2018-04-11

2018-04-10

2018-04-09

2018-04-08

2018-04-07

2018-04-06

2018-04-05
[13:09:09] <amercader> wardi, tino097: just noticed that with the summer time change in my part of the world the dev meeting on Thursdays is now happening at a time that I can't make :(
[13:11:06] <tino097> amercader: as for me, we can move it to 15:00
[13:12:22] <amercader> If that works for everybody that's cool, but not sure if that's too early in Canada
[13:17:58] <tino097> about today, you will make it ?
[13:41:50] <amercader> No, sorry
[13:47:26] <tino097> wardi: if you are here, maybe we could start earlier
[14:04:40] <wardi> amercader: I'm fine with 15:00 or 17:00 on thursdays
[14:30:51] <amercader> wardi, tino097: Thanks, let's do one hour earlier on Thursdays if you don't mind then

2018-04-04

2018-04-03

2018-04-02

2018-04-01

2018-03-31

2018-03-30

2018-03-29
[10:06:07] <tktech> wardi, it's been so long, what time would the meeting be at today with the DST change?
[10:06:57] <tktech> Awake early for a change
[12:31:39] <tino097> tktech: 90 mins to go :)

2018-03-28
[05:15:45] <tktech> Zharktas, and which version are you using now?
[05:16:04] <tktech> Zharktas, 2.7 should more-or-less gracefully fail on unknown events
[05:56:21] <Zharktas> tktech: 2.7.3
[05:57:35] <Zharktas> it might be our instance itself though, but it is somewhat chore to test it with stock ckan since you would need old 2.3 ckan to generate related item and upgrade that to 2.7

2018-03-27
[07:17:10] <Zharktas> tktech: https://pastebin.com/zH9unvRF
[07:17:45] <Zharktas> the instance in question has been originally ckan 2.1 or something, so activity logs have related items from before they were removed from ckan
[14:26:26] <amercader> tino097: dev-v2.8 branch is ready for beta.ckan.org
[15:28:23] <tino097> amercader: https://beta.ckan.org/api/action/status_show :)
[15:35:49] <amercader> Woohoo! Thanks tino097 , I'll send an announcement email
[15:37:40] <tino097> if we need to enable some other extensions, please notify me

2018-03-26
[08:46:24] <amercader> tino097: great! Looks like is giving an https error. Is that easy to solve?
[09:03:14] <tino097> amercader: its something with certificates, i think our devops will fix it
[12:07:49] <Zharktas> is there a way to clear user activity lists ? we are seeing error pages caused by bots as they crawl activity lists until they reach activity that does not have renderer anymore ie. related item activities in this case
[23:10:34] <tktech> Zharktas, do you have an example traceback? That shouldn't be happening...

2018-03-25

2018-03-24

2018-03-23
[13:21:56] <tino097> https://master.ckan.org/ is back again

2018-03-22
[14:02:54] <wardi> amercader: meeting today?
[14:03:04] <amercader> yes, sorry

2018-03-21

2018-03-20
[12:05:12] <wardi> amercader: have time for meeting?
[12:10:01] <amercader> Sorry, forgot to warn that I'm away today
[12:17:59] <wardi> no worries. I just approved Steven for a transifex account and I see there are a couple other requests that are waiting there
[12:18:14] <wardi> what's our usual process for transifex accounts?
[13:24:25] <amercader> You mean adding them as collaborators on the CKAN project manager
[13:24:41] <amercader> Ignore the manager
[13:25:19] <amercader> If it's just that I generally approve everybody that requests it and doesn't obviously look a spammer

2018-03-19

2018-03-18

2018-03-17

2018-03-16

2018-03-15
[10:03:54] <amercader> smotornyuk, just checking if you worked on the changelog for the patch releases. It's totally fine if not, I have time to do it now. I just want to double check that you haven't made the work
[10:23:05] <amercader> smotornyuk: I'll do it
[11:47:18] <amercader> wardi, smotornyuk: does this reflect the datastore_active extra issue and the way to fix it correctly? (3rd point): https://gist.github.com/amercader/08465de7fde4abe5efc5cb9c68340f72
[12:18:30] <travis-ci> ckan/ckan ckan-2.5.8 d097ac6 https://travis-ci.org/ckan/ckan/builds/353795583 amercader: The build has errored.
[12:36:41] <jbothma> what do you think of having came_from=url handling through the registration flow?
[12:37:18] <jbothma> is there a reason why it wasn't added before other than not getting to it/needing it?
[12:38:09] <jbothma> the Create An Account button would need the came_from query string part added
[12:39:57] <jbothma> but it looks pretty feasible to then carry it through the flow and redirect the user there instead of h.redirect_to(controller='user', action='me')
[13:04:37] <smotornyuk> amercader: sorry, recently polari(my client for irc) became little bit buggy and i do not see new messages after leaving client idle:(
[13:04:51] <amercader> no worries
[13:04:57] <smotornyuk> I was just working on changelog around the time you wrote about it))
[13:05:12] <amercader> I noticed, no worries :)
[13:05:43] <amercader> smotornyuk: what about the changelog message above regarding the datastore_active issue? ^
[13:06:52] <amercader> https://gist.github.com/amercader/08465de7fde4abe5efc5cb9c68340f72
[13:07:09] <smotornyuk> yep, read it - it reflects the problem and nothing can be said in addition. Perfect outline)
[13:07:15] <amercader> cool
[13:07:38] <amercader> any final changes in the script in here? https://github.com/ckan/ckan/pull/4063
[13:08:37] <smotornyuk> I think, it's ready to go
[13:08:46] <amercader> I think I'm going to add it to repo under a `scripts` folder. pasting in a gist means only I can modify it and and in the wiki everyone can
[13:08:58] <amercader> does that sound good?
[13:09:03] <smotornyuk> yep
[13:09:22] <amercader> cool, then we write the second one needed we can add it there as well
[13:56:55] <amercader> smotornyuk, tino097, wardi: I don't think I'll be able to make to the meeting today. I still have to do stuff from the patch release and would need to leave soon
[14:00:18] <tino097> ok
[14:00:29] <Zharktas> amercader: i've used the fix_resource_extras script yesterday as our client lost hundreds of resources and i've notices that https://github.com/ckan/ckan/blob/master/scripts/4042_fix_resource_extras.py#L65 for this line to work current and rev need to parsed as json first
[14:01:52] <Zharktas> https://gist.github.com/Zharktas/ccc57f59726613691bbda6bb31f464b2 like this
[14:06:21] <amercader> stop the press!
[14:06:28] <amercader> thanks Zharktas
[14:06:35] <amercader> does this make sense smotornyuk? ^
[14:13:26] <smotornyuk> Yes. Thanks, Zharktas!
[14:13:46] <amercader> ok, pulling the 2.7 packages
[14:38:20] <tktech> If jbothma comes back and someone notices before I do, please let him know that the return URL must be sanitized strictly before it can be added as a feature
[14:38:38] <tktech> Otherwise we open ourselves to an open redirection attack
[15:07:52] <jbothma> noted, @tktech
[15:11:50] <tktech> :)
[15:38:17] <jbothma> oh man... is there decent login/registration using multiple authorities at the same time, e.g. Facebook, Twitter and Google?
[15:48:24] <tktech> They all provide OAuth support]
[16:16:14] <jbothma> Been a while since I did this - the plugins seem to take config for one provider at a time
[16:16:37] <jbothma> so how would I put three oauth providers side-by-side so I can pick which one I use when I want to login?
[16:33:54] <jbothma> I'll follow in the log - in case someone gets a chance to respond

2018-03-14
[08:29:47] <jbothma> I asked about authenticating users using username/password via the API the other day
[08:30:19] <jbothma> differently from that, I'd like to redirect people to login if they're not logged in, then get them pack to my controller after login
[08:30:45] <jbothma> I'm looking at implementing discourse's SSO flow where someone gets redirected to my app, and my app should redirect back to discourse
[08:31:00] <jbothma> I'd like to use CKAN as the authentication authority
[08:31:14] <jbothma> is anyone aware of things doing this already?
[08:44:58] <jbothma> I see I can redirect unauthenticated users to https://data.vulekamali.gov.za/user/login?came_from=https://myckan/mypath?SSOstuff but looks like that doesn't redirect the user upon registration
[10:29:50] <tino097> Zharktas^: hey, im trying to build xenial package, but i got errors, i needed to add pre_task line and install python 2, but i would ask you how did you build them? any specific ansible version or ?
[11:17:04] <Zharktas> tino097: most likely i've installed ansible to the virtual machine itself since i'm windows developer and you can't install ansible in windows
[11:17:15] <Zharktas> and installing ansible propably install python too
[11:20:27] <Zharktas> but then again, something might have changed since http://packaging.ckan.org/ has prebuilt xenial packages for months
[11:27:07] <jbothma> hmm...so I'm adding a flask blueprint for my SSO controller
[11:27:43] <jbothma> when I redirect an unauthenticated user to login I get:
[11:28:04] <jbothma> ckan_1        |   File "/src/ckanext-discourse-sso/ckanext/discourse_sso/plugin.py", line 12, in sso ckan_1        |     action='login', came_from="https://lala.bob") ckan_1        |   File "/src/ckan/ckan/lib/helpers.py", line 179, in redirect_to ckan_1        |     _url = url_for(*uargs, **kw) ckan_1        |   File "/src/ckan/ckan/lib/helpers.py", line 256, in url_for ckan_1        |     my_url = _routes_default_url_for(*args, **kw)
[11:28:08] <jbothma> wow that wasn't nice
[11:28:36] <jbothma> I try to redirect with h.redirect_to(controller='user', action='login', came_from="https://lala.bob")
[11:29:31] <jbothma> is there some kind of setup I need to do to make the old router work from my flask controller?
[11:30:39] <jbothma> https://github.com/OpenUpSA/ckanext-discourse-sso/blob/master/ckanext/discourse_sso/plugin.py
[12:52:54] <jbothma> I'm also really struggling to actually get the user from my plugin
[12:57:35] <smotornyuk> as for router, old routes should work out of the box(unless you are using master branch, where some controllers already migrated to flask)
[12:58:08] <smotornyuk> note, that flask routes should retun redirect, not just perform call to redirect function
[12:58:27] <jbothma> I picked the return thing up, thanks
[12:59:06] <jbothma> I wasn't importing from plugin toolkit - but fixing that hasn't fixed finding the user of the supplied cookie
[13:42:51] <jbothma> hmmm REMOTE_USER isn't set in request.environ
[13:45:02] <jbothma> sadly looks like I have to implement it as a pylons plugin

2018-03-13

2018-03-11

2018-03-10

2018-03-09
[10:32:38] <travis-ci> aptivate/ckan mapaction-dev-2.5.8 5cc30c2 https://travis-ci.org/aptivate/ckan/builds/351243238 Martin Burchell: The build has errored.

2018-03-08
[11:54:36] <lohengrin> Hi everyone
[11:55:26] <lohengrin> Somebody nkows ho to work with ckan extensions?
[14:01:56] <wardi> amercader: meeting?
[14:02:13] <amercader> coming, booting up chrome

2018-03-07
[12:07:39] <amercader> wardi, smotornyuk: regarding https://github.com/ckan/ckan/pull/4063. In light of the latest comments do you still think we can have the script and docs ready by the end of this week?  Wondering if we can go ahead with the plan of announcing today and releasing patch releases next Wednesday
[12:07:57] <amercader> for all the rest of tasks we should be fine, but not sure about this one
[15:54:44] <e0ne> hi. could anybody please help me with unit tests?

2018-03-06
[12:02:18] <amercader> wardi: meeting?

2018-03-05
[11:24:59] <travis-ci> NaturalHistoryMuseum/ckan toolkit-attribute-error 220d106 https://travis-ci.org/NaturalHistoryMuseum/ckan/builds/349244157 Alice Butcher: The build has errored.
[11:30:32] <travis-ci> NaturalHistoryMuseum/ckan datastore-jsonb 20c7e1e https://travis-ci.org/NaturalHistoryMuseum/ckan/builds/349245529 ginger: The build has errored.

2018-03-04

2018-03-03

2018-03-02

2018-03-01

2018-02-28

2018-02-27
[12:03:09] <amercader> wardi_  : meeting?
[18:07:42] <wardi_> amercader: fighting a flu and had to sleep, I hope to make the thursday one
[18:08:14] <amercader> wardi_: get well soon!
[18:08:56] <wardi_> thanks
[18:31:27] <benjwadams> Is it safe to run the following SQL statement to clean up old resources in CKAN: `DELETE FROM resources WHERE state = 'deleted'`
[18:32:00] <benjwadams> I don't see any evidence that CKAN actually removes old dataset resources, and as a result, a large number of them have accumulated
[21:52:44] <tktech> benjwadams, are you seeing them after purging datasets from the admin tool?

2018-02-26

2018-02-25

2018-02-24

2018-02-23

2018-02-22
[09:27:06] <amercader> Has anyone being using Solr 6.6.2 or higher for a while with CKAN? any issues or changes needed?
[14:03:09] <wardi> tino097: meeting?
[14:07:13] <amercader> https://github.com/ckan/ckan/pull/4032/files#diff-6a7150fe85c9c5a0b9748f004d95f46aR17
[14:26:25] <amercader> https://github.com/ckan/ckan/blob/master/ckanext/datapusher/plugin.py#L103

2018-02-21

2018-02-20
[10:48:17] <amercader> I can't join today's meeting I'm afraid. Please assign me anything that you think I can help with
[10:49:03] <amercader> tino097: I definitely have the group blueprint on my mind. Let me know if you need specific help with this
[10:52:04] <tino097> amercader: if you have time, please add some comments on the PR
[10:52:30] <amercader> will do
[10:52:51] <tino097> for your way of approaching to defining the routes
[10:53:25] <tino097> ty
[12:04:19] <tino097> wardi: meeting ?

2018-02-19

2018-02-18

2018-02-17

2018-02-16

2018-02-15
[16:16:22] <VikDC> Hi guys, someone over here?
[16:17:20] <wardi> VikDC: hi, it's usually better to ask your question first
[16:17:48] <VikDC> oh ok wardi, sorry it's my first time here! :)
[16:18:16] <wardi> VikDC: no problem. we were all new once :-)
[16:19:15] <VikDC> well my question is "i'm gonna work in a new project and i'll work with ckan, now i've read all documentation about it and i saw there are 3 kind of installation, i would like wich one is the best to work on ubuntu 16.04.3 LTS - 64bits, wich is the best version of ckan for this o.s too, thanks!
[21:46:57] <VikDC> Hi, does someone has experience installing ckan?
[21:47:15] <VikDC> i have some question that i'd like to do.
[22:12:35] <VikDC> oh thanks for answers!

2018-02-14
[16:25:23] <dread_> I am playing with the ckan docker-compose install of ckan
[16:26:33] <dread_> Am trying to set-up bind mounts so that I can edit source from my local hard disk
[16:28:06] <dread_> I've specified them in docker-compose.yml but when I build ckan, the Dockerfile should create /usr/local/bin/ckan-paster but it's not appearing on my hard disk
[16:28:41] <dread_> I'm deleting the image and running: docker-compose build ckan
[16:29:05] <dread_> so I'd have thought that would do it, but clearly I'm missing something
[16:30:04] <dread_> I'd use the default - named volumes - but on a Mac they are squirrelled away on the VM, so not convenient for opening in a normal desktop editor
[16:30:45] <dread_> @amercader I don't suppose you have any tips?
[16:30:54] <bubo> you don't have access to volumes during build
[16:30:56] <bubo> only during runtime
[16:31:14] <dread_> hmmm so bind mounts are going to be difficult?
[16:31:57] <bubo> you can still set it up
[16:32:04] <bubo> just mount the code directly in the container
[16:32:10] <bubo> and start it with a bash script
[16:33:40] <dread_> bubo thanks for this
[16:34:08] <dread_> maybe the problem is I'm trying to mount the config too
[16:34:14] <dread_> (as well as the code)
[16:43:04] <dread_> bubo: so the Dockerfile creates a venv and installs all the python deps, and that goes into the image's union filesystem, not the volume. And when you run it, by default the named volumes get mounted, and I see the files get copied to the new volume.
[16:43:36] <dread_> But when you use a bind mount, it starts off empty. I don't suppose there is a way to populate it from the image, as a one-off?
[17:00:48] <bubo> not really
[17:01:04] <bubo> you use volumes to mount stuff inside the container
[17:02:01] <dread_> ah, I found 'docker cp' to copy the venv off the image to my local disk
[17:02:17] <dread_> that is working, so thanks for all your help bubo
[17:02:26] <bubo> dread_: you can also use a named volume
[17:02:37] <bubo> and just go to wherever the named volume is set to and get what you need from there
[17:02:48] <bubo> docker run -v yourvolume:/something/you/want
[17:04:51] <dread_> that makes sense, thanks
[17:05:44] <bubo> np
[17:06:05] <amercader> dread_: I'm not sure about the exact issue that you have but with the compose setup I'm currently using I can mount a src folder in the host and then clone extensions there
[17:06:45] <amercader> IIRC it's just a normal volume plus startup scripts to install hem in the container venv
[17:07:03] <amercader> Have a look, maybe it helps: https://github.com/okfn/docker-ckan
[17:08:31] <dread_> thanks @amercader, but sadly i think my mac gets in the way of me doing that
[17:09:32] <amercader> Mm that's too bad, I was hoping that this would be generic enough
[17:10:02] <dread_> @amercader: you're doing your development by editing the files in /var/lib/docker/volumes/ckan_storage right?
[17:12:30] <amercader> No, they are in the `src` folder, next to the other files in that repo
[17:12:30] <dread_> ah, for developing extensions I see you're doing a bind mount of ./src
[17:12:38] <amercader> Yes
[17:12:52] <dread_> and for developing ckan itself?
[17:14:24] <bubo> you can still mount the ckan code itself
[17:16:41] <dread_> yes, that is working for me. just wasn't sure if amercader did that differently. ok, so we're using bind mounts for dev :)
[17:21:09] <amercader> One thing a time :) I still haven't tackled developing CKAN but I suspect we can follow a similar approach
[17:21:35] <amercader> As long as the built requirements matched the local version it should be fine
[17:22:47] <dread_> @amercader: cool, we're on the same page then!
[17:23:23] <amercader> Would be awesome to collate efforts and use a common setup

2018-02-13
[06:17:11] <SJ2608> Hello
[06:17:20] <SJ2608> Greetings to all !
[06:19:20] <SJ2608> I would like to know whether i can use tag 2.7.2 of CKAN.
[06:19:30] <SJ2608> Is it in stable state ?
[08:20:53] <bubo> it is
[11:17:59] <amercader> SJ2608: yes, 2.7.2 is the latest stable release
[11:18:24] <amercader> question for all, is anyone here using ckanext-scheming for organizations?
[11:18:40] <SJ2608> why this is maintained under TAG in CKAN repo
[11:19:05] <amercader> SJ2608: what do you mean>
[11:19:07] <amercader> SJ2608: what do you mean?
[11:19:11] <SJ2608> I was confused why not it is under release
[11:19:28] <amercader> you mean a `release-*` branch?
[11:19:34] <SJ2608> I mean if we see CKAN repo ... there is no branch related to 2.7.2
[11:19:46] <SJ2608> but there is a TAG of 2.7.2
[11:19:55] <SJ2608> YES
[11:20:40] <amercader> All CKAN releases have always been tagged. And starting from CKAN 2.6, we have a single branch for each release version: dev-v2.6, dev-v2.7, etc where we tag the releases
[11:21:09] <amercader> this was made to clean up the repo and have a branch that always has the latest patch release for a particular version
[11:21:37] <amercader> there are more details here: http://docs.ckan.org/en/latest/contributing/release-process.html
[11:22:28] <SJ2608> okh ..so this is done after release 2.6
[11:23:40] <SJ2608> Actually I was getting some SOLR error while starting up CKAN 2.7.2
[12:02:02] <tino097> amercader: wardi meeting today ?
[12:02:11] <amercader> sorry, coming
[12:28:47] <amercader> https://github.com/ckan/ckan/pull/4007/files#diff-244c9c0a85f9bb077ce1799c1af6210cR896
[12:46:56] <amercader> argh, actually forgot to ask you something smotornyuk
[12:47:17] <amercader> have you used scheming with organizations? I'm asking because I found this https://github.com/datagovuk/ckanext-hierarchy/commit/2c7e21833ff736e591966240e12dae36b2a98e87

2018-02-12

2018-02-11

2018-02-10

2018-02-09

2018-02-08
[13:47:51] <amercader> wardi, smotornyuk, tino097: Sorry, can't make it to the dev meeting today. Will check all mentions later today
[13:50:26] <tino097> ok

2018-02-07
[09:37:22] <rp21> hi there
[09:38:32] <rp21> i am a newbee to ckan data platform. the new firm i have joined in is using ckan with a lot of customizations and doesn't have much of documentations for the same
[09:39:19] <rp21> was wondering if any document developer centric explaining the architecture and flow of code
[09:39:52] <rp21> is available out there with anyone ? i would be greatful if anyone could share it
[11:40:53] <rp21> ?

2018-02-06
[12:02:30] <tino097> amercader: wardi, smotornyuk meeting today ?
[12:03:02] <amercader> tino097: we are all there :)
[12:03:35] <tino097> hm, what link i have ?!
[12:03:51] <wardi> https://plus.google.com/hangouts/_/event/cb1vmkss426lkqicj94a3amvd1c?authuser=0&hl=en-GB

2018-02-05

2018-02-04

2018-02-03

2018-02-02
[00:15:19] <tktech> wardi, might be useful for you, https://github.com/ckan/ckanext-pages/compare/master...canhdc:master
[00:15:43] <tktech> Very quick hack, hardcoded to en/fr in the dropdown. Doesn't fall back properly when one is missing.
[00:16:14] <tktech> Gives you a language selector when creating/editing ckanext-pages content and shows the right version based on CKAN language

2018-02-01
[14:04:38] <wardi> amercader, tino097_ : have time for meeting today?
[14:04:46] <tino097_> just a sec

2018-01-31

2018-01-30
[15:12:26] <circ-user-CFuZg> I am trying to make a CKAN extension and have an issue, is this the right channel for questions about that?
[15:16:27] <Bubo> sure
[15:19:38] <circ-user-CFuZg> I have a model that works fine when I start the server, but when I run a paster command all queries give "UnboundExecutionError: Could not locate a bind configured on mapper Mapper|ExtensionModel|ckanext_ext_table, SQL expression or this Session"
[15:19:49] <circ-user-CFuZg> any idea what could cause that?
[16:35:51] <mhv-energinet> Hi guys! I'm trying to debug an issue where the dataset_purge api times out - It times out it can't finish deleting everything in the alotted timeframe (Takes around 19 minutes to delete it all...). Is there any utility to clean old revisions and such from the database, or would it have to be done manually?
[20:25:58] <wardi> tktech: interesting re. ckan agpl enforcement https://www.lexology.com/library/detail.aspx?g=49db3282-786d-4b67-8d11-ac1f59b20d22
[20:27:18] <wardi> I went searching for ckan news because my linked in says I've appeared in thousands of searches this week..
[23:43:06] <tktech> wardi, that explains those daily linkedin emails
[23:43:31] <tktech> wardi, very interesting, key thing to note is it's was just an "advocate" complaining until it was no longer worth the effort
[23:44:08] <tktech> I wonder if Lior Kaplan ever talked to anyone in the group.
[23:46:48] <tktech> I see, looks like they didn't keep things sufficiently separate. There's also some copy-pasting from core going on.
[23:46:49] <tktech> https://github.com/CIOIL/DataGovIL/commit/d4ecaeabfeeea87b4f05e0a13b35f03e203ff8b5
[23:48:21] <tktech> I'd have to agree that this would be a violation. It's distributed together, segments were copy-pasted from core templates, and some core changes were made

2018-01-29

2018-01-28

2018-01-27
[00:01:32] <tktech> wardi, #3978 needs a small change before it can be merged
[00:05:02] <tktech> Commented

2018-01-26
[14:14:12] <jbothma> Is there a pattern for linking to APIs like openspending from a ckan instance that gives the user/client an idea of what's there? Towards API discovery or something or viewer plugins to CKAN that consume a linked OpenSpending API?
[14:38:28] <jbothma> if I get disconnexted, I'm following on botbot
[20:17:03] <wardi> tktech: that's great news!

2018-01-25
[14:04:24] <amercader> wardi: you around for a meeting?
[14:10:00] <amercader> https://github.com/okfn/docker-ckan
[14:10:06] <amercader> https://github.com/okfn/docker-ckan/pull/5
[17:02:31] <tktech> I have some funding again for core issues starting next week

2018-01-24
[12:40:30] <thenets> exists a command to rebuild all datastore content?
[15:08:43] <tktech> thenets, I don't believe so, not for all datasets at least
[15:09:10] <tktech> Yeah datastore exposes 2 commands. One is to correct permissions and another is to export a dataset.
[15:31:27] <thenets> tktech thanks :) I'll create my own script for it
[15:31:57] <tktech> Would be great if you could add it to the commands.py
[15:32:04] <tktech> So others can benefit, it seems like it would be useful!
[15:44:43] <wardi> thenets: there might be one on the datapusher extension, if that's what you mean by rebuild
[15:45:02] <wardi> yes, "submit_all"
[15:50:21] <tktech> wardi, would "resubmit" be a better choice if you're just rebuilding?
[15:50:52] <tktech> wardi, Looking at the code submit_all gets everything with package_list including things that aren't in datastore, then adds them all
[15:51:08] <tktech> Where resubmit just rebuilds things in the datastore
[15:51:40] <tktech> (I've never used datapusher)
[16:01:57] <thenets> wardi tktech my problem is: many resources stop working and I don't know why. So I'm trying to fix then by create each one. I tried to submit but raise error
[16:02:43] <thenets> so now I'm deleting each datastore reference of resources with bug
[16:02:52] <thenets> and re submit
[16:47:04] <wardi> tktech: I don't know either
[21:00:51] <thenets> tktech wardi one guy in the mail list found the same error related to DataStore: https://pastebin.com/ghxnateb
[21:01:24] <thenets> where should I open the issue about it? In the main CKAN repository?
[21:02:34] <wardi> main ckan repo is fine for this
[22:30:19] <thenets> Ok wardi. I'll put it when I arrive in my home

2018-01-23
[09:37:45] <gr8_> We harvest a csw-service. However, we will need ISO19139 (from 2007) and also the service-definition from ISO 19139 2006. How is it possible to combine these two standards in detail?
[09:44:07] <gr8_> in our validation-directory there are the xml-files of the standards combined. Do I have to manually include e.g. the srv-files of the 2006 or is it recognized automatically?
[12:38:04] <amercader> wardi, smotornyuk, tino097: sorry I missed the meeting. I have both kids sick at home and not very available
[12:38:37] <amercader> gr8_: I haven't worked with this in a long time but maybe playing with `ckan.spatial.validator.profiles` (http://docs.ckan.org/projects/ckanext-spatial/en/latest/harvesters.html) might help?
[12:39:34] <amercader> you need to use the names defined on these classes https://github.com/ckan/ckanext-spatial/blob/master/ckanext/spatial/validation/validation.py
[14:55:23] <torf> If anyone has time I'd appreciate reviews on some PR's of mine for ckanext-pages: https://github.com/ckan/ckanext-pages/pull/64 https://github.com/ckan/ckanext-pages/pull/66  https://github.com/ckan/ckanext-pages/pull/74
[15:16:55] <tktech> > Adds a LICENSE file and a corresponding notice in README.md for the AGPL v3.0 license which is used for all CKAN extensions.
[15:17:11] <tktech> Was this a requirement in the past to get extensions under the /ckan org?
[15:17:56] <tktech> Tobe was the original author and it seems like we're just assuming a license here
[15:28:22] <amercader> this was started at OKI (then OKFN) and our policy is that all ckan extensions are AGPL.
[15:28:55] <amercader> I know next to nothing about licenses but doesn't CKAN being agpl means that extensions are too by default?
[15:34:12] <tktech> Nope
[15:34:47] <tktech> All of mine go out under MIT and I think some of our government ones are under their funky open source license
[15:35:33] <tktech> So long as the extension does not actually include code from CKAN the [A]GPL license of the base doesn't affect it
[15:35:43] <tktech> (ABI/API does not count as linking)
[18:22:33] <wardi> even if extensions are deemed to be covered by the agpl3 by some court somewhere, the mit-license and agpl3 are compatible (AFAICT, IANAL) plus MIT-licensed code has the benefit of being reusable in other non-agpl3 code bases without any onerous restrictions (if that's of any use to anyone)
[19:50:34] <tktech> wardi, the key thing IMO is that CKAN includes the extensions, not the other way around
[19:50:48] <tktech> wardi, even if the license is incompatible as long as the extension is the more liberal it should be fine

2018-01-22
[11:24:34] <EnTeQuAk> Hey there everyone, I stumbled upon the PostgreSQL FTS code inside the ckan datastore and I'm wondering if there's any code, extension or so that simply uses that PostgreSQL FTS for search instead of the default Solr interface?
[17:26:05] <dread_> Is it just us that has suffered a ddos from china, or anyone else?

2018-01-21

2018-01-20

2018-01-19

2018-01-18
[13:34:09] <amercader> can't make it to the meeting today wardi, smotornyuk, tino097. I will review the issues and comments later today or tomorrow
[13:37:26] <tino097> amercader: there are no new PRs/issues, so we could skip all today wardi, smotornyuk ?

2018-01-17

2018-01-16
[12:03:20] <amercader> tino097: up for a meeting?

2018-01-15
[07:54:34] <torf> I'm encountering a migrate.exceptions.InvalidRepositoryError during "paster db upgrade". Any ideas where that may come from? The database looks OK
[10:16:59] <Bubo> Anyone made scheming work with harvest?

2018-01-14

2018-01-13

2018-01-12

2018-01-11
[20:11:43] <Dunn_> Hello there, Can you please tell me where to find {PACKAGE-ID} or id of an existing CKAN dataset via ckan interface? Thank you very much for pointing ...

2018-01-10
[08:42:55] <smotornyuk> >>>  after installation and before configuration -> continue with configuration. This table will be created automatically after server restart
[10:55:18] <Bubo> Has anyone of you experimented with streaming responses back to the user? For example for downloads, don't load a file directly in memory but put piece by piece while sending it to the user
[15:22:27] <tktech> Yes, but CKAN in general isn't good for the actual file serving
[15:25:19] <Bubo> tktech: how did you do it
[15:26:04] <Bubo> tktech: what I want to do is, use requests library with stream=True to iterate over chunks of a file and serve it to the user
[15:26:11] <Bubo> so I don't have to load the file in-memory
[15:26:33] <tktech> Yes, in recent versions of CKAN you can yield an iterator instead of the complete body when responding in a controller
[15:26:46] <Bubo> Oh wow
[15:26:56] <Bubo> i've been trying out FileApp/DataApp from paste
[15:27:07] <tktech> I really would suggest using a proper file server tho, if you're serving large files.
[15:27:08] <Bubo> even base.response.body.write
[15:27:27] <tktech> You can use https://github.com/TkTech/ckanext-cloudstorage with https://github.com/minio/minio if you need to host it locally
[15:27:51] <Bubo> tktech: I know, the problem is the client wants the download to come from ckan
[15:27:52] <tktech> And that gives you large upload support, pause/resume, temp-link downloads to oblige authorizations, etc
[15:28:28] <Bubo> The files will be in hdfs
[15:28:31] <tktech> CKAN was built to be the index not the file server itself, it really doesn't do a good job of it :(
[15:28:32] <Bubo> but not accessible to users
[15:28:41] <Bubo> tktech: I agree
[15:29:03] <Bubo> Is that documented somewhere? Yield-ing from a controller
[15:29:17] <tktech> Don't think so I remember reviewing the PR for it relatively recently
[15:30:48] <Bubo> it doesn't seem to work
[15:31:04] <Bubo> tktech: how recent should ckan be?
[15:31:31] <Bubo> 2.7?
[15:32:49] <tktech> Trying to find the PR
[15:33:34] <Bubo> https://github.com/ckan/ckan/pull/3554 ?
[15:35:10] <tktech> Oh, I'm sorry I guess I didn't merge it :|
[15:35:32] <tktech> It should cherry pick onto 2.7 without issue
[15:36:26] <tktech> https://github.com/ckan/ckan/pull/3554/files#diff-d22eccb9d79094f4938e2b44e7fdfc86R30 here is the example for simple file streaming
[15:36:36] <Bubo> I see
[15:37:00] <Bubo> will that be merged into ckan anytime soon?
[15:37:31] <Bubo> I am not sure if I can put this in an extension, instead of changing our ckan code
[15:39:01] <tktech> No, you'd ideally git cherry-pick it onto your ckan rather then mush it into an extension
[15:39:32] <tktech> It's ready for merging IMO, but ask amercader
[18:55:52] <amercader> Bubo, tktech: streaming merged now, thanks smotornyuk
[18:56:07] <Bubo> thanks amercader
[18:56:10] <Bubo> will this land in 2.8?
[18:56:20] <Bubo> will it be backported to 2.7?
[19:00:27] <amercader> 2.8 for sure, we can consider it for 2.7. all seem to agree that it should be fine
[19:00:40] <amercader> So it's very likely
[19:14:03] <Bubo> nice
[19:15:23] <Bubo> should be documented as well, I was trying to search about streaming files for download but didn't come upon this PR
[19:21:12] <srk> could you possibly prioritize removing all the obsolete stuff like PasteScript and even pylons? all this makes packaging quite hard
[19:21:58] <srk> like I couldn't even find pastescript repo, and it requires obsolete egg-info just to load entry points (same as in dist-info..)
[19:22:12] <srk> from pwd /o\
[19:40:36] <srk> just fiy
[19:40:36] <srk> # nasty hack, this piece of crap relies on paster and egg-info
[19:40:37] <srk> mv $out/lib/python2.7/site-packages/*.dist-info $out/lib/python2.7/site-packages/ckan.egg-info
[19:40:40] <srk> echo "Version: master" > $out/lib/python2.7/site-packages/ckan.egg-info/PKG-INFO
[21:35:48] <Dunn_> Hello all, I would like to install ckan extension dashboard on a production server but I can not find an instruction that works for me. My ubuntu is 14.04 and my ckan is ckan-2.7.2 I followed instruction here http://docs.ckan.org/en/ckan-1.4.3/prepare-extensions.html but got stuck at Your new CKAN developer install will be running on http://localhost:5000/ page will not load
[21:36:08] <Dunn_> Can anyone please help pointing me in the right direction, i am so lost .... sorry
[21:37:17] <Dunn_> 3 days working with ckan installation but I still can not get a plugin/extension installed I kindly ask for your help
[21:45:35] <Bubo> Dunn_: that's documentation for ckan 1.4.3
[21:45:49] <Bubo> instructions on how to install an extensions is usually in the extensions README file
[21:45:53] <Bubo> in the github repo
[21:46:08] <Bubo> it's mostly, you clone it and install it with pip and then juts add it to your config file
[21:46:51] <Dunn_> ok
[21:47:14] <Dunn_> <Bubo> i feel so bad
[21:48:12] <Dunn_> and if i want to develop an extension/plugins where is the instruction for 2.7.2 ckan please?
[21:49:02] <Dunn_> can you please point me?
[21:49:59] <Dunn_> this is the latest ? http://docs.ckan.org/en/latest/extensions/tutorial.html#creating-a-new-extension
[21:53:20] <Dunn_> ok i think i found it http://docs.ckan.org/en/ckan-2.7.2/extensions/tutorial.html
[21:55:10] <Dunn_> ok i am back on my way now i think thank you <Bubo>
[21:57:16] <Bubo> np

2018-01-09
[12:02:02] <amercader> wardi, smotornyuk : hello! are you around for meeting?
[12:11:21] <wardi> amercader: I am now is there anyone still there?
[12:11:34] <amercader> we are all here!
[12:11:37] <amercader> come join us
[12:12:11] <amercader> wardi: ^
[14:50:43] <srk> hello
[14:50:57] <srk> any idea if it's possible to tell paster where to look for egg-info?
[14:51:17] <srk> also any plans to deprecate this? I can't even find the repository for PasteScript anymore..
[17:10:20] <Dunn_> hello I am installing ckanext-spatial extension (ubuntu 16) following this instruction http://docs.ckan.org/projects/ckanext-spatial/en/latest/install.html - however, after installation and before configuration I check to see if I got the table name package_extent as suggested in the instruction. But I can not find it any where in my postgres database. Can you please tell me what I should do next?
[17:11:55] <Dunn_> the instruction written for Ubuntu 14.04 i wonder if this can also be applied to Ubuntu 16.04 but since I can not find instruction for Ubuntu 16 anywhere else I tried to work with Ubuntu 14 instruction. Thanks all for any advice.
[17:16:12] <Dunn_> Also do you know the name of the extension that I can use to add to development.ini file under ckan.plugins directive. I have tried the name ckanext_spatial and spatial but none of it accepted by ckan - an error occurs when I restart ckan with paster command.

2018-01-08
[13:12:15] <lucianp_> hi to everyone!
[13:12:44] <lucianp_> doe anyone have experience with customising the metadata schemes in CKAN?
[13:13:20] <lucianp_> *does
[13:43:17] <Bubo> go /vu
[15:22:20] <Bubo> lucianp_: look into ckanext-scheming

2018-01-07

2018-01-06

2018-01-05

2018-01-04
[13:57:36] <wardi> on my way back home tomorrow, but I can join this meeting if there's anyone around
[14:03:37] <tino097> im here

2018-01-03
[12:37:39] <teemu> if an extension provides a translation also present in the global translation file, which one takes precedence? is there any way to control this?
[12:38:27] <teemu> using ITranslation for the extension, for clarification

2018-01-02

2018-01-01

2017-12-31

2017-12-30

2017-12-29

2017-12-28

2017-12-27

2017-12-26
[12:01:00] <tino097> meeting today ?!

2017-12-25
[12:47:01] <tino097> Merry Christmas :)

2017-12-24
[17:14:19] <dev135> Is it possible to have a readonly datastore (asking before setup) ?
[17:16:14] <dev135> I have an existing SQL Server, but I do not wish to move to postgress (the data should be accessed from the sql server). I'm willing to have a very small instance of postgress (just for CKAN to work if it must have it)

2017-12-23

2017-12-22

2017-12-21
[10:16:29] <Bubo> how can I get access to the user session and modify it?
[10:16:34] <Bubo> do I import it from pylons?

2017-12-20

2017-12-19
[18:53:22] <ggcatu> How can I run the testing of ckan against a particular database? Have tried changing test-core.ini but it doesn't work
[18:53:27] <ggcatu> Documentation says " A common error when wanting to run tests against a particular database is to change sqlalchemy.url in test.ini or test-core.ini. The problem is that these are versioned files and people have checked in these by mistake, creating problems for other developers. "
[18:53:40] <ggcatu> But it doesn't say how to solve it

2017-12-18
[11:30:08] <ggcatu> Anyone here? I have a really weird problem, with IValidators plugin, even tho I seem to implement in my plugin, calls to p.PluginImplementations(p.IValidators), return an empty list
[11:47:11] <ggcatu> NVM, was smashing my head and was just the order of the plugins
[11:56:12] <ggcatu> ... no it actually doesn't work,
[12:09:21] <ggcatu> If get_validator gets called at ckan initialization, the cache get's filled before the plugins are loaded, and never try again to check if already has loaded all the plugins, so it just fails
[12:10:08] <ggcatu> Imo, get validator should clear it's cache after all the plugins has been loaded and registered, just in case
[12:10:54] <ggcatu> Also because having to create a plugin and define the same validators over and over in every schema is tedious, so having it at module spacename is easier to re use in every schema

2017-12-17

2017-12-16

2017-12-15
[09:58:10] <Krokop> Hello, could someone take a look on PR https://github.com/ckan/ckan/pull/3956
[11:02:37] <e0ne> amercader: could you please take a loon on the patch above^^ when you have few minutes for it

2017-12-14
[15:07:18] <e0ne> could anybody help me with UI test run, please?
[15:12:22] <e0ne> I'm failed to install  mocha-phantomjs :(
[15:14:30] <Bubo> what is the problem
[15:31:08] <e0ne> Bubo: here is a console output http://paste.openstack.org/show/tX3dWUNThJwsb8FUy55n/
[15:31:49] <e0ne> I tried 'sudo npm install -g mocha-phantomjs@3.5.0' as mentioned as docs and got the same error
[15:35:47] <Bubo> not sure, that's some kind of node/npm error
[15:38:29] <e0ne> yes, it is :(
[15:43:55] <Bubo> upgrade your npm version
[15:44:02] <Bubo> or try the mocha-phantomjs comments on npm
[15:52:56] <e0ne> I've got the latest versions of node and npm
[15:56:20] <Bubo> try the comments on npm or github issues or something
[15:56:32] <Bubo> it's weird that you get a permission issue while using sudo
[15:57:32] <e0ne> it's something with mocha <=> phantomjs dependencies
[15:58:04] <e0ne> looks like phantomjs is phantomjs-prebuilt now
[15:59:42] <e0ne> so I installed phantomjs-prebuilt  and copied to phantomjs
[16:11:59] <e0ne> Bubo: what should be an output of mocha-phantomjs? looks lite it hangs or something like it
[16:12:25] <Bubo> I don't know
[16:12:28] <Bubo> I've never run those tests
[16:13:29] <e0ne> :(
[16:13:35] <e0ne> anyway, thanks for the help
[16:33:34] <e0ne> Bubo: in case, if you're interested: I figured out an issue
[16:33:45] <e0ne> nodejs was too new
[16:33:59] <e0ne> I installed the same, as on CI and everything work well now

2017-12-13

2017-12-12
[10:01:42] <mattfullerton> Just checking back in if any one had any opinions on "saved searches" - core feature or not? Don't see any response in the botme logs but also don't find my message there either :)

2017-12-11

2017-12-10

2017-12-09

2017-12-08
[16:00:27] <obr7> Hi.
[16:00:29] <obr7> I got dcatde running with ckan 2.5.3 and docker-compose, see https://github.com/bor8/ckande-docker. How do I get a test data set loaded there? Does anyone have a sample CKAN from which I can harvest a few sample datasets?
[16:37:44] <Bubo> obr7: beta.ckan.org ?
[18:27:07] <obr7> Bubo: Same prob: Nothing happens: Started: Not yet  Finished: Not yet
[18:46:56] <obr7> gtg

2017-12-07

2017-12-06
[10:49:33] <tktech> I have a day free a week, wonder if I could find someone to sponsor redoing ckanext-cloudstorage
[13:11:09] <mattfullerton> mihi: I came across something recently where the harvesters had seemingly switched from what way they were expecting extras (or possibly, it was never working). Basically there are two ways of specifying the extras: as a list of dicts (probably what you are doing based on your code - each dict has a "key" and "value" key) and as a single dict where each key is the extra name and the value is the extra value. Which way you do
[13:24:16] <mattfullerton> gerbyzation: I have this problem a lot too - I can only advise that modifying the "parent" dataset in the database is safe enough. That being the case, there can't be anything too terrible about allowing the change also with resource_update. Well, one terrible thing I can think of is that datasets can have different types, i.e. schemas, i.e. resource fields, but I suppose you could check for new parent dataset type and then t
[13:24:48] <mattfullerton> Ktpr: If you're still looking for someone, I might be able to help you find someone
[13:26:36] <mattfullerton> So now for my actual reason for re-entering IRC :) - I'm going to implement "saved searches" for a project and was surprised this wasn't on the ideas/roadmap list. My main question for now is whether this is CKAN core material (integrated in the user profile/alerts/activity list system) or not. If the answer is yes, I'll have some other questions.
[13:28:13] <Bubo> What are "saved searches"?
[13:50:23] <mattfullerton> Bubo: Any search result (I'm primarily thinking of faceted searches) would have a "follow" button
[13:51:07] <mattfullerton> The user story is there are a bunch of users who want to be notified when new data becomes available about a certain country

2017-12-05
[10:25:13] <gr8> When harvesting a CSW-service, how do I get CI_Contact? - It is not automatically mapped to a CKAN-field.
[10:25:18] <gr8> example link: http://grepcode.com/file/repo1.maven.org/maven2/org.jvnet.ogc/schemas/1.0.0/csw/2.0.2/profiles/apiso/1.0.0/examples-ISO19139/CSW_PortalU_ServiceInstanz.xml
[10:50:25] <e0ne> amercader: hi. do you have a few minutes to discuss flask-based plugins?
[10:50:59] <amercader> e0ne: hi, I do, but in about 30 min. Does this work?
[10:51:13] <e0ne> amercader: sure, great
[10:51:19] <amercader> cool, thanks
[11:32:18] <amercader> hi e0ne, I'm free now
[11:35:38] <e0ne> so, I'm trying to implement plugin with IBlueprint interface
[11:36:06] <e0ne> the first issue was with the lates release, so I had to switch to master
[11:36:52] <e0ne> and now, I have 2 issues:(
[11:37:45] <e0ne> amercader: 1) ckan doesn't configure jinja loader for flask stack, so my plugin works only with default theme (I use custom plugin with theme)
[11:38:36] <e0ne> amercader: 2) I tried to configure jinja loader for my flask app(blueprint) via dirty hack with IMiddleware and now I've got http://paste.openstack.org/show/628149/
[11:39:42] <e0ne> I can't fix it while my base template has '{% ckan_extends %}' tag
[11:39:57] <amercader> e0ne: I though template loading from extensions was fixed by this https://github.com/ckan/ckan/pull/3860 by smotornyuk
[11:40:01] <e0ne> do you have any ideas what is happening?
[11:40:10] <amercader> Are you running latest master?
[11:40:44] <amercader> that PR was meant to fix exactly this
[11:41:04] <e0ne> I use 1 day old master with this commit
[11:41:31] <amercader> and the problem is that ckan does not detect your template folder?
[11:41:52] <e0ne> only for flask-based extension
[11:42:36] <e0ne> if we use 'old style' extensions (not IBlueprint) everything work well
[11:43:15] <amercader> the registering of the template folder is done outside IBlueprint, we still use toolkit.add_template_directory, like in here: https://github.com/ckan/ckan/blob/master/ckanext/datastore/plugin.py#L75
[11:43:33] <amercader> are you doing this on your plugin?
[11:44:25] <e0ne> sure, I do
[11:45:05] <amercader> is the source code available somewhere?
[11:45:09] <e0ne> I have 2 plugins: the first one is only with base templates with theme, and the second one is my IBlueprint implementations with some plugins
[11:45:14] <e0ne> *some templates
[11:46:25] <e0ne> I can share only this http://paste.openstack.org/show/9euMj3R15vvHIh3E4ukM/ now
[11:46:53] <e0ne> we're in PoC timeframe now and can't share all plugins code:(
[11:48:24] <amercader> if you remove line 20 (blueprint.templates = ) what happens?
[11:49:33] <e0ne> http://paste.openstack.org/show/628149/
[11:50:24] <e0ne> I'm sorry, need to head away. I'll be back in ~1.5-2 hours
[11:51:53] <e0ne> it looks like jinja or flask configuration issue
[11:52:39] <amercader> e0ne: I'm afraid we'd need to investigate this a bit more. The flask migration is a work in progress and we still hadn't worked on IBlueprint extension support. This report is really good, so if you could create an issue in the repo with a summary linking to this snippets that would be great.
[11:53:07] <e0ne> amercader: you can easy reproduce this issue with https://github.com/ckan/ckan/blob/master/ckanext/example_flask_iblueprint/plugin.py
[11:53:40] <e0ne> amercader: just change https://github.com/ckan/ckan/blob/master/ckanext/example_flask_iblueprint/plugin.py#L16 to render_template(u'about_base.html')
[11:54:00] <e0ne> I'll file a bug later today
[11:54:09] <amercader> fantastic, thanks e0ne
[11:54:17] <e0ne> np. thanks for the help
[11:54:59] <e0ne> btw, here is one more flask-related fix https://github.com/ckan/ckanext-pages/pull/72
[11:55:17] <amercader> it would be a while until the Flask work is stabilized, so while it's great that you are working on it and helping identify issues like this, I wouldn't use it in production just yet
[11:56:02] <amercader> cool, I'll try to have a look at that too
[11:56:25] <e0ne> thanks
[14:12:11] <mihi> Hey! We are getting this error, when implementing package_dict (from ISpatialHarvester). Rebooting the system, apache, or redis does not work.
[14:12:13] <mihi> this error: https://github.com/ckan/ckanext-harvest/issues/262
[14:12:45] <mihi> When we remove the lines package_dict['extras'].append(...) - then it will work.
[14:12:49] <mihi> How could we fix that issue?
[14:16:28] <mihi> restarting fetch- and gather_consumer -> does not work

2017-12-04
[16:24:08] <e0ne> hi team. could anybody please help me with flask-based (IBlueprint) extension?
[16:28:13] <e0ne> theming doesn't work for templates inside my flask extension
[21:20:15] <e0ne> hi team. could anybody please help me with flask-based (IBlueprint) extension?
[23:02:47] <e0ne> amercader: hi. are you around?

2017-12-03

2017-12-02

2017-12-01

2017-11-30
[13:48:23] <amercader> smotornyuk, tino097: sorry, can't join today's meeting

2017-11-29
[11:54:34] <Bubo> Would it be possible to stream a response from CKAN?
[11:54:49] <Bubo> example a very large file that you want to stream chunk by chunk
[11:54:53] <Bubo> instead of putting it all in memory
[12:52:06] <gr8> Hi! How is it possible to add CQL to a CSW-harvesting source? - Which format do I need?

2017-11-28
[12:02:21] <tino097> amercader: wardi meeting today ?
[12:03:53] <amercader> tino097: 5 min late
[12:03:56] <amercader> Sorry!
[12:03:58] <tino097> np
[12:26:42] <amercader> https://github.com/ckan/ckan/blob/master/ckan/lib/plugins.py#L156
[12:27:00] <amercader> https://github.com/ckan/ckan/blob/master/ckan/config/routing.py#L318-L319

2017-11-27
[10:25:06] <ggcatu> Umhh also seems like Organization_show, for example for the layout1, show packages that according to the datalabels, you shouldn't be able to see
[18:17:47] <ggcatu> why " featured_group_org  " calls  group_show with ignore_auth True ( ? ) any specific reason ?
[18:18:34] <Bubo> Maybe because it needs all groups
[18:18:52] <Bubo> you don't want featured_group_org to be called with only the user's organization (the one he has access for)
[18:24:28] <ggcatu> That has nothing to do, there is no check in the organizations, anyone can see any organization
[18:24:45] <ggcatu> That ignore_auth True seems to be only used in the package_search
[18:26:42] <ggcatu> in fact, "organization_list" gets called as follow logic.get_action(list_action)({}, {})
[18:29:24] <Bubo> I don't know then
[18:29:36] <Bubo> I know we had a problem with it needing 20sec to finish
[18:29:48] <Bubo> because it queryied each user or dataset independently or something
[18:29:50] <Bubo> some time ago
[18:34:09] <ggcatu> lulz :P
[18:35:02] <Bubo> we had to do include_datasets=False or something similar
[18:40:22] <ggcatu> Maybe @wardi knows since i think he implemented the permission labels, or maybe it has just been always like that and no one has bothered watching

2017-11-26

2017-11-25

2017-11-24
[13:11:19] <ggcatu> Hello guys, on ckan-scheming I saw that there is a way to hide fields in the form, with "form_snippet": null, but it seems like when you update the package, since the fields are not in the form, he marks those fields as deleted
[13:19:50] <Zharktas> ggcatu: you need to use hidden snippets if you want to preserve the values
[13:20:19] <Zharktas> null just does not render anything at all, so they aren't posted to the backend either
[13:41:49] <tktech> I...didn't know that...
[13:41:53] * tktech has some fixes to make
[13:53:18] <ggcatu> Yup but having hidden snippets could mean somenoene could modify those values, so at the end you have to still verify those values weren't changed,
[13:53:46] <ggcatu> I would think the default implementation of saving, is , if the field is not there, don't update it, but not deleting
[14:04:04] <tktech> Yeah, if I were to redo things today for one the API would be REST-ish and atomic updates would be used everywhere
[14:04:25] <tktech> Many, many, many places that currently result in unintuitive clobbering where you think you'll only be updating parts
[14:07:25] <Zharktas> if you want to store the old values and prevent users from ever changing them, you would need to do some validator magic
[14:08:02] <Zharktas> most optional fields are usually using ignore_missing which skips validation and effectily remove them from db
[14:12:30] <ggcatu> Yea that;s what i guessed
[14:12:43] <ggcatu> Just for clarification, validators get called in order?
[14:14:16] <Zharktas> yup
[15:24:10] <Bubo> for extending ckanext-harvest, in the gather stage where you need to return a list of HarvestObject ids, can you return a list of anything?
[16:54:06] <Bubo> Can you override package_search?
[17:01:15] <ggcatu> check http://docs.ckan.org/en/ckan-2.7.2/extensions/plugin-interfaces.html#ckan.plugins.interfaces.IPackageController
[17:01:27] <ggcatu> You can implement, before_search and after_searcgh
[17:02:17] <ggcatu> Also, Is there a way I can call "package_update" as sysadmin, even if the user who executed it is not admin
[17:04:53] <ggcatu> Actually I need a user X witch has nothing to do with org Y, which owns package Z, be able to call 'package_update' on Z
[17:05:07] <ggcatu> org Y owns Z
[17:05:45] <ggcatu> context["user"] = 'admin' seems pretty lame, and context["ignore_auth"]=True, makes validation error jump

2017-11-23
[10:39:47] <sirex> Does CKAN support subgroups? From the API I can assign subgroups, bet in the web UI I can't see the subgroups.
[10:48:59] <Bubo> see the ckanext-hierarchy extension
[10:49:08] <Bubo> the code is there to support it, ckanext-hierarchy implements the frontend
[11:32:21] <sirex> Bubo, thanks for the suggestion. I just tried ckanext-hierarchy, but it only adds hierarchy for organizations, but not to groups. But as I understand, by default CKAN does not support displaying groups as hierarchy.
[11:34:26] <Bubo> you can probably edit the code to make it work for groups
[11:34:40] <Bubo> well, you _can_ do it, we've done it
[14:02:23] <wardi> tino097: meeting?
[14:02:30] <wardi> amercader: ^?
[14:04:07] <tino097> right now
[15:04:40] <jbothma> I'm using ckanext-extractor to get full text search on PDF resources
[15:04:53] <jbothma> It uses celery for background jobs
[15:05:08] <jbothma> It looks like threads don't go away after tasks
[15:05:58] <jbothma> is this a common/known issue? Does it sound like something to take up with the plugin devs or does it make sense to raise here?
[15:07:29] <wardi> jbothma: talk to the plugin dev first, but it could be a celery or core issue
[15:07:45] <jbothma> cool
[15:12:58] <Zharktas> i've noticed the samething with ckanext-qa, but haven't figured out yet why the threads aren't removed
[15:20:24] <tktech> Zharktas: Next time you see it please gdb into it and `bt`
[15:20:36] <tktech> Will tell us right away if it's stuck working on something or just not being cleaned up.
[15:30:29] <Zharktas> tktech: https://pastebin.com/gaHrH5gW
[15:30:43] <Zharktas> no idea what these means, but i would blame celery
[15:51:39] <Zharktas> https://github.com/celery/celery/issues/2429 it's somewhere in celery though
[16:02:46] <Zharktas> actually the blame is on googlenanalytics extesion which causes the hang
[16:44:15] <tktech> Zharktas: ah sorry, I assumed you'd have the gdb-python extensions installed, which I shouldn't have
[16:44:30] <tktech> Zharktas: Install the python extension for gdb and that stack trace will make a lot more sense :)
[16:59:44] <Zharktas> tktech: yup, installed and found out that https://github.com/ckan/ckanext-googleanalytics/blob/803b3f7f81c6682a64e28e8c63cf1c2f30b4293e/ckanext/googleanalytics/controller.py#L83 this line is the culprit :)
[18:07:37] <tktech> Zharktas: Taking a look at that extension it needs quite a bit of work...
[18:08:28] <tktech> Zharktas: you can fix your issue immediately by changing that `put()` to `try: put(data_dict, block=False) except Queue.Full: pass` (psuedo-code)
[18:08:35] <tktech> It's GA, it's allowed to drop events.
[18:14:53] <Zharktas> ga extension should be rewritten, we have fixed bits and pieces of it over the years but it is horrendorous to maintain :p
[19:49:31] <Bubo> +1

2017-11-22
[13:48:29] <gr8> we get some validations error while harvesting; how is it possible to increase the log-output?
[13:48:36] <gr8> or are there any other log-files?

2017-11-21
[12:07:53] <tino097> wardi: no meeting today ?
[17:31:22] <wardi> tino097_: sorry I missed this one!
[17:33:03] <wardi> was no-one else able to attend?
[17:51:27] <tino097> wardi: no problem

2017-11-20
[12:50:48] <jbothma> Hi there
[12:51:07] <jbothma> my package list in groups keep emptying with group_patch and group_update
[12:51:18] <jbothma> is group_patch known to be broken?
[13:01:01] <Bubo> jbothma: are you giving it a list of packages in group_update?
[13:01:24] <Bubo> any *_update will delete everyhing that is not explicitly provided in data_dict
[13:03:03] <jbothma> I believe I was giving it the output of group_get(..., include_datasets=True)
[13:03:24] <jbothma> patch behaving the same is what surprised me though
[13:04:05] <Bubo> patch wouldn't delete anything
[13:04:08] <Bubo> it just updates whatever you give it
[13:16:32] <jbothma> it shouldn't, but unless I'm silly, it does :) here's reproduction steps https://github.com/ckan/ckan/issues/3930
[15:20:41] <Ktpr> Is anyone aware of a good way to get in touch with CKAN developers for hire? I have an existing CKAN site and think it would more appropriate to work one on one with a developer than engage one of firms mentioned at ckan.org and don't
[15:21:21] <Ktpr> want to hire a big firm
[15:48:51] <gr8> if I would like to use the csw-harvester, do I need pycsw or is it just an additional tool?
[15:51:28] <e0ne> hi everybody. is release schedule published anywhere?
[15:51:49] <e0ne> I'm working on CKAN plugin, but it fails with the lates release
[16:02:17] <Bubo> e0ne: check here https://ckan.org/category/releases/
[16:12:52] <e0ne> Bubo: thanks. I as understand, there're only release announcements there
[16:22:54] <Bubo> oh, yes
[16:23:01] <Bubo> I guess the schedule might be in github issues or PRs
[16:23:05] <Bubo> I am not sure
[16:28:54] <gerbyzation> with the resource_patch/update action, is it expected it ignore the package_id?
[16:29:08] <gerbyzation> I'm trying to move a resource to another dataset programatically

2017-11-19

2017-11-18

2017-11-17

2017-11-16
[13:49:56] <amercader> wardi: smotornyuk tino097 can we start 10 Min later today?
[13:52:45] <tino097> its fine by me
[13:52:59] <smotornyuk> No problem
[14:13:56] <wardi> amercader: should we wait for you?
[14:14:34] <amercader> coming now
[14:14:42] <wardi> ok

2017-11-15

2017-11-14
[12:02:04] <wardi> amercader: have time for meeting?
[13:02:37] <gimenezcatu> There's no after_search for groups/orgs right ?
[13:24:45] <wardi> gimenezcatu: there are quite a few methods in IDatasetForm that aren't availble for groups/orgs
[13:26:28] <gimenezcatu> ik, but is there something similar? because I need to filter the organization result, and seems like the only way is actually modifing the function
[13:35:01] <wardi> gimenezcatu: if you tell us exactly what you're trying to do someone here might be able to suggest the best approach
[13:37:41] <gimenezcatu> 2 Things, I first need to create an organization whenever someone creates an account, where that user becomes the admin of the organization.
[13:40:56] <gimenezcatu> My approach, override _save_new on UserController, to call a modified action that is not user_create but a new one
[13:41:55] <gimenezcatu> Umm as for the second thing, is having 2 kind of organization, and needed to to filter them
[13:42:13] <gimenezcatu> What I did was setting a hidden field, but it seems like is better to create 2 organization types
[13:42:57] <gimenezcatu> The thing is I will never want to show any organization of class 2, in the search
[13:43:23] <gimenezcatu> so there shouldnt exist a /organization2
[13:46:21] <gimenezcatu> That's why having the hidden field works, but now i need to make /organization don't show em there
[14:14:42] <wardi> this seems like a strange requirement. why do you want one org per user?
[14:23:01] <gimenezcatu> that's how we need it
[14:33:18] <gimenezcatu> any recommendation ?
[15:06:56] <gimenezcatu> What is the approval_status being used for in ckan, in organizations?
[16:42:39] <wardi> gimenezcatu: what's the reason you need that? A custom IPermissionLabels plugin might let you implement the thing you actually want
[16:43:21] <wardi> can you tell us more about the problem you're solving by having one org per user?
[16:50:25] <gimenezcatu> basically our granularity is organizations, not users, users just inherit everything from the organizations they belong and the rest of the extensions developed work with the organizations
[17:09:34] <wardi> you can make permission decisions based on user + org with IPermissionLabels. Making user-orgs seems strange to me, especially if you want them separated from normal orgs
[17:09:54] <wardi> (users are already separate from normal orgs and won't appear in org searches)
[17:12:11] <gimenezcatu> yea but permissionlabels is kinda new and not so flexible (We also need em for resources), and the rest is already developed
[17:12:17] <wardi> You're free to change or override the controllers and actions to do what you want, of course, but that kind of changes wouldn't be accepted into core
[17:12:53] <gimenezcatu> yea just asking how owuld you do it, if you had to.
[17:13:05] <wardi> per-resource permissions is a pretty deep change
[17:13:45] <gimenezcatu> yup
[17:15:49] <wardi> as I said, I wouldn't try to maintain code that mirrored users in orgs with a new org type :-), but if any of your other changes are generally useful I'd recommend submitting a PR
[17:16:41] <gimenezcatu> yea i've been subimtting pr's @ggcatu
[17:17:04] <wardi> ah nice to see!
[17:18:09] <wardi> if it's helpful to make IGroupForm more like IDatasetForm that's worth doing. It's an occasionally requested feature
[17:29:16] <gimenezcatu> Will think it that would help
[17:29:41] <gimenezcatu> if*

2017-11-13
[04:21:28] <goparklubanic> hi, there. I have one question.
[04:23:13] <goparklubanic> I have ckan server at city level. Run on ubuntu 16.04, ckan version 2.7.0. There are 5 (just for example) ckan server at village level running version 2.7.2 on debian operating system (just for illustration too).
[04:25:17] <goparklubanic> Can I integrated the servers with all the differences ? I want the city level server act as 'aggregate' server. collecting / ressuming data from villages.
[07:13:08] <dcmul> hi all.
[07:19:11] <dcmul> was wondering. How does the community hand compatibility between core and extensions. How do I find out if an extension is compatible with a particular version of core.
[13:06:40] <knud> Hi - a question regarding ckanext-spatial: Can someone advise me on how to formulate a CQL query that says "datasets published since X" using the cql setting that CSWHarvester provides?
[13:09:47] <knud> I'm able to achieve the desired query result via a 'normal' ogc constraint, but that interface is unfortunately not available to CSWHarvester.
[14:55:53] <lucianp> hello everybody!
[14:56:18] <lucianp> can anyone tell me if the error that i receive trying to upload a pdf to DataStore is to handle?
[14:56:46] <lucianp> File "/usr/lib/ckan/default/local/lib/python2.7/site-packages/messytables/pdf.py", line 50, in __init__ raise ImportError("pdftables is not installed") ImportError('pdftables is not installed',)
[15:57:30] <jbothma> does enabling CORS for all domains enable all views or only unprivileged ones?
[15:58:29] <jbothma> I don't want to allow cors for all domains to let the public use the API on any domain, but accidentally allow someone to do bad stuff by sending me a funny link

2017-11-12

2017-11-11

2017-11-10
[14:39:53] <lucianop> hello fellows! I need some help with the installation/config of DataStore on a CKAN-Installation from source
[14:40:26] <lucianop> I made all the config and when I test if DataStore works properlly
[14:41:19] <lucianop> i receive a Json with Server error instead of one without errors.#
[14:41:51] <lucianop> after this testing curl command
[14:41:54] <lucianop> curl -X GET "http://127.0.0.1:5000/api/3/action/datastore_search?resource_id=_table_metadata"
[14:49:06] <amercader> lucianop: any exception on the error stack trace? The one on the terminal running the server
[14:52:32] <lucianop> i'm taking a look..
[15:01:15] <lucianop> WSGI Variables --------------   application: <fanstatic.publisher.Delegator object at 0x7f18ef6df810>   beaker.cache: <beaker.cache.CacheManager object at 0x7f18ef6df750>   beaker.get_session: <bound method SessionMiddleware._get_session of <beaker.middleware.SessionMiddleware object at 0x7f18ef6df690>>   beaker.session: {'_accessed_time': 1510325610.193841, '_creation_time': 1510325610.193841}   ckan.app: 'pylons_app'   fanstatic.nee
[15:06:13] <lucianop> where should i send the exception?
[15:06:18] <amercader> lucianop: before the WSGI Variables section there is a CGI Variables section. Before that is the stack trace with the actual error
[15:06:49] <amercader> can you paste it on https://gist.github.com/ or pastebin.com or similar
[15:16:14] <lucianop> i've pasted it  on https://gist.github.com/
[15:16:58] <lucianop> https://gist.github.com/anonymous/0e24bcb9dfdf331e5e9419cf68d22fb9
[15:24:05] <lucianop> Error - <class 'sqlalchemy.exc.ProgrammingError'>: (ProgrammingError) relation "_table_metadata" does not exist LINE 1: SELECT alias_of FROM "_table_metadata"
[15:24:45] <amercader> lucianop: did you miss this step? http://docs.ckan.org/en/ckan-2.7.2/maintaining/datastore.html#set-permissions
[15:24:46] <lucianop> _table_metadata does not exist?
[15:24:57] <amercader> this table should be created as part of it
[15:25:01] <lucianop> no, i've done it
[15:25:09] <lucianop> ok
[15:25:25] <lucianop> that means that something went wrong there
[15:25:47] <lucianop> i try to make the configuration on a Ubuntu 16.04
[15:26:47] <lucianop> Postgresql 9.5.9
[15:27:02] <lucianop> may that's why
[15:27:29] <lucianop> cd /usr/lib/ckan/default/src/ckan paster --plugin=ckan datastore set-permissions -c /etc/ckan/default/development.ini
[15:27:41] <lucianop> paster --plugin=ckan datastore set-permissions -c /etc/ckan/default/development.ini
[15:28:00] <lucianop> because it's a source installation
[15:28:22] <wardi> that outputs sql you need to send to your datastore db, you did that right?
[15:29:17] <amercader> you need something like `paster --plugin=ckan datastore set-permissions -c /etc/ckan/default/development.ini | sudo -u postgres psql`
[15:29:42] <amercader> or copy and paste the output into `psql` directly
[15:31:40] <lucianop> https://gist.github.com/anonymous/58d136615b64d248ffea5fd2f42be84e
[15:34:12] <lucianop> super
[15:34:34] <amercader> that's right. This needs to be executed by postgres somehow. You can either pipe it ( using `|` as in my example above) or paste it in the psql console
[15:37:05] <lucianop> i love you
[15:37:09] <lucianop> it works
[15:37:18] <lucianop> how should i know
[15:37:28] <lucianop> i red the documentation
[15:37:46] <lucianop> i installed and configured a production version
[15:37:57] <lucianop> and without problem
[15:38:31] <lucianop> but the second part of the command .. | sudo -u postgres psql..
[15:38:39] <lucianop> that was missing
[15:38:59] <lucianop> why? why is the documentation incomplete?
[15:39:25] <amercader> what documentation were you using? on older versions the pipe wasn't needed
[15:40:00] <amercader> sometimes google returns links to older versions of the docs :(
[15:43:09] <lucianop> the documentation for ckan 2.7.2
[15:44:35] <wardi> looks like it's there to me http://docs.ckan.org/en/ckan-2.7.2/maintaining/datastore.html#set-permissions
[15:45:09] <amercader> I see, on the blue Note box about source installs there's only the first half of the command
[15:45:55] <lucianop> exactly
[15:46:14] <lucianop> i tried at a moment some variations of the commend
[15:46:17] <lucianop> command
[15:46:59] <wardi> maybe remove the e.g.?
[15:47:14] <lucianop> smth that shout fullfil the form of the pruduction version
[15:47:56] <lucianop> nope, better rewrite the documentation so that the ones that want to develop to know
[15:48:25] <amercader> https://github.com/ckan/ckan/pull/3916
[15:49:14] <lucianop> i know that most of the installtions are for production but ..
[15:49:27] <lucianop> super Adria, nice job, thanks again
[15:51:21] <amercader> np
[16:01:01] <amercader> wardi: I remember you mentioning one day that you had simplified the rendering code to remove all the pylons cruft in your fork
[16:01:20] <wardi> tktech did that, yes
[16:01:26] <amercader> would that be here https://github.com/open-data/ckan?
[16:01:56] <wardi> should be part of the canada-v2.5 and canada-v2.6 branches
[16:02:04] <amercader> aaah cool
[16:02:37] <wardi> IIRC he just deleted most of the render function
[16:03:12] <amercader> lol compare https://github.com/open-data/ckan/blob/canada-v2.6/ckan/lib/base.py#L88 to https://github.com/open-data/ckan/blob/master/ckan/lib/base.py#L90
[16:03:42] <tktech> The caching in there doesn't work at all, removed that
[16:03:55] <tktech> The 9-levels-of-indirection were silly, removed that
[16:04:06] <tktech> Methods-in-methods have a huge call overhead, removed that
[16:05:08] <amercader> well if you guys have been running it for a while we can obviously simplify core master
[16:05:21] <tktech> 762d5c3879f is a cherry-pick-safe commit
[16:05:22] <amercader> there's a CacheMiddleware that I'm pretty sure can also go
[16:05:30] <amercader> ace, thanks tktech
[16:06:45] <tktech> Ah sorry you'd want to apply aa071b063 first
[16:07:09] <tktech> Which also explicitly enables the jinja bytecode cache and sets the cache size to the "new" Jinja default of 400
[16:07:18] <tktech> The version of Jinja was have the cache_size is only 50
[16:07:32] <tktech> But post-2.8 the default is 400, which is far more reasonable considering the number of individual templates we render
[16:08:03] <amercader> cool
[16:09:05] <amercader> tktech: while I have you here, and feel free to say "I don't know", do you think it would be difficult for flask-babel to support multiple domains?
[16:09:13] <amercader> asking because of https://github.com/ckan/ckan/issues/3905
[16:10:37] <tktech> Uh
[16:11:00] <tktech> https://github.com/python-babel/flask-babel/pull/91
[16:11:14] <tktech> Didn't you do that? :)
[16:12:03] <amercader> no, my PR was dumber and only accepted one domain :|
[16:13:32] <tktech> You can merge domains with the babel helper (Translations().merge())
[16:13:39] <tktech> But isn't what you did enough for what you want?
[16:13:53] <tktech> If you need a different domain just create a new object
[16:14:50] <tktech> There are multiple PRs for working with multiple domains but they were all closed for being years out of date and abandoned
[16:15:14] <amercader> tktech: so another one of these per each extension domain? https://github.com/ckan/ckan/blob/master/ckan/config/middleware/flask_app.py#L145
[16:15:44] <amercader> but not sure how the configuration will work then
[16:16:23] <tktech> Instead of creating it and passing the app you can call `.init_app(app)` at any point to configure it
[16:17:58] <tktech> If you'd like to revive one of the older PRs and update it, like #40, I'd be happy to review it
[16:18:07] <tktech> Just don't have time to work on it myself
[16:18:44] <tktech> #40 would let you use domain(s) on a per-request basis based on the value of `babel_domains` in the flask stack
[16:21:24] <amercader> cool msny thanks tktech , ill investigate the best option

2017-11-09
[14:03:05] <wardi> amercader: time for meeting today?
[14:31:29] <amercader> tktech: not sure if you saw https://github.com/ckan/ckan/issues/3905
[14:31:31] <amercader> Would it be difficult for flask-babel to support multiple domains?
[17:15:56] <dcmul> hi all, I have a small problem. I am using ckan ckan 2.5.3. And I get the errors using ckan-pages module. Specifically when I insert dataview iframes on a page.
[17:15:56] <dcmul> File '/home/dan/ckan/lib/default/src/ckanext-pages/ckanext/pages/controller.py', line 237 in _inject_views_into_page
[17:15:56] <dcmul> package_id = context['resource'].resource_group.package_id
[17:15:56] <dcmul> KeyError: 'resource'
[17:15:56] <dcmul> Has anyone seen this error beofre? Any ideas how to handle it?

2017-11-08
[15:26:03] <shellac> in an extension I'd like to stash something in redis. is there a recommended way to do that in ckan?
[16:05:06] <Bubo> Sure just connect to it and put anything you want there

2017-11-07
[12:03:19] <wardi> amercader: joining the meeting today?
[16:28:54] <gerbyzation> Hi guys. is action.patch.resource_patch supposed to ignore the package_id parameter? Am trying to move a resource to a different package and giving a new package_id in resource_patch seems to have no effect

2017-11-06
[10:33:04] <shellac> simple stupid question time: groups and organizations - what is the difference?
[10:34:14] <shellac> we're using groups for our faculties, but I'm upgrading currently and pondering whether they ought to be organizations
[10:39:26] <Bubo> what is "faculties" exactly
[10:44:05] <shellac> top level academic organisations with a university
[10:44:40] <shellac> you can see ours here: https://data.bris.ac.uk/data/group
[10:45:40] <Bubo> I guess they should be organizations
[10:46:50] <Bubo> Members of an organization can publish new datasets in that organizations
[10:46:58] <Bubo> Members of a group can only take existing datasets and put them inside the group
[10:46:58] <shellac> why do you think that? (I'm interested in the distinction, not questioning it)
[10:47:03] <Bubo> members with enough permissions*
[10:47:19] <shellac> ah, I see. thanks.
[10:47:44] <Bubo> So if you want your users to be able to publish datasets which belong to a faculty, then those users should be admin/editor of the faculty organization
[10:48:00] <Bubo> depends on your needs :)
[10:58:56] <Bubo> hey Zharktas I see you have code commited here https://github.com/6aika/ckanext-rating - are you using this in production?
[11:04:42] <shellac> Bubo: I doubt we'll ever let them do that, but I'd prefer them to be right. it's probably not hard to fix (rash, rash words)
[11:05:48] <Bubo> shellac: then groups should be fine, if you just want to let the users see datasets of a faculty
[11:32:07] <Zharktas> Bubo: you can see it in use here: https://generic-qa.dataportaali.com/data/fi/dataset
[11:32:27] <Zharktas> if you find issues, we would like reports of them :p
[12:32:01] <Bubo> Zharktas: what is the difference between ckan's rating stuff?
[12:33:06] <Zharktas> ckan ratings were buggy and are due to be removed
[12:33:26] <Zharktas> https://github.com/ckan/ckan/issues/2660
[12:37:01] <Bubo> okay
[12:37:02] <Bubo> thanks

2017-11-05

2017-11-04

2017-11-03
[16:46:47] <benjwadams> is the docker-compose.yml setup broken in CKAN's master?  I get the following when attempting to start the ckan container: "standard_init_linux.go:185: exec user process caused "no such file or directory""
[17:13:19] <benjwadams> It looks like the entrypoint is bombing because it's using CR/LF line terminator conventions rather than LF

2017-11-02
[14:02:39] <tino097> amercader: wardi smotornyuk meeting today ?
[14:08:09] <amercader> Aaargh sorry daylight saving time messed up my schedule
[14:09:49] <amercader> I can't join right now but can do at half past if that works
[14:23:31] <wardi> amercader: we just went over the prs and issues, if there's something you'd like to discuss I'm happy to re-join at half past, or we can leave it until Tuesday
[14:34:54] <amercader> wardi: Sorry I couldn't join I messed up with the time change.  I don't have anything to raise, I will check mentions and answer back
[14:35:14] <amercader> tino097: I will check these test failures now
[14:35:29] <tino097> amercader: thanks
[14:36:42] <amercader> wardi: actually when you have a moment can you check https://github.com/ckan/ckanext-scheming/pull/168 and see if it makes sense?
[14:37:00] <amercader> I'll try to finish all other scheming PRs tomorrot
[14:38:59] <wardi> amercader: if we skip a field it will get erased when the user updates the dataset, right?
[14:39:43] <wardi> also "null" is used to prevent fields from being displayed so using "false" for form fields is a bit odd
[14:40:27] <amercader> I think I checked and form_field:null gave the default text snippet but I'll double check
[14:40:56] <wardi> it does because of the firs thing (it would get deleted otherwise)
[14:41:26] <amercader> the field won't get erased if it has the ignore_missing right?
[14:41:35] <wardi> I'm talkin about https://github.com/ckan/ckanext-scheming#display_snippet
[14:42:35] <amercader> ok, I'm talking about this https://github.com/ckan/ckanext-scheming#form_snippet
[14:42:37] <amercader> :)
[14:42:58] <wardi> not sure, but for some reason context['ignore_missing'] is giving me terrible flash backs
[14:43:49] <wardi> yes, the precedent is display_snippet:null
[14:44:02] <wardi> "If null is passed as value in display_snippet, it will remove the field from being displayed at the view page."
[14:44:11] <amercader> ok that makes sense
[14:45:42] <wardi> the validator ignore_missing removes the key when it's not present, so updating would remove it in the db too
[14:47:11] <wardi> we could write a validator that would pull the current value from the db, but I don't think it exists right not
[14:47:14] <wardi> *now
[14:47:46] <amercader> maybe "ignore" would work
[14:48:05] <wardi> no that just removes it unconditionally
[14:50:07] <wardi> we'd need a keep_origial_value or similar that pulled the value out of the package in the context, with special logic for resources, groups and orgs likely
[14:54:56] <amercader> ok, a bit more context. My original issue was that a custom field in resources is getting lost when updating the resource via the UI. This is an internal field that I added and don't want to appear in the form. I added the field to the schema thinking that this would preserve it (regardless of the field appearing or not) but apparently this is a separate issue https://github.com/ckan/ckan/issues/2649
[14:55:30] <amercader> so hiding the field would not help on that front
[14:56:35] <amercader> another potential use case for not displaying it though is to add the field in another snippet as part of a bigger widget
[14:57:00] <wardi> that could work
[14:57:09] <wardi> can you use a hidden input instead for your case?
[14:58:49] <amercader> that sounds good. I'll add a hidden.html snippet :)
[14:59:25] <wardi> probably the simplest fix for now :-)
[22:28:17] <goparklubanic> I have trouble configuring ckan 2.7.2. Installation based on tutorial in http://docs.ckan.org/en/ckan-2.7.2/maintaining/installing/install-from-source.html. The only extension is datastor. The problem is, it always renturn error 500 every time sumit data. The submitted data (example: group, organization) stored in database.
[22:29:12] <Bubo> What is the error from the logs?
[22:29:14] <goparklubanic> here is the output of /var/log/apache2/ckan_default.error.log
[22:29:50] <goparklubanic> the output is in https://github.com/ckan/ckan/issues/3902
[22:31:33] <goparklubanic> when i start the service here is the log output: https://pastebin.com/zTUZRLU0
[22:36:13] <Bubo> Can you try 2.7.4?
[22:37:02] <goparklubanic> shoul I make fresh installation, or can I upgrade it?
[22:37:12] <Bubo> You can upgrade it
[22:37:17] <Bubo> just checkout the ckan-2.7.4 branch
[22:37:27] <Bubo> if you installed it with pip install -e it should just work
[22:37:37] <Bubo> if not, try to pip install it again or python setup.py develop, whatever you did
[22:37:57] <Bubo> I think you just need to checkout the branch and restart apache
[22:38:19] <goparklubanic> Okay. I will try that one.
[23:02:48] <goparklubanic> is there any link to ckan 2.7.4 branch? i can not found it.

2017-11-01
[13:02:57] <tino097> wardi: are the permissions labels available to 2.6 or docs should be fixed ?
[13:05:03] <Zharktas> permission labels aren't in the 2.6 docs ;)
[13:09:15] <tino097> http://docs.ckan.org/en/ckan-2.6.4/extensions/plugin-interfaces.html#ckan.plugins.interfaces.IPermissionLabels
[13:10:19] <tino097> some of our devs are confused by this
[13:12:37] <Zharktas> of course the docs search did not find those
[13:13:48] <Zharktas> but basically patch releases should not contain interface changes
[13:14:02] <Zharktas> so permission labels should be backported to 2.6
[13:14:12] <Zharktas> should not be backported :p
[13:15:16] <tino097> yes, i assumed that but i wasn't sure as the merge was last year and i didnt notice any backport labels to the PR
[13:16:25] <tino097> so asking was more logical than assuming :)
[13:16:57] <Zharktas> but the docs are clearly wrong and I would submit an issue about that
[13:17:45] <tino097> will be done
[13:57:24] <Bubo> Zharktas: do you have any idea why permission labels aren't backported?
[13:57:33] <Bubo> Is it because a lot of changes would be needed?
[14:01:30] <Zharktas> Bubo: well the core team will probably comment too, but the policy is that only bug fixes and security issues are backported, patch releases as 2.6.3 -> 2.6.4 won't get new features
[14:03:51] <Bubo> I see
[14:04:07] <Bubo> I think I'll have to implement the permission labels in an extension than
[14:04:12] <Bubo> /s/than/then
[14:04:17] <Bubo> Should be doable

2017-10-31
[12:03:18] <wardi> amercader: do you have time for meeting?
[12:48:27] <Bubo> Are permission labels backported in 2.6?
[14:42:38] <Bubo> anyone?
[14:42:38] <Bubo> there are docs on permission labels in 2.6.4
[14:42:40] <Bubo> so that should mean it's backported?

2017-10-30
[19:08:44] <travis-ci> ckan/ckan release-v2.5.8 6bbc360 https://travis-ci.org/ckan/ckan/builds/292082053 amercader: The build was canceled.

2017-10-29

2017-10-28

2017-10-27
[08:49:38] <Bubo> how would you extend the ckan solr schema to include custom stuff?
[09:27:38] <amercader> Bubo: just edit the schema.xml file with whatever you need and restart jetty/tomcat
[09:35:27] <Bubo> amercader: I meant something like adding your own stuff, not just datasets fields
[09:36:55] <amercader> Bubo: you can edit the schema.xml in any way you need, as long as you keep the fields that CKAN expects. What do you mean by "your own stuff" exactly?
[09:37:06] <Bubo> amercader: for example private datasets that are shared to individual users, so those users would be able to see them even if they are not in the organization that the dataset belongs to
[09:39:12] <Bubo> I was thinking of overriding package search to include those datasets
[09:39:37] <Bubo> so if a user searches for "x", the result will be all public datasets containing "x" and any shared datasets containing "x"
[09:41:50] <amercader> wardi implemented the permission labels on 2.7 to do exactly these kinds of things: http://docs.ckan.org/en/ckan-2.7.2/extensions/plugin-interfaces.html?#ckan.plugins.interfaces.IPermissionLabels.get_dataset_labels
[09:43:06] <arb> @smotornyuk Thanks for advice. I am just following the docs: install deb package for ckan, activate virtualenv, then pip install for ckanext-spatial. pip fails unless I chown -R /usr/lib/ckan to my username.
[09:43:14] <Bubo> amercader: is this only available in >2.7?
[09:43:50] <Bubo> arb: you should follow the "Install CKAN from source" guide
[09:43:57] <amercader> Bubo: yes
[09:44:13] <amercader> but maybe it's easier to reimplement in an extension
[09:44:34] <Bubo> amercader: are the permissions all in solr or in postgres only?
[09:44:57] <amercader> solr
[09:45:23] <Bubo> nice
[09:45:56] <Bubo> amercader: so I should be able to set a "label" to a specific dataset, and then set the same "label" to the user, so that user will be able to see the dataset? Even if the dataset is private?
[09:54:29] <amercader> I'm not super familiar with how it works internally (wardi can confirm) but essentially you store strings in the index with `get_dataset_labels()` at index time, and you match them against the strings returned by `get_user_dataset_labels()` at query time.
[09:55:50] <amercader> So you would index something like `user_id:<creator user id>` and check against `user_id:<current user id>`
[09:56:07] <amercader> Check https://github.com/ckan/ckan/blob/master/ckanext/example_ipermissionlabels/plugin.py
[09:56:11] <amercader> Bubo: ^
[10:07:37] <Bubo> amercader: I see. Since the permissions for the datasets will come from an external permission management system, at index time I should be able to query the permission management system, see which users have the permission to see the dataset and set the labels for it
[10:08:30] <amercader> sounds great
[10:09:03] <Bubo> amercader: do you know if the labels are multivalued fields in the solr schema?
[10:09:39] <Bubo> I'll check the schema, nvm
[10:09:58] <amercader> https://github.com/ckan/ckan/blob/master/ckan/config/solr/schema.xml#L115
[10:10:03] <amercader> yes
[10:11:24] <Bubo> So a label on the dataset `shared_with:user_1,user_2,user_3` and I would do `shared_with:current_user` to see if the user can see it. Nice
[10:11:37] <Bubo> Now let's see if the clients are using 2.6 or 2.7 and hope for 2.7 :)
[10:12:11] <amercader> Bubo: that sounds like a use case that would be useful to others as well, if you end using it and works fine it would be great if you could do a small blog post describing your approach
[10:12:43] <Bubo> sure, why not
[10:13:13] <amercader> Bubo: remember that this only affects the search. You will probably have to combine it with auth functions as well to prevent editing etc
[10:13:50] <Bubo> That's fine, the requirement is only for viewing the shared datasets
[10:14:06] <Bubo> so the search and existing api actions should be fine
[10:20:38] <Zharktas> Bubo: you still need to modify package_show permissions since permission_labels only affect search
[10:21:26] <Zharktas> for example you can get your shared private datasets to appear in dataset list, but if the user tries to open any private ones, the user will get permission denied
[10:21:31] <Zharktas> or 404
[10:23:07] <Bubo> I see
[10:24:51] <Bubo> Zharktas: any ideas how that would go? Call package_search to check if the datasets comes up and return true for the package show auth func?
[10:25:17] <Zharktas> you can override specific auth functions
[10:26:02] <Bubo> yes, override package_show, I meant the logic to check if the user can see the dataset or not
[10:28:45] <Zharktas> https://github.com/vrk-kpa/api-catalog/blob/master/ckanext/ckanext-apicatalog_routes/ckanext/apicatalog_routes/auth.py
[10:29:37] <Zharktas> we made configurable read only user which can read everything, so we had to override auth package_show to return true with some logic
[10:50:55] <Bubo> thanks
[10:51:13] <Bubo> Zharktas: for my logic I would need to check if the dataset permission label has the current user in it
[10:51:25] <Bubo> is there a way to get the permission label of a dataset? is it in extras or something?
[10:52:52] <Zharktas> permission_labels are stored only in solr
[10:53:28] <Bubo> So like I said before, I will have to do a package_search and see if the dataset comes up for the user and return True if it does
[10:53:37] <Bubo> in the package_show auth func
[10:56:05] <Zharktas> i would just apply the same logic to auth func as in get_user_dataset_labels
[10:56:34] <Zharktas> you have to do both, and you can skip the extra package_search call as you already know which dataset it is
[11:00:38] <Bubo> yes, that makes sense
[11:00:49] <Bubo> but then it's a call to the database, not sure which would be faster
[15:38:26] <benjwadams> I can't get CKAN's docker-compose to run due to a missing dependency on mock.  I modified the Dockerfile to attempt to address this, but it did not work.

2017-10-26
[09:12:17] <acorbi> hi everyone, long time not joining this channel. Hope everyone is doing good!
[09:12:37] <acorbi> I have a quick question regarding upgrading ckan from v2.3 to v2.7
[09:13:21] <acorbi> after the upgrade process, I am getting following error while viewing a previously existing dataset:
[09:13:23] <acorbi> Error - <type 'exceptions.TypeError'>: string indices must be integers
[09:14:12] <acorbi> without getting into deeper details about what could have gone broken with the upgrade, I would like to ask you, how can I get a stacktrace of the error to identify where it is coming from
[09:14:38] <acorbi> so the question would be more like: How can I increase the logging verbosity so I get the stacktrace of such an error?
[09:14:57] <acorbi> in other situations I also get the following error:
[09:15:26] <acorbi> WebApp Error: <type 'exceptions.ValueError'>: invalid literal for int() with base 10: ''
[09:15:42] <acorbi> also without stacktrace, so it is really difficult to debug
[09:25:23] <tktech> You should see a full stack trace in your webserver log (or wherever you're sending stderr)
[09:26:38] <tktech> If not check the value of full_stack in your .ini
[09:26:56] <tktech> Or, run it locally with debug=true and reproduce it.
[09:27:16] <acorbi> trying that, thanks tktech
[09:28:03] <acorbi> full_stack is true
[15:14:52] <arb> Hello. Does anyone know how to install ckanext-spatial?
[15:30:42] <smotornyuk> There are quite detailed docs - http://docs.ckan.org/projects/ckanext-spatial/en/latest/install.html
[15:30:54] <smotornyuk> do you have any particular problem following it?
[15:35:03] <arb> The docs don't work :-( pip install -e git... permission denied on /usr/lib/ckan/default/src/ckanext-spatial
[15:41:06] <arb> 1. when I installed the ubuntu package it created everything owned by root. It seems to work so far. But installing the extension obviously fails. Am I supposed to chown -R everything to the current username? Will that break anything? (I'm not sure what username the servers such as apache run as)
[17:01:55] <smotornyuk> no, you missed one point - everything must be installed inside virtual environment
[17:02:41] <smotornyuk> it is bad practice(not very bad, but you should have reasons for this), to install any python package globally
[17:03:27] <smotornyuk> the best solution is to create venv -> activate it -> install ckan and dependencies -> instal extension
[17:03:42] <smotornyuk> in that case, you shouldn't face any problem
[18:50:57] <thenets> can I force reharvest all sources for testing from Web UI or CLI?

2017-10-25
[14:15:15] <ggcatu> Hello guys
[14:16:32] <ggcatu> I've been working with the scheming plugin, and there seems to be a problem in the current design, in the _make_menu_item
[14:16:38] <ggcatu> function in helpers.py
[14:17:38] <ggcatu> Different types of packages, use the same controller and action, Egg: "package" "search" would be the controller for datasets, and also new datatypes
[14:18:31] <ggcatu> So, if you add a new datatype, it will also be highlighted, since it would also be "active"

2017-10-24
[10:32:27] <teemu> datastore still has lazyjson objects <https://github.com/ckan/ckan/blob/master/ckanext/datastore/backend/postgres.py#L1295> that do not work well with simplejson <https://github.com/ckan/ckan/issues/2681>. is there a known workaround?
[10:42:23] <teemu> okay, replacing it with simplejson.loads seems to work
[11:51:50] <wardi> going to be a few minutes late
[11:58:42] <tino097> ok

2017-10-23
[00:57:52] <thenets> can I use ckan.logic.validators on view template files? Or I need to create helpers?

2017-10-22

2017-10-21
[22:42:05] <summer> hi guys

2017-10-20
[09:48:43] <mattfullerton> amercader: That bug, where the data API button doesnt work (https://github.com/ckan/ckan/issues/3833). Im getting a flash message error now, which is acceptable. But Im seeing another problem that I had had and was hoping would be fixed along with that bug. If we have a fully working CKAN, then click on the data API button, CKAN can no longer find helper functions from extensions. Or at least what I know is:
[09:48:44] <mattfullerton> HelperError: Helper 'scheming_get_dataset_schema' has not been defined.. This only happens after clicking the button and goes away after a restart.
[14:50:04] <tino097> im wondering why the resource views are removed after calling the "package_update" api
[18:16:32] <mattfullerton> tino097: https://github.com/ckan/ckan/issues/3560

2017-10-19
[12:51:22] <andrmos> Hello. I just installed the harvester extension. I can access the "localhost/harvest" endpoint, so far so good. But I cannot run any of the terminal commands from paster. I get the "DistributionNotFound" exception, but it doesnt say what plugin it cannot find. Any suggestions?
[14:03:12] <smotornyuk> Hi, sorry i won't be able to participatie in meeting
[14:16:17] <amercader> so thi, https://github.com/ckan/ckan/issues/3873
[14:17:09] <amercader> I don't think this has much to do with Docker. This line should be removed from setup.cfg https://github.com/ckan/ckan/blob/master/setup.cfg#L6
[14:18:06] <amercader> and the 3872 is a support request. I'll answer to those
[14:18:21] <tino097> i think so, as easy_install is part of setuptools now, right ?
[14:18:31] <tino097> ok

2017-10-18

2017-10-17

2017-10-16
[15:52:54] <gerbyzation> Hey, I've been having a look around, trying to work out what's being worked on and what's on the roadmap. is https://github.com/ckan/ideas-and-roadmap/ still the place for the roadmap, as the last activity on in progress stuff is a few years old?
[17:16:35] <wardi> gerbyzat_: things start there sometimes, when they aren't being worked on yet, but you're right it's not very active
[17:17:13] <wardi> gerbyzat_: our developer meetings are on hangout and open to everyone, you could join us at one of those
[17:18:52] <gerbyzat_> wardi: is there another place to look, or are the dev meetings the best place to get an idea of what's going on?
[17:19:22] <wardi> gerbyzat_: well, the active pull requests on ckan/ckan is a good starting place
[17:20:16] <wardi> the issues marked good for contribution are mostly things people have asked for that aren't the core team's priorities
[17:21:35] <wardi> are you looking to help out in some way or just get an idea of what's coming?
[17:28:27] <gerbyzat_> initially trying to get an idea of what's going on and where things stand. I'm working for a young company aiming to provide easier access to data publishing, based on CKAN, so there's potential to get involved with contributions as well
[17:29:50] <gerbyzat_> wardi: are the meetings still happening on Tuesday 1200 and Thursday 1400?
[17:42:14] <wardi> gerbyzat_: yes, hangout link here https://hack.allmende.io/ckan-meeting
[17:46:30] <gerbyzat_> wardi: great, thanks!

2017-10-15

2017-10-14

2017-10-13

2017-10-12
[14:03:05] <wardi> amercader: have time to join meeting today?
[14:03:17] <amercader> yes sorry running late
[14:03:35] <wardi> cool. we'll wait :-)
[16:42:30] <travis-ci> aptivate/ckan mapaction-dev-2.5.7 37e9ab8 https://travis-ci.org/aptivate/ckan/builds/287137965 Martin Burchell: The build has errored.

2017-10-11
[07:08:45] <ybtsdst> how to set network proxy in ckan?
[11:59:44] <ggcatu> @wardi, what do you think about adding new variables to scheming, to allow people define their own read_template, etc.. in the json?
[12:22:02] <Terabyte> hiu
[12:24:08] <ggcatu> hi
[12:24:57] <Terabyte> Quick question, I want to develop some plugins for CKAN, but I am wondering about what an efficient development environment would be.
[12:25:22] <Terabyte> Does anyone have experience setting up docker for development in ckan?
[14:14:39] <Bubo> it's not that hard to setup postgres and standalone solr and use it for development
[14:14:42] <Bubo> no need for docker
[17:49:04] <wardi> ggcatu: (if you're reading the logs) unfortunately the dataset type isn't passed to the function so we have to use the same template for all types registered
[17:49:46] <wardi> one option is testing inside that template (by overriding it), not so elegant but it would work

2017-10-10
[10:41:55] <ggcatu> Do is there an option where , paster config-tool accepts a new line that is not previously commented? anyone?
[11:21:14] <ggcatu> becuase even config_option_update() checks against a schema, so won;t let me add arbtrary config option
[12:47:04] <ggcatu> config-tool without the -e option does the trick
[12:47:12] <ggcatu> sadly, not documented
[14:54:02] <mk_> Hi there!
[14:54:11] <mk_> there's someone online?

2017-10-09
[10:42:36] <jbothma> Bubo did you ever get datapusher working with gunicorn? https://botbot.me/freenode/ckan/2017-05-17/?msg=85742864&page=1
[10:43:16] <jbothma> When I run it on 8800 I get "Address already in use". When I run it on 8801 it times out according to gunicorn timeout settings over and over
[10:43:50] <Bubo> I think we made it work, but I wasn't involved that much, just asked here
[10:44:25] <jbothma> ok
[11:26:50] <jbothma> hmmm, can't get it working quickly with apache either
[11:27:19] <jbothma> but the fact that it's only loading the last worksheet is also a big limitation
[11:27:59] <jbothma> I'm sure I've seen Excel Online used as a preview of spreadsheets for ckan somewhere - does anyone know where that is?
[11:32:04] <jbothma> aaa I think I found it on data.gov.au
[11:32:10] <amercader> jbothma: maybe https://github.com/jqnatividad/ckanext-officedocs or https://github.com/rossjones/ckanext-gdoc ?
[11:33:05] <jbothma> Thanks @amercader!
[11:33:29] <jbothma> been searching too strictly for "excel online" including quotes
[11:54:22] <teemu> is it normal behavior that private datasets are not visible to other organization members, but only the one that created it?
[11:54:31] <teemu> ckan-2.7.2
[11:54:41] <Bubo> I don't think so
[11:55:09] <teemu> there's at least a couple of projects that function like this after updating to 2.7.x
[11:56:00] <teemu> trying to find the root of this, but package_index seems to put in the correct permission labels and package_search seems to try the cocrrect ones, but there's no results
[11:56:20] <Bubo> could it be a problem with your solr setup?
[11:56:30] <teemu> you can get the peackages by calling package_read directly, so it seems to be some solr issue
[11:56:33] <teemu> yeah
[11:56:54] <teemu> not sure yet what, but I'm not the only one either
[11:57:14] <teemu> haven't tried a vanilla CKAN install yet
[12:08:54] <Bubo> teemu: can you try re-indexing?
[12:09:28] <teemu> did
[12:10:15] <teemu> I can't seem to find the datasets even through solr's admin UI if I specify permission_labels
[12:10:54] <teemu> so my best guess atm is that the permission labels aren't added for some reason, but I added seom debug logging to package_index and at least they're set in pkg_dict that gets indexed
[12:12:59] <teemu> verified that my solr schema includes it too
[12:16:44] <Bubo> teemu: which solr version are you using?
[12:18:08] <teemu> 6.1.0
[12:22:50] <teemu> I'll pick up from here tomorrow, but if anyone has any ideas or related observations please leave them here.
[12:39:14] <Bubo> can you try with a different solr version?
[12:39:21] <Bubo> maybe try 5.5

2017-10-08

2017-10-07

2017-10-06
[06:44:12] <mattfullerton> mxibb: PR is merged now. Routes are handled here: https://github.com/ckan/ckan/blob/master/ckan/lib/plugins.py#L104 (that was also in the PR conversation, but hidden under show outdated). The action happens e.g. here: https://github.com/ckan/ckan/blob/master/ckan/controllers/package.py#L489
[06:44:34] <mattfullerton> p.s. wardi: thanks
[06:51:34] <mattfullerton> amercader: That patch of yours for the flask app - should I submit a PR or will it come in in a commit from you?
[07:18:23] <amercader> PR would be great mattfullerton
[10:01:01] <mattfullerton> amercader: Done. Amusingly (but perhaps not surprisingly) the patch also fixes #3796
[10:44:06] <Bubo> There is a problem with the CORS settings and UWSGI. The response header keys (for CORS) are setup as unicode and UWSGI throws an errors since it expects str
[10:44:35] <Bubo> Gunicorn doesn't have a problem with this since it does str() on all the header keys/values
[10:45:19] <Bubo> is there any specific reason why the header keys/values for CORS headers are set as unicode? It seems other headers are as string
[10:45:50] <amercader> Bubo: you mean these? https://github.com/ckan/ckan/blob/master/ckan/views/__init__.py#L47
[10:46:39] <Bubo> yes
[10:46:39] <amercader> I guess the keys were marked as unicode when we started explicitly marking everything with u'', but it's clear that these should be strings (cc torf )
[10:46:54] <Bubo> we cna create a PR for this if you want
[10:47:00] <Bubo> should be backported too I guess?
[10:47:39] <amercader> yes please that would be great Bubo
[10:48:12] <Bubo> okay, will do it a bit later. Also the logic is not aligned with the documentation
[10:48:31] <Bubo> if you don't have CORS_ALOLW_ALL set to True, the headers are not set for whitelisted domains as well
[10:48:56] <Bubo> there is no way to set whitelisted domains for cors at the moment, you either have all or none
[10:49:05] <Bubo> I can fix that in the PR as well
[10:51:54] <mattfullerton> Is there a bootstrap3-migration expert in here?
[10:53:37] <amercader> tino097, and I'm not sure if Aleksandar or Goce are hanging around too
[10:55:08] <Bubo> I can call Aleksandar, give me a sec
[10:58:25] <Bubo> mattfullerton: klikster is Aleksandar
[10:58:31] <Bubo> you can talk to him about the bootstrap3-migration
[10:58:54] <amercader> thanks Bubo!
[10:59:17] <klikster> hey guys
[11:02:10] <Bubo> amercader: should I create an issue about the CORS settings before creating a PR or is just the PR enough?
[11:04:41] <amercader> In general it helps if commit titles are prepended by the issue number eg [#3245], for which of course you need an issue first. But it's not that important if the context is well described in the PR a PR is enough
[11:05:03] <Bubo> okay
[11:05:34] <mattfullerton> hi klikster
[11:06:06] <mattfullerton> I have a misaligned search icon: https://staging.resourcedata.org/dataset
[11:06:14] <mxibb> Thanks matt!
[11:07:12] <mattfullerton> The quick fix is to remove margin-top: 25px from .search-form .search-input-group .input-group-btn .btn in main.css:8318
[11:07:23] <mattfullerton> BUT. that breaks the organization search bar
[11:07:39] <klikster> @mattfullerton I see that you are using CKAN from master.
[11:08:05] <klikster> Is is the same in vanilla without any modifications from other extensions?
[11:08:50] <mattfullerton> well, vanilla doesnt let me use bootstrap3, as I recently painfully learned
[11:09:22] <mattfullerton> so i guess vanilla would mean no extensions; i could check that
[11:17:26] <Bubo> created the PR here https://github.com/ckan/ckan/pull/3855
[15:17:32] <ggcatu> Do is there an option where , paster config-tool accepts a new line that is not previously commented?

2017-10-05
[03:37:49] <bk_> hey all, any advice on how to go about ordering validation errors to correspond with the order that the fields are displayed on the page? also, wondering how to use field display name in validation errors, rather than a field identifier.
[14:01:50] <amercader> wardi, tino097 smotornyuk : I'm having connection issues, go ahead and I'll catch you
[14:01:57] <wardi> ok

2017-10-04

[09:06:39] <mattfullerton> amercader: (or anyone): Im not getting very far with figuring out why my API has disappeared. There was a similar post on ckan-dev. In addition, I have an almost identical deploy (production site, vs. staging) where the API works, despite having the aforementioned commit which breaks the broken CKAN (i.e. before it the API works again). So it must be some transient/data/config issue. Im managing to get this out of
[09:06:40] <mattfullerton> debugging:
[09:06:42] <mattfullerton> DEBUG [ckan.config.middleware] Route support answers for GET /api/3/action/package_show: [(False, 'flask_app')]
[09:06:43] <mattfullerton> DEBUG [ckan.config.middleware] Serving request via pylons_app app
[09:07:13] <mattfullerton> Which if I understood the commit messages right is wrong, the API controller has moved to flask?
[09:24:56] <developer_1> hi, I need to integrate INSPIRE and CKAN. Do you have knowledge in this area?
[09:56:57] <torf> developer_1: ckanext-spatial might be a good starting point, depending on what you're planning to do: https://github.com/ckan/ckanext-spatial
[09:57:50] <mattfullerton> amercader: (or anyone): These seem to be the only things Flask knows about:
[09:57:54] <mattfullerton> Map([<CKAN_Rule '/hello' (HEAD, OPTIONS, GET) -> hello_world>,
[09:57:55] <mattfullerton> <CKAN_Rule '/hello' (POST, OPTIONS) -> hello_world_post>,
[09:57:55] <mattfullerton> <Rule '/static/<filename>' (HEAD, OPTIONS, GET) -> static>])
[10:07:07] <mattfullerton> And these are the API ones that Pylons knows about:
[10:08:15] <mattfullerton> ... etc ...
[10:09:09] <mattfullerton> In any case the action API is not there
[10:23:31] <mattfullerton> OK in any case a switch from master to the 2.7.2 tag removes the problem, so Im going to give up
[11:22:08] <amercader> mattfullerton: this must be a problem only occurring in master, as 2.7 uses the usual pylons api controller
[11:22:28] <amercader> more specifically,  of the API blueprint registration on startup
[11:22:35] <mattfullerton> yes thats what everything points to
[11:23:01] <amercader> I suppose that when the API 404,s you don't see this line in the log:
[11:23:02] <amercader> 2017-10-04 12:22:35,472 DEBUG [ckan.config.middleware.flask_app] Registered core blueprint: 'api'
[11:24:33] <mattfullerton> dont remember seeing that no
[11:24:35] <amercader> In some circumstances, these lines are not working https://github.com/ckan/ckan/blob/master/ckan/config/middleware/flask_app.py#L358:L359
[11:24:53] <amercader> the tricky thing is finding the circumstances
[11:25:04] <amercader> so can you tell me about your install?
[11:26:08] <mattfullerton> what would you like to know? :) We normally have a bunch of extensions, but I also tested with them all off. CKAN is running inside Docker, behind apache and nginx
[11:26:54] <amercader> are the docker files you are using public?
[11:26:59] <mattfullerton> yes
[11:27:03] <mxibb> im trying ckan scheming and I get   " owner_org: An organization must be provided "
[11:27:10] <mxibb> when trying to create a new dataset
[11:27:19] <mxibb> any idea?
[11:27:26] <amercader> mattfullerton: I'm interested in the steps to install the ckan package
[11:27:36] <Zharktas> mxibb: depending on your config, all datasets might need an organization
[11:27:36] <mattfullerton> https://github.com/derilinx/ckan-docker-public/blob/nrgi/Dockerfile
[11:28:20] <Zharktas> mxibb: http://docs.ckan.org/en/ckan-2.7.2/maintaining/configuration.html#ckan-auth-create-unowned-dataset
[11:28:31] <mattfullerton> amercader: https://github.com/derilinx/ckan-docker-public/blob/nrgi/Dockerfile#L41
[11:32:48] <mxibb> Thanks zharktas
[11:37:49] <mattfullerton> on a side note, do the optionsckan.base_public_folder = public
[11:37:49] <mattfullerton> ckan.base_templates_folder = templates
[11:38:02] <mattfullerton> on a ckan 2.7 actually tell it to use bootstrap 3?
[11:38:40] <mattfullerton> thats what the docu implies, but Ive gone from master (bs3 by default) to 2.7 (still bs2) and need bs3 back
[11:42:15] <amercader> these are not used in 2.7
[11:42:28] <amercader> or shouldn't be used
[11:49:40] <Zharktas> 2.7 does not have bs3 templates
[11:53:49] <amercader> mattfullerton: when you have moment could you apply this patch to the CKAN version that returns 404 for the API and see if it helps? https://gist.github.com/amercader/bbc8223e1f098e05005691a31b6fa7a0
[12:06:28] <mxibb> Is there any way to edit the form html in ckan scheming? Not the components snippets , but the whole form, so I can modify other pieces that make references to "dataset"
[12:16:35] <mxibb> Like, modify the stages
[12:18:23] <mxibb> And the left content
[12:18:30] <mxibb> but only while creating this new dataset type
[12:38:58] <mxibb> edit the new_template() path
[12:41:22] <mxibb> and search_template()
[12:42:54] <mattfullerton> amercader: will try now (feel like Im returning to some cursed place though ;-))
[12:47:43] <mxibb> Also If i want to generate a new dataset type, ex : /app, what is the responisble controller for that? How can I url_for this new datatype
[12:55:09] <mxibb> Argthhh, even all the edit operations and reading get redirected to /dataset instead of your own set data type
[12:59:44] <mattfullerton> mxibb: I dont have a lot of time to help right now, but I can help. You can read through https://github.com/ckan/ckan/pull/3643 for some insights, I think it shows you how to do that url_for
[13:00:08] <mattfullerton> I havent worked on redirections in that PR. Basically the support in the CKAN UI for extra types is not 100% yet
[13:00:37] <mattfullerton> amercader: I restored my broken branch and rebuilt but of course, it is working now
[13:00:52] <mattfullerton> Ill see if I can get it back to its previous broken state
[13:04:35] <mattfullerton> amercader: victory. now for your patch
[13:06:45] <mattfullerton> amercader:  :O it works
[13:13:15] <amercader> mattfullerton: great to hear
[13:14:35] <amercader> The current code makes some assumptions about the environment where CKAN is executed,  this makes sure we are targeting the actual views folder
[13:15:44] <mxibb> Thanks matt
[13:17:20] <mattfullerton> amercader: thanks for working on that. I would have hated to be thrown off the cutting edge ;-)
[13:18:25] <amercader> Needless to say do not use master in any production site :)
[13:26:01] <mxibb> Is there any thread or link where I can learn about how ckan handles custom dataset types
[13:26:43] <mattfullerton> amercader: Now CKAN is generating this link for a resource view: /?hostet/eeeee/resource/61c1327a-d327-4c1c-b01e-5e7bf9f145cf/view/3fda1a0d-a2e4-4e5e-b784-66136f4818f2?host= - does that ring any bells?
[13:35:47] <mattfullerton> mxibb: The info is kind of scattered between API docs, IDatasetForm interface docs and ckanext-scheming docs. And if in doubt, package.py (the controller that handles displaying the different types). If you make a list of questions I can try to help.
[13:40:39] <mxibb> Well basically what I want to do, is create a new "Dataset" type (Since this would save me a lot of implementation, creating new controllers, views, etc, to get the same result) which is "App"
[13:40:59] <mxibb> The new datatype path, and strings of course, should be app or application, instead of dataset
[13:41:32] <mxibb> I found some places where I need to change it, but I also see that scheming doesn't allow much customization ("Dataset" is also hardcoded")
[13:42:16] <mxibb> Just found out that package.new , exposes dataset_type in the templates, thanks to your commits, so maybe I can change it
[13:42:55] <mxibb> Would also like to add a new label, for the SLUG, probably would need to expose a new variable to the template through "setup_template_variables" am I right?
[13:44:30] <mxibb> Also, would like to know how Scheming is dinamically changing the .html that needs to be used, Eg. if you go to /dataset you get the new.html template, with the original snippet, and if you go /app , you get new.html template, but the snippet is different
[13:44:39] <mxibb> Haven't been able to get where this happens
[14:01:25] <mattfullerton> amercador: that resource path was a funny side effect of not having the host set
[14:01:39] <mattfullerton> amercader: **
[14:04:12] <mattfullerton> mxibb: well. I would start by merging my PR into your source so you dont have to reimplement. It tries to change strings in lots of places, Im sure some are still missing. Ah, I see what you mean, the new form has dataset written all over it. So yes, that would be good to do.
[14:04:42] <mattfullerton> The as for scheming, well it basically inserts snippets where you tell it to. Ive only played with the display snippets.
[14:20:07] <mxibb> Got it, I think I found everything I need
[14:20:15] <mxibb> Btw, why is your PR not merged?
[14:23:07] <mxibb> And, any idea where the routing for the new datasets is implemented? Where these get created? named_route=dataset_type + '_new'
[15:17:09] <gerbyzation> Hi guys! Anyone around here? Quite new to CKAN and trying a few things with the api. To my surprise I am able to make a request to `/api/3/action/user_create` without an authorization header on which I receive a success response and the result object?
[15:17:31] <gerbyzation> pretty sure that's not normal right?
[15:20:11] <wardi> gerbyzation: depends on your settings, if you can create users through the form it makes sense to be able to do it from the API too, but there are separate settings to enable each if you like
[15:21:25] <gerbyzation> Yes, I had to enable the setting in the config to be able to create users through the api. The creation of users works, my issue/question is that it seems that you don't need to authorise the request to do so
[15:22:25] <wardi> the setting are to allow anon users to register themselves, anon requests need no auth headers, that's right
[15:27:18] <gerbyzation> okay
[15:28:01] <gerbyzation> I'm looking through the settings now, is there a way to change these that only sysadmins can create users through the api?
[15:28:17] <gerbyzation> I can't find any other settings to do wit this than ckan.auth.create_user_via_api
[15:30:30] <gerbyzation> or control who can create new users in general?
[15:30:58] <wardi> huh. I thought that was an anon-specific setting, but it seems to be a non-sysadmin setting
[15:31:17] <wardi> so a sysadmin can still use the api to create users, but not org admins
[15:31:37] <wardi> (or any other existing user)
[15:32:53] <gerbyzation> so even if that ckan.auth.create_user_via_api setting is set to false, a sysadmin can use the api to create users?
[15:32:57] <wardi> would be nice to expand that form just True/False to allow more flexibility. At a minimum we should document the effect of the setting better. PRs welcome of course!
[15:58:42] <gerbyzation> wardi: we're definitely planning on making contributions, but at the moment we're still getting our feet wet
[16:00:38] <wardi> gerbyzation: is it good enough that sysadmins can use the api to create users for your case?
[16:01:23] <gerbyzation> yes, that's exactly our usecase at the moment, we will have a signup outside of ckan that then creates the users through the api
[16:03:58] <wardi> so then ckan.auth.create_user_via_api=false *should* work
[16:06:35] <gerbyzation> wardi: I'm trying to find out, solr is just playing up at the moment
[16:09:18] <gerbyzation> wardi: it's set to false now and works as you said, thanks!
[16:11:47] <gerbyzation> will try to open a PR and add a line to the docs

2017-10-03
[05:21:54] <mattfullerton> amercader: my disappearing API endpoints start with this commit: https://github.com/ckan/ckan/commit/ca0eb5422d9349e84e3f38d1b6a55ddd83c82a8c
[05:22:21] <mattfullerton> Although, as I mentioned yesterday, its particular to this one ckan
[13:08:17] <jbothma> I'm getting ckan running with gunicorn
[13:08:28] <jbothma> we normally runn django stuff with gunicorn + gevent
[13:08:36] <jbothma> is it safe to run ckan with gevent?
[13:16:27] <jbothma> what I've mainly found on this is someone having issues with "wardi objects" with gevent? https://github.com/ckan/ckan/wiki/Dev-Meeting-Notes#meeting-2014-08-07
[13:28:09] <Bubo> jbothma: we were running on gunicorn with gevent but changed to uwsgi
[13:28:15] <Bubo> there were no problems with the gunicorn setup
[13:28:35] <Bubo> And I think that just means that Nigel is having a problem but 'wardi' (a person) objects to it
[13:30:09] <jbothma> hahaha. love the ambiguity of english
[13:30:22] <jbothma> thanks
[13:30:38] <jbothma> why did you switch to uwsgi?
[13:32:40] <Bubo> we had some high cpu usage in certain scenarios and we think it's because of gunicorn
[13:34:21] <jbothma> cool
[13:34:31] <jbothma> ==ok
[13:34:45] <Bubo> you shouldn't have any problems with gunicorn and gevent
[13:35:46] <jbothma> cool - yeah - not an expert but since that's what we're used to, I'll run with it til we see issues
[13:58:40] <nigelb> whatever I had a problem with, the guts of CKAN is so different, it doesn't stand valid anymore :)
[14:23:59] <wardi> gevent is a lot like running multithreaded and historically some of our dependencies aren't thread-safe so you'll run into strange behaviours that aren't easy to reproduce
[14:24:14] * wardi is a person
[14:35:21] <jbothma> mmm that's what I was concerned about. It's one thing in a django site when you have a very good idea about the code in it. It's another when it's a whole bunch of random plugins that add the random features we want in the portal
[14:37:28] <jbothma> gunicorn suggests greenlet when you need things like long polling and turn nginx buffering off - perhaps its best to go with nginx buffering for now and if we really need green threads and have a baseline of behaviour we can see if greenlet introduces anything weird
[14:44:22] <nigelb> wardi: heh, flash back to a long time ago :)
[14:47:24] <jbothma> woops, sorry, I was using greenlet and gevent interchangeably there
[14:47:26] <jbothma> I meant gevent
[16:41:25] <wardi> nigelb: yes it's been ages. how's it going?

2017-10-02
[06:15:39] <mattfullerton> With the bootstrap 3 migration: what is the best approach for extensions? Im preparing a commit for ckanext-pdfview and am confronted with a <div class="span6"> - should I just add both classes (col-md-6 as well) or is there some template if statement I can use to see what templates the host ckan is using or is there a way to provide both sets of templates (this last one sounds unlikely/difficult)?
[06:19:36] <Zharktas> mattfullerton: config has attribute for which templates to use, something similar could be used in extensions
[06:19:39] <Zharktas> https://github.com/ckan/ckan/blob/724a76b932da0338873a4538b4c5d477087dbebc/doc/maintaining/configuration.rst#ckanbase_public_folder
[06:22:52] <mattfullerton> This sounds like a need for a new helper function in CKAN; I dont see any general one to get config options. I think templates can cope with a missing function?
[06:30:43] <Zharktas> well not in templates no, but i would use it plugin.py itself to decide which templates are offered to browser
[06:30:59] <Zharktas> combining them to single template would be ugly :p
[06:35:03] <mattfullerton> I meant CKAN needs one for extensions in general. I was about to just combine the classes, but I see I have a similar problem with old/new style icon names. So Ill just add two helper functions to the extension  :(
[06:35:17] <mattfullerton> Thanks :)
[06:37:25] <Zharktas> there's more differences between bs 2 and 3 than just class names, many components have their own html too
[06:37:40] <Zharktas> I would not want combine them in single template
[07:17:15] <mattfullerton> Yeah in this case its one class name in one template, anyway, dont fear, Im doing it with helper function. Maybe we can post it somewhere as a backwards compatibility guide for extensions ;-)
[08:48:15] <jbothma> @tktech thanks for the relationship advice (pun intended :)
[10:32:59] <gr8> Hi! How is it possible to search through ckan-action-api "package_search" packages by group-id?
[10:33:06] <gr8> e.g. https://demo.ckan.org/api/3/action/package_search?groups=grupo-l
[10:33:06] <gr8> does not work
[10:36:16] <amercader> gr8: https://demo.ckan.org/api/3/action/package_search?q=groups:grupo-l
[10:42:41] <gr8> Thank you!
[11:04:14] <mattfullerton> This was mentioned somewhere else, but api URLs no longer work on master: https://beta.ckan.org/api/3 https://beta.ckan.org/api/
[11:04:59] <tktech> https://beta.ckan.org/api/3/action/package_search seems to wrok fine?
[11:05:38] <tktech> Oh, you expect to see {'version': 3}
[11:05:49] <mattfullerton> wait a sec
[11:06:52] <mattfullerton> ok, its my own local copy that isnt working. Was this broken at any point in the last few days?
[11:08:39] <mattfullerton> basically I get 404 on any API endpoint
[11:25:25] <Zharktas> mattfullerton: https://github.com/ckan/ckan/issues/3796
[11:25:34] <Zharktas> oh right, your issue :D
[11:25:37] <Zharktas> oh well
[11:26:14] <mattfullerton> :) This problem is worse; the actual endpoints dont work. Though on beta they do. Monday.
[11:26:15] <Zharktas> the api link use to give version number though
[11:27:59] <Zharktas> but we have bunch of ckan 2.7 instances were it no longer works
[11:32:32] <mattfullerton> Maybe I have a bad app setup? https://github.com/ckan/ckan/wiki/Migration-from-Pylons-to-Flask#app-dispatcher-middleware
[11:33:16] <mattfullerton> The Flask docs say the API was moved to Flask (?)
[14:10:26] <torf> The change log for 2.7.0 says "This version does not require a Solr schema upgrade". However its schema.xml has version "2.7", so I think a schema upgrade is required. Should the change log be fixed or am I missing something?
[15:00:11] <ggcatu> Hello guys, what is the way to add a new datatype to ckan?
[15:00:15] <ggcatu> Can't find any documentation
[15:04:47] <ggcatu> And how would I define a schema for it
[15:14:24] <smotornyuk> http://docs.ckan.org/en/ckan-2.7.2/extensions/adding-custom-fields.html - this page explains only how to modify fields, but `package_type()` method here is a key - you just need to return from it list with name of your new package type and then schemas from create/update/show_package_schema will apply to it
[15:14:47] <smotornyuk> or(much easier from my point of view), you can use ckanext-scheming
[15:15:20] <smotornyuk> it already has custom dataset type(something like `camel_photos` :) ) defined in it as example
[15:40:47] <ggcatu> In theory, if I have a new datatype, accessing /new_datatype should return me somethign right?
[15:41:51] <smotornyuk> right. and all links are built in the same way: `/new_datatype/new` will show creation form for package of this type
[15:45:36] <ggcatu> What I did is modifying in the database the datatype to "app"
[15:45:51] <ggcatu> but /app would just return me resource not found
[15:52:26] <ggcatu> Oh think I got it
[15:58:38] <ggcatu> Thanks tho
[15:59:11] <ggcatu> Last thing, I just choose a random dataset I have and updated the datatype to "app", but is not showed in the search
[15:59:23] <ggcatu> Ahh maybe need to refresh the solar indexing?
[16:00:33] <ggcatu> Yes, that was it
[16:00:38] <ggcatu> <3 love you
[17:56:23] <m1h> Anyone here? I have got a question regarding the table package_extra.

2017-10-01
[10:29:05] <jbothma> it looks like I can't update individual fields of a package on their own via the API
[10:29:24] <jbothma> if I don't set the resources field, the resources disappear, is that expected?
[10:30:19] <jbothma> ah, RTFM; "It is recommended to call ckan.logic.action.get.package_show(), make the desired changes to the result, and then call package_update() with it."
[10:30:27] <jbothma> alright
[10:32:49] <jbothma> it's interesting that the dataset loses its resources but not its license or name, when those things aren't specified in an update call
[10:32:53] <jbothma> why is that?

2017-09-30

2017-09-29
[18:23:21] <jrods> im trying to run ckan on master, but the API returns 404
[18:23:41] <jrods> anyone else running into this problem?

2017-09-28
[06:48:55] <teemu> jsut a heads up, I needed to delete all my cookies to demo.ckan.org to not get a "Bad Gateway" error
[06:49:24] <teemu> so others may be running into this as well
[08:48:52] <jbothma> out of curiosity, why does datapusher run separately from ckan and use a web api rather than just using jobs?
[08:54:28] <Zharktas> datapusher might be running on different machine with different database
[09:06:13] <jbothma> aaaaah cool
[09:06:17] <jbothma> makes sense
[09:17:22] <jbothma> is there a common way to host different periodic versions of the same dataset and support navigation between them?
[09:17:59] <jbothma> I'd like people to be able to fliter by financial yer, and when they're viewing one financial year, they should easily jump to the next/previous
[09:19:22] <jbothma> I'm thinking of using a custom tag vocabulary for the first case, and the similar datasets plugin to find the other years of the same dataset
[09:19:35] <jbothma> is there a better/common way?
[09:20:02] <Bubo> custom tag vocab would work for that
[09:23:38] <jbothma> cool
[10:50:13] <mattfullerton> I was thinking of doing this by just adding a date field to resources; basically makes a one resource type per dataset assumption, but that is quite common. If the dataset page finds resources with dates it will group together.
[12:20:07] <jbothma> that sounds like it's worth looking at, thanks @mattfullerton
[12:35:10] <Bubo> or you can use relationships ?
[12:36:23] <Bubo> dataset relationships
[13:27:23] <jbothma> based on the types at https://github.com/ckan/ckan/wiki/Dataset-relationships, does this cover the "related datasets" use case or the "find the next and previous year" case?
[13:28:48] <jbothma> and how would you do it? it seems similar to https://github.com/ckan/ckan/wiki/Dataset-relationships#use-cases
[13:29:03] <jbothma> can you then use relationships in templates?
[13:29:38] <jbothma> or do you need to write a plugin that makes things available to the template based on the relationships?
[14:03:21] <wardi> amercader: meeting today?
[14:03:46] <wardi> jbothma: you need to write a plugin that exposes the relationships, yes, it's not part of core
[14:04:08] <amercader> wardi: argh, sorry can't make it but forgot to mention it
[14:04:25] <amercader> let me know here or on issues if I need to do something
[14:06:41] <jbothma> thanks!
[20:37:04] <tktech> The relationships are available on the package object in the template, you just need a custom snippet to display them how you want.
[20:39:35] <tktech> jbothma: A hint, when you create a relationship you can provide a comment.
[20:39:58] <tktech> jbothma: I store a JSON blob in this comment field that contains everything I need to display it later, to save on potential lookups.
[20:42:47] <tktech> For example this is what one comment looks like https://gist.github.com/TkTech/c1dd8125b2e6c9249521bb27feb1f640
[20:44:51] <tktech> Which the templates then turn into https://i.imglnx.com/Vd6jYv.png
[20:45:18] <tktech> Pretty easy to turn "Related Datasets" into "Other Versions"

2017-09-27
[00:03:29] <Bubo> srk: you should make a mechanism where you can lock the api call
[00:03:41] <Bubo> so you can synchronize multiple threads on it

2017-09-26
[09:15:12] <mattfullerton> amercader: This got passed on to me: This is to inform you that there is a vulnerability issue identified in CKAN, which affects all CKAN versions since 2.0.
[09:15:12] <mattfullerton> The CKAN Core Team is working on the patch for the versions 2.4, 2.5 and 2.6. The expected release date for the CKAN patch is 27th September, according to the CKAN Core Team. Immediately after the release, Viderum will be doing testing and quality assurance and will update all Viderum hosted portals on Friday, 29th September.
[09:15:48] <mattfullerton> Yet I dont see anything security related in the backports issues; should I take it seriously?
[09:44:40] <torf> mattfullerton: Would you be OK with reviewing a small ckanext-pages PR that fixes issues on Travis? https://github.com/ckan/ckanext-pages/pull/62
[09:45:07] <mattfullerton> torf: certainly
[09:45:17] <torf> Great, thanks!
[09:54:10] <mattfullerton> torf: But as Im only slightly familiar with Travis, can you just tell me how you noticed e.g. a recent run that was supposed to use CKAN 2.5 turned out to use 2.6 instead, i.e in the log of https://travis-ci.org/ckan/ckanext-pages/jobs/279459648 ?
[09:58:05] <torf> I added a special test case that wrote the CKAN version to STDOUT. However, the PR adds a line to the Travis build scripts that explicitly outputs the CKAN version number. For example, in the logs for the test of the PR itself on CKAN 2.4 (https://travis-ci.org/ckan/ckanext-pages/jobs/279879324) you will find (if you expand the log section titled "$ bash bin/travis-build.bash") a line saying "CKAN version: 2.4.8". Overall I'm pretty confident that the PR is
[09:58:06] <torf> correct, but a second set of eyes is usually a good idea :)
[10:00:20] <mattfullerton> Yeah I saw that 2nd bit now. Was just wondering how you detected the actual problem in the first place/what was making it checkout the wrong version.
[10:00:39] <mattfullerton> In any case the new code and Travis output looks good to go; consider it reviewed
[10:00:50] <torf> Thanks!
[10:01:26] <mattfullerton> I assume this is a kind of pre-requisite for https://github.com/ckan/ckanext-pages/issues/58 ?
[10:02:27] <torf> Yes, I first want to update the tests to cover the issue, but that won't work for a 2.5-specific problem if the tests run on 2.6 :D
[10:03:13] <mattfullerton> ;-)
[10:03:28] <mattfullerton> Maybe Ill take this opportunity to draw attention to https://github.com/ckan/ckanext-pdfview/pull/26
[10:03:45] <mattfullerton> it needs a review
[10:04:22] <torf> I'll see what I can do ;)
[10:29:43] <torf> mattfullerton: https://github.com/ckan/ckanext-pdfview/pull/26#pullrequestreview-65168812 (note that I don't have write access to ckanext-pdfview, so I won't be able to merge)
[10:32:49] <mattfullerton> torf: thanks; will take another look - Im sure someone will merge it once we have a good review. Regarding versions, maybe I can pinch your travis setup for ckanext-pages?
[10:35:44] <mattfullerton> Though I dont think the current tests will pick up this issue. Old fashioned git checkouts and apache reload might be better.
[10:35:48] <torf> Sure! However, reliably testing UI-changes as those in your PR will probably need some additional setup. On CKAN core we use Mocha for JS tests (see https://github.com/ckan/ckan/blob/93876aaa059a9f9b5eab0a36679593d675b9f0bb/circle.yml), but that's not automatically set up for extensions AFAIK. I'm not sure whether we do "proper" automated UI tests at all.
[10:37:00] <torf> mattfullerton: Probably. I haven't figured out how to manually test on a wide range of CKAN versions myself. Probably I'll set up a dedicated VM for each CKAN version once I find time for it.
[10:37:56] <mattfullerton> Im thinking docker-compose or really just git checkout <ckan branch tag> inside a container
[10:38:50] <torf> mattfullerton: Well, you will need different Solr-schemes and database layouts for many versions, so a simple git checkout probably won't be enough
[10:40:27] <mattfullerton> I was wondering (for the DB) if I would get away with it; i.e. old code can still work with newest DB but not vice-versa. Solr schema also hasnt significantly changed for a while. But yes, my plan might go up in smoke. In which case itll be different docker-compose files which isnt much different from a set of VMs
[12:01:36] <amercader> I'll be 5 min late to the meeting. sorry
[14:35:41] <amercader> smotornyuk, tino097 to avoid clashes, I'll finish off the 2.6 and 2.7 branches myself, just want to have a quick look
[14:36:15] <smotornyuk> ok, thanks
[14:36:51] <amercader> thanks both for your help with this!
[14:36:56] <tino097> ty
[14:56:50] <travis-ci> ckan/ckan ckan-2.4.9 0ffbac3 https://travis-ci.org/ckan/ckan/builds/280001535 amercader: The build has errored.
[14:57:09] <amercader> shut up travis
[20:35:08] <srk> hello guys, I have a concurrency related question :) I have two plugins adding background tasks and both modify package extras. as usual with race conditions, two different plugins doing API calls end both within 100ms and fields end up rewritten. I've tried to modify plugins to use call_action but even that didn't help, had to start celery with only one worker to "fix" this
[20:35:38] <srk> and the question .. is there a way to do this properly?

2017-09-25
[10:24:16] <travis-ci> ckan/ckan release-v2.4.9 6e79db8 https://travis-ci.org/ckan/ckan/builds/279458807 amercader: The build has errored.
[10:25:24] <travis-ci> ckan/ckan release-v2.5.7 52be5b9 https://travis-ci.org/ckan/ckan/builds/279459229 amercader: The build has errored.
[10:38:38] <travis-ci> ckan/ckan travis-2.4.9 6e08231 https://travis-ci.org/ckan/ckan/builds/279462276 amercader: The build has errored.
[14:35:00] <xaraf> hello again
[14:35:22] <xaraf> I'm still fighting with the issue of how resources are loaded

2017-09-24

2017-09-23

2017-09-22
[09:54:48] <torf> What is the usual support time frame for older versions of CKAN? Somebody opened a ticket for ckanext-pages (https://github.com/ckan/ckanext-pages/issues/58), but they're running CKAN 2.5. Personally, I'd only support the current and previous minor releases (i.e. 2.7 and 2.6) but I"m not sure whether there's an offical position on this.
[10:15:40] <tktech> torf, Yeah I wish, sadly there are many, many people on 2.5 that will not upgrade for a long, long time
[10:16:29] <tktech> At least 64 sites that I know of on 2.4 or below
[10:16:38] <tktech> Heck there's a 1.8 site still running
[10:17:00] <tktech> Majority are 2.5 with quite a few on 2.6 now
[10:44:19] <torf> tktech: OK, thanks for the reality check. I'll try and see what I can do for the guy running 2.5
[10:56:36] <amercader> torf: the only official position is with regards to supported releases for security and bug fixes in CKAN core, which is to support the previous three minor releases eg currently 2.7 to 2.4. There is no policy on extensions as it largely depends on the maintainers availability. My take on general use extensions is that they should support as many versions as possible (within reason of course). Using ckantoolkit and
[10:56:36] <amercader> travis to test multiple versions makes this quite easy in general
[10:58:17] <torf> amercader: Yeah, the main issue from my point of view is debugging issues on old CKAN instances -- I currently don't have VMs for all versions of CKAN but perhaps I should start doing that
[13:15:24] <carbowizzy> Hello
[13:16:08] <carbowizzy> I had like to upload url to my CKAN instance through API
[13:16:13] <carbowizzy> with something like this
[13:16:14] <carbowizzy> r = requests.post('http://mysite/api/action/resource_create',  		                      data={'package_id': package['id'], 		                            'name': resource_name, 		                            'description':description, 		                            'format': 'csv', 		                            'url': 'http://example.com/your.data.csv' 		                            }, 		                      headers={'Authorization':
[13:16:51] <carbowizzy> Does anyone live here?
[13:31:20] <amercader> carbowizzy: try adding an extra header: `'Content-type': 'application/json'`
[13:32:30] <carbowizzy> Ok
[13:42:12] <carbowizzy> Same error; Error decoding JSON (Expecting value: line 1 column 1 ...
[13:42:18] <carbowizzy> I guess something is missing
[14:06:00] <xaraf> Hello, I'm still trying to make ckan work in windows
[14:06:38] <xaraf> And today I'm having an issue with load order for scripts, jquery.inherit seems to be imported after activity stream, which requires it.
[14:07:18] <xaraf> I will try to re-create my virtualenv, because I can't think of anything else, but you're welcome to suggest other ideas
[14:09:13] <Bubo> the virtualenv doesnt have anything to do wit hthat
[14:23:11] <xaraf> I know, but yesterday I had a problem that a template file wasn't being found and I made it work by renaming the file to something else and then back
[14:23:50] <xaraf> So esoteric fixes are possible in this context
[17:19:36] <xaraf> :(

2017-09-21
[08:56:04] <mattfullerton> Wanted to check that the call today is 14:00 UTC/15 UK/16 Germany?
[09:01:19] <tino097> mattfullerton: yes
[09:02:05] <mattfullerton> tino097: thanks
[09:02:51] <tino097> np, btw ive added the PR about UI dumps, if you have time please check it
[09:38:39] <mattfullerton> tino097: Ah, its you :-) Thanks lots. Yes, I may get that far today
[09:40:52] <mattfullerton> anyone: dumb question, maybe, but if I have, say 3 extensions, and one overrides a template block completely (no {{ super() }}) and the other two call super() - is there any include order in ckan.ini I can use to have the two that call super() extend the one that overwrites CKANs version completely? Or will it just always blow all the others away?
[09:40:55] <tino097> mattfullerton: np :)
[09:41:57] <mattfullerton> wardi: specific example is that scheming_datasets prevents the recent data dictionary table on resource detail page showing up (which comes from the datastore extension template but calls super() after it does its stuff
[10:29:46] <Zharktas> mattfullerton: by changing the order of plugins you can control the template handling order
[10:30:39] <Zharktas> for example in some of our instances we have replaced some template completely and extensions that assume certain blocks and so own still work as long as the plugin order is correct
[10:30:41] <mattfullerton> I know - just seems like no matter where I put scheming, nothing is able to do super() on it
[10:35:13] <Zharktas> scheming has its own template path
[10:36:51] <Zharktas> since all the templates are on scheming/something, direct ckan_extends can't extend core templates with the same paths
[13:45:07] <mattfullerton> Zharktas: Thatll be the reason then
[13:46:47] <mattfullerton> I hadnt noticed that
[13:47:19] <mattfullerton> can an extension mix that kind of override with others that can be extended with other extensions?
[13:47:29] <mattfullerton> Might just be a good question for the call this afternoon
[20:17:49] <xaraf> hello, anyone here? Bubo ?

2017-09-20
[14:22:56] <xaraf> hello, is people alive here?
[17:09:24] <Bubo> xaraf: we are alive
[17:48:17] <xaraf> Bubo: that's good to hear! I was just making an improvement in fanstatic_resources.py to make it cross-platform... do you think I should try to contribute it to the project?
[17:52:26] <Bubo> sure
[17:53:18] <xaraf> I don't think the fixes have been implemented in the latest version https://github.com/ckan/ckan/blob/master/ckan/lib/fanstatic_resources.py
[17:53:52] <xaraf> but I would have to make a dev environment with the latest version to test the changes, and I don't have time to do that now

2017-09-19
[08:33:26] <amercader> dgmouris: I will DM you
[12:27:16] <ggcatu> Could this information be public @amercader, also interested in it
[12:41:11] <Zharktas> ggcatu: there are probably dozens of instances that are not updated
[12:43:35] <ggcatu> Yea but is there any security vulnerabilities list ?
[16:59:21] <xaraf> hello
[16:59:41] <xaraf> Im trying the completely unrecommended path of installing CKAN on windows
[16:59:57] <xaraf> I have partly succeeded and updated the documentation accordingly: https://github.com/ckan/ckan/wiki/How-to-Install-CKAN-2.5.2-on-Windows-7
[17:00:19] <xaraf> Im currently having problems with fantastic resources and with custom plugins
[17:11:06] <xaraf> I seem to have solved the fantastic issue, I no longer get the errors, by updating the ckan version I'm running
[18:10:39] <xaraf> but I still cant upload data
[18:11:02] <xaraf> I see the URL field in the resource creation screen, but I see no browse button, only a text field
[18:11:22] <xaraf> Can anyone help me? amercader auv benoitc brylie?
[18:12:47] <xaraf> Bubo decay Deiz dgmouris lwm ?
[18:17:03] <xaraf> Maybe it's too late for you? I'll try again at another time
[20:11:57] <xaraf> I made it work, thanks for your help :)
[20:46:00] <danse> I'm running into a bit of an issue in getting the tracking_summary information to display in the dataset template. (CKAN 2.6.3) I've been able to determine that the data isn't present on the c.page.items list that is passed into the template, and that you have to explicitly request tracking info when making an API call manually, but haven't found a way to bridge these two and get the recent views count rendering like you'd find here htt
[20:47:16] <danse> Has anyone run into this problem before? I've also compared the code bases of the data.gov instance with ours and didn't notice any changes specific to this.

2017-09-18
[15:52:47] <ggcatu> Any idea on how should I proceed so that any changes made in the dictionary are reflected on the Activity stream of the org? Can't seem to find any documentation on this?
[15:52:59] <ggcatu> Or how can I add custom logs to the activity stream
[17:55:48] <dgmouris> Hello Kind people of the ckan community
[17:56:29] <dgmouris> I'm a developer for the open government project for the alberta government and we're using ckan
[17:56:59] <dgmouris> I was wondering if there's a place that I could get a list of security vulnerabilities to inform my employer.
[19:06:14] <dgmouris> Anyone?
[20:28:49] <tktech> dgmouris, not entirely sure what you mean. Do you mean past issues?
[21:34:10] <dgmouris> past security issues or patches of those issues would be absolutely wonderful
[21:34:21] <dgmouris> thanks for the response tktech
[21:34:28] <dgmouris> I really do appreciate it.
[21:34:42] <dgmouris> Please let me know if you need me to be more detailed of sorts.

2017-09-17

2017-09-16
[10:57:18] <lolziac> anybody here to help :D

2017-09-15
[14:39:27] <lolziac> Hi everybody, can somebody help me figure out how to use ckanext-scheming ckanext-fluent for translating organization title and description
[14:40:20] <lolziac> I managed successfully to translate dataset title/description, but can not figure out how to do i for organizations
[15:08:43] <travis-ci> aptivate/ckan mapaction-dev-2.5.6 487579f https://travis-ci.org/aptivate/ckan/builds/275932192 Martin Burchell: The build has errored.
[15:32:34] <lolziac> I think I figured out :)
[16:57:12] <torf> Seems like the Travis builds as configured by the extension template are broken: https://github.com/ckan/ckanext-pages/issues/57. Might be a good opportunity to move the extensions to CircleCI like core CKAN.

2017-09-14
[03:45:43] <robertred> Oye

2017-09-13
[13:12:02] <tktech> amercader, for your first extension it's probably the most painless one I've ever used
[13:12:20] <tktech> Easy to setup and easy to add to the templates.

2017-09-12
[07:45:43] <lwm> hey folks, I'm having a real hard time running the tests for ckan core
[07:46:18] <lwm> Has anyone tried running them from inside the contrib/docker container when all services are up?
[07:59:25] <lwm> Ah, I think I figured it out - do you think there would be space in the docs for instructions? I might submit a PR
[08:36:10] <lwm> Nope, still not working :|
[08:45:29] <lwm> If anyone comes along: https://stackoverflow.com/questions/46171820/running-ckan-core-tests
[08:51:54] <amercader> lwm: I'll try and find some time to look into this today. My wild guess would be something related to env vars or how ckan is configured in the docker containers
[08:52:45] <lwm> amercader: that would be seriously appreciated! thanks
[08:53:59] <lwm> Maybe I'll check the CI build and try to spot some mismatch
[10:31:26] <amercader> lwm: https://stackoverflow.com/questions/46171820/running-ckan-core-tests/46174090#46174090
[10:40:54] <lwm> amercader: awesome! Thanks so much for that. I'll submit a PR for sure
[10:41:16] <lwm> will test and mark as correct when I get a chance
[12:01:27] <wardi> amercader: meeting?
[12:20:18] <wardi> amercader: actually I want a proper first-class json field for on of my metadata fields, I just haven't gotten around to it yet :-)
[12:36:44] <amercader> Open Source: wait long enough until someone else does it
[12:36:48] <amercader> :)
[12:38:02] <wardi> as long as you remember to complete step 0: lure enough other developers to help maintain your code
[12:38:57] <wardi> and of course 2: ??? 3: profit!
[12:42:52] <tktech> As long as it doesn't go wrong and you lure users before developers and get stuck with unending support questions for your rainy day project
[12:43:34] <wardi> ^
[13:42:38] <lwm> I doubt a rainy day project would ever get to 17,000 + commits ;)
[15:26:44] <tktech> amercader: For ckanext-spatial the recommended backend is solr, but the default is postgis
[15:26:57] <tktech> The default also doesn't seem to be mentioned as the default anywhere in the setup docs :(
[15:27:10] <tktech> Is there a reason?
[15:32:22] <tktech> Ditching postgis as a setup requirement seems nice
[15:32:35] <amercader> tktech: just backwards comp at the time, but we can definitely make solr the recommended / default one
[15:43:27] <tktech> Cool, one of my clients wants improvements so I'll be working on it over the next month
[15:43:56] <tktech> The main change is to show point clusters on the map for discovery
[15:44:17] <tktech> So instead of just drawing squares and hoping there's stuff there you'll see (500) over Toronto until you zoom in
[15:45:23] <tktech> I'm also creating an extension to port the DPLA timeline widget to CKAN
[15:45:24] <tktech> https://dp.la/timeline
[19:36:38] <amercader> That is fantastic tktech
[19:37:04] <amercader> Ckanext-spatial was my first CKAN extension, and it shows
[19:37:48] <amercader> Decoupling postgis should be very easy. It has been always on the back of my mind but never find time to do it

2017-09-11
[09:34:43] * TOPIC: The Open Source platform for Open Data: ckan.org | *NOT* related to Kerbal Space Program | Meeting info and notes: https://hack.allmende.io/ckan-meeting | This channel is logged https://botbot.me/freenode/ckan/
[12:56:26] <Bubo> I am getting connection refused to http://127.0.0.1:8983/solr/core0/update/?commit=true when trying to run tests
[12:56:35] <Bubo> The url is working when I try it via the browser
[12:56:37] <Bubo> any ideas?
[14:33:58] <amercader> wardi: I'm adding a new `schema` field to resources from my validation extension. This is a JSON object and I really want it to be such as part of the API response, not a string, so it becomes a first-class  object inside resources. I added an `output_validator`that essentially does `json.loads(value)` and it seems to work fine, ie it goes from this: https://i.imgur.com/LaRaNBV.png to this
[14:33:58] <amercader> https://i.imgur.com/wOsx6Tj.png. Obviously then you need to handle the displaying of the field in the UI. To do so I've added a `form_snippet` and `display_snippet` that basically call a helper that does `json.dumps(value)`.
[14:34:01] <amercader> All this wrapped in a preset (currently in my extension)
[14:35:07] <amercader> Can you see any potential issues with this? I need to write test but all manual testing seems to work fine, including editing the resource from the UI and via API (with a JSON object and a serialized string for bacwds compatibility if needed)
[14:35:59] <tino097> here is gist with the errors that we are getting with Bubo https://gist.github.com/tino097/3832415bfba810a6891906c68b486df8
[14:46:58] <amercader> Bubo, tino097: do all solr requests fail or just the update one?
[14:47:14] <tino097> as i can see, just update
[14:48:40] <amercader> and does the update work from the UI (eg if you edit a dataset it gets edited without errors)?
[14:58:09] <Bubo> amercader: yes, this only happends when running tests
[14:58:13] <Bubo> happens*
[14:59:11] <Bubo> I think it's because some validation fails. We had this `factories.Dataset(name="my-dataset")`. If I do `factories.Dataset(name="my-dataset", owner_org="some-org", maintainer="user-name") it works
[15:00:02] <amercader> ??
[15:00:49] <Bubo> factories.Dataset(name="my-dataset") would fail with the solr errors
[15:01:11] <amercader> Here's my wild guess: That "Failed to connect to server" error is something raised by CKAN when Solr is actually returning an error because it can't index a particular field
[15:01:17] <amercader> That doesn't make much sense.
[15:02:12] <amercader> put a break point in "/home/tino097/ckan/lib/local/src/ckan/ckan/lib/search/index.py", line 300 and look at what solr is telling you exactly
[15:03:29] <amercader> mmm, it seems that was actually returned by pysolr, so ignore me
[15:05:54] <Bubo> factories.Dataset(name="my-dataset", owner_org="some-org", maintainer="user-name") doesn't give the solr errors
[15:08:33] <amercader> can you restrict it to one test in particular and paste the whole stack trace, including the test invocation?
[15:08:41] <amercader> I'm curious to know what may cause this
[15:43:42] <tino097> amercader: https://gist.github.com/tino097/3b63c85c8d3822654d14ad327a6b51e2
[15:44:03] <tino097> we are trying to run just one test
[15:49:49] <tino097> amercader: also  https://gist.github.com/tino097/c3e42c0c1d03a6253f26abe5e2f6d2db#file-again-L5
[15:51:09] <tino097> i see  delete is executed before update
[15:52:18] <tino097> but im not sure if its recreated again
[21:54:14] <Bubo> Since moto hijacks requests, it doesn't allow you to call any URLs that are not AWS, SOLR seems to give that error

2017-09-10

2017-09-09
[15:24:33] <_hs710> howdy, anyone around who could answer a noob question about running the tests?
[16:22:11] <_hs710> Yo, anyone awake yet?
[18:22:53] <_hs710> once more just in case...

2017-09-08
[07:52:27] <mattfullerton> ggcatu: Most parts of the plugin are governed by recline itself; you could try playing with a standalone demo first before trying to get that code into the CKAN plugin (possibly
[07:53:31] <mattfullerton> possibly https://github.com/mattfullerton/recline-view-slickgrid-demo or https://github.com/mattfullerton/recline-view-multiview-demo are helpful
[07:55:08] <mattfullerton> wardi: Im trying to create better code for https://github.com/ckan/ckan/pull/3643; but this is what Im getting when trying to call that action with nav_link:
[07:55:15] <mattfullerton> An Exception has been raised for template package/search.html, referer: http://li1665-139.members.linode.com/
[07:55:16] <mattfullerton> ckan          | [Fri Sep 08 07:48:08.002296 2017] [:error] [pid 285:tid 139909415294720] [client 127.0.0.1:42242] There is a broken url being created {'action': u'dataset_search', 'controller': 'package'}, referer: http://li1665-139.members.linode.com/
[07:56:25] <mattfullerton> same for a scheming-based dataset type: There is a broken url being created {'action': u'document_search',
[08:57:14] <mattfullerton> amercader: Ive created that issue on mock module
[09:04:20] <amercader> mattfullerton: perfect, I think I'll rewrite that to not use the tests
[09:05:08] <amercader> mattfullerton: regarding the broken url error, I don't know anything about that PR or the context, but `action` should point to an actual function of the controller
[09:05:14] <amercader> ie it should be `search`
[09:09:35] <mattfullerton> right, but this code creates new actions, according to wardi: https://github.com/ckan/ckan/blob/master/ckan/lib/plugins.py#L100
[09:09:42] <mattfullerton> Or am I misunderstanding him
[09:10:05] <mattfullerton> amercader: ^^^
[09:11:09] <mattfullerton> This is not the only place this ignorance of package type happens; I will probably make a follow-up PR once I figure out how to do it right
[09:12:43] <amercader> yes, but `dataset_search` is the name of the route. If you notice, the action is still `search`: https://github.com/ckan/ckan/blob/master/ckan/lib/plugins.py#L104:L105
[09:13:39] <amercader> maybe `nav_link()` doesn't support named routes, I'm not sure
[09:14:34] <amercader> yes, try `nav_link(named_route='dataset_search')`
[10:57:38] <mattfullerton> amercader: :o that works. Thanks for improving my understanding of routes & actions
[10:58:03] <amercader> no bother
[10:58:52] <amercader> all this might change as we progress with the flask migration, but we'll cross that bridge when we get there
[11:29:59] <mattfullerton> :) merged in latest master and resubmitted, thanks
[11:41:32] <mattfullerton> amercader: Im looking at the clickable titles on dataset listings now - there url_for us used (not link_for or nav_link) - named_route is not working there but instead coming through as an extra url parameter - any ideas?
[11:43:59] <amercader> mattfullerton: use the name directly on url_for, eg `url_for('dataset_search', ...)`
[12:41:17] <wardi> amercader: is the scheming pr complete? you said something about work on resource fields
[12:42:45] <amercader> > If you are happy with this approach I'll update the resource fields.
[12:43:00] <wardi> I'm happy with this approach :-)
[12:43:05] <amercader> cool :)
[12:43:31] <amercader> let's see if I can finish it before end of day today
[13:36:10] <mattfullerton> anercader: thanks, that worked; I added that bit to the PR
[13:37:12] <mattfullerton> * amercader:

2017-09-07
[09:00:08] <ggcatu> Hello guys, Any idea on how should I modify the behaviour of the reclineview plugin?
[09:01:03] <ggcatu> I need to modify SlickGrid onClick behaviour, but haven't been able to hook to the slickgrid instance

2017-09-06

2017-09-05
[12:29:49] <amercader> Sorry my internet died and I can't understand hangouts on my phone
[12:30:39] <wardi> no worries the meeting was pretty much done
[12:30:58] <wardi> I'll make an issue to discuss the materialized view stuff I'm working on
[12:31:40] <amercader> Great
[12:32:25] <wardi> as far as permissions are concerned, running the query can be limited to those users that would be able to run the same datastore_search_sql query and update the resource, so it's just an optimization over pushing the records yourself with the API
[12:34:02] <amercader> can people use datastore_sql_search to UPDATE / INSERT?
[12:34:10] <wardi> no
[12:34:35] <wardi> this is like a SELECT INTO (my datastore resource)
[12:35:20] <amercader> ok, I don't know how materialized views work but it seemed more similar to create a table on db
[12:35:51] <wardi> it's exactly that. just a normal table but it has the query attached for when you want to run it again
[12:36:55] <wardi> would actually be really nice to integrate the preview work somehow to make it easier to work on the query
[12:42:23] <amercader> ok, let's discuss on the issue
[12:53:12] <ggcatu> Hello guys,
[12:53:22] <ggcatu> Anyone who can help me with these 2 questions? https://github.com/ckan/ckan/issues/3801#issuecomment-327162024
[14:38:05] <wardi> ggcatu: IValidators doesn't let you redefine validators, I usually override the schema to use our own validators
[14:38:51] <ggcatu> How do you override schema? I did like logic.schema.member_schema = member_schema_replace
[14:38:59] <ggcatu> But seems like a nasty hack
[14:39:12] <wardi> you can only have one IDatasetForm plugin per dataset type, and only one default
[14:39:23] <wardi> they let you override the schema though
[14:40:48] <wardi> you can use IPackageController to make changes to all datasets though (different endpoints than IDatasetForm but often useful)
[14:41:34] <wardi> for members there's no existing interface I can think of, you might be able to override the actions to get what you need
[14:42:03] <ggcatu> Yea is actually for members only
[14:42:20] <ggcatu> Need to add another validator to member schema
[14:42:31] <wardi> or consider submitting a patch that creates an interface you need
[14:43:13] <wardi> monkey-patching is fine, it's just more expensive to maintain in the long term
[14:44:46] <ggcatu> Yea i see
[14:45:34] <ggcatu> And why is there this limit to only one IDatasetForm plugin per dataset type?
[14:45:59] <ggcatu> What would be wrong with allowing multiple plugins to modify the same datasetform?
[14:46:44] <ggcatu> Dunno if there's a real reason behind, or it was just limited, because yes
[14:47:31] <wardi> I don't know, I suppose some of the methods in IDatasetForm could be chained, and others would be fine as overrides. We'd need to look at each one
[14:49:24] <wardi> there's no simple way to compose the forms and display snippets, so that might be messy
[14:50:09] <ggcatu> I see, so there's currently no "clean way" to have 2 different plugins modifying the same IDatasetForm for the same data type
[14:50:12] <wardi> it could be built as a scheming feature (which is aware of the parts of display and forms)
[14:55:17] <Zharktas> you can modify templates and stuff with different plugins, but the schema and its validation should be in one plugin
[14:56:28] <Zharktas> you can inherit plugin from another one and add only the inherited plugin to ckan config, which allows you to override some of the original functionality
[14:57:24] <wardi> good suggestion
[16:01:37] <ggcatu> thanks, will take that in cosideration :)

2017-09-04
[09:19:47] <amercader> mattfullerton: that might have been caused by something importing test helpers from core, can you create an issue so we can discuss?
[09:20:13] <mattfullerton> amercader: will do

2017-09-03

2017-09-02

2017-09-01
[06:43:37] <mattfullerton> Morning everyone; I had a situation yesterday where import mocks was being called for a simple CKAN initialization and start up; solution was to pip install the dev-requirements.txt, just wondering if anyones aware of something that might have changed to cause that? The command might have been paster make-config.
[13:48:33] <tino097> /msg NickServ identify jassum

2017-08-31

2017-08-30
[09:37:02] <travis-ci> andela/ckan develop ab89c51 https://travis-ci.org/andela/ckan/builds/269904289 amercader: The build has errored.

2017-08-29
[11:48:12] <amercader> wardi, tino097, smotornyuk: sorry for the late notice, but I can't join today's meeting. Will join Thursday for sure
[11:58:47] <tino097> its ok
[17:51:15] <vlad-datosmx> hi!
[17:51:26] <vlad-datosmx> Im from Mxico
[17:51:55] <vlad-datosmx> I'm Developer from DatosMx
[18:09:42] <wardi> hello vlad-datosmx
[18:11:29] <vlad-datosmx> its possible to use Angular/React for FrontEnd?
[18:12:33] <tino097> tried once, but i had issues with repoze
[18:14:06] <wardi> tino097: what was the issue?
[18:14:36] <wardi> it should be possible, the API can be used with a cookie for auth instead of the api key
[18:14:52] <tino097> as i recall, we had the problem with the cookie
[18:15:16] <tino097> sometimes i was gettin ckan sometimes some other name, cant recall right now
[18:17:17] <tino097> so we were unable to use it

2017-08-28
[19:14:02] <jrods> im also having problems with validators in my scheming file, even when i have added `scheming_required`, it fails to return back to the form saying this field cant be empty after submission, this also seems to be a problem in a composite preset with subfields as well
[19:14:08] <jrods> here's my example schema: https://gist.github.com/jrods/34a2f725d392f85cb723a6d8b74f65b8
[19:19:22] <jrods> (ignore the not_empty, i know it's not a scheming validator, was using for testing)

2017-08-27

2017-08-26

2017-08-25
[00:17:07] <danse> Does anyone have an extension/ core dev env setup on mac?
[00:18:26] <danse> I'm coming from a PHP/JS world and would like to be able to properly debug ckan and extensions locally. Just curious how anyone else has done it

2017-08-24
[13:22:28] <bubo> Moving from 2.6 to 2.7, there is an issue with the ckan.lib.base.redirect - it doesn't exist anymore
[13:22:35] <bubo> what is the best way to redirect to external urls
[13:22:45] <bubo> should I just import the redirect from pylons/flask?
[13:48:21] <Zharktas> bubo: https://github.com/6aika/ckanext-cloudstorage/commit/88719322421f179bbed11d2019a465e69bcc5ca3 we did this in our environment
[13:55:55] <bubo> Zharktas: redirect_to doesn't seem to work with external urls
[13:56:28] <Zharktas> I know, I have a pr for that https://github.com/ckan/ckan/pull/3749 :p
[13:56:43] <bubo> so there is no way to redirect to external urls?
[14:00:21] <Zharktas> without hacking the core, ckan currently does not provide function for that, importing routes redirect or flask redirect might help but it's kinda ugly solution
[14:02:04] <wardi> amercader: meeting?
[14:02:46] <amercader> Coming
[14:06:21] <bubo> Zharktas: so the base.redirect was removed completely?
[14:07:29] <Zharktas> as far as i can tell, yes
[14:08:15] <bubo> Zharktas: how does your commit in ckanext-cloudstorage work? did you change ckan core?
[14:11:42] <Zharktas> If the instance is running in some different root_path like http://example.com/data/, redirect function requires a fix which is in the above PR, but it might not be yet mergeable. We have used it in one instance for enabling redirection
[14:18:17] <bubo> there is url_for_static_or_external
[14:18:19] <bubo> need to try it
[20:52:52] <danse> Currently working with the scheming and doi extensions to allow the automatic creation of DOIs upon dataset creation. However, we have to be able to support manual entry of DOIs for existing entries. At the moment, the schema field can't be left blank (allowing automatic DOI creation) without throwing a "unicode is not list-like" error from sql-alchemy. Has anyone experienced something like this before?
[20:55:48] <danse> I've been exploring optional fields but so far no combination of validators has avoided that error
[21:03:14] <wardi> danse: that's odd. is there a "unicode" validator in your list? maybe you can pastebin your schema?
[21:10:47] <danse> I tried a few combinations, one of them including unicode. I'll do that
[21:11:25] <wardi> no, unicode is bad as a validator function (and it might cause the error you quoted)
[21:11:46] <wardi> if your field expects a list in the DB you probably want a validator that makes a list
[21:15:44] <danse> https://pastebin.com/7Sq5jwd2
[21:16:21] <danse> That's something I'll check
[21:17:37] <danse> Though I'm not sure how that would have come to be
[21:18:10] <wardi> there's no validation defined in your schema. Maybe if you post a minimal example that demonstrates your issue
[21:23:14] <danse> My mistake, https://pastebin.com/W4tgf3ye
[21:24:42] <danse> So that's one of the validation configs that I tried, with the rationale being that having it not be required and to be ignored if missing would allow a skip over
[21:25:56] <danse> Also tried it with "scheming_required" preceding the rest of the validators, and with just scheming_required, and with no reuired property and just ignore_missing
[21:26:28] <danse> There isn't much documentation on what ignore_missing actually intends to do
[21:28:22] <wardi> validators are poorly documented, but mostly really simple if you look at the code
[21:29:07] <wardi> ignore_missing stops processing other validators and throws away the "missing" object that is passed when a field isn't included in the data sent
[21:32:37] <danse> So based on the schema, if a form field isn't posted, that's when it's considered "missing"
[21:33:00] <danse> Not when a field is empty
[21:33:38] <wardi> yes, missing and "", None, [] are all different things
[21:35:42] <wardi> ignore_empty treats all those as the same (and ignores them)
[21:37:16] <danse> So if I applied ignore_empty, and submitted a form with no new value, would the effect be the same as not including the field in the schema?
[21:38:50] <danse> Also, is ignore_empty noted anywhere in the docs? I don't recall seeing it. Just ignore_missing, not_empty, and the list of functions that take arguments
[22:00:25] <danse> Hmm, disabling the doi extension seemed to allow an empty field to be submitted, with the validator

2017-08-23
[02:48:42] <danito> hi all!
[02:49:16] <danito> ca va benoit
[02:49:22] <danito> c'est vous ici?

2017-08-22

2017-08-21

2017-08-20

2017-08-19

2017-08-18
[04:36:53] <tktech> Yes it does!
[04:37:12] <tktech> Filtering out ports other than 80 really helped that number, as did removing duplicates.
[04:37:29] <tktech> Although I end up missing sites that are HTTPS only that can eventually be fixed
[04:37:51] <tktech> Lots of these sites that have been left running on 8080 are ancient
[11:28:59] <terchris> Im hunting for a bug in docker ckan installation. Found the first one (CKAN_SOLR_URL env is nort read correct). Next one I suspect is err in query to solr.
[11:29:12] <terchris> The err is like this
[11:29:20] <terchris> SolrError: Failed to connect to server at 'http://localhost:32782/solr/select/?q=%2A%3A%2A&rows=1&wt=json', are you sure that URL is correct? Checking it in a browser might help:
[11:30:07] <terchris> My question is : the ?q looks strange. Does anyone have a correct one I can compare ?
[11:54:28] <tktech> It doesn't look like the query is failing, it just can't find Solr.
[11:54:38] <tktech> Have you made sure it's available on that port and URL?
[12:06:26] <terchris> pls look at my bug report https://github.com/ckan/ckan/issues/3764
[12:07:49] <terchris> I can access http://localhost:32782/solr and use the we interface just fine.
[12:43:48] <bubo> terchris: your solr url will not work with "localhost" since in the container "localhost" is the container itself
[12:44:18] <bubo> Are you running solr in a container as well?
[12:48:39] <terchris> yes. it is running in a container. I just found out that if I insert ckan in the path then I get a response http://localhost:32782/solr/ckan/select/?q=%2A%3A%2A&rows=1&wt=json
[12:49:58] <terchris> bubo: how do I address solr when it is running in a container ?
[13:05:09] <bubo> terchris: do you use docker-compose?
[13:05:24] <bubo> You need to put both ckan and solr containers in the same network in docker
[13:05:29] <bubo> and then use the name of the container
[13:05:32] <bubo> for example
[13:05:42] <bubo> docker run --name solr solr_image
[13:05:53] <bubo> docker run --name solr --network ckan_network solr_image
[13:06:08] <bubo> then from ckan you can do http://solr:port
[13:13:24] <terchris> ahhh. Do you have a sample config file for docker compose ?
[13:14:06] <bubo> should be easy enough
[13:14:14] <bubo> I dont have an example right now

2017-08-17
[13:12:05] <amercader> can't make the meeting today sorry!
[13:37:13] <tktech> Righto
[14:02:42] <wardi> amercader, tktech: dev meeting?
[14:02:58] <tktech> He's out today
[14:04:06] <tktech> wardi, ^
[18:53:32] <tktech> amercader: updated, http://www.tkte.ch/articles/2017-08/ckan-usage
[18:53:52] <tktech> The source CSV is in there as well.
[21:32:28] <bubo> tktech: versions used isn't as bad now
[21:32:30] <bubo> :)

2017-08-16

[03:58:07] <tktech> Found a few CKAN 1 instances in the wild :(
[09:42:46] <thenets> dados.gov.br use CKAN 2.6
[10:37:41] <tktech> Up to date, very nice :)
[10:37:48] <tktech> The serbian data portal is on CKAN v1.8
[10:39:40] <thenets> we're trying to install all plugins we need and then start creating an CI to test and make an stable environment
[10:40:03] <amercader> tktech: really interesting, but I agree that it seems to be incomplete. I'm fairly certain that there must be more CKANs around. This list https://ckan.org/about/instances/ is very outdated and shows almost 150 already so I'm pretty sure that it's at least 200+
[10:40:27] <tktech> I tried using that page for the links and ended up with many dead sites :(
[10:40:29] <amercader> datacatalogs.org and https://opendatainception.io/ have comprehensive lists, perhaps it's easier to check which of those are CKANS
[10:41:00] <tktech> I get 158 CKAN instances looking for both the auth header and the cookie
[10:41:19] <tktech> Of those quite a few have drupal in front of them, so I can't automatically figure out where the API is and they fail
[10:41:19] <thenets> tktech, amercader: we can't create an notifier on CKAN code to send request to an database each month?
[10:41:34] <tktech> Some are pre-CKAN 2.0 so they have no status_show endpoint so those are filtered
[10:42:42] <tktech> The language prefix being set to things like en-lang in a few other places fools it on some more
[10:43:00] <tktech> thenets, sure, a lot of software does so.
[10:43:02] <amercader> thenets: this has been discussed several times. It has obvious benefits, but it also requires some infrastructure to collect and maintain the data. And probably has some privacy implications. But is definitely worth considering.
[10:44:07] <thenets> amercader: I think I can do it as an extension for testing. And I can create and opensource infra based on Docker. I think I can support the infra too
[10:44:12] <amercader> tktech: as for the prevalance of 2.2+ my guess is that is coincided with the explosion of popularity of Open Data in general so a lot of CKAN sites were commissioned but there was no funding or interest in maintaining them further
[10:44:17] <amercader> I could be wrong though
[10:44:21] <thenets> tktech: i didn't know
[10:44:39] <tktech> Even things like homebrew which you probably use phone home each time you use it
[10:44:45] <tktech> (if you're on OS X)
[10:45:06] <tktech> amercader, that was my theory as well, a *lot* of them are very small, niche areas
[10:45:08] <amercader> tktech, thenets: if anything that would be very useful to remind people to upgrade to the latest patch release
[10:45:13] <tktech> Like "The Alberta West Lakes Council"
[10:45:29] <tktech> It's an instance for a couple of lakes and a few towns, their budget is probably 0
[10:47:51] <thenets> tktech, amercader: upgrade CKAN is hard for many organizations. I'm working on a simple way to do it for more than 1 year. Here examples of CKAN instances http://dados.gov.br/harvest each one was installed from different ways
[10:49:13] <tktech> Hm
[10:49:19] <amercader> thenets: yes, upgrading minor versions can be difficult especially when running old versions (eg 2.2 -> 2.7, although of course is definitely worth it)
[10:49:22] <tktech> I can't seem to find a way to go from those links to the actual source
[10:49:50] <tktech> Ah there it is
[10:49:53] <amercader> I'm talking about patch upgrades,eg 2.4.5 -> 2.4.6, which should only take a restart
[10:50:18] <amercader> and can save you *a lot* of trouble later on
[10:51:13] <thenets> tktech: http://prntscr.com/g94wrs http://prntscr.com/g94wxv http://prntscr.com/g94x12
[10:52:05] <tktech> Hm first one I clicked on had an exception but I can't reproduce it
[10:52:50] <Bubo> We have a bunch of 2.6 running.. like 15-20 maybe more
[10:54:19] <tktech> Can you link me one?
[10:54:41] <tktech> Bubo
[10:55:09] <thenets> amercader: yes... One thing I'm trying to do it is created and starter script to check new version and auto update. But I need to create Docker containers specific for it too to avoid problems when users that haven't a lot of knowledge with CKAN is maintaining the server.
[10:55:09] <tktech> amercader, I'm a fan of the more aggressive reminders in wordpress and family
[10:55:26] <tktech> amercader, where if you're logged in as an admin and there's a new patch release it actually yells at you with a flash message
[10:55:32] <thenets> tktech: http://dados.gov.br/harvest/about/instituto-brasileiro-de-informacao-em-ciencia-e-tecnologia
[10:56:10] <amercader> tktech: yes, Discourse also does this. But we need the call home feature to implement this
[10:56:10] <thenets> amercader: *create an starter
[10:56:38] <tktech> thenets, ah see your site is one of the ones that isn't sending the X-API-KEY header
[10:56:47] <tktech> So it doesn't match the filter
[10:57:08] <thenets> tktech: what site? dados.gov.br?
[10:57:44] <tktech> Yeah
[10:58:08] <thenets> amercader, tktech: we can create the updater check like Wordpress checking avaliable versions using GitHub API
[10:58:17] <tktech> I'm guessing apache is miss-configured and isn't forwarding all the headers
[10:58:19] <thenets> tktech: how can I fix it?
[10:58:25] <thenets> ah...
[10:58:27] <Zharktas> tktech: in finland we have https://www.opendata.fi/en which is 2.3 but we are upgrading soonish to 2.7, https://liityntakatalogi.suomi.fi/en_GB/ our api catalog is running 2.6 and is due to upgrade too
[10:58:47] <thenets> tktech: I can work / change the proxy :/
[10:59:00] <Zharktas> and we have bunch of city catalogs about to launch which are at least 2.6
[11:00:23] <tktech> thenets, it's not really a big deal, just means I can't auto discover it :)
[11:00:47] <tktech> amercader, I'll implement a generic service and example in the next few hours
[11:01:11] <thenets> Zharktas: it's good :) and the portal is beautiful
[11:01:40] <thenets> tktech: service for update checker?
[11:04:00] <thenets> amercader: the David Read tell me on mail list to make a PR to add the translation to plugin repo... So I give up the Transifex platform? Each one tell me one different thing ^^'
[11:04:21] <Bubo> tktech: sure
[11:05:13] <tktech> thenets, I was just going to do phone-home service
[11:05:20] <tktech> For tracking versions, extensions, active instances, etc
[11:05:27] <tktech> We can use the github API for updates
[11:06:08] <Bubo> tktech: I pmed you
[11:06:09] <thenets> tktech ah, ok! If you want help, I think I can help you tomorrow
[11:07:33] <tktech> Yours is the same bubo
[11:07:40] <tktech> You're forwarding almost no headers
[11:08:29] <Bubo> So you can't identify it as a ckan instance?
[11:11:09] <tktech> Yeah, I guess it's something we never documented in the install docs
[11:13:19] <Bubo> I guess best way to do is have an extension which sends stats for the instance where it is installed
[11:13:34] <tktech> Yup that's the plan
[11:13:40] <tktech> This was just a personal curiosity thing
[11:18:04] <Bubo> I am thinking if you can use a google search to find more instances
[11:18:10] <Bubo> like searching for "Powered by CKAN"
[11:18:10] <tktech> Oh sure
[11:18:21] <Bubo> and then trying to get to status_show action
[11:18:27] <tktech> Scraping google is a wildly more annoying task than I wanted to do
[11:18:38] <tktech> They're pretty good at blocking you
[11:21:16] <Bubo> "Powered by CKAN" search gives only 79 results which is not a lot.. so it's not going to help a lot
[11:21:24] <Bubo> and some of them are duplicates probably
[11:23:29] <tktech> Lots of people modify their templates and the footer
[11:23:40] <tktech> That's why I originally settled on the header
[11:43:48] <teemu> anyone here know about ckanext-security? where should this import come from? https://github.com/data-govt-nz/ckanext-security/blob/master/ckanext/security/middleware.py#L7
[11:44:01] <teemu> there's no such file at least in the git
[11:45:31] <Bubo> I can see it here https://github.com/data-govt-nz/ckanext-security/blob/master/ckanext/security/cache/clients.py
[11:46:24] <teemu> well now
[11:47:04] <teemu> how is that supposed to work :)
[11:47:17] <Bubo> magic :)
[11:47:31] <Bubo> seems like it the extension isn't finished?
[11:56:04] <teemu> making a PR, it works if the path is fixed
[12:06:34] <tktech> amercader, I've much improved it, found 794 CKAN instances this time around.
[12:06:43] <amercader> woah
[12:07:13] <tino097> nice :)
[12:07:18] <tktech> amercader, I'm looking for fanstatic usage this time then filtering out the few sites other than CKAN that actually use it
[12:07:32] <amercader> looking forward to the versions / num of datasets stats
[12:07:52] <tktech> Yeah I'll publish the CSV this time
[12:07:56] <tktech> I need to refine that previous number
[12:08:00] <tktech> It's 794 - 135
[12:08:12] <tktech> 135 of those results are from port 8080, duplicates of the port 80 one
[12:08:21] <tktech> Because people are running the paster debug server on 8080 with no firewall :|
[12:08:25] <tktech> And then put apache on 80
[12:08:31] <tktech> And forward to the paster debug server
[12:08:33] <tktech> ;_;
[12:10:04] <tktech> Oh god that's why so many of these sites are slow
[12:10:10] <tktech> They can only respond to one request at a time
[12:13:07] <Bubo> haha
[12:17:54] <tktech> amercader, I'm going to send out an email to the domain contact for every site running in debug mode or with 8080 open, thoughts?
[12:18:14] <tktech> amercader, the contact in status_show is almost never set
[12:21:08] <tktech> amercader, for analytics, I'm thinking of defaulting to ON in the INI template (so it would be on by default for newly created sites), but off by default (if set to false or no setting) so people upgrading don't suddenly have it running
[12:21:17] <tktech> This seems like the best option from the privacy concern right?
[12:24:53] <Bubo> defaulting to OFF is probably better from the privacy concern, let people turn it on if they want to
[12:26:35] <tktech> People don't even remember to set the contact email
[12:26:39] <tktech> Or turn off debugging
[12:26:54] <tktech> I'm worried that it'll be so skipped over as to be useless
[12:35:53] <Bubo> probably yes
[13:10:11] <amercader> tktech: > I'm going to send out an email to the domain contact for every site running in debug mode or with 8080 open, thoughts?
[13:10:16] <amercader> yes, please

2017-08-15
[12:04:43] <tino097> wardi: meeting?
[18:01:18] <tktech> amercader: http://www.tkte.ch/articles/2017-08/ckan-usage
[18:01:30] <tktech> 2.2 and 2.2.1 are by far the most widely used CKAN versions still :(
[18:37:34] <Bubo> Why isn't 2.6 there?
[21:27:07] <tino097> yes, there should be more than 15 ckan instances using 2.6

2017-08-14
[00:01:38] <tktech> jrods: what is the name of your new scheming type
[00:01:45] <tktech> jrods: as you defined it in the yaml file
[00:04:21] <tktech> jrods: if you got to http://<your website>/<name of your scheming type>/new do you see the form?

2017-08-13

2017-08-12

2017-08-11

2017-08-10
[13:55:32] <thenets> can I participate the meeting today? I want to talk about translations and ckanext-harvest
[17:05:45] <jrods> im having trouble getting started with ckanext-scheming in my docker env, /api/action/status_show shows the ext is loaded, but when i go to create a new dataset, ckan doesnt use the template from ckanext-scheming, i dont know what im doing wrong, the docs for using ckanext-scheming are non-existent
[17:14:52] <Bubo> did you setup the ckanext.dataset_json or however it was called in the config file?
[17:15:01] <Bubo> Where you point it to the json you want to use
[17:23:56] <jrods> yes, when i run paster scheming show command, it shows the correct schema.json (im using the camel example)
[17:52:51] <jrods> one thing im confused about is if ckanext-scheming works on it's own, or does it only integrate with you'r own plugin?
[17:53:21] <jrods> your*
[17:54:43] <Bubo> Maybe you are overriding the template that ckanext-scheming uses?
[17:55:43] <jrods> i dont know, i only have ckan and scheming_datasets as the only plugin loaded

2017-08-09
[06:52:40] <Zharktas> ckan 2.7 changed redirect helpers, but I can't seem to figure out how should I redirect to external urls. for example cloudstorage redirection urls are malformed to s3
[15:27:07] <thenets> Hi, I checked the Travis and I think the ckanext-harvest test most be updated: https://travis-ci.org/ckan/ckanext-harvest/builds/262050697
[15:27:24] <thenets> should I add it to meeting notes?
[15:28:51] <thenets> *need to be updated
[16:24:04] <Bubo> Does anyone know how get_featured_groups can do 600+ queries in a single page load?
[16:24:38] <Bubo> Opening the homepage does 600+ queries to the database and the problem is in get_featured_groups helper, cProfile shows 4 seconds to execute it
[16:27:08] <thenets> Bubo: I create a cache
[16:28:21] <thenets> Bubo: https://github.com/dadosgovbr/ckanext-dadosabertos/blob/master/ckanext/dadosabertos/helpers/tools.py#L199-L292
[16:31:34] <Bubo> thenets: do you know why get_featured_groups does all these queries?
[16:32:59] <thenets> Bubo: no :/ all those methods are hard to understand for me. When I need more performance I create my own SQL queries with sqlalchemy
[16:33:47] <thenets> I didn't know how to work with Solr and internal methods with advanced filters
[16:34:18] <Bubo> package_search is easy to work with, if you need to work with solr
[16:34:49] <thenets> yes, but some filters didn't work for me. I don't know why
[16:35:30] <Bubo> which ones
[16:35:48] <Bubo> I am going to use pdb to juts go through everything and see what happens
[16:37:03] <thenets> I don't remember. I need to go back to my issues 6 months ago to check.
[16:37:09] <thenets> what is "pdb"?
[16:37:38] <thenets> ah, the debugger
[16:38:04] <thenets> good solution to check all those queries
[16:38:51] <thenets> hey, I'm checking here. I think each query is running for each package
[16:39:08] <thenets> how many packages you have?
[16:39:39] <Bubo> 68
[16:39:42] <Bubo> it's not much
[16:42:49] <Bubo> thenets: Do you know what featured groups actually are?
[16:42:56] <Bubo> Just groups that should show on the homepage?
[16:44:43] <thenets> no. I changed the method for Brazilian internal request
[16:44:59] <thenets> I can check today
[16:45:09] <thenets> and tell you tomorrow, if you want
[16:45:56] <Bubo> sure
[16:46:07] <Bubo> I am not sure what "featured groups" are in CKAn
[16:50:57] <Bubo> I found out what happens
[16:51:43] <Bubo> if include_users:
[16:51:45] <Bubo> result_dict['users'] = user_list_dictize(
[16:51:47] <Bubo> _get_members(context, group, 'users'),
[16:51:49] <Bubo> context)
[16:51:51] <Bubo> this is the problem
[16:51:53] <Bubo> it does a shit ton of queries
[16:55:50] <thenets> Bubo: ok. I added to my backlog. I'll check
[16:56:01] <thenets> xD wow
[16:56:21] <thenets> can you create a pull request with the fix?
[16:57:11] <Bubo> Well, it's not *broken*
[16:57:24] <Bubo> It all depends on what featured_groups are used for
[16:57:32] <Bubo> I am not sure if they need "include_users" to be True
[16:57:40] <Bubo> at least maybe let us control it
[16:57:45] <Bubo> i'll do a pullrequest I guess
[17:01:50] <Bubo> This gets us from 5 seconds to 1.5 seconds of load time, which is fine
[17:02:36] <thenets> Bubo: Hm, maybe it's better create a new method, without users. So you can keep compatibility with older projects
[17:04:05] <thenets> Bubo: if you don't need new content, you can use cached data. The Brazilian portal loaded from 7s to 0.15s with cached data
[17:11:25] <Bubo> I can just create my own helper that does this
[17:11:32] <Bubo> no need for pull request that way
[17:17:39] <thenets> Bubo: perfect. But it's good to advise the main developers about all those queries too. I'll open an issue about it on GitHub
[17:18:27] <thenets> can you tell me what is the file and line with this problem?
[17:25:49] <Bubo> I already told one developer
[17:25:59] <Bubo> just a second
[17:26:43] <Bubo> thenets: https://github.com/ckan/ckan/blob/master/ckan/lib/dictization/model_dictize.py#L436-L439
[17:27:03] <Bubo> it will try to load the users for those groups which does so by querying the users 1 by 1
[17:27:08] <Bubo> which results in a lot of queries
[17:29:01] <thenets> Bubo: thanks
[17:29:25] <Bubo> np
[17:30:26] <thenets> Bubo: if you need someone to test and something like that, send me a private message later
[17:31:29] <Bubo> sure, no problem
[17:31:42] <Bubo> I will probably create a pull request for this
[17:56:14] <thenets> Bubo: ok :) thanks
[18:00:42] <Bubo> thenets: tell me if you create the issue
[18:33:04] <thenets> Bubo: ok

2017-08-08
[00:04:52] <thenets> tino097: it's working! :D I'll create a new PR
[00:04:57] <thenets> Ran 70 tests in 152.418s / OK (SKIP=3)
[00:13:28] <thenets> here again, this is the PR after tests and fixes https://github.com/ckan/ckanext-harvest/pull/295
[13:44:52] <Bubo> Trying to use cProfile to see what takes so much to show the homepage, where can I put cProfile.runctx so I can catch the whole request-response cycle?
[14:26:15] <wardi> You can use `paster profile URL` to generate a profile
[14:50:53] <Bubo> wardi: does that need running ckan?
[14:50:58] <Bubo> because it shows that everything is fast
[14:51:09] <Bubo> while using linesman, we can see some stuff isn't that fast
[15:05:14] <wardi> if that doesn't work try inserting it into one of the middleware layers
[15:08:01] <Bubo> wardi: can you point me where?
[15:10:00] <wardi> ckan/config/middleware
[15:11:22] <Bubo> in any of them?
[20:07:37] <Bubo> Has anyone tested the /revision/list - atom format with a lot of revisions? Is it slow?
[20:07:50] <Bubo> we are getting timeouts whenever someone wants to access the revision list in atom format

2017-08-07
[11:46:11] <thenets> amercader: I create a PR with all changes I needed to fix some TLS connection bugs and use custom certificates. You can check at https://github.com/ckan/ckanext-harvest/pull/295
[11:47:35] <thenets> amercader: I don't know how to run all unit tests, but I can help if you somebody teach me
[11:55:00] <tino097> thenets: did you try with nosetests --reset-db --ckan --with-pylons=test-core.ini ckanext/harvest/tests -s -v ?
[12:31:08] <thenets> tino097: no. I didn't know this exists. I just test with clean CKAN 2.6.3
[12:31:20] <thenets> tino097: I'll do it now
[13:32:19] <tino097> thenets: hope it helps
[13:51:14] <thenets> tino097: I don't know why, but all paster commands stopped working xD I'l deleting everything and trying again
[13:53:49] <tino097> in the ckan folder ?!
[19:36:16] <thenets> tino097: sorry. I went to bed when you sent message. All paster cmds stop working. No matter where am i
[19:36:32] <thenets> I already fix that and I found some problems
[19:54:45] <thenets> tino097: I got this output from tests "Ran 38 tests in 179.174s" ... "FAILED (SKIP=2, errors=45)"
[19:54:55] <thenets> I'll investigate

2017-08-06

2017-08-05

2017-08-04

2017-08-03
[01:34:33] <slarrain> Hello, I am a newbie to ckan who just installed its latest 2.7 version and I think I might had encounter a bug. But I'm not sure, so I don't want to file an issue if its not necessary.
[01:34:55] <slarrain> I'm trying to create a sysadmin but it is failing.
[01:37:19] <slarrain> I guess my first question would be: is using `paster` == `sudo ckan` or are they different?
[01:51:16] <slarrain> I think I've isolated the error and I do believe there is a bug. So, I tried to add username `ssvob` and it failed because I didn't provide `name` nor `email`. And then I did and got this: https://paste.debian.net/979450/
[01:51:32] <slarrain> I tried with `test1` and it worked.
[01:52:46] <slarrain> And when I did `sudo ckan user list` I saw `name=sienna`. So I believe it was created in a weird way. Maybe without username, but with a name.
[01:53:00] <slarrain> Strange. Looks like a bug.

2017-08-02
[05:43:25] <travis-ci> ckan/ckan ckan-2.5.6 3b1c6c8 https://travis-ci.org/ckan/ckan/builds/260058671 Sergey Motornyuk: The build has errored.
[05:49:26] <travis-ci> ckan/ckan ckan-2.4.8 d7942d5 https://travis-ci.org/ckan/ckan/builds/260059593 Sergey Motornyuk: The build has errored.

2017-08-01

2017-07-31
[15:15:03] <Bubo> how can you access the context from a celery task?

2017-07-29

2017-07-28

2017-07-27
[14:04:05] <tino097> amercader: meeting ?
[15:02:29] <Zharktas> wardi: https://github.com/ckan/ckan/pull/3366 can this be backported to 2.6 ? run into it while upgrading from 2.3 to 2.6
[15:02:43] <Zharktas> 2.7 already has it, but 2.6 apparently does not
[16:10:56] <wardi> Zharktas: I don't see why not

2017-07-26

2017-07-25
[12:04:29] <tino097> amercader: wardi: meeting today ?
[12:10:16] <smotornyuk> wardi?
[12:10:34] <smotornyuk> ok, we are starting then, but feel free to join us)

2017-07-24
[10:04:08] <thenets> amercader: After trying a lot of things trying to make "urllib2" work I gave up. I replace the "urllib2" with "requests" and everything works!! 
[10:04:16] <thenets> https://github.com/thenets/ckanext-harvest/commit/e616a4de3253e62df84e1ab780428184dcf80d9f
[10:05:35] <thenets> at the Python docs they recommend replace the urllib/urllib2 too: https://docs.python.org/2/library/urllib2.html
[10:08:35] <thenets> I'll make a lot of tests to send to production in the next weeks. When I finish and if you want, I can send a pull request to official ckanext-harvest repo
[10:20:42] <thenets> (ah, I forgot to say. This change fixes the problem to validate connection with HTTPS, especially with TLS 1.3)
[10:36:51] <amercader> thenets: that sounds great, it would be great to have this as a PR!
[11:02:15] <thenets> amercader: np. I need to learn how to handle with exceptions. I tell you when I finish

2017-07-23

2017-07-22

2017-07-21
[06:22:31] <thenets> Someone had problems using ckanext-harvest to harvest an HTTPS portal? I don't know why, but the harvest process stops just with HTTPS ckan
[08:01:02] <gulic> who is taking care of ckanext-harvest?
[09:12:17] <amercader> thenets: can you ask them to create an issue on the repo?
[09:13:57] <amercader> gulic: ckanext-harvest could use some more hands, so if you have some time any help is appreciated
[09:15:21] <thenets> gulic, amercader: Yes. I'll add to my to-do list. I'm doing some tests. Later I open an issue with results that I got.
[09:16:40] <thenets> I'll sleep now, but I'll go back to CKAN stuff today yet
[09:16:50] <thenets> see ya
[09:21:44] <amercader> thenets: have a good night
[09:25:45] <gulic> @amercader, sounds good with me
[09:26:56] <amercader> gulic: thanks! do you have an issue in particular that needs solving?
[09:34:43] <gulic> amercader, not at the moment. I just asked because we are working on extending harvester to collect Sentinel data from different sources, and also some clients are testing the existing possibilities of the harvest extension, so I just wanted to make sure that I know who to talk to :)
[09:35:32] <amercader> gulic: great
[09:36:15] <amercader> so if you can help reviewing incoming PRs and issues is a great way of getting familiar with the inner workings of ckanext-harvest, which can be tricky
[09:36:52] <gulic> amercader, that sounds great. I really need that :)
[11:48:16] <gulic> amercader, I would like to update the ckan.beta image. Is it ok if I do it now?
[11:49:20] <amercader> gulic: sure, actually it should always run the latest  `dev-v2.7`  branch
[11:49:30] <amercader> I thought it was automatically deployed?
[11:49:57] <gulic> we had a problem with the image
[11:50:01] <gulic> and I've fixed it now
[11:50:39] <gulic> after this deploy we'll have automatic deploys again
[12:04:39] <amercader> excellent, thanks

2017-07-20
[13:43:50] <amercader> tino097_, wardi, smotornyuk: sorry I have a conflicting meeting and can't make it today
[13:43:58] <amercader> ping me wherever needed
[13:44:10] <amercader> smotornyuk: let me know about 2.7 checklist
[14:20:34] <smotornyuk> amercader: there are few new issues with backporting label, i'll merge them today/tomorrow and then will make builds and test them.
[14:20:34] <smotornyuk> `Fix anyimportantissues flagged by testers` - this means issues from github issue tab or there are any other channels of communication?
[14:20:34] <smotornyuk> `Announce a week before. Wed 26th July` - how exactly it should be announced? :)
[14:25:35] <amercader> smotornyuk: mainly github issues but keep an eye on ckan-dev as people not always creates an issue
[14:25:51] <amercader> announce on ckan-announce, I've updated the issue with details, sorry
[14:30:57] <smotornyuk> Thanks)

2017-07-19
[17:18:46] <thenets> hi. DO you need something specific to be tested? I can help
[17:50:48] <thenets> this branch is the 2.6.3? https://github.com/ckan/ckan/tree/dev-v2.6
[18:59:03] <tino097> thenets: yes
[18:59:16] <tino097> you can check beta.ckan.org too
[18:59:23] <tino097> its on 2.7
[18:59:39] <thenets> tino097: thanks! :) I change the branch to 2.6.3 in my dev environment
[18:59:58] <tino097> np
[19:00:00] <thenets> ok. Exist a admin account on beta domain?
[19:00:13] <thenets> tino097: what mean "np"?
[19:11:34] <tino097> no problem >)
[19:13:56] <tino097> i dont have the credentials for admin user on beta right now
[19:20:04] <thenets> tino097: ah, ok ^^ no problem. I'll install in my VM. Thanks and see ya /

2017-07-18
[12:02:53] <wardi> amercader: around for the meeting?
[12:08:06] <amercader> ups sorry, coming
[12:56:56] <amercader> gulic: let me know when beta.ckan.org is back online so I can check perms, etc
[13:31:49] <gulic> @amercader, I'll send you an update. I am working on it at the moment
[13:54:45] <amercader> excellent, thanks
[14:59:59] <gulic> @amercader, https://beta.ckan.org/ is up and running
[15:03:20] <amercader> thanks gulic
[15:09:59] <tino097> This CKAN instance is running the release-v2.6.0 branch
[15:10:05] <tino097> it should be a 2.7
[15:10:07] <tino097> ?
[15:15:40] <amercader> tino097: it's running 2.7 https://beta.ckan.org/api/action/status_show
[15:15:52] <amercader> the text in the homepage needs to be updated
[15:16:42] <tino097> yes, saw it later :)
[15:19:41] <amercader> tino097, gulic: I used to have access to the repo where the conf for beta, master, demo was hosted in gitlab, but not any more. Could you give me access to it? I need to check some values
[16:20:29] <tino097> amercader: i asked some of our devops to check for it

2017-07-17

2017-07-16
[00:22:12] <tktech> danse: do you have the full exception

2017-07-15
[03:28:49] <danse> Anyone know why I might be running into a "ImportError: no module named plugin" error that is causing a 500 internal server error and seems to happen when trying to use paster?
[03:29:14] <danse> Seemed to occur shortly after trying to install the datadotworld extension

2017-07-14
[08:50:16] <torf> amercader: I'm currently looking through the German translations and there is a lot of mixture between formal ("Sie") and informal ("Du") pronouns. I don't think either one is necessarily better, but it should be consistent. I know that some other projects offer two variants of German because of this, but that's probably too much work for now. Informal is more modern but typically not used in government settings. Formal is the safe option. What do you think?
[09:15:02] <amercader> torf: Good question. My small personal preference would be for the more formal but it obviously depends on the context of the instance. The reality is that many CKAN instances are still deployed on a government / administration context. But yes, it should be consistent. I just checked the Spanish, Catalan and French and formal is the one prevailing but there are some informal strings too
[11:01:26] <torf> amercader: OK. Then I suggest I change all German strings to formal for the time being and we can have a general discussion about it at a later point
[11:01:53] <amercader> sounds good
[11:19:59] <torf> amercader: Done
[15:31:56] <gulic_> hi, it's Jovanka from Viderum. Is anyone around?

2017-07-13

2017-07-12

2017-07-11
[09:27:38] <torf> brucker
[09:27:49] <torf> whoops, wrong window ><
[12:03:39] <amercader> wardi: can you make it to the meeting?
[17:41:12] <tktech> amercader: I believe both Ian and Jinfei are on break this week
[17:43:53] <amercader> Cool, thanks tktech
[17:43:58] <amercader> We miss you too!
[18:16:16] <tktech> I'll be on the call on Thursday, sorry for being so absent :) Not a morning person.

2017-07-10

2017-07-09

2017-07-08

2017-07-07
[11:17:25] <knud> when writing a harvesting extension, what would a good way to skip a specific harvest object (i.e., not import it after all), based on it's data?
[11:23:01] <Zharktas^> return 'unchanged'
[11:23:42] <Zharktas^> https://github.com/ckan/ckanext-harvest#the-harvesting-interface documented here
[11:42:14] <knud> Zharktas: thanks. So 'unchanged' should also be used for objects that should never be imported (as opposed to objects that have been imported before, are unchanged, and therefore don't need to be imported again)?
[11:54:05] <Zharktas> unchanged are totally skipped, i think those get reported as not modified though even if nothing has been imported
[11:56:43] <Zharktas> most optimal would be to skip them in gather stage but that is not always possible
[11:57:01] <knud> Zharktas: I dom
[11:57:20] <knud> *I don't think I can skip them in the gather stage, because I need to inspect their internals first
[11:59:09] <Zharktas> yup, thats one of the reasons why they can't always be skipped in gather stage :)

2017-07-06
[09:36:52] <ksivakov> has anyone used SAML authentication and if there is some call back URL defaulting to ckan ?
[11:05:50] <amercader> ksivakov: I know nothing about it, but I know that data.gov uses (or use to) SAML https://github.com/GSA/ckanext-geodatagov
[11:06:00] <amercader> smotornyuk: you around?
[11:08:01] <smotornyuk> Yes, i'm here

2017-07-05

2017-07-04
[12:01:12] <wardi> amercader: have time for meeting?
[12:06:37] <mattfullerton> wardi, amercader: would appreciate any pointers on where to help CKAN take defaults from resource view config schemas (https://github.com/ckan/ckan/pull/3444#issuecomment-312216983)
[12:18:51] <wardi> mattfullerton: we're in the call now care to join us?
[12:19:18] <mattfullerton> sure :-)
[12:21:01] <mattfullerton> wardi: has the link changed?
[12:21:51] <amercader> mattfullerton: https://hangouts.google.com/hangouts/_/event/cb1vmkss426lkqicj94a3amvd1c?hl=en-GB&authuser=1
[12:22:02] <wardi> https://hack.allmende.io/ckan-meeting
[12:22:35] <wardi> that looks right
[12:28:49] <amercader> wardi: https://github.com/ckan/ckan/blob/master/ckanext/datatablesview/plugin.py#L49
[12:49:51] <mattfullerton> https://www.tqhosting.com/kb/617/How-to-install-PostgreSQL-95-on-Ubuntu-1404-LTS-Trusty-Tahr.html
[12:50:23] <mattfullerton> The official Ubuntu 14.04 repositories provide PostgreSQL 9.3 ready to install with apt
[12:53:59] <wardi> thanks!

2017-07-03
[05:46:54] <thenets> if you allow me, I can help to translate some CKAN extensions

2017-07-02

2017-07-01

2017-06-30
[18:15:04] <danse> Hi. I'm having a bit of trouble getting the harvest extension to work. Anyone have experience setting it up?

2017-06-29
[12:53:50] <LondonAppDev> Are there issues with http://docs.ckan.org/en/ckan-2.6.2/ ?
[12:54:10] <LondonAppDev> I'm getting some text but no CSS
[12:54:15] <torf> LondonAppDev: Works fine for me
[12:55:05] <LondonAppDev> hmm I checked with someone else living in another city and they got the same as me, slow loading text but no CSS. Maybe it's cached on your side?
[12:55:11] <LondonAppDev> It's working now just slow
[12:55:14] <LondonAppDev> very slow
[12:55:48] <LondonAppDev> Wonder if it's on Rackspace? Major rackspace outage right now
[12:56:10] <torf> LondonAppDev: You're right, a forced update is very slow for me, too
[12:56:30] <LondonAppDev> IP is Rackspace

2017-06-28
[12:38:03] <LondonAppDev> I think I read somewhere that you are not supposed to return sqlalchemy query results directly in an action, and that it should return a dict/list/string instead. Is this correct?
[12:42:16] <amercader> LondonAppDev: yes, actions should return something that can be formatted as json (so dict/list/string)
[12:42:36] <LondonAppDev> Great, thanks amercader.
[15:39:54] <LondonAppDev> How come the ckanext-harvest extension doesn't use the CKAN background tasks? http://docs.ckan.org/en/ckan-2.6.2/maintaining/background-tasks.html
[16:09:28] <torf> LondonAppDev: the old background task system hasn't been used much, AFAIK there have been several issues in practice. CKAN 2.7 will have a new system for background jobs (http://docs.ckan.org/en/latest/maintaining/background-tasks.html) and IMO it would be really nice to port ckanext-harvest to that.
[16:10:03] <LondonAppDev> ah ok makes sense, thanks torf.

2017-06-27

2017-06-26
[02:24:09] <thenets> I always got "AttributeError: 'module' object has no attribute 'facets'". You know how can I update/create h.facets before call it?
[02:49:43] <thenets> I solve it creating my own string with facets :)
[17:30:24] <canoas> if we need to display columns/fields with a different name (special chars), what strategy can we use? Could not find anything in the fields structure to support a display_name. Can translations help here?

2017-06-25

2017-06-24

2017-06-23

2017-06-22
[05:07:25] <thenets> about ckanext-archiver you know how can I set redis located in another server/container?
[05:08:05] <thenets> I always got the message "ConnectionError"
[05:09:20] <Zharktas> thenets: you configured redis in your ckan.ini ?
[05:10:22] <thenets> http://dontpad.com/ckanext-archiver
[05:10:28] <thenets> this is my config
[05:11:08] <thenets> "ckan-supervisor" is my Docker container with redis
[05:12:20] <Zharktas> you tested the connection with redis-cli ?
[05:12:39] <thenets> yes... works ok with harvest
[05:13:31] <thenets> archiver can access redis when I run command "celeryd2 run all"
[05:13:56] <thenets> but when a dataset is added I got message: ConnectionError: {'exc_message': 'Error 99 connecting to localhost:6379. Cannot assign requested address.', 'exc_type': 'ConnectionError'
[05:32:07] <Zharktas> then i have no idea, might have something to do with different celery version though. since archiver config options are going directly to celery instead of ckan configuration
[05:33:06] <thenets> Zharktas: hmmm so I can just set celery version I want
[05:33:29] <thenets> I'll try version 3.x and check what happens
[05:34:53] <thenets> Zharktas: I only need to run the command "paster --plugin=ckanext-archiver celeryd2 run all -c /etc/ckan/default/development.ini" to recheck / rearchive all resources?
[05:35:06] <Zharktas> most of the extensions probably were already updated to celery 3, the extensions had some issues in the past with that
[05:35:46] <Zharktas> i've only used archiver with ckanext-qa, so i have no idea :D
[05:35:57] <thenets> Zharktas: hmm ok, I'll force a update
[05:36:20] <thenets> I want to add the ckanext-qa too xD but my archiver doesn't work yet
[05:38:33] <Zharktas> https://github.com/6aika/sixodp/blob/master/ansible/roles/ckan-config/templates/ckan.ini.j2#L232 but apparently we do not even set broker_host, but then again it might default to localhost and it just works cause we do not run redis in container
[05:39:47] <thenets> wow, you'r from finland, cool
[05:40:37] <thenets> hmm I'll try your setting before update to 3.1
[05:48:38] <thenets> Zharktas: Thanks!!!!! It's working!! the "BROKER_URL" is missing from ckanext-archiver docs
[05:50:34] <Zharktas> :)
[13:40:50] <amercader> wardi, ksivakov: sorry, I can't make it to today's meeting
[13:41:28] <amercader> I made a big push with 2.7 and created a checklist https://github.com/ckan/ckan/issues/3623
[13:42:25] <amercader> In terms on how to split tasks I added some ideas on the meeting notes https://hack.allmende.io/ckan-meeting
[13:43:02] <amercader> let me know how that looks like (don't worry if you don't have time, we'll assign to someone else)
[13:43:39] <amercader> (and ask Sergey to get on IRC so I can chase him :) )
[13:48:12] <ksivakov> ok
[14:07:50] <smotornyuk> Hi. Adria, did you want something from me?:)

2017-06-21
[07:51:16] <mattfullerton> Im getting Data Explorer views created twice for resources - I suspect once from resource creation (default views) and once for datapusher/datastore. Is that actually intended behaviour (as Data Explorer can cope with files and Datastore sources) and the fix would be to just remove from default_views?
[07:52:01] <mattfullerton> Im so sorry ignore that message - recline_view was in there twice. Great start to the week ;-)
[10:45:04] <travis-ci> ckan/ckan release-v2.5.6 bae7e3c https://travis-ci.org/ckan/ckan/builds/245307846 Aleksandar Jovanov: The build failed.

2017-06-20
[12:01:39] <wardi> amercader: have time for the meeting?
[12:02:06] <amercader> yes, booting the hangout

2017-06-19

2017-06-18

2017-06-17

2017-06-16
[10:54:27] <canoas> Is it possible/recommended to use YYYY-MM (Year Month) as a date? What is the best way to represent a month in a dataset? thanks
[12:06:08] <amercader> canoas: that sounds like a perfect way. it's the standard way defined in Table Schema http://specs.frictionlessdata.io/table-schema/#yearmonth
[12:27:13] <ksivakov> hello, we come to a problem with munge
[12:27:14] <ksivakov> https://github.com/ckan/ckan/blame/ckan-2.6.2/ckan/lib/munge.py#L158
[12:27:55] <ksivakov> when migrating some of the portals that are using s3 filestore
[12:28:11] <ksivakov> should i open issue about this ?
[12:29:53] <amercader> ksivakov: yes please, we can always close if not relevant on the meeting

2017-06-15
[14:01:23] <wardi> amercader: have time for meeting?
[14:02:24] <amercader> Yes sorry, will be a few minutes late, go ahead

2017-06-14
[12:39:52] <amercader> torf: I'm having some trouble using background jobs with the datastore enabled: https://gist.github.com/amercader/7d7d3ffa89af834205974cad0d0a57d0
[12:40:48] <amercader> basically the first time I run a job it works fine, but after that first run, the others raise an exception,  same one as https://github.com/ckan/ckan/issues/3243
[12:41:49] <torf> amercader: Those will haunt me for the rest of my life ><. I'll take a look
[12:45:18] <amercader> torf: I think the problem is that the db engine used by the datastore (actually two, because there is a read only and a read write connection) are not initialized on `load_environment`, which is the one you call here: https://github.com/ckan/ckan/pull/3247/files#diff-596d2153847ce010279a7700761d9665R257
[12:46:05] <amercader> so one fix would be to call whatever code used to create the datastore engines on that same place
[12:46:30] <torf> amercader: That could very well be the case. Honestly I completely forgot about the DataStore now that you remind me.
[12:46:37] <amercader> not superelegant tbh
[12:47:37] <amercader> but the alternative is to allow extensions to hook into the worker init logic
[12:55:48] <torf> amercader: It's a bit more complicated: we need to close the parent's connections before the fork and (re-)initialize the connections in both the parent and the chidl after the fork. See also https://github.com/ckan/ckan/issues/3365
[12:56:44] <torf> The initialization after the fork inside the child should be handled well by load_environment, since that's the same code that runs during CKAN startup and should also cover extensions like DataStore
[12:57:40] <torf> The re-initialization in the parent currently relies on SQLAlchemy, we simply dispose the engine before the fork and SQLAlchemy re-establishes automatically afterwards upon the first request
[13:06:48] <amercader> torf: Ok you lost me on the last sentence. So "close the parent connection before the fork" is not done explicitly anywhere?
[13:11:37] <torf> amercader: It is: https://github.com/ckan/ckan/blob/5bc4921f2b7489867aa47905a34331f20f8c64e1/ckan/lib/jobs.py#L244
[13:12:19] <amercader> Got you
[13:12:57] <amercader> So we need a way of making the DataStore engines accessible somehow to dispose of them
[13:13:26] <amercader> Right now they are buried inside private methods of the postgres backend
[13:14:18] <torf> amercader: I'd rather do it the other way round via an interface that provides events related to background workers (e.g. "before_worker_fork") and which can then be used by DataStore and other extensions that hold custom DB connections to take care of themselves
[13:14:44] <amercader> Of course
[13:15:25] <amercader> That's just more complicated but definitely better
[13:16:41] <torf> First step should be to try to create a reproducibly failing test case from your problem. I'll take a shot at it.
[13:17:31] <amercader> Great, thanks torf
[13:20:32] <torf> Is there a way to get perma-links for https://botbot.me/freenode/ckan/ ?
[13:29:15] <torf> amercader: I've created an issue to keep track of this problem: https://github.com/ckan/ckan/issues/3606
[13:36:23] <torf> amercader: As far as I can see, your problem should be covered by an existing test case (https://github.com/ckan/ckan/blob/5bc4921f2b7489867aa47905a34331f20f8c64e1/ckan/tests/lib/test_jobs.py#L218) which has been running without problems for some time. In that test case, a job that accesses the DB is executed 3 times. Is there anything that I'm missing from your example that might be different?
[13:40:26] <amercader> torf: AFAICT this test case covers multiple calls to the same main engine (the one that is properly handled after #3247). In my case we are talking about different engines that are not properly disposed
[13:43:25] <torf> amercader: I'm not sure I understand. Your example has an action function that enqueues a job, which (as I understand) you call multiple times with all but the first one failing. Isn't that equivalent to enqueueing the same job multiple times?
[13:48:43] <amercader> Yes, but from our discussion what is causing the exception is that the engine used by an extension (DataStore) is nit being properly handled. And that is not covered by that test case
[13:49:13] <torf> But how is that covered by your example?
[13:49:49] <amercader> By having the DataStore plugin activated on my in file (not shown on the example :) )
[13:51:00] <amercader> *ini file
[13:51:10] <torf> Ah, of course. I had just checked test-core.ini to see if it defines datastore.read_url, etc. (which it does) but failed to notice that it doesn't enable the datastore extension itself
[14:08:21] <torf> amercader: OK, I can get some of the existing test cases to fail when I add datastore to the list of plugins in test-core.ini. However, the tests don't fail if I load datastore dynamically for these tests only via ckan.plugins.load/unload. Any idea why that might be the case?
[14:34:52] <amercader> torf: that's weird, it should have the same effect
[14:35:51] <torf> amercader: Unfortunately I won't have time to look more into this for the rest of the week. If you could manage to create a reproducible test case from your example then that would be awesome.
[14:36:20] <amercader> sure, will try, but I don't have much time either
[15:37:03] <mattfullerton> @wardi Found the answer to my solr problem: https://github.com/datagovuk/ckanext-dgu/commit/69898011e5369ad9d1a0cc21263c7a0d50599e83
[15:41:05] <mattfullerton> and I know I owe you an answer on slowing down ckan docker to wait for the DB

2017-06-13
[09:41:28] <LondonAppDev> Hey guys, anyone have any idea how I could solve this? https://github.com/ckan/ckanext-spatial/issues/177
[13:49:51] <torf> On one of my test setups I don't get a "Datastore" tab when editing resources, even though the datastore has been set up and seems to be working ("api/3/action/datastore_search?resource_id=_table_metadata" returns the right stuff), no errors/warnings are logged and no custom theme is installed. Any ideas why that might be the case?
[13:51:15] <wardi> the datastore tab is created by the datapusher plugin (I tried to change the name but amercader objected :-)
[13:51:55] <torf> wardi: Ah, the DataPusher is indeed not enabled on that instance. Thanks!
[13:52:50] <torf> Renaming the tab would probably be more confusing. However, it could be mentioned in the docs -- currently that tab isn't documented at all.
[13:56:25] <amercader> DataPusher would be super confusing to users
[13:57:34] <torf> amercader: Yeah, I think so too. However, given the complexity of the CKAN-DataStore-DataPusher environment the docs could be a bit more detailed ;)
[14:01:08] <wardi> I hope to get the upload-excel-direct-to-datastore feature factored out of ckanext-recombinant so it can be used as a datapusher alternative one day
[14:02:27] <mattfullerton> did anyone see my cry for help about why CKAN/SOLR can't use its date data for searches? Anyone ever seen that problem?
[14:03:26] <wardi> mattfullerton: no, is there a ticket for that?
[14:04:23] <mattfullerton> I'm not sure its fair to open a ticket for CKAN (DGU CKAN) 2.2. Especially when the DGU search actually works. I didn't find others ever having the same problem. I'm pondering upgrading solr and reindexing
[15:50:52] <canoas> hi guys, can someone help figure out a better way to display (recline_view?) a Year-Month YYYY-MM in the X Axis? maybe I need to upload the Json in a better-typed way. graph axis not working http://ckandev.northeurope.cloudapp.azure.com/dataset/mjmedidas/resource/5d6abc26-dfa6-4067-8ccc-f568344da2e2 and not sure if we can specify a date as YYYY-MM. Is there any convention for this view?

2017-06-12
[07:43:03] <quarkyup> Hey there. Does CKAN need a CMS to works or is it included inside the package ?*
[07:47:00] <teemu> there's ckanext-pages if you need custom pages with an on-site editor?
[07:47:22] <teemu> for anything you see on demo.ckan.org it already has
[07:47:44] <teemu> so depends on your needs
[07:48:51] <quarkyup> 'Cause I see everywhere that you need to integrate some CMS with ckan, like Wordpress+Ckan or Drupal+Ckan for example
[07:50:21] <teemu> no, you don't
[07:50:49] <quarkyup> what's the difference between dkan and ckan then ?
[07:50:49] <teemu> only if you require their specific functionality you CAN, but it's not in any way required
[07:50:58] <quarkyup> Oh okay
[07:53:35] <teemu> so if what you need is what you see in demo.ckan.org, no need for a CMS at all
[07:59:07] <quarkyup> thanks for your answers !
[09:04:37] <teemu> no problem :)
[10:57:20] <LondonAppDev> Hey guys :)
[10:57:36] <LondonAppDev> I have a question about the CKAN geospatial harvester I was hoping someone might be able to help with.
[10:58:05] <LondonAppDev> I have this site setup with CKAN: http://rdds.researchdata.alpha.jisc.ac.uk
[10:58:57] <LondonAppDev> Currently the map search returns all datasets where the selected area falls anywhere within the bounding box.
[10:59:22] <LondonAppDev> I want to switch it so it only returns results where the full bounding box falls within the selected area.
[10:59:53] <LondonAppDev> Any ideas how I can achieve this? I'm wondering if there is a settings I can change but I can't find it within the docs.

2017-06-11

2017-06-10

2017-06-09

2017-06-08
[17:31:47] <mattfullerton> Today I'm wondering if anyone has been able to successfully conduct exact searches on metadata_created but not range searches...? To be more explicit, why this:
[17:31:47] <mattfullerton> https://data.gov.uk/data/search?q=metadata_created%3A%5B*+TO+*%5D
[17:31:47] <mattfullerton> returns 42,000+ results,
[17:31:47] <mattfullerton> and this
[17:31:47] <mattfullerton> https://data.gov.ie/data/search?q=metadata_created%3A%5B*+TO+*%5D
[17:31:47] <mattfullerton> returns 6. Where suspiciously the 6 seem to all be dates without times or dates with bad times (e.g. 0:0)
[17:31:47] <mattfullerton> (d.g.ie is derived from dgu)

2017-06-07
[08:49:38] <brylie> Hi all.
[18:34:41] <wardi> working on the changelog for 2.7.. this release has *tons* of new stuff!
[18:36:28] <wardi> we should get back to that shorter release cycle thing we were trying for...
[19:36:27] <bubo> is the changelogg available anywhere? even if it isn't completed

2017-06-06
[19:36:32] <jonashenrq> Hello guys,
[19:37:03] <jonashenrq> I am facing problems with ckanext-archiver, can someone help me?
[19:37:15] <jonashenrq> More details about the error: https://github.com/ckan/ckanext-archiver/issues/47
[19:38:27] <jonashenrq> Thanks!
[19:54:26] <bubo> Is this related to archiver?
[20:04:13] <jonashenrq> This error starts when I upgrade ckanext-archiver from version 0.1 to 2.x.

2017-06-05
[15:03:16] <LondonAppDev_> Hello
[15:03:35] <LondonAppDev_> Is there any CKAN extension anyone knows of that allows for solr-reindexing through the web interface?
[15:03:43] <LondonAppDev_> Instead of having to do it through the CLI?
[19:58:51] <wardi> fun times https://www.contextis.com/resources/blog/comma-separated-vulnerabilities/

2017-06-04

2017-06-03

2017-06-02

2017-06-01

2017-05-31



2017-05-30



2017-05-29

2017-05-28

2017-05-27

2017-05-26
[12:27:58] <ksivakov> hello all, has anyone some sugestion what library should be used as webhelpers replacement?
[19:42:19] <thenets> can I use action.package_update without add a log on package activity?

2017-05-25
[08:18:06] <LondonAppDev> Morning guys
[14:02:23] <ksivakov> amercader: meeting today ?
[14:04:39] <wardi> i can't make this one
[14:05:22] <ksivakov> np
[14:11:45] <amercader> sorry ksivakov, something came up and I couldn't join
[14:12:54] <amercader> I'm tied right now but tomorrow I'll send an email with the plan for the next couple of weeks
[14:13:13] <ksivakov> ok

2017-05-24
[08:44:37] <LondonAppDev> Hey guys, wondering if anyone is using the ckanext-spatial harvester and if they are, are they experiencing this issue? https://github.com/ckan/ckanext-spatial/issues/174
[08:45:43] <LondonAppDev> It's very strange because the fix I put in that works for me locally, fails the travis-ci tests: https://github.com/ckan/ckanext-spatial/pull/176

2017-05-23
[12:02:47] <ksivakov> meeting today ?
[12:04:51] <amercader> wardi: coming?
[12:07:43] <wardi> not this week
[12:12:07] <oddan> Hello, is this a suitable channel for posting ckan-related questions?
[12:23:30] <ksivakov> yes
[12:35:15] <oddan> I am trying to set up CKAN on a local machine for testing, but am having some trouble with making the filestore work properly.  It is related to the network configuration.
[12:36:49] <oddan> I have set up the file store as described here: http://docs.ckan.org/en/latest/maintaining/filestore.html
[12:37:22] <oddan> and I have deployed my source install as described here:
[12:37:23] <oddan> http://docs.ckan.org/en/latest/maintaining/installing/deployment.html
[12:38:30] <oddan> in the configuration file (production.ini), I am using "http://default.ckanhosted.com" as site_url and "/var/lib/ckan/default/" as storage_path.
[12:39:12] <oddan> the apache server is listening on port 8080, and nginx is used as proxy, as descibed in the deployment instructions I linked to above
[12:40:00] <oddan> since I am running this on a local machine, I have also edited /etc/hosts/ so that "default.ckanhosted.com" is redirected to 127.0.0.1
[12:41:08] <oddan> I can upload datafiles to the file store, but when I try to retrieve one (through the web portal, not using API calls directly), I get an internal server error
[12:42:21] <oddan> if I type 127.0.0.1:8080 into my browser window, I can access the portal, and my datasets are visible (but not downloadable, as just mentioned)
[12:42:58] <oddan> if I, on the other hand, type in "default.ckanhosted.com:8080", I still access the portal, but my datasets are nowhere to be found.
[12:43:36] <oddan> This is surprising to me, since I would expect "default.ckanhosted.com:8080" to be equivalent to "127.0.0.1:8080", due to the redirect in /etc/hosts.
[12:43:44] <oddan> But maybe I am misunderstanding something.
[12:54:47] <ksivakov> what is the error message? resource not found ?
[12:58:04] <oddan> Error 500 Server Error - An internal server error occurred
[12:58:32] <oddan> I just find it very surprising that the behaviour should be different in these two cases, which I would believe would be equivalent.
[13:01:43] <ksivakov> please check the logs, we will need more info about the error
[13:01:57] <oddan> if I type into the url field in the browser: 127.0.0.1:8080/dataset/<the rest of the url> , I can download the data no problem
[13:02:08] <oddan> yeah, I checked the apache error log as well
[13:02:29] <oddan> it's quite verbose, let me see if I can find the salient bit...
[13:06:05] <oddan> here are the topmost two lines of the log error message
[13:06:14] <oddan> [Tue May 23 14:41:03.651831 2017] [wsgi:error] [pid 8131:tid 139763205101312] 2017-05-23 14:41:03,651 INFO  [ckan.lib.base]  /api/i18n/en render time 0.023 seconds [Tue May 23 15:03:43.267990 2017] [wsgi:error] [pid 8132:tid 139763289110272] 2017-05-23 15:03:43,267 INFO  [ckan.lib.base]  /dataset/d9bee4f4-27fb-4b54-9456-f0f7c3f55a6d/resource/2453168d-76ac-4671-b72a-30a0eaffb666/download/sector5.zip render time 0.024 seconds [Tue May 23 1
[13:06:33] <ksivakov> gist
[13:06:47] <oddan> sorry, somethign went wrong with the paste
[13:07:02] <ksivakov> please use public gist
[13:08:15] <oddan> ok, so it's all here: https://gist.github.com/anonymous/c194b0446be0afce0a332428db714eb0
[13:10:56] <ksivakov> huh, permission denied ?!
[13:11:26] <oddan> yes, I am not sure why that happens
[13:12:09] <oddan> and again, if I type in the url, using 127.0.0.1:8080 rather than "default.ckanhosted.com:8080", followed by the URL, everythign works fine
[13:13:03] <oddan> so there must be some difference involved in those two requests, where "permission denied" for some reason occurs when I let /etc/hosts redirect my request
[13:22:52] <ksivakov> double check nginx configuration
[15:06:44] <Sicco> Hi all; I can't find an answer to the following question: How do I migrate a CKAN installation?
[15:07:23] <Sicco> Looking at the following page: http://docs.ckan.org/en/latest/maintaining/database-management.html#db-dumping-and-loading
[15:07:40] <Sicco> I've executed the following command: sudo -u postgres pg_dump --format=custom -d ckan_default > ckan.dump
[15:08:29] <Sicco> But when I imported this datasets it appears to only contain the metadata and not the actual datasets (I noticed this when I tried to download one of the datasets)
[15:09:20] <Sicco> imported this dump*
[15:09:49] <Sicco> So how can I create an export which contains the datasets as well?
[15:10:57] <ksivakov> you should dump datastore tables too
[15:11:35] <ksivakov> i asume its datastore_default
[15:41:28] <canoas> Need help understanding how CKAN was architected: I've been able to curl some request to create resources, but my attempts to upload a CSV file seam to endup uploading nothing. Is it possible to upload a file using curl do the API? Assuming my DataStore is working. Will I need DataPusher services configured also?
[15:54:35] <LondonAppDev> canoas: you can loop through the CSV and create a package per row?
[15:54:52] <LondonAppDev> loop through the csv and call the create package endpoint in the REST API.
[15:55:18] <LondonAppDev> there is this post, it's a bit old but may be useful@: http://docs.ckan.org/en/ckan-1.7.4/loading-data.html
[16:33:41] <Sicco> @LondonAppDev I fixed it by copying the /var/lib/ckan/storage and /var/lib/ckan/resources directories!
[16:34:07] <Sicco> Woops; I meant @ ksivakov
[17:25:51] <Sicco> Another question: running `paster --plugin=ckan datapusher resubmit -c /etc/ckan/default/ckan.ini`
[17:25:54] <Sicco> gives
[17:26:23] <Sicco> ckan.logic.NotAuthorized
[17:38:57] <tktech> oddan: do you have SELinux enabled?
[18:21:17] <Sicco> tktech: no I do not have SELinux enabled; I'm running CKAN in a docker container: https://hub.docker.com/r/ckan/ckan/
[18:43:28] <Sicco> Also; is there a simple way to reload the .ini? Instead of restarting the whole server?
[19:01:21] <thenets> hi! ^^ do you know how I can clear a specifc package cache by package id?
[19:02:12] <thenets> I can do it from command line, but I didn't found a solution from CKAN libs/helpers

2017-05-22
[13:07:04] <LondonAppDev> Is it possible to use pdb inside a CKAN plugin view for debugging?
[13:27:13] <LondonAppDev> Ah think I need to set debug to true.
[13:58:28] <bubo> You can use pdb anywhere

2017-05-21

2017-05-20

2017-05-19
[15:26:54] <ksivakov> usualy for Fridays, all the tests went crazy
[15:27:29] <ksivakov> AssertionError: Status was 409 but should be 200.
[15:38:07] <ksivakov> [Reason: field "permission_labels" was indexed without position data; cannot run PhraseQuery (phrase=permission_labels:")]\\\',)\'', u'__type': u'Search Error'}
[15:38:21] <ksivakov> almost all tests returning this message, any hints?

2017-05-18
[13:52:37] <ksivakov> for the meeting today, 2 of mine colegues will join us, regarding bootstrap3 changes

2017-05-17
[09:31:08] <bubo> wardi: I didn't have anything running on that port, yes I used netstat
[09:31:57] <bubo> It seems to me that in the datapusher_settings file, there is a host=0.0.0.0 and port=8800, but we also specify it as an argument in gunicorn -b 127.0.0.1:8800. If I change either of those two ports to 8801 it will work
[10:56:43] <LondonAppDev> Hey guys, is there any good examples of modern CKAN extensions which add custom models to CKAN? I've found a few such as ckanext-harvest and ckanext-archiver but they both take very different approaches so I'm wondering if there is a flagship extension anywhere that I can use to understand how to do it correctly?
[10:56:51] <LondonAppDev> are there*
[13:19:09] <torf> LondonAppDev: Many extensions do. One of our examples is ckanext-extractor (https://github.com/stadt-karlsruhe/ckanext-extractor), ckanext-showcase is another good example (https://github.com/ckan/ckanext-showcase)
[13:22:35] <LondonAppDev> thanks torf. I do you know why some use the declarative_base() format (example: https://github.com/ckan/ckanext-archiver/blob/master/ckanext/archiver/model.py) and other (like the ones you sent) use the base domain object?
[13:25:48] <torf> LondonAppDev: declarative_base is the modern way of defining SQLAlchemy models. Traditionally, CKAN uses an older approach, where tables and models are defined separately and then linked. Personally I'm still using that for new extensions to keep the code similar to what's in CKAN -- due to VDM, CKAN's model architecture is complex enough, I don't need two different SQLAlchemy styles on top of that ;)
[13:26:25] <LondonAppDev> ah ok thanks makes sense... What is VDM?
[13:27:32] <torf> A model infrastructure that provides versioning/revisions, see https://github.com/okfn/vdm
[13:29:13] <LondonAppDev> oh cool
[13:29:15] <LondonAppDev> cheers torf
[13:30:54] <torf> You're welcome! Note that VDM is going to be deprecated in 2.7 (https://github.com/ckan/ckan/issues/3536)
[20:37:26] <riordan> Hey - sorry to come in with a user support request in IRC
[20:38:48] <riordan> But I'm trying to help a new news organization launch a data portal for Panama. We've got an instance set up at http://tabulario.com, which seems to work ok. 2 major issues I've come across:
[20:39:59] <riordan> 1. remote resources aren't coming from the datastore, but rather are using the jsonpdataproxy.appspot.com, which keeps running out of daily bandwidth. And I can't, for the life of me, figure out how to activate the other options, e.g. recline_preview or datapreview
[20:40:17] <riordan> That's the more pressing issue now
[20:41:43] <riordan> 2. When adding a new resource, for some reason it takes about 3 minutes to add. Until I edited the nginx configs to take longer, it would always 504 error, but still winds up being several minutes before I can attach a resource.
[20:42:17] <riordan> If folks are around, I'd hugely appreciate any insights
[20:42:39] <riordan> Also - my configs are at: https://github.com/browninstitute/ckan-dockercompose-nuevanacion-tabulario
[21:35:43] <riordan_> Im assuming most folks are GMT/UTC - better to come back tomorrow?

2017-05-16
[11:57:32] <mattfullerton> @wardi: Would love to get your thoughts on labelling field values via scheming extension and how this affects the rest of ckan
[11:58:25] <mattfullerton> Beyond that I'm looking for tips on how to solve this one: https://github.com/ckan/ckanext-scheming/issues/139; modifying the solr schema is not something I've really done before - I tried it here and it hasn't worked, but I'm on a very new Solr
[11:59:03] <mattfullerton> Again, whether there would be any mechanism to feed the fact that this is a multivalued field across to the rest of CKAN would be a big win
[11:59:27] <mattfullerton> I have resources to work on this if we can agree an approach :-)
[11:59:59] <wardi> mattfullerton: want to join the dev call? it's starting now
[12:00:40] <mattfullerton> thats a coincidence
[12:01:36] <wardi> https://hack.allmende.io/ckan-meeting
[12:56:20] <amercader> wardi, mattfullerton: one thing I tended to do when building ckans was to index the multiple value labels on `before_index` and just facet on those, to save me complex snippets or helpers with lookups
[12:57:04] <amercader> this might not be very efficient for large texts, but for single words or phrases is fast. You can throw a lot to Solr
[12:59:17] <mattfullerton> amercader, you mean as far as solr's concerned package.question = "Big long label" and not "018", without actually changing the package metadata?
[12:59:33] <amercader> yes
[13:02:00] <amercader> you can index arbitrary fields on solr, just add them to the data_dict on the `before_index`hook
[13:02:17] <amercader> oh, but you need them to be multivalued right?
[13:04:03] <amercader> Then you will need to add a custom multivalued field in Solr
[13:05:07] <amercader> wardi: we could add a dynamic field in the schema similar to the ones we have that automatically indexes stuff as a multivalued field (something like `*_list`)
[13:16:33] <torf> mattfullerton: For ckanext-extractor we've added fields to Solr which we fill during before_index (just as amercader said). Works fine. See https://github.com/stadt-karlsruhe/ckanext-extractor#configure-solr
[13:16:41] <torf> However, we're not using ckanext-scheming in that case
[13:27:48] <mattfullerton> Thanks torf
[13:28:33] <mattfullerton> amercader: We can maybe get tktech's input on that?
[13:40:57] <wardi> amercader: yes, we'd just need to settle on that pattern (res_* is already one of those iirc)
[13:41:54] <amercader> (in the past I cheated and just used `vocab_*`, which is exactly what was needed)
[14:28:24] <wardi> I'm fine with anything, we just need it added to the core schema and documented
[17:03:51] <bubo> When trying to deploy datapusher with gunicorn, I get address already in use (following the documentation). Any ideas? I have nothing else running on that port, it only happens when I run the gunicorn command.
[17:18:44] <wardi> bubo: netstat can tell you what's still listening on that port

2017-05-15
[23:20:46] <tktech> amercader, great find, thank you

2017-05-14

2017-05-13
[14:32:09] <dcmul> Hi all. I need your help. Wats the best of data thats in 28000 pdfs on ckan. For instance would it make any sense have a dataset with 28000 resources. All the data is in the same format.
[14:35:18] <dcmul> Edited
[14:35:18] <dcmul> Hi all. I need your help. Wats the best way of publishing data thats in 28000 pdfs/csv files on ckan.
[14:35:18] <dcmul> For instance would it make any sense have a dataset with 28000 resources? Since they are part of the same dataset, should I try to merge the files?
[14:36:17] <dcmul> even I merge i need to have a copy of the original pdfs publicly accessible.
[18:13:16] <tktech> dcmul: You'll struggle with 28000 resources on a single dataset with vanilla CKAN.
[18:13:35] <tktech> There are a few extensions that implement "collections" on top of datasets for such cases.
[19:42:58] <dcmul> :tktech thanks alot, find out baout collcetions
[21:32:52] <wardi> dcmul: I agree, you'll either want those as separate datasets or linked from a single resource (but that's not going to be very useful for searching)
[21:33:10] <wardi> do you need to upload these files or just link to them?

2017-05-12
[15:36:28] <thenets> wardi: it's working!!!!

2017-05-11
[08:47:16] <LondonAppDev> tktech: Where would I check to see if there are any documents left in my solr core? The solr web interface?
[10:06:09] <LondonAppDev> wardi: Regarding the UTF-8 encoding we talked about to get the CKAN tests to pass. Is it recommended that we use UTF-8 for the filesystem encoding on a new production build? Or is this only to allow the legacy tests to pass?
[11:32:37] <LondonAppDev> Anyone know what would cause me to get `ImportError (No module app)` when running nose tests on a CKAN extension? Full output here: https://gist.github.com/LondonAppDev/570ceaab37c29ff7745c7073034e06b9
[14:01:24] <wardi> LondonAppDev: UTF-8 all the time
[14:44:49] <amercader> notes on our 2.7 discussion: https://hack.allmende.io/ckan-meeting#2017-05-11
[14:58:02] <wardi> #3428 would be nice to get in (#3414 is already merged)
[15:24:36] <LondonAppDev> ok cheers wardi will switch it.
[15:44:37] <thenets> Hi. About Scheming, you know how to split the options? example: ["publico", "pessoal"]  http://imgur.com/a/S1hUx
[15:45:42] <thenets> I check this issue, but I don't understand how to solve: https://github.com/ckan/ckanext-scheming/issues/139
[16:06:14] <wardi> you need to mark those fields as multi-valued in your solr schema
[16:13:14] <thenets> hm, ok, I'll check my Solr file and try to understand those fields. Thanks
[16:26:17] <wardi> basically you just need to add a line like https://github.com/open-data/ckanext-canada/blob/master/conf/solr/schema.xml#L152 for each multi valued field
[16:26:49] <wardi> our solr schema isn't dynamic yet, so we can't infer that from a scheming schema
[16:59:13] <thenets> wardi: ok. I'm recreating my Docker image to accept custom Solr schema. I'll try it after that. Thanks a lot
[17:42:40] <thenets> wardi: doesn't work :/ I need to run another command on terminal?
[17:42:57] <wardi> you'll need to paster search-index rebuild
[17:43:06] <thenets> hm... ok
[17:51:33] <thenets> wardi: I reindex, but the result is the same. I have just the scheming installed and this config: http://dontpad.com/thenets_scheming
[17:51:58] <thenets> I'll try to rewrite the template file for these options
[17:52:14] <wardi> link is blank for me
[17:54:30] <thenets> :/
[17:54:39] <thenets> I'll put on pastebin
[17:56:12] <thenets> https://pastebin.com/qggri4R7
[17:59:23] <wardi> are those resource or dataset fields?
[18:01:21] <thenets> fields
[18:01:46] <thenets> I'll get the entire file
[18:02:15] <thenets> https://github.com/dadosgovbr/ckanext-dadosabertos/blob/master/ckanext/dadosabertos/schema_inventario.json
[18:04:34] <wardi> oh right, the next step is to make sure a list is being sent to solr. eg. https://github.com/open-data/ckanext-canada/blob/master/ckanext/canada/plugins.py#L414
[18:04:50] <wardi> otherwise the json is getting stored, not the separate terms
[18:05:20] <thenets> ok!
[18:05:30] <thenets> give me one minute
[18:05:30] <wardi> scheming can't do this yet because the IPackageController covers all dataset types. If you only have one type it's simple though
[18:10:21] <thenets> I have 3 types :/ these files with "schema_" prefix https://github.com/dadosgovbr/ckanext-dadosabertos/tree/master/ckanext/dadosabertos
[18:11:12] <wardi> you could have an if-elseif chain in that function
[18:11:39] <wardi> the type is available
[18:16:56] <thenets> I need to learn a lot about CKAN, yet. I will try to make the "IPackageController" work for one schema first and than I create the conditional
[18:17:52] <thenets> I got error when I try to reindex about JSON, but I'll debug before ask help again
[18:18:24] <thenets> thanks for helping me, wardi
[18:23:50] <wardi> thenets: you're very welcome. I hope fixing this little rough edge gets funded some time soon :-)
[18:24:31] <wardi> might have to wait for some of the future search changes, then we can make it all automatic
[18:25:11] <thenets> thanks again and I hope so
[18:25:32] <thenets> it will be great
[18:26:07] <thenets> I'm trying to contributing with CKAN installation and dependences
[18:26:18] <thenets> later I want to create plugin too
[18:26:43] <thenets> or help to improve existent plugins
[18:27:59] <thenets> I already integrate CKAN with Wordpress API, but I don't have time yet to convert to a plugin: http://dev.thenets.org/noticias

2017-05-10
[10:10:13] <LondonAppDev> So I've created a ckan_test and datastore_test db in Postgres with UTF-8 encoding. I've ensured that sys.getsfilesystemencoding() returns "UTF-8". SOLR is running in multi-core mode... However I'm still getting 23 errors and 9 failed :( Any idea what these might be from? https://gist.github.com/LondonAppDev/e86a48ba96ec8b8263bc015bb1afb393
[10:13:43] <LondonAppDev> I should note that I am using CKAN 2.6.2
[10:32:54] <LondonAppDev> Just re-ran with --reset-db and now it's only 9 failures.... Getting there :) https://gist.github.com/LondonAppDev/87be19cb233315061fc9267ca7492901
[10:34:33] <LondonAppDev> They all seem to be related to search so much be something to do with my solr.
[17:37:34] <tktech> LondonAppDev: after your tests finish are there any documents left in your solr core?
[17:37:45] <tktech> LondonAppDev: And have you changed the value of site_id at any point when running things against that same solr core

2017-05-09

[11:38:48] <LondonAppDev> Hey all. Can I just confirm if the nosetests should pass for a base ckan install 2.6.2? I'm getting `FAILED (SKIP=14, errors=338, failures=40)` and before I spend hours debugging I want to check if it could be a problem with my setup or if it could be a problem in CKAN :)
[11:53:43] <wardi> they pass in CI afaik
[11:54:35] <wardi> I might be late for the meeting today
[11:56:59] <ksivakov> they work fine for me
[11:57:17] <LondonAppDev> Thanks guys, so I know it must be something locally.
[11:57:37] <LondonAppDev> It's not possible to run without using a DB right?
[11:58:00] <LondonAppDev> Are you running `nosetests --ckan --reset-db --with-pylons=test-core.ini ckan` ?
[11:58:17] <ksivakov> yes
[11:58:56] <ksivakov> you could try to skip --reset-db
[11:59:41] <amercader> LondonAppDev: can you give an example of a failing test? sounds like something is not properly configured
[12:00:06] <LondonAppDev> Sure thanks amercader. I'm just re-running them and I'll past an example the second it completes
[12:06:21] <LondonAppDev> amercader: Here is a sample of the output including a few of the results: https://gist.github.com/LondonAppDev/8f76daf69b428f0ef6b45187a99c2f0f
[12:13:28] <amercader> wardi: we had a short meeting today. Anything urgent you wanted to raise?
[12:13:28] <ksivakov> LondonAppDev: looks lile in the test-core.ini for ckan.site_url  value is set to 127.0.0.1:9000 ?!
[12:14:31] <wardi> amercader: ah, just missed it
[12:14:45] <wardi> nope! how did csvconf go? did you go to pycon too?
[12:16:02] <amercader> no pycon this time
[12:16:41] <amercader> csvconf was great, great talks and crowd and there was an alpaca you could pet (and kiss) https://twitter.com/hspter/status/859860582329008128
[12:16:59] <amercader> best conference ever
[12:17:13] <wardi> they went all out
[12:18:42] <wardi> where's the picture of you kissing the alpaca?
[12:20:45] <ksivakov> :)
[12:24:23] <amercader> wardi: https://goo.gl/photos/LNSurWwjAJh1Tk99A
[12:24:45] <wardi> hahah! nice
[12:28:14] <amercader> BTW besides to pet the alpaca, I went there to present the latest thing we've been working on at OKI, a service for automated, continuous data validation: https://goodtables.io
[12:28:43] <amercader> you should all try it out! it's a beta release, still rough on the edges but hopefully shows the potential
[12:28:55] <amercader> and of course, we are planning a CKAN integration
[12:29:44] <amercader> my slides for more context: https://docs.google.com/presentation/d/1BLM9vabsfOJCQFP6Nqji_3zn4i4eFyo36_OKShKsIJA/edit#slide=id.g2206e2c965_1_78
[12:31:55] <ksivakov> \m/
[12:35:30] <wardi> where are the docs on the goodtables.yml format?
[12:36:18] <amercader> still nowhere but should be one of the top priorities
[12:36:51] <wardi> https://goodtables.readthedocs.io looks like the start of docs
[12:38:16] <wardi> MIT license this time!
[12:38:45] <amercader> This is the documentation for the underlying `goodtables` library (python and js) that does the validation (an awesome library on its own btw)
[12:39:03] <amercader> goodtables.io is the Travis-like service built on top of it
[12:39:21] <amercader> but yes, we need to consolidate all this documentation
[12:55:40] <LondonAppDev> amercader: Sorry for late response, was out at lunch. The site_url inside test-core.ini is definitely `ckan.site_url = http://test.ckan.net`. For some reason it's picking up the site_url in my production.ini file even though I'm specifically setting --with-pylons=test-core.ini :S
[13:00:45] <ksivakov> LondonAppDev: in the test.ini there should be 'use = config:test-core.ini'
[13:01:23] <LondonAppDev> ksivakov: Yes that's definitely there.
[13:03:08] <LondonAppDev> Do I also need a development.ini or does test-core.ini contain all the settings I need?
[13:04:02] <ksivakov> it contains all the settings
[13:05:34] <LondonAppDev> So somehow it must be picking up my production.ini file when it's running the tests.
[13:05:37] <LondonAppDev> Which is why it's failing
[13:12:14] <wardi> LondonAppDev: do you have environment variables overriding your settings?
[13:12:20] <LondonAppDev> lol yeah
[13:12:29] <LondonAppDev> I literally just figured that out
[13:12:40] <LondonAppDev> and just as you sent that I just enter on testing after removing the env variables
[13:15:02] <LondonAppDev> Running again, it's looking a lot better now. Will let you know if it passes. Thanks for the help and advice :D
[13:15:04] <wardi> maybe we should have a way to disable env var processing for situations like this
[13:15:22] <LondonAppDev> Yeah maybe
[13:45:56] <torf> Sometimes when I use ckan.tests.factories I get ValidationErrors ('That URL is already in use.'). Using --reset-db or not doesn't seem to make a difference. Any pointers?
[13:47:03] <wardi> hmm. is the search index being cleared?
[13:47:29] <torf> wardi: Should that happen automatically?
[13:47:40] <wardi> (are the tests subclassing teh FunctionalTestBase class?)
[13:49:13] <torf> wardi: Ahh, the problematic ones are indeed not. That could be the problem. Will investigate. Thanks!
[14:14:38] <torf> wardi: Spot on, problem solved. Thanks again.
[14:52:08] <LondonAppDev> Getting close, now it's down from 338 errors and 40 failures to only 2 errors and 10 failures. Any idea what might cause these? It looks like mostly encoding errors (I've ensured the DB is using UTF-8). Is there somewhere else I can set the encoding? https://gist.github.com/LondonAppDev/6d25c1a418e5f6300a14783eaf52efac
[14:52:59] <wardi> oh. what's your sys.filesystemencoding()?
[14:53:19] <wardi> our tests might be relying on utf8
[14:54:16] <LondonAppDev> in Python?
[14:54:27] <wardi> legacy tests are very sensitive to other tests failing, so check those last
[14:54:54] <LondonAppDev> Ah yet
[14:54:59] <LondonAppDev> Ah yes: 'ANSI_X3.4-1968'
[14:56:48] <wardi> what does the output of running the `locale` command show?
[14:58:14] <LondonAppDev> This is the output: https://gist.github.com/LondonAppDev/f8198c7c8e95d5e96fcc91fa99cd232e
[14:58:51] <wardi> yeah that's no good.  LANG=en_GB.UTF-8 would be better
[14:59:33] <LondonAppDev> ok, just looking at how I can change that
[14:59:39] <wardi> our tests really shouldn't depend on this, but that's probably a faster way to get things working
[14:59:51] <wardi> setting the locale depends on your distro
[15:00:29] <wardi> just setting that environment var before running tests *might* be enough to get going though, I'm not sure
[15:03:28] <LondonAppDev> Trying setting environment and then I will try another way...
[15:03:49] <LondonAppDev> It's a docker container so I might need to rebuild and somehow set the locale on build
[15:30:55] <LondonAppDev> I notice flask is in the requirements.txt for CKAN 2.6.2. Are any components of CKAN using Flask yet?
[17:01:38] <wardi> LondonAppDev: soon
[17:02:12] <LondonAppDev> sweet
[17:02:55] <wardi> LondonAppDev: check out the pending pull requests. API controller is first to be migrated. Extensions will be able to be written in either soon
[17:03:09] <LondonAppDev> amazing
[17:03:18] <LondonAppDev> I will love it when it switches to Flask
[17:03:28] <LondonAppDev> It will be so good
[17:05:49] <wardi> if you've got some time we could use help with review and testing
[19:43:59] <LondonAppDev> Hey wardi, sure would love to test the new Flask! I'm working on some CKAN extensions too so sooner I can switch them to Flask the better

2017-05-08

2017-05-07

2017-05-06

2017-05-05

2017-05-04
[08:50:36] <thenets> much better! :) I like the "Resources and Support" area
[15:08:52] <ksivakov> im going to update demo.ckan.org to 2.6.2 but the background image will be gone
[15:57:41] <ksivakov> and it will be postpinted for next week
[16:18:14] <ksivakov> postponed*

2017-05-03
[21:26:55] <ksivakov> ckan.org got new look
[21:32:13] <wardi> indeed! looks very nice

2017-05-02
[08:20:57] <realitygaps> ckan.org certificate seems to have expired
[11:54:20] <wardi> realitygaps: that's not good
[17:10:21] <nico___> hello
[17:10:24] <nico___> I have the same problem as published in https://github.com/ckan/ckan/issues/3503
[17:10:50] <nico___> Any guidance?
[20:39:25] <tktech> nico___: See the last comment on that issue. You seem to have an old version of setuptools.

2017-05-01

2017-04-30

2017-04-29
[18:03:15] <thenets> hi. Can I create a log file for each day? exemple: ckan_20170427.log, ckan_20170428.log, ckan_20170429.log

2017-04-28

2017-04-27
[18:50:08] <danse> Anyone here using the geopusher extension on 2.6?
[22:31:39] <RedFusion> I am trying to find the best way to search a ckan instance for "agua" or "water" and add the tag "water" and group "water"
[23:41:32] <tktech> jrods, common error
[23:41:59] <tktech> jrods, There's no pylons context, so you also have no translation context
[23:44:49] <jrods> tktech is there any workaround? do you have any suggestions?
[23:45:58] <tktech> I think wardi ran into the same problem just a little ago
[23:46:02] <tktech> As have others on the issue tracker
[23:46:22] <tktech> With flask you would just "with app.request_context():", pylons doesn't seem to have a similar concept.
[23:46:51] <jrods> ok, ill look out for it, it's not critical, was just trying the dcat ext out
[23:46:57] <jrods> thanks =)
[23:47:25] <tktech> We're using it (with minor changes) for the Canadian site, working well so far.
[23:47:33] <tktech> (Solely as a producer and not a consumer)

2017-04-26
[00:48:47] <wardi> amercader: looks like fun
[00:50:02] <wardi> portland is awesome

2017-04-25
[12:22:50] <amercader> BTW the conference I'm speaking to is https://csvconf.com,
[12:23:03] <amercader> if you are around Portland next week you should totally come
[17:15:19] <jrods> has anyone come across this error before using dcat? https://pastebin.com/MF1M2YSL
[17:15:40] <jrods> i was trying out this command `curl -s http://demo.ckan.org/catalog.rdf | python ckanext-dcat/ckanext/dcat/processors.py consume -P > ckan_datasets.json`

2017-04-24

2017-04-23




2017-04-22





2017-04-21




2017-04-20

2017-04-19
[18:45:52] <terminaljunkie> I'm trying to modify my existing plugin which mostly functions as a theme at the moment. I'd like to add a new view to allow the user to submit feedback to the site maintainers. First, I created a template that extends `header_account` and added a nav link to 'Feedback'.
[18:45:56] <terminaljunkie> I now need to add a view and controller for this "feedback" page. What's a good way to do that through the plugins framework? I've been reading through the examples and tutorials and most of them, that I can see all modify a resource controller or package controller, is there a way to make a sort of plain controller that can accept inputs and then from there I can send them to an SMTP client?

2017-04-18
[12:02:11] <wardi> amercader: coming to meeting?
[12:02:50] <amercader> yes, sorry 2 min
[13:45:58] <tktech> amercader: flask-babel==0.11.2 is what you want

2017-04-17

2017-04-16

2017-04-15

2017-04-14
[03:10:41] <tktech> amercader, the pypi permissions are screwing, just waiting to be re-added
[03:10:46] <tktech> *screwed up

2017-04-13
[03:57:49] <tktech> thenets, just use package_search
[10:00:31] <thenets> tktech: thanks! I'll try it here
[14:09:28] <amercader> tktech: any news on the next release of https://github.com/python-babel/flask-babel ?

2017-04-12
[14:45:21] <thenets> hi. Do you know how to get packages with all package_extra ?
[14:57:35] <thenets> I'm using ckanext-scheming and I need something like that: http://localhost:5000/api/3/action/package_list?type=application&include_extras=true



2017-04-11



2017-04-10
[13:17:55] <ksivakov> amercader: im on 3229-api-blueprint branch, and on the user dashboard when scrorlling with content im getting this error
[13:18:07] <ksivakov> https://gist.github.com/tino097/5544b4d35b3000beb4bdf0a707964837
[13:19:11] <amercader> ksivakov: thanks, can you add it as a comment to the PR? does it only happen on the dashboard
[13:19:23] <ksivakov> yes

2017-04-09

2017-04-08

2017-04-07
[13:16:02] <ksivakov> amercader: ''what I don't understand is how this fields get ever stored in pg with this code'' they are filled with default value set https://github.com/ckan/ckan/blob/master/ckan/model/package.py#L53
[13:33:50] <amercader> ksivakov: but these defaults only apply to insert time (not update) IIRC
[13:34:32] <amercader> ah, I see, these get set up at insert time and then metadata_modified gets updated directly on package_update
[13:35:26] <wardi> which might help let sqlalchemy detect if there were changes
[13:35:32] <ksivakov> i thinks so
[13:35:47] <ksivakov> so i guess that part of the code could be removed
[13:36:07] <wardi> tktech was saying that sqlalchemy models can't detect changes within json fields, though, so we might need to be careful in the future
[13:36:09] <ksivakov> it could confuse people working on it
[13:37:17] <ksivakov> wardi: json fileds when using api or ?
[13:37:52] <wardi> ksivakov: the models can't detect when you mymodel.myjsonfield[42]['q'] = 'some new value'
[13:38:00] <ksivakov> thanks
[13:38:29] <ksivakov> i will check if can be done anything
[13:38:29] <wardi> tktech's trigger approach could be modified to allow setting the dates as well as auto-updating them
[13:38:58] <wardi> that's what I'm doing for my datastore triggers and it works well
[13:39:12] <ksivakov> can you please point me where in the code is it ?
[13:39:52] <wardi> https://github.com/ckan/ckan/pull/3476
[13:40:20] <ksivakov> ty
[13:43:09] <wardi> maybe separate the field that is updated from the trigger (a new internal_modified_date) or something and when the user doesn't set the value in the normal metadata_modified field that one is exposed instead through the api
[14:18:10] <bubo> Hi
[14:18:16] <wardi> o/
[14:18:26] <bubo> Any ideas why I would get DetachedInstanceError on package_relationship_create?
[14:19:04] <wardi> that usually means the real error happened just before. do you have the full traceback that happened first?
[14:19:35] <bubo> Let me see
[14:20:28] <bubo> wardi: https://paste.noname-ev.de/8497
[14:20:33] <bubo> this is the full traceback
[14:23:44] <wardi> not sure, but the real error is probably being hidden by that one. If you can step through the earlier code you might find it
[14:24:37] <bubo> Which earlier code do you mean?
[14:25:10] <bubo> I just use the API and POST-ing to package_relationship_create. I do have an override that does nothing it just calls the ckan default package_relationship_create action
[14:25:39] <bubo> 1 out of 4 package_relationship_create calls passes
[14:27:59] <bubo> Could it be that I am sending the API requests too fast?
[14:53:07] <bubo> Ok the error is because it was trying to create a relationship "dependency_of" between two datasets each of them as object/subject
[14:56:34] <wardi> that's a poor error message you're getting. Do you have time to submit a fix?
[15:49:45] <bubo> Mayve tomorrow
[15:49:49] <bubo> maybe*
[15:57:11] <bubo> wardi: I can add a check that checks if there is already an inverse relationship of the same type and return a validation error or something
[16:14:24] <wardi> bubo: that would work
[16:27:01] <bubo> alright

2017-04-06
[07:20:31] <Zharktas> fyi: docs for the new patch releases have not been released
[09:07:22] <amercader> thanks Zharktas, fixed now
[11:36:49] <ksivakov> sudo -u postgres createuser -S -D -R -P ckan_default for OSX doesnt work, any suggestion
[12:06:50] <ksivakov> used pgAdmin to create all stuff
[13:12:53] <tktech> ksivakov, "doesn't work" isn't a very useful bug report.
[13:13:18] <tktech> What error were you getting
[13:14:04] <ksivakov> tktech: command createuser does not exists
[13:14:17] <tktech> Ah, you installed it with homebrew?
[13:14:38] <ksivakov> but i have created the user and db using pgadmin
[13:15:01] <tktech> "sudo -u postgres" changes your user to postgres before running createuser.
[13:15:28] <tktech> Since it seems like you installed it with homebrew, that user isn't setup correctly and is needless, just do "createuser" with nothing before it.
[13:15:42] <ksivakov> no, using the installer
[13:16:13] <tktech> Which one :) There is no official installer for OS X.
[13:16:15] <ksivakov> honestly i haven used osx before, so im not sure what is the homebrew :)
[13:16:36] <tktech> https://brew.sh/
[13:16:36] <ksivakov> i have downloaded from web
[13:16:46] <tktech> Homebrew is a package manager for OS X.
[13:17:01] <tktech> It is the most common and contains every main package you'll ever need.
[13:17:13] <ksivakov> https://www.postgresql.org/download/macosx/ downloaded the installer and next, next , finish :)
[13:17:48] <ksivakov> thanks
[13:17:58] <ksivakov> now i've stalled on paster command
[13:18:05] <tktech> There are 3 entirely different installers on that page, none of which are provided by postgres :P
[13:18:32] <ksivakov> so i guess i should uninstall and do it with brew
[13:18:47] <tktech> If it's working for you I wouldn't bother.
[13:18:54] <ksivakov> any suggestion for creating the development.ini ?
[13:18:58] <tktech> But homebrew is definitely the best option for getting dependencies.
[13:19:10] <ksivakov> didint know that :)
[13:19:23] <tktech> Are you following the guide?
[13:19:24] <tktech> http://docs.ckan.org/en/latest/maintaining/installing/install-from-source.html#create-a-ckan-config-file
[13:19:38] <ksivakov> paster command is not found
[13:19:56] <tktech> You've missed steps.
[13:20:01] <ksivakov> im trying to install ckan on our designer mac ...
[13:20:44] <ksivakov> i was followin the steps ... installed on my Mint so many times, never had a problem with it...
[13:20:44] <tktech> Ah.
[13:22:15] <ksivakov> i will try again later
[13:22:20] <tktech> 1) The python provided by OS X by default is rubbish 2) Install homebrew (and update your $PATH) 3) brew install python 4) sudo pip install virtualenv 5) create virtualenv 6) python setup.py develop 7) pip install -r requirements.txt
[13:22:54] <ksivakov> thanks
[13:23:17] <ksivakov> btw, when you are here, i was loking into issue regarding metadata_modified
[13:24:39] <ksivakov> im not able to reprdouce it at all, but im wondering about the https://github.com/ckan/ckan/blob/master/ckan/lib/dictization/model_save.py#L291
[13:25:43] <ksivakov> why is needed to remove metadata_modifed and metadata_created from dict?
[13:38:17] <tktech> \o/
[13:39:37] <tktech> https://github.com/ckan/ckan/blame/master/ckan/lib/dictization/model_save.py#L291
[13:39:59] <tktech> Looks like amercader added that change 5 years ago, although I doubt he remembers why :) I don't remember the things I commited last week.
[13:52:02] <ksivakov> thanks again for the osx help :
[13:59:36] <tktech> np
[14:48:23] <amercader> ksivakov, tktech:  a bit of CKAN archeology: http://trac.ckan.org/ticket/1592.html
[14:49:13] <amercader> Of course I don't remember but I'm pretty sure I added this because at the time they were computed properties and could not be stored in the DB (which is what `mode_save` does
[14:49:19] <amercader> *model_save
[14:50:04] <amercader> what I don't understand is how this fields get ever stored in pg with this code
[14:50:06] <tktech> Right, makes sense, people wanted to overload them as well
[14:50:25] <tktech> While I've got you here, do you see any problem with removing activity_details?
[14:50:44] <tktech> It's an incredible amount of bloat and seemingly pointless as the complete dict is always stored on the parent activity record.
[14:51:19] <tktech> It's used in a couple activity snippets like added tags, but that can simply be added to the dict in the `data` column on the parent activity instead.
[14:53:10] <amercader> sounds good, we should be careful in removing api endpoints though. This one seems obscure enough, but if there are many of them as you said that could go perhaps we need to think about a new API version
[14:53:45] <tktech> I grok'ed google and github for quite awhile
[14:53:53] <tktech> Could not find a single mention of it let alone a call to it
[14:54:16] <tktech> (I was trying to figure out why it was even a thing)
[14:54:36] <tktech> Went through commits, ancient trac tickets, some redmine tickets from the same time
[14:54:45] <tktech> Nothing explains why it exists
[14:56:50] <tktech> From an end-user consuming the API
[14:56:59] <tktech> Getting the details is pointless without first getting the activity event
[14:57:15] <tktech> And if you already have the activity event the data column contains everything you need anyways
[18:36:48] <vnz> in ckan db, how are the group table and package table related to each other? how can I find the datasets that belong to a certain group?
[19:01:52] <vnz> nevermind, I found the necessary info in the member table

2017-04-05
[15:43:35] <torf> Which of the changes in 2.6.2 is the reason for a new release after a relatively short time?
[16:56:02] <tktech> amercader: https://github.com/ckan/ckan/commits/release-v2.6-latest
[16:56:08] <tktech> Looks like 2.6-latest is missing the changes?
[16:57:08] <tktech> I see them in the dev-v2.6 branch
[17:03:38] <amercader> tktech: agh, forgot to do that. I can do it in a few hours or if you can it's just merging dev-v2.6 into release-v2.6-latest
[20:04:22] <tktech> amercader: Was out for lunch, I'll get it done one moment

2017-04-04
[09:48:06] <amercader> tktech: great!  Also any time you have spare please keep the flask stuff in mind (https://github.com/ckan/ckan/pull/3239) as I want sergey and konstantin to dive into it asap
[12:02:20] <wardi> amercader: meeting today?
[12:02:31] <amercader> sorry, coming
[12:03:43] <amercader> https://hack.allmende.io/ckan-meeting
[14:06:31] <ksivakov> im investigating the issue with missing value for metadata_modified, causing errors with datasets, and i notice this code https://github.com/ckan/ckan/blob/master/ckan/lib/dictization/model_save.py#L293
[14:08:03] <ksivakov> what is the purpose of those lines?
[14:13:21] <wardi> pretty sure they are historical and should be removed now. it should be possible to update these fields when saving a dataset
[15:10:09] <tktech> amercader: We have no MOU at the moment, meaning until we get one we have a bit of liberty on what we work on.
[15:10:22] <tktech> amercader: I will try to get a full day freed up to properly test #3239 this week
[15:12:15] <amercader> tktech: that would be amazing!
[15:12:44] <amercader> I really want to get the Flask ball rolling again
[15:12:52] * wardi too
[15:14:04] <tktech> amercader: While I've got you here, if I recall correctly David hosts the demo site, right?
[15:14:28] <amercader> demo.ckan.org? no, it's on viderum's servers
[15:14:35] <tktech> I want to reach out to him if so to get access to it, since I'm unable to reproduce the performance problems people keep running into on it
[15:14:45] <tktech> Ah, hm
[15:15:07] <tktech> Do you have contact details for any of them?
[15:15:58] <amercader> IIRC it's deployed on docker based cloud setup. What kind of access / stuff do you need? maybe I can get it for you
[15:26:03] <tktech> amercader: ssh acccess to postgres and the frontend
[15:26:18] <tktech> amercader: I need the postgres logs plus the ability to adjust the settings to tweak slow query logging
[15:26:41] <tktech> More that than the frontend to be honest, I'm 100% sure it's a single poorly scaling query taking down all 3 endpoints
[15:31:14] <tktech> amercader: Boss man has agreed to reserving Friday for all things flask-related so if you have anything else you want to add or review before then just assign to me
[15:31:28] <amercader> woohoo
[15:32:06] <amercader> tktech: I'll ask about getting access to the demo site backend.
[15:32:25] <amercader> is this about any particular issue raised on the repo / mailing list/ etc?
[15:32:38] <amercader> what endpoints are going down?
[15:33:32] <tktech> amercader: There was a mailing list message from yesterday regarding user_list but I believe I've fixed that already, need to confirm it. The other one was also reported on the mailing list and I've added tracking ticket https://github.com/ckan/ckan/issues/3511
[15:34:22] <tktech> all_fields should be slow, as expected, but it shouldn't be *that* slow, something else is going on which is triggered by a group_show
[15:34:35] <tktech> But I've been unable to reproduce it locally
[15:38:44] <amercader> tktech: I think it's just the fact that there are 800 orgs and 400 groups in demo
[15:38:53] <amercader> plus the queries being slow of course
[15:49:13] <tktech> 800 orgs and 400 groups should not be a problem
[15:49:29] <tktech> The test instance for the "15 million datasets project" has 60k
[15:50:04] <tktech> Ah this CKAN is out of date
[15:50:13] <tktech> It's missing the query performance improvements from the last few batches
[15:51:35] <tktech> amercader: do you want to deprecate the current behaviour first, or can I toss up a PR to immediately enforce pagination and disable all_fields?
[17:39:18] <amercader> Let's discuss on the dev meeting or an issue but my preference would be to proper deprecate, ie announce a version before, etc

2017-04-03
[14:11:43] <tktech> amercader, couple more days facet support should be in solr & postgres, by the weekend ElasticSearch should be done...
[14:11:52] <tktech> Only going to get ~2h a day or so into it
[14:13:54] <tktech> So close to making solr optional

2017-04-02

2017-04-01
[17:14:46] <thenets> jrods: thanks :) I'll add it to my script!

2017-03-31
[15:48:30] <thenets> can I create an account user=admin / pass=admin on terminal without interaction?
[19:15:05] <jrods> thenets: yes, something like this? not sure but give it a try -> paster --plugin=ckan user add admin password=admin email=<address> -c /apps/ckan/conf/dlv.ini

2017-03-30
[10:30:31] <amercader> wardi, ksivakov, smotornyuk : sorry, I can't make today's call
[10:30:41] <amercader> you can assign me some stuff as punishment :)
[14:02:35] <ksivakov> dev meeting today ?
[14:29:35] <ksivakov> smotornyuk: i've build and the precise package

2017-03-29
[05:24:04] <thenets> exist a simple way to get datasets from an organization?
[05:28:17] <Zharktas> thenets: http://demo.ckan.org/api/action/organization_show?id=transporte-malagabigdata&include_datasets=true
[05:28:55] <thenets> wow the "include_datasets=true" help a lot!
[05:29:31] <thenets> I'll try it using inside extension from "ckan.logic". Thaks Zharktas
[05:30:09] <Zharktas> add it to the context of action call and it should work
[05:35:13] <thenets> thanks :) I'll try it now
[05:40:46] <thenets> have you some get_action example? It's not working here... I think this was an old example
[05:41:36] <thenets> Zharktas: I didn't found any example for 2.4 or later
[05:43:13] <thenets> here what I'm trying: https://pastebin.com/6LR7wbgb
[05:45:57] <Zharktas> that should work
[05:48:13] <thenets> sorry
[05:48:36] <thenets> I I confused group with organization.
[05:48:59] <thenets> Zharktas: worked perfectly. Thank you very much :)
[08:14:06] <thenets> can I allow upload just for admin users?
[08:14:24] <thenets> or disable upload file and keep old files avaliable?

2017-03-28
[01:32:44] <Prashant> Hi.. Can anyone confirm if CKAN supports remote backened storage? The doc suggests the feature has been deprecated since 2.1
[09:40:11] <tktech> Prashant: That's a very broad question.
[09:40:36] <tktech> CKAN supports plugins, and provides an interface for IUploader allowing you to do whatever you want.
[09:40:47] <tktech> There are various extensions for different backends.
[11:25:47] <PdeClown> Hello. Does anyone know if the gockan library for the Go language can still be used? It's on bitbucket, but it hasn't been maintained since 2011.
[11:34:01] <wardi> ow my inbox
[12:02:10] <wardi> tktech: dev meeting?
[13:29:17] <amercader> wardi, tktech, smotornyuk, ksivakov: As agreed I moved our old pad contents to the wiki page and booted up this one to use from now on: https://hack.allmende.io/ckan-meeting
[13:40:22] <wardi> looks good
[15:00:15] <CoolCat2012__> hi all! im a ckan first timer and im having issue, any hint? https://pastebin.com/Ke7bT5D0
[15:21:10] <smotornyuk> ksivakov: i updated branch 2.5.5 and all tests passed - you can now make build
[15:22:38] <realitygaps> oh nice i recognise allmende from matrix.org public server list :)
[15:22:47] <realitygaps> amercader: do you run that service?
[15:24:06] <amercader> realitygaps: no, I just chose hackmd.io as a replacement for our own old pad
[15:24:55] <realitygaps> ah cool
[15:25:08] <realitygaps> i was wondering as we run a similar service
[15:26:09] <realitygaps> hackmd looks interesting too
[18:35:06] <thenets> jrods: yes. If I change the "response", the changes occur in redirect as well. At least it worked here.
[18:35:32] <jrods> cool =) im glad it worked out

2017-03-27
[10:09:21] <thenets> jrods: I found a helper inside the Pylons that allows you to do redirects! :D
[10:09:40] <thenets> just import: from pylons.controllers.util import redirect
[10:10:17] <thenets> and than: return redirect('my_url_here') at controller method ^^
[12:54:18] <headphone_jack> Hi everyone.
[12:54:53] <headphone_jack> I have an issue with syncing the /usr/lib/ckan directory through Vagrant. Anyone any experience with that?
[13:18:59] <ksivakov_> whats the problem ?
[17:50:32] <jrods> thenets: you also wanted to do a redirect with a different status code, correct?  Were you able to with that function?

2017-03-26

2017-03-25

2017-03-24
[09:45:07] <LondonAppDev> Hey everyone. Is there any way to specify the "ckan.plugins" setting either as an environment variable or as a part of the "paster" command when running processes?
[10:19:28] <amercader> LondonAppDev: because of the way ckan is initialized `ckan.plugins` is one of the only config options that need to be defined in the ini file, even when using ckanext-envvars
[10:20:20] <amercader> it is a bit of a bummer and would be great to see if that can be refactored
[11:43:44] <LondonAppDev> Thanks amercader, I thought that might be the case :D
[11:48:19] <amercader> ksivakov_, smotornyuk: base ckan vagrant box that I use for testing the deb packages. It has postgres, solr, datapusher etc configured, so you only have to 1. install the deb package, 2. edit the ini file (add site_url, datastore and datapusher plugins, datapusher url, etc), ckan db init and restart everything (apache, nginx, jetty)
[11:48:21] <amercader> https://s3.amazonaws.com/files.ckan.org/base-ckan-trusty.box
[12:52:36] <smotornyuk> Thanks
[13:13:09] <ksivakov_> ty
[13:17:40] <ksivakov_> can the user schema be extended ?
[13:18:56] <amercader> not at the moment ksivakov_ . tktech started work on user extras but that is WIP https://github.com/ckan/ckan/pull/3072
[13:19:22] <ksivakov_> ty
[13:45:43] <smotornyuk> ksivakov: i think, release branches for 2.4.7, 2.5.5 and 2.6.2 are ready, at least, all tests pass. could you check them as well, if you have time?
[13:53:45] <ksivakov> smotornyuk: 2.6.2 deb packages are built
[14:03:04] <smotornyuk> Thanks! I still unable to build them locally, so i really appreciate it :)
[14:28:00] <LondonAppDev> Anyone have any ideas as to why CKAN isn't added to pypi?
[14:29:30] <torf> LondonAppDev: I guess it's because setting up CKAN consists of more than `pip install ckan` could ever do. PyPI is more suited for 3rd-party libraries IMO.
[14:30:37] <LondonAppDev> hmm ok thanks torf.
[14:57:56] <amercader> LondonAppDev, torf: actually we push ckan to pypi as some people use pip installation on their setups (although as you say you can't fully install it just from pip and this is not officially supported). LondonAppDev there was an old version displayed by default on pypi due to an error but this is now fixed: https://pypi.python.org/pypi/ckan
[15:02:32] <torf> amercader: Good to know
[15:34:16] <LondonAppDev> Oh, great! thanks amercader
[16:06:20] <amercader> torf: thanks for putting yourself forward to help maintain ckanext-pages, you should now have write access
[16:06:44] <torf> amercader: Thanks!
[20:59:43] <tktech> ksivakov, my intent is to eventually provide every data model with a simple JSON column for arbitrary anything

2017-03-23
[18:50:54] <thenets> Hi. You know how to redirect with 403 to an specific URL?
[19:03:23] <jrods> thenets: where are you trying to redirect in your codebase? It doesnt look like toolkit.redirect_to allows you to pass a different http code
[19:04:49] <thenets> jrods: I'm trying to redirecto to a Discourse page inside my CKAN url
[19:05:24] <thenets> Example: "/forum" redirect to "/discussao"
[19:15:09] <jrods> from what i can see atm is you might have to create your own redirect function that can change the http code from routes' redirect function, maybe someone else on here has a better approach?
[19:25:45] <jrods> thenets: im not sure, but you could try to use just toolkit.redirect_to, and before return, use toolkit.response to change the status code, but im not sure if toolkit.redirect_to will overwrite your change
[21:31:37] <thenets> jrods: hmm that's a good idea. I'll try to change the response, just as I changed to define a new content-type.
[21:32:05] <thenets> jrods: Thanks. I'll try it tomorrow
[21:32:20] <jrods> np, good luck =)
[21:35:22] <thenets> ^^

2017-03-22
[13:57:35] <travis-ci> ckan/ckan ckan-2.5.5 0a933a3 https://travis-ci.org/ckan/ckan/builds/213828784 Artem Bazykin: The build has errored.
[14:02:34] <travis-ci> ckan/ckan ckan-2.4.7 106a98c https://travis-ci.org/ckan/ckan/builds/213833643 Artem Bazykin: The build has errored.
[14:16:21] <travis-ci> ckan/ckan release-v2.4.7 106a98c https://travis-ci.org/ckan/ckan/builds/213833648 Artem Bazykin: The build has errored.
[16:31:51] <torf> In my templates "h.url_for(controller='api', ver=3, logic_function='package_show')" returns "/packages?ver=%2F3&logic_function=package_show" instead of the intended "/api/3/action/package_show". What am I missing?
[16:33:35] <torf> Ah, adding action='action' solves the problem.
[17:45:02] <jrods> amercader: if i made a PR to update leaflet to version 0.7.7, would it make it to 2.7 release?
[17:46:32] <jrods> there's a bug relating to the zoom in to contains options for the recline view
[17:58:37] <amercader> jrods: yes, there's still no date for 2.7
[18:00:16] <jrods> ok, cool, as for the bug, would you rather have an issue created or a pull request made? the fix is including a newer version of leaflet
[18:01:43] <amercader> PRs are always better!
[18:05:47] <jrods> alright, cool, thanks for the info =)

2017-03-21
[00:18:47] <xApple> OK well if anybody needs it later:
[00:18:58] <xApple> def rid_to_path(rid): return "/var/lib/ckan/resources/" + rid[0:3] + '/' + rid[3:6] + '/' + rid[6:]
[09:43:10] <amercader> jrods: yes, #3205 didn't make it to 2.6 but it's on master, which will eventually released as 2.7
[11:24:44] <saintamh> I have a question about ckanext-harvest, I was directed here from that extension's README, hope this is the right channel
[11:25:08] <saintamh> I can't seem to harvest from CKAN instances that have large numbers of datasets, i.e. data.gov.uk
[11:26:00] <saintamh> After the gather stage completes, I get a pika.exceptions.ConnectionClosed error. I think this is because it takes so long to fetch data.gov.uk's 41K datasets that the RabbitMQ connection times out whilst we're gathering
[11:26:20] <saintamh> Is that likely, or am I mistaken?
[11:27:05] <saintamh> I tried passing in a `heartbeat_timeout` in the ConnectionParameters, but that doesn't seem to have any effect
[11:27:16] <saintamh> I'm using a vanilla RabbitMQ install
[11:34:28] <amercader> saintamh: sorry, I can't help with rabbitmq as I haven't used it, but I recommend using the redis backend. I never had any problem with it even on large harvests
[11:35:00] <saintamh> amercader: I'll give that a try, thanks
[12:35:20] <saintamh> amercader: ah, much better with Redis. Thanks!
[12:55:30] <amercader> saintamh: glad you got it working. I think I'll just deprecate the rabbitmq backend or at least not make it the default
[14:19:46] <LondonAppDev> Hey guys, which version of solr-jetty works best with CKAN?
[16:51:07] <jrods> amercader: cool, thanks, just wanted to make sure =)
[18:49:15] <jrods> amercader, tktech: I'm trying to run master and I'm getting an import error for `from flask.ctx import _AppCtxGlobals` on paster db upgrade, I'm using a virtualenv as well
[18:55:29] <jrods> nvm, i forgot to pip install the requirements.in and dev-requirements.txt
[20:04:29] <jrods> amercader, tktech: ok, i believe i have core ckan working, but now I'm trying to run the bcgov extension with master, once issue im running into is ckan.lib.base, we have been using the redirect function, which im guessing was from pylons.controller.util , what do you recommend we use? toolkit.redirect_to ?
[20:12:07] <amercader> jrods: yes, in general always use toolkit from an extension of what you need is there. And if not maybe we can add kt
[20:12:13] <amercader> *it
[20:13:24] <tktech> Sorry, haven't been watchin IRC today.
[20:13:56] <tktech> Almost everything is imported from toolkit as amercader mentioned, other than 'g' and 'c' which come from common
[20:16:14] <amercader> c should be avoided anyway, as will be progressively deprecated with the new flask templates
[20:22:35] <jrods> ok just checking, thanks. I just wanted some reassurance =) , ill have to convert those functions with the one from toolkit
[22:52:16] <xApple> Ouch, now I'm hitting this error with celery
[22:52:18] <xApple> AssertionError: daemonic processes are not allowed to have children
[22:52:41] <xApple> I guess it's good you are getting rid of it in the next version. 2.7 can't come quick enough.
[22:53:11] <xApple> But for the moment, it means you can't use any function or module that spawns subprocesses, which is quite some liimitation

2017-03-20
[15:47:06] <xApple> Hello!
[15:47:30] <xApple> I'm making a plugin for my ckan installation and I have a little question, maybe you can help.
[15:48:18] <xApple> My plugin enables the launching of some bkgnd jobs with toolkit.enqueue_job()
[15:48:24] <xApple> Which is all good.
[15:48:54] <xApple> But the end result of the background job, once it is done computing, is to add a dataset to a specific group in CKAN.
[15:49:10] <xApple> And I'm wondering how to do this, since it's running a in a different python interpreter.
[15:49:26] <xApple> Should I use the network API and communicate with the CKAN installation like that to add the dataset?
[15:50:25] <xApple> But then I need the API key of the user that started the background, or resign to having all datasets generated in this manner be added by the same sysadmin user and only record one API key.
[15:50:29] <xApple> What do you think?
[15:51:27] <torf> xApple: First of all, please note that the new background job system hasn't been officially released (it probably will be part of CKAN 2.7). Right now, the "official" way for CKAN 2.6 and older is to use the "old" Celery-based system.
[15:51:42] <torf> But now to your question (which also applies to Celery-style background tasks)
[15:51:56] <xApple> OK, I'm using 2.6.0
[15:52:33] <torf> OK, then you'll need to use Celery instead. See http://docs.ckan.org/en/ckan-2.6.1/maintaining/background-tasks.html
[15:53:19] <xApple> Yeah so it will be celery.send_task() instead I see
[15:53:36] <xApple> Still what about dealing with the final product of the background job ?
[15:54:17] <torf> The easiest way to do things like this is to get a working CKAN environment in your background task. Once that is done you can call the action functions via toolkit.get_action(...) as you would do in "normal" (non-background) CKAN code.
[15:54:55] <torf> You can take a look at ckanext.extractor to see how this can be done: https://github.com/stadt-karlsruhe/ckanext-extractor
[15:55:39] <torf> In particular, take a look at how the CKAN environment is loaded at the beginning of the task in ckanext.extractor.tasks.extract: https://github.com/stadt-karlsruhe/ckanext-extractor/blob/17739d403622b94bb8231ede008a0f8cf4d16be1/ckanext/extractor/tasks.py#L53
[15:56:50] <torf> With the Celery system it takes some work to get things going. That's one reason why the new system was developed, it handles a lot of that automatically.
[16:02:21] <xApple> OK thanks for that starting point
[16:02:27] <xApple> I'm going try and come up with something
[16:03:11] <xApple> Seems like you need those two functions load_config and register_translator
[16:04:18] <torf> You're welcome! If you haven't already, it's also a good idea to sign up for the CKAN developers mailing list: https://lists.okfn.org/mailman/listinfo/ckan-dev
[16:11:23] <xApple> OK I'll check it out. Mailing lists seems so old school though. As you are producing an online DMS, why not use a bulletin board  la phpbb or a subreddit.
[16:14:16] <amercader> xApple: mailing lists will still be here when reddit is gone :)
[16:14:36] <amercader> xApple: seriously, you can also post questions on StackOverflow with the #ckan tag
[16:15:09] <xApple> OK yeah I've seen a bunch of good questions there already!
[16:33:52] <xApple> Can I bother you guys again? I can't get the "paster celeryd" command to work.
[16:33:59] <xApple> The error messages I get are here http://pastebin.com/qRPvfHYN
[16:34:12] <xApple> The documetnation says that the command only works "This only works if you have a development.ini file in ckan root.
[16:34:42] <xApple> But is that the same ini file that ckan uses? (the one at /etc/ckan/default/development.ini)
[16:52:48] <xApple> OK Well I figured out a solution. I had installed the latest version of celery (4.0.2) and only by installting the latest 3x (3.1.24) did it work
[16:52:58] <xApple> You probably want to put that in the documentation for ckan 2.6.1
[16:53:54] <xApple> Especially since right now it just says "Installation of celery will normally be taken care of by whichever component or extension utilizes it so we skip that here."
[18:00:31] <jrods> amercader: I'm currently working on a task that is investigating on moving from our client's fork of ckan, back to install with pip. I'm just looking at features we've had merged, and I noticed the file size and mimetype of resource files are not included in v2.6, are those changes going to be included in v2.7?
[18:10:06] <merk> anyone here help with tracking configuration on 2.5.4 no matter what I have done I can not get trakcing to return results
[18:13:41] <merk> I can see tracking coming back from the API and I can see the tables in the DB but when I update the search index they are not being added.
[18:21:31] <merk> does anyone actually monitor this room?
[18:27:35] <xApple> I think there are, I got an answer to a question I asked today
[18:29:23] <merk> ok thanks just checking I am looking back through the IRC logs and found some help
[18:29:39] <merk> thanks for the reply
[18:56:16] <merk> I am still unable to get the tracking results in the solr index I can get them to return to the api but not in the index is there somewhere else that inlcude_tracking=true ?
[22:36:54] <xApple> I've got an easy question: about the absolute path of uploaded resource in filestorage
[22:36:59] <xApple> So a resource with id 5f090a10-45d6-4ebb-a2ed-db016e2b3f15 has this path
[22:36:59] <xApple> <ckan.storage_path>/5f0/90a/10-45d6-4ebb-a2ed-db016e2b3f15
[22:37:36] <xApple> It is always going to be true ? Is it always going to split on chars 0-2 and then 3-5 ?
[22:38:41] <xApple> Is there another more easy way to identify the absolute path of the file?
[22:38:59] <xApple> Didn't find anything about this in the documentation
[23:28:51] <tktech> xApple, that's right, it's just the resource ID.

2017-03-19
[11:01:53] <Ingineer> Hey I figured it out in the end. It's really a nice little tool!

2017-03-18
[16:39:41] <Ingineer> Hello everyone
[16:41:22] <Ingineer> I'm writing a plugin for CKAN, and had a small quesiton about implementing plugins.IActions
[16:41:28] <Ingineer> Would this be the right place to ask?
[21:11:48] <tktech> Yes, although most of us aren't around too much on the weekends

2017-03-17
[12:04:49] <thenets> Hi. It's possible enable gzip with "paster server"? Or I need to use Apache with WSGI?
[13:53:02] <torf> thenets: "paster serve" is only intended for development and debugging and AFAIK doesn't support anything fancy like compression, etc.
[14:18:58] <thenets> torf: thanks. So I'll setup my apache server.
[15:31:36] <torf> For debugging a Pylons issue I've added log statements to some of the code shipped with Pylons, but they don't show up although my logging configuration says they should. Do we disable Pylons logger somewhere?
[16:34:26] <tktech> torf, just double checking; you've setup your logger_* stubs in the ini?
[16:35:32] <tktech> The only place I know of where we explicitly trample the debugging is the markdown parser
[17:42:13] <torf> tktech: Turns out I forgot to restart Apache ><
[17:42:23] <torf> Thanks nevertheless
[17:42:36] <torf> A nice week-end everybody!

2017-03-16
[11:46:17] <teemu> Hi, I'm trying to add a user with a specific apikey using paster, but the "apikey=api-key-here" doesn't seem to do anything? the output has an entirely different one
[11:46:46] <teemu> according to "paster --plugin=ckan user create --help" it should work
[12:59:54] <teemu> oh, just found this https://github.com/ckan/ckan/issues/3215

2017-03-15
[08:23:13] <bubo> I have created a vocabulary and added the input fields in the dataset form. When I create a dataset the tags don't get saved with the dataset, but if I update a dataset they will get saved
[08:23:18] <bubo> any ideas why that might be
[09:16:37] <tktech> amercader, torf if you're aware of any old issues related to performance and scaling, please add them to https://github.com/ckan/ckan/projects/1
[09:17:16] <tktech> I have a test instance of CKAN with 15 million datasets and am resolving performance/scaling issues one by one as I find them
[10:07:52] <realitygaps> hmm is there any csrf protection in ckan?
[10:10:57] <Zharktas> there wasn't at least in 2.5, we made our own but i have no idea has it advanced further since security issues are not discussed publicly
[10:11:18] <realitygaps> we just failed some parts of a security test due to no csrf protection
[10:11:38] <realitygaps> Zharktas: is yours the ThrawnCA code?
[10:14:12] <Zharktas> we hack the ckan core for csrf protection https://github.com/vrk-kpa/api-catalog/blob/master/ansible/roles/ckan/files/patches/csrf.patch
[10:14:37] <Zharktas> not generalized though, so probably does not work in all instances
[10:14:56] <realitygaps> ah thanks. we have a standard 2.6.1 so maybe it will work
[10:15:05] <realitygaps> but useful information to provide nontheless thx
[10:15:46] <Zharktas> that patch has been tested with 2.6, so it might work for you
[10:16:04] <realitygaps> great, will give it a go later on a clone
[10:16:19] <realitygaps> tyvm
[12:33:42] <torf> tktech: None that I currently know of
[12:53:13] <realitygaps> is there an easy way to restrict uploads to specific file types?
[13:02:23] <poli_> Hi guys!  Is there a place where I can read about how to run CKAN's tests? I've done a source install and I cannot run python's tests successfully. Are there any known issues regarding running the tests?
[13:26:06] <tktech> realitygaps, not really. It's not really possible to do correctly.
[13:26:27] <tktech> You can only guess at types or trust the user.
[13:26:46] <tktech> poli_, http://docs.ckan.org/en/latest/contributing/test.html#run-the-tests
[13:27:07] <tktech> poli_, what error are you getting?
[13:27:48] <poli_> I was following the guide... I knew I shoulda taken that left turn at Albuquerque!
[13:28:21] <poli_> I'll go through it again and if have more issues I'll come back, thanks!
[14:02:34] <realitygaps> tktech: ok thx
[15:03:21] <tktech> amercader, are you here? Urgent
[15:04:57] <amercader> tktech: yes
[15:05:10] <tktech> amercader, please see issue #3484
[15:05:21] <tktech> We need to do a backport and security release ASAP
[15:33:27] <bubo> tktech: I see you have created an issue about 'metadata_modified' that is set to null. Did you find out why it gets set to null? I had the same issue a few days ago and I couldn't figure it out
[15:33:41] <tktech> Yes, because we delete it.
[15:34:21] <bubo> But in which scenarios? Out of 120 datasets, 20 got null for metadata_modified
[15:34:49] <bubo> I didn't have enough information to try and reproduce the issue
[15:36:02] <bubo> also those datasets with 'metadata_modified'=null broke other stuff in ckan
[15:37:42] <bubo> I will check the pull request for more information, if there is any
[22:02:12] <bubo> For resource extras, you need to have convert_from_extras as the first item in the schema. I think this should be documented somewhere

2017-03-14
[12:47:24] <lgomez> Hi! I'm working in a project with ckan 2.5.3, recently there was a new ckan realeas and the url http://packaging.ckan.org/python-ckan_2.5-trusty_amd64.deb returns ckan2.5.4 which breaks the project (I know, it should not happen). The main reason is one of our plugins. We need to fix it. meanwhile I need to download the ckan2.5.3 deb file. Where I can find it? Thanks in advance
[12:56:00] <Zharktas> lgomez: older patch releases are not supported, you can get the code github but i'm guessing that you have to build the deb file yourself
[12:57:19] <Zharktas> https://github.com/ckan/ckan-packaging you probably can use this to build it though
[13:11:09] <lgomez> Thank you Zharktas, i'll try it
[14:49:54] <tktech> Not a huge fan of "native" packages for platforms with CKAN
[14:50:19] <tktech> It's not any more difficult to setup from github except it's up to date and tends to have fewer issues
[14:53:07] <bubo> Can I use vocabularies to add multiple select input to dataset and than use them as search filters (like the tags)
[14:53:14] <bubo> or am I looking in the wrong direction

2017-03-13
[16:00:53] <bubo> When you save multiple values for a key in extras, ckan saves it like this {first,second}
[16:01:15] <bubo> how can I concatenate that and get first & second
[16:01:41] <bubo> {{ value|join('&') }} just gives me f&i&r&..
[16:30:11] <Zharktas> bubo: when that happen, your value is a string instead of list
[16:35:00] <bubo> Zharktas: yes I know
[16:35:21] <bubo> Zharktas: what would be the best way to get it back to list?
[16:36:25] <torf> bubo: In my experience, the easiest way is to store it as a JSON-encoded string in the first place and then simply parse the JSON afterwards. That works fine if you set the extras automatically, but may be cumbersome with manual edits.
[16:37:30] <Zharktas> you would have to modify your validators so that it is returned as list from db
[16:52:36] <bubo> Zharktas: validators? I only have ignore_missing and convert_to/form_extra
[16:52:44] <bubo> /s/form/from
[16:58:11] <Zharktas> https://github.com/ckan/ckan/blob/master/ckan/logic/converters.py#L185
[16:58:32] <Zharktas> add that to your validators and it should be list in templates
[16:58:43] <Zharktas> although i have not tested it :p
[17:02:54] <bubo> Hmm, I think that only returns a list from the string. So if value="test", this will return ["test"]
[17:08:07] <Zharktas> you're right, shouldn't have just guessed some converter for that :D
[17:09:04] <Zharktas> you would either have to store it as list in the first place or write a validator that splits the string and return it
[17:09:33] <Zharktas> ie. "foo,bar".split(",")
[17:13:57] <Zharktas> you can probably split in jinja too, {{ value.split(",")|join('&') }}
[17:14:03] <Zharktas> apparently it actually works
[17:14:25] <Zharktas> as long as you dont have colons in your strings
[17:36:05] <thenets> Hi, you know how can I re-download all datasets with ckanext-archive?
[17:37:28] <bubo> Zharktas: the thing is, ckan stores is like this {first,second}. So you would get {first & second}
[17:37:41] <bubo> i just wanted a better way to do it than this

2017-03-12

2017-03-11

2017-03-10
[13:05:55] <bubo> What is the best way to check why translations aren't working?
[13:06:05] <bubo> How do you start debugging this?
[17:22:08] <danse> Does anyone here have experience installing archive on 2.6?
[17:22:13] <danse> archiver*
[17:22:54] <danse> I'm running into an issue where the cached versions of datasets don't show up on the dataset page

2017-03-09
[15:24:34] <bubo> I have a client that has a script which uses package_create and package_update to create and then update the datasets. Some datasets get created with 'metadata_modified' as null. Any ideas how this can happen?
[15:26:12] <wardi> it probably shouldn't. Do you have a reliable way to reproduce the issue?
[15:28:21] <bubo> no
[15:29:37] <bubo> I have asked for a failing dataset so I can try creating it myself
[15:32:45] <bubo> package_udpate does this model.Session.query(model.Package).filter_by(id=pkg.id).update(
[15:32:48] <bubo> {"metadata_modified": datetime.datetime.utcnow()})
[15:32:50] <bubo> y
[15:32:52] <bubo> How is this set to null?
[15:33:47] <bubo> but below it in package_dict_save, there is   del pkg_dict['metadata_modified']
[19:15:48] <thenets> jrods: Hi. Good to see more Dockerfiles for CKAN :D I have some tips: after version 1.13, now Docker have a lot of new features e many commands has been changed
[19:17:03] <thenets> jrods: for example, you can delete containers with "docker container rm (containerName)" or follow log with "docker logs -f (containerName)"
[19:17:52] <thenets> jrods: take a look at new Docker version :) you can improve a lot your project with those features
[19:28:45] <jrods> thenets: thanks =) i will check it out
[19:47:20] <thenets> jrods: ^^
[20:10:52] <tktech> bubo: I'll have a fix for that and the tests up in a few
[20:10:56] <tktech> YOu
[20:11:02] <tktech> *You're not the first to notice that
[20:11:11] <tktech> Been an issue for others
[21:26:57] <tktech> bubo: https://github.com/ckan/ckan/issues/3475
[21:27:01] <tktech> bubo: Give the attached PR a shot.
[21:35:08] <tktech> There should be literally no way for metadata_modified to be incorrect now
[21:59:06] <tktech> Huh, that might have accidentally exposed why datapusher keeps getting stuck in loops

2017-03-08

2017-03-07
[07:54:33] <amercader> jrods: no idea sorry. Perhaps you need to run paster minify?
[07:58:34] <Zharktas^> in stock ckan, bootstrap in bundled with ckan css
[07:59:44] <Zharktas> here https://github.com/ckan/ckan/blob/master/ckan/public/base/css/main.css
[11:23:47] <LondonAppDev> Hey guys, anyone have any opinions on dockerizing CKAN?
[11:42:45] <torf> LondonAppDev: There some stuff in the repo (https://github.com/ckan/ckan/tree/master/contrib/docker), but I have 0 experience with it
[11:43:19] <LondonAppDev> :) cool, thanks torf yeah I had a look at that.
[13:38:47] <klikster> Hi everyone. I want to add a "Skip" button in the "Add a new resource" form UI located after creating a new dataset (the second stage). When this button is pressed, I want to skip the process of adding a resource, i.e. create a dataset without a resource. Looking through the CKAN's core code, I can see that the action for creating a new resource is in the package.py file in the controllers, called "new_resource". Is there a way to ov
[17:54:38] <jrods> LondonAppDev: I just recently did a little competition with ckan, using docker -> https://github.com/highwaythree/battlesnake-env
[17:56:26] <jrods> im fairly inexperience with docker myself, this was my first time with it, had troubles with sharing dev repos, windows, etc.
[17:56:53] <jrods> the repo is not complete, but you can use it as a reference

2017-03-06
[11:06:33] <danse> hey hey
[17:02:31] <geok108> does anyone has an idea how to implement a single doc harvester for spatial data?
[23:58:09] <jrods> amercader: for the geoview ext, why was this commit reverted -> https://github.com/ckan/ckanext-geoview/commit/71f59cdb6b4cd598018f71655e772ea86289578e ?
[23:59:18] <jrods> where is the intended location for css/bootstrap.min.css ? In the environment I'm working with, on page load, the reference is 404

2017-03-05
[02:59:03] * tktech grumbles
[02:59:09] <tktech> These tests are aggravating
[02:59:40] <tktech> The results are inconsistent which is the absolute worse.

2017-03-04
[19:06:10] <tktech> amercader: https://github.com/ckan/ckan/pull/3466 if you have time
[19:40:15] <tktech> Nice, that legacy test fails differently depending on what tests are run adjacent to it \o/
[19:54:22] <bubo> Does anyone know how I can get the extras for a group queried with model.Session.query?
[21:06:37] <tktech> bubo, Shoudl be no different than usual
[21:06:45] <tktech> model.Session.query(model.GroupExtra)
[21:07:35] <tktech> model.Session.query(model.GroupExtra).filter(model.GroupExtra.group_id==group.id)

2017-03-03
[13:05:22] <ksivakov> thenets: thanks for the hint

2017-03-02
[00:01:59] <thenets> @ksivakov, @wardi I've created a Docker file for testing CKAN 2.6.0 http://pastebin.com/QJDsT46f . At line 51 you can see modifications I need to do to work from 2.5.2 to 2.6.0
[00:17:31] <tktech> This isn't twitter the @ does not ping someone. Just start typing their name and press tab.
[00:20:08] <bubo> :)
[01:39:02] <thenets> ^^' sorry...
[01:40:54] <thenets> I did not know I could autocomplete with tab!
[01:41:12] <thenets> cool
[10:48:59] <torf> I'm having problems with repoze.who redirecting to Apache instead of Nginx after log in -- it worked fine before and I can't figure out how i broke it :( Any pointers?
[10:55:11] <torf> The login itself works, it's just that Apache isn't available from the outside so users get an error message and have to manually enter a correct URL
[14:03:20] <wardi> amercader: join us for meeting?
[16:31:53] <tktech> http://opendata.stackexchange.com/questions/10756/versions-of-ckan-datasets-and-its-resources
[16:31:57] <tktech> Hm
[16:32:22] <tktech> To me it looks like while we have group_/org_/package_/revision_list APIs we're missing a similar one for resources
[16:32:37] <tktech> Am I just blind? Otherwise I'll add it.

2017-03-01
[00:59:17] <vnz> what's the status of migrating ckan from pylons to flask?
[02:47:18] <thenets> hi, you know how can I change "content-type"? I've tried to change: pylons.request.content_type = "text/xml, application/xml"
[02:47:22] <thenets> mas no funcionou
[02:47:34] <thenets> ***but doesn't work
[15:31:34] <wardi> thenets: https://github.com/ckan/ckan/blob/master/ckanext/datastore/writer.py#L137-L138 works for me
[15:32:09] <wardi> (setting the response content type, not sure what setting the request content type would do)
[15:47:17] <ksivakov> we have issue when we are using docker and creating production.ini with config tool, for ckan 2.6 we get this error
[15:47:18] <ksivakov> https://gist.github.com/tino097/27e0e146a7cac2c02d14787705b7338d
[15:48:27] <wardi> are you generating a [formatters] section in your ini file?
[15:50:30] <ksivakov> we are generating the file with paster --plugin=ckan make-config ckan ${APP_DIR}/production.ini
[15:50:50] <ksivakov> so i guess it will generate [formatters] too
[15:51:21] <wardi> are you sure your setup is using the config file you think it is?
[16:04:33] <ksivakov> im not sure about that but production.ini contains only [app:main]
[16:04:43] <ksivakov> nothing else
[16:18:22] <wardi> that doesn't seem right
[23:57:23] <thenets> @wardi, thanks! :D
[23:57:49] <thenets> @wardi It's exactly what I need

2017-02-28
[08:24:45] <danse> Would anyone here be able to help me what is apparently either a ckanext-scheming problem or an sql-alchemy bug?
[08:24:58] <danse> Not bug, an error
[08:26:10] <danse> Running into this "Incompatible collection type: unicode is not list-like". Unicode is listed as a validator for one of the fields in the scheming json file I'm applying
[08:27:09] <danse> I'm not entirely sure if I'm drawing a false connection between those or not. The server error happens immediately after submitting the first step of the "Add Dataset" form
[09:36:10] <realitygaps> hmm. after enabling ssl we are having some mixed content errors on /api/i18n/en
[09:36:17] <realitygaps> any idea where i can change this to work over ssl?
[09:42:44] <realitygaps> i followed the wiki page on ssl setup
[10:38:28] <realitygaps> or is this fixed in latest 2.5.4?
[10:38:34] * realitygaps will try updating to that point release
[11:20:49] <amercader> realitygaps: did you update your ckan.site_url setting?
[11:26:59] <realitygaps> yes its set to https
[11:34:43] <realitygaps> im also trying to upgrade to 2.5.5 without much luck :/
[11:35:47] <amercader> latest 2.5.x version is 2.5.4
[11:36:21] <amercader> realitygaps: what is the origin of the mixed content error you are getting? This seems like the frontend is not using the right base url
[11:41:09] <travis-ci> aptivate/ckan mapaction-dev-2.5.4 5f0872a https://travis-ci.org/aptivate/ckan/builds/206147787 Martin Burchell: The build has errored.
[11:45:44] <realitygaps> amercader: will take a look when back on computer just headed to lunch
[11:46:08] <realitygaps> thx for help
[11:47:21] <amercader> np
[12:04:15] <bubo> if I have only convert_to_extras as a validator, it will accept empty values right?
[12:04:15] <wardi> amercader: meeting?
[12:04:34] <bubo> what if no value was inputted?
[12:05:31] <Zharktas> bubo: use ignore_missing validator first
[12:06:52] <bubo> Zharktas: I don't want to ignore missing
[12:07:44] <bubo> Zharktas: is it possible to have a required field that can accept empty values (empty string)
[12:08:30] <Zharktas> i would guess that you need to implement a validator which will input empty string if the whole field is missing
[12:08:54] <Zharktas> i think convert to extras will fail if value is missing
[12:09:33] <bubo> Zharktas: no, if a value is missing then it should fail. but if there is "" as value it should pass
[12:10:20] <realitygaps> amercader: ckan site_url is set to https still. mixed content error is thrown on /api/i18n/en
[12:10:29] <realitygaps> or perhaps im misunderstanding the question
[12:12:15] <realitygaps> seems to be coming from jquery.min.js
[12:14:00] <realitygaps> upgrade to 2.5.4 also failed on sqlalchemy-migrate step when i tried it
[12:14:21] <realitygaps> "ImportError: No module named testrepository
[12:33:50] * realitygaps resets the box back to pre-messing it up
[13:14:13] <wardi> bubo: not_missing
[13:54:44] <bubo> For recline_view, is it possible to increase the 1000 limit?
[13:55:38] <bubo> I see dataset.size can be set but where do I override that?
[15:10:36] <ksivakov> the CSV file has 74k records, but in the datastore we have 1450 records, that is due some limit to the datastore, or probably some error occured during the process push_to_datastore ?
[15:11:01] <wardi> most likely the latter
[15:11:36] <wardi> are you using datapusher? it might have guessed the wrong column types
[15:11:46] <ksivakov> yes
[15:12:07] <wardi> you should see the error in the "datastore" tab when editing the resource
[15:12:54] <ksivakov> let me check, but we didnt recieve complaints about the columns , just the number of the records
[15:41:58] <bubo> there was an error but nothing informative, just "server error 500"
[15:52:39] <wardi> check your server logs

2017-02-27
[10:50:48] <thenets> Hi. I need to access helpers created on "plugin.py" from my controller at "controller.py". You know how can I do this?
[10:53:09] <thenets> (doens't exist the methods "h" when I load the controller, but exist on view)
[11:19:43] <thenets> nevermind. I convert all method to a class and create a lib with static methods.
[11:19:53] <thenets> *a class
[11:44:06] <bubo> You can just import helpers and use helpers.your_method
[11:51:41] <thenets> hmm, I need to use from "import ckan.lib.helpers as helpers"? I was trying from "from ckan.lib.base import h".
[11:57:54] <thenets> doesn't work, I don't know why, but I avoid this problem creating a new class. Thanks anyway ^^
[12:14:36] <bubo> No you import it from your extension
[12:15:01] <bubo> How is it possible for a dataset to have NULL value for the metadata_modified attribute in the database?
[12:17:29] <thenets> bubo: hm, I'll try again later, thanks
[13:10:58] <bubo> How can the creator_user_id field also be null n a dataset?
[13:12:37] <amercader> bubo: perhaps you are using a database that was migrated from a previous CKAN version that didn't use these fields? (and the migrations didn't take care of them)
[13:29:11] <bubo> amercader: is there a previous CKAN version that doesn't set 'metadata_modified' and 'creator_user_id'?
[13:31:43] <wardi> bubo: are you accessing the db directly or using the api? is this on a site you control? background information would help us here
[13:38:11] <bubo> wardi: I do have access to the database
[13:38:42] <bubo> I am accessing the database directly and there were datasets from an organization that had 'metadata_modified' and 'creator_user_id' as null
[13:40:25] <wardi> do other users or code access the db directly for creating or updating records?
[13:43:13] <bubo> wardi: I don't have information on that. I already asked if they can provide me with information on how those datasets were created
[13:44:29] <wardi> bubo: generally ckan enforces validation on fields in its code, not by creating rules on the DB. If you don't use ckan's APIs or controllers to create your data all bets are off and there isn't much we can do to answer your question
[13:45:12] <bubo> wardi: so there is no way for 'metadata_modified' to be missing if the datasets were created via the api/ui
[13:45:18] <bubo> that's what I thought
[13:45:43] <bubo> I am not sure if there is a previous CKAN version that didn't use 'metadata_modified' as amercader said
[13:49:36] <bubo> http://docs.ckan.org/en/ckan-2.2.3/changelog.html - so in this version 'metadata_modified' was added and it might cause AttributeError: 'NoneType' object has no attribute 'isoformat' - which is exactly what is happening.
[13:49:37] <Zharktas> bubo: as far as I can tell, metadata_modified has been on the package table since ckan 2.2
[13:50:19] <amercader> bubo: check the changelog
[13:50:33] <amercader> look for "addition of a metadata_modified "
[13:50:37] <amercader> I you got it already
[13:50:41] <bubo> yep
[13:50:43] <Zharktas> bubo: if you are upgrading, you probably should run db migrate
[13:50:51] <Zharktas> which would create them in the db
[13:51:11] <Zharktas> https://github.com/ckan/ckan/blob/master/ckan/migration/versions/069_resource_url_and_metadata_modified.py
[13:51:12] <bubo> I didn't do the upgrading, it was done some time ago. I think they jumped from 2.1.x to 2.5.x but I am not sure
[13:56:31] <amercader> bubo: that would make sense. I think you will end up filling these fields manually. You can check the migration script  that Zharktas  pointed to to see what would ckan have done to fill them and do it manually (or just fill them with utcnow() / sysadmin user id if that fails)
[14:21:12] <bubo> amercader: yes I have already fixed it
[14:21:20] <bubo> thanks for the help
[14:27:37] <amercader> cool
[14:31:45] <bubo> What would be the best way to have background jobs in ckan? For example user can upload a big file that needs processing and that should be put in a background job so it doesn't timeout the response
[14:31:52] <bubo> maybe just threads?
[14:33:32] <wardi> http://docs.ckan.org/en/latest/maintaining/background-tasks.html will be in the next release
[14:33:33] <bubo> Ah nevermind there is support for background tasks in ckan, nice
[14:33:56] <bubo> wardi: They are not implemented now? In 2.5.3 for example
[14:34:52] <wardi> bubo: you can use celery in 2.5 http://docs.ckan.org/en/latest/maintaining/background-tasks.html#supporting-both-systems-at-once
[14:36:22] <bubo> nice
[15:37:40] <bubo> Is any version of Celery supported for background tasks?
[15:55:24] <bubo> I get this https://paste.noname-ev.de/8465 when trying to run paster celeryd --config=/path/to/config
[16:00:53] <thenets> Hi, another problem: you know how to get URL arg from controller? Here a example http://pastebin.com/3J5sf4eb
[16:03:55] <bubo> your index should be def index(self, slug)
[16:06:36] <thenets> oh, thanks! I tried with differente var name and doesn't work.
[16:06:50] <thenets> now it's working, thanks bubo
[16:07:11] <bubo> np
[16:25:17] <bubo> Okay, background tasks in 2.5.3 don't work with Celery 4, but they work with 3.1
[16:57:37] <Zharktas> most of the older extensions might still be using celery 2 though
[21:31:11] <jrods> @wardi do you know how a new resource automatically gets a datastore table? I'm looking through core ckan and can't find it
[21:32:05] <amercader> jrods: it's the datapusher who does the automatic loading (if you have the extension enabled)
[21:32:29] <amercader> http://docs.ckan.org/en/latest/maintaining/datastore.html#datapusher-automatically-add-data-to-the-datastore
[21:33:18] <jrods> yes they are automatically loading, ill have a look at that page
[21:33:23] <jrods> the main issue im having is the resources im uploading through the filestore api, are not getting a unique key
[21:33:47] <jrods> the resource file is a csv
[21:47:55] <jrods> @wardi i still dont understand/cant find out how creating a new resource is automatically creating a datastore table for the new resource
[21:58:09] <jrods> oops forgot to tag you @amercader
[22:00:57] <jrods> amercader: anyways im not seeing any hooks to after_create for datastore or datapusher , is the datastore call initiated somewhere else?
[22:14:42] <amercader> (sorry jrods, time for bed :) I'll be around tomorrow)
[22:25:30] <jrods> amercader: no worries =)

2017-02-26
[20:11:08] <tktech> wardi, #3444 is looking nice
[22:28:28] <wardi> the logic involved in making the filters work is pretty complicated. looks like it's all implemented in JS for recline, I'll have to see how to generate the same sorts of queries

2017-02-25

2017-02-24
[07:09:45] <danse> HI
[07:11:01] <danse> I'm running into a CKAN config problem that I can't seem to find any information on. Anyone open to seeing if they could help?
[07:13:01] <danse> The logged error I'm seeing indicates that CKAN is requiring a solr schema version higher than it ships with. CKAN version 2.6.0 with solr schema 2.3 and it's requiring 2.7 which as I understand it ships with 2.7
[07:28:16] <Zharktas> danse: i you are running ckan 2.6, it requires schema 2.3
[07:28:33] <Zharktas> i you are running some master branch from github, it requires 2.7
[07:29:36] <danse> Right so in this case the version that has shipped with the ckan version I'm using is 2.3
[07:29:50] <danse> I've symlinked that to /etc/solr
[07:30:11] <danse> or /etc/solr/conf rather
[07:31:16] <danse> and so the error is that ckan is reported that it needs the 2.7 version, but it's shipped with the 2.3 version.
[07:32:18] <danse> It's possible that I had installed the master version however, which would mean that the requirement for 2.7 is somehow cached. But where might that be?
[07:32:40] <danse> Installed it previously that is.
[07:34:10] <Zharktas> https://github.com/ckan/ckan/blob/master/ckan/lib/search/__init__.py#L34
[07:34:11] <Zharktas> here
[07:34:40] <Zharktas> in 2.6 releases it should be 2.3
[07:34:57] <danse> Heh, thanks. I was just about to say that the __init__.py script in the CKAN src directory listed supported versions of 2.3 and not 2.7
[07:35:28] <danse> But then I noticed that the version in site-packages says 2.7
[07:37:24] <danse> Is there any non-destructive way to force an update of ckan in site-packages? I'm not incredibly familiar with how that directory operates
[07:38:28] <danse> and with that said, is that where ckan src is loaded from rather than /usr/lib/default/src/ckan?
[07:38:42] <Zharktas> sounds like you have two ckans installed and you are running the wrong one
[07:38:59] <Zharktas> since it should be in /usr/lib/default/src/ckan
[07:39:03] <danse> I think you're right
[07:40:46] <danse> Well the ckan src is in the /usr/lib/default/src/ckan directory. I must have made a mistake however, though I don't recall intentionally operating on the site-packages directory. How might something get installed there?
[07:41:12] <danse> This is likely the cause of a lot of problems I've had recently
[07:41:37] <Zharktas> if you install something with pip, it ends up in site-packages
[07:42:04] <danse> That would be it,
[07:42:05] <Zharktas> or something without specific parameters
[07:42:49] <danse> So if I simply clone the repo and run python setup.py install this wouldn
[07:42:52] <danse> wouldn't happen
[07:44:52] <Zharktas> pip install is practically the same as python setup.py install
[07:45:30] <Zharktas> i think python setup.py install would install it in site-packages
[07:45:45] <Zharktas> python setup.py develop would install it to src
[07:46:54] <danse> I see. That's a little confusing and I suppose I didn't recognize the difference. Some extensions recommend installing via any one of those three methods
[07:47:45] <danse> Including doing syntax like pip install ckanext-viewhelpers for example. Without pointing to a git repo
[07:48:26] <Zharktas> with extensions it really doesn't matter as long as they are in the same virtualenv
[07:49:20] <Zharktas> with ckan itself you have bunch on configuration that has to point in specific directory, like apache or nginx for example
[07:50:47] <danse> Which might be why running paster serve with my virtualenv activated allows ckan to run, while running it in production in apache behind nginx is giving me trouble
[07:53:43] <Zharktas> http://docs.ckan.org/en/latest/maintaining/installing/index.html i do recommend official install guides though. it's rare to make a mistake if the guide is followed
[07:56:34] <danse> I was following the source install official doc, but must have made a mistake somewhere. I think the information you're helping me with now will lessen that. Helps to have an understanding of what's going on.
[07:57:45] <danse> Do you know how files are loaded when running in apache? Are installations in site-packages favoured over src?
[07:58:47] <Zharktas> if installed from pre-built package, ckan resides in src
[07:59:44] <Zharktas> in the source install docs "pip install -e 'git+https://github.com/ckan/ckan.git@ckan-2.6.1#egg=ckan'" that -e flag installs it to src
[08:02:36] <danse> Would you say that's preferable or not?
[08:03:32] <Zharktas> yes, i have never seen ckan install in which it is installed in site-packages :p
[08:04:02] <danse> Ha, well that is pretty funny
[08:06:54] <danse> So I might as well try and get a better picture of how things operate. Based on what you've said, for the most part I'm doing something wrong if ckan is installed in site-packages. It doesn't matter if extensions are installed in site-packages as long as the virtualenv is activated. What else would I expect to go in there and not cause me headaches?
[08:07:51] <danse> Sometimes I run into a problem where the installation of an extension requires an import that isn
[08:08:19] <danse> isn't found. One approach to eliminating the error is to run a pip install, which I now know throws it in site-packages.
[08:09:17] <Zharktas> you should install extensions dependencies from requirements.txt
[08:09:33] <Zharktas> with pip install -r requirements.txt
[08:09:58] <Zharktas> they are not installed by default and will give error when extension is executed
[08:13:24] <danse> That's what I've done if there is one. The occasional time I've run into an issue outside of that. I don't have a specific reference though. If there isn't a requirements.txt and I still run into an import problem, maybe a conflicting library version, is there an alternate approach you'd suggest?
[08:14:42] <danse> Documentation is usually pretty clear on that fortunately
[08:17:14] <Zharktas> conflicting versions are rare but they do happen, especially if you run fairly new ckan and some old extensions
[08:17:45] <Zharktas> the extensions should be updated to support newer ckan but it might be difficult
[08:24:42] <danse> Well thanks a lot for the help. Gives me quite a bit more to work with than I had before.

2017-02-23
[13:27:20] <amercader> wardi, ksivakov: I'm really sorry for the late notice but I won't be able to join the dev call, you guys go ahead. Sick kid at home :|
[13:29:05] <ksivakov> np, hope he/she will be good soon
[16:35:50] <gnat_x> i'm trying to use ckanapi to load a users file (and next a datasets file), but i keep getting a ckan.logic.NotFound error. i have activated the virtualenv, and pip installed all the requirements; not sure what to do next.
[16:36:31] <gnat_x> this is in ubuntu 14.04 installed using the docs for ubuntu.
[16:38:59] <bubo> Are you sure you are using the correct username or id?
[16:40:10] <gnat_x> bubo: system user? or something else? (sorry confused by the question)
[16:43:53] <bubo> what are you trying to do exactly? What do you mean by loading a users file?
[16:53:23] <gnat_x> bubo: i'm tring to migrate users and datasets from one server instance to another. so on the oldserver i use ckanpi dump to generate some json files. i am attempting to import those into my clean ckan install.
[16:54:40] <gnat_x> bubo: i just attemtped to run the ckanapi load users command as www-data, after activating the virtualenv
[19:41:29] <wardi> gnat_x: can you post the full traceback in a gist or pastebin?
[19:44:27] <gnat_x> wardi: sure can.
[19:45:27] <gnat_x> wardi: https://paste.debian.net/916455/

2017-02-22
[00:19:38] <jrods> however im not fond of the access denied error message printing the function memory location <function action_name 0x...>
[11:53:12] <Zharktas> did transifex just kill their free open source projects ? :D
[11:54:35] <amercader_> oh god really?
[11:55:11] <teemu> wait, what
[12:01:42] <Zharktas> it might have been an error since they updated their pricings today, now it works just fine even though they have a banner that project is over collaborator limit
[12:02:11] <amercader_> I'll ping them to clarify
[13:00:46] <travis-ci> ckan/ckan ckan-2.4.5 8fe1cd2 https://travis-ci.org/ckan/ckan/builds/204181962 amercader: The build has errored.
[13:41:56] <amercader_> New patches releases for 2.4.x., 2.5.x, 2.6.x released, please update https://lists.okfn.org/pipermail/ckan-announce/2017-February/000026.html
[14:05:01] <nigelb> hello! :)
[14:05:10] <wardi> nigelb: hello!
[14:05:22] <wardi> how are you doing?
[14:05:34] <nigelb> Good :)
[14:05:42] <nigelb> Someone asked me a question in here the other day and I missed you all.
[14:08:04] <nigelb> How are things going?
[14:09:39] <travis-ci> ckan/ckan ckan-2.4.6 0da8cd8 https://travis-ci.org/ckan/ckan/builds/204192299 amercader: The build has errored.
[14:10:02] <wardi> I'm still ckaning along. got a few interesting datastore features I'm hacking on
[14:11:00] <nigelb> Are we still using the hacky way of going to a web app that does queuing?
[14:11:21] <nigelb> I was thinking of writing some C code the other day, and I was contemplating writing a C library for ckan for fun.
[14:11:29] <wardi> RQ was merged as a new standard queue, but we haven't moved things over yet
[14:12:54] <amercader_> hi nigelb !
[14:13:04] <nigelb> wardi: neat \o/
[14:13:10] <nigelb> Hey amercader_, how's it going?
[14:13:13] <nigelb> Are we on Flask yet?
[14:13:24] <amercader_> haha almost
[14:13:26] <wardi> there's some progress
[14:13:33] <nigelb> that's more that there used to be!
[14:13:40] <amercader_> we are def on the right track
[14:13:46] <nigelb> Is there https documentation yet for deployment?
[14:13:51] <nigelb> Because if not, I might just write it up.
[14:14:18] <nigelb> with letsencrypt, there's no reason to run http anymore.
[14:14:49] <wardi> ooh. that would be really nice
[14:15:19] <nigelb> The tricky bit is https configurations get old real fast.
[14:16:02] <nigelb> The documentation I once wrote no longer gets an A+ from ssl test anymore.
[14:16:06] <amercader_> I'm reluctant to add general sysadmin / devops stuff as part of the official installation docs, just because we need to support it. But 100% behind of pointing to a page that says "this is a recommended way of deploying ckan under https"
[14:16:27] <nigelb> Yeah, that's the idea I'm goign with.
[14:16:31] <amercader_> "please refer all questions to nigelb " :)
[14:16:41] <nigelb> Point to https://mozilla.github.io/server-side-tls/ssl-config-generator/
[14:17:00] <nigelb> and point to letsencrypt instructions for getting an ssl cert.
[14:17:02] <nigelb> hah
[14:17:10] <nigelb> I still follow the mailing list when I'm bored.
[14:17:15] <nigelb> still subscribed to it I think.
[14:18:53] <amercader> nigelb: I was going to ask to make wardi and me ops but we've tried many times before and it never stuck for me
[14:19:01] <nigelb> oh, let me see.
[14:20:02] <nigelb> that should stick
[14:20:03] <nigelb> :)
[14:20:07] <nigelb> as long as you identify
[14:20:11] <nigelb> (with nickserv)
[14:20:57] <nigelb> wardi: if you can register your account, I can give you op as well.
[14:21:02] <nigelb> see /msg nickserv help register
[14:21:59] <amercader> I'll try to log out and check
[14:22:47] <amercader> nice
[14:22:53] <amercader> thanks nigelb
[14:23:41] <nigelb> no problems :)
[14:24:45] <wardi> nigelb: done
[14:26:02] <nigelb> and now you do as well :)
[14:26:14] * wardi feels powerful
[14:30:52] <amercader> Zharktas, teemu: I checked with transifex, all good. Still free for open source projects
[14:32:31] <Zharktas> ah good, their new pricing pages are just confusing :p
[15:44:01] <teemu> :)

2017-02-21
[09:32:06] <thenets> Hi, I'm here again ^^' you know how can I create a file for each
[09:32:37] <thenets> ** for each controller class on "controller.py"
[09:32:43] <thenets> ?
[11:49:58] <thenets> Exist a guide to create custom helpers for my extension?
[11:57:27] <bubo> Helpers are just functions that you can call from templates
[11:57:30] <bubo> What do you need exactly
[12:10:08] <thenets> I'm creating a set of pages with custom code
[12:10:11] <thenets> example:
[12:11:29] <thenets> when I go to http://site.com/news I need to get a JSON from a URL, convert dict and send to my template
[12:12:58] <thenets> but I don't know how where I need to put my files and code. I can't find a guide, so I'm trying to read other extensions like ckanext-pages and ckanext-harvest
[12:13:20] <bubo> is site.com a ckan instance?
[12:13:25] <thenets> ** know where I need
[12:13:28] <thenets> yes
[12:13:56] <thenets> I create the route to news and render a template
[12:14:19] <thenets> but I don't know how to create a class
[12:16:31] <thenets> class class MyController(p.toolkit.BaseController):
[12:16:31] <thenets> def getJson(url):
[12:16:32] <thenets> return "testing"
[12:16:32] <thenets> def index():
[12:16:32] <thenets> myjson = self.getJson("http://testing")
[12:16:32] <thenets> return myjson
[12:17:16] <thenets> here a example. The route to "index()" is working, but I can't call others methods
[12:18:00] <thenets> (ignore the ";")
[12:30:12] <bubo> What other methods
[12:41:15] <thenets> getJson()
[12:41:42] <thenets> this line doesn't work: myjson = self.getJson("http://testing")
[12:42:27] <thenets> TypeError: unbound method getJson() must be called with MyController instance as first argument (got nothing instead)
[12:42:49] <thenets> I don't know what this error message mean
[13:45:17] <wardi> I don't think that's the exact code you're running
[13:45:36] <wardi> would you use a pastebin or gist to show is what you're actually trying?
[15:05:14] <thenets> yes. I'm trying some things. I'll create a pastebin now.
[15:13:56] <wardi> you might want to start from the python tutorial on classes
[15:18:56] <thenets> wardi: probably. I've create apps with pure Python and Django. But CKAN is too different
[15:19:39] <wardi> Django isn't a good introduction to python classes because it uses a lot of metaclass magic
[15:22:59] <thenets> hm, what content do you recommend to learn more about Python?
[15:24:09] <wardi> the official tutorial is really good if you're familiar with other programming languages
[15:29:23] <thenets> hm, ok, I'll try it. And here is the pastebin:
[15:29:24] <thenets> http://pastebin.com/Ph0qdB85
[15:30:18] <thenets> all these method was helpers from "plugin.py" and now I'm trying to convert to a controller
[15:39:38] <tktech> wardi: ever tried to hire a rails developer for plain ruby work? That's fun.
[15:40:04] <tktech> Or an ASP.NET dev for C#
[15:40:27] <wardi> or jquery for JS?
[15:40:51] <tktech> Oh god that's my stackoverflow trigger
[15:41:16] <tktech> Every damn "javascript" tagged question has a "Here's how you  do it in jquery" answer
[15:41:25] <tktech> When it's usually ONE LINE of plain javascript
[15:46:01] <bubo_> but but jquery! :)
[20:27:31] <jrods> @wardi @amercader_ @tktech I've implemented some action calls in the extension im working on, but my auth functions aren't being used when i use toolkit.get_action('ext_action')(), the auth functions are defined and work when i use toolkit.check_access('ext_action', context, data)
[20:32:54] <jrods> I've noticed that this commit exempts auth in extensions https://github.com/ckan/ckan/pull/1060/commits/fb59183ca47fe4ec1cc11db78658c836838b6348
[21:03:32] <bubo> This is a really old commit
[21:10:57] <wardi> jrods: you need to call auth functions yourself, it's not automatic
[21:11:22] <wardi> what's exempted is the hand-holding that makes sure core code calls its auth functions
[21:11:25] <wardi> IIRC
[21:11:44] <wardi> *core actions
[21:12:21] <jrods> @wardi ok, but what about calling the action through the rest api <ckan url>/api/action/ext_action ?
[21:12:50] <wardi> yes, inside the action you need to call the auth function yourself
[21:13:11] <wardi> it's strange because it looks like the auth should be called with the same arguments but that's not how it works
[21:14:21] <wardi> actions do some set-up (e.g. loading models required from db) then call the auth which might use those models
[21:14:57] <jrods> ok, seems rather odd to me, but ill make a check in the ext_action(s) then
[21:15:05] <wardi> it is odd
[21:17:36] <wardi> I guess it means that some common code is factored out (getting the model data) but I don't understand why the auth methods all take (context, data_dict) as parameters. they should just be passed the things they need AFAIC
[21:17:53] <jrods> i've noticed that the ext that im working on does have the ApiController action method, i can do the check_access calls there rather then inside the actions themselves
[21:19:19] <wardi> that probably won't work if you've overridden the core API controller
[21:19:38] <wardi> the auth functions are expecting a modified data_dict not the ones passed by the user
[21:20:44] <jrods> these action functions are not overwriting core actions at all, they are new
[21:21:04] <wardi> why would it need the controller then?
[21:21:40] <wardi> IActions lets you define all the new actions you like
[21:25:50] <jrods> i do add my new actions with IActions, but those actions are now exposed to /api/action/ext_action
[21:37:01] <bubo> That is what actions do. You define actions and they are exposed in the api to be used
[23:38:20] <jrods> wardi: i made a custom decorator to wrap my actions, rather then mucking about with the controller, like you suggested

2017-02-20
[05:19:32] <thenets> CKAN has something like "livereload"? Every design modification I need reload and I don't know if exist something to avoid this.
[05:19:56] <nigelb> thenets: you mean the page reloads on it's own?
[05:20:23] <nigelb> I'm pretty sure it doesn't yet. CKAN is from the age before it was a thing.
[05:20:31] <nigelb> But I suspect it might a useful patch to have.
[05:20:49] <thenets> @nigelb: yes. For exemple: when I change some HTML or CSS the browser auto reload
[05:21:31] <thenets> hmmm. Ok, I'll create some script to avoid this problem
[05:22:18] <thenets> I'm trying to create a new integration for CKAN with Wordpress. Maybe I can create something for this problem too.
[05:26:00] <thenets> thanks @nigelb ^^
[05:30:52] <nigelb> No problems :)
[08:26:33] <Tanya_> i
[13:47:38] <thenets> Hi, I've another problem. I'm trying to install ckanext-spatial on Ubuntu 16.04 with CKAN 2.5.2, but it's not working.
[13:48:41] <thenets> Do you know if exists some issue with this CKAN and Ubuntu versions? Always return error related with Jinja
[13:48:52] <thenets> "nodes not found on list"
[14:48:40] <amercader_> thenets: this happens when you have installed a version of Jinja higher than the one required (Jinja 2.6 for ckan 2.5 IIRC, check the requirements.in file)
[14:49:18] <amercader_> probably one of ckanext-spatial's requirements have an unpinned requirement on Jinja
[18:33:45] <thenets> amercader_: hm, thanks! I'll try again now
[19:45:02] <thenets> amercader_: It's working :) thanks

2017-02-19
[02:25:19] <dansecommander> Hello
[02:25:27] <dansecommander> Anyone here tonight?

2017-02-18
[19:49:25] <thenets> Hi. Do you know if I need to create a volume for a Solr container?

2017-02-17
[13:33:13] <Germanaz0> wardi thanks for yesterday, it helped me a lot with ckan api
[14:14:29] <wardi> Germanaz0: happy to help!
[14:14:43] <Germanaz0> and the ckan api client for laravel is going very well
[14:15:10] <Germanaz0> I followed your recommendations about do it thin, and let the people fill their own stuff without any kind of validations (at least is what I understood)
[14:15:32] <wardi> yes, if there is a validation error CKAN will send it to you
[14:16:53] <wardi> so if your client can give that to the framework in whatever way is best (does php have exceptions?) then you should be able to use 100% of the api, even when extensions are added
[14:19:42] <Germanaz0> indeed
[14:20:34] <Germanaz0> today I will play with files upload wardi, so probably I will annoy with a question
[14:20:57] <Germanaz0> if this does not go as expected
[15:32:46] <Germanaz0> Question, latest api only works with json data on POST ? or can I use multipart form data instead json data ?
[15:43:00] <wardi> Germanaz0: mulipart form data works too (that's how files are uploaded) but only for flat calls (no nested json)
[15:43:29] <Germanaz0> yes I know, but I mean, for every api endpoint
[15:43:45] <Germanaz0> if I want to create a new package, can I use multipart form data instead json data ?
[15:43:53] <Germanaz0> I want to do something generic
[15:43:56] <wardi> it works for all of them, yes, they're treated like a flat json object
[15:44:22] <wardi> you can't create a package with its resources at the same time that way, but yes
[15:45:14] <wardi> and some calls require nested args (e.g. datastore_create)
[15:45:26] <Germanaz0> and using json, how to create a package with resources, if I need to use multipart form data
[15:45:47] <wardi> you can't currently do both at the same time
[15:45:58] <Germanaz0> at least, on guzzle php, I cannot use multipart form data and json data at once
[15:46:35] <wardi> I started writing up an idea for implementing that, but there's no actual code yet
[15:46:59] <Germanaz0> yes, and most of the libraries does not support to use both
[15:47:03] <Germanaz0> at once
[16:50:00] <Germanaz0> there wardi https://github.com/Germanaz0/laravel-ckan-api it is getting very complete
[16:50:07] <Germanaz0> with uploads <3
[16:57:29] <Germanaz0> why http://docs.ckan.org/en/latest/api/#ckan.logic.action.get.user_list does not has offset and limit ?
[16:58:19] <Germanaz0> is the parameter missing on doc ? or is not supported by api ?

2017-02-16
[13:03:20] <amercader_> wardi, ksivakov_: can't make the dev meeting today sorry
[13:03:45] <wardi> ok tuesday is fine
[13:05:04] <ksivakov_> np
[13:43:55] <Germanaz0> Morning
[13:45:29] <Germanaz0> I am getting confused with the latest api endpoints, http://docs.ckan.org/en/latest/api/
[13:47:22] <Germanaz0> the action/package_list and action/package_search should return the same, actually should be one endpoint
[13:55:26] <Zharktas> package_list returns just a list of names
[13:55:33] <Zharktas> package_search does a lot more
[13:57:18] <Germanaz0> and what are this kind of api ? http://docs.ckan.org/en/latest/api/#ckan.logic.action.get.group_list
[13:57:46] <Germanaz0> it's like an internal api for python ? or it makes reference to an API endpoint ?
[13:58:34] <Zharktas> you can call all the apis in the browser but most of the time they are also used internally
[13:58:38] <Zharktas> http://demo.ckan.org/api/3/action/group_list
[13:59:33] <Zharktas> http://demo.ckan.org/api/3/action/group_list?order_by=packages
[14:00:00] <Zharktas> as you can see, that http api takes the same parameters the python api, as they are actually the same api
[14:08:59] <Germanaz0> yeah figured it out
[14:09:32] <Germanaz0> btw, the rest api was much better than this, for every thing I need to call a different endpoint
[14:09:45] <Germanaz0> a restfull api should be awesome
[14:15:43] <wardi> the action api isn't restful, instead it's a flat rpc-style json API
[14:23:45] <wardi> not being restful is fine with me, it means we support things that rest doesn't, like easy file uploads with multipart post, and we can add features like field selection, streaming and async in the future
[14:37:24] <Germanaz0> btw, I am doing a rest-api client for laravel framework (php), going to move all endpoints to the latest api
[15:04:22] <wardi> Germanaz0: the client lets laravel make calls to ckan?
[15:04:36] <Germanaz0> yep, as a package
[15:05:20] <wardi> that's cool. try to make it as thin as you can. ckan extensions can (and do) extend the action api and modify the values it accepts
[15:06:31] <wardi> if your client "knows" too much about the calls it won't work on ckan instances with those extensions
[15:10:31] <Germanaz0> what do you mean ?
[15:10:57] <Germanaz0> wardi ? I am trying to make it very simple for now, just bootstrapping the client
[15:11:18] <Germanaz0> it just accepts the basics to works, like the limit, offset, etc
[15:12:00] <Germanaz0> later I will add more features, like search parameters, etc
[15:19:22] <Zharktas> most ckan instances have customized api that does not match completely with the documentation
[15:20:10] <Zharktas> for instance package_create docs say that some of the parameters are optional but in fact they are mandatory in some instances
[15:38:45] <Germanaz0> yes I will not add any validation, I trust on api endpoints (bad choice) to return errors
[15:39:09] <Germanaz0> so the guy who is using the api client will not have any restriction by the client
[15:39:15] <Germanaz0> only from endpoint
[15:55:44] <Germanaz0> Zharktas do you know how to use http://docs.ckan.org/en/latest/api/#ckan.logic.action.update.package_update ?
[15:56:12] <Germanaz0> it does not say if it is a post, a put, and the param id should travel as query parameter or json parameter
[15:56:43] <Zharktas> it is a post
[15:57:04] <Zharktas> if it isn't a get, it's a post :p
[15:58:26] <Zharktas> http://docs.ckan.org/en/latest/api/#making-an-api-request
[16:05:52] <wardi> Germanaz0: I mean all your client really needs is a "call_action" function that expects a json response or one of about 5 types of error
[16:06:07] <Germanaz0> yeah
[16:06:09] <wardi> it can always use post
[16:06:31] <wardi> if you don't need to upload files then it can always send parameters as json
[16:07:34] <Germanaz0> oh cool
[16:07:40] <Germanaz0> all actions thru post ? also search one ?
[16:07:47] <wardi> if you start adding special handling for parameters like limit and offset you'll be writing code forever to support all the different actions
[16:08:15] <wardi> yes, you can always post (get only works for calls without side effects)
[16:08:36] <Germanaz0> thanks so much
[16:09:00] <Germanaz0> finally one thing that is simple
[16:12:15] <wardi> the envelope on all responses is always the same, that's where you can check for errors
[16:13:47] <wardi> there are only 6 of them: https://github.com/ckan/ckanapi/blob/master/ckanapi/common.py#L114-L128
[16:16:53] <Germanaz0> wardi last queston and I am done, to create a private package, the api doc does not say nothing, it is possible to make it private later with another api call, but I did not find nothing to make it private
[16:17:50] <Germanaz0> yes, just adding "private
[16:17:52] <Germanaz0> as json data
[16:18:05] <wardi> Germanaz0: yes, private is just another field
[16:18:21] <wardi> package_patch can be used to update a single field
[16:18:27] <Germanaz0> because it was missing here http://docs.ckan.org/en/latest/api/#ckan.logic.action.create.package_create
[16:18:37] <Germanaz0> I got confused
[16:23:42] <amercader_> Germanaz0: that `private` is missing from the docs is pretty bad. Can you send a pull request to add it? Docs are built from the docstrings on this file https://github.com/ckan/ckan/blob/master/ckan/logic/action/create.py#L46
[16:24:01] <Germanaz0> yes sure
[16:24:08] <amercader_> great, thanks!
[16:24:59] <Germanaz0> my bitcoin is ... joke xD
[16:55:02] <Germanaz0> done amercader_ https://github.com/ckan/ckan/pull/3440
[17:09:52] <Germanaz0> thanks wardi :D
[17:09:56] <Germanaz0> my first contribution to ckan <3
[17:50:51] <Germanaz0> wardi if you are interested about the ckan api client for laravel, here is the package, https://github.com/Germanaz0/laravel-ckan-api
[20:50:14] <Germanaz0> is it possible to get the api key of the user
[20:50:17] <Germanaz0> thru api ?
[22:58:38] <thenets> Germanaz0: You can get the member_list and filter, http://docs.ckan.org/en/latest/api/#ckan.logic.action.get.member_list

2017-02-15
[00:00:04] <gnat_x> (both running the same version of ckan)
[00:00:26] <gnat_x> (oh yeah, and of course move filestore files etc.
[00:01:13] <gnat_x> there's really only one dataset on the oldserver, but it is used to back a dataviz thing that is live.
[00:01:55] <Masken> Hello!
[00:01:56] <gnat_x> i can redeploy that, but if i can keep api keys that would be cool.
[00:02:16] <Masken> I can't get any mods to show up in ckan
[00:02:28] <gnat_x> i'm happy to rtfm, just couldn't find the right fm.
[00:02:29] <Masken> I have mono and certs and all that jazz.
[00:04:27] <Masken> What can I do?
[00:52:36] <tktech> Masken, wrong CKAN.
[00:53:01] <tktech> gnat_x, yes, copying it is just fine. Alternatively "ckanapi dumps users/datasets" then "ckanapi load users/datasets"
[00:54:50] <Masken> lol .D
[00:55:02] <Masken> That's great. Bye!
[03:27:58] <gnat_x> tktech: woah. awesome.
[03:28:13] <gnat_x> tktech: will try that when i'm back at the work hole in the morning.
[10:52:10] <gr8_> Hey, is it possible to disable access to gravatar?
[10:55:03] <gr8_> for the user-pics
[12:17:04] <thenets> Hi. You know how to create a small Docker image for Solr with CKAN's schema? I can't setup another schema...
[12:53:13] <Zharktas> thenets_: https://github.com/6aika/sixodp-solr we did this a few months ago as a test, but we have not actually used it in production so no guarantees that it will actually work with all cases :D
[13:20:31] <ksivakov_> had anayone come to situation to display decimals with comma on dataexplorer view ?
[13:35:45] <thenets> Zharktas: Thanks a lot! \/ I'll try this Dockerfile today!

2017-02-14
[14:31:34] <travis-ci> ckan/ckan release-v2.5.4 1b327e8 https://travis-ci.org/ckan/ckan/builds/201517565 Marc Fortier: The build has errored.
[23:59:33] <gnat_x> hi folks. i'm trying to move an instance of ckan from one server to another. is there a documented or supported way to do that?
[23:59:56] <gnat_x> or can i just replicate the database from oldserver to newserver.

2017-02-13
[14:17:09] <Zharktas> how cumbersome would it be to build scheming support for showcase ? totally impossible or matter of replacing schema and template functions ?
[16:48:57] <wardi> Zharktas: showcase just uses a dataset type, so you could implement showcase on scheming
[16:54:05] <Zharktas> wardi: tried that, but showcase implements package_types and ckan won't start if the same dataset type is defined by two plugins
[16:54:54] <Zharktas> but i probably try tomorrow overriding datasetform bits of showcase so that i could implement it with scheming
[16:55:03] <wardi> Zharktas: it will take modifications to the showcase extension for sure
[20:30:59] <travis-ci> fanjinfei/ckan canada-v2.5 bdd3f7d https://travis-ci.org/fanjinfei/ckan/builds/201245043 Tyler Kennedy: The build has errored.

2017-02-12

2017-02-11

2017-02-10
[10:40:34] <bubo> hi
[11:11:32] <bubo> So private datasets can be accessed through the search by injecting some values
[11:11:37] <bubo> does anyone have experience with tihs?
[11:11:41] <bubo> *this
[11:12:39] <Zharktas> in ckan 2.6, there is include_private flag which returns private datasets
[11:12:50] <Zharktas> in older ckan versions it was not possible
[11:14:08] <bubo> I am not talking about that. I am talking in actually changing the query that is given to the search
[11:14:49] <bubo> Zharktas: http://demo.ckan.org/dataset?q=&res_format=CSV%22%20/*&tags=test&sort=score+desc%2C+metadata_modified+desc
[11:14:58] <bubo> This shouldn't return private datasets, should it?
[11:22:17] <Zharktas> i think it shouldn't, so that might be a bug
[11:22:40] <bubo> The value for res_format isn't properly escaped I think
[11:23:01] <bubo> Which somehow bypasses the exclusion of private datasets
[11:25:42] <Zharktas> older ckans just give an search error with that query :p
[11:25:50] <Zharktas> 2.6 does not and return private datasets
[11:26:42] <bubo> Yes I can't reproduce it locally, but it works on our staging site
[11:26:55] <bubo> It might be the solr version
[11:26:58] <bubo> I am checking that right now
[11:27:18] <Zharktas> we have 2.6 production site which also return private datasets with that
[11:27:38] <Zharktas> with solr 6.x or something that i can't check right now :p
[11:28:16] <bubo> So solr 5.5 also does this
[12:37:37] <bubo_> I will do a pull request for this

2017-02-09



2017-02-08


[11:11:18] <bubo> Do you know if "package_search" supports grouping?
[11:11:55] <torf> bubo: Grouping in respect to what?
[11:44:38] <bubo> torf grouping by some attribute in solr
[11:46:27] <bubo> you can add a group by field in Solr query, and it will return the results grouped up based on that field
[12:47:39] <Jonas_Henrique> Good Morning,  I would like to know if you can give me good documentation to install and configure the CKANEXT-SHOWCASE plugin. And could you tell me how it works?
[15:48:47] <amercader_> bubo: I think what you mean is called faceting in solr. Check the facet* fields in the package_search docs

2017-02-07
[12:30:58] <amercader_> wardi: ok I was right and I did implement the explain approach to get table names in sql queries, but just to avoid access to system tables https://github.com/ckan/ckan/blob/master/ckanext/datastore/db.py#L1230
[12:31:25] <amercader_> the per-resource auth check is in this WIP PR by ross: https://github.com/ckan/ckan/pull/2570/files
[12:31:41] <amercader_> which seems almost done tbh
[12:40:48] <ksivakov> amercader: i asked about the PR, new one will be pushed soon
[12:42:13] <amercader_> great, thanks ksivakov
[15:17:57] <bubo> hi
[15:18:31] <bubo> If I wanted to add an extra field to dataset and have it indexed as multiValued field, do I have to edit schema.xml ?
[16:17:37] <Zharktas> bubo: yes, extra fields are not indexed as multivalued in the default schema
[16:21:19] <bubo> Zharktas: how can I add a new field to a dataset that will be multiValued ?
[16:22:04] <bubo> I added a dynamicField in schema.xml but it seems ckan is ignoring it
[16:22:33] <bubo> The data_dict that is sent to package_create contains a key "search_subcategories" with a list as value and it gets ignored
[17:06:26] <Zharktas> bubo: restarted solr and everything ?
[17:06:45] <Zharktas> you can view your schema in solr too through web interface
[17:21:28] <bubo> Zharktas: I keep getting bad requests
[17:21:49] <bubo> when trying to create a dataset
[18:06:04] <wardi> amercader_: thanks, so no killing that old permission code just yet
[20:53:21] <bubo> How can I add an attribute to a dataset that is a list? I can't add it in extras, since extras only keep strings
[20:54:26] <wardi> bubo: ckanext-scheming and ckanext-repeating store lists as json in extras
[20:54:47] <wardi> if you're customizing your schema scheming might make your job simpler
[20:55:13] <bubo> wardi I am already using ckanext-scheming
[20:55:23] <bubo> how can I add a field that won't show up in the form?
[20:55:54] <bubo> The thing is I want to keep a list that is indexed (multiValued) in solr and I will generate the list in package_create (my override)
[20:56:17] <wardi> form_snippet: null works, but it will get cleared when the user updated the form
[20:56:43] <wardi> before_index lets you put arbitrary fields in solr
[20:56:56] <bubo> ok let me try before_index
[20:57:09] <wardi> what is this a list of?
[20:57:14] <bubo> Just strings
[20:58:11] <wardi> if you tell me more about the larger problem you're solving I might be able to offer better advice
[20:58:37] <bubo> I need to save a list of strings in the Solr index so I make queries on them
[21:00:07] <bubo> for example I want to keep the "titles" of the groups instead of the "names" in the solr index so I can search them
[21:00:31] <bubo> if a user types "Group 1" it won't match the value "group-1" that is saved in solr in the groups attribute
[21:00:49] <wardi> before_index sounds like the perfect thing
[21:01:52] <bubo> it does
[21:02:58] <bubo> so in before_index I can use "group_show" to get the groups info from the "groups" attribute and then just pkg_dict['search_groups'] = group['title']
[21:07:23] <bubo> wardi: Can I access the context inside before_index? How would I get "group_show" without context? Wouldn't it fail
[21:09:04] <wardi> context can be None and it will get filled in from the request context
[21:10:06] <bubo> let me try
[21:10:45] <bubo> model = context['model']
[21:10:47] <bubo> TypeError: 'NoneType' object has no attribute '__getitem__'
[21:12:17] <bubo> Ok neverming it worked.
[21:12:36] <bubo> I needed to use get_action instead of accessing it directly with logic.action.get..
[21:19:41] <bubo> Thanks for your help wardi
[21:21:08] <wardi> np. if doing a group_show on every group through the action layer gets too slow you might need to craft your own query.
[21:23:10] <bubo> Yes, that would be a better way. I guess a query that does "Select * from groups where name in pkg_dict['groups']"
[21:23:41] <bubo> I will do that now so it won't come to that problem
[21:37:03] <bubo> wardi I am not sure how to import in_. I can do from sqlalchemy import or_, and_ but no in_
[21:42:44] <wardi> a join would let the db do that work (in isn't usually recommended when designing queries) but this might be a micro optimization and not worth the effort. if group_show is working you might be better off leaving it alone
[21:43:24] <bubo> alright
[21:51:09] <tktech> bubo: that's not how `in_` works in sqlalchemy.
[21:51:17] <tktech> You use `in_` as a property of a field or column.
[21:51:29] <tktech> myTable.c.groups.in_([1,2,3])
[22:03:02] <bubo> tktech: Thanks, I just saw that too in the documentation
[23:10:54] <bubo> Do you know if "package_search" supports grouping?


2017-02-06
[07:42:08] <thenets> I found the problem with error 409 in CKAN API. When I sent a request with exemple code from doc, the request doesn't have and owner_org
[07:42:55] <thenets> After add the owner_org attribute, everything work ok
[08:07:17] <Zharktas> thenets: you probably have organization mandatory in your ckan.ini
[08:07:49] <Zharktas> http://docs.ckan.org/en/latest/maintaining/configuration.html#ckan-auth-create-unowned-dataset
[08:53:32] <thenets> Yes, that's the problem. But I don't know this problem return "409 conflict"
[08:55:27] <Zharktas> 409's come from validation errors, so if your configuration require that datasets must have organization, it will not work without them :p
[09:15:38] <thenets> Hm, good to know this error message is about any validation error. Thanks.
[15:00:57] <torf> What's the best way to test a function in an extension that relies on toolkit.c being populated (e.g. toolkit.c.action, toolkit.c.controller)? I've tried helpers.call_action from within a subclass of FunctionalTestBase, but that's not enough: Accessing toolkit.c.something just raises "TypeError: TypeError('No object (name: tmpl_context or C) has been registered for this thread',)"
[16:44:22] <wardi> thenets: sounds like you figured this out, but always look at the response from the server, it should tell you exactly what the validation error was
[16:44:42] <wardi> the status code can't say very much :-)
[16:57:34] <thenets> wardi: Yes, I saw the message on log :)
[17:09:58] <thenets> You know how to get an organization by name using CKAN API?
[17:14:11] <wardi> you can pass the name in the id field to organization_show
[17:14:41] <wardi> (same for package_show and group_show)
[17:24:20] <thenets> Hmm, thanks! I'll try now!
[17:31:32] <thenets> Didn't work. But with organization_autocomplete works. Example: My url is "/banco-central" and org name is "Banco Central"
[17:32:00] <thenets> But with oraganization_autocomplete works :)
[17:32:15] <wardi> api/action/organization_show?id=banco-central should work
[17:33:06] <wardi> (the url field is called "name" and is enforced unique so that's what I thought you meant)
[17:38:22] <thenets> Yes, this work ok. But the third party application just give me the "Banco Central" string
[17:39:32] <thenets> (I'm going out. I'll enter again in my home. See ya and thanks for support.

2017-02-05

2017-02-04

2017-02-03
[10:14:57] <ksivakov> hello all
[10:14:58] <ksivakov> When CKAN was originally built did the team that built the the metadata part use some existing metadata standards, e.g. ISO/IEC 11179 or similar as a starting point?

2017-02-02
[11:43:06] <fugit> Hi!
[11:43:51] <fugit> am setting up ckanext-ga-report and ckanext-googleanalytics plugins. however I can't get the download stats only the views show up
[11:44:50] <fugit> I have googleanalytics_resource_prefix = /downloads/ in my development.ini file. am not sure this is correct, I just copied it from the manual since I couldn't find another documentation
[14:51:28] <wardi> thelaptop: 409 is just an HTTP status, what does the response say?
[14:51:51] <wardi> thelaptop: sorry, wrong person :-/
[16:17:08] <wardi> I'm working on adding triggers to the datastore API. I'm planning to add some datastore_trigger_{show,create,update,delete} calls where the last three by default will be sysadmin-only. These calls will manage the trigger functions registered in the database. Next I'm adding a triggers parameter to datastore_create that lets normal users reference those trigger functions for each table
[16:18:19] <wardi> trigger functions can access any table + more, so who can define them should be more tightly controlled than who can add them to tables they have write access on
[16:25:45] <wardi> it looks like the only trigger defined by default in postgres is suppress_redundant_updates_trigger, which should be safe :-)

2017-02-01
[09:14:10] <bubo> How do you search manually for datasets? with the package_search action?
[09:55:38] <torf> bubo: If you want to use the API then package_search is usually the way to go
[10:13:00] <bubo> what else is there to use?
[10:16:31] <Zharktas> you can fetch them by user, group or organization too, but that really isn't searching ;)
[14:34:04] <bubo> Is there a way to get the authenticated user without context?
[15:29:03] <torf> bubo: From inside CKAN (e.g. an extension)? You can probably use ckan.common.c.user.
[15:58:15] <bubo> yes I figured it out :)
[16:00:27] <bubo> Is there a way to return group objects as json? or do I have to build it myself?
[16:20:04] <torf> bubo: Take a look at group_show's implementation :)
[19:24:17] <thenets> Hi. I'm trying to use CKAN API, but I'm getting a lot of problems. I don't know why, but after upgrade to version 2.5.2, my CKAN instance doesn't work anymore.
[19:25:37] <thenets> The example at "http://docs.ckan.org/en/latest/api/#authentication-and-api-keys" in "Example: Importing datasets with the CKAN API" code, I got the error "HTTP Error 409: Conflict".
[19:30:44] <thenets> I forgot to say. Works ok on version 2.1 and Works on demo.ckan.org. But doesn't work on CKAN 2.5.2.
[19:33:14] <bubo> 2.5.2 isn't the latest, so try the 2.5.2 docs
[19:34:18] <bubo> also 409 ot
[19:34:30] <bubo> it's probably because the dataset already exists, did you try on a clean database?
[19:35:58] <thenets> it's the same code at http://docs.ckan.org/en/ckan-2.5.3/api/index.html#example-importing-datasets-with-the-ckan-api
[19:36:46] <thenets> yes
[19:37:31] <thenets> I don't know why, but on a clean installation of 2.1 Works ok. But on 2.5.2, doesn't work
[19:37:42] <thenets> 409 error come from urllib2
[19:38:46] <bubo> did you clean the database before running the script?
[19:40:42] <bubo> Did you see what I wrote before disconnecting?
[19:40:55] <thenets> I've installed the CKAN and start using. I'll try to clean the database now.
[19:41:33] <thenets> Yes, I go to botbot.me to check what you say
[19:43:33] <thenets> same problem... I'll try again with ckan 2.6.0 and let you know what I got
[19:48:59] <bubo> Did you get any message from ckan?
[19:49:02] <bubo> any response?
[19:49:29] <thenets> no, the urllib2 return error 409 without any message
[19:50:33] <bubo> Can you try printing any response
[19:53:23] <thenets> except Exception as e:
[19:53:23] <thenets> print(e)
[19:53:43] <thenets> this just return "HTTP Error 409: Conflict"
[19:54:09] <thenets> I'll try again with 2.6.0. I'm installing now

2017-01-31
[12:10:19] <amercader_> https://github.com/GSA/ckanext-geodatagov/blob/master/ckanext/geodatagov/plugins.py#L32
[14:38:20] <tktech> amercader_, Almost done the i18n PR.
[14:38:41] <amercader_> great news tktech
[14:38:58] <tktech> I'll be done it this afternoon after a meeting I should have time, so far it's a-ok
[15:27:21] <bubo> Does anyone have any experience with making datasets belong to multiple organizations?
[15:37:41] <tktech> Organizations or groups, bubo?
[15:37:59] <tktech> One dataset with multiple organizations seems odd, can you explain what you're trying to do?
[15:53:04] <amercader_> one organization per dataset is enforced in the model (`owner_org` field)
[15:53:51] <amercader_> I mean you can customize everything in CKAN if you really want to go for it, but it seems like it would be a painful journey :)
[15:54:23] <wardi> bubo: organization hierarchy might be useful if that's the sort of thing you need
[16:57:57] <tktech> Yeah I kinda want to know what he's aiming for :)
[16:58:11] <tktech> Last couple of times this was asked what they really wanted was groups
[19:20:30] <bubo> We actually need multiple organizations, not groups and we are already using organization hierarchy
[19:20:56] <bubo> it would be really painful to actually implement this though, so I probably won't do it
[19:26:49] <wardi> bubo: what's the thing you're actually trying to implement? multiple orgs is a one approach but there might be others if you tell us what you're trying to accomplish
[19:30:49] <bubo> Well exactly that, dataset should belong to multiple organizations
[19:30:53] <bubo> datasets*
[19:31:54] <bubo> I am not even sure what the customer wants
[19:32:06] <wardi> you want members of each org to all have permissions to edit those datasets (and possibly remove the other orgs?) that seems strange
[19:32:49] <wardi> if your customer just wants to display multiple organizations involved with the dataset that's much easier, and one org is still the owner + allowed to edit
[19:38:44] <bubo> How is that easier?
[19:39:03] <bubo> I mean how would you implementi t
[19:39:06] <bubo> I mean how would you implement it
[20:28:59] <tktech> The new labels are probably sufficent for that

2017-01-30
[10:49:57] <nibecker> hi

2017-01-29

2017-01-28

2017-01-27
[10:34:46] <ksivakov> hello guys
[10:34:47] <ksivakov> https://gist.github.com/tino097/665cea2e38aee5879a8c55072c88922e
[10:35:12] <ksivakov> can someone check the gist and give some advice
[10:35:32] <ksivakov> additional message No paste_deploy_config.ini_tmpl found
[10:37:33] <Zharktas> ksivakov: running as root or does your ckan user have read rights to config.ini ?
[10:39:48] <ksivakov> its build using deis
[10:39:54] <ksivakov> paster --plugin=ckan make-config ckan production.ini
[10:39:56] <ksivakov> Distribution already installed:
[10:39:57] <ksivakov> ckan 2.6.0 from /usr/lib/python2.7/site-packages/ckan-2.6.0-py2.7.egg
[10:39:59] <ksivakov> No paste_deploy_config.ini_tmpl found
[10:40:00] <ksivakov> Creating production.ini
[10:40:02] <ksivakov> Now you should edit the config files
[10:40:03] <ksivakov> production.ini
[10:40:05] <ksivakov> bash-4.3# cat production.ini
[10:40:06] <ksivakov> [app:main]
[10:40:08] <ksivakov> use = egg:ckan
[10:44:26] <ksivakov> wierd thing is that production.ini file has only 2 lines

2017-01-26
[15:22:41] <terminaljunkie> is there a way to turn off revisions in CKAN? I don't need or want the package_extra_revision table to grow as it is doing
[15:44:03] <bubo_> There is no way to turn off revisions afaik
[16:35:49] <wardi> terminaljunkie: not yet, would you like to work on that? Just a simple "stop vdm" config option would be awesome
[16:36:27] <terminaljunkie> Maybe, I'm still just investigating and evaluating performance to see what my options are for scaling
[16:37:21] <wardi> if you're storing all your extras in one field that helps for sure
[16:37:52] <wardi> tktech was looking at recently too but I'm not sure how far he got
[16:40:41] <terminaljunkie> good to know
[16:40:50] <terminaljunkie> does anything clean up the activity table?
[16:41:38] <wardi> not yet but it's safe to delete rows from there. deleting rows from revisions tables is a large pain at the moment
[16:42:22] <terminaljunkie> someone pointed me yesterday to a sscript that works well for deleting "deleted" packages
[16:42:22] <terminaljunkie> https://github.com/GSA/ckanext-geodatagov/blob/2.3-upgrade/ckanext/geodatagov/commands.py#L400
[16:42:22] <wardi> the plan is to move all history into the revision table and remove vdm _revision tables completely
[16:42:57] <terminaljunkie> I was trying to trace what was going into the revision table, I see a lot of rows in there that don't correspond to rows in any other tables
[16:43:02] <wardi> then history can be trimmed easily
[16:43:12] <terminaljunkie> they have messages like "REST API - Created object.."
[16:43:48] <wardi> oh? that doesnt' sound good
[16:44:14] <terminaljunkie> I managed to run
[16:44:29] <terminaljunkie> DELETE FROM revisions WHERE message ~ 'REST API';
[16:44:37] <terminaljunkie> that cleared up a lot
[16:44:46] <wardi> they seem to be manually created in some actions
[16:47:12] <wardi> are they linked to some other _revision table by their id?
[16:47:55] <wardi> those messages might be shown in the dataset history page
[16:48:31] <terminaljunkie> It was possible they were at one point but left dangling by some improper cleanup
[16:48:45] <terminaljunkie> I'm trying to nail down exactly what happens during the state changes for harvests
[16:49:01] <terminaljunkie> there's definitely some different results when datasets are "deleted" through different means:
[16:49:14] <terminaljunkie> - deleted by the harvest job because they don't exist in teh source any more
[16:49:22] <terminaljunkie> - deleted when a harvest is cleared
[16:49:26] <terminaljunkie> - deleted when a harvest is deleted
[16:49:31] <terminaljunkie> - deleted by the user through the UI
[16:49:34] <terminaljunkie> - purged
[16:50:39] <wardi> purged should be different but the others I'd expect to use the same calls, but I'm not familiar with the harvester
[16:50:52] <terminaljunkie> ckanext-harvest
[16:51:36] <wardi> yeah, we're just using scripts and services that push updates straight to the API
[16:51:38] <terminaljunkie> I noticed that if I clear a harvest, it deletes all the associated packages far faster than purge. And by deleted, I don't mean marked the package as "delete" in the state column, I mean really deleted
[16:52:48] <wardi> it must be skipping the API
[16:53:15] <terminaljunkie> yeah, probably
[16:53:17] <wardi> we don't have a bulk purge action, but we probably should
[16:53:30] <wardi> it's a common thing to want
[16:53:44] <terminaljunkie> the purge through the UI is slow and it bogs down the system a lot
[16:53:53] <terminaljunkie> the code even says it's slow and inefficient
[16:54:30] <wardi> would be nice to do that in a background job (we have those now!)
[16:54:42] <wardi> and with a bulk purge action
[16:55:01] <terminaljunkie> I think I'm going to have a cron job that executes an SQL query for the time being
[16:55:35] <wardi> that's a quick hack that will work, at least until we alter our tables
[16:56:00] <terminaljunkie> yeah, that's my concern
[16:56:26] <wardi> maybe when we do we'll have solved this so you can replace the hack with something cleaner
[16:56:59] <terminaljunkie> before, I had a script that would use a curl XPOST to purge
[16:57:14] <terminaljunkie> https://github.com/ioos/catalog-ckan/wiki/Purging-through-curl

2017-01-25
[15:01:40] <terminaljunkie> Does anyone have any docs or advice for maintaining the PostGIS db in CKAN? Been running smoothe for a few months but we have about 10k packages and the revisions are in the millions and now the db is crawling.
[15:01:59] <terminaljunkie> I tried to purge, but that brought the entire host down
[15:09:59] <amercader_> terminaljunkie: just to clarify postgis and big revision tables should not be linked
[15:10:23] <amercader_> with these number of datasets, for search you should use the `solr` backend (http://docs.ckan.org/projects/ckanext-spatial/en/latest/spatial-search.html#choosing-a-backend-for-the-spatial-search)
[15:10:37] <terminaljunkie> we do use solr for the spatial backend
[15:10:44] <amercader_> great
[15:11:01] <amercader_> are you finding the site slow in general, some particular pages?
[15:11:27] <terminaljunkie> in general, but specifically any edits take 90-500s
[15:11:32] <terminaljunkie> https://cloud.githubusercontent.com/assets/1155163/22295483/1d1cfd54-e2e5-11e6-9a5e-fceb6665ae72.png
[15:12:10] <terminaljunkie> the general set up is we have harvesters from ckanext-spatial and ckanext-harvest that download ISO XML documents nightly from a central repository
[15:12:47] <terminaljunkie> And those records change fairly frequently, so I suspect that I am not doing something to clean up the old revisions.
[15:13:01] <amercader_> yeah, datasets will loads of extras that are updated frequently don't scale that well
[15:13:34] <amercader_> it's not you terminaljunkie, just the default old revisioning system that needs a good refactoring
[15:13:51] <terminaljunkie> any workaround come to mind?
[15:14:19] <terminaljunkie> like, delete and clear harvest, purge then harvest new ?
[15:14:26] <amercader_> what we've done in the past (eg data.gov) was aggegating all extras in a single one for storing and expand them at view time. Let me find a link
[15:14:28] <terminaljunkie> that way package extras will not have revisions
[15:14:37] <terminaljunkie> awesome
[15:14:40] <terminaljunkie> fwiw this is for NOAA
[15:14:55] <terminaljunkie> I think I'm on an email chain with the data.gov guy too
[15:17:24] <amercader_> terminaljunkie: https://github.com/ckan/ckan/wiki/Performance-tips-for-large-imports#tags-and-extras
[15:17:34] <amercader_> that's the gist of it
[15:17:47] <terminaljunkie> thanks!!!
[15:17:52] <amercader_> also the indexs on the section above might help
[15:18:01] <terminaljunkie> if it pans out, which I suspect it will, you just saved me probably months of dev-time
[15:18:28] <amercader_> let's wait and see how it goes first :)
[15:19:43] <amercader_> the long term fix of course is getting rid of VDM and have a lighter revision system (even optional) https://github.com/ckan/ideas-and-roadmap/issues/41
[15:27:32] <wardi> yes, we need all these things.  also really looking forward to retiring vdm
[15:29:02] <terminaljunkie> on a wildly different topic
[15:29:11] <terminaljunkie> are there any plugins out there that have implemented time-based filtering?
[15:29:16] <wardi> the simple hack of storing extras in a single field is worth doing even though plugin extras will replace them eventually
[15:50:50] <amercader_> terminaljunkie: http://data.satapps.org/dataset (source: https://github.com/okfn/ckanext-tsbsatellites) / http://b2find.eudat.eu/dataset (source: https://github.com/EUDAT-B2FIND/ckanext-timeline)
[15:50:59] <amercader_> are the ones I know about
[15:51:16] <terminaljunkie> thanks!
[16:34:16] <tramm> in ckan documentation, is there anywhere clearly stated that users can and should use markdown to format their textfields?
[16:35:41] <tramm> currently the only section i found where using markdown is somehow explained, is http://docs.ckan.org/en/latest/api/legacy-api.html?#markdown
[18:33:34] <wardi> well that's cool. I didn't know datastore supported array types natively
[18:39:32] <wardi> I should make InvalidDataError a subclass of one of the regular API exceptions so it doesn't cause failures
[19:21:52] <terminaljunkie> amercader_: thanks for the links, those helped a lot
[19:22:09] <terminaljunkie> amercader_: several order of magnitudes of performance improvements
[19:30:59] <amercader_> terminaljunkie: awesome! Glad it worked so well
[19:32:20] <terminaljunkie> Someone also pointed me to this
[19:32:21] <terminaljunkie> https://github.com/GSA/ckanext-geodatagov/blob/2.3-upgrade/ckanext/geodatagov/commands.py#L400
[19:32:36] <terminaljunkie> Which works a lot better for clearing deleted packages
[19:36:31] <amercader_> wardi: I'll be on a train tomorrow so won't be able to make it to the dev meeting
[19:39:15] <wardi> amercader_: noted
[22:32:24] <amercader_> tktech: FYI all Flask PRs are up to date with master: https://github.com/ckan/ckan/pulls?q=is%3Aopen+is%3Apr+label%3A%22Pylons+-+Flask+migration%22
[22:32:46] <amercader_> These should be hopefully easier to review than the previous ones

2017-01-24
[16:35:07] <realitygaps> any idea of the solr changes needed to match phrases with periods in them? (like test.com)

2017-01-23
[11:10:10] <ksivakov> hey guys, is this fix https://github.com/ckan/ckan/pull/3377 cover older versions of ckan ?!
[11:11:54] <Zharktas> ksivakov: i would guess that it doesn't since older versions use celery instead of the new worker
[11:12:49] <torf> ksivakov: The old background task system (based on Celery) doesn't have the issue #3365 anyways, so you don't need the fix from #3377 there
[11:13:37] <torf> AFAIK the new system will be shipped with 2.7, with the old system being deprecated but still supported
[11:19:50] <ksivakov_> ok, so i guess the issues that we have with the same error "OperationalError: (OperationalError) SSL connection has been closed unexpectedly" origin somwhere else
[15:46:26] <ksivakov> again, im using s3filestore to upload resources, but push to datastore is throwing this error
[15:46:41] <ksivakov> > meerbusch-dev-v60-cmd-eqk2l -- [2017-01-23 15:32:32 +0000] [28] [ERROR] Error handling request
[15:46:43] <ksivakov> > meerbusch-dev-v60-cmd-eqk2l -- Traceback (most recent call last):
[15:46:44] <ksivakov> > meerbusch-dev-v60-cmd-eqk2l --   File "/usr/lib/python2.7/site-packages/gunicorn/workers/sync.py", line 182, in handle_request
[15:46:46] <ksivakov> > meerbusch-dev-v60-cmd-eqk2l --     resp.write(item)
[15:46:47] <ksivakov> > meerbusch-dev-v60-cmd-eqk2l --   File "/usr/lib/python2.7/site-packages/gunicorn/http/wsgi.py", line 344, in write
[15:46:49] <ksivakov> > meerbusch-dev-v60-cmd-eqk2l --     raise TypeError(\'%r is not a byte\' % arg)
[15:47:08] <ksivakov> my local setup is working ok

2017-01-22

2017-01-21

2017-01-20

2017-01-19
[10:22:59] <ksivakov> hello guys, beside the official docs, is there any class diagrams, data models , or simmiiar ?
[10:23:51] <ksivakov> for core
[13:55:53] <dcmul> Hi all.  I suppose the order that templates in custom extensions get loaded/overwritten, is related to the order they appear in the config file. So what order are templates loaded in relation to the order they plugin appear?
[14:07:44] <Zharktas> last one is loaded first i think based on our codebase
[14:18:18] <dcmul> Zharktas: thank you so much, wanted to confirm. Funny how this doesnt appear anywhere in the documentation.
[14:31:33] <amercader_> dcmul: docs here mention plugin ordering and impact on templates: http://docs.ckan.org/en/latest/maintaining/configuration.html#ckan-plugins Might be worth checking if what they say is accurate
[14:33:40] <wardi> dcmul: those docs are accurate. Earlier plugins win for template overriding
[14:34:01] <dcmul> amercader_: thank you. you are right
[14:34:19] <dcmul> wardi: thank you. looking at it here
[14:37:14] <amercader_> banders: just saw you message about ResourceViews, this wiki page is very outdated, it should be removed. AFAIK there is no tutorial for writing resourceviews (there should definitely be one) but reading through the interface docs (http://docs.ckan.org/en/latest/extensions/plugin-interfaces.html#ckan.plugins.interfaces.IResourceView) and some example should
[14:37:14] <amercader_> give you a very good guidance
[14:37:21] <amercader_> eg https://github.com/ckan/ckan/blob/master/ckanext/textview/plugin.py
[16:41:40] <amercader_> ksivakov: this should get you on the right track for the logo PR: https://github.com/ckan/ckan/pull/3392
[17:49:43] <ksivakov> ty
[18:05:41] <banders> amercader_: thanks for the suggestion.  I think I got the ResourceView working now by implementing IResourceController and using the after_update() and after_create() methods to get the affected resource.

2017-01-18
[00:52:12] <banders> trying to call p.toolkit.get_new_resources(context, data_dict) as described here https://github.com/ckan/ckan/wiki/Resource-Views
[00:52:12] <banders> Hi all.  I'm working on an IResourceView plugin, following details https://github.com/ckan/ckan/wiki/Resource-Views.  Trying to call toolkit.get_new_resources() so I can add the view to a resource in the current commit. Getting an error that get_new_resources() doesn't exist.  Has this function been moved or replaced?
[11:13:24] <torf> I'm currently trying to figure out https://github.com/ckan/ckan/issues/3365 (intermittent test failures w.r.t. background jobs). I've posted a question about the issue on StackOverflow (http://stackoverflow.com/q/41279157/857390) where several people could not reproduce my results. It would be awesome if some of you could try to run the two code pieces in my post. Thanks!
[19:18:34] <dcmul> hi all. Is it possible to write an extension that extends a method in another custom extension. Any hint on how to go about that. thank in advance
[19:59:29] <wardi> dcmul: yes, but can you be more specific?
[20:00:10] <wardi> some extensions add plugin interfaces that other extensions can implement
[20:02:28] <dcmul> wardi, i believe wat i want to do is override a controller action.
[20:02:57] <dcmul> controller in a custom extension
[20:06:01] <Zharktas> dcmul: easiest would probably be through standard inherintance
[20:11:27] <dcmul> thanks Zharktas let me try that

2017-01-17
[14:26:15] <ksivakov> enctype="multipart/form-data" :)
[14:30:48] <amercader_> /
[14:30:52] <amercader_> \o/

2017-01-16

2017-01-15

2017-01-14

2017-01-13
[13:05:27] <amercader_> m1h: sorry I don't have time to investigate this right now, I'll try to set some time aside next week to have a better look
[13:06:05] <amercader_> just to clarify, the endless loop only happens if you manually resubmit the resource to the datastore on Manage > Datastore
[13:06:36] <m1h_> yes
[13:06:48] <m1h_> the first time, it is working fine
[13:09:39] <amercader_> what version of ckan is this?
[13:11:09] <m1h_> 2.5.3
[13:12:29] <amercader_> is it a particularly big file? are there other resources on the dataset?
[13:12:39] <amercader_> just trying to think of useful things for debug
[13:13:12] <m1h_> no, the files are really small, e.g. 25kb
[13:13:32] <m1h_> does not matter if the dataset has one or more ressources
[13:14:01] <amercader_> great thanks
[13:18:24] <amercader_> m1h_: just to confirm, did you try to apply https://github.com/ckan/ckan/pull/3331 (not in 2.5.3), restarting the server and datapusher etc? That's the most likely fix for this kind of issues
[13:29:30] <m1h_> yes - did not help, unfortunately
[14:45:17] <ksivakov> ok, maybe this is simple thing, but in latest ckan/lib/base.py version is missing this line 'from pylons.controllers.util import redirect_to, redirect'
[14:46:25] <ksivakov> this is causing problems with s3filestore extension on downloading the resources as it is looking for the 'redirect'
[14:48:09] <amercader_> ksivakov: yes, we are removing these in master as part of the move to Flask. Extensions should use whatever redirect function is present in the plugins toolkit. If that is failing then we have a problem
[15:47:33] <ksivakov> im using now toolkit.redirect_to
[15:47:47] <ksivakov> so it is working

2017-01-12
[09:54:36] <torf> amercader_: What's the state of ckanext-searchhistory (https://github.com/ckan/ckanext-searchhistory)?
[09:57:53] <amercader_> Hasn't been touched for a while as you can see, but it should provide a good base if you want to implement this sort of thing. Definitely happy to give you ownership of it
[10:15:39] <torf> I'm currently working on improving the search experience for our users, so I'm thinking about auto completion. A search history might come in handy for that, hence the question. I'll get back to you in case I decide to go in that direction, right now I'm still brainstorming :)
[10:39:15] <amercader_> cool
[16:52:02] <m1h> Does anyone have any hint regarding https://github.com/ckan/ckan/issues/2856? - amercader_?
[16:53:26] <tktech> ksivakov, I'm not 100% sure what you're doing :)
[16:53:41] <tktech> But if you're going from LocalStorage to cloudstorage, there's a handy paster "migrate" command
[16:53:46] <tktech> That'll fix everything up for you
[16:58:00] <ksivakov> tktech, im trying to make this work :)
[16:58:03] <ksivakov> https://github.com/keitaroinc/ckanext-s3filestore
[16:58:54] <tktech> Does it need to be ckanext-s3filestore? :)
[16:59:31] <ksivakov> i guess it is should be
[17:00:14] <ksivakov> as i know the issue is related to eu-central-1
[17:01:26] <ksivakov> boto.exception.S3ResponseError: S3ResponseError: 400 Bad Request
[17:01:50] <ksivakov> on master branch for both, ckan and s3filestore, thats the error message
[17:13:28] <Zharktas> ksivakov: https://github.com/boto/boto/issues/2741 there has been and issue for years in eu-central-1
[17:18:50] <ksivakov> yeah so there is a branch on s3filestore, boto3, where we could connect now to eu-central-1

2017-01-11
[08:30:22] <torf> Is there a reason why there's no general template helper function for getting a configuration value? Something like `h.get_config('my_config_variable')`? The theming docs say that extensions should provide custom helper functions to wrap their configuration options, but wouldn't a general function solve that problem once and for all?
[10:47:34] <amercader_> torf: the only I can think of is trying to separate concerns but I've found myself many times wanting to have this helper in core
[10:50:40] <torf> amercader_: There's a TODO-box in the theming docs, saying "I'm not sure if making config settings available to templates like this is a very good idea. Is there an alternative best practice?". However, it's from 2013 (by Sean Hammond).
[10:51:56] <torf> The only possible downside that I can think of is that configuration values can contain private information that shouldn't be visible in the templates. However, since any extension could simply provide that helper itself that's not really an argument against including it in core ;)
[10:52:05] <amercader_> I guess the worry is that extensions accidentally expose sensitive settings like db connections etc
[10:52:19] <amercader_> note the accidentally :)
[10:53:06] <amercader_> but if you have to explicitly pass the conf key to a helper that's probably safe enough
[10:53:26] <torf> That's what I would have suggested.
[10:54:35] <torf> I'll prepare a PR once I find time for it
[10:54:39] <amercader_> anyway that's a moot point because flask automatically exposes config to the templates so in the future it will be there by default :)
[10:54:48] <amercader_> so +1 on the helper
[10:55:02] <torf> Ah, OK. That's good to know. No point in a PR, then.
[10:55:15] <torf> OK, now I'm confused :)
[10:55:47] <torf> You mean a helper would be nice to have while we transition to Flask?
[10:55:48] <amercader_> sorry, I mean that I'm not concerned at all about config being available on the templates
[10:56:58] <torf> OK. A PR it is, then :D
[10:57:06] <amercader_> cool
[11:00:29] <amercader_> torf: or we could just expose the whole config dict if it's going to be available in flask anyway
[11:00:36] <amercader_> wardi: wdyt? ^
[14:22:05] <tramm> amercader_: thanks for your quick reply, btw the remark about imperialism was just another way to say that in uk and elsewhere almost everybody understands some english and i18n might not be seen as a priority for uk's own portal :)
[15:54:42] <ksivakov> hello guys, im uploading a dataset and the path should be resources/ebad6063-263c-408c-b394-0b2c6dfd7570/test.csv
[15:55:11] <ksivakov> but it creates this folder structure
[15:55:13] <ksivakov> resources/eba/d60/63-263c-408c-b394-0b2c6dfd7570/
[15:55:48] <ksivakov> so when im trying to upload resources to S3 im getting error of resource not existing
[15:55:52] <ksivakov> any idea?
[16:03:36] <amercader_> ksivakov: the second path (resources/eba/d60/63-263c-408c-b394-0b2c6dfd7570/) is correct for local storage, that's how the local storage uploader (the one in ckan/lib/uploader.py) implements it
[16:04:39] <amercader_> other storage extensions like ckanext-s3filestore or ckanext-cloudstorage may use different conventions for storing the resource (IIRC s3filestores does resources/{resource-id}/file.csv
[16:05:28] <ksivakov> ok thanks
[16:06:09] <ksivakov> im working on s3filestore extension so i wasnt sure what is right
[17:38:40] <wardi> well, if flask exposes all your config I guess there's no going back
[17:39:39] <wardi> amercader_: maybe we need a better place for credentials and other senstive config
[17:40:35] <wardi> (docker's "everything sensitive in environment vars", and "you get all sensitive vars from connected containers too" patterns makes me sad too
[22:48:41] <tktech> ksivakov, What are you trying to do, copy-paste old uploads to S3?
[23:06:17] <ksivakov> not just the old ones

2017-01-10

2017-01-09
[17:16:58] <gr8> The "unable to post to result url"-error when uploading a resource to datastore...do I need to open port 8800? - Or should that be working when the datapusher-url is set to http://0.0.0.0:8800?
[17:40:58] <Zharktas> gr8: datapusher can't post back to your ckan, are you using self-signed ssh sertificates ?
[17:41:13] <gr8> yes Zharktas
[17:44:43] <gr8> so, do we need to open port 8800 or should it be possible via 0.0.0.0:8800?
[17:45:12] <Zharktas> gr8: since datapusher uses python requests to post the result, it will fail because requests will fail all posts to urls using self-signed sertificates if not told to ignore it
[17:45:21] <Zharktas> so get real sertificate :p
[17:46:47] <gr8> ahhh, sorry...we are NOT using a self-signed certificate :D
[17:49:02] <Zharktas> then the logs probably have something, anyway datapusher should work but it can't notify ckan about storing the data to datastore
[17:50:35] <gr8> unfortunately, the logs does not have any messages regarding this error
[17:52:06] <gr8> curl 0.0.0.0:8800 is working btw
[18:01:19] <gr8> maybe we should use httpS://0.0.0.0 instead of http!?

2017-01-08

2017-01-07

2017-01-06
[18:18:02] <Germanaz0> Hello everybody
[18:19:54] <Germanaz0> I am having an issue with datapusher https://gist.github.com/Germanaz0/63bc6101f32cf9ec62524b9d31e87c02
[18:20:08] <Germanaz0> that's the error and I do not have idea how to debug it
[18:42:27] <Germanaz0> hello (?)

2017-01-05
[13:09:31] <gr8> If we would like to harvest a CSW-Service, but we do not need any spatial-functions (like querying) - only adding datasets and resource-links to CKAN. Is it possible to use the CSW-harvester WIHTOUT postgis? Or is postgis also in csw-harvesting needed?
[13:18:06] <ksivakov_> just to inform you i will miss the meeting today
[15:01:43] <gr8> no idea anyone if ckanext-spatial is also working for csw-harvesting without postgis?
[15:53:28] <wardi> amercader_: click looks good. happy to switch my datastore PR over to that

2017-01-04
[07:30:40] <dcmul> Zharktas: I am, very gratefrul for the help you gave me yesterday.
[09:09:48] <realitygaps> which part of the schema.xml would i need to change to not split words/numbers on periods?
[09:10:05] <realitygaps> i assume the WordDelimiterFactory but not sure which one or what to change
[11:00:57] <gr8> is following a WMS preview with ckanext-geoview? https://data.gov.uk/data/map-preview?url=http%3A%2F%2Fenvironment.data.gov.uk%2Fds%2Fwms%3FSERVICE%3DWMS%26INTERFACE%3DENVIRONMENT--aace5ed3-2580-4c2e-bdd8-69b3d473d99d%26request%3DGetCapabilities&amp=&amp=&n=55.816&amp=&amp=&w=-6.236&amp=&amp=&e=2.072&amp=&amp=&s=49.943
[11:01:04] <gr8> How does the ckanext-geopreview work, if resources are not saved in CKAN directly? - Is it like an iframe where resource_proxy provides access to the resource-link?
[11:24:57] <gr8> If a CSW-service is harvested periodically - are all record-data (not only the IDs of them) loaded or only those which were modified since the last harvesting?
[11:26:04] <gr8> As I could identifier: All recordsID are loaded, then the status (new, change, deleted) is determined, and then all the record-data of the recordIDs of the new AND changed records are loaded - am I correct?
[11:48:08] <gr8> Wouldn't it make sense to harvest only the data of the changed-records since the last harvesting-job (and not all data of records although nothing has changed)?
[12:20:59] <amercader_> gr8: 1. data.gov.uk uses its own map preview plugin. You can find it in their github org but is not ckanext-geoview
[12:21:32] <amercader_> 2. Yes, the remote files is loaded via resource proxy from the relevant mapping library in the browser
[12:23:02] <amercader_> 3. At the time the time filtering capabilities in CSW services did not allow to reliably only get records modified since a certain date so we decided to go for the safest approach of downloading all records and decide which ones to store (new and updated)
[12:24:02] <amercader_> wardi: a new dev from opengov should join us tomorrow on the dev meeting so if you can think of good tasks for getting started that would be great. I'll have a look too
[12:39:48] <gr8> amercader_: thank you!
[14:14:58] <gr8> If we would like to harvest a CSW-Service, but we do not need any spatial-functions (like querying) - only adding datasets and resource-links to CKAN. Is it possible to use the harvester WIHTOUT postgis? Or is postgis also in spatial-harvesting included?
[15:24:27] <benjwadams> How can I introspect the config settings of a running CKAN instance?  I tried using the API to show the config, but it seems it only shows config options which are editable at runtime.

2017-01-03
[08:07:47] <dcmul> hi. Is it possible/easy to work with ckan in an interactive shell? How do I access the config file.
[08:09:10] <dcmul> i wanna find a quick way to test helper functions.
[09:08:39] <Zharktas^> dcmul: theres fairly undocumented paster command for that
[09:10:07] <Zharktas> dcmul: paster --plugin=pylons shell config.ini
[12:03:31] <amercader_> happy new year everyone!
[12:03:44] <amercader_> wardi, TkTech are you around for a meeting?
[14:20:14] <realitygaps> anyone in here who would be interested in some consulting work on ckan?
[14:20:25] <realitygaps> (sorry if this is not a good chan for asking stuff like that)
[14:42:35] <wardi> realitygaps: probably the only channel to ask on :-)
[14:47:45] <realitygaps> wardi: is what i figured :)
[14:50:11] <gr8_> Hi, is following a WMS preview with ckanext-geoview?
[14:50:12] <gr8_> https://data.gov.uk/data/map-preview?url=http%3A%2F%2Fenvironment.data.gov.uk%2Fds%2Fwms%3FSERVICE%3DWMS%26INTERFACE%3DENVIRONMENT--aace5ed3-2580-4c2e-bdd8-69b3d473d99d%26request%3DGetCapabilities&amp;n=55.816&amp;w=-6.236&amp;e=2.072&amp;s=49.943
[14:51:29] <gr8_> How does the ckanext-geopreview work, if resources are not saved in CKAN directly? - Is it like an iframe where resource_proxy provides access to the resource-link?

2017-01-02

2017-01-01

2016-12-31

2016-12-30

2016-12-29
[19:40:14] <TkTech> amercader_: https://github.com/ckan/ckan/pull/3382 "That was fun"

2016-12-28
[21:30:14] <nkfx> Hey all, I'm trying to make adjustments to the Graph in Data Explorer --- my end goal is to create another resource view that uses another JS library to display charts, graphs, etc --- but right now, I am trying to understand how CKAN functions. The first task, I would like to change the labels used by the dropdown form; I'd like to change the name "Axis 1" and "Axis 2" to "Axis X" and "Axis Y" respectively. But I can't figure out how this is done --- the recline

2016-12-27

2016-12-26

2016-12-25

2016-12-24

2016-12-23

2016-12-22
[14:34:21] <torf> I'm off for the holidays. Have a nice time everyone and see you in 2017!
[15:25:42] <benjwadams> I set solr to the be the ckan spatial backend and added bounding box fields to the solr schema, but I'm getting "too many boolean clauses"
[15:25:59] <benjwadams> when i try to select a large area on the ckan map
[15:27:35] <benjwadams> Am I going to need to rebuild the CKAN search indexes?  I tried refreshing the search indexes with paster, but to no avail

2016-12-21
[16:47:42] <stormntb> Hello!  I've been running a 2.6 installation of CKAN on Ubuntu 14.04 and I've been running into a few issues.  Would I be better off using a previous version?
[17:28:21] <ksivakov> what type of issues
[18:00:54] <stormntb> If I log in as a sysadmin, I'm unable to see the "Upload" or "Link" buttons.  I log out, log in as a different user, log out, and log back in as the sysadmin and the buttons become visible.
[18:02:46] <stormntb> I uploaded a few files (csv and xlsx) after that and I'm seeing "This resource view is not available at the moment." for each of them
[18:03:20] <stormntb> Files that I had uploaded before that process are viewable

2016-12-20
[12:47:27] <amercader_> wardi, ksivakov: sorry, I could not manage to make it to the dev meeting
[12:47:34] <amercader_> thanks to Spanish bureaucracy...
[13:19:13] <ksivakov> no problem by me
[13:19:35] <ksivakov> btw i didnt introduce, kind a shy before all the audience here :)

2016-12-19

2016-12-18

2016-12-17

2016-12-16
[01:46:27] <wardi> that's true!
[01:46:34] <wardi> oops

2016-12-15

2016-12-14
[11:58:24] <gr8_> A question regarding ckanext-geoview: Is it neccessary for previewing that the ressources are saved to local ckan-storage (like datastore) or is preview of external links in ckan possible?
[15:32:49] <gr8_> no idea anyone?
[15:42:54] <amercader_> gr8_: you should be able to preview external resources, but you will need the resource_proxy extension for that
[17:11:40] <gr8_> amercader_: Thanks! Anohter question: Does CKAN have an own-scheduling for harvesting or is it neccessary to do it via cron-job? - I am asking because in the GUI there is a field "update_frequency"
[17:49:19] <amercader_> gr8_: the scheduling is handled by the `paster harvester run`, which needs to be run via a cron job. Check the ckanext-harvest Readme for an example

2016-12-13
[14:02:26] <Nikolas_> hi
[14:16:04] <amercader_> hi Nikolas_!
[14:17:36] <Nikolas_> does anybody know a possibility to export data files as XLS/XLSX or ODS? (possibly from the datastore)
[14:18:31] <torf> Nikolas_: Not directly, but there are several Python packages that allow you to write XLSX files
[14:22:14] <amercader_> there's built in functionality for exporting csv, it should be really easy to adapt this to xls
[14:22:43] <amercader_> https://github.com/ckan/ckan/blob/master/ckanext/datastore/controller.py
[14:25:59] <wardi> Nikolas_: also see my recent work on https://github.com/ckan/ckan/pull/3344
[14:26:28] <wardi> the same sort of thing could be used to stream xlsx files with openpyxl
[14:29:08] <Nikolas_> thanks! @torf @amercader and @wardi
[15:51:51] <TkTech> amercader_: https://github.com/open-data/ckan/commit/1ae921c750820e8631718378b7434a2a81bdf4bf
[15:52:05] <TkTech> So it turns out implementing "read-only"/"maintence mode" is very simple
[15:52:17] <TkTech> I'll contribute it upstream when I get the chance
[16:40:48] <amercader_> That looks great TkTech ! I'm sure many people will love this
[16:40:59] <amercader_> I mentioned in https://github.com/ckan/ideas-and-roadmap/issues/171#issuecomment-266790214
[16:42:10] <wardi> TkTech: all I see is style changes :-P
[16:50:14] <wardi> TkTech: if it's your editor making the changes would you do those as a separate commit first?
[16:53:13] <TkTech> wardi: I don't auto-pep8, since those tend to look awful.
[16:53:41] <TkTech> I was fixing missing imports and straight up typos (it's obvious that we're missing tests or have lots of deprecated methods in there)
[16:53:47] <TkTech> And just kept going with it
[17:02:19] <wardi> ok, commit --patch then? I love seeing the important changes separated out if possible
[17:04:00] * wardi isn't trying to be difficult, hopes he's not coming off that way
[17:04:30] <TkTech> No, it's totally reasonable
[17:04:43] <TkTech> But that's our branch wardi not ckan/ckan :P
[17:05:32] <wardi> that's true!

2016-12-12
[15:58:31] <amercader_> hi TkTech, do you have an idea on when you'll have time to reviewing the Flask stuff (https://github.com/ckan/ckan/pull/3212 and other PRs)?
[15:59:52] <amercader_> we'll have new developers working on core stuff soon from Link Digital and Viderum and eventually they will work on the Flask migration, so I'm keen on having as much stuff as possible reviewed and merged, and properly documented for them

2016-12-11

2016-12-10

2016-12-09
[15:21:04] <wardi> I wonder why the coding standards tests are being run on all containers..
[15:21:57] <wardi> 3 times on each!
[20:09:29] <stormntb> hello! is there anyone here who could help me with my CKAN installation?  I'm trying to follow the instructions from http://docs.ckan.org/en/latest/maintaining/installing/install-from-package.html but got stuck with the jetty server in step 3.  I don't see a welcome page from Solr at http://localhost:8983/solr/ after running `sudo service jetty start`
[20:10:19] <stormntb> I followed the steps running on a Ubuntu 14.04 64-bit VM
[20:44:45] <guidos> @stormntb I also had trouble getting those steps to work for me. I ended up finding a vagrant script on github and altering it: https://github.com/GuidoS/Vagrant-CKAN/blob/master/Vagrantfile
[20:45:47] <guidos> I am building a ckan resource view extension and it works in development, but when using pip the template folder disapears
[20:45:51] <guidos> thoughts?
[20:46:40] <stormntb> thanks @guidos I'll check it out
[21:22:31] <wardi> guidos: if you want to maintain static (non .py files) in your package you need to add them to a MANIFEST.in file
[21:23:04] <guidos> I have a manifest.in, but it does not seem to be doing the packaging recursive
[21:23:52] <wardi> ours is https://github.com/open-data/ckanext-canada/blob/master/MANIFEST.in
[21:24:33] <wardi> but I can't guarantee it's correct because we install with git and `python setup.py develop` not pip
[21:31:07] <guidos> if you are using develop then it's not an issue because it's linking to your folder
[21:45:36] <guidos> that said, your manifest is right on
[21:45:37] <guidos> thanks

2016-12-08

2016-12-07
[18:37:38] <TkTech> amercader_: https://github.com/ckan/ckan/blob/c0d88b56d954136de08967e1b249ce4ac260ed41/ckan/logic/action/delete.py#L56
[18:37:56] <TkTech> L56 to L64 should be inside a begin_nested() transaction IMO
[18:38:24] <TkTech> Otherwise you can end up in a state where membership relationships exist but the associated user does not
[19:15:21] <amercader_> You are right, I'll send a PR tomorrow

2016-12-06
[10:15:26] <Venu_> JOIN
[10:15:34] <Venu_> Help
[11:01:13] <amercader> PSA
[11:01:23] <amercader> "WSGIThreadPoolServer' object has no attribute 'thread_pool'" means "Something else is running on port 5000"
[11:01:50] <amercader> after all these years and I still keep forgetting
[12:01:50] <wardi> love those intuitive error messages
[12:02:15] <wardi> amercader, TkTech: meeting?
[12:02:28] <amercader> coming
[12:02:31] <amercader> 1 min

2016-12-05
[16:26:43] <coasterz> Morning wardi, curious about the pytz==2012j requirement in scheming https://github.com/ckan/ckanext-scheming/blob/master/requirements.txt#L3 This appears to be in conlfict with the current ckan 2.6+
[16:26:55] <coasterz> Is it safe to bump the schmeming requirement ?
[17:06:53] <coasterz> ah nevermind, I see a PR discussing this
[17:09:12] <wardi> coasterz: requirements.txt versions are not enforced anywhere by default
[17:09:37] <wardi> I could merge the change removing the version, because scheming doesn't care
[17:12:16] <coasterz> If you wouldn't mind, that would solve the version conflict I am getting at present :)
[17:14:21] <wardi> what's enforcing a version check?
[17:15:14] <wardi> requirements.txt files have never done that for me
[17:17:31] <wardi> What I should really do is fix scheming's test scripts to pull the right solr schema files

2016-12-04

2016-12-03

2016-12-02
[09:05:09] <martinus__> Hi there. I can't find the answer on ckan website : how easy is to embed views to an external website (ie, not in CKAN CMS) ?
[09:06:30] <martinus__> nigelb, maybe you have the answer ?
[09:14:23] <nigelb> I haven't worked on ckan in a while.
[09:15:06] <nigelb> I think amercader and/or wardi would be a better bet.
[09:17:57] <martinus__> thanks nigelb
[11:55:22] <amercader> martinus__: you can embed any view using the "Embed" button on the resource page: http://demo.ckan.org/dataset/newcastle-city-council-payments-over-500/resource/0c2bd47a-6ac5-412e-a337-1b45a952e07e
[11:57:02] <martinus__> Thanks amercader , that was so simple...
[11:58:01] <amercader> no problem
[12:14:15] <amercader> wardi, TkTech: the frictionlessdata specs don't mention BOM (and given the tools support I don't think they can enforce anything on that front), but the libraries support files with and without it eg https://github.com/frictionlessdata/tabulator-py/blob/master/tests/test_topen.py#L43-L57
[14:15:53] <wardi> amercader: ok, but what would you recommend publishing, with or without?
[14:24:49] <amercader> I wouldn't go as far as recommending either way. But my (limited) understanding is that getting rid of the BOM might cause problems opening the file in Excel, so perhaps I'd go for maximising compatibility
[14:39:58] <wardi> currently we're not generating files with a BOM (there is no byte order in UTF-8 damnit!) But if we go that way I'll try to make it our standard
[14:41:35] <wardi> it will be annoying for anyone doing automated processing on our files, but that's probably easier than training normal users how to open these files in excel
[16:14:32] <benjwadams> in the call `ckan.logic.action.get.config_option_list(context, data_dict)`, what are `context` and `data_dict`?  They do not show up in the docs
[16:19:24] <wardi> benjwadams: your parameters are all in data_dict
[16:19:51] <benjwadams> and the context?
[16:20:17] <wardi> context usually best to ignore IMHO. It's occasionally used for dirty hacks and passing hidden parameters that only extensions or ckan core have access to
[16:20:20] <benjwadams> I just want to list all config variables loaded, but don't currently have an API key set up.
[16:20:30] <benjwadams> so passing None is OK?
[16:20:58] <benjwadams> i.e. `ckan.logic.action.get.config_option_list(None, {})`
[16:21:06] <wardi> it does have the user making the request
[16:22:01] <wardi> benjwadams: that might just  work for config_option_list
[16:22:21] <benjwadams> AttributeError: 'NoneType' object has no attribute 'get'
[16:22:33] <wardi> oh, if you're calling from an extension you don't need an API key
[16:22:47] <benjwadams> looks like i need a user of some sort?
[16:22:55] <wardi> I suggest using ckanapi.LocalCKAN so you don't need to care about this
[16:23:12] <wardi> or copy what it does I suppose
[16:23:41] <wardi> benjwadams: what's the larger thing you're trying to do?
[16:24:03] <benjwadams> i'm just making sure some config params are loaded correctly in a docker image i have
[16:24:07] <benjwadams> sanity check
[16:24:16] <wardi> If you want to get the configuration you probably want IConfigurable
[16:24:51] <wardi> The config object itself is also in plugins.toolkit now
[16:40:12] <benjwadams> hmm
[16:40:48] <benjwadams> must be using an older version.  I tried with the api key and curling but it's giving me a 403 Forbidden even with the admin's API key

2016-12-01
[14:00:03] <sqm> Hi! If I change something in a python-file of ckan - do I have to recompile it?
[14:00:52] <wardi> sqm: no, you might need to restart your ckan though
[14:01:03] <sqm> thanks wardi
[14:03:03] <wardi> TkTech, amercader: meeting?
[14:06:49] <amercader> I'm on it!
[14:07:09] <amercader> Am I in the right hangout?
[14:26:30] <wardi> UFT-8 CSV files. BOM or no BOM?
[14:26:35] <wardi> *UTF-8
[15:09:31] <TkTech> wardi: the answer should be no, but in reality you want the BOM to work with Excel and other poorly done tools
[15:12:01] <wardi> TkTech: my reality is when I read a CSV with a bom it gets attached to the first column title.  That's just the default for the tools I use, maybe other peoples' tools are smarter
[15:12:33] <wardi> I wonder what pandas and R do
[15:13:14] <torf> Excel and CSV is as broken as you can get something that you still call a feature
[15:27:30] <TkTech> wardi: pandas has a bunch of open bugs for BOM handling in read_csv, it's totally broken.
[15:27:45] <TkTech> The pure-python read_csv depends on CPython's reader which is broken
[15:27:45] <wardi> yay!
[15:27:57] <TkTech> And the C version depends on the panda's-written version which only kinda-works
[15:30:10] <wardi> I guess we just go back to sharing access databases on usb keys
[15:30:23] <wardi> amercader: what does frictionless data say?
[15:30:54] <TkTech> ahhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhhh
[15:33:30] <nigelb> wardi: *groan*
[15:33:40] <nigelb> I haven't worked on ckan in a few years
[15:33:43] <nigelb> and that makes me groan :P
[15:34:18] <wardi> I said it to get a reaction from TkTech because that's a thing we do here :-)
[15:35:58] <nigelb> sympathies.
[15:36:14] <nigelb> how have you not stabbed people yet?
[15:39:45] <TkTech> I get my revenge in more subtle ways.
[15:39:58] <TkTech> Like a little rootkit that flips a random byte once an hour on his laptop
[15:40:27] <wardi> noooooooooo7ooooooo
[15:40:45] <torf> :D

2016-11-30
[04:32:02] <candymaple> Hello wonderful channel of people most likely more knowledgeable about CKAN than I! I seek your insight, I've tried to customize a template by creating a plugin. And at first it said, ImportError, no module plugin === I got that fixed by rearranging the ckan.plugins parameter ==== now the front page loads, but in trying to follow the docs, I'm unable to make the front page a blank page --- my custom template does not seem to overwrit
[15:06:55] <nkfx> Hey all, I'm having trouble with my custom plugin templates being recognized and overwriting the default templates - I'm following the 'readthedocs' custom template instructions ---
[15:19:35] <nkfx> OK, I see now --- the readthedocs info doesn't talk about how babel is auto-installed when a plugin is created!
[16:50:42] <nkfx> Really though, what is the deal with message extraction, custom themes and babel -- even the link the CKAN docs send me to are dead links :/
[18:24:16] <nkfx> Any help to get custom themes off the ground would be great help! The whole Babel package is throwing me off, and templates are not being overwritten, please help, any insight - greatly appreciated

2016-11-29
[12:40:16] <gr8> Hey! For e-mail-notifications we would like to use a relay-smtp-server. Is this possible in CKAN? - How could we use that?
[12:40:51] <gr8> postfix and main.cf are configured
[12:42:00] <wardi> gr8: sure, point the smtp settings wherever you need, right?
[12:50:01] <gr8> yes, so can we o configure the ckan-setting smtp.server with the relay-server
[12:50:15] <gr8> ?
[14:17:10] <Nikolas_> hi there
[15:27:09] <wardi> gr8: that should work, yes
[15:27:15] <wardi> Nikolas_: hello

2016-11-28

2016-11-27

2016-11-26

2016-11-25

2016-11-24
[11:00:44] <bithu> hi
[11:01:11] <bithu> Have a question regarding updating the tag list in your ckan application
[11:02:18] <bithu> I recently added some tags to my existing vocabulary , but even after restarting my ckan application the new tags where not getting reflected in my UI
[11:02:52] <bithu> I was able to get the new tags only when deleted the vocabluary and tags from the backend and restarted the database
[11:03:16] <bithu> is there any way to update my tag list , without a backend hack?
[11:08:50] <bithu> hi can somebody help me
[11:14:48] <bithu> Hi ' I'm again rephrasing my question
[11:14:50] <bithu> I recently added some tags to my existing vocabulary , but even after restarting my ckan application the new tags were not getting reflected in my UI(vocabulary is a select box and the tags are the different options under it , recently added two more options). I was able to get the new tags only when I deleted the vocabulary and tags from the backend and restarted the application  is there any way to update my tag list , without a backe

2016-11-23

2016-11-22

2016-11-21
[11:32:36] <gr8> How is it possible to get the package with a specific resource_id?
[12:22:54] <gr8> Another question: When I upload a resource manually to datastore, uploading starts - but it is repeating it over and over again (like an inifinite loop). What could be the probleme in that case?

2016-11-20

2016-11-19

2016-11-18
[12:31:08] <gr8> How is it possible to add all ressource to datastore (e.g. via paster)?
[12:35:08] <gr8> or is it possible via datapusher submit_all?

2016-11-17
[04:57:15] <dcmul> hi all. Quick question, during extension development, is it possible to indicate that your extension depends on availability of another extension?
[07:57:32] <dcmul> hi all. Quick question, during extension development, is it possible to indicate that your extension depends on availability of another extension?
[08:29:54] <torf> dcmul: You can declare a dependency on another extension in `requirements.txt`, just as you would for other Python packages. However, that only guarantees that that extension is installed, not that it is also configured to be loaded (in production.ini). There is no automatism for that so you'll need to mention this in your installation documentation.
[09:55:26] <Nikolas> good morning
[14:07:12] <gr8> Hi! After updating to CKAN 2.5.3 (from 2.3.x) there is no Data-API button for resource - and a preview is also not possible, although the datastore-tab shows that the file was upload a long time ago. So, do I have to execute further steps in order get resource-preview (and data-api) working again?
[14:08:45] <gr8> If I add a new resource or upload an existing resource to the datastore again, the resource-preview will work
[14:10:14] <gr8> It is currently a internal site - so, is it generally possible to preview resources? because of the dataproxy
[15:21:59] <wardi> gr8: did you check the release notes? You might need to create your resource views
[15:28:35] <gr8> wardi: yes - but, to be honest, I cannot find any hint that it is neccessary to re-create the resource-views when one updates from 2.3 to 2.5
[15:31:46] <amercader> this sounds like the datastore_active field has not been stored on the db on the datastore resources (it used to be added on the fly)
[15:32:31] <amercader> I'm pretty sure there was a migration for this but maybe it didn't work as expected
[15:32:49] <amercader> gr8: I'm assuming you did `paster db upgrade`
[15:33:50] <amercader> you can try to run this manually: https://github.com/ckan/ckan/blob/master/ckan/migration/versions/081_set_datastore_active.py
[15:34:27] <amercader> or reupload all resources to the datastore with `paster datapusher submit_all` (that might take a while depending on how many resources do you have)
[15:35:01] <gr8> amercader: yes, I executed paster db upgrade
[15:35:05] <gr8> thank you!
[15:35:46] <amercader> np

2016-11-16

2016-11-15
[14:17:28] <wardi> so the tracking_details are in solr, just in some other fields. We should add an include_tracking parameter to package_search to get it in the results again

2016-11-14

2016-11-13

2016-11-12

2016-11-11

2016-11-10
[13:45:29] <amercader> wardi, TkTech: I can't join the meeting today sadly
[14:00:00] <wardi> we could skip this one
[14:00:19] <wardi> I would like to raise the tracking_details issue on Tuesday though
[14:01:36] <wardi> that's a useful feature we should have back. I'm sure we can do it in a much less heavy way than a full-reindex so admins could run it more frequently
[15:41:05] <TkTech> What was tracking_details?
[16:14:28] <wardi> TkTech: it's a thing that lets you show which datasets are the most popular
[16:15:42] <wardi> IIRC it tracks user-clicks over a sliding time window
[16:19:26] <TkTech> Ah right, I remember this.
[16:19:33] <TkTech> It powers the default sort-by-popularity as well right?
[16:19:33] <wardi> we should have that info in solr so we can weight more popular datasets higher, but a regular full reindex for our site isn't practical. pushing that update to just one field in solr should be easy
[16:19:37] <wardi> yes
[16:19:44] <wardi> so that's broken now too
[16:21:52] <TkTech> Someone just a short while ago was showing off their popularity sort
[16:22:00] <TkTech> They had rewritten it with proper decaying windows and everything
[16:22:31] <wardi> oh?
[16:46:00] <TkTech> Trying to find who it was ;\

2016-11-09
[02:29:16] * Psykar pokes computer. You done being silly? kthks
[10:15:48] <h8i> Hi! If a property is in included in the API of packages, but cannot be accessed in template via package['property'] -- what is wrong?
[10:23:01] <torf> h8i: What do you mean by "is included in the API of packages"?
[10:28:07] <amercader> h8i: do you mean that the property is available on `/api/action/package_show` but not on the package dict when in a template?
[10:28:41] <h8i> amercader: yes!
[10:29:11] <amercader> is that a core property? or one added by a custom schema?
[10:31:49] <h8i> it is tracking_summary, I changed the core-file of get.py so that include_tracking is always true (in method package_show)
[10:35:32] <h8i> but in the template-file (package_item) I cannot access it (although it is shown in /api/action/package_show)
[10:37:51] <amercader> This is because `tracking_summary` apparently is always stripped before indexing the search results: https://github.com/ckan/ckan/pull/2207/files#diff-91ec3ea1f3b6d404c10bffb6161aee75
[10:38:41] <amercader> it is indexing `views_total` and `views_recent`. Are these coming up? Maybe you can use these ones instead
[10:48:16] <h8i> hmmm these are not availaible in /api/action/package_show. However, when I use it in the template (e.g. package.views_total), it is empty - although there should be a value.
[10:52:12] <amercader> tracking needs to be filled running a paster command http://docs.ckan.org/en/latest/maintaining/tracking.html
[10:52:26] <amercader> try running the paster command and reindexing the datasets wuth
[10:52:35] <amercader> with paster search-index rebuild
[10:52:44] <amercader> the values should come up
[11:02:52] <h8i> These commands are running in a cronjob (and tracking is in config file enabled). I started them manually - including restarting of solr and webserver.
[11:03:01] <h8i> No changes - unfortunately. Thats strange ;)
[11:03:33] <h8i> However - shouldn't {{package.views_total}} return 0 anyway? - its empty, since it is not possible to find the property
[11:08:59] <h8i> In /api/action/package_show I could find following: "tracking_summary": {"total": 3, "recent": 3}
[11:15:26] <h8i> Are there any workarounds for accessing the total-value in template? - Problably a helper-method?
[12:53:48] <h8i> fyi - I implemented the mentioned workaround: helper-function which calls the action-api. So it is working now!

2016-11-08
[10:30:31] <bijith> hi
[10:30:38] <bijith> I have an issue
[10:30:58] <bijith> I have updated a select box content in my dataset creation form
[10:31:27] <bijith> but even after I restarted my ckan server the changed value is not taking effect
[10:42:15] <bijith> hi can someone help me
[12:01:15] <wardi> bijith: report a bug? we need more details
[12:02:02] <wardi> amercader: meeting?
[12:02:09] <amercader> coming!
[16:09:07] <h8i> Hi - after updating CKAN from 2.2 to 2.5 "tracking_summary" of packages is always null, since the property of tracking_summary is not found. Does anyone know how it is possible to get this working again?
[16:19:45] <wardi> h8i: since https://github.com/ckan/ckan/pull/2207 you need to pass include_tracking=True to package_show if you want the tracking details. Are you talking about in the search results though?
[16:21:44] <h8i> yes, I am talking about the search results ;)
[16:22:43] <wardi> please open an issue. we've got background jobs and redis now, there's probably a better way to implement this than what we were doing in 2.2
[16:24:10] <wardi> in 2.2 you'd have to set up a regular search index rebuild just to keep the tracking info up to date. that doesn't work well for some larger sites
[16:50:50] <h8i> thank you - do I have to implement IPackageCtrl to pass include_tracking via data_dict? Or is there an easier way to do this?
[16:54:56] <wardi> you could add it back into your solr index so it's part of your search results with a before_index method
[17:27:57] <h8i> Thanks!

2016-11-07
[10:10:46] <h8i> Hey! Does anyone know why "package.tracking_summary" does not work in template package_item? - the property tracking_summary is not found, so how is it possible to fix this?
[12:34:52] <travis-ci> aptivate/ckan mapaction-dev-2.5.3 645cd51 https://travis-ci.org/aptivate/ckan/builds/173881361 tomd: The build has errored.

2016-11-06

2016-11-05

2016-11-04
[11:35:12] <Nikolas> hi
[16:16:03] <h8i> Does anyone know why package.tracking_summary does not work in package_item? - the property tracking_summary is not found

2016-11-03
[13:04:17] <mih_> Hi! following does not work anymore since I upgraded to the newest version: build_nav_icon('related_list') -- how can we achieve this in the newest ckan version?
[13:32:43] <mih_> do I have to use ckanext-showcase?
[13:56:02] <TkTech> mih_, Correct, migration started last year - https://github.com/ckan/ckan/pull/2610
[14:33:56] <mih_> TkTech: Is it neccessary to add manually links for adding new showcases or editing them to the template? Our should links be shown automatically, when the plugin is enabled?
[14:34:25] <TkTech> I admit I haven't used the showcase plugin mih_, can't help you there.

2016-11-02
[09:43:19] <gr8_> I am installing a new ckan-instance - is it already possible to use version 2.6?
[12:46:08] <torf> gr8_: 2.6 hasn't been officially released, so the safe way would be to either install 2.5.2 or to wait until the official release of 2.6.
[12:48:50] <torf> However, there probably won't be many big changes, so you could simply install the latest 2.6 commit from the release-v2.6-latest branch (https://github.com/ckan/ckan/tree/release-v2.6-latest). Once 2.6 has been officially released (and assuming there were no major changes) you can then replace the CKAN installation in your virtualenv with the one from the official release. The rest of your setup (PostgreSQL, web server, etc.) shouldn't be affected by that.
[13:12:09] <gr8_> thank you - I was asking because last week I got an email with the information that today the new version will be released ;)
[13:12:56] <gr8_> but at the moment it is also okay for me to use the latest 2.6
[13:13:23] <torf> You're right, I hadn't checked the date. So 2.6 should indeed be released later today
[13:28:36] <torf> And here it is: http://ckan.org/2016/11/02/ckan-2-6-0-released-patch-versions-for-2-3-x-2-4-x-and-2-5-x-available/

2016-11-01
[11:41:58] <wardi> guidos: I think this is the first time I've seen it mentioned
[12:02:55] <amercader> wardi, TkTech: meeting?

2016-10-31
[10:26:32] <dcmul> hi
[10:27:22] <dcmul> am having problems migrating a ckan install. somehow when i migrate the rosource folder the system cant find it
[10:51:56] <tktech_> Have you set your storage path in the ini.
[10:56:59] <dcmul> yes i have
[10:57:48] <dcmul> but the resources still cannot be downloaded. The system cant find them
[11:08:08] <dcmul> :TkTech
[11:53:55] <mih_> Hi! I have a question - we need a versioning/history of resources, are there any extensions which provide such a functionality? or how is it possible to achieve this?
[11:56:59] <mih_> A history of changed/earlier values of dataset-fields would be great as well!
[12:09:25] <mih_> a few years ago it was possible to compare different revisions - I could not find this feature anymore!?
[13:19:49] <wardi> mih_: it's there just sort of hidden at the moment
[13:20:58] <wardi> mih_: try /dataset/history/<id>
[13:50:38] <mih_> thanks ,)
[13:50:39] <mih_> ;)
[17:53:56] <guidos> https://www.irccloud.com/pastebin/hMqNJAu9/create-db-for-ckan-error
[17:54:31] <guidos> This is all on a precise64 machine I created with vagrant
[19:48:27] <wardi> guidos: interesting. try setting your LANG=en_US.UTF-8?
[19:48:58] <wardi> the postgres docs might also be able to help
[21:32:54] <guidos> wardi: ya, tried that... also is this something that others are finding?

2016-10-30

2016-10-29

2016-10-28

2016-10-27
[12:06:53] <mikkonieminen> Hi, I'm having trouble with creating a new extension and running its methods with paster. I'm calling a method in the extensions plugin.py which in turn calls the core mailer method mail_user. Everything works fine when the same method is called through a helper, but when I run it with paster I always get the error: TypeError: No object (name: app_globals) has been registered for this thread
[12:06:59] <mikkonieminen> Any clue why this happens?
[12:09:32] <torf> mikkonieminen: Sounds like the CKAN environment isn't initialized correctly in your paster process. Normally that should happen automatically. Have you registered your paster task in setup.py and are you calliing it via `paster --plugin=ckanext-my_extension ...`?
[12:09:59] <mikkonieminen> Yes, just like that
[12:10:53] <mikkonieminen> Its defined like this: [paste.paster_command]
[12:10:57] <mikkonieminen> reminder=ckanext.reminder.commands:Reminder
[12:13:13] <torf> Ah, I forgot: You need to call `self._load_config()` in your command
[12:13:17] <torf> See, for example, https://github.com/ckan/ckan/blob/c0d88b56d954136de08967e1b249ce4ac260ed41/ckan/lib/cli.py#L449
[12:14:07] <mikkonieminen> Just for clarification: The method is recoqnized by paster but the error gets thrown inside mailer
[12:14:24] <mikkonieminen> Yeah, I have that in my command also
[12:15:35] <torf> Strange
[12:20:01] <torf> Do other things that need a  CKAN environment work, e.g. can you call action functions (via `toolkit.get_action`)?
[12:22:07] <mikkonieminen> All the other extensions are working, but I can test that case also
[12:27:17] <mikkonieminen> Actions through toolkit.get_action work also fine
[14:02:49] <amercader> @torf do you want to pop into the dev meeting to talk about your PR?
[14:03:10] <torf> amercader: Sure, give me a moment
[15:35:46] <torf> mikkonieminen: Sorry, in that case I currently don't have any other ideas. You might want to check if the problem also occurs with the latest development version or try to produce a minimal working example that others can use to verify/debug the problem.

2016-10-26
[12:03:26] <bithu> hi
[12:04:16] <bithu> hi
[12:04:39] <bithu> Where can I find the related tab in Ckan
[12:14:09] <bithu> I have found it in the documentation , but since i have redone some part of the core ckan theme I'm not able to find it now
[12:23:46] <bithu> or you can tell me which template is called when http://localhost:5252/dataset/ is called
[13:28:52] <mdartic> hi everyone,
[13:28:59] <mdartic> I have a question about ckan website
[13:29:20] <mdartic> and the database
[13:29:34] <mdartic> I have discovered this website : http://opendatadiscovery.org/
[13:29:53] <mdartic> that use data from ckan.org/instances/
[13:30:24] <mdartic> but i was wondering why the website data.gouv.fr wasn't on it
[13:31:00] <mdartic> may I have to understand it's not a ckan instance ?
[13:34:40] <mdartic> because I've read on several websites that data.gouv.fr uses ckan...
[13:34:43] <mdartic> thanks for your reply
[13:47:55] <Zharktas> mdartic: apparently data.gouv.fr uses ckan somewhere in there but those listing services are not automatic, some one needs to report the instance to them
[13:50:40] <mdartic> Zharktas: thank you for your answer
[13:51:00] <mdartic> do you know how I can ' report the instance to them ' ?
[13:52:02] <mdartic> oh I just see a link... saying we can report to them
[13:52:05] <mdartic> so sorry
[13:52:15] <mdartic> thanks !

2016-10-25
[07:14:55] <teemu> wardi: (ckanext-scheming) Is there any way to create a validator for the "private" field? It's bundled in with the "organization" form snippet, but validators for that only get the selected organization, not the new privacy value. The "package" within "context" also contains the old value.
[12:02:42] <wardi> teemu: there are a couple ways
[12:03:19] <teemu> wardi: I went for a separate "private" field in the schema
[12:03:26] <teemu> then null for form and display snippets
[12:03:40] <teemu> and modified the validator to fit
[12:03:50] <teemu> after some research
[12:38:38] <wardi> teemu: yes, that or use the 4-parameter form of validator from any field http://docs.ckan.org/en/latest/extensions/adding-custom-fields.html#custom-validators
[13:06:32] <pauli> Hi is there a reason why CKANHarvester._get_rest_api_offset was dropped in release 0.0.5?

2016-10-24
[14:41:05] <seanpauli> Hi. I'm currently trying to run some nosetests and am stuck with this (http://pastebin.com/raw/Pn4GcLMv) persistent error. Any ideas or pointers for me?
[15:01:03] <seanpauli> Created a local who.ini file but still the same error.

2016-10-23

2016-10-22

2016-10-21
[11:43:05] <torf> Glad to see that the German translation for 2.6 is already done -- yay!
[11:43:33] <amercader> wunderbar!
[11:43:41] <torf> :D

2016-10-20
[11:45:03] <Zharktas> Does ckanext-qa and ckanext-archiver actually work with stock ckan ?
[11:46:53] <Zharktas> qa update is pushing tasks to queue bulk, which as far as i can tell, can't be defined in stock ckan. data.gov.uk had their own fork where multiple celery queues were implemented and we cherry-picked this functionality to opendata.fi, but we don't want do that in our new instances
[13:52:20] <amercader> Zharktas: you will have to ask the guys at DGU as they have been maintaining these two extension for a while. Just open an issue on one of the repos and they will get back to you
[13:56:06] <torf> amercader: (Something completely different) It seems my Transifex application to the CKAN team must be granted manually. Would be awesome if you could do that. Thanks!
[13:56:58] <amercader> sorry, done now
[13:57:08] <torf> no worries, thanks!
[13:57:22] <amercader> Annoyingly I can't seem to get Transifex to notify me of new requests. Will try again
[13:57:47] <torf> that does indeed sound annoying
[14:07:12] <amercader> tktech: quick meeting? (not sure if wardi is still on holidays)

2016-10-19
[12:09:38] <travis-ci> espona/ckan master 5056ede https://travis-ci.org/espona/ckan/builds/168904685 Lucia Espona: The build has errored.
[22:22:09] <Ezriilc> Anyone here interested in some CKAN download stats for HyperEdit?  I have some interesting data.
[22:26:15] <tktech> Ezriilc, wrong CKAN.
[22:26:39] <Ezriilc> ha!  really?
[22:26:45] <tktech> It's even in the topic :P
[22:26:58] <Ezriilc> hehe... yea.  I'm a ditz.

2016-10-18

2016-10-17
[13:14:16] <bithu> hi

2016-10-16

2016-10-15

2016-10-14

2016-10-13
[16:17:54] <gnat_x> if i want to put ckan behind TLS do i do that at the apache level, or  nginx?
[16:18:51] <torf> gnat_x: We're doing SSL/TLS-termination in Nginx and it's been working nicely
[16:19:21] <gnat_x> torf: cool. will give it a shot at that level.
[16:20:05] <torf> Make sure to add "https" to your ckan.site_url setting in production.ini, otherwise CKAN will generate HTTP-links.
[16:22:16] <gnat_x> right, i already did that before setting up the cert. it isn't happy.

2016-10-12

2016-10-11
[08:06:52] <dcmul> Hi all, and stuck and am hoping soemone here can be kind and help me. The first time i installed solr and run ckan, it run well. When I stopped and restarted a few days later, this is the error i get http://pastebin.com/X9VHiMZ8.  i have looked at issue https://github.com/ckan/ckan/pull/2915 and stried some of the suggestion. doesnt seem to be solving my problem. Am running solr 5.2.1 and ckan 2.0
[08:08:14] <dcmul> correction with version CKAN 2.3 with Solr 5.2.1
[08:10:55] <torf> dcmul: Solr raising a NullPointerException looks like a bug with Solr, not like an issue with CKAN
[08:12:44] <dcmul> since i am using the ckan schema, i was hoping that some people have had the same scenario.
[08:13:54] <dcmul> :torf you are right, its solr issue
[10:12:37] <bijith> hi, how can we access extras in our data from plugin.py of your plugin?
[10:51:03] <bijith> Hi, can anyone tell me how I can access the feilds put into extras of a dataset?
[12:04:06] <amercader> anyone up for a metting? wardi, tktech
[12:04:13] <amercader> meeting even
[12:17:03] <wardi> not for a couple weeks, tktech is attending the thursdsy ones iirc
[12:21:14] <amercader> good to know
[12:21:22] <amercader> cheers
[15:16:33] <tktech> dcmul: Can you throw your schema on gist.github.com
[15:16:38] <tktech> dcmul: I'll show you how to fix it
[15:57:04] <fotcorn> hi! can someone tell me how i can activate logging of sql statements sent to the database?

2016-10-10
[09:41:58] <bijith> I have made a plugin extending the IDATASET form interface, some tags that has been added to extras has json content , which i need to process, what is the best way way to do this?

2016-10-09

2016-10-08

2016-10-07
[10:44:15] <torf> The documentation of ckanext.spatial says that I must geo-index my datasets. In my case, however, some *resources* also have their own geo-references. Does ckanext.spatial support geo-indexing at the resource level?
[15:26:10] <gnat_x> hi folks. i'm trying to install from source on a Debian Jessie server, following these docs http://docs.ckan.org/en/latest/maintaining/installing/install-from-source.html
[15:26:34] <gnat_x> however when i get to the part about setting up solr, i doesn't seem like jetty8 is running.
[15:26:51] <gnat_x> is this a know issue?
[15:36:15] <gnat_x> alternately, is there any hope of a new docker image?
[15:50:39] <torf> gnat_x: There have been problems with Jetty's JSP support. If that's your problem, try the solution posted here: https://github.com/ckan/ckan/pull/2966
[15:57:34] <gnat_x> torf: awesome that worked.
[15:57:42] <torf> Perfect :)
[18:00:20] <gnat_x> if i want to put ckan behind TLS, do i configure that at apache or nginx?

2016-10-06
[06:46:31] <torf> Has anyone already experimented with running CKAN on PostgreSQL 9.6 (released 2016-09-29)?
[09:13:46] <wardi> torf: i'd expect no issues
[10:36:09] <bijith> hi, is there any documentation to understand the ckan internals?
[14:03:18] <wardi> bijith: there is some of that on docs.ckan.org
[14:04:33] <wardi> http://docs.ckan.org/en/latest/contributing/architecture.html
[14:04:35] <torf> wardi: Me neither ;)
[14:12:59] <bijith> thanks

2016-10-05

2016-10-04

2016-10-03

2016-10-02

2016-10-01

2016-09-30
[11:26:19] <KevinM_> Hello
[11:30:46] <KevinM_> Is there any official CKAN developer, or technical support there ? I would like to discuss something in private please. Thank you
[16:25:02] <tktech> KevinM_: There is a core development team as well as a few companies offering commercial support.
[16:25:18] <tktech> You can find a list of us here - http://ckan.org/about/technical-team/#current-members
[16:26:28] <tktech> Wait a second he's not actually here
[16:26:42] <tktech> Silly bouncer has the names list all messed up

2016-09-29
[17:09:12] <jrods> wardi: i messed up my org PR for api_info, i resubmitted: https://github.com/ckan/ckan/pull/3261

2016-09-28
[10:29:33] <bijith> hi
[10:29:41] <bijith> I have one qyery
[10:30:32] <bijith> if I had put a print statement in plugin.py , where it is going to show up ? in paster.log or the UI?
[10:30:56] <bijith> Do I need to restart ckan after any changes made to plugin.py?
[10:33:30] <torf> bijith: Print statements usually only show up in the terminal where you executed the original command (e.g. `paster serve`). In some cases, there might not be a terminal at all (for example, if you start CKAN inside Apache from initd). In that case your print message will be lost. To output something to the logfiles use the logging mechanism. If you want to put something into the web UI you will usually need to override a template.
[10:35:53] <bijith> Thanks , torf is there any documentation for creating logs in ckan?
[10:36:13] <bijith> Also do we need to restart ckan after making a change to plugin.py?
[11:01:11] <bijith> hi, I have changed the return types of some functions in plugin.py but not seeing the effect that in the UI, what might be the problem
[11:10:59] <torf> bijith: Do you mean you changed the return *values*? (you usually cannot simply change the return *types*). How things are displayed depends very much on what you're working on. What do you want to do?
[11:13:34] <bijith> I have to change the value displayed on the UI which is send by a function, so I made changes so that the new value is returned by the function, but UI is still showing the old value
[11:14:26] <torf> Which value and which function are you working at?
[11:52:04] <bijith> the function was returning a string variable , I want to return the type of the variable, so I have change return str -> return type(str)
[11:54:20] <torf> bijith: While Python is a dynamically typed language, simply changing a function's return type usually does not work. Can you please describe what you are trying to do on a high level? E.g. "I want to display a dataset's last-modified timestamp in the list of datasets".
[12:00:27] <bijith> I want to display the type of the result, instead of the real variable#
[12:01:07] <torf> What is the name of the function your are working on? Is it one of the standard CKAN plugin interface methods?
[12:03:01] <bijith> no it is a custom function I wrote for my plugin
[12:03:51] <torf> Where is the result of the function used? If it is displayed in the web UI then it is somehow passed to the templates. Where and how is this done?
[12:09:26] <bijith> schema.update({             'tag_for_the_func': [tk.get_validator('ignore_missing'),                                         tk.get_converter('convert_to_tags')('my_function')             ]         })
[12:09:49] <bijith> I create the function add this into modify_schema and show_schema
[12:10:19] <bijith> methods in of plugin.py
[12:13:31] <torf> OK, so you're implementing the IDatasetForm interface? Does everything work if you return the string value instead of the type?
[12:30:49] <bijith> YES
[12:32:35] <bijith> but I don't get any error , and the value displayed is an old value, which I think is a list as the UI shows an empty  list like this []
[12:33:29] <torf> If you replace the original return-statement in your function by "return 'foo'", does 'foo' show up in the UI?
[12:34:22] <bijith> have to check
[12:34:28] <bijith> one sec
[12:40:13] <bijith> no error and foo is not coming in the UI
[12:41:18] <torf> OK, then you should first try to figure out why that is not working before messing with the return type.
[12:41:52] <torf> If you're trying to implement the IDatasetForm interface I suggest you start with the example provided with CKAN (https://github.com/ckan/ckan/tree/master/ckanext/example_idatasetform). Once you got the example running try to modify it to do what you need.
[12:42:14] <bijith> I'm rather new to CKAn , can you point me to some documentation or tips that I can refer
[12:42:32] <bijith> thanks
[12:43:12] <torf> Sure. The documentation for IDatasetForm is quite detailed, so it's a good place to start: http://docs.ckan.org/en/latest/extensions/adding-custom-fields.html
[12:43:36] <torf> That assumes that you have experience in writing CKAN extensions, so you might want to read http://docs.ckan.org/en/latest/extensions/tutorial.html first
[12:49:44] <bijith> if you add some logging stmts using logging package where they must show up paster.log?
[12:53:47] <torf> That depends on how you start CKAN and how you configured the logging. If you start CKAN via `paster serve` and did not change any logging-related settings then your log messages should be shown in the terminal, assuming that their log level is high enough.
[12:57:15] <bijith> where we have to make log settings
[12:58:14] <torf> Normally you don't need to change the log settings, but they can be found at the bottom of your production.ini/development.ini. They use the standard Python format for logging configurations in INI files.
[19:46:18] <Samuel> Ol

2016-09-27
[12:01:56] <wardi> amercader, tktech: meeting?
[12:02:05] <amercader> sorry, coming

2016-09-26
[17:34:15] <wardi> amercader: nice migration wiki page!

2016-09-25
[12:17:30] <daniel> hi
[12:17:38] <daniel> anybody here?
[12:20:28] <Guest55392> ?
[12:20:50] <Guest55392> http://stackoverflow.com/questions/39686383/upload-error-could-not-connect-to-datapusher-error-in-ckan-2-4-3
[12:21:02] <Guest55392> http://stackoverflow.com/questions/39663415/ckan-datapusher-api-3-action-resource-show-caused-by-class-socket-error
[12:21:22] <Guest55392> please give me answer above two my question
[12:22:56] <Guest55392> h
[12:22:57] <Guest55392> hi
[12:26:56] <goodman> hi

2016-09-24


2016-09-23
[07:04:24] <dcmul> hi..i need help
[07:04:28] <dcmul> am migrating ckan
[07:05:22] <dcmul> after migrating db from one computer to another the dataset section is empty
[11:28:43] <torf> dcmul: How did you migrate the data?
[11:29:26] <dcmul> hi torf, i rebuilt the index, and fixed my problem..
[11:29:42] <torf> great!

2016-09-22
[13:11:02] <wardi> found it. c.user leaks through tests if we use get_action(...)({}, ...)
[13:13:23] <wardi> our interface is bad. not sure how to fix that one
[14:30:40] <amercader> wardi: sorry, I was wrong. You can't pass a `user` keyword on helpers.call_action
[14:30:50] <wardi> yes, but you can pass a context
[14:30:52] <amercader> that's on the factories
[14:30:52] <amercader> https://github.com/ckan/ckan/blob/master/ckan/tests/factories.py#L51
[14:30:56] <wardi> I updated the issue
[14:34:11] <wardi> you actually have to pass context={'user': username, 'ignore_auth': False}
[14:34:59] <wardi> which seemed really verbose and led me to use call_action instead
[18:26:21] <Sekmeth> Anyone else having issues with ckan atm? Constantly getting BadGateway/Error during WebClient/502 when trying to download mods.
[18:49:53] <tktech> Should have trademarked CKAN, lol

2016-09-21

2016-09-20
[08:35:58] <shellac> Hi all. Couple of questions:
[08:36:44] <shellac> 1) Is there a 'total size' field for datasets? i.e. sum of sizes of each resource
[08:38:19] <shellac> 2) In dataset listings the file / content types are listed. Is it possible to add to this list?
[08:39:37] <shellac> 2 needs some explanation: our datasets often consist of multiple packages (related via 'parent'). Nested filetypes don't show up, of course.
[08:54:52] <Zharktas> i think that resource does not have even size field by itself
[08:55:00] <Zharktas> at least not by default
[08:55:39] <shellac> Maybe we added that ourselves - doh :-)
[09:03:15] <torf> Are calls to action functions atomic from the view point of the caller? E.g. if I have two API requests which use `package_update` on the same package can I be sure that they are executed after another (in a potentially non-controllable order) and that they cannot accidentally interleave (and leave me with incorrect data)?
[09:12:00] <torf> ... and if that's true, does it also hold for calls to action functions from local code running in separate processes?
[09:33:19] <amercader> shellac, Zharktas: there's a PR for adding file size to files that are uploaded https://github.com/ckan/ckan/pull/3205
[09:34:15] <amercader> torf: I guess that it boils down to how SQLAlchemy handles sessions and commits inside them?
[10:01:13] <torf> amercader: SQLAlchemy provides the necessary framework for achieving consistency, but I'm not 100% sure how it is used in CKAN. I *think* the action functions make sure to commit the session at the correct times, but I wanted to make sure that I got this correctly.
[10:02:27] <torf> amercader: So my real question probably is: Can I assume that calling an action function is atomic? I.e. is it the job of the action function's developer to ensure this?
[10:12:08] <amercader> torf: I would say yes, it is. And they can do by using the session stored in the context param and commiting on their action (some actions support `defer_commit` in the context)
[10:12:17] <amercader> *can do that
[10:14:29] <amercader> I'm not too familiar with SA internals though
[10:59:23] <shellac> amercader: ah, thanks for the pointer
[11:11:07] <torf> amercader: OK, thanks!
[11:58:25] <wardi> torf: no, nothing's atomic AFAICT
[11:59:15] <wardi> we need to do lots of work to fix that, mainly using postgres features that will force a rollback if something changes like "select for update"
[12:00:04] <wardi> that's something I'd love to see even at the cost of blurring the distinction between our logic and model layers
[12:01:09] <wardi> witout atomic actions it's really hard to build many real applications on top of ckan
[12:02:12] <torf> wardi: Okay. I'm asking because of your problem with database access in background jobs (#3243) and my proposed fix (#3247). I want to make sure that database access from a background job is as secure as currently possible (i.e. the same consistency guarantees as for web requests) and that the behavior is documented.
[12:03:46] <wardi> torf: we might discuss this at the meeting right now if you care to call in
[12:04:04] <wardi> http://pad.okfn.org/p/ckan-meeting
[17:07:45] <jrods> wardi amercader: i think i found the issue, i commented this line out: https://github.com/ckan/ckan/blob/master/ckan/templates/package/edit_base.html#L4 and now i can use `pkg_dict` in `package/new_resource.html`

2016-09-19
[11:06:09] <yanik> is updating python version for CKAN environment is straight? Remove old one, create new? :)
[13:15:21] <torf> yanik: In theory, you just need to remove the old virtualenv and create a new one using the intended Python version. You'll then have to reinstall all the packages into that virtualenv (follow the installation instructions). This should work without problems, but as usual I'd make sure to backup everything first ;)
[14:55:59] <travis-ci> espona/ckan latest 919201e https://travis-ci.org/espona/ckan/builds/161054574 amercader: The build has errored.

2016-09-18

2016-09-17
[08:50:48] <pierre__> Good day, I am trying to activate send_email_notifications but when I am typing "echo '{}' | /usr/lib/ckan/default/bin/paster --plugin=ckan post -c /etc/ckan/default/production.ini /api/action/send_email_notifications > /dev/null", it return me the following message : No handlers could be found for logger "ckan.lib.uploader". I am new with CKAN and I do not how to solve that issue. Tks for your advice

2016-09-16

2016-09-15
[08:44:58] <yanik> can anyone give me hint about how files are stored during uploading?
[08:45:50] <yanik> are they chucked into pieces, or stored directly into RAM and then saved to disk ?
[12:28:00] <amercader> wardi, tktech: won't be able to join the meeting today, sorry
[12:28:18] <amercader> travelling to pycon uk!
[12:44:48] <wardi> nice! have fun

2016-09-14
[08:22:23] <windy> hi
[08:22:50] <windy> i do  paster --plugin=ckan db load --config=/etc/ckan/default/production.ini production.pg_dump
[08:22:55] <windy> and got message
[08:23:06] <windy> sqlalchemy.exc.ProgrammingError: (ProgrammingError) permission denied for relation _table_metadata  'SELECT 1 FROM "_table_metadata" WHERE name = %s AND alias_of IS NULL' (u'1901aa65-5036-4f83-90dd-9d15e0fae584',)
[08:24:12] <windy> anyone could help me ?
[08:25:30] <torf> windy: Does the PostgreSQL user you're using have the necessary write permissions? I'm not an expert, but "permission denied for relation ..." sounds like PostgreSQL doesn't allow the user to make changes.
[08:26:16] <torf> Windy_: Does the PostgreSQL user you're using have the necessary write permissions? I'm not an expert, but "permission denied for relation ..." sounds like PostgreSQL doesn't allow the user to make changes.
[08:27:18] <Windy_> ok thanks ,

2016-09-13
[11:43:46] <Andy__> Hey there. I am looking for a freelancer to work on a harvester for a open data platform. Anyone interested?
[12:01:21] <wardi> Andy__: you might try posting to ckan-dev. We ought to have a better place for this sort of request though
[12:03:41] <Andy__> wardi: cool i will post in there. thx for the help
[12:06:15] <Andy__> wardi: you mean the mailing list right?
[12:18:55] <wardi> Andy__: yes

2016-09-12
[15:30:50] <yanik> why did you stopped developing https://github.com/okfn/recline ?
[15:31:10] <yanik> last release was in 2013
[15:32:24] <torf> yanik: There are many recent commits, it seems that there just hasn't been an official release since then. Interesting question, though!

2016-09-11
[18:07:22] <Azr4ell> Hi, can anyone tell me good hosting solutions for ckan?
[18:08:03] <Azr4ell> The info i found on the web was outdated or links dont work
[20:30:04] <D3lvish> Hi all, sorry to disturb, but where can i find good tutorials to learn more about ckan?

2016-09-10

2016-09-09
[05:09:51] <bijith> can we use 2 data-models for a HTML element in a CKAN form
[12:26:08] <bijith> How could we inherit a JS module of CKAN
[16:58:12] <jrods> wardi: how would you go about migrating timestamps? timestamps don't store the timezone, seems like it would be a crapshoot
[17:24:48] <wardi> jrods: assume they were set to server time. it will be close enough
[17:27:21] <jrods> should i worry about new servers that may not have a timezone set? i guess just specify it in the docs
[17:30:23] <jrods> but how would i keep track of when to do the migration for timestamps? (i don't know anything about how ckan does migrations)
[18:47:57] <wardi> jrods: ckan records the last migration number run in the db

2016-09-08
[11:17:54] <epic> I'm trying to configure the docker image at https://github.com/ckan/ckan to use another port than 80 (i do -p 8889:80) but all redirects in ckan then tries to redirect to port 80 again which naturally fails, how do i configure ckan to use another port/url?
[13:09:13] <bijith> hi all
[13:09:45] <bijith> I'm from India currently working in Ireland
[13:10:13] <bijith> need some help with CKAN
[13:10:59] <torf> epic: You need to include the port in the setting `ckan.site_url` in `production.ini`
[13:11:37] <epic> I tried that, but I think this has something to do with the nginx proxy infront
[13:12:10] <epic> because the html all contains the correct urls (from config), so all links (GET) work, but POST (button) fails
[13:12:31] <torf> What port are you running Nginx and Apache on?  `ckan.site_url` should have the one from Nginx
[13:23:37] <bijith> Hi I need some help with javascript usage in ckan
[13:24:10] <bijith> ckan.module('example', function ($, _) {   return {     initialize: function () {       console.log("I've been initialized for element: ", this.el);     },      _onChange: function (event) {       console.log("changed")     },    }; });
[13:24:24] <bijith> this is the new JS module I have made for my project
[13:24:40] <epic> well i set up docker to map external port 8889 to docker container port 8889, then configured ngnix to listen to 8889
[13:24:55] <epic> but when i push a button that uses POST it redirects to :80
[13:25:19] <bijith> the initialize function works , but the OnChange function never gets triggered when the event occurs ( selection of a value in a select box)
[13:58:08] <amercader> bijith: try adding this to your initialize method: `this.el.on('change', delegated, this._onChange);`, otherwise you are not registering the event
[14:01:24] <wardi> amercader, tktech: meeting?
[14:01:55] <amercader> sorry, trying to connect
[14:02:59] <torf> epic: And your site_url contains `:8889`?
[14:16:21] <bijith> thanks amercader < I will try this out
[14:24:14] <bijith> it worked , thanks once again
[17:16:28] <bijith> can we use two data-modules on a same HTML elements

2016-09-07

2016-09-06
[12:01:56] <wardi> tktech: meeting?
[15:45:07] <wardi> here's a question: should the datastore API return/accept proper JSON values or JSON strings for JSON columns?
[15:45:30] <wardi> I'm leaning toward JSON strings, even if it makes our API a little uglier
[15:46:41] <wardi> (this is consistent with our "spatial" dataset field, but nothing else I can think of)
[16:09:20] <tktech> If it's a typed column (we know the value of the result is JSON) I would favor just returning JSON
[16:30:47] <wardi> the reason I lean towards string is that postgres' json type is stored as a string. it's fast to insert, and maintains (unsavoury IMHO) things like key order and repeated keys.
[16:31:27] <wardi> use JSON values that speed and extra info some people might care about will be lost
[16:31:58] <wardi> *if we
[16:34:49] <wardi> I guess we could add a "parse_json" parameter to the calls to support either method
[16:35:04] <tktech> Please don't, heh.
[16:35:19] <tktech> We shouldn't be using JSON as a column type anyways, should almost always be JSONB.
[16:35:56] <wardi> JSONB isn't better if you've got an insert or update-heavy workload
[16:36:08] <tktech> Postgres JSON operators are orders of magnitude faster on the binary form, and if you aren't running operations on it then you shouldn't even be bothering with a JSON column type.
[16:36:17] <wardi> (or care about unsavoury things.. also whitespace, whee..)
[16:36:24] <tktech> The insert time penalty is insignificant
[16:36:40] <tktech> I guarantee you it's a rounding error on the time usage list
[16:37:29] <tktech> It uses more space, and the insert is slower, but actually *using* it is much faster.
[16:37:53] <wardi> that's fair. there's a significant penalty for parsing big json documents into dicts and lists though
[16:38:16] <tktech> That's a Python thing, not a postgres thing.
[16:38:45] <tktech> Patching ujson into the dba significantly improves that
[16:38:48] <wardi> hmm. maybe we could avoid it with a better json lib
[16:38:58] <wardi> haven't seen that one
[16:39:11] <tktech> One moment
[16:39:19] <wardi> looks nice
[16:39:20] <tktech> https://github.com/esnme/ultrajson
[16:40:06] <tktech> Benchmarks down near the bottom of the readme.
[16:41:51] <wardi> those benchmarks need units
[16:42:21] <tktech> It's calls/second
[16:42:33] <tktech> Bigger is better
[16:43:08] <wardi> so 3x faster or so. know what's faster than that? passing the string through :-)
[16:43:27] <tktech> At which point there was no reason to store or treat it as JSON at all
[16:44:42] <wardi> api is worse, yes. I feel like I want to write a json parser that produces immutable dict/list-like objects lazily
[16:45:11] <wardi> python is bad for that, but it might be close enough to not matter
[16:45:44] <tktech> That exists
[16:45:47] <tktech> Many timers over
[16:45:55] <tktech> https://github.com/kashifrazzaqui/json-streamer
[16:46:01] <tktech> https://github.com/danielyule/naya
[16:46:12] <tktech> https://github.com/isagalaev/ijson
[16:46:44] <wardi> any of them any good?
[16:47:07] <tktech> ijson would be the typical one you'd use in such a case
[16:47:38] <tktech> None of them are terribly popular because there isn't much need for streaming json parsers. It's usually an irrelevent performance hit in most applications.
[16:47:54] <tktech> You'd rather quickly load the entire document are reduce complexity instead
[16:48:01] <tktech> *and, agh
[16:48:04] <tktech> Haven't finished my coffee
[16:49:10] <wardi> I want something like what I was trying with the recently-removes lazyjson thing. load the whole string, maybe regex-check that it's valid then leave it in memory as a string
[16:49:36] <tktech> Why?
[16:49:39] <wardi> I don't care about streaming json
[16:50:13] <wardi> because something like 50% of the package_show time is spent creating and discarding lists and dicts and strings
[16:50:43] <tktech> Heh, that's probably not because of the JSON.
[16:50:55] <wardi> granted, ujson with a 3x iprovement is probably more than good enough
[16:51:07] <tktech> In any case the trivial solution to that is to cache the results of package_show
[16:51:38] <wardi> and it would be simple to use and not have python's proxy object problem
[16:53:20] <wardi> validated_data_dict is a cache that gets used and embeddein in far more api calls than package_show, caching at http layer would miss all that
[16:54:36] <wardi> well, if ujson is fast enough and makes for a better API I'm ok with not supporting postgres' unsavoury json features
[16:54:48] <wardi> tktech: thanks

2016-09-05
[12:09:53] <mredbishop> Hi guys
[12:10:12] <mredbishop> Is this a place I could ask a technical question regarding the CKAN API?

2016-09-04
[01:09:46] <Guest34819> .

2016-09-03
[22:19:21] <daniel> hi
[22:19:24] <daniel> hi all
[22:21:23] <Guest34819> anydbody here?
[22:24:43] <Guest34819> im tyring to install ckan on redhat 6
[22:24:54] <Guest34819> i got two issue
[22:24:58] <Guest34819> first
[22:25:29] <Guest34819> when i try to initialize db i got this message
[22:25:30] <Guest34819> (korea)[ckan@daniel korea]$ paster db init -c /etc/ckan/default/development.ini Command 'db' not known (you may need to run setup.py egg_info) Known commands:   create       Create the file layout for a Python distribution   exe          Run #! executable files   help         Display help   make-config  Install a package and create a fresh config file/directory   points       Show information about entry points   post         Run a
[22:25:37] <Guest34819> second,
[22:26:23] <Guest34819> when I access my page at the end of my installation process , http://mydomain:80
[22:26:42] <Guest34819> I got this error .
[22:26:43] <Guest34819> [Sat Sep 03 23:27:01 2016] [error] [client 192.168.56.1] mod_wsgi (pid=31536): Target WSGI script '/etc/ckan/default/apache.wsgi' cannot be loaded as Python module. [Sat Sep 03 23:27:01 2016] [error] [client 192.168.56.1] mod_wsgi (pid=31536): Exception occurred processing WSGI script '/etc/ckan/default/apache.wsgi'. [Sat Sep 03 23:27:01 2016] [error] [client 192.168.56.1] Traceback (most recent call last): [Sat Sep 03 23:27:01 201
[22:27:00] <Guest34819> Is there any solution for this?

2016-09-02
[08:42:10] <yanik> I have one ideological question, thought
[08:42:56] <yanik> I find CKAN as really good for managing files-like data , but is it good to translated these files into database-like data?
[13:33:17] <wardi> yanik: I love datastore for tabular data but I don't use datapusher.
[13:33:20] <wardi> is that what you mean?
[13:33:55] <yanik> no, I mean keeping data from datasets in database
[13:34:07] <yanik> wardi, does it make sense? or CKAN more focused on files
[13:36:10] <wardi> yanik: keeping data from datasets in the datastore is great if they fit. you get sql queries as an API controlled by the same user auth
[13:36:33] <wardi> you can set up indexes and aliases for your tables, join's supported
[13:37:01] <wardi> I'd love to add check conditions so that there's tighter validation enforced by postgres
[13:37:38] <yanik> wardi, thats sounds nice. But probably the main problem is file validation. Turning file into database records
[13:38:08] <wardi> most of the ckan data visualizations expect your data to be in datastore
[13:38:39] <wardi> yanik: right, that's why I'm not using datapusher (it guesses the column types and lets you upload almost anything)
[13:39:56] <wardi> It seems a few people are working on ways to enforce validation on data uploaded. My extension is "recombinant", it applies columns types from a schema and lets users upload with an excel template
[13:44:16] <wardi> (it's kind of tied to our theme at the moment, but I hope to clean it up for general use in the next little while

2016-09-01
[14:01:41] <wardi> tktech, amercader: meeting?
[17:09:10] <jrods> wardi so my tests for PR #3205 are failing, and I'm guessing from looking at the test-core.ini in master, it doesn't have 'ckan.storage_path' set
[17:10:21] <jrods> should i rewrite the way i simulate the file uploads or would it be possible to setup a storage_path for testing?
[18:10:31] <wardi> jrods: setting up a storage path for testing sounds like the simplest thing. (we ought to be testing that uploads work.. are we not?)
[18:12:15] <jrods> wardi: i don't think so? That's just my guess, there isn't enough debug output for me to confirm, but that's the first thing i can think of off the top of my head on why the tests are failing
[18:33:10] <wardi> jrods: setting a default storage path in the test ini should be ok, it just needs to work on circleci. If it's not passing you can re-run the tests with ssh enabled (if you set up circle on your fork) to see what went wrong
[20:23:33] <jrods_> wardi: im not familiar with circleci setup, but it keeps failing on 'cp solr', I'll look through the docs, but is there something I have to do to make sure solr is present in the container?
[20:36:09] <wardi> hmm. maybe there's a specific image you need to run the test
[20:39:05] <jrods_> maybe? i ssh into the container and there's no /opt/solr-4.3.1 , is there i something i have to define in the web ui like dependency overrides? the docs aren't very helpful
[20:39:44] <wardi> their docs are thin. and I find the admin settings confusing (check boxes seem like they are in the wrong place)
[20:40:16] <wardi> but there might be something to select a legacy version of the image. for solr we just followed their docs (at the time)
[20:44:46] <jrods_> the only thing legacy i can see is the ubuntu version, both 14.04 and 12.04 fail, no /opt/solr-4.3.1
[20:45:02] <wardi> there are no solr dirs in opt?
[20:45:46] <jrods_> nope
[20:48:09] <wardi> these instructions seem to be the same as earlier https://circleci.com/docs/test-with-solr/
[20:51:02] <jrods_> hmm, our fork is using an older circle.yml version compared to master https://github.com/HighwayThree/ckan/blob/2.5.3-bcgov/circle.yml
[23:05:54] <jrods> wardi: got an answer on the community forum =) https://discuss.circleci.com/t/missing-opt-solr-4-3-1-in-both-12-04-and-14-04/6021
[23:12:55] <jrods> also I believe my tests passed, i added this to the `test-core.ini` -> `ckan.storage_path = $HOME/ckan/uploads`, seems to work for my use case

2016-08-31
[00:39:41] <libman> Can I download a dataset containing metadata (specifically dataset name and license) of all CKAN datasets?
[00:40:40] <libman> (I know there's an HTTP JSON API, but I'm looking for a way to avoid doing many API requests / scraping to get this data.  Is the dataset behind the API available for download?)
[08:59:42] <rossjones> Is it possible to turn off the solr cache (validated_data_dict) as it makes it very hard to work on updating my package_show_schema as action.get.package_show will always use the version in the schema.  If I remove the field from my schema, the search results don't show and raise an error :(
[08:59:59] <rossjones> s/version in the schema/version in solr/
[09:27:57] <rossjones> Answer -> ckan.cache_validated_datasets = false
[10:18:48] <yanik> Hi guys, as I understand this MapQuest switch https://lists.okfn.org/pipermail/ckan-dev/2016-July/010124.html is only ckanext-spatial related. Any idea where is Datastore preview map settings lives? :)
[10:28:31] <rossjones> yanik this one https://github.com/ckan/ckan/blob/eb862506e1b9acc7716185f33fca82cbeb64823e/ckanext/reclineview/plugin.py#L15 ?
[10:39:20] <yanik> rossjones, so default map view (this one http://take.ms/EsoJB) relies on ckanext.spatial.common_map* settings? :)
[10:39:37] <rossjones> as far as I can workout, yes
[10:40:19] <yanik> weird then, why I have no changes after trying 2 different map providers
[10:40:43] <yanik> maybe cache or something
[10:40:48] <yanik> thx a lot
[10:46:56] <rossjones> yanik I *could* be wrong, seem to do that a lot recently.  I thought you were doing django->CKAN API
[10:47:48] <yanik> rossjones, kind a, but its more like integration
[10:48:56] <yanik> rossjones, there is only one nice way to do so. And its require a lot of work
[10:49:38] <rossjones> Oh okay, was going to ask how you are handling apikeys for users.
[10:52:57] <yanik> rossjones, In short:
[10:52:57] <yanik> Django models relies on CKAN database structure (User login, datasets, etc.). Django has own api (REST, Django Rest Framework, package).
[10:52:57] <yanik> Also CKAN has API (RPC)
[10:52:59] <yanik> And all this wrapped into lovely onePageApp with EmberJS, which works naturally with both kind of API's.
[10:52:59] <yanik> This way its very easy to extend on Django side.
[10:54:43] <rossjones> Ah so django can read/write the ckan database.
[10:54:50] <yanik> rossjones, I have access to keys from a DB. But its bad idea to save them on a client, right?
[10:55:13] <yanik> rossjones, exactly. Its very helpful
[10:55:31] <rossjones> Yes, a bad idea.  I almost (but not really) want a api/3/action/user_authenticate call so I can only need to use the CKAN API.
[10:57:09] <yanik> rossjones, I can put keys in Django middleware. But so far I don't used CKAN API a lot, I have a bit different structure
[10:57:50] <rossjones> Yeah it sounds different. I think we're intending to only use the CKAN API (and some extensions) as much as possible.
[10:58:45] <yanik> you want to do some integration as well?
[11:00:16] <yanik> actually I will be on CKAN project only for 2 more month, and relocating afterwards :)
[15:26:52] <winanski> hello everyone
[15:28:12] <winanski> Is there anyone facing problem while installing CKAN Comments for Datasets? I got error while installing this on CKAN 2.5.2 while initialize database, it got an error "ImportError: No module named lxml.html.clean". What's wrong with my config?
[15:28:57] <winanski> I followed the guide on the extensions dot ckan dot org
[15:29:38] <winanski> FYI i still use the default configuration install based on documentation configuration
[15:30:14] <winanski> and python-lxml is already installed

2016-08-30
[10:01:08] <ghie> hi
[10:01:50] <ghie> whether there anyone willing to help me ?
[10:02:50] <ghie> does anyone have documentation ckan migration to other servers? like ubuntu 14
[10:06:18] <ghie> test
[11:28:22] <rossjones> I think I've just been bitten by https://github.com/ckan/ckan/blob/master/ckan/lib/plugins.py#L10-L11 .. does anyone know why the imports are like this ?
[11:29:07] <rossjones> If I have a local logic/schema.py in my extension it breaks, but also .... http://pastebin.com/Nqg0L6sC
[11:39:16] <wardi> rossjones: that just looks wrong to me
[11:40:25] <rossjones> Yeah, and probably explains why https://github.com/ckan/ckan/blob/master/ckan/lib/plugins.py#L276 breaks for me :(  Not that my local show_package_schema() is working anyway :|
[11:45:29] <torf> ghie: The CKAN docs describe how to export and import the CKAN database (http://docs.ckan.org/en/latest/maintaining/database-management.html). You'll also have to copy the storage directory (file uploads). What problems do you encounter?
[12:00:15] <wardi> dev meeting? http://pad.okfn.org/p/ckan-meeting
[12:01:57] <wardi> amercader: ^
[17:20:40] <Bret_> Hello, I'm trying to upgrade from CKAN 2.2 to 2.5.1, and I'm getting this message when trying to upgrade my reqirements: "ImportError: No module named testrepository"
[17:21:07] <Bret_> it looks like it's coming from the pbr>=0.11 installation
[17:24:03] <Bret_> is this a known issue. it looks like others are running into it too: http://stackoverflow.com/questions/39225976/issue-while-installing-python-module-pbr

2016-08-29
[04:46:16] <teemu> wardi: thanks for the help!

2016-08-28
[11:59:11] <wardi> teemu: the only extra step is creating links to the <type>/new pages so people can create the different types
[11:59:26] <wardi> scheming doesn't create those for you
[12:02:36] <wardi> rossjones_: doing a bit of work on CKAN again?
[12:20:29] <wardi> linus and greg kh on GPL enforcement https://lists.linuxfoundation.org/pipermail/ksummit-discuss/2016-August/003580.html
[15:05:40] <manjaroi3> Hello, how would I check if a user is a sysadmin after logging in
[15:06:30] <manjaroi3> or organization administrator?

2016-08-27

2016-08-26
[06:50:58] <teemu> Hi, has anyone here tried using CKAN with multiple dataset/resource types? What does that actually entail and are there specific things that should be taken into account?
[06:51:42] <teemu> we're using scheming so making the schemas themselves should be simple enough
[09:07:20] <yanik> Maybe someone has experience extraction geo-data from uploading dataset?
[09:13:17] <yanik> is this one http://ckan.org/features-1/geospatial/ related to https://github.com/ckan/ckanext-spatial?
[15:42:11] <rossjones> @nigelb @amercader did you know that http://ckan.org/ is borken?
[15:42:41] <nigelb> Looks like a blogfarm issue.
[15:43:11] <nigelb> I'm guessing the process is write an email to sysadmin@okfn.org
[15:43:46] <rossjones> Oops forgot.
[15:44:16] <rossjones> sorry nigelb
[15:44:38] <nigelb> :)
[19:49:52] <jrods> is there anyone working on issues #2882 #2970?

2016-08-25

2016-08-24
[09:52:11] <rossjones> wardi Our new approach (at least today) is to rely only on CKAN APIs, so am sure we'll have a list of things that may be missing, or not.

2016-08-23
[08:18:10] <yanik> hi guys, I'm back to CKAN project :D
[08:18:43] <yanik> it was a while
[10:13:57] <yanik_> I have question, though
[10:14:32] <yanik_> How you handle large file upload (4-8 GB)? Because guys in my team want to make separate JavaScript uploader
[10:15:17] <yanik_> So it will load client rather then server
[10:17:46] <tktech> yanik_, for the core FileStorage plugin in CKAN? It doesn't, really.
[10:18:18] <tktech> https://github.com/open-data/ckanext-cloudstorage can support serving massive files since it doesn't proxy
[10:18:35] <tktech> But it's waiting on https://github.com/open-data/ckanext-cloudstorage/issues/4 to support uploading
[10:19:59] <yanik_> oh, we use https://github.com/yanikkoval/ckanext-s3filestore, so it probably not proxy either ?
[10:20:22] <yanik_> thx for that link, will investigate
[10:21:01] <tktech> yanik_, ckanext-s3filestore proxies downloads through CKAN to handle permissions.
[10:21:12] <tktech> So if you're downloading a 4GB file, it goes S3 -> CKAN -> Client
[10:21:46] <tktech> ckanext-cloudstorage does not, since it generates secure URLs then redirects you to the CDN if you're using AWS or Azure.
[10:22:43] <tktech> Client -> CKAN (cloudstorage generates a one-use link) -> CDN -> Client
[10:22:59] <yanik_> tktech, so we will lose in security if we use any side hacks ..
[10:23:30] <yanik_> thats why ckanext-s3filestore relies on CKAN core
[10:23:55] <tktech> You could update ckanext-s3filestore to use secure urls like ckanext-cloudstorage
[10:24:00] <yanik_> hope it it possible to merge these two solutions
[10:24:12] <tktech> You don't necessarily need to merge anything
[10:24:20] <tktech> You could just transition to ckanext-cloudstorage
[10:25:45] <yanik_> tktech, thank you, a lot. I would lose tons of time w/o your help :)
[10:27:46] <tktech> No problem :) It's my project, so feel free to create an issue or ask me if you run into problems.
[10:33:11] <yanik_> tktech, one last think. Its regarding downloading & uploading as well?
[11:18:25] <rossjones> Hello ckanworld!
[11:55:49] <wardi> yanik_: welcome back!
[11:57:02] <danbri> anyone know who runs http://data.zagreb.hr/about in Croatia? Backend seems down
[11:57:46] <tktech> danbri, Any particular page? It's working fine for me.
[11:57:51] <danbri> e.g. http://data.zagreb.hr/dataset/popis-nadzornih-kamera-na-podrucju-grada-zagreba (" DataProxy returned an error (Request Error: Backend did not respond after 10 seconds)")
[11:58:08] <danbri> you get the errors as soon as you go deeper beyond the metadata into dataset downloads
[11:58:17] <wardi> rossjones: hello!
[12:00:32] <wardi> dev meeting time http://pad.okfn.org/p/ckan-meeting
[12:02:16] <wardi> amercader: ^
[12:25:41] <wardi> publishing GA data as CKAN dataset with some nice views would be *really* cool
[12:35:57] <danbri> (Zagreb / Croatian datasets seem back up now)
[12:39:47] <yanik_> Who worked closely with CKAN RPC? How much I can cover with that? I have crazy idea to cover my django + CKAN integration with lovely EmberJS. And make it more smooth and native <3
[14:59:40] <wardi> yanik_: CKAN's api is supposed to cover everything. The places that it don't are bugs AFAIC

2016-08-22

2016-08-21

2016-08-20

2016-08-19
[20:44:06] <tktech> amercader, Have you seen or played with webassets, and in particular flask-webassets?
[20:44:27] <tktech> I've used it on several projects, it's pretty much an enjoyable version of Fanstatic.

2016-08-18
[11:25:55] <ichux_> Any updates about CKAN migrated to Flask?
[13:20:08] <amercader> ichux_: We are working in foundation changes, lots of code being submitted as PRs now https://github.com/ckan/ckan/pulls?q=is%3Apr+is%3Aopen+label%3A%22Pylons+-+Flask+migration%22
[13:20:34] <amercader> when I finish this first batch I'll write an update
[14:02:01] <wardi> amercader: meeting?
[14:02:10] <amercader> yes, coming
[21:10:54] <benjwadams> How can i run ckan extensions within a python interpreter?  I need to debug a few extensions

2016-08-17

2016-08-16
[12:01:39] <wardi> amercader: meeting?
[13:58:10] <realitygaps> hmm, data preview doesnt seem to render correctly (v2.5.2, ubuntu)
[13:58:13] <realitygaps> any ideas?
[15:34:27] <realitygaps> got it working, file wasnt accessible from outside

2016-08-15

2016-08-14

2016-08-13

2016-08-12

2016-08-11
[13:51:44] <amercader> no dev meeting today, as not many people are around!
[13:57:40] <nigelb> where is everyone? :)
[13:58:12] <wardi> at the beach
[14:00:12] <nigelb> woo
[14:00:23] <nigelb> ckan-beach-con?
[14:01:31] <wardi> depends on where/when the next IODC is happening
[14:07:46] <tktech> Don't think madrid has beaches :)

2016-08-10
[06:21:57] <fugit> Hi! I have been trying to upload a GeoJSON file to CKAN (most recent development code) and the upload fails. Anyone who has faced similar issue and managed to fix please help
[07:32:01] <fugit> anyone here?!

2016-08-09

2016-08-08
[10:04:49] <erlingbo> wardi: right now it is old school apache rpaf with nginx in front
[10:05:06] <erlingbo> I'll file a bug report.

2016-08-07

2016-08-06

2016-08-05
[07:35:26] <erlingbo> Hi. I am trying to set up ckan from source (master) and use root_path = /something/{{LANG}}. Most of the things load correctly but the fanstatic links is not honouring the root_path. Is there some trick I have missed?
[15:47:30] <wardi> erlingbo: you might have found a bug. root_path handling never seems to be completely fixed
[16:04:51] <wardi> erlingbo: it might also be related to how you're proxying requests to ckan, so be sure to include all those details in the bug report
[22:34:18] <wardi> ugh. I should stop using "hub pull-request -i". I keep breaking things

2016-08-04
[09:05:34] <amercader> Zharktas, jrods: I've udpated demo to latest spatial and geoview so the tiles should look fine. Recline ones still failing though
[14:02:30] <wardi> amercader, tktech: meeting?
[14:03:01] <amercader> coming

2016-08-03
[06:52:13] <fugit> Hello!
[06:52:51] <fugit> am new to ckan and was wondering if the development code works with solr 6.1.0?
[07:03:07] <tktech> Yup.
[07:13:47] <fugit> Hello! I got CKAN (development code) now running with Solr 6.1.0. However when I start CKAN I get this warning:
[07:13:51] <fugit> raise InvalidSchema("No connection adapters were found for '%s'" % url)
[07:13:51] <fugit> InvalidSchema: No connection adapters were found for ''http://127.0.0.1:8983/solr/#/ckan1'/select/?q=%2A%3A%2A&rows=1&wt=json'
[07:14:11] <fugit> I used these instructions to set the core: https://gist.github.com/hvwaldow/67fecf80a9790b5c9153#file-solr-upgrade-md
[07:14:23] <fugit> any support is so much appreciated.
[09:32:31] <Zharktas> demo.ckan.org apparently still has broken mapquest maps
[17:38:45] <jrods> Does anyone know what version/commit of ckanext-geoview is running on demo.ckan.org?

2016-08-02

2016-08-01
[13:07:13] <Germanaz0> Hello everybody, I am running ubuntu package, and I am having issues with Solr, and I would like to reinstall it
[13:07:17] <Germanaz0> is there any way ?
[13:07:31] <Germanaz0> the ckan version is: 2.5.2
[13:15:21] <Germanaz0> nevermind

2016-07-31

2016-07-30

2016-07-29

2016-07-28
[08:40:02] <torf> To anyone who's interested in asynchronous background jobs for CKAN: My PR for the new system is ready and I woud love to get as much feedback as possible. https://github.com/ckan/ckan/pull/3165

2016-07-27
[07:41:39] <rossjones> wardi that's v.cool.  A lot of our work is revolving around 'registers' rather than datasets - but user research is starting to get interesting.
[14:51:14] <wardi> rossjones: what sort of registers?
[16:06:31] <danfowler> Hello!
[16:06:56] <danfowler> Leaving a link here to a recently published post on publishing Data Packages to CKAN: http://okfnlabs.org/blog/2016/07/25/publish-data-packages-to-datahub-ckan.html
[16:07:23] <danfowler> (Specifically, on datahub.io, where the extension supporting this is currently deployed)
[16:12:26] <tktech> http://datapackagist.okfnlabs.org/ is well done
[16:13:07] <danfowler> that's good to hear
[16:34:27] <danfowler> tktech: was the blog post clear?
[16:36:28] <tktech> danfowler: yup, at least to me. My only suggestion would be making the first mention of the datapackage extension in paragraph 1 a link
[16:49:01] <danfowler> tktech: +1
[16:49:02] <danfowler> thanks

2016-07-26
[11:48:32] <Randomite> Greetings, I see usi stufff was added, but there might be a problem since the "usi tools" which is required for most if not all of them haven't been added :P so they're all uninstallable. No stress or anything, just figured I'd pop in and let you all know.
[11:59:53] <wardi> Randomite: does your ckan have kerbals in it?
[12:00:46] <Zharktas> some day I want to see the ckan instance which hosts kerbals
[12:01:32] <wardi> ckanext-ksp
[15:08:21] <rossjones> amercader might you be the best person to remove me from the conduct@ email address?
[15:08:48] <rossjones> Hi all btw :) Flying visit.
[15:18:07] <wardi> rossjones: hello!
[15:18:23] <wardi> pretty sure amercader is the only one that can do that
[15:49:03] <brook> amercader is away atm - back next week
[15:49:39] <rossjones> Ah okay, thanks, I'll just ignore the list for the next few days >;)
[15:56:08] <rossjones> wardi how's it going?
[20:08:43] <wardi> rossjones: it's going well! lots of ckan stuff to work on, and plans for larger uses of datastore, viz and federation in the future

2016-07-25

2016-07-24

2016-07-23

2016-07-22

2016-07-21

2016-07-20
[14:19:13] <benjwadams> How can I return all datasets belonging to a group using the CKAN API? ckan.logic.action.get.organization_show allows  the include_datasets option, but there is a note that mentions that it only returns the first thousand results
[14:20:55] <benjwadams> ckan.logic.action.get.package_search looks like the right approach, but I don't know how to search by organization name, since it's a subfield
[14:21:02] <benjwadams> ^in solr

2016-07-19
[10:55:50] <gr8> Hi
[10:58:41] <_gr8> I have a question regarding MapQuest - I am using recline_map_view and added the recommended lines for custom map (ckanext.spatial.common_map.type, custom.url, attribution). However, I am still getting the same MapQuest-error image, what I am doing wrong? Could anyone help me? Thank you!
[11:01:23] <_gr8> My config regarding plugins looks like following: ckan.plugins = stats text_view image_view recline_view recline_map_view datastore
[11:29:27] <Zharktas> _gr8: https://github.com/ckan/ckanext-spatial/issues/157#issuecomment-232098967
[11:29:51] <Zharktas> mapquest recently discontinued support for free maps
[11:59:08] <_gr8> I already added the config-options (ckanext.spatial.common_map.type, custom.url etc) - but nothing happens. So, do I have to edit the url in the file ckanext/reclineview/theme/public/vendor/recline/recline.js directly!?
[12:05:25] <Zharktas> _gr8: ah yes, recline.js needs update too https://github.com/ckan/ckan/issues/3162
[12:05:55] <_gr8> thanks, I was not sure and my test environment doesnt want to work anymore ;)
[21:16:02] <jrods> what's the recommended versions to use for postgres and solr for ckan2.5.2?
[21:42:31] <rehunted> jrods, I believe you can run any ckan version with any postgresql 9.1+ without any issue, because postgresql is very stable and ckan itself does not use anything "special"
[21:42:55] <rehunted> solr is another history and I really dunno, I think schema.xml is more important than version, but I have no clue.
[21:45:11] <jrods> id figure that would be the case for postgres, but yeah, i would like to know for solr, i didn't see anything in the docs about which version is best
[21:45:57] <rehunted> CKAN docker is using SOLR_VERSION 4.10.1 (checked on https://github.com/ckan/ckan-docker/blob/master/docker/solr/Dockerfile), but this repository is tagged with 'No longer maintained'
[21:46:39] <rehunted> but I'm using solr 4.10.1 fine on ckan v2.3.1
[21:48:47] <jrods> ah ok thanks rehunted, i was just curious cause i didn't see anything documented about it =p

2016-07-18

2016-07-17

2016-07-16

2016-07-15
[08:02:49] <mih> Hi - I have a question regarding alternatives for MapQuest, is it also possible to use OpenStreetMap as an alternative?

2016-07-14
[14:21:45] <rossjones> Ah no torfsen

2016-07-13
[10:29:21] <svendii> Hi everyone, I'm about to change the name of my mod and the only way on SpaceDock to do this is to upload a new mod. Can someone help me with relinking the mod with CKAN so that it replaces the current one?
[10:32:33] * wardi directs svendii to the /topic
[10:39:32] <svendii> sorry I'm new to IRC, does that mean I should start a topic?
[10:58:29] <Zharktas> svendii: as noted in the channel topic "*NOT* related to Kerbal Space Program"
[15:37:41] <tktech> Heh.
[17:18:10] <benjwadams> How can I migrate harvests using ckanext-harvest?
[17:18:17] <benjwadams> to a new ckan install

2016-07-12
[08:29:08] <amercader> ageara: that's really disappointing, see https://github.com/ckan/ckanext-spatial/issues/157#issuecomment-231972333
[08:36:47] <realitygaps> Meta/go bac
[08:36:50] <realitygaps> oops

2016-07-11
[03:23:46] <thenets> Hi. Anybody here?
[03:30:14] <thenets_luiz> I'm trying to install CKAN and use the Harvest plugin, but I don't know what I need to put on "URL:" field on "Harvest Sources / Create Harvest Source"
[03:31:17] <thenets_luiz> I just need a URL example of CKAN data to keep trying to make this plugin work.
[03:31:57] <thenets_luiz> my email is luiz@thenets.org but I'll keep going back to this chat. Thanks a lot. See ya.
[06:04:35] <thenets_luiz> \/ It's work!!! After 2 days trying!!!
[06:05:59] <thenets_luiz> I don't know why, but if I try to harvest from a HTTPS url I get many erros, like this URL: https://africaopendata.org/
[06:07:12] <thenets_luiz> but if I try to harvest from HTTP urls, like http://data.ehealthafrica.org/ or  	http://dadosabertos.dataprev.gov.br/ it's work!!!
[06:08:26] <thenets_luiz> xD I'll make many tutorials about CKAN installation. It's too hard if you don't know many thing about Python
[13:50:44] <rossjones> @torf are you hoping to close that ticket?
[13:50:50] <rossjones> wrt background tasks?
[13:54:50] <torf> rossjones: I've thought about working on it and wanted to clarify the current state. However I'm not sure how much time I can spend on it, so I won't make any promises.
[13:55:38] <torf> rossjones: To be honest I'd rather see someone else doing it and was afraid that no one would since the bounty is still marked as being worked on
[13:56:13] <rossjones> torf I think it'll expire at some point too, was as much an experiment to see if bounties would work, and maybe other orgs might contribute in some way.
[21:49:52] <ageara> Seems that MapQuest has changed terms - default tilecache in core is no longer working in recline.js http://devblog.mapquest.com/2016/06/15/modernization-of-mapquest-results-in-changes-to-open-tile-access/

2016-07-10

2016-07-09

2016-07-08

2016-07-07
[14:03:22] <amercader> wardi, tktech, brook: you around for dev meeting?
[14:03:25] <wardi> coming
[14:13:04] <crenan> hi ckan people
[14:13:25] <wardi> crenan: hello
[14:16:52] <crenan> please, im I'm following the step by step to install 'CKAN' but when it tries to connect on
[14:16:59] <crenan> I'm following the step by step to install 'CKAN' but when it tries to connect on SOLR I have the following message
[14:17:41] <crenan> 2016-07-07 11:05:10,372 WARNI [ckan.lib.search] Problems were found while connecting to the SOLR server
[14:17:41] <crenan> a 2016-07-07 11:05:10,737 ERROR [ckan.lib.search.common] HTTP code=404, reason=Not Found
[14:19:28] <crenan> solr-spec
[14:19:28] <crenan> my solr version is 6.1.0 and jvm IBM Corporation IBM J9 VM 1.8.0 2.8 ( RH 7.2)
[14:20:29] <crenan> yes, I created on core called 'ckan' on solr
[14:20:55] <wardi> can you browse to the url set as your solr url in the ini?
[14:23:10] <crenan> yeap, this URL http://10.124.5.106:8983/solr/#/ckan works
[14:24:01] <wardi> what's your solr_url setting?
[14:26:50] <crenan> solr_url = http://127.0.0.1:8983/solr
[14:28:14] <crenan> analyzing traffic via tcpdump, I could see that CKAN attempts to invoke solr
[14:28:23] <crenan> POST./solr/ select.HTTP/1.1.  .Host:.10.124.5.  109:8983..Accept-Encoding:.identity..Content-Length:.57..Content-Type:.application/x-www-form-urlencoded;.charset=utf-8
[14:28:38] <crenan> with content q=%2A %3A%2A&rows=1&fl =%2A%2Cscore&ver sion=2.2&wt=standard
[14:28:40] <wardi> crenan: try solr_url = http://127.0.0.1:8983/solr/ckan
[14:28:48] <crenan> but it return 404
[14:28:51] <crenan> i tried
[14:33:06] <crenan> hummm, a little better, the POST request returned ok but the next not.
[14:33:26] <wardi> sounds like your solr is newer than the instructions recommend. there might be some other configuration required for solr 6
[14:34:02] <crenan> GET./solr/ckan/admin/file/?file=schema.xml.H TTP/1.1..Accept- Encoding:.identity..Host:.127.0. 0.1:8983..Connection:.close..User-Agent:.Python- urllib/2.7
[14:34:06] <crenan> 404 again
[14:34:43] <wardi> have you installed the schema? I know that's done differently on newer solr
[14:37:16] <crenan> I put the CKAN schema within the core
[14:37:41] <crenan> as the documentation says
[14:37:52] <crenan> curl -X GET http://10.124.5.109:8983/solr/ckan/admin/file/?file=schema.xml
[14:37:54] <crenan> 404
[14:37:57] <wardi> the documentation doesn't cover solr 6
[14:38:06] <crenan> :-(
[14:38:27] <crenan> what verswhich version should I use?
[14:38:37] <crenan> ops
[14:38:42] <crenan> which version should I use?
[14:40:33] <wardi> huh. the docs don't tell you which version do they
[14:40:41] <crenan> exact
[14:45:43] <wardi> looks like our docker config is using 6 with a bunch of extra steps not covered by the docs: https://github.com/ckan/ckan/blob/master/contrib/docker/solr/Dockerfile that might help you along
[14:46:04] <wardi> tktech: do you recall the version of solr that our docs actually work for?
[14:47:02] <Zharktas> wardi: we have used solr 3 and 5 in our instances
[14:47:16] <wardi> crenan: ^
[14:47:17] <Zharktas> so solr 3 is most likely referenced in the docs
[14:49:54] <tktech> The version referenced is archaic.
[14:50:02] <tktech> Newer solr works fine, just needs some adjustments.
[14:50:17] <tktech> crenan: When you look inside the same Solr folder that had the schema.xml, do you see a file called "managed-<something>"
[14:51:03] <crenan> tktech: yes
[14:52:39] <crenan> /var/solr/data/ckan/conf/managed-schema
[14:56:01] <tktech> crenan: Yeah, because that file exists, which newer Solr's default to, that schema.xml file isn't actually doing anything.
[14:56:08] <tktech> crenan: Shut down solr.
[14:56:13] <tktech> crenan: Remove that managed-schema.xml file
[14:56:25] <tktech> Re-add the schema.xml file from CKAN to the Solr directory.
[14:57:07] <crenan> I will try
[14:57:28] <tktech> Then go into your sorlconfig.xml and find the line called schemaFactory
[14:57:35] <tktech> <schemaFactory class="ClassicIndexSchemaFactory"/>
[14:57:44] <tktech> ^- That's what you want schemaFactory to look like.
[14:57:48] <tktech> After that restart Solr and you're done.
[15:01:18] <crenan> # grep -i schemaFactory solrconfig.xml
[15:01:25] <crenan> nothing returns
[15:06:39] <crenan> hum, the solrconfig.xml from the basic configs does not has but the data_driven_schema_configs yes
[15:11:40] <tktech> If it isn't there just add it.

2016-07-06
[18:31:15] <herrmann> Hi. Is it currently possible to use CKAN with Docker? I know official support has been dropped, and people recommended using Datacats. But Datacats seems to be dead (last commit in March).
[18:35:12] <tktech> wardi: ^
[19:57:49] <herrmann> I tried a clean install of CKAN with Datacats, but get an error "permission denied" when Datacats tries to download the images: https://github.com/datacats/datacats/issues/384

2016-07-05
[10:35:37] <torf> Can anyone explain to me when the translation files for JavaScript are generated? This is done via `paster trans js`, but I don't know when that is supposed to be called and by whom. The git repository contains only the translation stubs, but my installation contains the complete extracted translations although I can't remember to have run `paster trans js`.
[11:13:57] <amercader> torf: this is done before a release using  `paster front-end-build` (which internally calls the command for`paster trans js`)
[11:20:20] <torf> amercader: Ah, OK. The `release-*` branches do indeed contain the files. Thanks for the clarification!
[12:01:35] <wardi> amercader, brook: meeting?
[12:54:06] <tktech> https://github.com/ckan/ckan/pull/3152
[12:54:11] <tktech> Working on it :)

2016-07-04
[12:49:02] <k-nut> Hi all. I said in this PR (https://github.com/ckan/ckan/pull/3103) that I would add something to the changelog. How is this handled? Should I just create a new entry in the `CHANGELOG.rst` file?
[13:26:34] <tktech> Does seem like it doesn't it.
[13:26:42] <tktech> I can't find a curated process or the like
[13:32:05] <amercader> k-nut: yes, just add an entry on the CHANGELOG file (under the relevant section, probably "API changes and deprecrations"). The bulk of the changelog is done before a release
[13:36:51] <k-nut> amercader: should I create a new 2.6.0 heading for that?
[13:36:59] <amercader> yes
[13:37:59] <k-nut> ok, great I'll do that. Thank you! :)

2016-07-03

2016-07-02

2016-07-01
[07:25:20] <nibecker> good morning

2016-06-30

2016-06-29

2016-06-28
[10:28:19] <amercader> wardi: forgot to mention that brook, knut and me are at an OKI staff summit so won't be able to join dev meetings this week
[12:08:30] <torf> Is today's scheduled dev meeting taking place?
[23:07:25] <wardi> amercader: that works for me. i was away today, and i'm fine with skipping thu

2016-06-27
[10:19:37] <teemue> shouldn't this be "q = q.filter(model.Member.capacity.in_(capacity, 'admin'))"? https://github.com/ckan/ckan/blob/e171528b8e4a9220dd3b2245a4b2a0a7d1a64a07/ckan/authz.py#L280
[10:44:43] <torf> teemue: Sysadmin check is already done in https://github.com/ckan/ckan/blob/e171528b8e4a9220dd3b2245a4b2a0a7d1a64a07/ckan/authz.py#L246
[10:45:26] <teemue> not sysadmin
[10:45:29] <teemue> organization admin
[10:45:54] <teemue> for some reason an organization admin can't seem to send invites in our application
[10:46:17] <teemue> that seems to be the logical reason
[10:47:39] <teemue> I mean, that line only picks the instances of specific roles to the query results, which the next lines match against. but the specially handled "admin" role can't exist in the results as it's filtered out
[12:30:10] <Nikolas> hi
[14:49:50] <benjwadams> Can i blacklist certain tags from becoming popular, i.e. time, latitude, longitude?

2016-06-26

2016-06-25

2016-06-24
[23:29:05] <tktech> ckanext-cloudstorage now has a handy migrate command to fix your local storage

2016-06-23
[13:54:55] <amercader> Sorry I'll be late to the meeting
[14:03:10] <wardi> amercader: we have no prs or issues, is there something you'd like to talk about?
[14:03:40] <wardi> Das Uber url_for?
[14:08:16] <amercader> haha
[14:08:27] <amercader> no, I don't have anything to discuss

2016-06-22

2016-06-21
[12:02:59] <wardi> amercader, brook_ meeting?
[12:03:05] <wardi> tktech: ^
[12:03:22] <amercader> coming
[12:29:06] <wardi> nigelb: I'd like the ckan instructions to be "put https:// on your site_url" :-)
[12:29:50] <wardi> the rest is web server config that should be covered by other people's docs
[13:15:12] <nigelb> wardi: The web server bit is where everyone does something wrong :)
[13:15:30] <nigelb> the X-Proto-Forward is needed by our middleware
[13:48:33] <wardi> nigelb: do you know which middleware needs it?
[13:51:09] <nigelb> Dunno.
[13:51:31] <nigelb> But basically, we generate http or https links based on which one you're visiting from
[13:51:36] <nigelb> (the middleware does it)
[13:51:52] <nigelb> and it needs the X-Proto-Forward header to know whether the site is on SSL or not.
[13:51:59] <nigelb> Because our SSL terminates before it gets to apache/wsgi
[13:52:11] <wardi> well, url_for does it based on the site_url. I'd like to know what's doing it based on X-Proto-Forward
[13:53:09] <nigelb> Ideally, we shouldn't be using url_for
[13:53:22] <wardi> nigelb: why?
[13:53:24] <nigelb> I mean, url_for shouldn't be used for anything that's seen on the web.
[13:53:31] <nigelb> That should just use header information it already has.
[13:54:06] <wardi> except with the header information it's impossible to support the root_path setting
[13:54:37] <nigelb> I haven't read ckan code in a while.
[13:54:39] * nigelb looks
[13:54:49] <wardi> with a root_path of {LANG}/data how would I generate a url based on the headers?
[13:56:12] <wardi> url_for *needs* to have all the information to generate correct absolute urls. It's simpler to just use that all the time than to have multiple ways to generate them
[13:57:02] <nigelb> okay, so having seen the code
[13:57:09] <nigelb> it's very different from when I last saw it.
[13:57:17] <nigelb> which means the problems people are facing are on older versions
[13:57:23] <nigelb> where these changes aren't made.
[13:57:42] <nigelb> And we depend on the headers rather than site_url.
[13:57:58] <wardi> If the code is working now it might be fixed when the recent changes are backported
[13:58:09] <wardi> so I can just close the issue again
[14:20:11] <nigelb> wardi: Probably, yeah.
[14:20:17] <nigelb> My understanding was quite outdated :)

2016-06-20
[14:04:50] <nigelb> Does it make sense to have SSL instructions be sort of like this https://mozilla.github.io/server-side-tls/ssl-config-generator/
[14:04:54] <nigelb> you enter your site name
[14:05:03] <nigelb> and we give you instructions custom to your site on how to setup SSL.
[14:05:18] <nigelb> mostly generated off the URL and the config file path they'll enter.
[14:05:26] <nigelb> or we'll guess from a default install.
[14:05:51] <nigelb> I've been curious about adding in instructions for getting SSL with letsencrypt working.
[14:45:22] <nigelb> wardi: ping :)

2016-06-19
[16:36:19] <Nathan> Hello
[16:36:50] <Nathan> I have the following clarifications in CKAN, could you please able to share you thoughts on the same.  1. Does CKAN support workflow during the Dataset creation process. Is this feature is available in demo.ckan.org so that I would able to test.  2. Otherwise, Additional development or configuration is required to enable the workflow. 3. How to enable Pages, Blog options in CKAN which I have noticed in ckandemo.ckan.io website

2016-06-18

2016-06-17
[11:03:03] <tktech> What tool do you guys use to make "screencasts"?
[11:03:15] <tktech> Trying to do some tutorials for ckanext-cloudstorage
[11:19:56] <k-nut> tktech: If you do not need audio and are recording a command line I can recommend https://asciinema.org/ It's not screencasts per se since it actually records and plays back the text but that makes for some very high resolution 'video' that you can also copy from...
[13:29:15] <k-nut> tktech: Do you plan on adding tests to your cloudstroage extension? Or would you accept a PR doing so?
[14:17:16] <amercader> The QuantifiedCode check on new PRs is annoying. eg on this PR https://github.com/ckan/ckan/pull/3112 it fails because a function was not documented (a test) and  a function didn't use the `self `parameter passed (a test)
[14:17:16] <amercader> https://www.quantifiedcode.com/app/project/gh:ckan:ckan/diff/e759e1b0892fb703c4b2e77b1cd73475bf920bd3/2726dfa469c656f5b9eba91b0b5d514c84e0b3b2/issues
[14:17:31] <amercader> either we configure it to only fail on real issues or we switch it off
[14:18:05] <wardi> +1
[14:18:22] <amercader> I don't seem to be able to configure the checks on the Settings tab, k-nut did you add this? can you check if you can configure it?
[14:21:34] <k-nut> amercader: I added wardi and you as admins. You should have received an invitation.
[14:22:21] <tktech> k-nut: I would gladly and with a little cheer accept a PR that adds tests :)
[14:22:37] <tktech> asciinema.org is exactly what I was looking for, thanks
[14:22:42] <amercader> "k-nut invited you to ckan/ckan as a collaborator"
[14:23:11] <k-nut> amercader: and right after that I found the option to invite admins. Did it only send out one mail?
[14:23:30] <wardi> looks like I'm a collaborator
[14:23:49] <amercader> yeah, I only got 1 email
[14:23:55] <k-nut> just made the two of you admins
[14:23:57] <k-nut> I think
[14:24:15] <amercader> cool, I can see new things now
[14:24:26] <k-nut> sweet
[14:25:05] <k-nut> now it should be super easy to disable that particular code check
[14:51:49] <torf> Hi everybody
[14:56:02] <tktech> Heyo.
[17:12:52] <Nikolas> hi
[17:37:02] <wardi> Nikolas: hello

2016-06-16
[14:02:09] <amercader> uh oh, pad's not working https://pad.okfn.org/p/ckan-meeting
[14:03:39] <wardi> dang, pad isn't working for me
[14:03:54] <wardi> I don't know the hangout url :-(
[14:04:46] <wardi> is this it https://hangouts.google.com/hangouts/_/event/cb1vmkss426lkqicj94a3amvd1c?hl=en-GB&authuser=0 ?
[14:06:59] <wardi> amercader: ^
[14:07:07] <wardi> tktech: ^
[15:01:31] <tktech> k-nut: you said you pointed out my cloudstorage extension to someone that might be interested in using it on S3?
[15:01:52] <tktech> Implementing secure URLs for S3 is a two-liner (https://gist.github.com/TkTech/6d8986b68bde605e479ba0682df08465), I will try to sneak that in before my meeting this afternoon.
[15:03:13] <k-nut> tktech: very cool! Yes I did send it to the people behind http://data.deutschebahn.com/dataset so that they can see if it something that they would like to use.
[15:04:43] <tktech> k-nut: If they find a reason that they can't use it, I would *love* to know what it is.
[15:04:56] <tktech> Our use case for it is pretty simple, so I most likely have no met everyones needs on the first go
[15:05:16] <tktech> That, is a very nice CKAN theme
[15:07:10] <amercader> tktech: I'm sure lots of people would love a short blog post on ckan.org about cloudstorage, are you up for that?
[15:08:51] <k-nut> tktech: also forwarded this to the people that have set up the current instances for viderum and asked them for their opinions
[15:09:59] <tktech> amercader: I could type up a summary and two more examples of setting it up on azure and aws
[15:10:07] <tktech> k-nut: Awesome!
[15:10:48] <amercader> tktech: great, we can also tweet about it and you will get much more exposure and users
[15:21:26] <tktech> https://github.com/ckan/ckan/pull/3118/commits/966677cb74aedf3cf9d3af1c12be0f042ad5388a
[15:21:37] <tktech> That's all that was needed to add support for SolrCloud/zookeeper solr
[15:22:40] <tktech> I wish I could change the interface on the existing package_search, but it would break so much.
[15:23:20] <tktech> Most of the new code in package_search and SolrIndexer/PostgresIndexer.index() is just there to re-jigger the old solr-only arguments
[16:06:10] <wardi> tktech: How about a new action just called "search" with a cleaner API and the goal of supporting search across all the things one day
[16:08:47] <wardi> amercader: great write up! https://github.com/ckan/ckan/wiki/Migration-from-Pylons-to-Flask
[16:10:01] <amercader> cheers, I'll send it round the mailing list and create an issue to gather feedback
[16:20:30] <tktech> That is an *amazing* write up
[16:20:38] <tktech> I hope you're getting paid for that, heh
[17:12:49] <amercader> tktech: thanks!
[17:18:18] <tktech> Just added secure URL support for S3 to ckanext-cloudstorage.
[17:18:28] <tktech> So it's now good-to-go for private resources on Azure and AWS

2016-06-15
[11:07:10] <JosefAssad> moin
[11:07:29] <JosefAssad> I'm installing ckan here on a Debian box to have a poke around.
[11:08:24] <JosefAssad> the paster which the virtualenv is exposing to me does not appear to know the sysadmin subcommand... It's probably something obvious since I don't know much if anything about paster, but I'm still mildly baffled; any pointers?
[11:10:11] <JosefAssad> oh, it WAS obvious. I wasn't standing inside the ckan source directory
[11:10:18] <JosefAssad> please proceed to disregard my question :)
[11:10:51] <Zharktas> was just going to ask that if you are actually executing paster from ckan install directory
[11:10:59] <Zharktas> default paster might be somewhere else
[11:11:04] <amercader> JosefAssad: if you want to run ckan commands outside the ckan src dir just run `paster --plugin=ckan ...`
[11:13:20] <JosefAssad> ha yes, my lack of paster knowledge really shone through there. :)
[11:13:28] <JosefAssad> ty for the tips Zharktas and amercader
[11:37:53] <JosefAssad> hm, to enable filestore all I need to do is set ckan.storage_path in my ini file and restart the daemon, right?
[11:39:17] <Zharktas> the user running ckan needs access to the folder too
[11:39:20] <Zharktas> but basically yes
[11:39:21] <JosefAssad> aye
[11:39:33] <JosefAssad> I got that too, I think I spotted the problem
[11:41:39] <JosefAssad> yep, got it. ckan itself was running happily with only a hostname but no port number specified in ckan.site_url, but the links to uploaded datasets was 404'ing because of the lack of port number. Adding port number to ckan.site_url and it works just fine
[11:42:16] <Zharktas> so the file uploads itself worked fine but urls generated were wrong :p
[11:42:29] <JosefAssad> yes, oddly
[11:42:39] <JosefAssad> I'm completely new so it's quite likely I'm being a bonehead
[11:42:57] <JosefAssad> but I just assumed that setting the port parameter in the ini would also apply to the download urls
[11:44:21] <Zharktas> site_url is used because ckan might be installed behind nginx with url http://example.org/data and it is used in different places
[11:45:30] <JosefAssad> yeah it makes sense
[11:45:34] <JosefAssad> ty again Zharktas
[14:51:14] <tktech> Just sent out a new extension on the mailing list.
[14:51:20] <tktech> Any feedback is greatly appreciated.

2016-06-14
[13:28:22] <amercader> wardi: I changed the subject of the Docker email we mentioned on the meeting , so that's probably why you missed it
[13:28:47] <amercader> its subject is "[ckan-dev] Docker (Was ckanext-spatial deploy to production environment (datacats))" sent on June 3rd
[13:43:10] <wardi> thanks. looks like I marked it read by accident.
[15:03:55] <tktech> torfsen on here?

2016-06-13
[10:59:41] <rossjones> Happy Birthday amercader
[11:00:54] <amercader> thank you rossjones! what better way to celebrate that deal with obscure CKAN internals
[11:01:22] <rossjones> There is no greater gift!
[11:43:06] <nigelb> lol, ouch
[11:43:47] <wardi> are we seriously overriding validation of tags in our controller
[11:57:50] <amercader> wardi: well, I can create a tag from the frontend that directly contradicts `tag_name_validator`, so yeah http://demo.ckan.org/dataset/vuhotest1 :)
[12:00:05] <rossjones> What's the name for that feeling you get when you hope your name doesn't turn up in git blame, but you're afraid it might?
[12:00:29] <rossjones> Not that I recall going anywhere near tags in the past.
[12:42:02] <rossjones> I'm writing a blog post about how CKAN forces API First design (because, logic layer) and how it's a good thing (even with my previous moaning around passing dicts around everywhere ;) ).  Can anyone thing of more benefits than design, consistency, and security?
[12:42:17] <rossjones> s/thing/think/
[14:20:04] <wardi> rossjones: flexibility? integrate with whatever existing systems you have, even re-create your whole front-end in the latest flashy JS library if you like
[14:20:14] <wardi> unless you want interesting tag names :-P
[15:01:15] <rossjones> :D
[15:49:10] <rossjones> We stopped using tags when we got to more than 15k
[15:49:23] <rossjones> Absolutely worthless at that point :(

2016-06-12

2016-06-11

2016-06-10

2016-06-09
[14:02:55] <amercader> I'll be 2 mins late sorry

2016-06-08

2016-06-07
[07:29:44] <rossjones> amercader re argis, have a data.json where the licence is a url to a json file, which contain the licence info.  Did you see any other instances doing that?
[11:44:37] <wardi> mage_: as tktech said, simple_search hasn't been maintained for a long time and should be removed from docs and code
[12:51:47] <mage_> ok :p
[12:52:59] <mage_> now that PostgreSQL FTS is as fast as Lucene I think it would be worth to re-healh it :)
[23:17:21] <wardi> mage_: maybe. solr facets are pretty darn nice though.

2016-06-06
[07:53:22] <k-nut> fernandojunior: what you described was an actual bug in the tests that should have been fixed with https://github.com/ckan/ckan/pull/3066 if you pull the latest master again those tests should pass as well.
[08:40:13] <mage_> is it possible to use PostgreSQL FTS in place of Solr ?
[08:52:17] <mage_> I tried with ckan.simple_search = true .. but it doesn't work
[17:05:53] <tktech> "simple_search" and anything sticking around for sqlite support should probably just be removed
[17:05:58] <tktech> I don't think they're even tested properly
[21:43:40] <tktech> amercader: https://github.com/open-data/ckanext-cloudstorage
[21:43:56] <tktech> amercader: heavily based on your s3 extension since I couldn't find any other examples :<

2016-06-05

2016-06-04

2016-06-03
[07:44:57] <k-nut> Getting back to the question that dmidder_ asked yesterday. I guess if you want to change the frontend language with js you would need to propend the proper locale (found with navigator.language) to the `pathname` of the url. But that might lead to 404s so it would be helpful to have a list of available languages. That is not possible with the current api, is it?
[07:45:33] <k-nut> `api/action/status_show` unfortunately only returns `locale_default` and not `available_locales`...
[23:52:13] <fernandojunior> Hi all. I'm new to CKAN and I've installed it (master branch) manually using Java 8 and Solr 5.5.1. Everything seems to be OK through UI, but when I run nosetests I get 2 failures: assert groups[0]['title'] not in response, assert orgs[0]['name'] not in response. Have I installed it in a wrong way? or has someone forgot to update the tests? Gist with installation and full error log: https://gist.github.com/fernandojunior/9930d65

2016-06-02
[13:23:40] <dmidder_> Hi there. How could I configure my CKAN app to set browser language by default?
[13:24:56] <k-nut> dmidder_: Hi. Just let me make sure I understand you. You want ckan to automatically switch to the language of the user's browser?
[13:26:02] <dmidder_> Yes, that's it. But users should be able to change it if they want to.
[13:34:07] <dmidder_> I've read that CKAN is able to do that but I haven't found how to activate it.
[14:05:34] <amercader> ward, tktech: meeting?
[14:05:41] <amercader> wardi: meeting?
[15:03:50] <k-nut> I just talked to Sebastian and he told me that ckan-conf was rescheduled to the 4th again today apparently.
[15:04:11] <k-nut> wardi: so maybe you want to hold off buying your tickets for a little longer until there is a definite date ;)
[15:07:28] <amercader> k-nut: thanks for mentioning it, would be good to have clarity on this asap

2016-06-01
[09:39:15] <k-nut> Can someone create a ckan-assets repository in the github ckan group as discussed in the dev call yesterday so that we can collect the design files there?
[09:47:07] <amercader> k-nut: https://github.com/ckan/ckan-assets
[09:47:13] <amercader> you should have access
[09:50:05] <k-nut> amercader: thank you :)
[13:21:36] <mage_> hello
[13:22:22] <mage_> when deploying ckan to production how could I minify + gzip all the .js / .css / ... files in one public/bundle.js-like file ?

2016-05-31
[12:36:16] <amercader> http://imgur.com/XHOp08s
[13:45:19] <memaldi> Hi all, is it possible to create a resource activity using activity_create API method?

2016-05-30
[08:45:52] <amercader> kim0: recline_graph_view requires data to be in the datastore. You might need to enable datastore and datapusher, see http://docs.ckan.org/en/latest/maintaining/datastore.html
[10:49:34] <amercader> rossjones: I did the argis data.json harvesting for the Northern Ireland portal: https://www.opendatani.gov.uk/harvest/lps-arcgis
[10:50:01] <amercader> Using the ckanext-dcat RDF harvester
[10:50:22] <amercader> Worked really well minus some minor issues which were fixed IIRC
[21:47:15] <tktech> wardi: https://github.com/ckan/ckan/pull/3072

2016-05-29
[21:30:11] <kim0> Hi folks ... I'm new to ckan, great stuff! I'm finding I can't add a recline_graph_view to a dataset .. while another dataset has graph view for one of its resources. The UI doesn't show a way to add a graph. What could be wrong ?

2016-05-28

2016-05-27
[06:02:47] <Psykar> \o k-nut if you'd prefer not to spam github
[06:02:49] * Psykar shrubs
[06:02:52] * Psykar shrugs
[07:24:28] <k-nut> Psykar: I just tried the test without any use but that does not work because then we would also need to set `create_unowned_dataset` to True and that is exactly what we don't want to test
[07:24:44] <k-nut> I also tried to set all the env vars you pointed out but that still gives me a 403
[07:26:24] <Psykar> k-nut,  there must be some combination of config vars to get it. Otherwise the test is actually pointless?
[07:26:50] <Psykar> k-nut, do you need to have created an org and added the user to it perhaps?
[07:26:52] <k-nut> and that is because the `package_create` functions checks if a) we are allowed to create unowned datsets or b) we are in an organization for which we can create
[07:27:01] <k-nut> both don't match I think
[07:27:31] <k-nut> Well yes, if he had an org it would work. But I wont to test precisely what happens when there are no organizations but a dataset must be assigned one
[07:27:57] <k-nut> I think the test cannot happen in the standard ckan and is only applicable if some plugin overwrote the `package_create` auth function
[07:28:34] <Psykar> k-nut, ah >.> you could put a simplified version of that extension in ckanext ?
[07:29:23] <Psykar> k-nut, the patch just seems strange because it's putting ckan in a situation that won't happen unless the patch is applied, making the test redundant.
[07:30:02] <Psykar> k-nut, that said, I'm not a ckan dev or anything, was just commenting :D
[07:30:19] <Psykar> er, ckan maintainer, I do do dev
[07:30:42] <k-nut> Ah, that makes sense. So you are proposing that I create an extension just for the test so that I can include that there?
[07:31:32] <Psykar> k-nut, maybe? although most of those that exist are for testing plugin interfaces specifically
[07:31:35] <Psykar> (from what I see)
[07:32:03] <Psykar> Maybe wait for other comments before going down that path (it's a bit more effort that might be wasted otherwise :D )
[07:32:31] <k-nut> I'll write our findings done in the comments and wait for one of the core devs to react ;)
[07:44:58] <k-nut> Psykar: commented on the issue. Feel free to add anything if you think I missed something
[09:38:50] <k-nut> Can someone execute the latest master tests for ckan locally and tell me if they all pass? One of them is failing for me but they all run fine on circle.ci
[15:14:29] <rossjones> Is anyone harvesting from an ArcGIS data.json ?
[21:00:14] <corebits> rossjones: not from ArcGIS, but likely starting more work soon on geoportal + dcat, + ISO19115 NAP

2016-05-26
[11:49:12] <tktech> amercader, Sorry for the delay. Reviewed #3004 and everything looks fine!
[11:49:44] <amercader> woo!
[11:49:46] <tktech> There will probably be a babel update soon to fix a couple plural issues but the interface won't change, we'll just want to bump a bugfix version
[11:49:58] <amercader> push the button!
[11:50:15] <amercader> cool
[11:52:02] <tktech> amercader, for flask-babel, you'll want to pull from master, I haven't pushed 0.11 to pypi yet as I want to fix an issue with pgettext() first.
[11:52:11] <tktech> amercader, pushed some changes last night - https://github.com/python-babel/flask-babel/commits/master
[11:52:54] <tktech> Removes a dependency and fixes support for py3.
[11:53:24] <amercader> ok, I'm not working on 18n stuff now but will keep it in mind
[12:21:30] <Zharktas> is transifex the correct place to fix typos in translations so that they would be included in next release ?
[12:21:54] <Zharktas> as in I would fix typos in ckan 2.5 which is the latest in transifex
[12:29:53] <wardi> Zharktas: yes
[12:30:30] <Zharktas> will do then
[12:50:47] <tktech> wardi, going to do the meeting from the office?
[12:51:15] <tktech> Ah never mind, just saw your message.
[12:54:23] <wardi> that didn't work well last week. just ask amercader and brook_
[12:54:57] <wardi> I think I came through like a robot. I could hear them ok though
[12:55:33] <tktech> My connection is solid, but I have to be absurdly careful with data. I've already had to bump the plan up to 15GB at $130/month.
[12:55:42] <wardi> also, it seems like every meeting room in the building is booked at 10am
[12:55:58] <tktech> I forgot to setup OS X properly, so it kept downloading updates silently while tethered.
[12:56:12] <tktech> So RIP my bandwith and hello six months of updates
[12:57:54] <wardi> I set a warning on my phone that's well before my limit to catch when I do that
[12:58:25] <tktech> I have it set as well, but when I switched from Wind to Bell I didn't move the start and end periods
[13:57:03] <jrods> will there be a dev meeting in 5mins?
[13:59:16] <brook_> jrods yes!
[13:59:40] <wardi> join now and beat the rush
[23:40:59] <Psykar> @wardi, @amercader I'm amused that three of you all commented on the exact same line at the exact same time in my PR >.>

2016-05-25
[11:44:57] <wardi> k-nut: did you figure out the url_changed hack? That was a fix for people re-uploading files with exactly the same name (they wouldn't trigger the url_changed flag, but we wanted them to be processed as if they had)
[11:46:24] <k-nut> wardi: ah, that makes sense :)
[11:47:05] <wardi> when making code worse I usually remember to add a comment to ask the reader for forgiveness and explain myself a bit
[11:47:14] <wardi> missed it that time
[12:22:04] <wardi> docker hub's interface is so frustrating..
[14:35:51] <mage_> do I need a filter:proxy-prefix if I want to deploy as /foo instead of / ?
[14:40:35] <mage_> apparently ckan.site_url is not enough
[14:44:53] <Zharktas> site_url is used so that various urls are built correctly among other things
[14:45:27] <Zharktas> but the webserver itself needs to be configured so that ckan would be deployed somewhere else than root
[14:47:45] <mage_> I've set ProxyPass /someprefix http://127.0.0.1:1234/ and ProxyPassReverse
[14:47:51] <mage_> (in Apache)
[14:48:40] <mage_> but apparently I need to setup a [filter:proxy-prefix] use = egg:PasteDeploy#prefix prefix = /someprefix
[15:16:18] <corebits> wardi: when using scheming with the harvester is it possible to specify the dataset_type ?
[15:21:26] <wardi> co
[15:22:12] <wardi> corebits: I'm afraid I don't use the harvester. If it's passing 'type' that will be the dataset type used
[15:29:04] <corebits> ok Thanks, just thought I would check before I dug into this further. Just trying to clean up some of these manual import processes with the harvester.

2016-05-24
[09:05:13] <k-nut> Hello everybody, I am look at this story right now https://github.com/ckan/ckan/issues/3028 which refers to this commit https://github.com/ckan/ckan/pull/2519/commits/3e3a7c8db91428e772e0545315bf9663d4cbc43a Can someone explain to me why `obj.url_changed` is set to `True` when the key is `last_modified`? I fail to see the connection
[16:45:43] <benjwadams> what method does `paster db init` call?  My users keep getting wiped in the docker container even though I have a named docker volume set up for the postgres data.

2016-05-23
[06:06:48] <grahame> hey, if anyone's awake I'm hitting a migration issue which I saw someone else had
[06:07:02] <grahame> python ckan/migration/manage.py upgrade  postgresql://ckan:ckan@db/ckan
[06:07:17] <grahame> which dies with 'KeyError: <VerNum(21)>
[06:07:26] <grahame> running db init through paster dies too
[06:07:38] <grahame> for that lucky person, the 'upgrade' worked
[06:07:46] <grahame> it's ckan 2.5.2 installed into a virtualenv
[06:45:23] <grahame> aha, the 021 migrate files are missing from the pypy package. installing from git works.
[06:45:26] <grahame> strange :-)
[07:52:27] <Psykar> convert_from_extras only works with packages it seems, can't use it with organizations? It almost seems to, but not quite :(
[08:22:26] <nigelb> grahame: might be worth reporting a bug :)
[08:22:32] <nigelb> That shouldn't happen, ideally.
[08:31:19] <grahame> nigelb: ok, will do :)
[08:32:18] <grahame> strangely enough if I setup.py bdist they're in the resulting tarfile
[08:33:52] <nigelb> grahame: I think or process is sdist, rather than bdist.
[08:33:55] <nigelb> *our
[08:40:30] <grahame> aha, that's it then
[08:41:05] <grahame> https://github.com/ckan/ckan/issues/3045
[08:51:46] <nigelb> grahame: I pulled off the sdist vs bdist from our docs - http://docs.ckan.org/en/latest/contributing/release-process.html#doing-the-final-release
[08:57:19] <grahame> I think I've got a fix, I'll put in a PR in a sec
[09:01:43] <nigelb> yay

2016-05-22

2016-05-21

2016-05-20
[07:11:21] <amercader> In case someone missed it https://twitter.com/CKANproject/status/733411088289660928
[07:11:36] <amercader> Hope to see you in Madrid
[07:13:15] <nigelb> nice!
[09:37:13] <k-nut> following up on my question about testing permissions in ckan. I want to write a test for issue #2990 so I need the `organization_list` function to return `{'success': False}`. Since it is hardcode to return True I will probably have to mock that in the test, right?
[09:44:34] <Zharktas> k-nut: https://github.com/ckan/ckan/tree/master/ckanext/example_iauthfunctions you could create a plugin which overrides the auth function
[09:45:53] <k-nut> Zharktas: but I just need that for the test. Isn't that a bit of overkill?
[09:46:41] <amercader> k-nut: mocking it sounds like the best approach
[10:08:39] <k-nut> ok, it seems like that worked fine. You can take a look at it here if you want: https://github.com/ckan/ckan/pull/3038
[14:39:11] <wardi> amercader: awesome!

2016-05-19
[06:06:26] <Psykar> Is there an easy way to *replace* a ckan javascript module? Trying to register a module that already exists throws errors understandably.
[06:13:27] <Psykar> Currently looks like best method is to override the template which loads the module as well, and use a new name :(
[14:00:35] <wardi> Psykar: that might be true. I think we've resorted to disabling fanstatic resources because we couldn't tame it
[14:24:07] <amercader> wardi: let's finish here :)
[14:25:01] <amercader> with regards to Flask two things. Blueprints are looking really promising both for defining core views and for registering new routes from plugins (see links on the pad)
[14:26:23] <amercader> The other thing is problems with url_for. Again there's a link on the pad to a massive comment I wrote describing the issues (https://github.com/ckan/ckan/pull/2971#issuecomment-220328950). Would be good to discuss this next week and hopefully get input from tktech and others with more flask experience
[14:28:15] <amercader> wardi, brook: Other item that I forgot to mention is that knut has asked for stuff to be assigned to him. I can definitely can find something but if you have some beginner-friendly issues or PRs that you want him to have a look let me know
[14:29:28] <mage_> hello
[14:29:39] <mage_> is ckan compatible with Solr 5 or 6 ?
[14:32:54] <amercader> mage_: I'm pretty sure 5 is fine (at least the latest version) because there have been PRs related to it. Not sure about 6
[14:33:30] <mage_> ok, I'll try with 5 then, thanks
[14:42:10] <mage_> so, 100% sure that the schema.xml is compatible with solr 5.5.1 ?
[14:43:35] <amercader> mage_: no, I might be about 75%, as I haven't used it myself :)
[14:43:41] <amercader> The highest I've used is 5.2.1
[14:44:21] <mage_> ok :p
[14:49:03] <mage_> any idea for 2016-05-19 14:48:30,841 ERROR [ckan.lib.search.common] HTTP code=404, reason=Not Found
[14:49:07] <mage_> ?
[14:51:51] <amercader> mage_: this is ckan not being able to contact Solr. Make sure that your `solr_url` config option points to the actual Solr instance
[14:53:50] <mage_> it is :(
[14:54:13] <mage_> it returns 404 so I guess it connects
[14:55:07] <amercader> what version of ckan are you using?
[14:55:50] <mage_> 2.5.2
[14:56:07] <mage_> solr_url = http://10.209.1.30:8983/solr
[14:58:28] <amercader> does this url work outside CKAN? ie you see the solr admin console or something solr-ish
[14:59:13] <mage_> yep
[14:59:25] <mage_> https://gist.github.com/silenius/d5cf81ddd5f4e6827a798767a8d247fe
[14:59:48] <mage_> (I changed solr_url to http://10.209.1.30:8983/solr/#/)
[15:02:36] <amercader> mage_: what does this return: curl http://localhost:8983/solr/select\?q\=\*:\*
[15:02:48] <amercader> sorry, change localhost to your ip
[15:04:20] <mage_> amercader: https://dpaste.de/a4Ov/raw
[15:05:40] <mage_> I've created a ckan instance "ckan_bbpf" in solr
[15:06:03] <amercader> ok, then try http://localhost:8983/solr/ckan_bbpf/select\?q\=\*:\*
[15:06:29] <mage_> http://10.209.1.30:8983/solr/ckan_bbpf/select?q=*%3A*&wt=json&indent=true works
[15:06:44] <wardi> amercader: sorry about connection issues, I think I'll come in to the office *after* our meeting from now on
[15:06:59] <wardi> too much concrete and competing 3G+wifi
[15:07:36] <amercader> wardi: no worries, see notes ^^^
[15:07:53] <mage_> ah, changing ckan.url to http://10.209.1.30:8983/solr/ckan_bbpf .. now I get a 500
[15:08:54] <amercader> I guess you mean solr_url
[15:09:28] <mage_> yep sorry
[15:10:20] <mage_> I tok I tried to reinitialize the db with paster db init -c /usr/local/www/sites/ckan_bbpf/etc/ckan.ini and I'm getting a 500 too .. I guess something is wrong on the solr side
[15:10:51] <mage_> 1504939 INFO  (qtp59559151-15) [   x:ckan_bbpf] o.a.s.c.S.Request [ckan_bbpf]  webapp=/solr path=/admin/file params={file=schema.xml} status=500 QTime=0
[15:10:54] <mage_> 1504939 ERROR (qtp59559151-15) [   x:ckan_bbpf] o.a.s.s.HttpSolrCall null:java.lang.NullPointerException
[15:10:57] <mage_> mmh
[15:11:14] <amercader> sorry, that seems an issue on the Sorl side
[15:12:07] <mage_> yep .. any idea where should I put this schema.xml ? I put it there https://dpaste.de/Qvjj/raw
[15:12:23] <mage_> (this is the first time I play with solr)
[15:13:40] <corebits> Anyone aware of any teams integrating Hadoop with Ckan ?
[15:14:12] <corebits> found this, but not alot else https://github.com/telefonicaid/fiware-tidoop
[15:14:23] <mage_> mmh I guess it's because solr 5 uses managed schema by default ..
[15:16:19] <corebits> mage_: did you symlink the ckan schema ?
[15:19:59] <mage_> corebits: yep, found it, I've to add <schemaFactory class="ClassicIndexSchemaFactory"/>
[15:20:06] <mage_> in my solrconfig.xml
[15:22:16] <corebits> mage_: working for you now ?
[15:25:49] <mage_> not yet ..
[15:26:04] <mage_> now I'm getting a https://dpaste.de/Cs1w/raw when I paster db init -c /usr/local/www/sites/ckan_bbpf/etc/ckan.ini
[15:26:06] <theredmonkey> hi
[15:26:27] <mage_> but I'm seeing the fields from the ckan schema.xml in the solr interfaces
[15:28:26] <mage_> any idea ? :p
[15:35:02] <mage_> maybe ckan is not compatible with solr 5.5.1
[15:36:25] <corebits> mage_: Sorry not off the top of my head. I am currently on 5.1.0 and need to find time to upgrade very soon
[15:42:05] <mage_> ah ... now it works !
[15:42:27] <mage_> problem was that I had my config in the wrong directory
[15:43:22] <corebits> ;)
[15:51:03] <mage_> thansk for your help

2016-05-18
[12:38:19] <rossjones> Anyone seen this new useful content to point new people at? https://delftswa.gitbooks.io/desosa2016/content/ckan/chapter.html
[13:22:46] <wardi> wow, that's pretty thorough
[14:16:05] <mony_> hello
[14:16:56] <mony_> did a fresh install from sources through "git clone" (for CKAN and the DataPusher) and I'm having the same issue: the datapusher it's cycling forever. My current version is 2.5.2. Can you please help me?  Thanks in advance.
[21:04:17] <tktech> amercader: I can take a look tomorrow

2016-05-17
[08:34:40] <amercader> benjwadams: the Docker images were not maintained up until now, if they are stable we can definitely tag them on each release
[10:53:53] <Zharktas> are there extensions for aws s3 that are tested with newer versions than 2.2 ?
[11:13:35] <brook_> ckanext-s3filestore works with 2.5+ : https://github.com/okfn/ckanext-s3filestore
[11:15:30] <brook_> Zharktas ^
[11:31:02] <Zharktas> ah, thanks. my googling only gave older extensions
[11:58:40] <wardi> We'll probably be working on a similar extensions once we get some cloudy storage

2016-05-16
[10:19:50] <amercader> tktech: when you have a moment I sent a PR to flask-babel needed to get it working on CKAN: https://github.com/python-babel/flask-babel/pull/91
[10:19:55] <amercader> + this https://github.com/ckan/ckan/pull/3004
[20:23:35] <benjwadams> Why aren't there any tagged CKAN releases on Dockerhub?  It makes me worry that some dependent projects are going to break in the future when I pull from the ckan/ckan dockerhub
[20:24:11] <benjwadams> It's just latest.  This seems like it will cause things to break

2016-05-15

2016-05-14

2016-05-13
[12:47:30] <rossjones> Wie geht's ckan world? Saw amercader has nearly got the flask stuff working ... awesome stuff!
[12:49:34] <wardi> yes, these are exciting times
[12:57:55] <rossjones> Py3 next then ;)
[13:00:30] <wardi> https://github.com/ckan/ckan/issues/3006 should help with that
[13:34:44] <rossjones> Cool to see tktech cleaning up loads of old bugs as well :)
[13:34:55] <rossjones> I'm betting he automated it :)
[18:45:13] <benjwadams> what installs PyCSW in the ckanext-spatial extension?  I don't see it in the requirements or pip freeze but it must be a dependency of something because it runs fine
[18:46:37] <tomkralidis> benjwadams: AFAIK it's a standalone install
[18:46:55] <tomkralidis> pycsw, that is
[18:47:21] <benjwadams> I don't think I ran `pip install pycsw`, don't remember
[18:49:03] <tomkralidis> does say git clone: http://docs.ckan.org/projects/ckanext-spatial/en/latest/csw.html#ckan-pycsw
[18:50:13] <tomkralidis> *docs
[18:51:25] <benjwadams> Ah
[18:51:27] <benjwadams> gotcha
[18:51:33] <benjwadams> guess i did at some point then
[18:54:33] <tomkralidis> it would be valuable to just include pycsw in the pip requirements, and then include the WSGI wrapper and config in ckanext-spatial proper.
[18:54:46] <tomkralidis> feel free to open a ticket and I'll give it a go
[18:55:00] <benjwadams> Hmm
[18:55:39] <benjwadams> i'm working through a virtualenv running ckan, i also don't see the WSGI wrapper for pycsw mentioned in the docs there (csw.wsgi)
[18:56:10] <benjwadams> ran `find -name 'csw.wsgi'` on the venv dir
[18:57:22] <tomkralidis> what version of pycsw are you working with?
[18:57:39] <benjwadams> possible to run it through paster?  It looked like the paster commands were for setting up the csw tables, loading records into DB, etc
[18:58:00] <tomkralidis> if you are working off master, it's probably at pycsw/wsgi.py
[18:58:06] <benjwadams> 1.10.4
[18:58:28] <tomkralidis> if you pip install'd pycsw, then the WSGI wrapper is not included, just the lib
[18:58:41] <benjwadams> ah

2016-05-12
[14:03:02] <amercader> tktech: dev meeting?
[15:35:46] <benjwadams> I'm very lost on how to set up CKAN with Solr (6.0).  The docs are so old that they mention running solr with jetty, and solr is now standalone
[15:36:57] <wardi> benjwadams: for newer solr there's an extra step. I think you need to disable the managed mode
[15:37:25] <benjwadams> is that solrcloud or whatever?  I'm very new to Solr setup
[15:37:38] <benjwadams> doesn't help that solr docs are somewhat confusing too
[15:37:56] <corebits> I haven't tried 6.x yet, but have 5.x running fine under rhel7
[15:38:09] <benjwadams> Starting from creating a new solr core, what do i do?
[15:45:04] <wardi> benjwadams: what I've heard is you need to disable managed mode then copy the schema.xml into the config directory
[15:45:39] <wardi> there might be a file that was created from the managed mode that might need to be removed as well.
[15:47:13] <corebits> benjwadams: I'll need to review my setup scripts, but wardi is on the right track for sure.
[15:47:29] <benjwadams> I'll downgrade to 5.x series
[15:48:35] <corebits> benjwadams: curious which distro are you running on ?
[15:48:48] <benjwadams> CentOS 7
[15:49:12] <corebits> ok
[15:55:00] <jrods> does anyone know how the minified css files get made? i had to add to a .less file and was able to compile main.css but i didn't see anything in the docs about creating the min.css files
[15:55:23] <Zharktas> jrods: fanstatic does it during startup
[15:55:35] <Zharktas> so apache restart or something fixes it :)
[15:56:54] <jrods> i just restarted ckan and it works =) thanks Zharktas
[15:58:11] <jrods> however, ckan didn't make a min.css of main.css, the pages is just using main.css
[16:01:10] <Zharktas> if your development.ini is in debug mode, it won't use minified versions
[16:02:00] <jrods> i just checked and debug is set to false
[16:03:04] <Zharktas> you might actually need to use paster http://ckan.readthedocs.io/en/latest/maintaining/paster.html#paster-commands-reference
[16:03:25] <Zharktas> theres front-end-build and minify commands which might be needed for it
[16:05:57] <jrods> ok ill give that a try, i guess it's not a big deal for commits right? just that if less files are changed that a recompiled main.css is provided in a separate commit, correct?
[18:45:38] <benjwadams> what's this mean when running `paster --plugin db init -c ckan_config_file`:
[18:45:40] <benjwadams> KeyError: <VerNum(21)>
[18:46:04] <benjwadams> something to do with migrations but it's not a very clear error message.  The database and tables should be empty.
[18:46:38] <wardi> benjwadams: do you have old pyc files in your migrations dir?
[18:47:00] <wardi> (have you been switching between ckan versions in a git clone?)
[18:47:14] <benjwadams> i've been switching virtualenvs
[18:49:11] <benjwadams> I see no pyc files
[18:49:18] <benjwadams> let me try wiping the database
[18:49:38] <wardi> `paster --plugin db` also doesn't look right
[18:49:57] <benjwadams> meant `paster --plugin=ckan ...`
[18:50:40] <wardi> maybe your db was upgraded past what the ckan version supported?
[18:50:54] <benjwadams> what's supported?
[18:51:10] <benjwadams> i thought it was 9.2+
[18:51:35] <wardi> I mean the migrated version, not the postgres version
[18:54:37] <benjwadams> wiped the db, tried again, no dice
[19:01:32] <jrods> benjwadams: how did you install ckan?
[19:01:40] <benjwadams> pip
[19:02:04] <benjwadams> Created the ckan_default db per the docs, created a solr instance
[19:02:05] <jrods> as in `pip install ckan==2.x.x` ?
[19:02:45] <benjwadams> i fetched off of master
[19:02:56] <benjwadams> ckan.__version__ = '2.6.0a'
[19:03:59] <jrods> hmm, i mean i ran into the same problems but with cmd i posted above
[19:04:09] <jrods> not sure what it could be
[20:30:08] <benjwadams> still didn't figure it out
[20:31:05] <wardi> benjwadams: still gettting the same error?
[20:31:18] <wardi> maybe post the full command and traceback as a github issue
[20:31:18] <benjwadams> had to run `ckan/migration/manage.py`
[20:31:24] <benjwadams> sec
[20:32:23] <benjwadams> Had to run `python ckan/migration/manage.py upgrade postgresql://ckan_default@/ckan_default` to apply the migration
[20:32:50] <benjwadams> Seems to be working now
[20:45:52] <benjwadams> still, the docs are in need of some TLC
[20:46:00] <benjwadams> for the source install
[20:47:14] <wardi> paster db upgrade would have done that part for you. we had another comment recently about that being missing from the docs

2016-05-11
[02:57:28] <Psykar> https://github.com/ckan/ckan/blob/master/ckan/logic/action/get.py#L386 seems wrong... as https://github.com/ckan/ckan/blob/master/ckan/logic/action/get.py#L523 adds 'type' to the data dict anyway?
[03:11:51] <travis-ci> Psykar/ckan feature/allow_custom_org_types f318ae6 https://travis-ci.org/Psykar/ckan/builds/129322688 Louis des Landes: The build has errored.
[03:25:57] <Psykar> wait what? enabling travis on my own fork posts here >.>
[04:32:59] <Zharktas> https://github.com/travis-ci/travis-ci/issues/5063#issue-115477841 apparently this would be solved if the notification settings are secured
[04:33:10] <Zharktas> this has been an issue for a long time
[04:42:12] <Psykar> Zharktas, I opened an issue https://github.com/ckan/ckan/issues/3009 - doesn't really bother me I guess, and it's hardly causing much spam in here.
[12:14:52] <nigelb> Interesting github price plan change.
[14:11:51] <wardi> nigelb: oh, they've gone the gitlab pricing route?
[14:13:14] <wardi> sorry, make tht bitbucket
[14:13:21] <corebits> I heard unlimited private repos, they revamped the pricing as well ?
[14:14:01] <wardi> seems to be based on # users with access to the repos. makes sense
[14:14:10] <amercader> unlimited private repos if you pay :)
[14:14:17] <nigelb> wardi: less fun now for large organizations :)
[14:15:21] <wardi> large orgs with only a few repos
[14:15:58] <wardi> it always felt silly to have to prune old repos to stay under the limit. (maybe I just tend to split things up too much)
[14:25:21] <Zharktas> most likely "large organization with few private repos" move to bitbucket or something else since github pricing gets quite pricy quite fast now
[15:01:29] <tktech> Better than the original model which changed based on count and repo size
[15:02:10] <tktech> Psykar, groups and the orgs built on them are just really messy in general, and haven't been touched in years.
[15:02:22] <tktech> You'll find a lot of "bad things" digging throug hit
[15:02:24] <wardi> I don't get it. when do you have to move from org to enterprise?
[15:03:04] <tktech> When you have a few thousand people.
[15:03:07] <tktech> Like Adobe.
[15:03:19] <tktech> For a few dozen to a few hundred just setting up gitk works better.
[15:10:40] <wardi> oh, enterprise is for hosting on your own servers

2016-05-10
[00:14:33] <Psykar> @wardi, thanks for the helper suggestion actually, meant I culled a lot of bloat from my extension doing those overrides.
[12:00:55] <wardi> Psykar: you're very welcome. I think the setup_template_variables function isn't actually a good interface, but feel free to submit fixes if you have them
[12:01:45] <amercader> wardi: we can hear you fine

2016-05-09
[00:24:05] <Psykar> Thanks @rossjones btw - I assume the SO reply was yourself as well - as mentioned I'd already come across ckan-hierarchy - it helps with the logical structure, but not with creating all the controllers and routes obviously.
[06:35:26] <Psykar> Erk. Seems some organization controller actions call _setup_template_variables and some don't... rather arbitrarily :(
[06:40:20] <Psykar> *group controller actions
[06:44:29] <Psykar> Worth fixing these and opening a PR?
[06:44:57] <Psykar> (I would think every route action that gets created for IGroupForm's should call setup_template_variables ?)
[12:34:40] <memaldi> Hi all
[12:35:22] <memaldi> I'm using the ckanext-archiver and it consumes more and more RAM as more datasets are archived
[12:35:43] <memaldi> Is there any solution to fix this?
[14:01:49] <tktech> Hm
[14:04:25] <tktech> memaldi, Are you noticing a slow creep, or is it growing quickly?
[14:04:36] <memaldi> slowly
[14:04:49] <memaldi> but I have to archive almost 5000 datasets
[14:05:56] <tktech> Just confirming, you're noticing this leak inside the worker?
[14:06:04] <tktech> Or the celery tables?
[14:06:21] <memaldi> Inside the worker, yes
[14:07:57] <tktech> Don't see anything obvious, I'll have to actually run it to see what the gc sees. Give me a bit.
[14:39:49] <tktech> Setting up test data for this is annoying
[14:43:07] <tktech> amercader, you silly billy :)
[14:43:14] <tktech> amercader, https://github.com/ckan/ckan/pull/3002/files#diff-773116057fdf100b3da4a17d2c0abf9eR17
[14:43:33] <tktech> You can remove that, instead do - from nose.tools import assert_equal, eq_
[15:42:53] <amercader> true, thanks tktech
[16:23:36] <wardi> Psykar: yes, some of that should have been cleaned up on master. I tend not to use helpers instead of adding context variables to every page from my plugins, though
[23:21:34] <Psykar> @wardi, I actually checked master, some were still missing. Fair to use helpers - otherwise I find myself overriding a controller method purely to add the call to setup_template_variables!

2016-05-08
[07:31:22] <Patrick__> hi
[07:31:58] <Patrick__> is there a way to make ckan ignore metadata?
[07:36:25] <Patrick__> I should say I am getting the following error Bad metadata detected for module Taerobee 2.3: No files found in Taerobee to install! because i changed the registry.json to download the new one because the current link is broken
[07:39:23] <Zharktas> i would guess that you are in wrong channel
[07:40:07] <Zharktas> this channel has nothing to do with kerbal space program
[16:28:35] <wardi> "is there a way to make ckan ignore metadata?" is kind of a fascinating existential question
[16:29:23] <wardi> what is a metadata catalog that ignores metadata?
[19:54:01] <palcu> you may rebrand CKAN afterwards as a file manager web interface ;)

2016-05-07

2016-05-06
[07:25:55] <Psykar> Any thoughts on custom organization types? http://stackoverflow.com/q/37066656/2364563
[09:13:55] <rossjones> Psykar you can achieve your first option with organisation hierarchies.
[09:14:28] <rossjones> https://github.com/datagovuk/ckanext-hierarchy
[09:16:26] <rossjones> That will help you manage the display of them, but CKAN itself supports hierarchical organisations.
[14:52:55] <amercader> I did a quick audit of  what plugin interfaces might be affected by the Flask migration: https://github.com/ckan/ckan/wiki/Migration-from-Pylons-to-Flask#extensions-and-plugin-interfaces
[14:53:18] <amercader> This is just my feeling based on the work we've done so far on the views branch
[14:53:29] <amercader> it's actually not that bad
[14:54:59] <wardi> hmm. github is truncating that last column for me :-(
[14:56:24] <wardi> oh, there's the scroll bar. igore me
[14:57:35] <wardi> amercader: that's great to see.

2016-05-05
[14:02:12] <wardi> brook_, tktech: meeting?
[14:02:27] <brook_> Sorry - not today :(
[14:03:07] <wardi> brook_: ok, next tuesday then.

2016-05-04
[19:12:09] <benjwadams> How can I view CKAN's "routes map", used in `before_map`?

2016-05-03
[07:41:17] <palcu> is there a way I could get the what is a location on disk of a resource? I would like to send it directly to Apache 2's cache using MMapFile.
[07:45:13] <palcu> nevermind. The resources folder has a nice structure that matches the URL structure.
[12:01:25] <wardi> tktech: meeting?
[12:08:52] <tktech> wardi, can't seem to unmute myself
[14:39:23] <rossjones> Oh celery. celery celery celery.
[14:46:00] <corebits> It's good for you ross :)
[14:47:51] <corebits> Hey, anyone know if it would be difficult to overide the default sort order of new resources. In our open information section we have datasets with 30+ resources, and my custodians would like to have new resources added to the top of the list rather than bottom.
[14:48:16] <corebits> Can I override it in my extensions, or will it need to happen in Ckan ?
[15:05:21] <rossjones> corebits they used to have a position field which was an int, not sure if they still do or not.
[15:05:29] <rossjones> and celery is anything but good for me ;)
[15:05:46] <Zharktas> corebits: you could override it in templates since they render them in the order they are in pkg.resources
[15:05:55] <Zharktas> use some helper to reorder it :p
[15:09:06] <rossjones> There's a UI to reorder them isn't there?
[15:09:27] <Zharktas> yup, overrideing the sort order would make that useless though
[15:11:08] <wardi> corebits: yes, we do the thing Zharktas said, and disable the reorder interfece
[15:18:10] <corebits> Ok, Thanks guys I have a meeting later and will discuss whether losing the reorder interface is worth having this default sort order. My guess is the reorder interface is wanted/needed by other groups.

2016-05-02
[11:35:39] <tktech> amercader, I believe I've addressed all your flask-babel points.
[12:01:55] <amercader> tktech: I'm away at a conference this week but will definitely check the PR
[12:02:12] <tktech> amercader, oh, which conference?
[12:02:23] <amercader> csvconf in berlin
[12:02:45] <amercader> you should defo come to the next one!
[12:02:52] <amercader> lots of data nerds
[12:03:00] <amercader> and berlin rocks
[15:34:35] <wardi> brook_: are you around for the meeting tomorrow?
[15:35:25] <brook_> Yep - though I think amercader will still be in Berlin
[15:36:20] <wardi> tktech: ^ so yes we can discuss flask views bright and early
[15:37:17] <tktech> Yaaaaay

2016-05-01

2016-04-30

2016-04-29
[18:45:02] <tktech> amercader, poke

2016-04-28
[08:21:45] <amercader> jrods, ageara: it should be there now. Apologies, I didn't manage to do it yesterday
[09:01:56] <rossjones> amercader do we have a list of all the instances and the versions they're running? Stumbled across one running 2.1 yesterday (Helsinki I think)
[09:03:05] <amercader> rossjones: the closer is the census results spreadsheet I think
[09:03:40] <amercader> you should have access to it
[09:04:18] <rossjones> Wonder if the opendatasoft opendatainception thing might have more on it.
[09:04:52] <rossjones> http://opendatainception.io/
[09:07:48] <rossjones> So many portals on 2.1/2.2 :(
[09:10:59] <nigelb> :(
[09:11:56] <amercader> we need to be vocal about the unsupported version. We reach the agreement of just going as far as 2.3
[09:20:26] <rossjones> Oh, I thought you were going to 2.4
[13:57:22] <jrods> amercader: i see it in pypi =), thank you very much amercader, i apperciate it, so does the bcgov =D
[13:59:07] <amercader> jrods: no worries, I  BC
[13:59:35] <amercader> I've been lucky enough to visit it twice
[14:01:23] <wardi> amercader: meeting?
[14:01:40] <amercader> just arrived :)
[14:01:49] <wardi> tktech: meeting?
[16:35:12] <ageara> amercader: Thanks for the push to PyPi - hope you get another opportunity to visit BC
[17:42:54] <koowgnojeel> O__O

2016-04-27
[12:05:41] <travis-ci> aptivate/ckan mapaction-dev 05ab55b https://travis-ci.org/aptivate/ckan/builds/126085842 Martin Burchell: The build has errored.
[13:49:57] <amercader> tktech: if you are up for it https://github.com/ckan/ideas-and-roadmap/issues/32
[17:52:26] <tktech> Switching to alembic for future migrations is simple, not sure how easy it would be to move all the older migrations over
[18:14:23] <tktech> I'm going to close https://github.com/ckan/ckan/issues/2980 if there are no objections?
[18:29:38] <wardi> tktech: he's suggesting changing the default group schema, right? why don't we talk about it tomorrow?
[18:29:46] <tktech> He isn't
[18:29:54] <tktech> He's just asking *why* it's like that
[18:30:31] <wardi> ok, that's true
[18:30:52] <wardi> but it might be worth changing..
[18:34:12] <tktech> I don't know
[18:34:23] <tktech> wardi, for ops purposes for example, a real date_modified and date_created are very useful
[18:34:28] <tktech> For showing things like growth over time
[18:35:34] <wardi> ok, that could appear in the revision/activity table if you care about when something was created or changed
[19:29:59] <tktech> amercader, so
[19:30:05] <tktech> do we *need* to backport migrations
[19:30:09] <tktech> I can see us supporting both for awhile.
[19:30:22] <tktech> Nothing really stopping us from using alembic from now on
[19:30:43] <tktech> And keeping migrate as a dependency for six months deprecated, then as an optional dependency
[19:31:49] <tktech> 2.3, 2.4, 2.5 we could port, everything beyond that we axe
[21:01:36] <jrods> sorry to bother you amercade, but any update on ckan v2.3.4 in pypi?
[21:01:58] <jrods> *amercader
[21:45:52] <ageara> does anyone know when the Cheese Shop will stock 2.3.4  https://pypi.python.org/pypi/ckan/2.3.4  ?

2016-04-26
[12:01:21] <wardi> amercader, tktech, joet: meeting?
[12:13:46] <joet> google hangouts hates this computer perhaps another time
[12:14:47] <wardi> joet: does it work on your phone?
[12:16:03] <joet> might do
[12:27:41] <amercader> joet: sadly we didn't manage to get a brand ckan 3.0 while you were away
[12:32:04] <wardi> speaing of, when are we supposed to fork for another release?
[12:33:19] <joet> I was totally expecting a complete rewrite in Haskell whilst I was away
[12:35:06] <wardi> joet: of course, you were the one that kept dissuading us from our pure functional dream
[13:25:29] <joet> amercader, I'm taking #2909 off you as you have even more pull requests to review than I remember
[15:31:35] <rossjones> nigelb the ML has been complaining about suspicious headers recently, and putting lots of stuff into moderation.  Has anything changed?
[15:47:05] <nigelb> rossjones: nothing from our end.
[15:52:04] <rossjones> :(
[16:30:50] <rossjones> wardi your question about better IDOM, sqlalchemy.events.listens_for
[16:42:35] <jrods> does anyone know the timeframe when ckan v2.3.4 will be released on pypi?
[16:46:00] <amercader> jrods: I can do that tomorrow
[16:47:26] <jrods> oh cool, that would awesome amercader, i would appreciate it
[17:35:37] <tktech> wardi, recommendation is like rossjones said, just SQLAlchemy's built-in events.
[17:35:45] <tktech> They've been the recommended thing for about 3 years now :P
[17:37:56] <wardi> right, now I can't remember where I saw people talking about IDOM :-)
[17:38:54] <tktech> I know exactly what you're talking about, I saw that PR the other day too
[17:39:16] <tktech> There were two, one in core CKAN that added a new event type to the psuedo-plugin
[17:39:20] <tktech> And a change in archiver that used it
[21:01:58] <travis-ci> dancastellani/ckan master bb3aa40 https://travis-ci.org/dancastellani/ckan/builds/125945047 Daniel Castellani: The build has errored.
[23:45:45] <tktech> wardi, So, I can't seem to get this migrate to work with ARRAY properly.
[23:45:59] <tktech> Is there any problem just doing a tiny bit of raw SQL?
[23:46:51] <tktech> migrate seems to just laugh in the face of the Dialect you pick and emits the standard SQL ARRAY syntax which isn't supported for this
[23:53:46] <tktech> Pffff alembic got it right on the first shot

2016-04-25
[10:49:38] <nigelb> https://twitter.com/yamhochi/status/724485954963038208
[15:31:57] <wardi> joet: thanks, I should be there. Don't think you should feel obliged to review anything though.
[15:32:44] <wardi> aaah. tech support over twitter? is that a thing?
[15:33:49] <joet> wardi, nah I have time and it would be nice to pop in.
[15:34:28] <wardi> sounds good to me
[15:45:25] <wardi> tktech: some IDomainObjectModification users https://github.com/ckan/ckanext-archiver/pull/26 what's the new recommended thing?
[22:15:46] <Ezriilc> Greets, ya'all.
[22:15:54] <Ezriilc> Can I get an update for HyperEdit?
[22:17:31] <Ezriilc> oops, sorry.  I'm an idiot.

2016-04-24
[22:15:50] <travis-ci> joetsoi/ckan solrpy-is-dead-long-live-pysolr 762c686 https://travis-ci.org/joetsoi/ckan/builds/125443442 joetsoi: The build has errored.
[22:27:55] <joet> wardi, I'm updating #2352. Might pop into the next dev meeting and I'll review a pull-request in return.

2016-04-23

2016-04-22
[09:38:13] <rossjones> Anyone ever done any celery tests and see -> (OperationalError) database is locked u'\nCREATE TABLE kombu_queue ... ?
[09:39:30] <rossjones> Presumably it's a configuration/setup thing where it creates it on first use if not present :(
[09:41:39] <yanik> is there is any limit on file size? Nginx give me "413 Request Entity Too Large" when I'm tryng to upload 1.3 GB one
[09:43:41] <rossjones> what are client_max_body_size and client_body_timeout set to in nginx config?
[09:58:10] <rossjones> WRT locking, looks like my celery task must have it's own session :(
[10:18:03] <rossjones> We need a dependency moratorium to update from deps that were release in 2010/2011
[11:14:53] <rossjones> And again hours wasted because ross doesn't notice the test.ini is testing against sqlite :(
[11:25:06] <amercader> rossjones: I don't know why we still have test.ini lying around. Just delete it
[11:25:34] <amercader> or rename test-core.ini to test.ini (although that would break some tests in extensions)
[11:28:39] <rossjones> It's in ckanext-issues which has extra settings, although not sure if it is picking up CELERY_ALWAYS_EAGER for tests - it's calling send_task, but they're disappearing into the ether :(
[11:37:21] <rossjones> Think I'm just going to see if I can pay someone to finish my RQ pull request.  Any takers?
[11:56:44] <rossjones> amercader Can I add an issue just so I have something to point bountysource at?
[12:02:22] <amercader> rossjones: of course, didn't know about bounytsource. Just assign yourself to it so you can pay $$$$ to the taker
[12:10:26] <rossjones> Have done. Hopefully my mail will get through to ckan-dev so we can get https://github.com/ckan/ckan/issues/2977 ;) Got to be worth a try right?
[12:10:53] <rossjones> Won't cover all of it, but it's a start ...
[15:19:15] <nigelb> rossjones: wait, what's a bounty?
[15:19:33] <rossjones> It's a "I will pay you this money if you fix this bug".
[15:19:49] <rossjones> nigelb and ideally, other people who want the feature add money to it as well :)
[15:40:34] <rossjones> Interesting tool for guessing CSV col types (in browser and allows user to change) -> https://github.com/timwis/csv-schema

2016-04-21
[14:00:45] <wardi> amercader: meeting?
[14:00:49] <wardi> tktech: ^
[14:00:57] <amercader> sorry, coming

2016-04-20
[05:56:45] <rossjones> amercader no, I am in Berlin the week after for another conference though.
[07:17:33] <amercader> rossjones: oh shame, I thought we might meet there
[07:17:57] <rossjones> I'll probably be at IODC, but that's Oct (I think).
[07:18:30] <rossjones> We could organise another CKAN Meetup if you're near London at any time :)
[08:57:50] <rossjones> amercader can I have a ckan.org login to add Tyler to the tech team page?
[09:02:11] <amercader> rossjones: check your inbox
[09:03:07] <rossjones> Ta amercader
[09:05:41] <rossjones> Should I remove Joe T whilst I'm there?
[09:15:35] <amercader> sure, we can always add him back if he gets involved again
[14:51:57] <tktech> amercader, I had comments on #230
[14:53:11] <tktech> I can see the benefits to it, since the changes are so minimal. Being able to get the logs through the CKAN api is a nice touch.
[14:57:24] <tktech> I see downsides too, like uncapped growth.
[16:11:43] <rossjones> Does anyone know what 'ckan.system_plugins' are in setup.py?
[16:12:40] <wardi> rossjones: those are the not-really-plugins
[16:12:59] <wardi> they shouldn't exist. if something is a core feature write it as a core feature
[16:13:07] <rossjones> :( I thought as much. Trying to work out why IDomainObjectModification won't trigger against my model :(
[16:14:06] <rossjones> Trying to work out how https://github.com/ckan/ckan/blob/d6b97b78db78fb1ee6a790f8677986e0f83611b5/ckan/model/modification.py#L15 works ... but it doesn't for me.  Maybe it's our CKAN :(
[16:15:46] <tktech> rossjones, are you sure that it actually works?
[16:16:09] <rossjones> No. Not at all.
[16:16:23] <rossjones> But IDOM is only working for Packages in my tests.
[16:16:37] <rossjones> Well, packages and resources.
[16:16:59] <tktech> I've skipped all of that. I use the modern SQLAlchemy event listen_for on the model and work from there.
[16:18:36] <rossjones> Maybe we can rework IDOM and PluginSessionExtension and PluginMapperExtension etc to use that?
[16:21:12] <rossjones> tktech  Oh, listens_for looks much better.  And you use that without problem?
[16:21:41] <tktech> Yes, I use it on our extension to listen for changes on the Member table to register new types of activity events.
[16:22:08] <tktech> The SQLAlchemy Events framework is what should be used, the olllld SQLAlchemy framework was deprecated...
[16:22:10] <tktech> 4 years ago?
[16:22:12] <tktech> 5.
[16:25:18] <rossjones> Sounds about right :(
[16:25:26] <rossjones> https://gist.github.com/rossjones/94fe20c08bec26d2663b42a7c6978985 works for me.  This is awesome. Much cleaner.
[16:25:42] <tktech> :D
[16:27:07] <rossjones> Seems like it wouldn't be too hard to just drop IDOM in favour of this...
[16:28:59] <tktech> Just depends on what people have built on top of it.
[16:29:11] <tktech> One of the downsides of releasing a plugin interface is that people expect it to stick around, heh.
[16:29:32] <tktech> If there's no big fuss over it I'd be totally down for just nuking the thing.
[16:32:11] <rossjones> Maybe it's a doc change for now, just pretend it doesn't exist in the meantime.
[16:32:50] <rossjones> Better go and get my train to London :( ttfn
[22:37:03] <jareds_h3> will there be a dev meeting tomorrow @14:00 UTC? I would like to join, I would mainly just observe the meeting

2016-04-19
[00:10:46] <wardi_> tktech: The duplicates make something easier for us, right?
[09:22:29] <rossjones> tktech can you ping me when you're online please...ta.
[12:35:59] <wardi_> tktech: oh, I get it, we get results without crazy nested queries. I wonder if we could achieve the same thing with another index insted
[13:45:00] <tktech> rossjones, I'm around, what's up?
[13:45:14] <tktech> wardi_, It does a couple of things. The database model for activities is extremely odd.
[13:45:34] <rossjones> tktech Hi. Am about to give you commit bit for ckan repo.  Is that okay?
[13:45:48] <tktech> wardi_, Groups/orgs don't current have any dataset-related activity, just org-specific events.
[13:46:15] <tktech> wardi_, So they query the Members collection to find all of the related users, and all of the datasets of those users that have membership.
[13:46:34] <tktech> wardi_, Then it takes the ID of every dataset and does a *massive* IN query to pull back all the related history.
[13:47:00] <tktech> wardi_, This also means if a user leaves a group later, that history is "lost". Or if a dataset is moved, deleted, etc..
[13:47:18] <tktech> wardi_, The duplication causes groups/orgs to have their own self-contained history regardless of the future history of the package
[13:47:53] <tktech> wardi_, but more importantly, it means none of these absurd nested queries, just a simple SELECT * FROM activity WHERE object_id=<group_id> LIMIT 30 ORDER BY date;
[13:48:25] <tktech> rossjones, I won't complain, it'll let me set the flags on my tickets without having to bug Ian :)
[13:48:33] <rossjones> :D Cool.
[13:49:15] <tktech> wardi_, The problem that is currently happening is that duplicates show up on the user's personal activity feed.
[13:49:34] <tktech> Because it simply filters by user_id=<user id>, which is set for both the org-specific activity event and the dataset-specific activity event.
[13:50:11] <tktech> The simple solution is just a new ENUM column, "event_scope" = 0/User 1/Group 2/Org
[13:50:25] <tktech> Which also lets you produce new activity streams
[13:55:03] <rossjones> tktech welcome to ckan tech team ... wooo!! :party: :fireworks: :etc:
[13:55:53] <tktech> My first order of business is to promote rewriting it in node.js
[13:56:13] <tktech> I died a little even saying that.
[14:46:32] <rossjones> I'm glad, you misspelled PHP
[14:46:40] <rossjones> and Mongo.
[14:49:24] <rossjones> Everyone now assign all their PRs to tktech and we're done here, time to head to the beach
[16:23:49] <memaldi> Hi all, I'm implementing some tests for my extensions and I have a question
[16:24:01] <memaldi> How can I generate the testing DB?
[16:24:17] <memaldi> I have the following error when executing sysadmin = factories.Sysadmin()
[16:24:27] <memaldi> OperationalError: (OperationalError) no such table: user u'INSERT INTO user (id, name, openid, password, fullname, email, apikey, created, reset_key, about, activity_streams_email_notifications, sysadmin, state) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)' (u'40d414fa-2806-47cc-a27f-f63eb2a98359', 'test_sysadmin_0', None, u'$pbkdf2-sha512$19000$ubcWAgAgpPT.f6.1ljLmvA$c1YLkDHRDMEztrnHuZTQU/T8AiqVBJYgxYvzddteAI.veBUm0nYAWGPnhDFPuWqiyHkOSdV.wtUUx0csFLvhJw'
[16:24:27] <memaldi> , 'Mr. Test Sysadmin', 'test_sysadmin_0@ckan.org', u'565d0d91-b87a-4c19-ba7d-8a83e0000e1e', '2016-04-19 18:20:15.977314', None, 'Just another test sysadmin.', 0, 1, u'active')
[16:28:37] <tktech> memaldi, looks like you haven't setup the test db?
[16:28:56] <tktech> You need to follow the steps here - http://docs.ckan.org/en/latest/contributing/test.html
[16:31:02] <memaldi> When I launch the tests the test_db.sqlite3
[16:31:06] <memaldi> db is created
[16:31:15] <memaldi> but without any tables
[17:06:10] <memaldi> I have switched to postgres in test-core.ini but the same happens
[17:19:21] <memaldi> So,
[17:19:33] <memaldi> def setup(self):
[17:19:33] <memaldi> helpers.reset_db()
[17:19:36] <memaldi> was missing
[17:19:39] <memaldi> :(
[20:27:36] <amercader> rossjones: are you going to berlin for csvconf? (or anybody else)

2016-04-18
[11:18:05] <travis-ci> aptivate/ckan override-feed-class a57848b https://travis-ci.org/aptivate/ckan/builds/123874088 Martin Burchell: The build has errored.
[17:05:00] <tktech> Sigh
[17:05:11] <tktech> Trying really hard to do this in a clever way with the existing structures.
[17:05:20] <tktech> Mayyyyy have to add a column to the activity table.
[18:37:47] <wardi_> tktech: go for it
[18:38:25] <wardi_> if it can default to null the migration is free!
[19:30:07] <tktech> It does, actually, since the duplicate events don't exist in earlier versions.
[19:30:15] <tktech> The current solution works 95% of the time
[19:30:24] <tktech> The only downside is the user activity page which shows duplicate events
[19:30:29] <tktech> Because it only filters on user_id
[19:30:41] <tktech> Which means you get the org-specific copy and the dataset-specific copy

2016-04-17

2016-04-16

2016-04-15
[15:16:56] * rossjones fetches some popcorn
[15:17:31] <wardi> altering enums is interesting. Does it get expensive when adding the 257th item?
[15:19:21] <tktech> Not really
[15:19:32] <wardi> I do like that idea. seems like a better way to be using postgres
[15:19:36] <tktech> It's a rare operation and you just table scanning a simple int column.
[15:19:48] <tktech> Even on an old HD you'd zoom through GB's worth of entries pretty quick
[15:19:51] <tktech> Which you're unlikely to have
[15:20:44] <tktech> Always append
[15:20:50] <wardi> it's a little surprising (we're not doing this now) having your database altered just by loading a new plugin
[15:21:13] <tktech> You want to do a ALTER TYPE _enum_ ADD VALUE `value` >>> AFTER <<< `last_value`
[15:21:16] <wardi> except where we're doing this terribly
[15:21:24] <tktech> Doing a BEFORE, now that's an expensive operation.
[15:21:41] <tktech> You're doing that anyways.
[15:21:53] <tktech> It's no different then you're "arbitrary" type strings.
[15:22:16] <tktech> Just more efficient, faster and more compact to index.
[15:22:32] <tktech> Especially for things like the activity_type strings.
[15:22:40] <tktech> They're treated in every way as an ENUM already.
[15:24:17] <wardi> we have a problem where loading some extensions that want to modify the DB causes a race. How about refusing to load if the type isn't found and adding a command to update the db instead
[15:25:54] <tktech> Definitely the better option. It really isn't something you're doing dynamically anyways.
[15:26:01] <tktech> And any plugin will be adding some silly overhead to implement that.
[15:26:09] <tktech> Like I've done in some of my plugins.
[15:26:16] <tktech> Where I check to see if the tables exist at configure time
[15:26:20] <wardi> I know we talked about this on an issue somewhere
[15:26:23] <tktech> Which 99.999999% of the time will be true
[15:26:31] <tktech> But I have to make that query every time anyways
[15:27:47] <tktech> I should merge ckanext-history into ckan core.
[15:28:21] <tktech> And the HVT extension that implements user_extras
[15:32:14] <wardi> hvt extension?
[15:32:57] <tktech> **HDX
[15:33:00] <tktech> https://data.hdx.rwlabs.org/
[15:33:12] <tktech> They implemented user_extras as an extension
[15:33:23] <tktech> Back in November
[15:33:49] <wardi> some recent migration discussion https://github.com/ckan/ideas-and-roadmap/issues/164
[15:34:09] <wardi> I'd love to have one command that would just "do all the extension migrations"
[15:34:24] <wardi> tktech: cool! I didn't know about that
[15:36:35] <tktech> https://github.com/OCHA-DAP/hdx-ckan/tree/dev/ckanext-hdx_user_extra
[15:37:12] <tktech> wardi, ^
[15:48:44] <rossjones> I think migrations PR for extensions mostly works.  Just needs checking and testing (somehow)
[15:49:46] <rossjones> And HDX said they would send a PR for user-stuff -> https://github.com/ckan/ckan/issues/2838
[15:50:45] <rossjones> Ah no, I remember, https://github.com/ckan/ckan/pull/2785 had some ugly code for forcing the extension to say where it's migrations are on disk
[15:52:03] <rossjones> Ugliness at https://github.com/ckan/ckan/pull/2785/files#diff-d182b6d22adb8be205b1a0d6b1f51a74R12 ... has to try and work around being in the wrong directly when you try and run the migrations.  There's most likely a much cleaner way
[15:53:12] <rossjones> tktech what is ckanext-history ?
[15:53:15] <tktech> There kinda is. Also that code won't work in a bunch of cases.
[15:53:27] <tktech> Like when distributed as a .zip
[15:56:04] <tktech> import pkg_resources
[15:56:04] <tktech> my_data = pkg_resources.resource_string(__name__, 'meep.sql')
[15:56:09] <tktech> rossjones, ^
[15:56:27] <rossjones> oh neat.
[15:56:30] <tktech> This works when the extension is distributed compressed as a zip, wheel, flat files, etc...
[15:56:59] <rossjones> so do you think enforcing convention (which we sort of have with the required folder layout) might make this easier?  We might not need the plugin at all.
[15:57:09] <tktech> For example the code as you have there, if I tried to wrap CKAN inside an .exe to run standalone on windows, it wouldn't be able to work.
[15:57:14] <tktech> Because there's no real file location.
[15:57:18] <rossjones> Why would you do that?!?
[15:57:20] <rossjones> j/k
[15:57:29] <tktech> Hah, just an example.
[15:57:35] <rossjones> Yeah, point taken.
[15:58:01] <tktech> rossjones, https://github.com/open-data/ckanext-history
[15:58:16] <tktech> It's the alternate history page we use on the NDM project extracted into a generic extension
[15:59:04] <tktech> I have other extensions on there.
[15:59:06] <tktech> Like https://github.com/open-data/ckanext-autodoc
[15:59:20] <tktech> Which is a mini-sphinx.
[15:59:35] <tktech> Generates live API documentation from the docstrings.
[15:59:51] <rossjones> ooh extendedactivity...
[15:59:59] <rossjones> Ah.
[16:00:05] <tktech> I haven't pushed that yet.
[16:00:07] <tktech> It'll be up today.
[16:00:19] <rossjones> Alright. Own up. Who wrote the scraper in C#?
[16:00:20] <tktech> Adds a couple new event types out of the box, like user joined an org.
[16:00:42] <rossjones> Would love for extensions generally to nominate things for activities.
[16:01:33] <tktech> That's what it does.
[16:01:37] <tktech> It's a plugin for plugins.
[16:01:50] <tktech> ckanext-canada uses it to extend the activity streams.
[16:01:55] <rossjones> you should call it ckanext-ckanext-extraactivities ;)
[16:02:00] <tktech> It's a terrible kludge.
[16:02:08] <tktech> But, it's a simple API.
[16:02:16] <tktech> So when CKAN is fixed, it can just be updated.
[16:02:30] <rossjones> Optimism. I like it.
[16:02:38] <rossjones> You know about https://github.com/ckan/ideas-and-roadmap/issues ?  Just in case you get bored :)
[16:02:57] <tktech> > 147 open
[16:03:14] <rossjones> And waiting to be claimed!
[16:09:44] <rossjones> Ekk, it's that time. Good weekend everyone. ttfn
[16:10:41] <tktech> Later.
[16:10:47] <tktech> wardi, https://github.com/ckan/ideas-and-roadmap/issues/41
[16:10:51] <tktech> Whatever happened with this?
[16:11:00] <tktech> Still unwilling to just purge revisioning?
[16:38:10] <wardi> tktech: I like being able to see what changed. If activites got better that could be a place to store that info. (when deciding when to drop activity history might as well drop the values changed as well)
[16:38:28] <wardi> I'm still all for a vdmectomy
[16:43:16] <wardi> tktech: oh, resource_string? we should be using that in scheming for the schema files
[16:48:36] <tktech> wut
[16:52:10] <wardi> tktech: which thing are you wuting?
[16:52:35] <tktech> resource_string
[16:52:44] <tktech> What was that in response too?
[16:53:23] <wardi> pkg_resources.resource_string as a way of getting the schemas, right now I'm doing terrible things with __path__ and __import__
[16:54:22] <tktech> I thought I fixed that
[16:55:25] <wardi> https://github.com/ckan/ckanext-scheming/blob/master/ckanext/scheming/plugins.py#L345-L360
[16:55:48] <tktech> welp
[16:55:51] <tktech> Meant to fix it.

[12:47:40] <rossjones> Does anyone know if Travis has a secret "ssh onto a box to fix your test setup" option?
[13:01:37] <LondonAppDev> Hey guys, I was wondering if anyone know of any trigger that I could use to run some code after a CKAN Harvest job finished? I want to email the harvest results to a contact.
[13:10:49] <Zharktas> harvester jobs are marked finished the next time harvester run is executed and there aren't anymore harvest objects left
[13:13:36] <Zharktas> so there isn't any interface to hook at
[13:17:27] <LondonAppDev> OK, thanks Zharktas.
[13:18:08] <LondonAppDev> What I think I'll do is override the 'run' command and slot my code into that.
[14:02:31] <rossjones> LondonAppDev  IDomainObjectNotification on HarvestJob ?
[14:07:23] <tktech> rossjones, Nah, it's one of circle.ci's main selling points.
[14:07:34] <tktech> Being able to ssh into the container, I mean.
[14:07:38] <LondonAppDev> rossjones: I searched the ckanext-harvest github repo for IDomainObjectNotification but it doens't appear to be there.
[14:07:56] <rossjones> tktech yeah I use semaphoreci for the same reason
[14:08:14] <rossjones> LondonAppDev that's a CKAN interface, which you can implement in your own plugin ...
[14:08:24] <LondonAppDev> Ahh I see
[14:08:30] <LondonAppDev> Alright, thank you.
[14:09:01] <rossjones> IDomainObjectModification not notification - sorry
[14:10:01] <rossjones> LondonAppDev I may be talking nonesense, let me check before I send you on a wild goose chase.
[14:10:23] <tktech> amercader, any other concerns regarding #2959? Going to start cleaning up the tests if you're fine with the process.
[14:11:18] <rossjones> LondonAppDev may only work for core models ...
[14:11:20] <amercader> tktech: no, sounds like a good plan
[14:11:43] <amercader> be aware that the activity tests are legendary messy
[14:11:54] <LondonAppDev> Hmmm OK. I think I'll leave it for now as this is my last day on this particular CKAN project and I have a couple other things I should finish off first. Thanks though.
[14:11:57] <tktech> Yeah, it looks like they're failing right now because they never worked.
[14:11:59] <amercader> to the point that I wonder if it's worth writing new ones
[14:12:18] <tktech> They only work currently because they're called in a certain order and aren't cleaning up after themselves.
[14:12:29] <tktech> They check to see if they worked just by counting the number of entries :|
[14:14:10] <tktech> wardi, can you assign https://github.com/ckan/ckan/issues/2438 to me unless you're working on it?
[14:14:19] <tktech> I have something for this already
[14:14:39] <wardi> tktech: gladly!
[14:18:29] <rossjones> LondonAppDev probably for the best, think I gave you bad info :( Bad Ross!
[14:21:23] <tktech> rossjones, wardi, https://github.com/ckan/ckan/issues/2438#issuecomment-210480475
[14:21:24] <tktech> Thoughts?
[14:21:45] <tktech> This is an approach that can be done immediately.
[14:23:39] <rossjones> tktech would point 2 be problematic as we have a global namespace for short-names, and we (DGU) currently allow admins to view ones marked as deleted. If I created another that passed validation, Package.read() would need to choose to show one over the other.
[14:24:31] <rossjones> Actually, maybe we should just NOT let people see deleted datasets, and follow the suggestion of /deleted/N
[14:27:57] <tktech> rossjones: Package.read() takes a UUID does it not?
[14:28:08] <tktech> A name collision shouldn't affect it at all?
[14:28:18] <rossjones> tktech id passed can be the guid or the short-name.
[14:29:16] <wardi> yeah, I like just not resolving deleted package names. /dataset/id is always available. it breaks clicking back and editing but that might not be a big deal
[14:29:32] <wardi> unless we always use the id in edit urls
[14:30:12] <wardi> maybe something we should be doing regardless, even if it's a bit ugly
[14:30:13] <rossjones> I can view the deleted packages in a slightly less "load all the things" trash ...
[14:30:52] <rossjones> wardi It isn't a link you're likely to share, so it might be better.
[14:30:58] <rossjones> Overall I am +1 :)
[14:31:27] <wardi> yeah, this has to be our most requested feature :-)
[14:31:32] <tktech> It seems like saner behaviour overall, since you might be able to change the name and hence the url.
[14:31:52] <tktech> I will include improving the trash page queries under this PR
[14:32:15] <tktech> s/able/about to/g
[14:32:35] <rossjones> tktech great, go for it!
[14:33:57] <tktech> My day will likely be filled with the activity changes and the ckanext-extendedactivity (custom activity events) extension work.
[14:34:13] <tktech> But Sunday should be a quiet day at the cottage, try to get this PR done for Monday.
[14:38:10] * rossjones goes to see which PRs he can secretly assign to tktech
[14:39:43] * tktech whacks rossjones with an ocean-leaping ruler
[14:40:04] <tktech> I try not to assign more than one or two at a time.
[14:40:21] <tktech> Or you end up with issues assigned for months when an outside contributor could be helping.
[14:40:30] <tktech> But decided not to because oh hey someone is assigned/working on it!
[14:41:39] * rossjones looks nonchalant and fidgety
[14:43:18] <wardi> tktech: we haven't been using assignments quite that way. We've been using it just to say some developer has offered to respond and track the issue, not necessarily fix it
[14:45:19] <wardi> And I've used them (like this one) as a convenient place to discuss potential fixes
[14:45:48] <wardi> I probably should have marked this good for contribution instead of assigning myself
[14:47:54] <rossjones> Starting to think marking some as GFC means people might thing the others aren't :(
[14:50:07] <LondonAppDev> So this is my last day on this CKAN project, so I just want to say a quick thank you everyone on this channel, particularly rossjones, shellac, yanik, wardi and amercader (as well any others who I can't remember the IRC names of) who have very generously offered so much support and advice on this channel during my 6 month CKAN project, it's very much appreciated.
[14:50:12] <LondonAppDev> I am leaving the UK for a few months, however when I'm back I'll have to come along to a CKAN London meet up and buy you guys a drink. I'll still keep logging into this IRC channel and I am sure this will not be the last time I use CKAN for a project! Thanks all!
[14:50:54] <rossjones> LondonAppDev Have a great trip! Let me know when you're back, I might have a lead on some more London based CKAN dev ;)
[14:51:26] <LondonAppDev> Thanks rossjones, sure I'll let you know. Should be back mid September.
[14:52:04] <wardi> LondonAppDev: happy to help. have a great trip.
[14:52:42] <LondonAppDev> Thanks wardi.
[14:53:39] <wardi> LondonAppDev: if you find yourself near http://opendatacon.org/ it would be great to meet you. we're trying to set up another CKANCon there
[14:56:51] <LondonAppDev> Oh cool, I'll note it down. Madrid is lovely!
[15:00:34] <rossjones> Ooh IODC. Is Madrid hot in October?
[15:01:00] <yanik> LondonAppDev, have a nice trip! :)
[15:01:57] <yanik> you guys all from London or what is the case? :D
[15:02:18] <tktech> LondonAppDev, Is the instance you were working on live/public?
[15:02:22] <tktech> Would love to see it.
[15:02:23] <amercader> LondonAppDev: have a nice trip!
[15:02:56] <tktech> Column('type', types.UnicodeText, default=u'dataset'),
[15:02:58] <tktech> Grrrr
[15:03:04] <tktech> ENUMS! USE ENUMS!
[15:03:11] <wardi> tktech: why?
[15:03:50] <tktech> 1 byte * N datasets vs 7 bytes * N datasets, made worse by versioning, replication in changesets, caches, indexes, solr....
[15:03:54] <tktech> Things add up.
[15:04:00] <wardi> plugins can define any types they like
[15:04:29] <tktech> It's postgres, just ALTER the ENUM.
[15:05:19] <tktech> https://github.com/ckan/ckan/blob/master/ckan/lib/activity_streams.py#L137
[15:05:41] <tktech> Same for activity events. It's 20 bytes versus one.
[15:06:23] <tktech> And activity events have a UUID for some reason instead of a simple incremental ID.
[15:06:35] * rossjones makes a mental note of pet peeve for future reference
[15:06:55] <rossjones> yanik  as far as I know, only LondonAppDev
[15:07:02] <wardi> UUIDs are nice for apis that are addressing things, and they can be created without help from the db (you know it before you commit)
[15:07:32] <tktech> Not sure what you mean by that.
[15:07:34] <wardi> I suspect both these things are in the noise as far as performance or wasted space are concerned
[15:07:49] <tktech> The IDs are identical to a UUID so far as an API is concerned.
[15:08:23] <yanik> I wish I live in London, but will relocate to Prague soon ;)
[15:09:14] <tktech> Prague is an amazingly lovely city.
[15:09:18] <tktech> Hope you enjoy it.
[15:09:30] <wardi> I just mean that an activity uuid will never accidentally collide with one in another ckan instance, unless you dumped and restored the db. That *can* be a nice property at times.  It's not an especially strong argument, I admit :-)
[15:09:44] * wardi loved Prague
[15:10:12] <tktech> If you were in right now I'd walk over and give you a stern frowny face for that argument,
[15:10:45] * wardi hides behind his "we have bigger fish to fry" argument instead
[15:10:54] <tktech> Not in 2008 you didn't!

2016-04-14
[17:52:02] <rossjones> wardi did dread make the meeting?

[10:05:33] <LondonAppDev> Hey guys, "ckan.extra_resource_fields" should make the field fully searchable in the CKAN search right?
[10:06:07] <LondonAppDev> so if my resource extra field is called "abacus" I should be able to filter packages by "abacus:Something" in the search right?
[10:09:50] <amercader> LondonAppDev: all extras are indexed regardless of being in`ckan.extra_resource_field`
[10:10:18] <LondonAppDev> amercader: oh so the extra_resource_field is obsolete?
[10:10:48] <amercader> yes
[10:11:04] <amercader> what do you want to search on a dataset extra or a resource extra?
[10:11:18] <LondonAppDev> On all resources I have a new extra field "http_access_status", the value for most is "Available". When I search "http_access_status:Available" it doesn't return anything.
[10:11:25] <LondonAppDev> I want to search on a resource extra.
[10:11:39] <LondonAppDev> So it's basically a field that says if the resource is HTTP 202 or not
[10:11:53] <amercader> for resource extras you need to do `res_extra_http_access_status:Available`
[10:12:02] <LondonAppDev> So I want to be able to filter only datasets that have resources with http_access_status:Available
[10:12:07] <LondonAppDev> Ohhhhh I didn't know that... Let me try this.
[10:12:42] <LondonAppDev> Hmmm that didn't work either.
[10:13:22] <amercader> LondonAppDev: what ckan version are you using?
[10:13:30] <LondonAppDev> 2.5.1
[10:14:04] <LondonAppDev> I also re-built the search index after I added the http_access_status to the resource field.
[10:14:31] <amercader> LondonAppDev: first of all upgrade to 2.5.2 :)
[10:14:42] <LondonAppDev> Ah ok, will that fix it?
[10:14:56] <amercader> no, but you should run the latest patch release
[10:15:02] <LondonAppDev> Ah ok I will install that,.
[10:15:07] <amercader> no worries
[10:15:09] <amercader> you can do `paster search-index show dataset_name`
[10:15:18] <amercader> to see what is actually indexed in Solr
[10:15:51] <LondonAppDev> OK I'll give that a shot, thanks amercader.
[10:15:55] <LondonAppDev> I've gotta head to a meeting now.
[10:15:59] <LondonAppDev> Appreciate the help.
[10:16:21] <amercader> let me know if that helps
[10:35:57] <rossjones> Oh travis. Why do you break so often :(
[12:18:16] <LondonAppDev> amercader: I checked the index like you said, it appears to be storing it as a list.
[12:18:19] <LondonAppDev> https://gist.github.com/LondonAppDev/33ba2490463988396d13942d4aba1b74
[12:18:26] <LondonAppDev> "'res_extras_http_access_status': ['Available'],"
[12:19:11] <LondonAppDev> Strange... Wonder why it is doing that.
[12:19:11] <LondonAppDev> :S
[12:20:07] <Zharktas> there can be multiple resources
[12:20:24] <Zharktas> each value is stored in its list
[12:33:06] <amercader> LondonAppDev: that is fine, the `res_extra_*` field is multiValued
[12:33:20] <amercader> how does your query look like?
[12:34:03] <LondonAppDev> My solr query?
[12:34:20] <LondonAppDev> This works: "res_extras_http_access_status:"['Available']"
[12:34:25] <LondonAppDev> But not sure why it's multi valued
[12:34:28] <LondonAppDev> Should just be a string
[12:34:37] <LondonAppDev> when I do resource patch I assign a string.
[12:35:19] <amercader> where are you doing this search, are you using pacakge_search?
[12:35:35] <LondonAppDev> In the CKAN search
[12:35:43] <LondonAppDev> Search Datasets
[12:35:50] <LondonAppDev> so http://staging.ckan.data.alpha.jisc.ac.uk/dataset
[12:35:54] <LondonAppDev> (but locally)
[12:36:27] <LondonAppDev> Because I've not pushed the new Resource field to that server yet... but it's when you type a search into the dataset search, I think it uses package_search.
[12:41:13] <amercader> LondonAppDev: does it work if you query the API directly? eg /api/action/package_search?q=res_extras_http_access_status:"Available"
[12:41:33] <LondonAppDev> No it says no results.
[12:44:49] <amercader> weird, I'll need to do some tests locally
[12:45:26] <amercader> eg the resource format is also stored as a list and that doesn't cause issues
[12:45:27] <LondonAppDev> Actaulyl sorry
[12:45:28] <LondonAppDev> it does work
[12:45:48] <LondonAppDev> I was checking the wrong server.
[12:46:13] <amercader> haha, cool
[12:50:16] <LondonAppDev> amercader: thanks a lot appreciate the help.
[12:50:25] <amercader> no bother
[13:43:38] <wardi> oh. I didn't know about search-index show. I always browse to the solr interface. that could be handy
[14:04:11] <wardi> rossjones: would you ping dread to see if he'll come to the meeting?
[14:04:25] <wardi> tktech: can you join us as well to talk about your pr?
[14:11:10] <rossjones> wardi sorry was out at a meeting and I've come back and he has disappeared!

2016-04-13
[21:24:23] <tktech> https://github.com/ckan/ckan/pull/2959
[21:24:29] <tktech> More too do, but that is usable now.
[21:24:37] <tktech> Activity streams are actually usable.
[21:26:13] <tktech> Having a few thousand packages in an org won't cause all your activity tabs to query every dataset, pulling it back entirely, JOIN 3x on each, merge with the Member tables, and then issue an IN statement that would require an entire tree to print.
[21:27:41] <tktech> This is the "stage one" acceptable for backporting and currently using.
[21:27:53] <tktech> "Stage two" will completely purge all existing activity logic.

[08:10:11] <LondonAppDev> wardi: thanks for your reply (apologies for late reply, just saw this).
[08:10:36] <LondonAppDev> So is it best to work directly with the database models to create the extra fields? I have an extra field I want to create or update for each dataset.
[08:13:04] <LondonAppDev> I think I'll try and use "package_extras_save()" in ckan.lib.dictization.model_save.
[08:30:13] <rossjones> LondonAppDev are you trying to avoid calling package_update?
[08:36:06] <LondonAppDev> rossjones: kinda. I need to go through all my packages so wanted to do it directly using sqlalchemy for speed.
[08:55:36] <rossjones> Ah I see. This is something we do a LOT of.  How about using LocalCKAN in ckanapi ?
[10:04:07] <rossjones> Eeek what happened to ckan.org ?
[10:13:41] <amercader> rossjones: nigelb already on it
[10:24:55] <rossjones> amercader Cool, I like the new design (as much as I can see of it)
[10:25:54] <amercader> lol that's not a new design, is the default wordpress one. I think the "old" one is back again
[10:27:20] <rossjones> Boo and yay.
[10:28:01] <rossjones> How do we log bugs/PRs against it, is there a repo?
[10:31:48] <amercader> I'm not sure tbh
[10:32:28] <amercader> nigelb do you know it ? ^
[10:36:44] <nigelb> It's complicated.
[10:36:54] <nigelb> The theme we use for ckan.org is wordpress-theme-okfn
[10:37:05] <nigelb> But that's actually deprecated.
[10:37:22] <nigelb> So we'll have to get someone to rip out the ckan bits of it into another theme without buddypress features, etc.
[10:37:58] <rossjones> I did lots of work to turn it into a 'slightly broken' jekyll site ages ago, but got vetoed because "some people prefer wordpress" :(
[10:40:55] <nigelb> rossjones: I thought amercader wanted to switch to jekyll recently?
[10:42:21] <amercader> I don't care about the platform as long as the content is relevant and up to date
[10:42:31] <rossjones> and easily changeable ;)
[10:43:01] <rossjones> If I want to suggest removing OK privacy policy at the bottom, I cant' send a PR :(
[10:43:23] <rossjones> but no big deal, bigger things to worry about I guess :)
[10:50:37] <nigelb> rossjones: That's part of the theme I think.
[10:50:51] <nigelb> Or something you can edit from wordpress backend.
[10:50:58] <nigelb> Right now, I hate wordpress quite a bit.
[10:51:07] <nigelb> Because I have to fix a ton of sites across the network.
[10:57:26] <rossjones> :D
[10:57:39] <rossjones> nigelb Don't they auto-update?
[11:01:17] <nigelb> rossjones: We don't do that because of possible complications.
[11:01:24] <nigelb> One such complication has arose.
[11:01:37] <rossjones> Yeah, I forgot the ;) at the end of that line
[15:44:27] <corebits> Well its good to finally be back home, but I think I have vacation brain still :)
[15:45:47] <corebits> Trying to add some if statements to my templates to hide Social links on admin pages etc. http://pastebin.com/fT2KzKBu
[15:46:19] <corebits> Am I going about this the wrong way, because I am getting the exact opposite of what I want.
[15:48:38] <rossjones> Hey corebits home at last! How was the rest of the trip?
[15:49:57] <s0x> hey guys, is there a way to use an authorization mechanism for ckan rest api calls other then api key. In particular I wanna build a service which should use oauth2 to publish data on behalf of the user
[15:50:37] <rossjones> corebits looks okay to me, but then I didn't realise those vars were available in the templates.
[15:51:29] <corebits> rossjones: pretty great, we had a great time. I even rented a car to drive on wrong side of the road haha
[15:51:46] <rossjones> As long as you didn't crash it :)
[15:52:05] <corebits> Just nudged a couple curbs ;)
[15:53:57] <rossjones> Yeah I'm okay on straight roads in Europe, it's just the junctions and roundabouts I struggle with
[15:54:57] <corebits> I actually liked the roundabouts, so much better than the traffic lights and waiting we do here ;)
[15:55:19] <rossjones> :)
[15:56:37] <corebits> So if I change my action == "index" to action != "index" It renders the "No Social links are allowed" on the /ckan-admin
[15:56:58] <rossjones> What is {{ action }} ?
[15:57:03] <rossjones> It may surprise you.
[15:57:56] <corebits> According to the debug template, when loading /ckan-admin it is controller = admin and action = index
[15:59:49] <corebits> Maybe I am just going about this all wrong. My end goal is to not render my Social links on certain pages, such as under /ckan-admin or package edit, resource edit/new etc
[16:01:15] <rossjones> corebits sounds like you just want them on package/read and organization/read ;)
[16:04:18] <corebits> ya and package/search possibly a few others
[17:03:47] <corebits> ahhh, I needed to use c.controller and c.action

2016-04-12
[13:40:02] <rossjones> wardi +1 if it still counts ;)
[15:15:18] <LondonAppDev> Hey guys, is there an api request for setting an extra field?
[15:15:20] <LondonAppDev> on a package
[16:58:30] <wardi> rossjones: absolutely
[17:00:00] <wardi> LondonAppDev: there's package_patch but it won't work well eith free-form extrs
[20:20:48] <jareds_h3> hello, does anybody know if there are any ckan webinars in the future or if there's a schedule for such events?
[21:31:17] <tktech> jareds_h3, Not sure what you mean, are you looking for a specific topic?
[21:33:18] <jareds_h3> i was just wondering if there were any planned future events, any sort of topic on ckan
[21:55:24] <tktech> Nothing that I know of off the top of my head, haven't seen anything mentioned.
[22:04:30] <jareds_h3> alright, thanks anyways, i put a post up on the Ckan global user group on google as well https://groups.google.com/forum/?pli=1#!topic/ckan-global-user-group/vupA2Gma12U
[22:07:59] <tktech> There's a google group?
[22:13:15] <jareds_h3> Yup, i found it linked on the ckan support page, i guess used for more general discussions, there are some recent posts up too, but i dont know how often people view it

2016-04-11
[08:25:12] <rossjones> tktech you can contact someone working on data.gov.uk here <---
[08:59:07] <yanik> http://docs.ckan.org/en/latest/maintaining/email-notifications.html is here '/api/action/send_email_notifications' is actually url call ?
[09:01:27] <amercader> yanik: yes, it's here: https://github.com/ckan/ckan/blob/master/ckan/logic/action/update.py#L989
[09:14:40] <yanik> amercader, by this logic API login credentials should be included, but they missed in docs. Basically you saying that anyone can call this action?
[09:16:49] <yanik> amercader, also does this api call required for basic emails, like registration emaul and password reset ?
[09:16:57] <yanik> email*
[09:17:46] <amercader> yanik: I'm not familiar with this action, I just grepped the code :)
[09:17:54] <amercader> I'm not sure about 1)
[09:18:00] <amercader> For 2) the answer is no
[09:18:17] <yanik> amercader, thx god, and thx you ;)
[09:18:32] <yanik> 2) 1) :)
[13:39:44] <tktech> amercader, That's what it should be like by default
[13:40:00] <tktech> All: Any objections to making database-backed sessions the default? I will send a PR.
[13:40:19] <tktech> We should also upgrade beaker while we're at it since that fixes the file lock reuse bug
[14:47:43] <tktech> I can't tell if there are no objections, or the other side of the world is asleep :)
[14:48:27] <wardi> Sounds good to me
[16:52:20] <rossjones> Sounds terrible to me, but I guess anything is better than disk.

2016-04-10

2016-04-09

2016-04-08
[13:37:37] <knud> Hi. CKAN is complaining that it can't read a file: [Errno 13] Permission denied: '/tmp/default/sessions/container_file_lock/4/41/41e6014051d0827982abaf07d426cb700ce1846a.lock'
[13:38:20] <knud> So I wonder if someone could give me a pointer as to what that file is and how I can deal with it.
[13:39:16] <knud> Also, each time I send a request to CKAN, it tries to open a different container_file_lock
[13:53:47] <LondonAppDev> Does anyone know if there is an extension that allows you to download your search results as a CSV/JSON format?
[14:19:14] <wardi> LondonAppDev: you can use the package_search API
[14:21:03] <LondonAppDev> Sweet, cheers wardi,
[15:49:43] <tktech> Boo, knud left.
[15:50:05] <tktech> That's a pylons session lock and is a bit of a problem
[15:59:47] <wardi> chmod 777 all the things!
[16:08:10] <tktech> Not even, it shouldn't exist
[16:08:30] <tktech> pylons is creating on-disk sessions for everyone visiting the site
[16:14:28] <wardi> I take it these are unnecessary?
[16:15:42] <tktech> Completely, yes
[16:16:27] <tktech> Sessions for logged in users should be in the database as well, otherwise there will be mismatches based on load balancing.
[16:16:38] <tktech> Not that there is currently anything in the sessions so far as I can tell.
[16:18:57] <wardi> if there is nothing in our sessions using itsdangerous or similar would be better than storing sessions in the db
[16:25:34] <tktech> *if*
[16:25:49] <tktech> I haven't confirmed it yet.
[16:26:06] <tktech> Also, properly HMAC signed identies in the cookies should be used anyways :|
[16:26:15] <tktech> If I go take a look at them they better not just be unsigned user IDs
[16:26:16] <wardi> I wonder about flash messages
[16:26:31] <tktech> Flash messages would use the session if they're done right.
[16:30:20] <tktech> wardi, Know how to contact anyone working on http://open-data.europa.eu/en/data/ and data.gov.uk?
[16:30:28] <tktech> Typos and dead links
[21:32:05] <amercader> tktech, wardi: last deployments I set up we store the sessions on the db: https://gist.github.com/amercader/5741a51c97790f534909e18476112fcb
[21:32:17] <amercader> afaict these are only used for flash messages

2016-04-07
[12:47:31] <memaldi> Hi all
[12:47:39] <memaldi> Is there any way to override owner_org_validator?
[12:47:56] <wardi> memaldi: yes. IDatasetForm
[12:48:18] <wardi> there are some settings that affect it as well
[12:49:32] <memaldi> Do you mean through validate(context, data_dict, schema, action)?
[12:50:48] <wardi> either that or the create/update_package_schema methods
[12:51:02] <memaldi> OK, I will check
[12:51:07] <memaldi> Thank you very much!
[12:51:17] <wardi> validate is a large hammer. you can change every aspect of validation with that one
[12:51:36] <wardi> memaldi: what sort of change are you making?
[12:52:29] <memaldi> well, we have an external service for managing users, and for avoiding including all these users into the different organizations, I want to allow users creating datasets in any organization
[12:53:00] <wardi> what version of ckan?
[12:53:04] <memaldi> Although they are not part of these organizations
[12:53:07] <memaldi> 2.4.1
[12:53:55] <wardi> there were some recent changes that moved the auth-shaped things that validator was doing into a proper auth function
[12:54:43] <memaldi> It's nice to hear that :D
[12:55:34] <wardi> yes, you won't be able to do that with just the validator on ckan 2.4
[12:55:54] <wardi> you'll have to use IAuthFunctions instead
[12:57:38] <memaldi> OK, I will try
[12:58:27] <wardi> by recent I mean 2 years ago.. wow, time flies
[13:32:36] <memaldi> It worked @wardi, it was easier than expected :D
[13:32:41] <memaldi> Thank you!
[14:00:44] <wardi> amercader, brook_: meeting?
[16:37:32] <vnz> anyone here?
[17:06:59] <wardi> vnz: it's better to ask your actual question

2016-04-06

2016-04-05
[12:00:27] <wardi> amercader: meeting?
[12:00:38] <amercader> coming!
[15:02:12] <nocnoc> hii
[15:02:19] <nocnoc> i'm having problems with datapusher
[15:02:34] <nocnoc> i'm trying to get it work on ubuntu 14.04
[15:02:45] <nocnoc> but i get Internal Server Error

2016-04-04
[03:41:34] <vnz> anyone here?
[08:06:00] <yanik> does ckan using celery to send email?
[08:32:08] <rossjones> yanik I seem to recall it was a cronjob that called the API.
[08:32:37] <rossjones> At least for notifications -> http://docs.ckan.org/en/latest/maintaining/email-notifications.html
[08:32:54] <yanik> great, so it's not blocking one
[08:35:22] <rossjones> Ah well, I think the user create and reset and so forth may be done in the controller :(
[08:35:30] <rossjones> https://github.com/ckan/ckan/blob/c041bbf0978bc430bc9a750290156e03c2bce1a1/ckan/controllers/user.py#L470
[08:36:43] <yanik> not good, but what you gonna do :)
[08:38:33] <rossjones> yanik did start on implementing rq to simplify the running of background tasks, but I don't think I'll get a chance to finish it ... if you were looking for something to do ;)
[08:45:37] <yanik> rossjones, if I will have no task i definitely will look on adding some queues
[08:46:31] <yanik> current code completely blocks 1 worker, if I'm not mistaken
[08:46:53] <rossjones> yanik I started at https://github.com/ckan/ckan/pull/2706 no need to use it, but some thoughts in the comment there.
[08:47:12] <yanik> rossjones, ok, thx
[08:47:37] <yanik> rossjones, but can't promise anything
[08:48:12] <rossjones> yanik that's alright, I figure some of this stuff will cause *someone* so much pain they'll fix it ;)
[16:04:44] <nocnoc> Hello!
[16:05:04] <nocnoc> I'm following this guide, to install ckan on redhat
[16:05:08] <nocnoc> https://github.com/okfn/ckan-barnet/wiki/How-to-install-CKAN-2.0-on-CentOS-7
[16:05:24] <nocnoc> with centos 7 repos
[16:05:59] <nocnoc> but when I try to initialize db i get an :
[16:06:01] <nocnoc> sqlalchemy.exc.OperationalError: (OperationalError) FATAL:  password authentication failed for user "ckan_default"
[16:16:41] <wardi> sounds like the password for the ckan_default user wasn't accepted by postgres. Maybe the password entered in the CKAN ini was incorrect, or the postgres user wasn't set up correctlr?
[16:28:36] <wardi> or postgres' pg_hba file wasn't modified to expect passwords, or it was but postgres wasn't restarted yet
[17:48:27] <nocnoc> wardi: the password was added in both places
[17:48:43] <nocnoc> Is there a Docker or an ova with a working ckan?
[17:48:46] <wardi> nocnoc: try using psql to connect to the db with that user
[17:49:18] <nocnoc> I've have to do a presentation of this soft to the team and see if we want to use it
[17:54:47] <wardi> pretty sure you can find VM images if you look. This is more of channel for supporting CKAN development than deployment, though. Maybe there is some help/advice on stack overflow or one of the other support options?
[17:58:12] <wardi> if you're willing to tell me what connecting with psql tells you I can try to help further
[18:00:43] <nocnoc> wardi: give a second
[18:01:52] <nocnoc> -bash-4.2$ psql -d ckan_default -U ckan_default
[18:01:54] <nocnoc> Password for user ckan_default:
[18:01:56] <nocnoc> psql: FATAL:  password authentication failed for user "ckan_default"
[18:02:04] <nocnoc> bu i've changes this password before
[18:02:09] <nocnoc> *but
[18:02:38] <nocnoc> ALTER USER ckan_default WITH PASSWORD 'PASS';
[18:02:42] <wardi> did you set up postgres' pg_hba configuration file to accept password auth?
[18:03:09] <nocnoc> is there a "save" command or somethinfg?
[18:10:23] <wardi> no that should do it.

2016-04-03

2016-04-02

2016-04-01
[08:45:41] <knud> Hello. Given a user, what's the best way to figure out then organization they are a member of?
[08:46:05] <knud> I have a working SQL query, but maybe there is a better way?
[08:49:29] <amercader> knud: organization_list_for_user is the action you should use: http://docs.ckan.org/en/latest/api/index.html#ckan.logic.action.get.organization_list_for_user
[08:50:01] <amercader> but note that due to a bug it will currently only return the orgs that the user is admin of, not editor or member: https://github.com/ckan/ckan/pull/2457
[08:50:57] <amercader> I need to add tests there to get it properly merged, if someone wants to help feel free to jump in
[08:52:46] <knud> amercader: thanks! How did I not see that in the docs ?
[12:46:05] <wardi> amercader: the tracking details on ckan <= 2.4 in solr used to get stale, unless users reindexed regularly
[12:47:12] <wardi> "hot" datasets is a useful feature though
[12:47:58] <wardi> How about a parameter on package_search to add the latest tracking details to its results? Shouldn't be an expensive query
[12:55:48] <amercader> wardi: the tracking docs do say that you need to reindex hourly via the cron job, but yes most users probably forget
[12:57:31] <amercader> adding them afterwards sounds good but it could add up if there are a lot of results
[13:00:31] <wardi> it would just do the current page of results, no?
[13:01:20] <wardi> or we could go back to storing the tracking results in solr. I am planning to revert 1105 since it's not actually helping most users
[13:01:44] <amercader> yeah, I mean for API calls with `&rows=100`
[13:03:00] <wardi> I'm on the fence. it's data about views of the record so it feels like it shouldn't be part of the record itself
[13:03:47] <wardi> I might be over-thinking it :-)
[13:05:09] <wardi> re-indexing regularly should be listed as a best-practice in the docs because of the other data (e.g. org names) that doesn't get updated otherwise
[13:07:38] <wardi> amercader: what do you think? Should I just put the tracking info back in solr? usefulness should trump purity, right?
[13:09:23] <amercader> sorry, I'm having a little psql panic, back in a sec
[16:22:22] <LaurentGoderre> Hey,, I have a question about tests
[16:24:46] <LaurentGoderre> It's about the ckan.root_path settings. If you have both the root_path set in your ini and somehow have that path in the SCRIPT_NAME server variable, the url_for helper uses both, creating an invalid URL
[16:25:15] <LaurentGoderre> I found a fix to ensure that CKAN uses the root_path instead of the SCRIPT_NAME for generating scripts.
[16:25:49] <LaurentGoderre> However, I am unable to create a test to demonstrate that

2016-03-31
[08:45:09] <rossjones> Yes, wardi that would be lovely, or even just having GroupExtra eager loaded would help :)
[12:01:13] <amercader> wardi: I think you've been playing with parallelization on circleci, I'm not sure if this is related but I'm finding this issue where tests are not run, even though Circle says they passed: https://circleci.com/gh/ckan/ckan/1154
[12:02:18] <amercader> on one of the containers the mocha install failed so it seems like that prevents the test run from finishing on the other containers? eg the next steps are database and tests
[12:02:21] <wardi> amercader: yes, that was me.
[12:03:26] <wardi> huh. well, I have a hack that should help the mocha install in my test-faster pr. No idea why this is showing as a passed test, though
[12:04:22] <wardi> https://github.com/ckan/ckan/pull/2933/commits/7c0f149d85
[12:05:49] <wardi> This seems like a circleci bug. We could move the mocha install to the pre or override dependencies section and see if that makes a difference
[12:06:23] <amercader> yes, wherever it can be cached like the rest of the requirements
[12:06:30] <amercader> it crashes constantly
[12:06:51] <wardi> yes. yes it does
[12:06:56] <amercader> maybe it's a problem with the versions
[12:07:38] <amercader> anyway, with the 4x thing you need to be 4 times luckier to get your tests passing, which is worse than travis was :)
[12:08:23] <amercader> I thought the point of containers was to isolate things, so I can't see why tests should stop on the other ones
[12:09:27] <wardi> should I try moving the npm install as part of 2933 or a separate PR?
[12:10:30] <amercader> whatever is easier, if it works I'll cherrypick to 2.5.x
[12:10:41] <amercader> which is where I'm struggling to get the tests passing now
[12:11:04] <wardi> I wish the parallel setting was in the circle.yml :-/
[12:19:14] <wardi> oh, looks like specifying our directories to cache might help
[12:34:55] <wardi> my while loop is't helping. sometime npm refuses to install mochajs even when I try 5 times
[12:35:07] <wardi> there must be a better way
[14:01:26] <wardi> rossjones, tktech, amercader: meeting?
[14:01:52] <amercader> coming, just finishing announce the new patch releases
[18:01:48] <rossjones> wardi don't think I'll be making meetings any more :(
[18:03:15] <wardi> rossjones: I'm sad to head that. dread too?
[18:03:35] <rossjones> I expect dread'll still be working on CKAN for a while. Not sure how long that is though.
[18:04:00] <rossjones> Depends mostly on results of user-research
[18:05:43] <rossjones> I'm knee deep in interviews. so taking some time off to get prepared for the pair-programming 8|
[18:08:21] <wardi> yikes
[18:10:00] <rossjones> One of them is a total of 10 hours!
[18:11:05] <wardi> I'm terrible at interviews. I've never gotten a job I interviewed for
[18:28:26] <rossjones> It's a big jump for me, to something I don't have experience with, so extra-terrifying.
[18:34:12] <rossjones> wardi plus they're all remote :|
[18:34:29] <wardi> you don't like working remote?
[18:34:38] <rossjones> I do, but interviewing remotely is hard.

2016-03-30
[11:39:33] <rossjones> VDM. I hates it.
[11:46:12] <rossjones> Trying to do a query.options(joinedload('extras')).filter.... and get 'OurAssociationProxy' object has no attribute 'property'
[11:46:17] <rossjones> anyone seen that before?
[18:00:11] <wardi> ro
[18:00:42] <wardi> rossjones: wouldn't it be nice if our extras were a json/jsonb field instead of a separate table?
[18:01:22] <wardi> or hstore even

2016-03-29
[04:28:17] <nigelb> wardi / rossjones / amercader - https://github.com/ckan/ckan/wiki/SSL (I've done a braindump of SSL stuff. Please feel free to jump in and make it better!)
[04:28:35] <nigelb> I've targetted Apache 2.2 and not 2.4. We may need to have info for that as well out there.
[04:29:05] <nigelb> Additionally, it might be a good idea to have instructions for using letsencrypt with CKAN. I'm not sure, it's a call that our users make.
[11:08:58] <amercader> wardi, rossjones, tktech any one up for a meeting? https://pad.okfn.org/p/ckan-meeting
[11:10:43] <amercader> Actually there are no new PRs or issues so unless someone wants to discuss something we can postpone it
[11:45:01] <wardi> isn't meeting in 15?
[11:46:39] <amercader> it's Tuesday today AFAICT :)
[11:46:59] <wardi> I don't have anything specific to discuss. We do get people showing up occasionally though
[11:47:13] <wardi> right, I meant the meeting is in 15 minutes
[11:47:20] <amercader> I stayed for 30 min, nobody turned up
[11:47:29] <amercader> oh
[11:47:41] <amercader> yeah, daylight saving time
[11:47:45] <amercader> damn
[11:48:01] <amercader> we changed our clocks this weekend
[11:49:29] <wardi> I set my google calendar event for Accra time (no DST)
[11:50:14] <amercader> nice
[11:50:19] <amercader> will try this
[11:51:13] <wardi> maybe we can figure out how to stick that in an ical link on the pad
[12:00:33] <amercader> wardi: I *think* I did this right, I pasted the links in the pad
[12:01:10] <wardi> does that ...&ctz=Europe/London link work? it seems like it must be wrong
[12:02:17] <amercader> for me it shows the right time, now and in October which is when we change time again
[12:37:39] <amercader> thanks for the SSL stuff nigelb
[12:41:45] <nigelb> :)
[12:41:48] <nigelb> Lots more to do!
[12:41:55] <nigelb> If I get more time, I'll do more this weekend.
[12:46:39] <wardi> yes! and thanks for the 401->403 status code merge. We've been doing that wrong for a long time
[12:51:49] <nigelb> amercader: Universal way to get UTC time is to select Iceland as your timezone.
[12:52:14] <nigelb> wardi: sorry about causing it to bitrot!
[12:53:19] <wardi> no big deal. one of the tests I needed to update had a bug in it anyway
[22:33:05] <pablohn6> Hi there
[22:33:14] <pablohn6> is somebody here?
[23:35:21] <wardi> pablohn6: it's usually better to ask your actual question
[23:35:51] <pablohn6> wardi, thanks for the advise
[23:36:16] <pablohn6> I would like to know a list of cities that are using ckan
[23:37:01] <wardi> you found http://ckan.org/instances/# ?
[23:37:41] <wardi> not an exhaustive list, but a good place to start
[23:38:30] <pablohn6> yes, I think so
[23:41:01] <pablohn6> thanks wardi :)
[23:41:14] <pablohn6> I get what I want
[23:41:31] <pablohn6> good luck with this amazing proyect
[23:41:45] <pablohn6> project*
[23:41:48] <pablohn6> bye

2016-03-28

2016-03-27

2016-03-26

2016-03-25

2016-03-24
[09:20:08] <yanik> this is looks like problem with apache2 config?
[09:20:08] <yanik> https://github.com/okfn/ckanext-s3filestore/issues/9
[09:20:17] <yanik> 'Exception occurred processing WSGI script '/etc/ckan/default/apache.wsgi'.'
[13:23:12] <wardi> yanik: try running `python /etc/ckan/default/apache.wsgi` to see what the error is
[13:24:01] <wardi> oh, sorry, this is on a specific request
[13:27:17] <yanik> wardi, yeah ;/
[13:28:27] <yanik> and figuring out where the problem is tricky
[13:28:40] <wardi> You should be able to get the whole traceback with the right logging options
[14:01:10] <wardi> dev meeting, anyone? https://pad.okfn.org/p/ckan-meeting
[14:02:29] <wardi> tktech ^
[14:48:22] <rossjones> Did I miss the meeting?
[14:48:30] <rossjones> Also the pad url doesn't work for me in Chrome :(
[14:49:26] <wardi> rossjones: yes, it was a pretty quick one. Do you have time to attend meetings again?
[14:50:05] <rossjones> No, not really, but David might for a couple more months.
[14:51:40] <rossjones> wardi I'll ask him if he can make time to attend
[14:51:41] <wardi> ok, so for upcoming meetings can I ping you on IRC to ping David? :-)
[14:52:18] <rossjones> You can, if I'm on IRC, the whole world seems to be moving to Slack :(
[14:52:46] <wardi> I know.. into the little walled gardens
[14:53:42] <rossjones> :( On the plus-side corebits promised me some PR reviews when I met him the other week, and Ben at http://data.nhm.ac.uk/ promised some dev time. Which reminds me, I should chase him by mail.
[15:41:23] <rossjones> chasing complete.  What I actually wanted to come to the meeting for, was to ask if I could add optional spam-checking to ckanext-issues - would it get merged (assuming tests+works etc). Want to avoid working off a fork
[15:44:02] <wardi> rossjones: aren't you one of the maintainers?
[15:44:14] <rossjones> Well.
[15:44:52] <rossjones> Think it should still be reviewed, and don't want to push features that might not be wanted.
[15:45:35] <wardi> then you're holding yourself to a higher standard than I do for ckanapi and ckanext-scheming :-)
[15:45:57] <wardi> what's the argument against optional spam filtering?
[15:46:07] <wardi> does it send things off to a third party service?
[15:46:26] <rossjones> Yes. Probably akismet.
[15:46:59] <rossjones> Was sort of hoping someone would talk me out of it ;) Or point at a ckanext-nospam that someone had secretly just finished that implemented moderation queues and so on.
[15:49:18] <wardi> oh, you think it could be done in a reusable way. That's a good idea, no idea how much more work that would be, though
[15:49:32] <rossjones> Almost certainly more than I have time for :(
[15:50:20] <wardi> I'd say build it in.  It can always be factored out later when someone cares enough
[15:53:15] <rossjones> This is true.  Will see how far I get over the weekend :)
[15:53:27] <rossjones> Making it optional should be easy enough
[16:26:56] <yanik> hah, i run with same settings but via paster (as root) and now resources are acceptable
[16:27:13] <yanik> any suggestions?
[16:28:01] <yanik> maybe I need root to access files, and apache is not one  ?
[16:29:02] <yanik> running paster with ubuntu user return me "OSError: [Errno 13] Permission denied: '/tmp/default/sessions/container_file_lock/b/b2/b2f20a4004c922aeec38e8b0007c1bba46470a34.lock'"
[16:36:06] <yanik> sure, its permission problem.. looks like apache2 user have no permission for /tmp/default/sessions/ folder
[17:02:21] <tktech> amercader, https://github.com/ckan/ckan/commit/83b963cdb16ca541601201409d37b5503dd27116
[17:02:26] <tktech> amercader, One bug, two small comments
[17:05:41] <wardi> and I'm just stirring up trouble

2016-03-23
[09:52:04] <yanik> is there a way, to understand what template file ckan using ? footer debug shows always something like "Debug 8" or "Debug 6" (I'm using custom templates)
[09:52:49] <yanik> oh, lol, i need additional js, to make it work i guess
[16:16:04] <amercader> does anyone have experience with mock on python tests?
[16:16:48] <wardi> A little
[16:17:13] <amercader> I'm trying to mock calling an action (just to check if the action function was called), but without success. I think that the voodoo that we are doing on get_action is messing the mock objects somehow
[16:17:28] <amercader> Here's all I've tried so far: https://gist.github.com/amercader/4537060424ce91fac0c3
[16:18:14] <amercader> I've only managed to mock it by calling it directly, which is not an option in my case
[16:19:00] <wardi> yeah, the actions are stored in a dict when you load the plugin, so that won't work
[16:19:39] <wardi> can you mock the core ckan get_action?
[16:20:11] <amercader> I guess so, but I want to mock that an action has been called
[16:20:52] <amercader> so can I make the mock get_action return a mock for a specific action and the normal functions for the rest?
[16:21:37] <wardi> good question! that seems like a desirable feature for Mock
[16:21:56] <wardi> if not you could wrap it yourself instead of using Mock
[16:22:14] <amercader> what do you mean?
[16:22:15] <wardi> oh, wait, no.. that doesn't work
[16:23:20] <wardi> you'd have to swap get_action out yourself
[16:25:35] <wardi> you could do something like https://github.com/ckan/ckanext-scheming/blob/master/ckanext/scheming/tests/test_helpers.py#L15 and define a side effect that swaps in your other function for the return value
[16:27:09] <amercader> this does not work https://gist.github.com/amercader/d4130f556e9cdcc0893e
[16:27:41] <amercader> sorry, that's wrong
[16:28:46] <wardi> how about .side_effect = lambda x: mock_user_list if x == user_list else x
[16:32:28] <amercader> I'm getting promising failures
[16:32:29] <amercader> TypeError: <lambda>() got an unexpected keyword argument 'context'
[16:33:02] <wardi> oh, I guess side_effect operates on the arguments not return valyes
[16:33:43] <wardi> so that doesn't really help..
[16:34:57] <amercader> wardi: no, I'm using it on return_value, ie `mock_get_action.return_value = lambda x: mock_user_list if x == 'user_list' else x `
[16:39:09] <wardi> ah, you can return DEFAULT or m.return_value from a .side_effect to not alter the orginial return value
[16:39:16] <wardi> http://www.voidspace.org.uk/python/mock/mock.html#calling
[16:42:43] <amercader> nice, this looks like could work
[17:10:54] <amercader> success!
[17:11:21] <amercader> wardi: this is how I got it working https://gist.github.com/amercader/7bc43c71fdaff5f0e447
[17:12:28] <wardi> can't use the return DEFAULT trick?
[17:12:52] <amercader> DEFAULT means return `return_value`
[17:13:06] <amercader> which is a mock by default
[17:13:13] <amercader> not the original result
[17:13:45] <wardi> but.. http://www.voidspace.org.uk/python/mock/sentinel.html#mock.DEFAULT
[17:14:17] <amercader> yes: "If you want the mock to still return the default return value (a new mock), or any set return value..."
[17:14:57] <wardi> oh well
[17:14:59] <amercader> the language is confusing, but they mean the default value that mock would return (ie a mock or `return_value`)
[17:15:18] <amercader> 3 in their example
[17:16:23] <wardi> can you call the original function somehow?
[17:20:51] <amercader> wardi: I can do this: https://gist.github.com/amercader/7bc43c71fdaff5f0e447
[17:22:01] <wardi> I like that better, it should still work after internal changes to get_action
[17:22:02] <amercader> which looks slightly better
[17:26:56] <amercader> still a bit cumbersome, I wonder if we can wrap the whole thing in a decorator or context manager
[17:56:40] <amercader> wardi: https://gist.github.com/amercader/f80237e7551832e91085#file-test_action_mock-py-L40
[17:57:27] <amercader> this looks like something worth adding to test helpers, what do you think?
[18:00:04] <wardi> sure, looks useful
[23:13:14] <holylim> Hi guys.  I won't be able to attend tomorrow's meetings.  I figured this was the best place to at least leave a message.

2016-03-22
[11:28:35] <LondonAppDev> Hi all, when I go to "http://demo.ckan.org/dataset/ramdom-sample.rdf" it will download the dataset in RDF. Is this an extension that is enabled or a feature? If it's an extension could someone point me to the right one?
[11:29:41] <amercader> LondonAppDev: https://github.com/ckan/ckanext-dcat
[11:30:44] <LondonAppDev> Fantastic thanks amercader.
[11:30:47] <amercader> check the doc sections on endpoints, mapping and profiles if you are interested in customizing the rdf output
[11:30:59] <LondonAppDev> Perfect thank you.
[12:01:37] <wardi> amercader, brook_: meeting?
[12:01:48] <amercader> ups coming
[12:33:15] <wardi> amercader: https://github.com/wardi/ckanext-scheming/blob/master/.circleci-matrix.yml
[12:34:14] <wardi> https://github.com/wardi/ckanext-scheming/blob/master/circle.yml#L12-L16 is the setup for circleci-matrix
[12:35:25] <amercader> nice
[12:37:16] <wardi> yeah, it's not terrible. Travis' matrix builds are nicer, for sure, but this is better than manually assigning each circle node
[12:38:11] <wardi> and I promise I'll get on a release real-soon-now :-)
[12:39:07] <wardi> oh, and this is useful too. I wrote it to be able to unit test the scheming form snippets https://github.com/wardi/ckanext-scheming/blob/master/ckanext/scheming/tests/mock_pylons_request.py
[12:39:32] <wardi> but it should be part of ckan's test helpers, probably
[12:45:09] <amercader> cool
[12:45:24] <amercader> I think Flask has this out  of the box
[15:29:47] <tktech> It does

2016-03-21
[17:19:41] <rossjones> Have just noticed catalog.data.gov is using a very early CKAN.  Does anyone have any contacts there to persuade them to upgrade?
[18:20:19] <amercader> rossjones: I believe wardi talked with them recently? If not I'm sure I can dig out some contacts
[18:24:42] <wardi> not so recently, and just about setting up CKAN inside docker
[18:34:53] <tomkralidis> rossjones: see pm

2016-03-20

2016-03-19

2016-03-18

[09:23:03] <rossjones> Maybe it's worth changing datapusher to push directly to the database?
[09:42:35] <tktech> I was curious as to why it doesn't already.
[09:47:56] <amercader> Depressing graph of the day: https://gist.github.com/sckott/168146a8e5b1da9af03a
[09:52:54] <amercader> tktech: datapusher was originally designed as the first of a series of microservices around CKAN, implementing this common interface: http://ckan-service-provider.readthedocs.org/. Most instances just run it side by side with CKAN though, so that's why it feels a bit weird. For the record though Viderum's cloud does use a common DataPusher instance shared by
[09:52:54] <amercader> different CKAN instances
[09:54:46] <tktech> That's an interesting idea, but doesn't really fit for data tools.
[09:55:15] <tktech> The overhead alone should be considered unacceptable.
[09:57:39] <amercader> I don't think it's not suitable for data tools, there are many potential use cases, but I completely agree that for the DataPusher it adds a big overhead and the whole setup could be simplified
[09:58:32] <tktech> I have another set of patches coming, speaking of performance.
[09:58:37] <tktech> Migrations will be required for this one.
[09:58:56] <tktech> Mostly to resolve this one line: https://github.com/ckan/ckan/blob/master/ckan/model/activity.py#L183
[09:59:38] <amercader> that would be great, activities are often a bottleneck
[10:00:01] <tktech> It loads every single dataset, completely, every time activity is loaded.
[10:00:18] <tktech> Just to get the IDs, then runs a several-pages-long IN
[10:00:29] <amercader> dear god
[10:00:33] <tktech> Yeah.
[10:01:03] <tktech> For things like stcndm where everything is within one organization, this bottleneck is ridiculous.
[12:03:07] <tktech> amercader, am I missing a mechanism that would resolve this case
[12:03:15] <tktech> Update CSV -> datapusher job starts
[12:03:32] <tktech> Realize it's wrong, quickly update CSV again -> datapusher status check shows a running job, nothing starts/queues.
[12:04:06] <tktech> When the old running job finishes (or better yet gets canceled) what insures datapusher grabs the newer file
[13:11:54] <amercader> sorry tktech miss this
[13:12:25] <amercader> with the current setup the newer file won't get picked unless you manually resubmit
[13:18:33] <tktech> Are there quirks with canceling jobs?
[13:18:54] <tktech> Or would locking -> status check -> cancel -> requeue -> unlock work
[13:24:14] <amercader> tktech: that's definitely what should be implemented, and I think the `task_status` actions would allow it. It probably would be too bigger a change to backport to 2.5.x though
[13:24:53] <amercader> so I reckon that including that patch is worth it, even with the caveat you described
[13:49:09] <wardi> tktech: nothing's atomic. everything async is more exiting that way.
[13:50:15] <wardi> (yes, it would be great to fix that when there is the opportunity)
[14:09:35] <wardi> amercader: resource_formats is used in ckanext-dcat and ckanext-qa, but I can't see anything using it in core
[14:10:17] <wardi> I've been asked about using those mime types instead of file extensions, do you know of any sites that have done that?
[14:16:23] <amercader> wardi: do you mean resources_formats.json? That's def used in core, in helpers I think
[14:17:40] <wardi> oh, I see it now, called from unified_resource_format
[14:17:44] <amercader> IIRC the plan was to make the media type the refernce field for redouce formats and use "format" just a label but we didn't make progress on that
[14:18:02] <amercader> Closer to what DCAT defines
[14:18:24] <amercader> (Sorry I'm on and off, I got a plane to catch)
[14:33:41] <tktech> wardi, I'm taking a different approach, I've been porting Tika's heuristic detectors to python
[14:33:55] <tktech> Although that's just a spare-time thing and may not be done for weeks
[14:34:53] <tktech> I took a look at the resource_formats when I was looking into the CSV/csv mailing list post and thought, "We could do this better"
[14:38:15] <wardi> tktech: You want to detect the file types? does that overlap with the stuff ckanext-qa is doing?
[14:39:23] <tktech> wardi, It is a general purpose python library and could be used by caknext-qa to replace their sniff_format
[14:39:48] <tktech> But is far, far more expansive. I've already ported close to 60 detectors and will be done thousands more by the time I'm finished
[14:40:32] <wardi> will it reach out from the screen and slap people that upload CSV files with non-comma separators?
[14:40:53] <tktech> I'm good, but not that good.
[14:41:03] <tktech> One day the screen-to-face interface will be achieved
[14:41:19] <tktech> My favorite is home-grown csv writers.
[14:41:21] <rossjones> tktech I think ckanext-qa just uses magic to detect types.
[14:41:30] <tktech> rossjones, https://github.com/ckan/ckanext-qa/blob/master/ckanext/qa/sniff_format.py
[14:41:58] <rossjones> EUW
[14:42:06] * rossjones does a quick git blame and hopes ...
[14:42:24] <tktech> I see your name there ;)
[14:42:51] <rossjones> Only a one-liner, and I don't remember seeing anything else in there.
[14:43:13] <rossjones> Normally you can tell my stuff because it doesn't work at all :)
[14:47:11] <tktech> Better than mine!
[14:47:30] <tktech> Mine tend to work, then fail in unique in exotic ways that require core CPython fixes.
[14:47:47] <rossjones> How would tika work, isn't it Java?
[14:48:13] * rossjones re-reads
[14:48:17] <rossjones> Porting to Python ... nice
[14:48:25] <tktech> Just the detectors
[14:48:28] <tktech> Not the parsers
[14:48:35] <rossjones> awww.
[14:48:56] <tktech> One is a couple weeks of work with 0 external dependencies the other is a few months with hundreds :)
[14:49:54] <rossjones> Heh. Do you think it is worth looking at http://goodtables.readthedocs.org/en/latest/ ?
[14:51:26] <tktech> What do you want to use it for?
[14:51:37] <tktech> https://bitbucket.org/pypy/pypy/issues/912/zipfileread-leaks-file-handles
[14:51:55] <tktech> ^- Issues like these are my favorites. When I can literally blame the interpreter/compiler instead of my code.
[14:52:03] <tktech> That one frustrated me for hours and hours
[14:53:08] <tktech> When we ported our kernel to PPC, we ran into so many gcc bugs IBM gave us a $5000 bounty
[15:13:19] <rossjones> tktech I think I'd prefer a datapusher that pushed at the DB, and then maybe told CKAN about it.  And at the same time, want to possibly provide schema (for goodtables) to validate before it just writes junk
[15:13:31] <rossjones> Disclaimer: I don't use datapusher.
[15:14:08] <tktech> That should be made possible through extensions but I don't think dataset schema validation would belong in the core
[15:14:19] <tktech> I can definitely see it being useful as an extension
[15:14:41] <rossjones> More like csv validation like csvlint.io
[15:15:45] <tktech> Hm, csv normalization.
[15:15:49] <tktech> I should add that to https://github.com/TkTech/pytextql
[15:16:03] <amercader> tktech, rossjones: my mates at OK (pwalsh et al) are working a lot on this stuff
[15:16:15] <amercader> Will definitely point them your way
[15:16:44] <tktech> amercader, Sorry, I'm jumping between topics...which stuff in particular?
[15:17:29] <amercader> CSV cleaning
[15:18:02] <amercader> Sorry if that's not what you were talking about :)
[15:18:23] <tktech> Ahah, we were at the end :)
[15:19:04] <tktech> I had to do it frequently at 360pi. Recieved many an exotic format from customers.
[15:19:34] <rossjones> amercader  it was pwalsh stuff on goodtables I was pointing at ;)
[15:20:33] <amercader> Duh, sorry I'm in a taxi and not reading well enough
[15:21:50] <rossjones> amercader that is forgivable, are you going somewhere exciting?
[15:51:15] <amercader> rossjones: Home for a week, to get some Mediterranean sun. Had enough Geordie winter for now
[15:51:47] <rossjones> Geordie winter .. this is the height as summer, it's as good as it gets! :)
[15:52:00] <rossjones> Bring me back some xurros please
[16:15:33] <wardi> Geordie winter? (google isn't helping me)
[16:41:12] <rossjones> Geordie is someone from Newcastle ... it's cold and grim up north.
[16:43:46] <rossjones> And also the name of the language they speak.
[16:43:50] <rossjones> Which is a bit like English
[18:03:40] <tktech> wardi, I think it's their version of newfie
[18:03:59] <wardi> right

2016-03-17
[11:46:10] <tktech> brook_, Did you get a chance to try the httpretty changes on your s3 extension?
[11:46:32] <brook_> tktech - not had a chance yet, I'm afraid
[13:08:56] <holylime> Is the meeting going on today?
[13:10:39] <wardi> should be in about an hour
[13:11:03] <holylime> TY!
[14:01:14] <wardi> rossjones, amercader, tktech: meeting?
[14:01:24] <amercader> coming!
[15:19:44] <memaldi> Hi all, I'm trying to specify a concrete user for harvesting jobs in CKAN harvester, but without any sucess
[15:20:19] <memaldi> I guessed that the property "user" in config JSON could do the trick
[15:20:29] <memaldi> but something is not working
[15:37:48] <tktech> amercader, What's the easiest way to reproduce this so I can test it?
[16:07:43] <amercader> tktech: on ckan 2.5 or master with datastore and datapusher enabled just create a dataset with a fairly big CSV (> than 100 rows)  and check the requests done to CKAN
[16:07:56] <amercader> it gets worse the bigger the CSV and the more resources a dataset has
[20:46:38] <travis-ci> LaurentGoderre/ckan explicit-solr-core a27c950 https://travis-ci.org/LaurentGoderre/ckan/builds/116740716 Laurent Goderre: The build has errored.

2016-03-16
[02:25:40] <tktech> wardi, I think I've responded to all the comments
[07:55:30] <rossjones> nigelb I seem to have assigned you to https://github.com/ckan/ckan/pull/2846 at some point :) Will you have the chance to review, or should I/
[07:55:31] <rossjones> ?
[07:59:19] <nigelb> rossjones: ha, I was looking at it over the weekend :)
[07:59:34] <nigelb> I'll hit the approve button pretty soon after one more round of testing!
[09:03:22] <rossjones> Thanks nigelb
[10:33:38] <Fr3dY> hi!
[10:34:21] <Fr3dY> i'm having problems installing the harvester plugin, everything's fine until this point:
[10:34:24] <Fr3dY> paster --plugin=ckanext-harvest harvester initdb --config=/etc/ckan/default/production.ini
[10:34:39] <Fr3dY> ...
[10:34:41] <Fr3dY> File "/usr/lib64/python2.6/urllib2.py", line 518, in http_error_default     raise HTTPError(req.get_full_url(), code, msg, hdrs, fp) urllib2.HTTPError: HTTP Error 401: Unauthorized
[10:34:48] <Fr3dY> any help appreciated. thanks!

2016-03-15
[09:25:24] <LondonAppDev> Hey guys, am I correct to think that you should never make a foreign key from an extension model to the core CKAN models? Even if it's "on delete/update cascade" ?
[11:53:12] <wardi> LondonAppDev: probably better not to. It could make migrations a little too exciting
[11:54:13] <LondonAppDev> wardi: got it.
[11:54:46] <wardi> for my sites I like to be able to tear them down and recreate them with the API. That's going to be hard to make work with an extension that links to ckan data at that level
[11:59:10] <brook_> wardi: I have this question too. What's the recommended alternative approach instead of a foreign key constraint?
[12:02:00] <wardi> rossjones, tktech: meeting?
[12:02:20] <wardi> LondonAppDev: care to join us too?
[12:02:37] <rossjones> wardi fraid not.  Not sure when/if I'll make any more right now :(
[12:02:47] <wardi> :-(
[12:03:25] <tktech> Not quite working
[12:05:05] <LondonAppDev> sorry wardi I'm on another call :(
[12:05:58] <wardi> ok, we'll carry on the FK discussion in irc
[12:35:51] <tktech> Mumble can see my mic, but not hangouts.
[12:36:24] <wardi> I had to jump through a bunch of hoops to get it to work on my windows laptop
[12:37:01] <tktech> You said it worked fine from your phone?
[12:37:02] <wardi> the hangouts app was easier, but I could never see the chat window when I was using that for some reason
[12:37:15] <tktech> I will have to try it for Thursday
[12:37:44] <wardi> other participants said the audio was pretty bad when I was using my phone though
[12:59:26] <wardi> tktech: AttributeDict.. wow that's frightening and beautiful at the same time
[14:36:42] <travis-ci> LaurentGoderre/ckan backport-2917 f131db9 https://travis-ci.org/LaurentGoderre/ckan/builds/116132482 Laurent Goderre: The build failed.
[16:07:21] <wardi> LondonAppDev: so, I think you should be safe using FK with "on delete/update cascade" if it's on one of the primary tables, like package or user
[16:08:02] <wardi> I would like to know what your extension needs that for, though, in case we could make your task easier with a modified/new plugin interface
[16:08:06] <LondonAppDev> wardi plan was to do it on 'resource'
[16:08:07] <LondonAppDev> for my resource checker
[16:08:46] <LondonAppDev> It's fine though I will just not do the FK
[16:09:02] <LondonAppDev> And I'll manually join when I query the data.
[16:09:11] <wardi> that should be ok, I can't see us not using that table any time soon
[16:09:13] <LondonAppDev> won't be loads of reads.
[16:09:26] <wardi> what do you store in your table?
[16:09:49] <LondonAppDev> resource_id, date_checked, http_status_code
[16:10:05] <LondonAppDev> Kind of like the deadoralive extension but I needed it to do some more custom things...
[16:10:37] <wardi> would it be better to make the url your primary key?
[16:11:32] <LondonAppDev> wardi - I did think this..
[16:11:39] <LondonAppDev> However if my checker runs
[16:11:41] <wardi> I guess it depends on what sort of reporting you need
[16:11:56] <LondonAppDev> And then the resource is deleted
[16:12:00] <LondonAppDev> and the same url is added to a new resource
[16:12:03] <LondonAppDev> it may duplicate.
[16:17:42] <amercader> wardi: I keep bumping into the toolkit helpers import issue on master (that one you have this patch for: https://gist.github.com/wardi/bb55c3bbf651f0f4fb53)
[16:18:07] <amercader> is it worth sending a PR for this or will tktech helpers' PR solve this?
[16:27:20] <wardi> amercader: it will help if it's changed as I suggested in the comment
[16:29:43] <amercader> Added a reaction to the comment, apparently that's how the internet communicates now
[16:30:10] <amercader> o/
[16:30:36] <wardi> :woman_with_bunny_ears:
[18:54:38] <amercader> It's probably inevitable that this chat eventually moves to Slack or Gitter
[18:55:13] <amercader> I hate walled gardens but their barrier of entry is much lower and interfaces are nicer
[18:57:11] <wardi> I worry about slack because it seems hostile to people using it as an open chat
[18:57:40] <wardi> but I do use it for a local user group and it does work well.
[18:57:49] <wardi> never tried gitter
[19:52:31] <travis-ci> LaurentGoderre/ckan fix-tests-solr 989ad1d https://travis-ci.org/LaurentGoderre/ckan/builds/116209286 Laurent Goderre: The build has errored.
[20:32:50] <tomkralidis> /win 5
[20:35:34] <rossjones> wardi are we moving to slack??
[20:42:36] <amercader> rossjones: no! (at least not yet). I was just mentioning that as a future option, as it looks like all online communities are moving there
[20:43:00] <rossjones> amercader must admit I only use IRC for #ckan and #elixir-lang nowadays
[20:43:32] <amercader> I'm only on #ckan

2016-03-14
[00:25:40] <jude> hey yes it did @rossjones
[00:25:44] <jude> quick question
[00:25:56] <jude> i installed harvest but keep getting this error
[00:25:58] <jude> 'text_no_query' is undefined
[00:26:03] <jude> any pointers on solving this
[00:26:13] <jude> this is when I try to access the harvest page
[12:08:38] <rossjones> jude what version are you running? Looks like a template version mismatch
[15:55:04] <tktech> Sooo. Manyyyy. Prrrrsss.
[16:24:29] <rossjones> tktech was that you offering to review some? ;)
[16:24:39] <tktech> No, that was me chain-posting 15 of them :)
[16:24:50] <tktech> I have 4 up at the moment, more incoming.
[16:31:44] <tktech> amercader, Replied to your comment on the schema, typing up a longer one for the slow tests.
[16:32:07] <tktech> The slow tests are 100% not the fault of CKAN but rather HTTPretty being really, really stupid.
[16:33:04] <tktech> I've shaved 4 minutes off the tests using a fork of httpretty, trying to move ckan to >= 0.8.11.
[16:34:00] <rossjones> :D Fasters tests get my vote
[16:34:13] <tktech> rossjones, If there are specific PRs you think need reviewing for tomorrows meeting feel free to assign a couple to me, I probably have time.
[16:34:32] <tktech> Otherwise I'll be on the meeting tomorrow to sell my PRs
[16:35:02] <rossjones> tktech not sure I'll make the meeting tomorrow, but you may have to trade some PRs to get yours reviewed :P Will try to get along with dread if I can though
[16:55:41] <rossjones> tktech definitely worth askin wardi and amercader if there's any they want to hand off as they have the most PRs by far.
[17:03:48] <wardi> or you could take some of the ones I've submitted that haven't been reviewed yet, because those bother me more :-)
[17:05:20] <brook_> I've had problems with httpretty's slow tests in ckanext-s3filestore (https://github.com/okfn/ckanext-s3filestore/issues/3). Didn't really resolve it, so interested in your solution.
[17:31:35] <amercader> in all fairness I had many many problems with tests and httpretty (just search the github repo) to the point I'll do anything I can to avoid using it
[17:32:02] <amercader> it's a shame because what it does is superuseful
[17:41:51] <tktech> brook_, amercader I have resolved it, PR is up.
[17:41:51] <tktech> https://github.com/ckan/ckan/pull/2916
[17:41:56] <tktech> "resolved" is a strong word.
[17:42:09] <tktech> Test is down from 106s to 6s.
[18:08:53] <tktech> brook_, I believe this would fix your problem as well.
[18:09:27] <brook_> tktech did you also update the httpretty requirement?
[18:09:31] <tktech> In particular changing the default buffer size from 16 bytes (lol) to the platform default of 4096 will remove thousands of calls
[18:09:54] <tktech> I did not, you cannot upgrade httpretty beyond 0.8.3 without breaking solr and other calls.
[18:10:14] <tktech> This PR monkey patches httpretty to apply fixes from 2014 that have been sitting in a PR
[18:10:34] <brook_> Yeah - I had some issue upgrading beyond 0.8.12.
[18:10:50] <tktech> 0.8.10 and above would also fix the issue, with a tweak, but it breaks almost everything.
[18:10:55] <tktech> Yeah, you were probably getting BadStatusLine?
[18:11:03] <brook_> That's the one
[18:11:17] <tktech> Yup. It broke anything that uses Content-Length.
[18:11:23] <tktech> Httpretty has basically no tests.
[18:11:50] <brook_> I had to pin the version used by s3filestore: https://github.com/okfn/ckanext-s3filestore/commit/4bc4f2ceb6a0ebeb4f8b993001d3121ae8b47471
[18:12:46] <brook_> On the one hand, monkeypatch. On the other, much faster tests :D
[18:15:20] <tktech> Yeah, I don't like it either, but it's a needed progression.
[18:15:28] <tktech> A middle ground until we can isolate and remove httpretty from existence
[18:20:32] <tktech> amercader, Are you already looking at #2856? I'm already neck deep in datapusher if you want to assign it to me instead.
[18:30:58] <amercader> tktech: that would be grand, I've been meaning to have a go at that one for ages, as iy needs to be backported
[18:35:22] <tktech> Ctrl-C while at a particular point in the migration tests will completely fubar postgres requring a table purge and re-init
[19:36:21] <travis-ci> LaurentGoderre/ckan html5-novalidate a3e29f5 https://travis-ci.org/LaurentGoderre/ckan/builds/115946091 Laurent Goderre: The build failed.
[21:15:26] <wardi> tktech: we aspire to have transactions on our migrations one day

2016-03-13

2016-03-12
[02:07:56] <nigelb> rossjones: you already have admin perms :)

2016-03-11
[08:12:08] <nigelb> rossjones: It should. Is it not?
[08:58:05] <rossjones> nigelb I sent a mail yesterday lunchtime, but not showing up in archive :(
[08:59:13] <rossjones> nigelb if I could have admin perms (ross@servercode) I can help with moderation :)
[11:28:57] <amercader> rossjones: your message went through now (it was flagged as spam, but so was a test one I sent yesterday)
[11:29:05] <amercader> rossjones: and you are admin now
[11:29:18] <rossjones> Woo! Thanks.
[11:29:21] <rossjones> I now feel complete.
[11:29:50] <amercader> Achievement Unlocked
[11:30:12] <rossjones> I should take the rest of the day off (and spare myself arguing with supervisord).
[13:41:53] <travis-ci> wardi/ckan TkTech-master ca10c19 https://travis-ci.org/wardi/ckan/builds/115317093 Ian Ward: The build has errored.
[13:51:49] <travis-ci> LaurentGoderre/ckan english-default-override c341f18 https://travis-ci.org/LaurentGoderre/ckan/builds/115320038 Laurent Goderre: The build has errored.
[13:53:23] <travis-ci> LaurentGoderre/ckan english-default-override 8694765 https://travis-ci.org/LaurentGoderre/ckan/builds/115320383 Laurent Goderre: The build has errored.
[15:14:22] <rossjones> is synchronous_search still explicitly required in plugins?
[15:19:38] <wardi> I've never added it
[15:19:53] <wardi> is it one of our not-really plugins?
[15:23:51] <rossjones> It's from the dark old days. Used to be required to update solr in the request lifetime, or you ran your own update in cron.
[15:24:03] <rossjones> I think someone may have replaced the need for it with config.
[15:25:05] <wardi> well, if it's one of our plugins that can't actually be unplugged, it should stop being a plugin
[15:25:29] <rossjones> Docs suggest it's been fixed -> http://docs.ckan.org/en/latest/maintaining/configuration.html?highlight=synchronous_search
[15:26:22] <rossjones> Also, we should remove http://docs.ckan.org/en/latest/maintaining/configuration.html#ckan-simple-search at some point too.
[15:26:30] <wardi> +1
[17:47:18] <amercader> no better time than now

2016-03-10
[22:13:31] <tktech> I can replace the functionality in like 4 lines.
[22:13:32] <wardi> I was considering removing the magic from that instead of wrapping it with a no-magic thing the way I did recently
[22:14:04] <tktech> Yeah, I consider that entire thing more of a hindrance then a help.
[22:14:11] <tktech> And it will stop crashes only in a narrow set of cases.
[22:14:21] <tktech> Ex: "h.flash.pop_message()"
[22:14:22] <wardi> This will affect ckantoolkit, so I'll probably review the PR
[22:14:40] <tktech> Sure flash doesn't exist, so return the magic placeholder, and then it crashes on pop_message missing.
[22:15:02] <wardi> yep
[22:15:21] <tktech> I'm +1 for nuking it entirely, any objections?
[22:15:40] <wardi> don't forget all the time wasted by confused developers trying to figure out why their helper is returning nothing..
[22:16:13] <wardi> I'd support it, but it's a breaking change so I'd like to discuss it at the next dev meeting
[22:16:30] <wardi> at a minimum it needs a notice in the change log
[22:18:18] <wardi> actually. I need to change ckan.toolkit.h to a thing that lazily loads helpers, so having a class that replaces _Helpers is still useful for me
[22:19:16] <tktech> wardi, Instead of that, could you simply import helpers.helper_functions?
[22:19:25] <wardi> I'm on the fence about whether that would be a __getattr__ lazy or __call__ lazy
[22:19:56] <wardi> tktech: no, because the toolkit's h lets you access all the helpers that plugins can provide too
[22:20:14] <tktech> I would like to do that in helpers.helper_functions instead, though.
[22:20:45] <tktech> When the environment is setup and helper providers loaded, it will simply update helpers.helper_functions instead of slapping _Helpers on top of it.
[22:20:49] <wardi> oh, so that woudn;t be a dict
[22:21:30] <wardi> Hmm. I haven't looked too closely into the plugin unloading code to see if it cleans up registered helpers
[22:21:41] <tktech> I can fix that too :)
[22:21:57] <wardi> (it's nice to have an object that we can just discard then re-init with enabled plugins)
[22:22:27] <tktech> You would just re-call helpers.load_plugin_helpers()
[22:22:57] <wardi> ok, so you need a dict of core helpers and another dynamic one
[22:23:27] <wardi> yeah, this works
[22:24:06] <tktech> Mmhmm. Turn the current helper_functions into builtin_functions, add a helper_functions that does what we want.
[22:24:20] <tktech> Functionaly identical, removes about 150 LoC.
[22:24:27] <wardi> love it
[22:24:38] <wardi> _builtin_functions
[22:24:56] <tktech> Nah, why private scope it?
[22:25:20] <tktech> I tend to follow the Zen on this one, don't make things private without a really good reason why.
[22:25:21] <wardi> because nothing needs it?
[22:25:45] <tktech> How so? Maybe I want the debug toolbar to show the list of builtins :P
[22:25:46] <wardi> and because we don't have a frozen dict in python :-/
[22:26:45] <wardi> I find it useful to say "this isn't the dict you're looking for" with just one extra character in the name instead of a comment
[22:41:56] <wardi> tktech: are you using an automatic pep8 formatter?
[22:42:05] <tktech> Nope. They all suck.
[22:42:35] <tktech> I have additional style changes I prefer that aren't technically pep8, like consistent quotes.
[22:42:38] <tktech> No mixing ' and "
[22:44:01] <wardi> is that why you https://github.com/ckan/ckan/pull/2885/files#diff-c2b92fb3855283738cfac35d269902c9L207
[22:44:25] <wardi> I found that easier to read before
[22:45:25] <tktech> It is still very easy to read ;)
[22:45:48] <tktech> But yes, mixed quoting is just an annoyance, actually servely dislike that python allows both ' and "
[23:02:19] <tktech> wardi, What do you think about adding -x to the circle.ci test runner?
[23:02:39] <tktech> So that nosetest fails and returns on the first failed test instead of spending 20 minutes failing 500 other tests.
[23:04:36] <wardi> that tends to be the way I run my tests locally
[23:04:55] <wardi> well, when I'm not naming just one of them
[23:05:18] <tktech> Yeah, I vastly prefer the quick iterative style versus waiting 30 minutes per run
[23:05:33] <wardi> don't know. for people without testing set up it's useful for them to see all the errors
[23:05:41] <wardi> we could do both. we have 4 containers
[23:08:51] <wardi> or we could split the tests across our containers so they take closer to 10 minutes to run

[10:39:06] <rossjones_> wardi amercader Sorry, won't be able to make meeting at 2, have a family thing I need to do.
[10:50:57] <rossjones_> wardi what do you think about https://github.com/ckan/ckan/pull/2872#issuecomment-194788026 ?  Would really like a test, but I think it's one of those things that if we don't get one it'll just sit there forever ;(
[11:17:38] <Zharktas> I try to find the time to write couple tests for it, shouldn't be too hard
[11:42:06] <rossjones_> Oh thanks Zharktas - sorry to be a pain.
[13:36:00] <HolyLime> So I've got a question about proper ckan installation.  I've run into what seems like a basic problems, but just want to touch base on.
[13:37:14] <HolyLime> I was following the install from package directions and everything was fine up until the install itself.
[13:38:04] <HolyLime> The installation threw an error where the datetime module was missing.
[13:39:00] <HolyLime> Which seems really weird since this seems like a basic module which should already be present.
[13:41:05] <HolyLime> If this is something that would rather be posted to stackoverflow just let me know and I'll do that.  Since there has been an expressed interest in utilizing that resource much more formally.
[13:49:35] <wardi> rossjones_: you haven't written up the ckan/beer gathering yet
[13:49:54] <rossjones_> I have, Just mailed to the list./
[13:49:57] <rossjones_> :P
[13:51:11] <wardi> rossjones: hmm. maybe my email is slow
[13:56:24] <holylime> What is the latest stable release of ckan?
[13:56:37] <holylime> My looking at the directions I thought it was 2.5?
[13:58:07] <wardi> holylime: that's right, 2.5.1
[13:58:31] <holylime> So I ran sudo dpkg -i python-ckan_2.5-trusty_amd64.deb, but get a module missing error of datetime.
[14:01:53] <wardi> amercader: meeting?
[14:02:20] <amercader> just joined sorry
[14:10:50] <travis-ci> ckan/ckan 2845-wsgi-dispatcher 1ff29e6 https://travis-ci.org/ckan/ckan/builds/115060677 amercader: The build was broken.
[14:26:46] <travis-ci> ckan/ckan 2845-wsgi-dispatcher 6e05650 https://travis-ci.org/ckan/ckan/builds/115061586 amercader: The build was broken.
[16:01:03] <holylime> So I've posted my ckan install problem in stackoverflow with as much documentation, explanations, and erros messages.  The link is here is case anyone has a moment to take a look.  Many thanks, http://stackoverflow.com/questions/35921408/ckan-install-module-missing-error.
[17:02:43] <rossjones> holylime it appears to be a virtualenv problem, I just don't know what specifically yet
[17:02:45] <rossjones> oh.
[17:05:23] <wardi> rossjones: I didn't see your write up in email or in the ckan-dev list archives
[17:05:34] <rossjones> is it being moderated?
[17:06:02] <rossjones> nigelb is the ckan-dev mailmain working?
[17:07:50] <rossjones> wardi it's at https://gist.github.com/rossjones/bddaf59c336e03920bcf if you don't want to wait for the mail :)
[17:30:04] <wardi> rossjones: thanks! :-)
[17:37:23] <rossjones> Was definitely interesting to get direct feedback, and everyone seems to nice :)
[19:26:33] <tktech> What do people think about closing all PRs with >6 months of inactivity?
[19:26:56] <tktech> They can always be re-opened if interest/activity starts again, but currently they're just clutter.
[19:27:03] <tktech> There are PRs that haven't been touched since 2014
[19:27:29] <tktech> **2013
[19:49:41] <tktech> wardi, poke ^
[20:23:00] <amercader> tktech: I'm +1 on that
[20:24:48] <amercader> rossjones: there's definitely something wrong with ckan-dev, will investigate tomorrow
[20:27:03] <amercader> rossjones: excellent feedback from your write up, will definitely answer when the message appears to the list
[20:43:33] <wardi> tktech: yes, that's a good idea. rossjones has been cleaning up some issues the same way
[21:57:08] <tktech> wardi, https://github.com/ckan/ckan/pull/2908
[22:01:19] <tktech> Gonna hate myself for this one.
[22:02:34] <wardi> why's that?
[22:04:38] <tktech> I've fallen into a chain of annoyances.
[22:04:44] <tktech> Basically going to end up cleaning all of CKAN
[22:04:53] <wardi> I just have some minor style preferences, but I love the clean up
[22:06:32] <tktech> Waiting for the tests to fail, should be a couple dozen. Going to be a few more files that are relying on 2nd degree imports from helpers.py
[22:07:57] <wardi> do those need to be fixed? It's at least a separate issue
[22:08:43] <wardi> I can imagine a motivation for importing them that way is that those methods can be fixed/wrapped later as necessary
[22:08:51] <tktech> It's unforunately part of this issue, since I scoped most of those imports.
[22:09:09] <tktech> Nah, most of it seems to be just lazyness.
[22:09:21] <wardi> ok
[22:09:21] <tktech> Ex: 95% of the code calls asbool from paste.deploy.converters
[22:09:28] <tktech> 2 files call it from helpers
[22:10:00] <tktech> That doesn't help anythin, that just makes refactoring (if it does need to be wrapped in the future) and static checking harder.
[22:10:14] <wardi> yep, I agree
[22:10:20] <tktech> This PR is part of futher cleanups to enable 100% pylint coverage.
[22:11:47] <wardi> The minor things I'd change would be to not bother accepting both a list of functions or a single function. a simple decorator is better IMHO
[22:12:53] <wardi> And I'd be tempted to move the _Helpers thing to the helpers module instead of accessing the dict from environment.py
[22:13:15] <tktech> Agreed, I'll make that change.
[22:13:24] <tktech> For _Helpers, that entire thing will most likely disappear.

2016-03-09

[11:08:31] <amercader> There is a catch-all route (https://github.com/ckan/ckan/blob/master/ckan/config/routing.py#L425) in our routing that points *all* requests not previously catch to a "template" controller that tries to render a template with the same name and returns a 404 if the template file doesn't exist
[11:09:40] <amercader> so you can drop a `hello.html` file in your templates folder and you then can call `http://ckansite/hello` and have it rendered
[11:14:13] <amercader> I can see how this may be useful, eg to avoid having to write a controller for static pages, but maybe we should limit the method to GET?
[12:17:59] <travis-ci> ckan/ckan master ca8b046 https://travis-ci.org/ckan/ckan/builds/114545488 David Read: The build has errored.
[14:48:48] <wardi> amercader: ugh
[14:49:12] <wardi> could we have a whitelist for that?
[14:50:23] <wardi> that means we have all sorts of silly pages rendering under snippets/, or base etc.
[14:54:40] <Zharktas> some of them fail with error 500
[14:54:50] <Zharktas> but some of them don't like admin
[14:55:11] <wardi> neither is good
[14:55:54] <amercader> Zharktas: yes, that's what's causing the issue you submitted here https://github.com/ckan/ckan/issues/2871
[14:56:44] <amercader> and is messing up my tests for flask/pylons routing as pylons always says it can serve any request
[14:57:22] <Zharktas> i should fix the PR for that :p
[14:57:38] <amercader> Zharktas: we should fix the catch-all route
[14:57:39] <Zharktas> I did not realize that admin templates are extendable
[14:57:57] <amercader> and then your issue would go away
[14:58:05] <Zharktas> true
[14:58:57] <amercader> so wardi WDYT, 1. get rid of it completely (minimal work) or 2. add a new config option with the allowed endpoints (more work)
[14:58:58] <wardi> every template is extendable. it's a giant impossible-to-maintain-perfectly interface for extensions. But thatsaid, it's super-useful
[14:59:42] <wardi> well, I vote for #1 but I'm not using that feature
[15:00:00] <wardi> maybe we should announce that we're deprecating the behaviour and see if anyone cares
[15:00:09] <Zharktas> catch-all route is nice for static pages
[15:00:23] <Zharktas> but controller for static page is not much of work either
[15:00:41] <amercader> I'm not using it either, and I doubt anyone is seeing as this has been undocumented since forever
[15:00:45] <wardi> How about a special template path for these automatic pages
[15:00:58] <amercader> that sounds good
[15:00:59] <wardi> that way they're not mixed in with all our base templates, snippets etc
[15:01:09] <amercader> like templates/automatic or something
[15:01:11] <amercader> ?
[15:01:13] <wardi> yeah
[15:01:53] <wardi> does that let us only register the paths that exist as templates in those directories?
[15:02:17] <rossjones> Did someone say something needed deleting?
[15:02:41] <wardi> rossjones: only briefly, now we're talking about making things more complicated :-)
[15:04:12] <amercader> As I understand it, it would work exactly as now but when calling render we will prepend `automatic` or whatever to the path: https://github.com/Zharktas/ckan/blob/%232871-admin_urls_with_consistent_templates/ckan/controllers/template.py#L30
[15:07:20] <wardi> amercader: so it's ok that there's still a wildcard path in pylons?
[15:07:52] <amercader> I'd rather not have it there tbh
[15:07:59] <amercader> wildcard things make me noervous
[15:08:03] <amercader> *nervous
[15:08:52] <wardi> so the alternative is walking all the templates/automatic dirs and registering urls for files we find
[15:13:29] <amercader> does this mean walking through all the extensions templates dirs?
[15:14:11] <wardi> it would have to, yes. just once on start-up though
[15:14:21] <amercader> maybe they aren't even set up when the routing happens
[15:14:32] <amercader> they probably are
[15:15:05] <wardi> or when the template directories are registered/unregistered
[15:16:15] <wardi> django had a middleware thing for this. catch the 404 just before it's sent to the user then try to find a template in the db
[15:16:34] <wardi> (for a cms I was using ages ago)
[15:18:19] <wardi> amercader: what do you think about another layer of wsgi for that?
[15:18:44] <yanik> cmon guys, where I'm wrong? https://gist.github.com/yanik5/e38be1d3383c75b32211
[15:19:36] <yanik> i set up not_empty validator and still this code has no effect (dataset and resources created w/o any validation errors
[15:19:50] <wardi> where's _modify_package_schema?
[15:20:57] <yanik> wardi, forget copy to gist, link updated
[15:21:58] <amercader> wardi: this is getting more complex as we go :)
[15:22:43] <wardi> the middleware option is pretty simple really. but it's an extra call for every request
[15:23:22] <wardi> (I don't think that's stopped us before) we could add a config option to allow it to be disabled
[15:24:12] <amercader> and will that be a pylons middleware or a flask middleware :)
[15:24:24] <wardi> amercader: yes
[15:24:43] <yanik> or django middlware ))
[15:24:43] <wardi> yanik: does returning an empty list of package_types work?
[15:25:02] * wardi throws a fish at yanik
[15:25:57] <yanik> wardi, this code not working , but all code samples from github return empty list
[15:26:09] <yanik> https://gist.github.com/yanik5/e38be1d3383c75b32211#file-additional_resource_field-py-L40
[15:26:30] <amercader> yanik: you need to inherit from `toolkit.DefaultDatasetForm`, not `toolkit.SomePlugin`
[15:26:44] <wardi> yanik: what does not working mean for you?
[15:26:51] <yanik> amercader, I inherit from both
[15:27:17] <amercader> not in your gist
[15:27:41] <yanik> wardi, meaning this code is ignored, i don't have any extra field (not even extension since i have not_empty validation)
[15:28:05] <wardi> have an extra field where? in the form?
[15:28:23] <yanik> amercader, sorry about that, updated
[15:28:26] <amercader> you need `class SomePlugin(plugins.SingletonPlugin, toolkit.DefaultDatasetForm):
[15:29:03] <yanik> yeah, I have the same
[15:29:28] <wardi> yanik: would you link to the actual code you're having trouble with?
[15:30:41] <yanik> wardi, sure, here full plugin file:
[15:30:47] <yanik> https://gist.github.com/yanik5/7f3e055011e9fc78f177
[15:31:07] <yanik> I actually updating one of amercader plugins :)
[15:31:30] <yanik> additional field starts here : https://gist.github.com/yanik5/7f3e055011e9fc78f177#file-plugin-py-L87
[15:32:08] <amercader> yanik: you are not doing `plugins.implements(plugins.IDatasetForm)`
[15:32:38] <amercader> and for the record brook_ wrote ckanext-s3filestore :)
[15:33:12] <yanik> amercader, ops, just saw you commit then
[15:33:53] <yanik> oh gosh
[15:35:31] <yanik> I own you this one, guys, so silly
[15:35:44] <yanik> and i lost lost hours ;/
[15:36:01] <yanik> now everything is fine, got validation error :)
[15:36:37] <yanik> and what you meat by throwing dat fish, wardi? :S
[15:37:13] <wardi> yanik: that was for the django comment :-)
[15:38:52] <amercader> wardi: I got to drop now. Regarding the magical catch all templates, I've tested dynamically adding the routes both when the routing is set up and when the templates dir are added and it's not trivial or impossible in both cases
[15:39:38] <amercader> I'd need to know more about the middleware option, but I'm also leaning towards removing, whitelisting it or leaving as is
[15:39:54] <amercader> we can discuss on tomorrow's meeting
[15:40:16] <wardi> sounds good
[16:18:04] <rossjones> wardi If I haven't written up our ckan/beer before the team meeting tomorrow can you shout at me please?
[17:36:21] <wardi> rossjones: will do

2016-03-08
[10:03:14] <LondonAppDev> Hi all, why would "ckan.logic.action.get.current_package_list_with_resources()" only return 10 packages but "ckan.logic.action.get.package_list()" returns all of them?
[10:06:07] <shellac> LondonAppDev: I know it paginates -- try upping limit
[10:06:35] <shellac> as to why they act differently.... ?
[10:07:11] <LondonAppDev> shellac: hmmm I want to get all of them though...
[10:09:50] <rossjones> LondonAppDev I think it may be because it is doing a lot of work - you can as shellac suggests user limit=10000
[10:10:14] <LondonAppDev> OK cool. thanks shellac and rossjones.
[10:10:25] <rossjones> LondonAppDev are you coming to ckan beer meetup
[10:10:35] <rossjones> And anyone else based in London
[10:12:24] <LondonAppDev> Oh cool when is it?
[10:12:39] <rossjones> Tonight at Princess Louise (Holborn)
[10:12:52] <rossjones> 6PM Upstairs if you can make it
[10:14:02] <LondonAppDev> Ahh damn I can't tonight as I have to go to Milton Keynes.
[10:41:17] <LondonAppDev> Is it possible to get the harvest object from a package? The harvester which harvested the object? I thought something was in 'extras' but it doesn't appear to be..
[11:59:28] <LondonAppDev> If this can create a search query for datasets with a specific harvest_source_id https://github.com/ckan/ckanext-harvest/blob/master/ckanext/harvest/helpers.py, it should be possible to do this using a query right?
[12:04:08] <amercader> rossjones: you coming to the dev meeting? https://pad.okfn.org/p/ckan-meeting
[12:55:42] <wardi> amercader: should I make small edits straight on the wiki page?
[12:55:57] <amercader> wardi: please, small and big
[13:06:47] <shellac> f0rew@rd73
[13:18:42] <LondonAppDev> shellac hope that's not your password :)
[13:28:02] <wardi> I'd be in a hurry to change it, this channel is logged publically
[13:45:02] <shellac> oh, it's a old thing on vagrant
[13:45:11] <shellac> sorry, wrong window
[13:46:06] <shellac> (lastpass generates my passwords, my brain isn't random enough)
[13:53:23] <92AAAII7E> ckan/ckan 2898-fix-doc-lings d3f6eaa https://travis-ci.org/ckan/ckan/builds/114509040 amercader: The build has errored.
[14:26:19] <wardi> amercader, brook_: hmm. seems that nothing was recorded for that week missing on the pad
[14:27:22] <rossjones> amercader wardi sorry we couldn't make the meeting, we're all at HQ today
[14:28:18] <wardi> so it seems I didn't delete too much
[14:36:04] <amercader> wardi: as I see it only the 25th Feb one is missing
[14:36:31] <amercader> I already asked nigelb if we can retrieve it
[14:37:03] <wardi> I think it didn't get recorded. I used the timeslider to go back to before I deleted the old entries
[14:37:29] <nigelb> Yep, can confirm. Someone or something was hammering etherpad this weekend.
[14:37:41] <nigelb> etherpad doesn't help. It stores data in an *awful* format.
[14:37:46] <nigelb> One table with two columns
[14:37:50] <nigelb> id and data I think.
[14:37:55] <nigelb> The data field has a blog of json.
[14:38:01] <nigelb> *blob
[14:40:20] <wardi> nigelb: that's what all the cool kids are doing
[14:40:58] <nigelb> wardi: Thanks to eventual consistency, we may eventually get the lost data? :)
[14:41:42] <wardi> Well, assuming there is lost data. More likely that it was never entered
[14:46:00] <travis-ci> ckan/ckan 2898-fix-doc-lings d3f6eaa https://travis-ci.org/ckan/ckan/builds/114509040 amercader: The build has errored.
[15:50:32] <d4t4_n3rd> hello, wondering if someone could help a non-professional programmer with some questions about the solr requirement for ckan. I'm curious to know if solr has to be used, or if the search backend can be swapped for using native postgre queries.
[15:52:33] <wardi> d4t4_n3rd: solr is required for any recent ckan version
[15:54:37] <d4t4_n3rd> @wardi thanks, I don't suppose there is any reason to keep asking then. :/ I work in a small newsroom and an editor asked if this is a tool that could be used to share data with readers. We use heroku for hosting our news apps, but solr is a bit pricey, so I was hoping there might be a work-around
[15:55:49] <wardi> I guess you could use an older version of ckan, but I wouldn't recommend it (no bug/security fixes)
[15:56:59] <travis-ci> ckan/ckan master e34bbd0 https://travis-ci.org/ckan/ckan/builds/114525727 Ian Ward: The build has errored.
[15:57:32] <wardi> how much is solr on heroku compared to a vps?
[15:59:36] <d4t4_n3rd> @wardi https://elements.heroku.com/addons/websolr - $20 for 20,000 documents. Admittedly, I don't entirely understand what solr considers a "document"... we have some database tables with more than a million records for some of our news projects
[15:59:58] <wardi> d4t4_n3rd: in CKAN those would map to datasets
[16:00:31] <wardi> that's all that we put in SOLR right now
[16:01:41] <wardi> more specifically one dataset with 5 files attached (resources) would be one document in SOLR
[16:04:33] <d4t4_n3rd> @wardi are the attached files more of a zip archive attachment, or are your users able to query the records for something like geospatial and x/y plot graphs?
[16:06:02] <wardi> d4t4_n3rd: you can attach files or create tables to make visualizations, and yes you can query based on a spatial field
[16:06:24] <wardi> most of the exciting bits are in extensions
[16:12:58] <d4t4_n3rd> @wardi sorry if these are dumb questions; I haven't had a chance to understand solr and so I don't completely understand how it works with ckan. If I understand correctly, the solr document basically holds metadata and somehow points back towards postgres to run the queries that might be needed for interactive spatial mapping and graphing?
[16:14:12] <wardi> d4t4_n3rd: ckan uses solr for searching, it contains copies of data already present in postgres
[16:16:19] <d4t4_n3rd> @wardi okay, I think that I understand. so then the data exploration isn't actually happening through solr, its happening through the extension with an embed on the document's landing page
[16:16:42] <wardi> that's right
[16:19:58] <d4t4_n3rd> @wardi that actually answers a lot of questions I've had... okay, makes so much more sense. I thought that solr was basically caching and indexing each field within the database and that was a "document" ... that seemed excessive, but I thought maybe its was useful if the database field was a lob containing the text in a word or pdf document.
[16:21:37] <wardi> no, just one solr document per dataset, and that usually only contains metadata. There are some extensions that index some of the data as well, though.
[16:30:37] <d4t4_n3rd> @wardi thanks wardi, you've been super helpful
[16:53:48] <travis-ci> ckan/ckan master ca8b046 https://travis-ci.org/ckan/ckan/builds/114545488 David Read: The build has errored.
[17:20:49] <wardi> travis-ci: go home, you're drunk
[20:13:29] <travis-ci> ckan/ckan 2898-fix-doc-lings d3f6eaa https://travis-ci.org/ckan/ckan/builds/114509040 amercader: The build has errored.

2016-03-07
[09:38:01] <yanik> hi guys, any code sample for single resource extra form field?  docs are not clear enough
[09:46:11] <yanik> is this one looks like bare minimum for you? https://gist.github.com/yanik5/25ebf8427e149c762808
[09:47:25] <yanik> i don't have any validtion error on this ;/
[10:02:25] <yanik> found one https://github.com/ubdc-IT/ckanext-ubdcschema/tree/cd6602475da8badee89e41f3942194b5341351a3
[17:18:25] <benjwadams> log.debug('Spatial tables creation deferred')
[17:18:44] <benjwadams> Is there any way to *not* defer table creation?  It is causing serious problems
[17:19:58] <benjwadams> Specifically, the user table is trying to be referenced by paster before ckan has even set it up??
[17:22:49] <Zharktas> i would say by the code of ckanext-spatial, that it is deferring because ckan tables do not exist yet
[18:00:24] <TkTech> Correct

2016-03-06

2016-03-05
[13:32:57] <tmwsiy2012> I am interested in ckan to streamline data set management for use by researchers at my job (university IT) Most all of the documentation is written from the perspective of being a sharer of data and while we might also use it for that purpose right now the primary use will be to harvest and mirror/catalog public datasets that our researchers are using.
[13:35:33] <tmwsiy2012> anywho, I am looking at the harvester stuff now and was wondering if there were any  repositories of implementations for common gov sources (like bls stuff for instance)
[13:38:32] <tmwsiy2012> ok try 2
[13:38:39] <tmwsiy2012> I am looking here: https://github.com/ckan/ckanext-harvest#the-ckan-harvester
[13:47:19] <tmwsiy2012> how does one go about finding the harvest_soruce_url for a particular dataset in the ckan interface on the source site?
[13:47:53] <rossjones> tmwsiy2012 there are a few different harvesters about, what are you looking for in particular?
[13:48:22] <tmwsiy2012> I guess I am looking at the ckan harvester
[13:48:35] <rossjones> from what I understand, the harvest_source_url is generated during harvesting
[13:51:48] <tmwsiy2012> ahh, I see, that is just providing the dictionary keys
[13:52:38] <rossjones> So on data.gov.uk, when we harvest leedsdatamill.org, the information is in Additional Information at the bottom of https://data.gov.uk/dataset/rain-gauge-rainfall-data
[13:55:55] <rossjones> If you have a dataset with a harvest id, you should be able to use https://github.com/ckan/ckanext-harvest/blob/master/ckanext/harvest/logic/action/get.py#L242 to get more information
[14:01:58] <tmwsiy2012> thanks for the help. I just need to start trying some stuff. I got to the point where I had the harvester plugin installed and was unsure what to do next. I guess I am also still trying  to wrap my head around everything
[14:06:43] <rossjones> tmwsiy2012 it's a steep-ish learning curve, but you'll feel better once it makes sense :) The docs at docs.ckan.org and https://github.com/ckan/ckanext-harvest *should* be enough to get you up and running.
[14:12:36] <tmwsiy2012> :)

2016-03-04
[13:19:14] <rossjones> jude  did showcase work for you?
[15:40:32] <rossjones> In case anyone is in London next Tuesday around 6PM - there are going to be a few of us at https://foursquare.com/v/princess-louise/4ac518c5f964a520d5a420e3

2016-03-03
[14:00:33] <wardi> rossjones: meeting?
[14:02:19] <rossjones> Two ticks
[14:12:06] <rossjones> https://gitlab.com/groups/european-data-portal
[14:13:49] <rossjones> http://www.europeandataportal.eu/data/api/util/status
[18:33:11] <jude1> hey
[18:33:18] <jude1> quick question
[18:33:30] <jude1> i did some upgrade from 2.3 to 2.5
[18:33:35] <jude1> is it possible to see
[18:33:40] <jude1> the related plugin
[18:33:52] <jude1> i lrealized the related functionality was removed from 2.5
[18:34:04] <jude1> is there a way to get it back into 2.5 as a plygin?
[18:34:06] <jude1> plugin?
[19:07:27] <jude1> hello?
[19:21:54] <rossjones> jude1 we're recommending everyone use ckanext-showcase instead now
[19:22:37] <rossjones> https://github.com/ckan/ckanext-showcase - there is a migration command to upgrade your old data - if you have old data, the upgrade to 2.5.1 will not have deleted it.
[19:23:29] <jude1> ahh thanks
[19:23:35] <jude1> let me try it out

2016-03-02
[09:55:50] <rossjones> wardi I'll probably end up taking over morty's work on this, it isn't a dramatic change, just better handling of the fq param and adding tags to them
[15:24:43] <wardi> rossjones: please share a link your/morty's existing work when you have a chance
[15:26:57] <rossjones> wardi it's https://github.com/datagovuk/ckan/tree/multiselect-facets from dd2842a41a0178cef69bda17ebb1aaac13a97971 to now.
[15:27:12] <rossjones> We still have to work out what, if anything could actually be done in our extension rather than in core.
[15:27:39] <rossjones> The tag properties are at https://github.com/datagovuk/ckan/commit/dd2842a41a0178cef69bda17ebb1aaac13a97971
[15:28:09] <rossjones> https://github.com/datagovuk/ckan/commit/cfb97e8929612be1132f91ba34d58626f6200e8b is where we realised that tagged fq params fail if the fq is sent as a string, to solr, it prefers lists.
[15:39:29] <rossjones> wardi Also, am chasing EU DataPortal for source code. Don't think it's fair that CapGemini and others shouldn't have to follow the same rules as everyone else :(
[17:46:54] <travis-ci> LaurentGoderre/ckan db_scripts 2bb3fd5 https://travis-ci.org/LaurentGoderre/ckan/builds/113185569 Laurent Goderre: The build was canceled.

2016-03-01
[09:45:59] <rossjones> tktech not that I know off, will ask at the tech call today though if you'd like?
[11:51:16] <wardi> rossjones: might be just you and i today
[11:52:25] <rossjones> will be quick then :)
[11:55:44] <rossjones> wardi I've done the 2 issues, and no new PRs.
[11:56:03] <rossjones> Only other thing is tktech's question about Solr5 docs/.
[11:57:56] <wardi> i don't know of any
[11:58:48] <wardi> i was going to submit our info on the SFC form to set up a meeting
[11:59:17] <wardi> that's all i've got. meeting done?
[12:00:03] <rossjones> You can go back to bed now ;)
[12:00:24] <wardi> sounds good
[12:00:26] <rossjones> We should try and avoid you having to get up early if the meeting isn't likely to happen
[12:01:05] <wardi> nah, this is normal schedule for me anyway.
[12:01:14] <rossjones> I'll join the call in case anyone turns up.
[15:18:11] <rossjones> joetsoi isn't working on ckan any more, is he?
[15:34:53] <tktech> rossjones, did the meeting already finish?
[15:35:05] <rossjones> It did, 3 hours ago ;)
[15:35:12] <rossjones> 12UTC on Tuesdays
[15:35:22] <tktech> Welp
[15:35:40] <rossjones> wardi mentioned above he didn't know of any Solr5 docs ... so contributions very welcome ;)
[15:35:51] <rossjones> It's later on Thursdays.
[15:36:15] <rossjones> It's 14:00UTC.
[15:36:23] <tktech> The documentation needs updates for 4.3 and 5, both need changes to the default schema.xml and changes to the solrconfig.xml (due to knew Boolean types)
[15:36:41] <rossjones> Ah, that's going to be more problematic I think.
[15:36:55] <rossjones> Am sure I run on 4.3 somewhere with the standard schema though
[15:37:16] <tktech> Depends on what point version you're running :)
[15:38:14] <tktech> https://github.com/ckan/ckan/issues/2524
[15:38:26] <tktech> Looks like we actually discussed one of the small changes in September
[15:39:08] <tktech> Do the circle.ci tests run against multiple solr versions?
[15:39:17] <tktech> That might be a good change, I think
[15:41:06] <rossjones> I can't assign you that bug unless I add you to the contributors team.  May I do that?
[15:42:09] <tktech> Sure, I don't mind.
[15:42:26] <tktech> This issue is fixed in Solr in 5.2.2, but 5.2.1 is still the most common in the ubuntu repos.
[15:42:42] <rossjones> Do you think it'll need a second schema alongside the other one, and documentation around which to use?
[15:42:58] <tktech> Nope, the changes should work for >=4
[15:43:25] <tktech> For example, the default solrconfig.xml in 5 references new boolean types
[15:43:43] <tktech> But the default CKAN schema.xml is missing the type definition.
[15:43:50] <tktech> Simply adding it to schema.xml for all versions is fine
[15:45:55] <rossjones> Oh that's good.  And testing against multiple solrs in circle would be great.  I think there's a hope we can move to circle eventually.
[15:46:21] <tktech> Looks like it's currently testing against 4.3.1
[15:51:50] <tktech> Ugh, Ubuntu 12.04LTS has solr 1.4.1, 14.04LTS has 3.6.2.
[15:54:58] <rossjones> :) Let me know when the invite arrives via github and I'll assign you that ticket ;)
[15:55:12] <rossjones> I hate solr
[15:56:00] <tktech> rossjones, I've accepted it
[15:56:21] <tktech> Is there some specific case for keeping solr around?
[15:56:29] <rossjones> Welcome to the madhouse.
[15:56:48] <tktech> Postgres has more than sufficient plain-text search capabilities for what CKAN actually exposes, and as a caching layer it leaves a lot to be desired.
[15:56:58] <rossjones> I think we use Solr because it works, and nobody wants to replace it, or abstract it out to support more than one backend
[15:57:12] <rossjones> I think it is the lack of facets that is the problem with pg
[15:57:45] <rossjones> One day, I hope we can get to a place where we don;t need to cache in Solr, but we're probably still some way.
[15:58:55] <tktech> Out of the box faceting support is a good point
[15:59:23] <tktech> I think the background workers will probably come first.
[15:59:36] <tktech> Redis being a hard requirement means you have another option for caching
[16:06:00] <rossjones> This is true, when I ever get around to finishing that PR
[19:31:21] <wardi> rossjones: multi-select facets development is in my future, it seems solr already has a really nice way of handling that (exclude the current facet when returning numbers for each facet)
[19:40:06] <wardi> oh, actually not on my list yet, tktech might be the one working on it

2016-02-29
[15:43:10] <tktech> Anyone know of tucked away documentation I've missed for setting up CKAN with SOLR5?
[15:43:18] <tktech> Otherwise I'll write some

2016-02-28

2016-02-27

2016-02-26
[12:10:31] <rossjones> Hey amercader might you be near London on the 8th March?
[12:14:16] <amercader> rossjones: unfortunately not
[12:14:22] <rossjones> :(
[12:14:31] <rossjones> It's where all the cool kids will be.
[12:15:07] <amercader> I know, at least a lot of Canadians will
[12:37:02] <amercader> I someone getting these randomly on master? `AttributeError: `get_validator` not found in plugins toolkit`?
[12:37:08] <amercader> preceded by `KeyError: 'pylons.h'`
[12:53:27] <wardi> hmm. could be related to toolkit change I made recently
[12:55:45] <wardi> amercader: does this help https://gist.github.com/wardi/bb55c3bbf651f0f4fb53
[12:56:27] <amercader> wardi, checking now
[12:56:39] <amercader> here's the full error: https://gist.github.com/amercader/f107d0d13072473950f0
[12:57:59] <amercader> wardi: seems to work fine after a few restarts
[12:59:06] <wardi> amercader: yeah, I saw some weirdness with paster and automatic reloading
[12:59:18] <wardi> this seemed to make it go away for me
[13:00:41] <amercader> great
[15:34:01] <travis-ci> ckan/ckan 2845-wsgi-dispatcher f0b2c87 https://travis-ci.org/ckan/ckan/builds/112028192 amercader: The build was broken.

2016-02-25
[02:56:27] <faust> hello
[10:54:56] <rossjones> wardi  sorry, won't make meeting today, still at training.
[16:51:27] <LondonAppDev> Does anyone know anything about harvesting data from Dublin Core?

2016-02-24
[10:51:54] <folkert> hello, apologies if this is the wrong forum...
[10:51:55] <folkert> we're currently looking for an individual or organisation to help us with some CKAN development tasks. specifically, we have a fork of CKAN that we've been using in-house and now want to have some fixes/changes made to the code. we estimate the effort to be on the order of 1-2 man months, assuming familiarity with CKAN. this is a commercial offer, so we will provide compensation for the effort, but need to retain all rights in return.
[10:51:59] <folkert> please feel free to get in touch if you are able to help us out :)
[10:57:01] <micniel> Hi everyone. I'm trying to use the datastore_delete API to empty a table in the datastore - but not deleting it. I guess I need to use filters, but I'm not able to add ex. {'_id': '*'} or {'_id': '>0'}
[10:57:14] <micniel> I've also posted the question on SO: http://stackoverflow.com/questions/35598133/delete-all-records-with-id-higher-than-x-in-ckan
[10:57:21] <micniel> Can anyone help?
[15:15:55] <yanik> is there is a way to sending notofication to user ?
[15:19:25] <yanik> for example like error msg https://github.com/ckan/ckan/blob/602b6f05dceefb2c98531eab81c7cbdea20821fb/ckan/controllers/user.py#L394
[15:19:54] <yanik> i need similar notification after dataset added [only]
[15:22:54] <yanik> nvm, looks like h.flush_* worked perfectly fine
[15:23:14] <yanik> at least some think in CKAN works out of box :D
[17:16:48] <tktech> https://github.com/ckan/ckan/pull/2885
[17:16:53] <tktech> Teeny tiny change that fixes datastore_delete
[21:37:48] <rossjones> If anyone is in the vicinity of London on March 8th, we're having a drink^H meetup.
[21:46:16] <corebits> ;)
[21:46:24] <corebits> I will be there.
[21:46:32] <rossjones> tktech is coming too!
[21:46:53] <rossjones> Although it's rather a long way for a pint.
[21:47:17] <tktech> Redeeming some of those visa points :)
[21:47:24] <tktech> I will likely stick around for the week
[21:47:58] <rossjones> Cool.
[21:49:56] <rossjones> I am giving up on hotel wifi and going to bed :(
[21:59:49] <corebits> tktech: that's awesome.
[22:21:28] <tktech> $4999 flight if I leave on the 7th and come back on the 9th
[22:21:38] <tktech> $899 flight if I stay until Sunday
[22:22:35] <tktech> It's 6x cheaper to do two one way tickets, what a racket!
[22:22:39] <corebits> Oh, I thought you were already going to be in the area. Is that 899 return ?
[22:23:00] <corebits> tktech: Flights within canada are worse I find.
[22:23:23] <tktech> $899 round trip, direct from Ottawa to Heathrow
[22:24:06] <tktech> Which is actually quite good, cheaper than getting to Vancouver.
[22:24:25] <tktech> But if they know you want to do a quick business trip, they increase the cost 6x.
[22:24:50] <tktech> They probably do that making the assumption that the office is paying and won't even give it a second thought
[22:26:09] <corebits> I just got a great deal $815 return edmonton/ottawa. I think your 899 international flight is greater value
[22:56:13] <tktech> Yeah, can't complain about that price.

2016-02-23

[12:02:05] <wardi> rossjones: meeting?
[12:15:15] <rossjones> will be a cpl minutes.
[12:47:20] <rossjones> wardi mobile app seems to have a mute button, is it just the web plugin that doesn't do audio?
[12:47:40] <wardi> rossjones: I think it's something she configured on her end
[12:47:52] <rossjones> Ah okay.
[12:48:04] <wardi> it just hasn't been available when I've connected in the past
[12:48:38] <rossjones> The UK toll free number is a mail-order delivery company ...
[12:48:40] <rossjones> eek
[13:06:22] <amercader> trying to join, hopefully will be there soon
[13:06:28] <rossjones> amercader  use skype
[13:06:37] <rossjones> :)
[13:06:52] <amercader> what number did you use?
[13:07:41] <rossjones> PMd it to you
[13:07:41] <amercader> a robot is telling me that the call could not be completed
[13:07:53] <rossjones> did you select US?
[13:07:55] <wardi> tried the 613 number?
[13:08:15] <amercader> in
[13:11:42] <amercader> wardi, rossjones: is there a doc or pad for notes?
[13:13:01] <rossjones> https://pad.okfn.org/p/somethingorother?
[14:08:51] <rossjones> wardi  was v. useful.
[14:09:47] <wardi> yeah, lots of great info
[14:21:01] <rossjones> I don't think Steven made it to the call though :(
[15:17:10] <pauli_> Hi there. Any idea why https://github.com/ckan/ckan/blob/ckan-2.3.3/ckan/templates/base.html#L89 produces some kind of URL list (https://somedomain.foo, somedomain.foo/) instead of a single one (https://somedomain.foo)?
[15:17:50] <pauli_> Running on a CKAN 2.3.x release.
[15:20:14] <pauli_> Naiv solution would to do a split by ',' after https://github.com/ckan/ckan/blob/ckan-2.3.3/ckan/lib/helpers.py#L109, but I would like to know the reason how and why this URL is built the way it is.
[15:31:55] <rossjones> pauli_  seems strange that it would return a list. Same code in 2.5 though, so lemme check.
[15:33:33] <pauli_> rossjones: It's not from type list, but the the string is so to speak listish ;D
[15:34:05] <rossjones> pauli_ Sure, just checking out what my local copy shows.
[15:36:09] <rossjones> Okay doesn't show for me. What's your ckan.site_url from your .ini
[15:36:27] <rossjones> and what other changes from default have you made
[15:42:42] <pauli_> ckan.site_url is https://box.x.y.somedomain.foo. What other changes do you mean? Code or configuration wise?
[15:45:31] <pauli_> I guess the problem lies in _pylons_default_url (https://github.com/ckan/ckan/blob/ckan-2.3.3/ckan/lib/helpers.py#L109). But not sure where to jump to. Does it come from the pylons or requests module?
[15:47:08] <rossjones> pauli_ pylons and the routes lib.  Never seen this before though.
[15:50:51] <rossjones> there's some mention of routes returning a tuple if the mapper has debug=True.
[15:52:08] <rossjones> an your list-ish thing is a tupl.
[15:57:23] <rossjones> But I can't replicate it sorry, maybe the mailing list (ckan-dev) or stackoverflow might be able to help.
[19:20:06] <wardi> rossjones: he had family obligations it seems
[22:10:48] <rossjones> wardi ah that's fair enough. He's done plenty of late nights already too.
[22:11:17] <rossjones> Was more concerned/worries than querulous
[22:11:40] <rossjones> Also, thanks for merging the github issue/pr templates - let's see how long before it annoys someone ;)

2016-02-22
[20:44:13] <travis-ci> ckan/ckan 2848-tests 5bff88e https://travis-ci.org/ckan/ckan/builds/111050189 amercader: The build was broken.
[21:02:11] <wardi> we should invite Alex to the next dev meeting
[23:27:06] <travis-ci> LaurentGoderre/ckan travis-docker b14fb43 https://travis-ci.org/LaurentGoderre/ckan/builds/111092131 Laurent Goderre: The build has errored.

2016-02-21

2016-02-20
[22:44:20] <dan13l> ckan noob here :)

2016-02-19
[17:43:20] <ageara> Seems that this https://github.com/ckan/ckan/wiki/Dev-Meeting-Notes  is lagging this https://pad.okfn.org/p/ckan-meeting ?
[17:44:09] <wardi> ageara: yeah, someone is supposed to paste the text over from the pad occasionally
[17:44:49] <ageara> Also does anyone know if there is an update to this http://docs.ckan.org/en/ckan-1.8/domain-model-resource.html ?
[17:49:04] <ageara> Why doesn't  demo.ckan.org (version 2.4.1) populate the hash, last_modified or size elements for resources - they are all nulls? http://demo.ckan.org/api/3/action/resource_show?id=965e4c6a-c756-4bef-9a16-6ba1ca24ea5b
[17:54:02] <wardi> ageara: not implemented at the moment. last_modified gets set now for uploaded files IIRC
[17:54:50] <wardi> for urls or datastore resources there's nothing stored in last_modified
[18:19:57] <ageara> wardi: Thanks @wardi  too bad the resource_show can't give the currency of the datastore content.
[18:20:41] <wardi> ageara: it could, it would just make the datastore_upsert call more expensive
[18:21:03] <wardi> you can change that sort of thing from an extension
[18:22:21] <ageara> Anyone aware of any implementations of CKAN using datastore upsert - other than called from DataPusher?
[18:22:42] <wardi> sure, I do
[18:23:17] <wardi> creating datastore tables directly gives a lot more control
[18:36:00] <ageara> How can we determine the currency (last update) of datastore resources? Is there a datastore_show equivalent API call with last update ?
[18:37:17] <wardi> ageara: are you only updating datastore with datapusher?
[18:37:33] <ageara> @ this point yes
[18:38:53] <wardi> it looks like datapusher records when its jobs are run
[18:39:39] <wardi> but when you upload a file that date should be set immediately (which will be slightly before the datastore table is updated)
[18:41:05] <wardi> ageara: task_status_show might have what you need
[18:41:36] <ageara> wardi: will check - Thanks.
[18:59:21] <ageara> Am I using resource_status_show API request correctly - leads to 500 error http://demo.ckan.org/api/3/action/resource_status_show?id=965e4c6a-c756-4bef-9a16-6ba1ca24ea5b
[19:25:25] <wardi> ageara: looks like it, but that's not a resource with a file uploaded

2016-02-18
[13:13:08] <rossjones> Afraid I can't do the meeting again today wardi brook - much skyping this afternoon :(
[13:16:01] <brook> I can't make it either.
[14:00:35] <wardi> rossjones: meeting?
[14:00:46] <wardi> ah
[14:45:46] <rossjones> wardi if you're the only one, just assign everything to brook, he said it was fine ;)
[14:46:19] <wardi> rossjones: I've got all next week to do that
[14:46:42] <rossjones> Should be at Tues next week, but not Thurs.
[14:48:16] <rossjones> Except, that's a different meeting.
[16:30:28] <rossjones> Interesing CKAN based UI -> http://docs.hdx.rwlabs.org/adding-data-is-now-easier-on-hdx/
[16:40:16] <wardi> that's very nice.
[18:59:49] <rossjones> https://github.com/blog/2111-issue-and-pull-request-templates <-- should we add one of these?
[19:07:14] <wardi> rossjones: amercader raised that at the meeting. I say go for it
[19:07:25] <rossjones> https://github.com/ckan/ckan/pull/2881
[19:07:28] <rossjones> ;)
[19:20:39] <rossjones> wardi just making that change.
[19:23:08] <wardi> oh, and one for "this change is a bug fix only, consider backporting to release versions"
[19:25:13] <rossjones> !!
[19:25:31] <wardi> no?
[19:25:42] <rossjones> Yes, but I just squashed and pushed ;)
[19:34:40] <rossjones> beer o'clock
[19:39:05] <travis-ci> ckan/ckan github-issue-template 21dfe5e https://travis-ci.org/ckan/ckan/builds/110201390 Ross Jones: The build has errored.

2016-02-17


2016-02-16

[01:53:51] <ThaZeus> Oops wrong ckan :) looking for the ksp one
[11:56:22] <rossjones> Can't make team meeting today.  Only one new issue though since last thurs.
[13:10:54] <wardi_> so, should I remove the SimpleDumper completely?
[13:13:18] <wardi_> rossjones: ^ would you have any objection to that?
[13:13:40] <rossjones> I think so, ckanapi is better.
[13:13:51] <rossjones> wardi_  ^
[13:14:09] <wardi_> cool
[13:15:18] <wardi_> user dumper too?
[13:17:55] <wardi_> hmm. ckanapi needs better docs. dump/load support users and (old) related items too
[13:26:18] <rossjones> wardi_ Yup, all of those things that are done better in ckanapi I think we should remove from core CKAN.
[13:26:24] <rossjones> Documentation aside
[13:37:56] <rstolt> So far I'm now able to do a JSON export via ckanapi + jq. Weird thing is that it now throws some errors when running from a shell script, while the same command (echoed it) runs fine via terminal.
[13:38:28] <wardi_> rstolt: what sort of errors?
[13:39:10] <rstolt> wardi: http://pastebin.com/raw/c67pTXzQ
[13:39:45] <wardi_> solr error. interesting
[13:40:12] <wardi_> do you use a proxy?
[13:41:03] <wardi_> compare your shell environment to the one in the script
[13:43:13] <rstolt> Pretty sure we're using a proxy.
[13:44:03] <wardi_> env | grep -i proxy  # and compare to inside your shell script
[13:48:51] <wardi_> rossjones: my better-written cli modules in extensions tend to just call a bunch of actions. I was thinking instead of adding commands to paster it would be better to have those commands added to ckanapi. That would let me run them on remote ckans just like local ones
[13:49:28] <rstolt> wradi: There are non via terminal, via shell script I get several: http_proxy={{ http_proxy }} https_proxy={{ http_proxy }} no_proxy={{ no_proxy }} 192.168.789.110
[13:49:32] <travis-ci> ckan/ckan 2879-remove-lib-dumper 15a4906 https://travis-ci.org/ckan/ckan/builds/109601611 Ian Ward: The build failed.
[13:49:53] <rstolt> sorry wardi, that is :)
[13:50:27] <rossjones> wardi_ I think the CLI scripts could definitely use a tidy-up, why not add to ckanapi for now, and then slowly remove them from core?  We should also ship ckanapi with core (somehow) but still keep it separate.
[13:50:28] <wardi_> rstolt: so you probably have to add an entry to your no_proxy line for your solr url
[13:51:28] <wardi_> rossjones: let me put a proper release of ckanapi out and I'll add it as a ckan requirement
[13:51:44] <rossjones> wardi_ Cool. Good plan.
[13:52:43] <wardi_> what I meant though was allowing plugins to register ckanapi subcommands similar to how they register paster commands now
[14:06:11] <rossjones> Oh I seeee. Yes, that sounds very useful.
[14:08:20] <rossjones> So I could install a plugin locally and managed a remotely installed plugin?
[14:08:33] <wardi_> yeah, that's the idea
[14:09:01] <rossjones> I think you are heading into a maze of twisty version problems, all similar.
[14:09:27] <wardi_> hehe, well, all you can do is access the public API provided on the remote
[14:10:01] <wardi_> so if that API lets you do bad things, you already have a problem
[14:10:03] <rossjones> I meant if you update an extension to register a subcommand with ckanapi, which is a core dep since 2.5.1 ...
[14:10:28] <rossjones> Spose would only be new extensions anyway initially.
[14:10:45] <wardi_> ah, I see. ckan pinning ckanapi's version is going to be a drag
[14:11:08] <rossjones> If we had a list of instances, and the versions they were running that was up to date, we could at least try and persuade people to upgrade.
[14:11:19] <wardi_> that might be a good reason to keep them separate
[14:15:50] <rossjones> I dunno, I think I prefer progress to stagnating over fear of breaking things.
[14:16:18] <rossjones> if there was a better way of giving plenty of advance notice of breakage, maybe it wouldn't be so bad.
[14:17:05] <rossjones> Was sort of why I was at one point keen to have plugins only work against specific versions, if you want ckanext-harvest for 2.3, then use this branch/release/tag.
[14:17:10] <wardi_> well, so far there hasn't been a reason for ckan core to rely on ckanapi
[14:18:26] <rossjones> Even replacing the dump stuff with a stdout saying 'go install ckanapi' doesn't require it to be a dep.
[14:18:40] <wardi_> yep

2016-02-15
[06:54:55] <jude1> Hey quick question
[06:55:05] <jude1> I amwtiting templater
[06:55:22] <jude1> a template plugin but when i introduce the organization folder
[06:55:42] <jude1> inroder to override it is seem not to pick up my customizations
[06:55:48] <jude1> any pointers on debugging this?
[09:45:51] <rossjones> jude1 have you got a call to add_template_directory in your plugin ?
[12:16:37] <rossjones> http://blog.okfn.org/2016/02/15/introducing-viderum/ wins for misleading CKAN blog post of the day
[13:17:31] <wardi> rossjones: kind of reads like viderum built all those sites
[14:24:08] <pkmniako> o/
[15:47:39] <rossjones> wardi_ I am just being grumpy.
[16:42:15] <rstolt> Is there a way to make SimpleDumper.dump_json work with large datasets? Currently the process is killed. Relevant excerpt from the /var/log/kern.log is:
[16:42:27] <rstolt> Out of memory: Kill process 13615 (paster) score 596 or sacrifice child
[16:42:51] <rstolt> Replaced the default implementation (https://github.com/ckan/ckan/blob/9596c5c95d5bb232add5201f6436bc9093483619/ckan/lib/dumper.py#L46) with one writing chunks (http://pastebin.com/raw/6KmiPxG5)
[16:43:28] <rossjones> rstolt you should check out ckanapi as it is probably better - https://github.com/ckan/ckanapi
[16:43:52] <rossjones> s/probably/definitely/
[16:44:18] <rstolt> but still not able to dump our whole datasets (managed to write a 75 MB file, but not all of it).
[16:46:24] <rstolt> @rossjones Thanks for the hint, looks good for my use case.
[16:48:57] <rossjones> I'd file a bug if it doesn't grab everything
[17:19:27] <HTdsdtrt> test
[17:20:12] <rossjones> UnicodeDecodeError: 'ascii' codec can't decode byte 0xe8 in position 1: ordinal not in range(128)
[17:20:47] <rstolt> Too bad that it generates invalid JSON.
[17:21:09] <rossjones> rstolt  is it jsonlines?
[17:21:09] <wardi_> ?
[17:21:47] <wardi_> rstolt: ckanapi dump * generate json lines so that it can be streamed more easily
[17:22:11] <rstolt> ckanapi dump datasets --all -O /path/to/metadata-catalogue.json.gz -z -p 4 -c /path/to/production.ini -q
[17:22:35] <wardi_> right, the .json is incorrect :-)
[17:23:45] <rstolt> wardi So dropping the extension, that's it?
[17:24:14] <wardi_> well, you could use .jsonl.gz or .ndjson.gz to have an accurate extension
[17:24:35] <wardi_> I know there's a quick jq hack that can convert json lines to json
[17:26:48] <wardi_> ah, " | jq -s . " will convert to a giant json array
[17:27:16] <wardi_> (you might still run out of memory, you could just insert the commas and [] yourself
[19:55:39] <gam3guy> hey guys

2016-02-14
[08:09:34] <adam_9> ok, another one the documentation mentions enabling email notifications, although I can't find this in the UI
[09:02:58] <adam_9> Also, any tips on clearing the cache for ckan.site_logo
[10:19:03] <adam_9> n'ver mind that about the cache, I see that I set this in the UI and the app property in the ini file is only used for the default. got it.
[11:18:28] <rossjones> adam_9 you might try https://lists.okfn.org/mailman/listinfo/ckan-dev or stackoverflow - not everyone is about all the time on IRC.
[11:19:55] <rossjones> Email notifications docs at http://docs.ckan.org/en/latest/maintaining/email-notifications.html mention the cron task you need to set up.
[12:32:23] <adam_9> thanks rossjones

2016-02-13
[19:11:53] <adam_9> I am running python-ckan_2.5-trusty_amd64. I have configured the datapusher & datastore. everything looks good but the data explorer the UI looks pretty bad. Like this: https://dl.dropboxusercontent.com/u/10706440/Screen%20Shot%202016-02-13%20at%209.10.56%20PM.png
[19:19:09] <adam_9> btw, is there a better place to get support for this type of thing?

2016-02-12
[08:05:27] <rossjones> Thanks Zharktas, I've sent an invite to the 'can be assigned to issues/PRs' team :)
[10:30:37] <rossjones> Am closing old tickets today, sorry for the inbox pain this is likely to cause.
[13:10:03] <wardi> rossjones: i'm finding it somewhat therapeutic to see them all going by
[13:10:31] <rossjones> :D Me too. Trying to read them and make sure there aren't working PRs attached is taking the most time.
[13:10:53] <rossjones> Should have asked me triage our assigned PRs ... but hey ho ;)
[13:11:04] <rossjones> s/me/we/
[15:26:52] <corebits> oooh, someone is/was on a roll this morning ;)
[15:31:13] <rossjones> corebits we've got to clean up the stuff we'll never get to :( Or encourage submitter to send a PR.
[16:13:37] <rossjones> I'm off closing more tickets again!
[16:14:35] <rossjones> What's really frustrating is seeing commits in forks of CKAN that fix some of these tickets :(
[16:26:00] <rossjones> Closing everything with no activity since Aug 2014 or earlier.  It being assigned to an old milestone doesn't count.
[16:30:28] <rossjones> wardi have we decided what's happening with Docker? Is it going to be a separate repo somewhere?
[16:32:48] <rossjones> Would like to close the docker tickets.
[16:39:04] <wardi> rossjones: we should remove it because none of it is maintained at the moment
[16:40:10] <wardi> rossjones, brook: should I set up the LF meeting?
[16:51:51] <rossjones> wardi yes, LF meeting sounds like it is worth doing no matter what happens
[17:08:00] <rossjones> Down to 245 issues.

2016-02-11
[02:31:22] <Drackma> Hello everyone. Has anyone had a problem with CKAN installing mods right now?
[02:58:18] <Drackma> Hey CKAN should know the proper order to install things correct?
[12:37:40] <travis-ci> ckan/ckan solr-errors 4486d76 https://travis-ci.org/ckan/ckan/builds/108521292 David Read: The build failed.
[14:02:32] <rossjones> Is it meeting time brook amercader wardi ?
[14:02:39] <wardi> yes!
[14:02:46] <brook> I can't get in! Too many people!
[14:07:40] <amercader> we'll try this one in second:
[14:07:41] <amercader> https://hangouts.google.com/hangouts/_/okfn.org/ckan-meeting-2
[15:20:15] <rossjones> Zharktas can I send you an invite to the ckan org so I can assign your tickets to you (for when you're going to submit a PR)?
[15:26:34] <rossjones> This is not a ploy to drag you into CKAN core. Honest.
[18:31:39] <corebits> Hey Guys I am having an issue remebering how I obtained a list of package ID's in the past. I am needing to do a bulk delete action, and recall doing this in the past by passing a list of ID's to ckanapi.
[19:42:52] <wardi> corebits: package_list?
[20:26:21] <corebits> wardi: can I get a list of the ID's only. I need to pass the list to ckanapi delete
[20:27:02] <wardi> package_list gives you the names, but those names can be send to package_delete
[20:27:14] <wardi> (as the value of the id parameter)
[20:28:22] <corebits> Ah ok, Thanks. I will try that. Sorry under the gun to do do a bulk delete today.
[21:22:05] <Zharktas> rossjones: sure thing, this is now second ckan instance i'm developing in finland and there might be more, so this probably is not the last pr i'm making :p

2016-02-10

[07:56:58] <teemu> Hi, is admin/trash available to and usable by all users intentionally?
[07:57:48] <teemu> even without logging in
[08:14:53] <teemu> okay, it's just rendering the template but nothing's actually happening
[08:17:06] <Zharktas> ckan-admin controllers and admin templates propably should named consistantly :p
[08:58:30] <rossjones> PRs welcome!
[12:25:54] <rossjones> Random idea: Pull all of the CKAN extensions from the registry and be able to search for usage of ckan things.  For instance, would be nice to know if anyone is using fq_list.  Anyone?
[12:31:13] <wardi> rossjones: you want to get rid of it and just accept a list to the fq parameter instead?
[12:34:24] <rossjones> Well.  Currently the fq is split on ' ' and then put back together and passed as a string to solr.  This breaks when you tag terms, it needs to be a list.  So was thinking we should accept a list in fq.  For API calls should convert the string to a list (to stop breakage) as splitting on ' ' here is no worse than currently.
[12:34:33] <rossjones> Not sure I actually want to remove fq_list right now.
[12:35:22] <wardi> it's lousy because what do you do if you have a value in fq and in fq_list
[12:38:02] <rossjones> Yes, exactly.
[12:38:34] <rossjones> I could just use fq_list I suppose, but will still break when it sends to Solr (because of the {TAGS}).  Maybe I should just solve that problem?
[12:38:50] <rossjones> but splitting on space is bad :(
[12:49:04] <rossjones> The problem, just out of general interest is at https://github.com/ckan/ckan/blob/master/ckan/lib/search/query.py#L331 where is wraps a single string in a list.
[12:49:40] <rossjones> Okay, enough thinking out loud now :) I think I've got it.
[19:06:28] <adam_9> whats the recommended size of EC2 instance to run CKAN?
[19:10:53] <adam_9> the minimum

2016-02-09
[10:48:01] <yanik> this one has only master https://github.com/okfn/ckanext-s3filestore
[10:48:07] <yanik> and looks like it's broken
[11:25:25] <memaldi> Hi all. I'm testing an extension that modifies the pkg_dict in IPackageController's before_view.
[11:25:42] <memaldi> But, when launching the test, the pkg_dict remains unmodified
[11:25:55] <memaldi> response = app.get('/dataset/{0}'.format(dataset['name']))
[11:26:49] <memaldi> and in the response, the modifications on the template applied by my plugin are here, but not the modifications of pkg_dict
[11:27:04] <memaldi> :(
[11:29:34] <memaldi> the problem could be here
[11:29:45] <memaldi> dataset = factories.Dataset()
[11:29:45] <memaldi> helpers.call_action('rating_create',
[11:29:46] <memaldi> package=dataset["id"],
[11:29:46] <memaldi> rating=RATING_VALUE)
[11:30:13] <memaldi> I suspect that 'rating_create' is not modifying the dataset...
[12:02:20] <amercader> rossjones: meeting?
[12:03:38] <rossjones> yanik might not be finished yet.
[12:03:41] <rossjones> amercader yes, one second.
[12:32:35] <yanik> amercader, ckanext-s3filestore is broken with current master?
[13:23:03] <brook> yanik - it should be fine. It's just an annoying test that differs between Travis and my local machine.

2016-02-08
[18:32:53] <rossjones> jude1 sorry, didn't realise it stored stuff in the DB :(
[19:07:25] <wardi> better than modifying the config file from the web process..

[12:22:56] <yanik> someone know about solr versions conflict? default solr-jetty almost never works from the box
[12:23:13] <yanik> and this problem not documented at all
[13:36:31] <rossjones> yanik  I create VMs almost every other week, never once had a problem :(
[13:36:48] <yanik> do you follow docs?
[13:36:54] <rossjones> on 12.04 or 14.04
[13:37:01] <yanik> example of a problem http://stackoverflow.com/questions/34661129/ckan-solr-on-ubuntu-jsp-not-configured/35271005#35271005
[13:37:04] <rossjones> Yes, I actually still copy/paste from them.
[13:37:28] <rossjones> Setting JAVA_HOME is mentioned in the docs ;)
[13:37:42] <yanik> yeah, but not on package/solr part
[13:37:50] <yanik> so people get confused
[13:38:06] <yanik> and you must set in /etc/profile
[13:38:27] <rossjones> You can set it in a few places.
[13:38:29] <yanik> somehow setting on /etc/default/jetty not work
[13:38:39] <rossjones> really?
[13:38:42] <yanik> yeah
[13:38:44] <yanik> try this
[13:38:49] <yanik> every time
[13:38:59] <rossjones> Both installations docs (package and source) point to the same Solr docs.
[13:39:11] <rossjones> I always add it to /etc/default/jetty
[13:39:19] <yanik> and its worked for you?
[13:39:21] <rossjones> Always
[13:39:26] <rossjones> Lemme me double check
[13:39:28] <yanik> and Always don't for me
[13:39:54] <yanik> i made like 10-15 setups so far
[13:40:13] <rossjones> I'll double-check, just booting VM, maybe I'm wrong.
[13:40:20] <yanik> and i don't really know much, just following the docs
[13:40:42] <rossjones> ah, that one doesn't have it at all.
[13:40:43] <yanik> np, i don't have this problem, but some people do
[13:41:02] <yanik> told ya :)
[13:42:10] <rossjones> On data.gov.uk we have this in our /etc/default/jetty -> JAVA_HOME=/usr/lib/jvm/java-7-openjdk-amd64
[13:42:26] <rossjones> And a few other things to tweak memory usage.
[13:42:32] <yanik> but can you checked on clean VM ?
[13:42:59] <rossjones> I tested the 2.5 packages with 12.04 and 14.04 - word for word from the docs.
[13:43:12] <yanik> wow, so I'm wrong somehow
[13:43:39] <rossjones> Maybe we both are.  I don't understand how it won't work for you.  You're on ubuntu, right?
[13:43:45] <yanik> yeah
[13:43:48] <yanik> clean 14.04
[13:44:02] <yanik> i can demonstrate all the steps
[13:44:07] <rossjones> Using master?
[13:44:11] <rossjones> Or 2.something
[13:44:15] <yanik> why master? 2.5
[13:44:18] <yanik> following docs
[13:44:35] <rossjones> So when you do the installation, you do
[13:44:40] <rossjones> sudo service jetty restart
[13:44:44] <rossjones> and it fails.
[13:44:52] <rossjones> And you add to /etc/profile and it works?
[13:45:00] <yanik> nope, jetty runs fine
[13:45:02] <yanik> but http://stackoverflow.com/questions/32047288/ckan-solr-jsp-support-not-configured
[13:45:09] <yanik> this error appeared
[13:45:16] <yanik> 'JSP support not configured'
[13:45:29] <rossjones> Ah okay, JAVA_HOME is I think irrelevant to that.
[13:45:43] <yanik> not really, adding JAVA_HOME helps
[13:46:07] <yanik> but not in jetty config
[13:46:11] <yanik> in global
[13:46:22] <yanik> strange, right?
[13:46:46] <rossjones> Yes. Very.
[13:47:06] <rossjones> The original issue with jetty in 1404 seems to have been fixed according to https://github.com/ckan/ckan/issues/2019
[13:47:08] <yanik> if you wood have like 10-15 mins I can demonstrate this behaviour tommorow
[13:47:45] <rossjones> Have you tried Adria's commands at https://github.com/ckan/ckan/issues/2019#issuecomment-143753451 to see what you get?
[13:48:00] <yanik> i can double-check and we can talk tommorow
[13:48:04] <rossjones> I can *possibly* spare 15 minutes, but I'm not really on CKAN atm. Have been seconded :)
[13:48:07] <yanik> via sharing screen
[13:48:17] <yanik> oh, np
[13:48:35] <rossjones> Give me a shout tomorrow afternoon (about same time?) and/or grab me on Skype
[13:48:51] <yanik> give me your skype id
[13:49:04] <rossjones> PM'd
[13:49:43] <yanik> done, talk to you tommorow
[13:49:55] <rossjones> Okay, back to my Flask app :P
[13:50:47] <yanik> u better check aiohttp ;)
[13:56:00] <rossjones> I tried to drop an e-bomb (let's use Elixir) but to no avail.
[14:23:56] <rstolt> Is there a way to require an API Key auth for the package_create action? Or is this implicit on when apikey_header_name is configured?
[15:27:26] <rossjones> rstolt should be on by default, unless you've sset http://docs.ckan.org/en/latest/maintaining/configuration.html?highlight=apikey_header_name#authorization-settings strangely...
[15:27:29] <rossjones> ..oh, he's gone.
[15:59:20] <jude1> hey quick question
[15:59:42] <jude1> anyone know where i could turn off the custom style {{g site_custom_css}}
[15:59:52] <jude1> or where it is defined in the config?
[16:12:54] <rossjones> jude1 do you mean ckan.site_custom_css in the .ini file?
[16:13:31] <jude1> is it in the .ini file
[16:13:49] <jude1> the production/or development.ini?
[16:14:32] <rossjones> Am not sure what you mean by 'turn off' but yes, one of those .ini file.s
[16:14:59] <jude1> yea need to take it off rather than overriding the base.html
[16:15:12] <jude1> and removing the line with it
[16:15:45] <jude1> i.e https://github.com/ckan/ckan/blob/master/ckan/templates/base.html#L82
[16:16:21] <jude1> seems I am working on a setup which has that set up but can not see where g.custom_css is defined in the .ini file
[16:16:22] <rossjones> That'll only set it if you have at some point given it a valuie.
[16:16:50] <jude1> is it stored in the db? or the config file?
[16:19:01] <rossjones> Config file,
[16:20:49] <jude1> what parameter?
[16:37:23] <rossjones> ckan.site_custom_css
[16:38:49] <rossjones> jude1 other place to check is at /ckan-admin/config (as a sysadmin).
[16:39:02] <rossjones> Although I see to recall that just wrote it to the config file.
[16:48:01] <jude1> wow seems it is in the ckan-admin/config interface
[16:48:11] <jude1> i guess this is actually stored on the database?
[16:48:15] <jude1> as config options?
[16:55:28] <jude1> got it
[16:55:38] <jude1> stored in the system_info table

2016-02-07

2016-02-06

2016-02-05
[07:05:55] <teemu> is there a user session level storage where I could put active CSRF tokens? repoze metadata?
[11:52:41] <LondonAppDev> Does anyone know which JS makes the "order by" select box auto-submit when clicked?
[11:53:52] <LondonAppDev> Also where is "resource 'base/ckan'" defined? I have searched GitHub for base/ckan but I can't find where these resources are defined anywhere...
[12:39:15] <Zharktas> LondonAppDev: https://github.com/ckan/ckan/blob/master/ckan/public/base/javascript/resource.config defined here
[12:42:49] <LondonAppDev> Cheers
[14:06:28] <holylime> Isn't there supposed to be a ckan meeting now?
[14:07:28] <wardi> not on friday, no
[14:07:44] <wardi> https://pad.okfn.org/p/ckan-meeting
[14:09:13] <holylime> Well the Google link still says 2pm UTC friday.  Which is where I thought the meetings were fridays.
[14:09:28] <holylime> And adjusted for my local time that made it 9am my time.
[14:10:16] <wardi> ah, ok. I wonder how to make a link that includes the week day
[14:10:54] <holylime> That's why I thought Thursday UTC 1400 was my local time converted to friday
[14:11:58] <wardi> when I follow the link it shows the UTC day of the week and my local day of the week
[14:13:12] <wardi> maybe we can post an ical link or something
[14:14:03] <holylime> Ya I get something like 2:00 PM Friday, Coordinated Universal Time (UTC) is 9:00 AM Friday NY
[14:14:13] <holylime> so its definitely T/Th
[14:22:22] <holylime> Okay so it would be 9am on Thursday then?
[14:22:33] <holylime> I just want to make sure so I don't miss the next meeting I can attend.
[14:22:57] <holylime> I'm on Eastern Standard Time.
[14:23:25] <wardi> so you'll be up with me at 7am on Tuesday? :-)
[14:24:37] <holylime> I was thinking about that and I'd be driving to work at that point.
[14:26:00] <wardi> I'd say it's a reason to work remote (at least for the morning) and skip the traffic
[14:26:50] <holylime> Unfortunately I do not have that luxury.  I wish I did.
[14:27:04] <holylime> Which is the more important meeting to attend?
[14:27:11] <holylime> The Tuesday or Thursday?
[14:27:28] <wardi> they are usually the same
[14:27:37] <holylime> Thursday it is!
[14:27:59] <holylime> I will see you then.  And I'm excited!  I really am :-)
[14:28:46] <wardi> holylime: can you talk about the site you're working on?

2016-02-04
[01:19:03] <wardi> corebits: thanks. you're seeing this on an unmodified ckan with no other extensions?
[01:34:27] <corebits> hmm, no...
[01:34:44] <corebits> I'll unload my extensions and check again
[02:34:40] <corebits> wardi: Sorry :(  I got way ahead of myself on this one.
[02:35:11] <corebits> it is something in our theme, I will dig at it more tomorrow.
[14:02:47] <amercader> rossjones, brook : anyone up for a meeting?
[14:33:58] <rossjones> amercader sorry, pair programming with morty + dread today
[14:34:27] <amercader> rossjones: triple programming!
[14:34:36] <rossjones> It's the future!
[14:34:55] <rossjones> Morty just took us the restaurant-of-infinite-meat and now we're all ill.
[14:47:29] <wardi> I hope restaurant-of-infinite-meat is its real name
[15:07:05] <yanik_> can I order pizza, double cheese?
[15:49:10] <memaldi> Hi all, I'm trying to override the behaviour of the user autocomplete field when adding users to an organization
[15:49:28] <memaldi> I want to show the full name instead of the name in the search box
[15:50:32] <memaldi> I've tried with data-module-key="fullname" but I think that I'm missunderstanding something
[16:12:42] <LondonAppDev> Does anyone know why I would start getting "AttributeError: 'module' object has no attribute 'PackageRole'" on my harvester after upgrading to CKAN 2.5?
[16:15:13] <memaldi> We are still in 2.4 :(
[16:21:05] <LondonAppDev> memaldi: do you mean the harvesters are only compatible with 2.4?
[16:21:14] <memaldi> no no
[16:21:34] <memaldi> I mean that we (our team, in my university) we are still working over 2.4
[16:21:56] <memaldi> and unfortunately I can't help you
[16:22:06] <LondonAppDev> Ahhh ok, thanks anyway memaldi.
[16:22:12] <memaldi> ;)
[16:33:28] <LondonAppDev> Yes PackageRole has been removed in 2.5.
[16:33:44] <LondonAppDev> Which the ckanext-harvest still uses, that's my problem.
[16:34:53] <wardi> what's a PackageRole?
[16:36:02] <LondonAppDev> wardi it's a permissions thing. Like here: https://github.com/ckan/ckanext-harvest/blob/master/ckanext/harvest/harvesters/ckanharvester.py#L466
[16:36:02] <memaldi> ok, the answer to my question is data-module-label="fullname"
[16:36:03] <memaldi> :D
[16:37:16] <wardi> LondonAppDev: those haven't been used in some time, though.. right?
[16:37:49] <wardi> all the current permissions are based on orgs and memberships
[16:38:23] <LondonAppDev> wardi: I just based my harvester off the existing system. Will convert it.
[16:43:46] <LondonAppDev> wardi: actually the variable pkg_role isn't even being used. Just a case of deleting it lol.
[16:43:58] <LondonAppDev> Not sure how it got into my code.

2016-02-03
[05:52:03] <teemu> wardi: roger
[08:49:42] <rossjones> Apologies for missing meeting wardi + brook - I won't make tomorrow's either :(
[08:50:22] * brook assigns all the things
[08:58:06] <rossjones> Noooooo!
[08:58:18] <rossjones> Anyone interested in adding bittorrent support to CKAN? -> https://github.com/ckan/ideas-and-roadmap/issues/168
[09:16:00] <rossjones> Oh amercader says it's done -> https://github.com/microcomp/ckanext-torrent
[12:15:31] <wardi> rossjones: :-(
[12:16:01] <wardi> I want to hear about multi-select facets
[12:24:32] <rossjones> It gets worse, I'm only 50% time on CKAN after this week, so will probably only make one a week.
[16:19:03] <LondonAppDev> Hey guys, does anyone know of any helpers which allows me to tell in a CKAN template if I am on a specific page? I want to add 'active' to my custom navigation, but h.build_nav_main won't work because I need to define different classes.
[16:30:15] <rossjones> LondonAppDev  is request.path not available in the templates?
[16:30:39] <rossjones> {{ 'active' if request.path.startswith(...) ... else '' }
[16:34:47] <rossjones> or copy+replace build_nav_main with something else.
[16:35:37] <LondonAppDev> thanks rossjones.
[16:36:06] <rossjones> It's not perfect, putting that in class="" but it'll work.
[19:53:03] <rehunted> hello! I changed the site_domain and already replaced all occurrences in the database, but FOO/dataset/ID/resouce/$id continues to report the old url
[19:53:09] <rehunted> there's any cache?
[19:53:28] <rehunted> I already restarted, changed the template (footer)
[19:54:11] <rehunted> I tested if all places are replaced by doing an pg_dump -F plain and then grep against it
[19:54:12] <wardi> paster search-index rebuild?
[19:54:37] <rehunted> wardi, hmmmmm
[19:54:44] <rehunted> I did not try it !
[19:55:24] <rehunted> I thought this page came from database: http://datos.ciudatos.com/dataset/manizales-subjetivos_anual/resource/36d159f4-ebe3-492d-98e3-c1b77a9b6984
[19:57:53] <wardi> datasets+resources pretty much always come from solr
[19:58:09] <wardi> (because the complete json version is cached there)
[19:59:31] <rehunted> wardi, you got it! Thanks. I will put this on crontab. Just in case
[20:02:13] <wardi> rehunted: that's a good idea. That way org name changes will get picked up too
[20:02:29] <rehunted> oh! that's important too!
[20:03:06] <wardi> we really should add that to the docs as a recommended best practise
[22:35:02] <corebits> wardi: are you aware of any issue with scheming, that may cause duplication of fields on display
[22:36:37] <corebits> I am still testing, but it appears if I update to rel3ease-1.0.0 I am seeing duplicated descriptions on display
[22:38:55] <corebits> I will test further and file an issue, if this persists.
[23:06:33] <corebits> it appears to be commit 8e83c0ecf
[23:06:40] <corebits> will file an issue

2016-02-02
[10:32:03] <teemu> afternoon
[10:32:42] <teemu> according to https://github.com/ckan/ckan/pull/2359#issuecomment-132502500 there are plans on adding CSRF protection to CKAN core
[10:32:53] <teemu> has there been any work on this?
[11:10:06] <memaldi> Hi all
[11:10:32] <memaldi> Is there any procedure to override the user modification form?
[11:10:53] <memaldi> Y mean, i want to avoid users to modify their email.
[11:12:14] <memaldi> I'm going to try iterating the c.form in the edit.html template hiding the email field, but I don't know if this is a suitable way to perform this
[11:17:51] <memaldi> Ok, I just see edit_user_form.html
[12:03:33] <wardi> rossjones: meeting?
[12:10:49] <wardi> memaldi: yes, just the template and controller. There's nothing like IDatasetForm or IGroupForm for users (yet)
[12:11:20] <amercader> nigelb: it looks like I lost op when I was logged out?
[12:12:23] <memaldi> thanks @wardi
[12:13:16] <wardi> amercader: you might be able to use chanserv to get your op back
[12:13:31] <wardi> if nigelb got to setting that up
[12:15:14] <amercader> not sure what that is but thanks, I'll check
[14:55:59] <wardi> teemu: noone has stepped up to implement csrf protection yet
[15:16:41] <yanik> if someone using CKAN on AWS what deployment tool is best?
[15:16:46] <yanik> since they have few
[15:17:08] <yanik> ElasticBeanstalk, CodeDeploy, ECS
[15:32:49] <rehunted> yanik, what service do you intends to scale?
[15:33:20] <yanik> you ment datapusher or ckan web server ?
[15:33:22] <yanik> or db?
[15:33:32] <rehunted> yanik, yep!
[15:33:47] <yanik> i dont want scale right now, i just want to have possibilities to do it in future
[15:34:02] <yanik> and will use S3 for datasets storage anyway, so not datapusher
[15:34:35] <yanik> rehunted, do you use CKAN in AWS?
[15:35:03] <rehunted> Because I don't think you will need those AWS services to scale. proably you will need only processing power during import (datapusher & plugins, where you can use Spot Instances), and then use cloudfront to cache web-service responses
[15:35:16] <rehunted> probably*
[15:35:48] <rehunted> yanik, no, I run somethings on AWS, but I run CKAN at OVH. Much better cost/benefit for my SLA
[15:36:45] <rehunted> and my CKAN is pretty small, less than 10gb and less than 1000 datasets
[15:37:29] <yanik> rehunted, mentioned EB because I don't want to bother with deployment either. And EB looks like great deployment tool
[15:37:46] <rehunted> but I play with the CKAN docker image for a few weeks, so I 'tried' to split services much as possible
[15:37:49] <yanik> wll check OVH, but i have like 2 days to finish configuration
[15:37:58] <rehunted> yanik, you could look at
[15:38:04] <rehunted> https://github.com/eokoe/appcivico-ckan-comovamos
[15:38:32] <rehunted> you can fork it and add the plugins you need. It's all in one 'solution',
[15:38:32] <yanik> rehunted, thats what I'm doing right now! I try deploy like multidocker container
[15:39:36] <yanik> rehunted, wow, maybe this is what I was looking for all these days
[15:39:53] <rehunted> you can use EC2 autoscaling min 1 max 1 to keep at list one instance 'online'
[15:40:21] <yanik> i tried edit https://github.com/wide-awake/docker-fiware-ckan but this one don't worked for me
[15:40:23] <rehunted> using RDS with multi-regions should help it too, but I don't recommend if you don't really need, since it double your costs!
[15:40:44] <yanik> rehunted, great, man! Thx alot
[15:40:57] <rehunted> yanik, you are welcome
[15:55:30] <LondonAppDev> Hey guys, latest version of CKAN is 2.5 right?
[15:58:48] <wardi> yes
[16:03:53] <LondonAppDev> wardi thanks. how come when I install from source it installs 2.4?
[16:04:55] <wardi> LondonAppDev: following which instructions?
[16:06:05] <LondonAppDev> wardi: oops. I somehow bookmarked the 2.4 instructions.
[16:08:33] <yanik> LondonAppDev, yeah, just switch to latest docs and y'll be alright
[16:08:41] <LondonAppDev> cheers

2016-02-01
[10:40:34] <travis-ci> ckan/ckan solr-error-msg-fix 502f841 https://travis-ci.org/ckan/ckan/builds/106178446 David Read: The build failed.
[13:40:50] <memaldi> Hi all! I'm trying to override the authentication function for package_create function, but It seems to not being called when trying to create a new package through the API...
[13:41:47] <memaldi> but in ckan/logic/action/create.py, in package_create I can see this:
[13:41:49] <memaldi> _check_access('package_create', context, data_dict)
[13:54:36] <rossjones> memaldi are you overriding package_create using the IAuthFunctions interface?
[14:03:46] <memaldi> Ok, the thing is that I'm trying to override the CKAN's API key with an external authorization service, but I'm seeing that before invoking the authorization functions, CKAN checks the API key
[14:03:46] <memaldi> and if this API Key is not correct returns an error
[14:16:17] <yanik> someone got my mail to mailing-list about docker? I have zero response ;/
[14:21:29] <rossjones> memaldi  you probably need to implement IAuthenticator
[14:21:49] <rossjones> You can then pull the key from the headers, look it up, and then set c.user/c.user_obj
[14:22:16] <rossjones> memaldi something like https://github.com/ckan/ckanext-persona/blob/master/ckanext/persona/plugin.py#L29
[14:22:25] <rossjones> yanik yes, but I know nothin about docker :(
[14:44:58] <wardi> yanik: I can remove some/all of the ckan docker images. is that what you're asking about?
[14:46:22] <yanik> @wardi, not really, but they are broken, its true. I just meant to understand if you guys interested in supporting Docker
[14:47:10] <yanik> @wardi and if yes -- how we can combined our efforts, since I'm working on Docker/CKAN right now
[14:47:27] <yanik> combine*
[14:49:53] <wardi> yanik: it's not a high priority for any of the core developers right now. It's proven difficult to share docker ckan work. It seems everyone likes to do docker their own way, and since ckan is a platform that you need to customize with extensions before using, simple docker images don't suffice
[14:50:54] <wardi> the best way to help would be to submit work to make ckan more service oriented
[14:51:16] <mikel_> thanks rossjones, I'm implementing the code into identify function and it seems to be working
[14:51:22] <wardi> such as not requiring copying a solr configuration manually
[14:52:04] <yanik> @wardi thats what i was asking for. What can make CKAN more service orientated? Flushing apache2 ?
[14:52:25] <wardi> plenty of users aren't on apache2
[14:52:37] <yanik> @wardi, ok, will check on Solr
[14:52:43] <wardi> there's also an issue of files being stores locally
[14:53:00] <wardi> both uploaded files and cached pages
[14:53:27] <yanik> @wardi, who? any articles/guides? Or everyone just make it's own configs
[14:54:19] <wardi> it's not hard to run ckan under nginx+uwsgi or whatever wsgi runner you prefer
[14:54:51] <wardi> so people that prefer that approach are doing it themselves so far
[14:55:36] <wardi> I don't think there would be much resistance to a change from apache, but it's also not blocking anything docker-related
[14:56:46] <yanik> get it
[16:19:06] <LondonAppDev> Hey guys, what is the most efficient way to get all packages with their extras using sqlalchemy?
[17:21:02] <wardi> LondonAppDev: I like to dump that list with cron+ckanapi and publish it as a dataset
[17:21:38] <wardi> usually yesterday's list as good enough for me
[17:54:06] <LondonAppDev> wardi: so you periodically make a dump of the data and store it as it's own dataset?
[17:54:08] <LondonAppDev> nice...

2016-01-31

2016-01-30

2016-01-29
[15:46:13] <travis-ci> ckan/ckan 2845-wsgi-dispatcher c2d9b56 https://travis-ci.org/ckan/ckan/builds/105699793 Brook Elgie: The build has errored.

2016-01-28
[06:00:46] <teemu> rossjones: probably, I'll see about it today
[11:03:38] <rstolt> Which branch do I use to start to get a fix / improvement into the release-v2.3.* branch?
[12:20:13] <amercader> oh ckan... https://github.com/ckan/ckan/issues/2856
[12:50:43] <wardi> rstolt is gone, but the answer is "always master"
[12:55:52] <teemu> wardi, rossjones: tested the PR 2846 in our project, seems to fix the logout issues
[13:09:22] <rossjones> Um. How do I add a dataset to a group (not org) on demo.ckan.org
[13:16:03] <amercader> rossjones: Groups tab on dataset page
[13:16:33] <rossjones> Ah right. I can never find anything in the core UI because ours is so broken, I mean different.
[13:54:51] <nigelb> rossjones: lol, nice save.
[14:00:36] <amercader> Late to the meeting, small emergency
[14:01:11] <wardi> rossjones: meeting?
[14:03:31] <wardi> amercader: should we wait?
[14:05:14] <amercader> I just need 5 min if you want to wait if not go ahead and I'll join
[14:22:38] <amercader> https://github.com/ckan/ckan/blob/master/ckan/lib/search/query.py#L333
[14:35:29] <nigelb> I was so confused.
[14:35:40] <nigelb> the dates on the meeting notes say 2015
[14:35:42] <nigelb> still :)
[14:36:05] <nigelb> also nice being on the meeting after more than a year away
[14:36:18] <amercader> oh nigelb forgot to say, can you make the tech team ops of this channel?
[14:36:26] <nigelb> yup!
[14:37:02] <nigelb> who have I missed?
[14:37:14] <amercader> dread, but he's not around now
[14:37:34] <nigelb> let me see if I can get the channel perms changed so you can op yourself
[14:37:42] <nigelb> (I'm not sure I have these permissions myself)
[14:38:50] <wardi> oh, is it 2016 now?
[14:43:20] <rossjones> wardi AND it's a leap year
[14:44:51] <nigelb> I wonder if java will die this year on Feb 29th.
[14:46:02] <rossjones> Like permanently?
[14:48:02] <nigelb> No, remember the leap second when java just gave up and consumed 100% CPU?
[14:48:14] <nigelb> I'm weary of java around date shifts now
[15:46:22] <rossjones> I'm very very wary of Java around everything.
[15:58:28] <rossjones> Running vulture on CKAN to find unused code .. found this ...
[15:58:29] <rossjones> Unused function 'jsmin_for_posers'
[16:15:23] <rossjones> Luckily I can remove it.
[16:16:23] <rstolt> I currently get a duplicate schema field error (https://github.com/ckan/ckan/blob/master/ckan/logic/validators.py#L826). In the import_stage of my custom harvester I pop the key from package['extras'], however the error still keeps popping up.
[16:17:01] <rstolt> Does the pop of the key need to happen earlier or what am I doing wrong here?

2016-01-27
[07:30:34] <teemu> wardi, rossjones: Should I make an issue for the 401/403/repoze case?
[07:59:35] <rossjones> teemu The PR is already at https://github.com/ckan/ckan/pull/2846
[08:00:03] <teemu> now that's fast!
[08:00:11] <teemu> you guys are awesome :)
[08:09:04] <rossjones> wardi was on the case straight away! I think some of our tests are broken because they're looking for the wrong thing, but I expect it'll be on master soon enough ;)
[10:04:42] <yanik> Can you explain why do you need Apache2 and Nginx to serve CKAN?
[10:04:42] <yanik> Nginx is used for serving static files? and apache2 is for serving CKAN app itself?
[10:13:30] <LondonAppDev> Hey guys, does anyone know if it's possible to safely export just the users and groups from the CKAN database, and then import them?
[10:22:44] <nigelb> yanik: You don't.
[10:22:56] <nigelb> It's added in the distant hope that we'll one day get rid of apache.
[10:23:02] <nigelb> we're getting close lately to that.
[10:23:17] <nigelb> You could *just* use apache if you wanted.
[10:24:38] <yanik> @nigelb, it wood be great to just use NGINX, not apache2. When you plan to finish translating?
[10:24:53] <yanik> translation*
[10:25:25] <rossjones> yanik would love somebody to check if there are any issues doing nginx->gunicorn or nginx-uwsgi ;)
[10:26:00] <rossjones> I've seen CKAN work with nginx+uwsgi in the past, so definitely possible. The process isn't documented though
[10:26:40] <yanik> it wood be great running NGINX+gunicorn, since my other instance use same stack
[10:27:42] <nigelb> yanik: It's, I believe, waiting for someone to volunteer to test and document any issues.
[10:27:48] <nigelb> We ran Nginx+gunicorn and noticed slowness.
[10:28:17] <yanik> @nigelb, can you share working examples? Maybe I can do this work
[10:31:12] <yanik> I'm now working on CKAN docker, do you guys think it wood be reasonable to separate containers to:
[10:31:13] <yanik> 1) NGINX
[10:31:13] <yanik> 2) Solr
[10:31:15] <yanik> 3) CKAN + gunicorn (socket)
[10:32:04] <yanik> so I can combine docker task and nginx+gunicorn
[10:33:30] <yanik> but it wood be more efficient if someone, who know CKAN structure better, can advise me and be a mentor
[10:33:51] <yanik> rossjones, @nigelb what u think
[11:08:25] <rossjones> yanik  I don't really use docket, so am really only interested in the ckan+gunicorn bit.  Would love to know more about the setup that nigelb saw that was slow
[11:08:32] <rossjones> s/docket/docker
[12:19:26] <rossjones> Would anyone be interested in a PR with support for multi-facet in CKAN?  Means you can facet res_format:CSV OR res_format:XLS rather than AND.
[13:44:22] <yanik> wardi, do you have information about progress on https://github.com/opendata/CKAN-Multisite/issues/17 ?
[13:45:07] <yanik> its sounds reasonable to combine our efforts
[14:38:00] <rossjones> teemu are you in a position to try out https://github.com/ckan/ckan/pull/2846 to see if it solves all of your CKAN problems?
[14:38:13] <rossjones> the branch is 2846-403-forbidden
[15:22:30] <LondonAppDev> Hey guys, has anyone else had any issues installing solr jetty with Ubuntu 14? I am getting exact same issue this guy describes: http://stackoverflow.com/questions/30384503/fresh-re-installation-of-ckan-jetty-solr
[16:10:27] <yanik> LondonAppDev, I do, but can help you only in 3 hours or so
[16:11:04] <yanik> LondonAppDev, I spend many hours trying figure it out, but even sometimes it don't work as i expect
[16:11:46] <yanik> its variate, depends on what 14 you use and work fine in 12.04
[16:17:56] <LondonAppDev> yanik cool no worries. I think I'm onto something now... Seems it might be related to my config.
[16:27:57] <LondonAppDev> yanik: not sure what problem you had, but my problem was the line endings in /etc/default/jetty. It had Windows line endings which was causing it to fail. Once I changed it to LF it worked, when I changed it back to CRLF it stopped working again so pretty certain that's it.
[16:29:59] <rossjones> LondonAppDev if that does appear to be the problem, would be awesome to update the stackoverflow.  When I tried the packages for 2.5 on ubuntu 1404 it worked without issue :(
[16:30:23] <LondonAppDev> Yeah I'm writing an answer as we speak :)
[16:43:28] <LondonAppDev> rossjones just answered it.
[16:43:40] <rossjones> Awesome
[16:43:41] <rossjones> Ta
[16:44:08] <LondonAppDev> Basically I was using salt states to provision it as a vagrant box
[16:44:16] <LondonAppDev> and therfore it was copying the windows line endings version...
[16:44:22] <LondonAppDev> When you commit on git it converts it
[20:21:16] <rossjones> wardi do the things I am finding with groups, also apply to dataset types?
[21:21:49] <wardi> rossjones: I don't know. We should discuss it
[21:22:22] <rossjones> Yes, I'm not sure I should have opened the can given the label described it as containing worms.
[21:23:06] <wardi> the easier thing would be to separate group and org names. at least those have separate endpoints already
[21:24:36] <wardi> our current pattern of "accept an id or a name as the id field to _show endpoints" gets quite a bit more complicated when names are unique only within their type
[21:25:41] <rossjones> Yeah, there's already a ticket for splitting org out somewhere.  I can live with current restrictions for my 'user-defined-collections' extension, I've just added a controller for now that calls my own auth too.
[22:07:22] <travis-ci> morty/ckan fq-as-list 9329272 https://travis-ci.org/morty/ckan/builds/105288951 Tom Mortimer-Jones: The build failed.

2016-01-26
[08:50:14] <palcu_> I have a question regarding SQLAchemy. Is it possible for me to stop an update in the before_update IMapper method?
[08:50:16] <palcu_> https://github.com/govro/ckanext-romania_theme/commit/471eaf21d09b90f4f36777d40ac2616ce2034819#diff-a80ee6f065b6f5a68397ff52d3f0c1b7R46
[08:50:25] <palcu_> I thought this should work, but it does not.
[08:59:50] <palcu_> I want to block deletions of packages that are older than 5 days
[09:53:23] <rossjones> palcu_ can you do it in auth? That way the option won't even be available after 5 days (where the templates check for that permission).
[09:54:18] <rossjones> palcu_ you could just override package_delete (using IAuthFunctions), it's not a lot of code currently
[09:56:24] <palcu_> perfect, I forgot about IAuthFunctions. Thank you!
[09:57:33] <rossjones> np
[09:59:46] <rossjones> Now my turn for a question ;)
[10:00:20] <rossjones> If I am using IGroupForm, but don't want the group auth to be used, should I be overriding everything in a custom controller extending groupcontroller?
[10:10:49] <amercader> rossjones: can't you just override the auth functions?
[10:14:41] <rossjones> we already do for DGU :(
[10:14:58] <rossjones> And I don't want the same behaviour
[10:15:27] <rossjones> I must just need more coffee :)
[11:59:58] <wardi> meeting?
[12:00:08] <amercader> coming!
[12:00:31] <wardi> rossjones: ^
[12:13:51] <teemu> anyone know where ckan logs the user out if trying to view a page they're not allowed to?
[12:47:25] <slav0nic> ckan team doesn't have plan for migrate to pyramid from pylons?
[12:48:06] <teemu> some kind of a "pyramid scheme", then :)
[13:09:23] <Zharktas> slav0nic: last i've heard the plan was to migrate to flask
[13:10:11] <slav0nic> strange choice for pylons app) tnx
[13:28:01] <wardi> slav0nic: you can find lots of discussion on https://github.com/ckan/ideas-and-roadmap/issues/30 if you're interested
[13:28:37] <wardi> slav0nic: ckan is a strange pylons app, it's grown into its own framework
[13:28:38] <rossjones> teemu  it's fixed in master now
[13:28:46] <teemu> rossjones: for every case?
[13:28:53] <rossjones> It barely uses pylons itself, just the libs it references
[13:29:03] <teemu> where the user is logged out because of insufficient privileges?
[13:29:16] <rossjones> teemu for packages yes.  it will 404 instead.
[13:29:35] <teemu> yeah, that's jsut one case where I thought the entire outcome was wrong :)
[13:29:45] <wardi> in other cases we should stop logging people out too
[13:29:55] <teemu> but if you go on any page you're not privileged you're logged out
[13:30:31] <rossjones> teemu there's deleted groups and publishers and stuff.  Just wanted to do it in different PRs. If you go to a private dataset as a non-privd user, you should now get a 404.
[13:30:46] <rossjones> When I get around to the other PRs, the same will be true elsewhere.
[13:31:14] <teemu> how about when you try to access say admin tools or other non-resource pages as non-admin?
[13:31:35] <teemu> I don't think the system should log people out unless they choose to log out :)
[13:32:24] <teemu> just inform them of the insufficient privileges and perhaps offer to log in as another user
[13:32:46] <rossjones> teemu I agree. There's just a few places it needs fixing, there's no clear obvious place to do it.
[13:32:52] <teemu> okay
[13:33:31] <wardi> we must have some 403 handling code in our base controller that's doing the wrong thing
[13:34:09] <teemu> tried to look for it but couldn't find it
[13:34:37] <teemu> unfamiliar code makes the progress slower though :)
[13:34:38] <rossjones> wardi teemu I'll take a look see, where would you redirect to? referer and show flash message?
[13:36:03] <teemu> rossjones: hm, either a dedicated page with a "log in as another user" link that logs the person out and redirects to login page, or the login page with the flash message, but still logged in (showing the logged in content of the page)
[13:36:49] <rossjones> teemu tbh latter was how I thought it worked, or at least did once.
[13:37:25] <teemu> looking at the code that's how I thought it should work too, but doesn't
[13:37:43] <teemu> but I think the dedicated page might be clearer
[13:37:57] <teemu> anyway, got to go ->
[13:38:58] <wardi> so we do get the flash message and a log-in screen with a ?came_from=(original_url). it's just the logging out we don't want.
[13:39:50] <teemu> yeah, the logging out part is the actual issue
[13:40:46] <wardi> hmm. do we get logged out just by visiting the login page?
[13:49:22] <rossjones> We also have a lot of confusion around 401 and 403. Looks like StatusCodeRedirect in middleware.py is responsible, but that is supposed to redirect to /error/document.html or something similar.
[13:54:24] <rossjones> wardi maybe it's something in repoze that logs you out.
[13:54:53] <rossjones> on demo.ckan I do get the flash message (Need to be system administrator to administer) at the login page, but definitely logs me out :(
[13:57:09] <wardi> repoze is a likely suspect
[13:58:38] <rossjones> and/or login in user controller which claims to send user to logout_first.html
[13:58:46] <rossjones> if you're already logged in.
[13:59:01] <wardi> oh?
[13:59:28] <wardi> I can visit the login page without getting logged out
[14:26:16] <rossjones> On demo.ckan.org?
[14:26:57] <wardi> tried locally on master
[14:27:40] <wardi> and you're right, we're using 401 lots of places that we should be 403ing
[14:31:18] <rossjones> Statuscodegeeks of the world unite!
[14:51:29] <wardi> If we change the abort(401, ...) to abort(403, ...) we get a plain 403 error instead (and the user isn't logged out
[14:52:13] <wardi> oh, and the flash message is set, so I think this might be a case of us just using the wrong status code
[14:52:44] <wardi> 401 is "your login was not accepted" so repoze is doing the right thing by logging out the user
[14:58:26] <rossjones> Yeah, I think package and group controllers abort(401) all over the place.
[14:59:55] <wardi> so how do we get it rendering the login page on a 403
[15:00:58] <rossjones> Set the statuscoderedirect to [403], page='loginurl' I think
[15:25:53] <wardi> ok, but that doesn't redirect, it just renders the login page on the same url
[15:31:59] <wardi> by far the easier thing to do is to render a simple "you're not authorized page". I'll submit that as a pr
[15:36:22] <amercader> this is really sensible, will it break all tests where we are checking for a 302 to test that you are not authorized?
[15:36:41] <wardi> probably
[15:53:17] <rossjones> If you want to use IGroupForm, to have say Groups and Themes, you're stuck with the same auth for both. So if you restrict group_create through config, it also applied to Themes.  I'm not imagining this am I?
[15:53:44] <rossjones> Hard to tell whether we've broken it somehow.
[15:55:43] <rossjones> we==dgu
[15:56:18] <rossjones> Some days I'm not sure I know very much about CKAN at all :(
[17:40:30] <wardi> anyone know what http://docs.ckan.org/en/latest/extensions/plugin-interfaces.html#ckan.plugins.interfaces.IAuthenticator.abort is used for?
[17:43:24] <rossjones> Is it called anywhere?
[17:43:45] <rossjones> I thought it was for extensions only, I only know of ckanext-persona that uses it and that just ignores it.
[17:44:39] <wardi> it's called on every IAuthenticator plugin when abort() is called
[17:44:54] <rossjones> ckanext-adfs uses it to, but it just returns what it was given https://github.com/nhsengland/ckanext-adfs/blob/master/ckanext/adfs/plugin.py#L107
[18:06:50] <rossjones> Tomorrow I'm going to do some work on the rq PR and some PRs for deleting stuff. If anyone has any suggestions for something that could be deleted, that would be cool.
[18:07:02] <rossjones> Am removing webstore_url from resource atm.
[18:27:39] <wardi> what was that for?
[18:40:57] <rossjones> Datastore v2 was a standalone service called webstore.  It stored the URL in there, and the time of the last update.
[18:41:01] <rossjones> Around 1.7 timescale
[18:41:15] <rossjones> https://github.com/okfn/webstore
[18:41:19] <wardi> aha
[18:41:25] <rossjones> Embarassingly, looks like I had the last commit on it :(
[18:41:30] * rossjones hides head in shame
[19:17:51] <travis-ci> ckan/ckan 2846-403-forbidden a2e96ed https://travis-ci.org/ckan/ckan/builds/104968577 Ian Ward: The build failed.

2016-01-25
[15:19:10] <tomkralidis> hi amercader: any hints on how to fix https://github.com/ckan/ckanext-spatial/issues/143#issuecomment-174439007?
[15:25:43] <amercader> tomkralidis: see comment on the issue
[15:29:43] <tomkralidis> thx amercader
[17:45:36] <jude1> hey is there a command to reindex the static files
[17:46:01] <jude1> just updated my plugin with new css and images but the theme still seem to not change
[21:47:31] <travis-ci> ckan/ckan 2844-optional-resource-url aca938f https://travis-ci.org/ckan/ckan/builds/104747338 Ian Ward: The build failed.
[22:30:32] <travis-ci> ckan/ckan master bd95b15 https://travis-ci.org/ckan/ckan/builds/104754573 Ian Ward: The build has errored.
[23:54:29] <travis-ci> ckan/ckan master bd95b15 https://travis-ci.org/ckan/ckan/builds/104754573 Ian Ward: The build has errored.

2016-01-24

2016-01-23

2016-01-22
[17:15:18] <HolyLime> Testing 1 2 3
[17:15:30] <HolyLime> How do I register this username?
[17:20:26] <HolyLime> Help
[17:20:28] <HolyLime> \Help
[17:20:37] <HolyLime> help
[17:22:05] <rossjones> Hello HolyLime, just on my way out, but https://freenode.net/faq.shtml#nicksetup should help
[17:22:10] <rossjones> good weekend everyone
[17:22:57] <HolyLime> See ya

2016-01-21
[10:33:05] <LondonAppDev> Hey guys, I have a harvester which pulled in 30,000 datasets. I ran "paster --plugin=ckanext-harvest harvester clearsource" on the harvest endpoint to remove them all. I first ran it on "2016-01-18 16:16:16" (yes I just noticed the three 16's in the time too)... It's still running today. Do you have any idea what it's doing that is taking so long? Is it re-indexing after removing each one or something?
[10:33:46] <LondonAppDev> I can see some activity in Postgres so it's definitely doing something...
[13:20:45] <wardi> must be a really inefficient query. get postgres to tell you what it's running.
[14:01:27] <wardi> meeting?
[14:04:35] <wardi> brook, rossjones ^
[14:05:29] <brook> I'm there, but I don't think you can see/hear me.
[14:06:29] <wardi> weird, tried re-joining..
[14:32:43] <jude1> hey quick question, running ckan on development mode and keep getting the error SearchError: Solr returned an error running query Error bad request
[14:32:48] <jude1> amy pointers
[14:33:07] <jude1> using ckan 2.5 from github
[14:33:31] <wardi> is your solr url configured correctly? (try visiting it with your browser)
[14:34:18] <jude1> it is
[14:34:29] <jude1> though i am running sole on a multi core setup
[14:34:48] <jude1> i can access it on localhost:8983
[14:34:56] <wardi> ok, does the url include the core?
[14:35:40] <jude1> yep
[14:35:53] <jude1> the development.ini has the following as the solr url solr_url = http://127.0.0.1:8983/solr/ckan
[14:36:03] <jude1> where ckan is the core
[14:38:00] <wardi> I don't know then, you could use a debugger to see the exact url ckan is requesting and what the response is
[14:38:30] <wardi> that's in ckan/lib/search/query.py
[14:38:38] <jude1> how do i access the python debugger? sorry
[14:38:44] <jude1> run the server without paster
[15:05:28] <jude1> hey
[15:05:59] <jude1> quick question looking for where https://github.com/ckan/ckan/blob/master/ckan/lib/search/query.py#L274 raw_query object is defined any pointer
[15:15:12] <wardi> looks like an attribute of SolrConnection from the solr package
[15:16:50] <jude1> thanks
[15:16:56] <jude1> think it might be an issue with the schema
[15:17:19] <jude1> i see the error sort param field can't be found
[15:17:36] <jude1> might have to add that to the schema
[15:19:31] <wardi> you do need to install the schema manually at the moment
[16:17:03] <jude1> yea thanks@wardi seems to be an issue for those using solr 5.1 and multiple cores
[19:02:41] <rossjones> wardi sorry I missed meeting, had to go down to HQ in London.

2016-01-20
[11:09:56] <rossjones> Anyone know who Guest93244 was?
[11:10:44] <amercader> nope :(
[11:11:02] <amercader> but we can leave a message in case he checks the logs :)
[11:48:26] <rossjones> amercader was it you that added me to this new ML?
[11:48:29] <rossjones> s/new/old/
[11:48:51] <amercader> yes, sorry I assumed I would be mentioned in the invite
[11:55:22] <rossjones> No worries, thought I was still subscribed but it was just quiet tbh.
[11:56:13] <rossjones> Unrelated, dgu won't be on the call tomorrow, we're all in a meeting down south.
[11:57:34] <amercader> you mean barcelona?
[11:59:06] <rossjones> I wish.
[11:59:25] <rossjones> I need xurros
[12:04:29] <rossjones> amb xocolata
[13:34:08] <rossjones> Woot. Genshi support is gone! Thanks amercader :)
[14:14:57] <Guest63651> Is the paster views create command [convert old resource previews to new resource views] still available? I'm getting a complain that it doesn't work in a CKAN 2.5 upgraded from 2.2. Its not well documented but mentioned in the migration notes.
[14:29:38] <wardi> Guest63651: it should still work
[15:07:14] <avk> hello my name is Avinash Kant. I need some help regarding ckan. I am trying to setup datastore. While running the test to add a new table it I am getting an authentication error. I am able to get where the problem might be.
[15:07:38] <avk> this is the error msg
[15:07:42] <avk> "Access denied: <function datastore_create at 0x7f4f5c2eb578> requires an authenticated user"
[15:08:18] <avk> Can anybody please help. I am stuck here for quite somewhile
[15:54:53] <Guest63651> wardi: Thanks... I'll have to try it for myself. This is Matt by the way, haven't figured out how to force a sensible nickname on IRC
[17:16:03] <amercader> Guest63651: you might need `python setup.py develop`on the ckan folder to register the new command
[17:16:43] <amercader> avk: what command are you running exactly

2016-01-19
[09:18:19] <amercader> wardi: https://assets.okfn.org/p/ckan/print/ckan-logo.eps
[11:58:16] <wardi> amercader: laurent's macbook thanks you
[11:58:32] <amercader> haha, cool
[12:02:18] <amercader> rossjones: meeting?
[12:04:41] <rossjones> amercader  on a Monday?
[12:04:46] <rossjones> Oh. It's Tuesday
[12:04:50] <rossjones> Gah. One sec.
[13:05:57] <yanik> hey guys
[13:06:54] <yanik> does anyone deploy CKAN to AWS?  I asked about Docker image before, but was ignored
[13:17:34] <rossjones> wardi how many servers does the setup you mentioned use? Or is it dockerised?
[15:16:41] <rossjones> yanik  I don't think the docker image is officially supported by the ckan team, think everyone's hoping someone will take it on as a community project.
[15:17:42] <yanik> rossjones, but how hard you think it wood be? just your personal opinion
[15:20:53] <rossjones> yanik  If you're deploying to plain AWS it's straightforward, I think linkdigital even have an image available.  If you're doing docker on AWS, I don't know, I don't use/know/like docker ;)
[15:21:47] <yanik> linkdigital has 2.2 version of image, and somehow it's even not available for downloading
[15:22:38] <yanik> well, i will research, but I don't think it will be possible for me, alone, provide trustworthy docker image with CKAN
[15:23:17] <yanik> But if I manage somehow, will share with community, ofc
[15:23:58] <rossjones> yanik :( Might be worth ssearching the ckan-dev mailing list to see where the docker conversation finished.
[15:24:27] <yanik> will check
[15:26:14] <pwalsh> yanik https://github.com/okfn/docker-fiware-ckan
[15:27:16] <yanik> pwalsh, wow, thx!
[15:29:41] <yanik> pwalsh, you are the author? It may be reasonable to make official one? What kind of testing / polishing it's needed to be 'officially' supported
[15:32:50] <pwalsh> yanik amercader authored that.... I've done a bunch of other Docker stuff at OKI.
[15:42:44] <yanik> shame, this one is broken, neither master nor 2.4 release do now worked for me
[15:43:13] <yanik> Out of box, I mean. Will try to do my best
[15:49:59] <pwalsh> yanik i probably can't help right now but I'm suprised if that repo is broken
[15:50:56] <yanik> pwalsh, maybe it was my local docker configuration, but it need /data folder at least, wait for PR :D
[15:51:59] <yanik> and its end up with:
[15:52:35] <yanik> https://gist.github.com/wide-awake/b5bca50325f136eeabe5
[15:52:43] <yanik> will try figure out
[15:53:13] <yanik> (this is 2.4 release)
[17:00:04] <travis-ci> ckan/ckan code-of-conduct f6eefd7 https://travis-ci.org/ckan/ckan/builds/103392602 Ross Jones: The build has errored.
[17:01:18] <rossjones> WHAT?
[17:01:43] <rossjones> Ah, must have been before the force-push
[17:02:04] <rossjones> Suggest code of conduct is at https://github.com/ckan/ckan/pull/2839 if anyone wants to add anything to it.
[18:28:50] <wardi> rossjones: not dockerized, but they are virtual
[18:29:09] <wardi> hopefully spread across different actual hardware :-)
[18:36:27] <rossjones> wardi cool. sounds very sensible.
[18:37:17] <rossjones> Just trying to get a feel for how people spread out their systems.
[19:48:32] <Guest93244> Well poo I got gurest.
[19:48:35] <Guest93244> guest*
[19:49:07] <Guest93244> I am interested in volunteering and getting involved with Ckan.
[19:49:26] <Guest93244> Thoughts or advice anyone can give?

2016-01-18
[09:11:37] <rossjones> Morning
[11:21:04] <amercader> Happy birthday CKAN! https://github.com/ckan/ckan/commit/095c8f925ea6240d19ca3bba1a47b5651797c1ad
[11:31:02] <rossjones> amercader wow. That's cool.
[11:31:24] <teemu> \o/
[11:32:23] <rossjones> Someone should do a blog post :) Maybe Stephen might be up for it?
[11:33:48] <Dragon_> Wonder what the oldest remaining line of code is :)
[11:36:35] <rossjones> Dragon_  https://github.com/ckan/ckan/commit/669a39bfab26c3db86636085cddeb30174db64a5
[11:36:41] <rossjones> you mean that is still in the code?
[11:36:53] <Dragon_> Yeah
[11:37:11] <rossjones> Most of that commit ! ;) Well. Some.
[11:37:14] <Dragon_> :)
[11:37:56] <rossjones> Once upon a time it looked like it was almost called OpenRegistry - https://github.com/ckan/ckan/tree/669a39bfab26c3db86636085cddeb30174db64a5
[15:58:53] <corebits> Wow, 9 years old. Cool
[15:58:57] <corebits> ;)
[16:01:34] <rossjones> It'll be a teenager in a few more years, and *then* we'll be in trouble.
[16:01:52] <corebits> LOL, I was just having a similar thought
[16:06:21] <wardi> nice. Happy Birthday CKAN
[16:19:40] <yanik> someone use Elastic Beanstalk from AWS to deploy CKAN ?
[16:21:48] <yanik> i found, https://github.com/opendata/CKAN-Multisite/issues/15 but i need to know how much headache wood be to run in ElasticBeanstalk
[18:27:12] <wardi> amercader: is there a vector source for the ckan logo somewhere?
[18:27:25] <wardi> Laurent is asking for his BS3 work
[18:43:16] <amercader> wardi: I'm sure I can dig it out, I'll have a look tomorrow

2016-01-17

2016-01-16

2016-01-15
[15:14:35] <rossjones> Is http://master.ckan.org/ still maintained/managed/updated?
[15:23:40] <amercader> yes, I noticed it's down
[15:23:57] <amercader> let's see if it's a quick fix before lunch
[15:25:01] <amercader> #2818 :)
[15:29:44] <rossjones> What idiot merged that.
[15:35:14] <amercader> back
[15:39:45] <Guest37676> Is the paster views create command  [convert old resource previews to new resource views] still available? I'm getting a complain that it doesn't work in a CKAN 2.5 upgraded from 2.2. Its not well documented but mentioned in the migration notes.
[17:47:16] <wardi> amercader, rossjones: so it seems I can't rename the module ckan.tests.helpers to make it appear as ckan.plugins.toolkit.test_helpers or the import will fail.
[17:47:58] <wardi> I have a bunch of unpleasant ways to work around the problem, but I can't decide which is the least unpleasant
[17:58:42] <rossjones> Oh that sounds like fun. Do you mean you can't import ckan.tests.helpers as h, and then expose h within ckan.plugins.toolkit.test_helpers ?
[17:59:23] <rossjones> wardi sort of like _CKANToolkit does?
[18:02:03] <wardi> rossjones: python refuses to import it if the attribute name doesn't match the module name
[18:02:07] <rossjones> or in c.p.toolkit have test_helpers = h
[18:02:20] <rossjones> Oh rubbish
[18:03:05] <wardi> but, I'm thinking it's better to not have the test stuff in the toolikt: it imports other reqa (like factory boy) that some environments won't have
[18:03:15] <wardi> *reqs
[18:04:18] <wardi> so now I'm thinking ckantoolkit.tests will point to the right ckan tests module, but there won't be a ckan.plugins.toolkit.tests
[18:08:11] <rossjones> That sounds fine though, doesn't it?
[18:08:25] <wardi> yeah, I think so
[18:15:35] <rossjones> Good plan. Right, gtg. Good weekend everyone!
[19:08:46] <wardi> ugh. github makes it way too easy to create branches by accident
[19:24:46] <corebits> Yes, I agree. They should have a confirmation step. or at very least an option to delete that newly created branch

2016-01-14
[20:04:34] <rossjones> wardi I am holding my breath about https://github.com/ckan/ckantoolkit - should I keep holding it?
[20:06:38] <wardi> hehe, I'll push something to it soon
[21:34:07] <rossjones> Argh. Bug from hell.  Using ckanapi with LocalCKAN and somehow I am managing to corrupt the revision for the package :(
[21:34:26] <rossjones> Not ckanapi's fault.
[21:34:58] <wardi> Would be a very interesting bug if it was ckanapi's fault :-)
[21:35:47] <rossjones> It would! These bloody revisions are nothing but an absolute pain in the posterior.
[21:36:20] <rossjones> It must be something we're doing in our CKAN.  Haven't seen anyone else have so much trouble with it.
[21:37:12] <rossjones> It's definitely beer'o'clock. ttfn

[08:15:12] <rossjones> corebits seems I can replicate benjwadams problem with harvest :(
[08:37:36] <rossjones> If anyone sees @benjwadams the issue is at https://github.com/ckan/ckanext-harvest/issues/219
[08:59:39] <teemu> Hi. I have two plugins that implement IAuthFunctions. For some reason when I enable them both one of them stops working and ckan crashes on not finding the necessary authentication functions. As I've understood and have glanced fro mteh relevant code,it should be possible to have several IAuthFunctions implementations active. I've tried changing the loading order but it's always the same plugin (ckanext-pages)
[08:59:41] <teemu> that stops working. Any ideas?
[09:26:39] <rossjones> teemu do they share the same name?
[09:27:03] <teemu> you mean plugin name or plugin class name?
[09:27:07] <teemu> no
[09:27:27] <teemu> nor the overridden auth function
[09:27:40] <teemu> one defines user_list, the other only stuff for its own pages
[09:28:19] <rossjones> user_list to override the one in CKAN itself?
[09:28:25] <rossjones> I mean it is intentionally doing that
[09:29:05] <amercader> teemu: you should be able to implement IAuthFunctions on two plugins as long as they don't override the same auth function
[09:29:14] <amercader> if that's not the case it looks like a bug
[09:29:42] <teemu> rossjones: yes, it's intentional
[09:30:17] <teemu> that's the plugin I'm doing currently. I've just added that one this far but bumped into this conflict with ckanext-pages
[09:30:21] <rossjones> second one this morning amercader - could be one of those days :)
[09:30:45] <rossjones> teemu is it available somewhere?
[09:30:50] <rossjones> the source code.
[09:32:51] <teemu> ckanext-pages is in github, my plugin is so far pretty much here https://gist.github.com/bzar/4ac06b33a210d475d92f
[09:33:24] <amercader> teemu: return {'user_list': admin_only}
[09:33:33] <teemu> yes?
[09:34:18] <teemu> is there something wrong there?
[09:34:39] <rossjones> Oh hangon. teemu are you using master and pulled ckanext-pages recently?
[09:34:41] <amercader> there's a syntax error
[09:35:00] <rossjones> doh : not ,
[09:35:21] <teemu> amercader: that the closing brace is on the next line?
[09:35:38] <teemu> AFAIK that's perfectly legal python :)
[09:35:59] <teemu> it's there because there'll be more stuff inthat dict later
[09:36:01] <amercader> no, you need a colon instead of a comma
[09:36:09] <teemu> oh!
[09:36:38] <teemu> I blame coding C++ in my spare time
[09:36:40] <teemu> thanks :D
[09:36:48] <amercader> :)
[09:37:24] <teemu> and now it works. I'll go to lunch to feel stupid :D
[09:38:21] <amercader> no bother, I wish all bugs were like this!
[09:38:46] <rossjones> amercader wait until the meeting, I think we've broken nearly all the extensions :)
[09:39:30] <amercader> yeah, I noticed
[09:40:14] <amercader> we were a bit too enthusiastic on https://github.com/ckan/ckan/pull/2818
[09:41:03] <rossjones> I'm always enthusiastic! :(
[09:41:30] <rossjones> I should fix this, but if I switch the extensions to use authz instead of new_authz they'll break with older versions :(
[09:41:56] <rossjones> Or I could revert 2818 I suppose :(
[09:42:20] <rossjones> I'd rather fix the extensions though.
[09:44:22] <rossjones> amercader do you think the PR is also responsible for the missing form in harvest?
[09:45:13] <amercader> no, that smells of template changes in master
[09:45:44] <rossjones> Starting to think we should definitely tie extension versions to ckan versions.  If only to stop me breaking everything.
[09:45:51] <rossjones> Should I revert 2818 for now?
[09:47:46] <amercader> I don't know, I'd also like to upgrade extensions but maybe this is too big a change. Let's discuss on the meeting to see what wardi thinks
[09:50:03] <rossjones> Okay. Have added as a note to agenda
[12:03:42] <amercader> benjwadams, rossjones: the harvest form should be fixed in master now
[13:13:20] <wardi> LondonAppDev: I've seen the .min.js issue. fanstatic_resources needs some love for sure
[13:14:38] <wardi> re: extension breaking, if you don't mind dropping support for ckan<2.3 we can just change the imports. If you want to support multiple versions from the extension we'll need a try: import.. except ImportError: .. around things that import ckan internals
[13:14:56] <wardi> rossjones, amercader ^
[13:15:57] <amercader> https://github.com/ckan/ckanext-spatial/commit/fc3a364a0fcb3fc95a5f5b3c75c1c9ca834e71cd
[13:15:58] <wardi> even better we could figure out if these things we're importing should be part of the plugin toolkit so that we're free to change them in the future
[13:16:35] <amercader> spatial and harvest are done. I also had to spend a bit of time fixing the form as harvest was using c.form
[13:16:52] <wardi> yeah, I import those too. should we add test_helpers and test_factories to the toolkit?
[13:17:20] <amercader> sounds good
[13:17:50] <amercader> but we'll have the same problem if we want to support older ckan versions :)
[13:17:55] <wardi> then the first import we try can be the good one :-)
[13:18:37] <wardi> we still need the ImportError hack, but at least we're moving in a better direction
[13:20:15] <wardi> if the plugin toolkit was a separate module we could update it independently and hide our ongoing import hacks in there
[13:22:23] <amercader> wdym? isn't it a module already on lib/plugins/toolkit.py or whatever?
[13:29:56] <wardi> sorry, I meant to say separate package
[13:30:33] <wardi> I could add it to ckanapi, I suppose
[13:31:34] <wardi> there's already some code in there that wraps ckan imports
[13:38:40] <wardi> amercader: how do feel about adding ckanapi (or some other toolkit wrapper) as a dependency of extensions you maintain?
[13:39:50] <wardi> it'll help with the transition to flask
[13:43:46] <rossjones> Sorry, missed conversation. Replying to matt.
[13:44:18] <rossjones> Will wait for the meeting in 16 minutes :)
[13:45:45] <amercader> wardi: so you mean that everybody writing and extension needs to add ckanapi as a dependency?
[13:45:49] <amercader> *an
[13:46:41] <amercader> and then having to take care of upgrading it whenever we add a hack or something to the toolkit
[13:46:50] <wardi> ckanapi or some other package as a recommended way to access ckan, then we can update that package independently of ckan
[13:47:40] <wardi> with the idea being "have the latest ckanapi/ckantoolkitthing and your extension will work with as many ckan versions as possible"
[13:48:43] <amercader> that shifts the burden of supporting multiple ckan versions to us instead of the extension developer
[13:49:05] <amercader> which is probably good, of course
[13:49:17] <amercader> but is an extra burden
[13:49:18] <amercader> :)
[13:49:25] <wardi> the other way of looking at it is that it frees us to move things around
[13:50:16] <wardi> or add support for things like importing test_helpers and test_factories to old ckans
[13:54:51] <amercader> I can totally see this benefit, I'm just a bit worried about adding overhead to the extensions developers
[13:55:23] <amercader> maybe is not a big deal, we could add the requirement by default on the extensions template
[13:55:39] <amercader> but then that wouldn't install it
[14:00:14] <rossjones> Meeting time
[14:58:54] <rossjones> Good meeting. Looking forward to the PHP port!
[15:49:41] <travis-ci> wardi/ckan 2835-toolkit-test-helpers-factories 95b69bd https://travis-ci.org/wardi/ckan/builds/102375507 Ian Ward: The build has errored.
[15:55:21] <wardi> rossjones: which meeting were you in??
[15:55:58] <rossjones> :P
[19:18:06] <corebits> rossjones: amercader you guys are so quick. https://github.com/ckan/ckanext-harvest/issues/219 ;)
[19:23:52] <rossjones> corebits amercader did all the work, I just noticed I had screwed up :)

2016-01-13
[13:22:49] <rossjones> Anyone going down to London tomorrow AM?
[13:22:57] <rossjones> wrong channel. sorry
[16:54:02] <LondonAppDev> Hey guys, do you know Fantastic doesn't work with files that end in .min.js...
[16:54:04] <LondonAppDev> Only .js
[16:55:55] <LondonAppDev> Like if you call a file min.js you get "'module' object has no attribute 'report/jquery.tablesorter.min.js'" but if you take away the min it will work.
[17:44:43] <tomkralidis> amercader: re https://github.com/ckan/ckanext-spatial/pull/136/files#r49621764
[17:45:01] <tomkralidis> super(CswService, self).__init__() or super(OwsService, self).__init__() ?
[17:48:34] <amercader> tomkralidis: super is called passing the child class, so `super(CswService, self).__init__()`
[17:48:48] <amercader> let me double check, super is weird
[17:49:57] <amercader> yeah, that's right: super(CswService, self).__init__()
[17:54:10] <tomkralidis> thanks amercader for verifying.  PR updated now.
[17:54:27] <tomkralidis> FYI https://github.com/ckan/ckanext-spatial/pull/141 is also issued
[17:56:00] <amercader> merged #136
[17:56:16] <amercader> I'll wait a bit to see if david is happy with #141
[17:56:22] <amercader> thanks tomkralidis
[19:02:02] <rossjones> I'm in a deleting mood. Can I remove genshi support now please amercader ?
[19:22:57] <amercader> rossjones: http://i.imgur.com/gEELYxo.jpg
[19:23:07] <rossjones> :D
[19:23:25] <rossjones> Oh those bloody .txt email templates. grr.
[19:23:53] <rossjones> yay someone switched them to jinja.
[21:41:11] <benjwadams> I'm having trouble getting the harvesting plugin to work.  I go to /harvest/ and then "Add Harvest" and there are no fields to fill out for the harvesting.
[22:18:21] <corebits> benjwadams: you likely need to add another entry to your ckan.plugins config line. such as ckan_harvester
[22:22:34] <benjwadams> ckan.plugins = stats text_view image_view recline_view spatial_metadata spatial_query harvest ckan_harvester csw_harvester waf_harvester ioos_theme
[22:23:54] <benjwadams> the harvester is there, the "Add harvest source" button shows up, there just is nothing present when i attempt to add anything
[22:23:56] <corebits> interesting, I have only seen empty fields before when 'harvest' was the only one in the plugins line
[22:25:57] <corebits> benjwadams: maybe trying re-running the setup.py steps

2016-01-12
[12:00:11] <rossjones> Anyone up for the call, wardi? amercader? brook ?
[12:00:20] <rossjones> Anyone else who's interested?
[12:00:20] <amercader> coming!
[12:00:29] <rossjones> Don't rush, only me there atm :)
[12:00:47] <rossjones> oh, and wardi
[12:02:28] <rossjones> Details are at https://pad.okfn.org/p/ckan-meeting
[12:16:38] <rossjones> Finished in record time!
[14:38:49] <wardi> uh oh. anyone know the PR that Marianne is referring to?
[14:43:22] <rossjones> Have emailed asking.
[14:43:24] <rossjones> :(
[14:43:41] <rossjones> Think it's an issue rather than PR
[15:00:30] <travis-ci> ckan/ckan circleci-junit 6b52ad1 https://travis-ci.org/ckan/ckan/builds/101845422 amercader: The build has errored.
[15:36:22] <rossjones> Think travis is having a bad day today.

2016-01-11
[08:57:13] <rossjones> morning
[09:04:30] <nigelb> Morning rossjones
[09:12:51] <rossjones> nigelb :) Mid-afternoon for you isn't it?
[09:16:16] <nigelb> rossjones: late afternoon, just about 3 pm :)
[10:37:51] <LondonAppDev> Is it possible to do custom solr queries on a datasets extra fields?
[10:47:55] <LondonAppDev> Ah, found it, need to add my custom fields to ckan.extra_resource_fields.
[14:34:21] <corebits> Morning everyone
[15:07:01] <rossjones> afternoon :)
[15:12:11] <wardi> morning
[15:15:17] <corebits> Always seems I am the late riser haha
[16:17:43] <tktech> rossjones, https://github.com/ckan/ckan/pull/2828
[16:18:01] <tktech> rossjones, Ian has foreseen this having complications with groups due to reliance on the slugs
[16:18:15] <tktech> Willing to fix those issues in this same PR
[16:26:09] <rossjones> I agree with reverting that code, much safer to do it off the webserver.  Not sure what complications wardi means.
[16:27:01] <rossjones> But we need to do something to handle the unexpected behaviour when users rename a group/organisation and the dataset indexes still reference old name.  Although perhaps owner_org makes it unnecessary to have group name in Solr.
[16:27:48] <rossjones> Ah maybe that's what he meant.
[16:28:52] <rossjones> If https://github.com/ckan/ckan/blob/master/ckan/config/solr/schema.xml#L104-L105 are both the IDs it might make it easier.
[17:12:07] <poolparty> I have a ckan extension that is using the default ckan user/register controller and validators
[17:12:22] <poolparty> is there some easy way to override the validators for this?
[17:12:23] <poolparty> https://github.com/ckan/ckan/blob/master/ckan/logic/validators.py#L360-L361
[17:12:59] <poolparty> I see that the UserController calls into this validator from the _save_new method
[17:13:00] <poolparty> https://github.com/ckan/ckan/blob/master/ckan/controllers/user.py#L224-L230
[17:13:22] <poolparty> but I really hope that I don't have to override that UserController and _save_new method just to declare a different validator
[17:13:25] <poolparty> any ideas?
[19:06:17] <tktech> rossjones, I believe that's what he meant if I've understood everything correctly

2016-01-10
[00:15:35] <wardi> rossjones: The revision migration could be optional
[12:31:15] <rossjones> wardi would have to be optional, we've 2.5M revisions and want it to complete this year ;)
[13:45:56] <wardi> rossjones: or a parameter that let you say "migrate 6 months of past revisions"
[13:46:56] <wardi> can we use jsonb yet?
[14:09:17] <wardi> so, no. not until we bump the req up to 9.4.
[16:12:34] <rossjones> I think David was only planning to go up to 9.2 :( So basic json support only :(
[16:30:21] <wardi> will we need to make json queries into the history? We *can* build indexes even with the json type e.g. to index a revision id stored in the json
[16:31:26] <wardi> I don't think we will, and if we do later, then we can always migrate it
[16:32:11] <rossjones> if we have package_id and date and some json, that should be enough to find old revisions
[16:32:26] <wardi> how should membership be stored? I don't think it belongs with the group/org history, but it can't be referenced with a single id
[16:33:13] <rossjones> won't it be in the package json? Depends whether we're just showing what's  changed between revisions, or whether we actually ever want to revert.
[16:33:33] <rossjones> Just for some anecdata, in the last 4 years I have reverted objects exactly 0 times.
[16:34:59] <wardi> maybe we can leave membership changes in activity records and don't bother keeping a copy in the history table
[16:37:12] <wardi> another problem, if resource history is rolled up into the package history, what's tracking resource view data?
[16:37:35] <rossjones> you mean what resource-view was active at the time?
[16:37:41] <rossjones> do we care about that?
[16:37:47] <rossjones> or does it maintain state?
[16:38:13] <wardi> resource views have state
[16:40:04] <wardi> I could imagine views decoupled from resources at some point in the future
[16:40:51] <rossjones> That would be nice.  I'm also started to come around to thinking that resources should be properly typed as well, I realise this makes me weird.
[16:41:15] <rossjones> As in GenericResource, CSVResource, PDFResource.
[16:41:31] <rossjones> Not 100% sure I've fully formed *why* I think it would be good though.
[16:41:40] <wardi> we have resources used for linked files, documentation, and related items at the moment
[16:41:58] <wardi> we use a resource extra to indicate what sort of resource it is
[16:43:40] <rossjones> Yeah we do that on DGU, but badly. You don't ever, ever want to see our schema code.
[16:43:51] <rossjones> 5 years of 'evolution'.
[16:44:30] * rossjones checks if resource_view data is in resource dict from api....
[16:44:55] <wardi> I think it's a different action
[16:45:24] <rossjones> You're right :(
[16:49:39] <rossjones> On the plus side, I've now got a clearer picture what the continuity_id is for - it's the revision id of all of the revisions for a given point in time :)
[16:51:48] <rossjones> I think I just need a clearer picture of what the use-cases actually are ... can I rollback resource_views separately from resources for instance? Is it all-or-nothing? Should we have a separate archive_create() that composes a single JSON document with all the relevant data etc etc
[17:01:10] <wardi> rossjones: oh, i didn't know about continuity_id. I thought revisions could include changes to a bunch of things
[17:02:12] <rossjones> wish we could just do what they do in django and pip install django-reversion and forget about it :)
[17:13:30] * rossjones goes to eat, that always helps
[17:17:23] <wardi> revisions seem too complicated to be solved without some careful planning
[17:17:26] * wardi foods too

2016-01-09
[20:17:56] <avinash> Hello, My name is avinash, I m trying to install ckan and having an issue with solr. As I try to open the http://localhost:8983/solr/ page, I get 500 error page, with JSP not configured as a reason
[20:18:10] <avinash> Can somebody please help me to resolve the issue
[22:23:10] <poolparty> is there documentation on steps needed to override the validators for user/register view?

2016-01-08
[02:54:43] <starl3n> heya folks - happy new year!
[07:21:58] <teemu> rossjones: I see you've been assigned to #2805. What kind of timeframe are you planning for it? Just curious if I should come up with a workaround for our project for now or wait for a fix.
[08:51:37] <rossjones> teemu I doubt very much I'll get to it in the next few days - more likely one afternoon late next week.
[08:52:04] <rossjones> If you wanted to come up with a fix that could be a PR - even better! ;)
[08:59:32] <nigelb> rossjones: I wonder if we should throw the right HTTP status for it.
[09:00:37] <nigelb> A 410, that is.
[09:01:01] <nigelb> I should probably attend the meetings instead of randomly speculating :)
[09:26:33] <rossjones> 404 is probably better because it may not be permanent.
[09:31:20] <rossjones> nigelb  and yes, come to the meetings so we can assign you bugs :)
[09:38:45] <nigelb> Hehe
[09:38:57] <nigelb> I wrote a PR a while ago and I think it's still unmerged!
[09:40:13] <nigelb> ehhh, nvm
[09:40:20] <nigelb> amercader merged it ages ago.
[09:48:51] <LondonAppDev> Does anyone know of any advance search extensions for CKAN which allow you to search the contents of specific fields?
[10:03:47] <rossjones> LondonAppDev  specific fields in data or metadata?
[10:04:33] <LondonAppDev> rossjones, in metadata.
[10:04:54] <LondonAppDev> Like I want to search for all with field "author" containing "Bill"
[10:07:40] <rossjones> You can do solr queries
[10:09:10] <LondonAppDev> In the search box?
[10:09:26] <rossjones> you mayu need to change something in the backend .. but package_search?fq=author:bill* should work
[10:10:45] <LondonAppDev> Ah fantastic. Yeah I see it now, thanks rossjones.
[10:11:16] <LondonAppDev> just "author=Bill" works.
[10:11:39] <rossjones> http://docs.ckan.org/en/latest/api/index.html#ckan.logic.action.get.package_search describes your options :)
[10:12:35] <LondonAppDev> Excellent, thank you.
[10:12:38] <rossjones> np
[11:39:50] <teemu> rossjones: we'll see ;)
[11:41:34] <teemu> is there any nice way to block some routes from non-admins? I mean besides using IRoutes to first route to a credential check and then call the original controller?
[11:57:11] <rossjones> Not that I know of, might be quite nice if the routing took a required perm check tho.  We just use the routes library so would need some abstraction on top of that.
[11:58:05] <teemu> hm
[15:19:27] <rossjones> Don't suppose someone can help with a VDM/CkanSessionExtension question?
[15:20:29] <rossjones> I've found CkanSessionExtension updates the revisioned table for an object to set the row where current=1 to current=0 - having trouble finding where the current column is updated and set to true
[15:42:56] <rossjones> Nevermind, was removed from core ageees ago.
[15:56:00] <wardi> thinking a bit more about a vdm replacement. How about one history table that contains (model_name, id, superseded_date) as pk and (raw_data_dict) as its data. this makes things like "delete all edits older than 2 years' really easy and raw_data_dict (unvalidated) lets us update validation to apply changes backwards without them showing up as a user changes
[16:02:05] <wardi> add a revision id and it could be backwards compatible
[16:23:37] <rossjones> I think I'd much prefer that to the current setup. Although the current one tracks all the FK objects as well with the continuity ID.  So historical package could point to a historical org that no longer exists.
[16:23:46] <rossjones> But maybe the raw_data_dict is enough.
[16:24:59] <rossjones> I guess showing diffs on the dicts should be enough for showing changes between 2 revisions.
[16:25:01] <wardi> owner_org is an id, so that should be safe (it could have since been deleted, certainly)
[16:25:36] <wardi> rossjones: I was thinking put both through validation first, then diff
[16:25:50] <rossjones> that would work.
[16:26:16] <rossjones> I have spent the last 4 hours looking at revision problems, spoilt my weekend.
[16:26:42] <rossjones> Reading through extension.py and meta.py doesn't make me feel much better about it either :(
[16:27:08] <wardi> I find it hard to keep straight in my head
[16:27:39] <rossjones> Would rather the History table (or whatever it would be called) used a more normal CKAN method for writes, rather than sqlkalchemy extensions.
[16:28:20] <wardi> absolutely. I'd make it explicit at the model level, I think
[16:33:31] <rossjones> Suspect the migration would be the slowest/most-painful bit.
[16:45:22] <rossjones> wardi how many revisions do you have on your biggest site (in revision table)?
[17:11:19] <rossjones> Birthday party time .. ttfn

2016-01-07
[21:31:01] <poolparty> wardi: thanks, I figured as much. but I'm having a hard time finding which base template includes that JS file to so I can override it
[21:31:59] <wardi> it's not so simple. I think if you just provide your own javascript/modules/image-upload.js in a public folder in your extension it will use yours instead
[21:33:19] <poolparty> ahh, i see, thanks
[21:33:22] <wardi> maybe I'm wrong. it's referenced in ckan/public/base/javascript/resource.config
[21:33:38] <poolparty> well, it's still worth a try
[21:43:23] <poolparty> ok, that didn't work but I have a good guess of how to overwrite the existing module
[21:43:32] <poolparty> by importing it and reregistering it as the same name
[21:43:32] <poolparty> http://docs.ckan.org/en/1377-javascript-tutorial/theming/javascript.html#initializing-a-javascript-module
[23:14:01] <poolparty> in my package list view I'm noticing that really long package names|titles have a max size and then are truncated with '...'
[23:14:10] <poolparty> is there anyway to stop this from happening?
[23:14:25] <poolparty> i could figure it out on my own, but I cannot seem to find the template that handles this
[23:18:39] <poolparty> nevermind, solved

[09:03:32] <emmajane> rossjones brilliant! Thanks. :)
[09:52:07] <rossjones> emmajane are you involved in HDX now?
[09:52:41] <emmajane> rossjones, not from a dev perspective, no.
[09:52:58] <emmajane> rossjones, I'm with https://www.humanitarianresponse.info/ which integrates with it.
[09:53:57] <emmajane> rossjones, we're like ... cousins I suppose?
[09:54:23] <rossjones> Ah I see, that makes sense.
[09:54:40] <rossjones> Do you integrate with ushahidi as well?
[09:55:18] <emmajane> I've seen this, but we don't integrate with it at this point.
[09:56:46] <emmajane> We're a bit "higher" than that? i.e.. we would work with the reports that others generated, but not the raw data.
[09:58:00] <emmajane> One of my colleagues, Roxanne, is with the Digital Humanitarian Network, and I bet some of the orgs they support use it.
[09:58:03] <rossjones> Ah okay, looks like there's some overlap as another potential source I'd guess.  Not sure how widely used ushahidi is, I sort of lost track of it and crisismappers last year.
[09:58:51] <rossjones> Or was it the year before :( Scary how much faster time goes when you get old :(
[09:58:55] <emmajane> https://www.humanitarianresponse.info/en/operations/philippines is a good example of a "fleshed out" group. It's more about a central place to find "stuff about stuff that's happening elsewhere".
[09:59:32] <emmajane> I work most closely with information management officers who are in field offices.
[09:59:58] <emmajane> (because I'm mostly tech; I also don't respond to disasters myself...I'm always HQ-based)
[10:01:09] <rossjones> Neat.
[10:03:11] <emmajane> Indeed, time does *fly*. I'm still trying to figure out where 2014 went.
[10:03:33] <rossjones> :(
[10:04:31] <rossjones> wardi am about for the meeting today, we should definitely try and restart them sometime this year ;)
[12:24:23] <acorbi> hi everyone. quick question: is there any way (even hacky) to retrieve Private datasets through ckanapi ??? Im using LocalCKAN
[12:25:13] <Zharktas^> with passing api-key of account which has access to them ?
[12:25:55] <acorbi> LocalCKAN is supposed to use full access on the API calls, and no apikey is specified
[12:26:39] <acorbi> in a nutshell, i need a way to retrieve ALL datasets thorugh the API, no matter public or private
[12:26:51] <acorbi> and no matter from which orga, group or user
[12:27:12] <acorbi> would package_list do it?
[12:27:53] <Zharktas> aah right
[12:28:01] <Zharktas> it should default to site user with full access
[12:29:06] <acorbi> but package_search does not retrieve private datasets....
[12:29:25] <Zharktas> nope
[12:30:37] <acorbi> package_list either?
[12:30:55] <acorbi> sorry, that was an affirmation
[12:31:08] <acorbi> package_list either...
[12:31:34] <acorbi> mmm I could pull the ids, directly from the DB....
[12:31:55] <acorbi> or you have any API-only solution ??
[12:33:08] <Zharktas> package_list does not get private datasets either
[12:33:43] <Zharktas> but you can go through groups/orgs one by one
[12:33:59] <Zharktas> since they contain private datasets too if user has access
[12:38:08] <acorbi> that's a good idea, but im solving it by querying all ids from package table on DB
[12:38:25] <acorbi> this should be faster .> less API calls
[12:39:42] <Zharktas> if you need to get them often, api calls probably aren't fast enough anyway
[12:39:59] <Zharktas> going through orgs in more of a one time thing
[12:40:38] <acorbi> jup, thanks for your support!
[13:54:40] <wardi> rossjones: looking forward to it
[13:57:12] <rossjones> brook will you and amercader be making it today?
[13:58:20] <brook> rossjones Was planning to
[14:00:31] <wardi> huh does package_search never return private datasets?
[14:00:59] <wardi> ckanapi dump uses package_list and package_show at the moment (slow but works on older ckans)
[14:23:57] <rossjones> Hangouts fail!
[16:07:25] <rossjones> Finally trying out runsnakerun. Kinda useful.
[17:19:11] <travis-ci> ckan/ckan docker-update 5708fbe https://travis-ci.org/ckan/ckan/builds/100866273 David Read: The build was broken.
[17:45:34] <corebits> I am Attempting to test ckanext-showcase on 2.3.1 and hitting a couple issues.
[17:46:13] <corebits> a> running migrate command, I get a list of titles, but nothing appears in the showcase_ tables
[17:46:48] <corebits> b> adding dataset to a showcase from the web interface, I get {u'Package id': u'Not found: Dataset'}
[17:47:27] <corebits> with no other output or errors. Any ideas ?
[21:23:56] <poolparty> I have a ckan extension that is currently using the image-upload.js stuff
[21:23:57] <poolparty> https://github.com/ckan/ckan/blob/master/ckan/public/base/javascript/modules/image-upload.js#L60-L67
[21:24:40] <poolparty> but I want to override that js to append a <a> tag WITHOUT a nested icon
[21:24:50] <poolparty> what is the recommended way to do this override?
[21:28:56] <wardi> you should be able to provide your own version of this file to override the core one, but that's a good question in general

2016-01-06
[11:26:55] <LondonAppDev> Hey guys. Does anyone know of any existing or similar extensions that allow users to report datasets. For example, if there was a broken link they could click "Report Dataset", type a description and report it to the administrators.
[12:16:06] <rossjones> LondonAppDev There is https://github.com/okfn/ckanext-issues but we're doing a lot of work on it atm in our fork - might still work for you though
[12:17:34] <LondonAppDev> Oh sweet, thanks rossjones this is perfect.
[14:43:35] <jude_> Any guides on extending ckan using extension when ckan has been installed via packages?
[14:43:45] <jude_> that is the .deb binary?
[15:25:22] <rossjones> jude_  should be the same, I think you only need source if you are developing CKAN itself.  For extensions it shouldn't matter (someone might correct me though).
[15:44:25] <terminaljunkie> Is there a paster command to clear the solr database/indexes ?
[16:03:33] <rossjones> terminaljunkie  paster --plugin=ckan help search-index
[16:04:54] <terminaljunkie> thanks
[16:04:59] <terminaljunkie> that worked
[16:05:11] <terminaljunkie> paster search-index clear -c ...
[16:21:49] <rossjones> ;)
[16:23:50] <emmajane> It seems like CKAN doesn't know how to be more specific than countries. I did a quick search on extensions.ckan.org for "location" but I'm not sure if there are different keywords I should use. https://data.hdx.rwlabs.org/group/phl but interested in being able to do: https://www.humanitarianresponse.info/en/operations/philippines/assessments/map
[16:25:16] <emmajane> We have a special "admin boundaries" dataset that we use on HR.info as a (taxonomy term, I think)...but I don't think it's possible to push that over to CKAN to make the datasets findable in the same way.
[16:25:39] <emmajane> If I wanted to make that magic happen, is that the kind of thing that an extension would do?
[20:23:24] <rossjones> emmajane  are you using https://github.com/ckan/ckanext-spatial ?
[20:23:54] <rossjones> You can add extents to datasets, and then filter/search on those.
[20:24:42] <rossjones> AFAIK (I may be wrong) it only handles bounding boxes, but specifying points or other types of polys might be feasible (amercader would definitely know).
[20:25:30] <rossjones> Ah http://docs.ckan.org/projects/ckanext-spatial/en/latest/spatial-search.html#geo-indexing-your-datasets suggests points are already possible.

2016-01-05
[12:03:36] <wardi> meeting?
[12:08:00] <wardi> rossjones: ^
[12:17:35] <rossjones> Sorry, not today.
[14:03:42] <rossjones> The normal pattern for logic functions seems to be, you pass in an id and it'll get fetched from the DB and then .. whatever.  For some cases I have a package already, and then I end up passing package.id in the data_dict.  Is it an anti-pattern to be able to pass in the DB object to the logic layer for it to check if 'package' is there before doing the p.toolkit.get_or_bust(data_dict, 'id') ?
[14:22:31] * emmajane waves.
[14:22:49] <emmajane> I have a question. :) on http://docs.ckan.org/en/ckan-2.1.1/api.html#get-able-api-functions it says that I can use multiple parameters.
[14:23:00] <emmajane> This seems to be an "AND" operation.
[14:23:21] <emmajane> I don't see a way to have an "OR" operation. Does this need to be done on the requesting side?
[14:24:51] <emmajane> https://data.hdx.rwlabs.org/api/3/action/package_search?fq=groups:cod&fq=groups:pak I'd like 152 + 198 results returned, but get zero.
[14:33:52] <emmajane> Tada! pedro figured it out: https://data.hdx.rwlabs.org/api/3/action/package_search?q=groups:(syr OR jor OR tur) (we've got a solr backend)
[14:39:06] <rossjones> Cool, I like those sort of questions - ones where you ask and then post the answer :)
[15:36:42] <emmajane> :)
[15:36:56] <emmajane> Me too. "never stop looking" .. that's today's motto. :)
[15:51:03] <wardi> rossjones: I think that's an anti-pattern. we could achieve the same thing by relying on the fact that sqlalchemy will cache the object, no?
[15:51:47] <rossjones> So if the session() contains pkg<id=x> when the logic layer does Package.get(x) it pulls it from the cache?
[15:52:52] <rossjones> wardi It looks like, according to http://docs.sqlalchemy.org/en/latest/orm/session_basics.html#is-the-session-a-cache that it only allows lookups in 'cache' from a PK.
[15:53:40] <rossjones> So I think we've been wrong for a while on exactly how things are cached :(
[16:09:56] <yanik_> Does someone research about CKAN files (package data) security? Like encryption, etc
[16:47:21] <benjwadams> Hi, new ckan user here.  What's the status of CKAN and Python 3 support?
[16:53:29] <rossjones> benjwadams unlikely until we move off Pylons.
[16:54:51] <benjwadams> Ok, thanks for the info
[16:55:43] <rossjones> np
[16:55:56] <rossjones> There are plans to move on to Flask this year, so will happen eventually
[19:05:11] <jude_> quick question, is it possible to extent ckan when it has been installed via packages?
[19:05:21] <jude_> or for one to extent ckan one has to use source
[19:05:25] <jude_> installation

2016-01-04
[09:31:06] <yanik> wardi, can you give me some details on https://github.com/ckan/ckan/issues/2816
[13:52:34] <nigelb> Oh man.
[13:52:42] <nigelb> firefox's dev edition got a json viewer
[13:52:50] <nigelb> ckan's api actually looks nice and gorgeous
[14:06:49] <rossjones> nigelb loads of plugins to do that already aren't there?
[14:24:44] <nigelb> rossjones: I used to use one the plugins.
[14:24:52] <nigelb> The new interfaces uses a devtools like thing.
[14:24:58] <nigelb> lets you search through and see headers.
[14:26:02] <rossjones> Oh right, cool. I don't use FF so never notice new things :)
[15:35:21] <yanik_> rossjones, it is common to use ckan.model.Session() (as session) to custom DB queries?
[15:35:35] <rossjones> yanik_  unfortunately it is.
[15:36:01] <yanik_> and its normal that sometimes i hit 'InvalidRequestError: This session is in 'prepared' state; no further SQL can be emitted within this transaction'
[15:36:13] <rossjones> Never seen that before.
[15:36:26] <yanik_> or i should just flush before starting new queries
[15:37:07] <yanik_> its about problem we was discussing some time ago -- there no valid way to catch dataset creation
[15:37:44] <yanik_> when dataset is in 'active' state there are still sql running behind, i belive
[15:38:45] <yanik_> i submit ticket, this error may be useful
[15:39:01] <rossjones> Ok, that sounds good.
[15:39:29] <rossjones> So your problem now is that you are getting the notification, and state='active' but you can't run any SQL because of this prepared state?
[15:40:36] <yanik_> I actually hitting 504 error and sometime 'prepared state' error, struggling with the problem for second week) a
[15:41:55] <yanik_> or I am a bad engineer or there is some deep bug laying down
[15:42:40] <rossjones> It's more likely the latter. I am not a big fan of sqlalchemy though, so I don't like delving too deep.
[15:44:36] <yanik_> What do you use? Raw sql?
[15:53:43] <rossjones> Now I use sqlalchemy, but I think I prefer simpler orms (like the django one) when I have to use them.
[16:22:29] <nigelb> rossjones: sqlalchemy is complicated, but I've learned to love it.
[16:22:41] <nigelb> 90% of the time when I've blamed sqlalchemy it's because of bad code.
[16:23:13] <rossjones> nigelb  It's the magic revision and session stuff I don't like.
[16:24:15] <nigelb> rossjones: That's our magic, right?
[16:51:55] <rossjones> well. yes.

2016-01-03
[12:53:08] <rossjones> nigelb er, what? That sounds ominously like I've been volunteered for something.
[14:06:06] <nigelb> rossjones: ahahaha, for some reason I thought you were the release manager for this release and not dread :p

2016-01-02

2016-01-01

2015-12-31
[11:56:22] * emmajane waves. "Thanks for the tip, rossjones" :)
[12:22:43] <rossjones> Hey emmajane welcome :)
[12:23:04] <emmajane> rossjones thanks. :)
[12:23:33] <emmajane> I'm all excited to have a new thing to dive into, even though I don't *really* get to play with it.
[12:23:44] <rossjones> There's also a mailing list if this channel's too quiet, it's at https://lists.okfn.org/mailman/listinfo/ckan-dev
[12:24:52] * emmajane subscribes to all the things.
[12:26:21] <emmajane> I've started digging in a little bit because we're integrating with HDX from our site.
[12:26:34] <emmajane> (which uses CKAN, obvs?)
[12:27:10] <rossjones> AKAI it still uses it :)
[12:27:16] <rossjones> AFAIK even
[12:27:36] <emmajane> It does.
[12:27:54] <emmajane> I can't remember what version they're on though.
[12:28:23] <rossjones> https://data.hdx.rwlabs.org/api/util/status says 2.3
[12:28:34] <emmajane> pssh. That's cheating! :)
[12:29:37] <rossjones> They could do with updating, 2.5 is the latest (and best)
[12:30:03] <emmajane> Good to know also +the best. Sometimes latest isn't quite always the best.
[12:30:38] <rossjones> Nah CKAN is definitely on the latest-is-best upward curve :) Some of us remember the pre 2.0 days
[12:30:40] * rossjones shudders
[12:30:46] <emmajane> hehe
[12:31:12] <emmajane> (I'm like that with Drupal pre v5)
[12:34:34] <rossjones> I'm not a fan of Drupal. We integrate with it, but barely.
[12:35:33] <emmajane> There's a bell curve to loving Drupal. Those who touch it a lot; and those who touch it a little have equal hate for different reasons. :)
[12:36:03] <emmajane> running out for lunch. back for more in a bit.
[14:03:01] <rossjones> Beer time! Happy New Year Everyone!
[14:07:52] <emmajane> \o/
[14:07:59] <emmajane> rossjones, see you next year. :)
[17:58:14] * nigelb waves to rossjones and emmajane
[17:58:21] <nigelb> rossjones: congrats on being release manager.
[18:46:16] <travis-ci> wardi/ckan 2818-remove-compat-hacks 34c2f7e https://travis-ci.org/wardi/ckan/builds/99633838 Ian Ward: The build failed.
[18:53:01] <travis-ci> wardi/ckan 2818-remove-compat-hacks 5786994 https://travis-ci.org/wardi/ckan/builds/99633363 Ian Ward: The build failed.

2015-12-30

2015-12-29

2015-12-28
[02:12:53] <notthemessiah> so, I'm getting a "Connection to https://github...master.tar.gz could not be established" despite being able to access the URL on my own
[02:13:48] <notthemessiah> oh, nevermind
[02:15:19] <notthemessiah> thought I was on Esper
[16:46:57] <SkramX> do any of the data.json harvesters allow you to choose a category or selectively harvest only specific datasets, not all of them?/

2015-12-27

2015-12-26

2015-12-25
[10:08:03] <yanik> please share guide for apache2 config for CKAN
[10:09:06] <yanik> is this one is complete http://docs.ckan.org/en/latest/maintaining/installing/deployment.html ?
[10:11:24] <yanik> also you have error here "|apache_config_file|"
[15:35:02] <yanik> is this CKAN relates issue http://stackoverflow.com/questions/34464119/python-requests-azure-vm ?

2015-12-24
[11:22:35] <yanik> any suggestions why "504 Gateway Time-out" keeps hitting me on server, while creating new resource for dataset? locally all great.. how can i trace that ?
[11:23:08] <yanik> but resource created, even when 505 raises, so viered
[11:23:13] <yanik> wired*
[12:30:42] <yanik> and dubug errors are empty
[14:15:13] <amercader> A lovely Christmas or Holidays to all the great CKAN community!
[14:15:25] <amercader> And here's for a great 2016 as well
[14:48:17] <tomkralidis> amercader: where does CSW harvesting happen in CKAN?  in ckanext-spatial?
[14:48:52] <tomkralidis> (same to yourself and all CKAN-ers -- Merry Christmas / Happy Holidays!)
[14:49:57] <amercader> tomkralidis: yes, here : https://github.com/ckan/ckanext-spatial/blob/master/ckanext/spatial/harvesters/csw.py
[14:50:21] <tomkralidis> thanks amercader
[14:50:42] <tomkralidis> as per https://github.com/geopython/pycsw/issues/301 I will do a PR to set explicit sorting.  Cheers
[15:38:07] <corebits> amercader: Same to you, and to all the rest of the team as well, Happy Holidays.
[17:10:59] <yanik_> happy holidays, guys)
[17:11:19] <yanik_> i guess you'l resting by now :)

2015-12-23
[11:00:52] <travis-ci> ckan/ckan 2609-delete-related-items 7c25227 https://travis-ci.org/ckan/ckan/builds/98490968 Ross Jones: The build was broken.
[11:02:23] <rossjones> Travis shaming me in IRC again! :(
[11:02:43] <travis-ci> ckan/ckan 2609-delete-related-items 6ed9c9f https://travis-ci.org/ckan/ckan/builds/98492141 Ross Jones: The build has errored.
[11:14:09] <travis-ci> ckan/ckan 2609-delete-related-items d745f67 https://travis-ci.org/ckan/ckan/builds/98491366 Ross Jones: The build was broken.
[11:16:45] <rossjones> Can we turn this off for branches that aren't master?
[11:33:08] <travis-ci> ckan/ckan 2609-delete-related-items 8823cf3 https://travis-ci.org/ckan/ckan/builds/98492880 Ross Jones: The build was broken.
[15:30:10] <rossjones> I am imagining a but where if you send 'field': None to package_show it just gets ignored?
[15:30:56] <rossjones> I mean package_update of course.
[18:02:18] <TheCoffeMaker> Hi all, sorry to bother ... I'm having a problem with a ckan deployment using docker ... I'm using the github's project ... the thing is that when I upload datasets instead of taking the hostname it's using the server's local ip address (not the ip from the containers, it takes the ip from the host) ... I had to change the resource and resource_revision url field and rebuild the solr indexes, but it still taking the host ip addr
[18:02:21] <TheCoffeMaker> any clue ?

2015-12-22
[12:04:25] <wardi_> meeting?
[12:13:43] <rossjones> Sorry. Babysitting today.
[12:17:44] <wardi_> ok
[12:49:38] <rossjones> Just assign everything to dread, he won't mind :)
[13:56:08] <yanik> where is my custom (not extra) field lay down in databse? http://docs.ckan.org/en/latest/extensions/adding-custom-fields.html
[13:56:40] <yanik> and how i can access them? simple pkg.custom_text now workign
[14:09:22] <yanik> not* ;/
[15:48:46] <rossjones> yanik they're stored as extras.
[16:05:21] <yanik> oh, i have so weird bug, i will report it
[16:05:49] <yanik> thats why i was asking about simple extra fields, when its obvious

2015-12-21
[10:42:04] <teemu> anyone know why and where ckan logs users off when they try to open a dataset they have no rights to? In my case it seems to be for opening a previously deleted dataset
[11:10:05] <rossjones> teemu  does it take you to the login page as well?
[11:10:20] <teemu> yes
[11:11:03] <rossjones> Doesn't seem right that it should log you off, offer the change to re-login as another user sure, but not log you off.
[11:11:29] <teemu> I agree
[11:11:36] <teemu> but it actually logs you off
[11:11:53] <teemu> need to go to a meeting to discuss this very matter now, bbl
[11:12:00] <rossjones> If you were to add a ticket we can discuss it at next meeting and see if it was intentional (I can't imagine it would be).  I'd prefer deleted datasets to 404 I think.
[11:12:05] <rossjones> ok.
[13:16:59] <teemu> rossjones: just verified the forced logout on demo.ckan.org, making a ticket
[13:20:27] <rossjones> Thanks.
[13:23:11] <teemu> https://github.com/ckan/ckan/issues/2805
[16:01:11] <wardi_> should be a 404 instead, I think
[16:01:49] <wardi_> if you're not allowed to see it you shouldn't be able to find out that it exists, right?
[16:22:06] <rossjones> That makes a lot of sense.
[16:22:39] <rossjones> An autologout seems like the last possible thing I'd expect :)
[16:24:15] <rossjones> wardi_  do you think removing genshi support in 2.6 seems like the sort of thing that might be allowed in a point release?  It's been deprecated for 5 releases now

2015-12-20

2015-12-19

2015-12-18
[04:48:37] <nigelb> rossjones: If you still need help with packaging, let me know. I have full access.
[08:58:05] <rossjones> nigelb  all sorted now thanks.
[09:01:56] <nigelb> rossjones: :)
[09:56:23] <yanik> rossjones, state='active'  causes deadlock too :D
[09:56:40] <yanik> funny, never had one in my projects
[09:56:50] <yanik> and now i kind a enjoy it ))
[09:59:36] <rossjones> yanik  is the code anywhere?
[09:59:41] <rossjones> I mean anywhere I can see
[10:00:15] <rossjones> You probably need to guard around the value being set, i.e. don't set it if it is already set, otherwise 'bad things'
[10:01:12] <rossjones> I've recently been having nightmares about the way lots of interfaces work when triggering tasks that modify objects :(
[10:03:13] <yanik_> ha-ha, and who was chasing you, in that nightmare?
[10:07:54] <rossjones> :) We should document the things you should always avoid doing in IDomainObjectNotification and friends.
[10:34:05] <yanik> so notify not really catch dataset creation
[10:34:22] <yanik> if you want to modify package table
[13:02:15] <rossjones> yanik  is it something you cannot do in validation/conversion step?
[13:06:38] <rossjones> Sorry I am not being much help, my head is all tied up in the deeply intertangled collection of celery-driven tasks that are firing off IDomainObjectNotification events :(
[13:06:55] <rossjones> I can see why some find microservices appealling.
[13:08:07] <yanik> it's fine, it's my job
[13:08:20] <yanik> and celery is cool
[13:11:35] <yanik> you mean SASS as microservices?
[13:17:07] <rossjones> I think I mean I would prefer some of the extensions we use to be separate services, rather than embedded inside celery/ckan processes.
[13:59:34] <yanik> yeah, it wood be nice, and less complicated structurally
[16:17:20] <LondonAppDev> Hey guys. Does anyone know why the resource "format" get's changed when harvesting datasets? for example, if I set format = 'inp' it changes it to "	chemical/x-gamess-input", but I can't find anywhere that it maps this value. Also there is no FK on the format field in the DB (it's just a string).
[16:19:17] <DragonDave> That looks suspiciously like the output of `file`, so the `magic` library might be determining a filetype.
[16:20:23] <DragonDave> That mime type is associated with '.inp' files.
[16:22:52] <DragonDave> http://docs.ckan.org/en/ckan-1.7.2/domain-model-resource.html implies that both mimetypes and file extensions are valid
[16:24:25] <LondonAppDev> Thanks for pointing me in the right direction DragonDave.
[16:24:41] <DragonDave> :)
[16:24:45] <LondonAppDev> It really is Magic.
[16:24:53] <DragonDave> Yep, that's the name of it :)
[16:35:23] <LondonAppDev> DragonDave: There is no 'magic' library in CKAN. Closest I can find it MagicMock which is a class for testing.
[16:36:02] <DragonDave> there might be a shelling out to the `file` command, perhaps?
[16:36:21] <DragonDave> (or there's a python wrapper I think)
[16:37:02] <LondonAppDev> ahhh I see what you mean

2015-12-17

[11:30:04] <rossjones> brook/nigelb do either of you have access to http://packaging.ckan.org.s3-eu-west-1.amazonaws.com/build so that I can find the deb packages for the point releases?
[11:37:53] <brook> This location? http://packaging.ckan.org/build/
[11:38:01] <brook> rossjones ^
[11:46:09] <rossjones> Ah. Cool. Thanks brook
[11:47:50] <rossjones> The links are bad, too many /
[12:08:33] <wardi_> i've got a conflict, will miss this meeting
[12:23:41] <rossjones> :( Usual rules apply, any issues you *definitely* don't want? ;)
[12:29:21] <amercader> wardi_: you'll miss the post-release party dread is preparing
[12:59:22] <wardi_> amercader: i know. i'm super bummed about that.
[13:38:51] <travis-ci> ckan/ckan release-v2.5.0 aa138a4 https://travis-ci.org/ckan/ckan/builds/97444166 David Read: The build was broken.
[14:00:24] <rossjones> Meeting is cancelled as nearly everyone is working on 2.5 release :)  Unless anyone really wants to chat about anything ...
[14:19:03] <travis-ci> ckan/ckan release-v2.5.1 e41cac2 https://travis-ci.org/ckan/ckan/builds/97449322 David Read: The build failed.
[15:32:33] <yanik> rossjoness, how come notify from IDomainObjectModification called 3 times after dataset creation? it's impossible catch when tables are ready to work with ;/
[15:33:05] <yanik> with 3 operations: new, change, change
[16:47:25] <rossjones> yanilk it is?!
[16:47:40] <rossjones> Oh, you've gone.
[17:01:55] <rossjones> yanik  you're back.
[17:02:30] <rossjones> I just checked and yes, first is state='draft'.  second is state='draft' which was triggered because the resource was added.  The last and final one is state='active' - which is the one you want I think.
[17:05:38] <yanik> rossjones, but second and third have same operation status "changed", so it's not so easy to catch
[17:05:57] <yanik> thats why i have blocked postgres table when catching 2nd
[17:06:19] <yanik> w will check state option, thx
[17:06:29] <yanik> as always :)
[17:06:37] <rossjones> You can just do entity.state == 'active', can't you?
[17:06:45] <yanik> i will try
[17:06:58] <rossjones> :)
[17:27:41] <travis-ci> ckan/ckan master 082858f https://travis-ci.org/ckan/ckan/builds/97492597 David Read: The build was broken.
[17:31:56] <travis-ci> vitorbaptista/ckan-1 master 082858f https://travis-ci.org/vitorbaptista/ckan-1/builds/97493912 David Read: The build was broken.
[17:42:14] <travis-ci> ckan/ckan release-learnings 26f5b71 https://travis-ci.org/ckan/ckan/builds/97496516 David Read: The build failed.
[17:50:17] <travis-ci> vitorbaptista/ckan-1 fix-auth-is-anon-user 84f1ef1 https://travis-ci.org/vitorbaptista/ckan-1/builds/97498561 Vitor Baptista: The build failed.
[18:06:22] <travis-ci> ckan/ckan document-patch-releasing 367d758 https://travis-ci.org/ckan/ckan/builds/97501563 David Read: The build failed.

2015-12-16
[14:09:28] <rossjones> Is it just me or does gitlab send the emails in a random order?
[14:10:41] <travis-ci> ckan/ckan release-v2.1.7 c70f5f1 https://travis-ci.org/ckan/ckan/builds/97216300 amercader: The build failed.
[14:32:55] <travis-ci> ckan/ckan release-v2.3-latest 6065dcc https://travis-ci.org/ckan/ckan/builds/97216956 amercader: The build has errored.
[15:03:27] <yanik> how can I catch dataset creation? I need add one-to-one refashion after creating dataset
[15:36:14] <rossjones> yanik -> https://github.com/ckan/ckan/blob/master/ckan/plugins/interfaces.py#L193
[15:36:35] <yanik> Thx!!
[15:37:06] <rossjones> Example use -> https://github.com/ckan/ckanext-archiver/blob/master/ckanext/archiver/plugin.py#L32
[15:37:40] <yanik> it's seems like I should allow my field to be null and add it afterwards
[15:41:57] <yanik> thx a lot
[15:48:02] <rossjones> You *probably* shouldn't modify the package in there.
[15:52:01] <rossjones> I would say use IPackageController, but it doesn't have a before_create like IResourceController.
[15:52:44] <rossjones> Bug report time :(
[16:13:54] <yanik> it's not a bug))
[16:23:55] <yanik> rossjones, it worked exactly as i needed, thx
[16:28:07] <yanik> and the best way to update entity is like:
[16:29:51] <yanik> use current sqlalchemy session
[16:30:24] <yanik> and just query that entity and add needed column, right?
[17:54:12] <travis-ci> ckan/ckan release-v2.5.0 a4279d0 https://travis-ci.org/ckan/ckan/builds/97269647 David Read: The build was broken.
[18:11:14] <travis-ci> ckan/ckan master 248006d https://travis-ci.org/ckan/ckan/builds/97270095 David Read: The build was broken.
[18:13:32] <travis-ci> ckan/ckan release-v2.5.0 9791640 https://travis-ci.org/ckan/ckan/builds/97270844 David Read: The build was broken.
[18:21:32] <travis-ci> ckan/ckan release-v2.5.0 52ccc10 https://travis-ci.org/ckan/ckan/builds/97271598 David Read: The build was broken.
[18:29:33] <travis-ci> ckan/ckan ckan-2.5.0 6f493ca https://travis-ci.org/ckan/ckan/builds/97273082 David Read: The build failed.

2015-12-15
[08:22:30] <sneumann_> Hi, I'd like to use ckan as metadata store and search/access interface to an institutional data repository. The data is already living on a file server, so I'd like to NOT upload the data, but kind of point CKAN to the local/NFS filesystem when creating a dataset. Since there are MANY extensions, I am sure there is an extension also for that. Any suggestion which to try first ?
[12:02:35] <rossjones> Anyone about for the team call?  wardi_ brook amercader?
[12:02:51] <wardi_> sneumann__: you can certainly link to data and not upload it
[12:03:03] <wardi_> yep, I'm here
[12:03:16] <rossjones> brook ?
[12:03:47] <rossjones> And would anyone else like to come and be assigned some bugs/prs?
[13:24:57] <yanik_> is there is simple way to change Package ID column from TextField to Int?
[13:25:07] <yanik_> and anyone own explanation why it's TextField anyway?
[13:26:59] <Zharktas> yanik_: that because ids are guids, not numbers
[13:27:34] <yanik_> guides? in what way?
[13:28:01] <Zharktas> not guides, guids: https://en.wikipedia.org/wiki/Globally_unique_identifier :p
[13:31:08] <Zharktas> for example for dataset http://demo.ckan.org/dataset/another-test-434 the id is 76b9e76f-00bf-46f1-8152-0458d111c278
[13:31:23] <Zharktas> http://demo.ckan.org/dataset/76b9e76f-00bf-46f1-8152-0458d111c278 this returns the same page
[13:54:27] <yanik_> Zharktas, thx for explanation

2015-12-14
[17:30:58] <LondonAppDev> Hey guys, out of curiosity does anyone know if a OAI-PMH Server which can present a harvest endpoint from a MySQL server?

2015-12-13

2015-12-12

2015-12-11
[11:05:01] <teemu> Package plugins (IDatasetForm) are limited to one per package type. Any idea how I should deal with having several extensions that want tointroduce their own plugins? In my case it's ckanext-scheming and a separate plugin that handles some data cleaning before stuff is committed into database. Anyone else run into a situation like this?
[12:03:23] <sebmol> hi
[13:57:40] <wardi_> teemu: you can extend the scheming plugin class if you need to
[14:21:09] <rossjones> vitorbaptista are you working on datapackages atm?  I need some advice about adding an alternate tag.

2015-12-10
[08:01:28] <teemu> I'm making a IDatasetForm plugin that should amend the schema for "dataset" type packages. It gets loaded but none of the "*_package_schema" functions get called. I'm using [] as package_types and with is_fallback returning true. Shouldn't this make it the default handler, also handling "dataset"?
[09:04:32] <rossjones> pwalsh would it be possible to also special-case the ckan-dev mailing list when you're turning them off after xmas?  I don't think a move to discourse would go well.
[10:07:49] <pwalsh> rossjones I'm really not at all the point of contact for this
[10:08:00] <pwalsh> But I'll pass on the information
[10:08:07] <rossjones> pwalsh  who should I be asking?
[10:08:26] <pwalsh> It is not a technical decision at all, it comes from community management
[10:08:58] <pwalsh> Mor Rubenstein AFAIK, but I'm also trying to get a handle on what decision has been made, if any
[10:11:02] <rossjones> Okay thanks. I don't have any means of discussing it though, so would appreciate if you could pass on my concern that it not be applied indiscrimately, if at all possible :)
[10:11:19] <rossjones> I think the community should decide, rather than having it imposed.
[10:22:10] <pwalsh> I've raised the issue.
[10:25:13] <pwalsh> rossjones you do have a means of discussing it though: on the mailing list would be the place for that I'd say. It would also be the best way to gauge the general sentiment.
[10:28:41] <rossjones> Thanks.  Sure, I can discuss it on ckan-dev, but I am probably not on the list that Mor reads.
[10:29:32] <nigelb> We are not shutting down the mailman server.
[10:30:10] <rossjones> nigelb that's good news - I will now stop rattling the bars of my cage ;)
[10:30:30] <nigelb> Some communities are moving to discuss, but not all. I doubt ckan will be moved without having a conversation with us to be begin with.
[10:30:46] <nigelb> And CKAN is not managed under OKF's community team per se.
[10:32:23] <nigelb> We've just confirmed that ckan was never part of the plan to be moved (as amercader can confirm)
[10:32:53] <amercader> I hereby confirm the above statement
[10:33:09] <nigelb> Some of the things that moved are things like index, which already had a significant movement on discuss rather than mailman.
[10:34:37] <pwalsh> thanks nigelb for jumping in :)
[10:37:36] <rossjones> Maybe we should have a general discussion anyway about moving the list to another provider? That might lessen the load on OK's mailman?
[10:37:47] <rossjones> I've added it to the pad to discuss at the meeting later.
[10:40:00] <amercader> rossjones: my thoughts on that are "if ain't broken don't fix it". Unless nigelb can confirm that is an actual burden I'd leave it as is
[10:40:48] <rossjones> Okay, that saves a conversation :)
[10:42:04] <amercader> we can talk about flask or football or whatever instead
[10:42:07] <rossjones> This isn't the first time it's come up.  Even the ckan-global list was moved to GG, and discourse keeps popping up.  I'll save my thoughts for the next time it comes up ;)
[10:42:16] <rossjones> amercader  flash ftw!
[10:42:42] <Zharktas> we need more superheroes
[10:48:13] <nigelb> There isn't any burden at all.
[10:48:49] <nigelb> in how many hours is the meeting?
[10:55:39] <rossjones> nigelb  3 hrs I think
[10:57:37] <nigelb> I might join in to hear about this flask proposal :)
[10:57:40] * nigelb keeps an alarm.
[11:03:32] <rossjones> I'm not sure it is worth 'getting out of bed' exciting.
[11:07:51] <nigelb> rossjones: Mostly it's a "remember to join" alarm.
[12:01:27] <rossjones> Timezones are beyond me :)
[14:00:04] <wardi_> meeting anyone?
[14:01:44] <amercader> coming!
[14:03:47] <wardi_> rossjones: ^?
[14:08:13] <rossjones> oops, still going?
[14:37:49] <rossjones> wardi_  do you guys have mince pies in Canada?
[14:43:47] <wardi_> we do, they're not super common though
[14:44:55] <rossjones> My wife looked at me incredulously when she first saw one, thought I was nuts. Not so common in France either I gather.
[16:05:01] <rossjones> Why did I start investigating this migration stuff ...  :(

2015-12-09
[09:13:19] <travis-ci> ckan/ckan 2776-update-toolkit d160961 https://travis-ci.org/ckan/ckan/builds/95605717 Ross Jones: The build has errored.
[09:30:29] <travis-ci> ckan/ckan 2776-update-toolkit 8f95482 https://travis-ci.org/ckan/ckan/builds/95617906 Ross Jones: The build has errored.
[10:14:58] <travis-ci> ckan/ckan 2776-update-toolkit 985aa4e https://travis-ci.org/ckan/ckan/builds/95625379 Ross Jones: The build failed.
[11:01:30] <travis-ci> ckan/ckan 1527-fix-failures a8c141d https://travis-ci.org/ckan/ckan/builds/95767498 amercader: The build failed.
[12:38:46] <LondonAppDev> Hey guys, how come there is a template selection under /templates/development/snippets/pagination.html. Are these only for the development version?
[13:05:02] <travis-ci> ckan/ckan release-v2.4.2 1b30332 https://travis-ci.org/ckan/ckan/builds/95791404 amercader: The build was broken.
[13:09:01] <travis-ci> ckan/ckan release-v2.3.3 3d42ae1 https://travis-ci.org/ckan/ckan/builds/95791438 amercader: The build was broken.
[13:09:22] <amercader> sigh pep8, we meet again...
[13:09:29] <travis-ci> ckan/ckan release-v2.2.4 b55a69a https://travis-ci.org/ckan/ckan/builds/95791462 amercader: The build was broken.
[13:09:39] <amercader> expect a couple more failure messages
[13:10:35] <rossjones> What's happening with travis? Failing badly, but restarts sometime make it pass
[13:21:27] <LondonAppDev> What editors do you guys use?
[13:21:31] <LondonAppDev> Text editors.
[13:22:04] <amercader> LondonAppDev: I use vim
[13:22:20] <LondonAppDev> Like a true pro ;)
[13:24:34] <teemu> vim too
[13:25:20] <amercader> LondonAppDev: most ckan devs I know do use it
[13:25:30] <amercader> some others use Sublime Text
[13:25:38] <LondonAppDev> Ah ok cool.
[13:25:59] <LondonAppDev> I use Atom as my editor and Vagrant to run my environment. Sorry guys.
[13:26:07] <amercader> although recently I heard of different people using PyCharm as well
[13:26:27] <amercader> how are you finding Atom?
[13:26:34] <LondonAppDev> I love it.
[13:26:38] <LondonAppDev> I used to use eclipse lol.
[13:27:01] <LondonAppDev> Because it was the only IDE with a decent remote server syncrhonization.
[13:27:08] <LondonAppDev> But then I discovered Vagrant and didn't need that anymore.
[13:27:26] <LondonAppDev> I use Vim when editing files through SSH though.
[13:27:51] <LondonAppDev> Atom has a plugin which checks PEP-8 and decorates invalid PEP-8 code with lovely red lines lol.
[13:29:05] <rossjones> LondonAppDev  Visual Studio Code
[13:29:17] <LondonAppDev> Do you use VS?
[13:52:45] <rossjones> No, just the cut down editor.  Sometimes.
[13:53:03] <rossjones> LondonAppDev  this thing -> https://www.visualstudio.com/en-us/products/code-vs.aspx
[13:53:18] <rossjones> uses electron like atom, but I've found it to be a lot faster
[14:00:04] <LondonAppDev> rossjones, that's cool! I'm definitely going to check it out.
[14:00:12] <dragon_> atom
[14:00:25] <dragon_> [gah, that was supposed to be a search]
[14:00:48] <dragon_> What atom packages are you using, out of interest?
[14:01:43] <LondonAppDev> dragon_ I am using linter-pep8, atom-beautify, linter and minimap.
[14:02:57] <dragon_> awesome
[14:19:14] <LondonAppDev> Does anyone know how I can add get parameters to a t.render() call?
[14:48:32] <rossjones> LondonAppDev  Use the extra_vars kwarg to pass a dictionary of data
[14:48:57] <rossjones> t.render("mytemplate.html", extra_vars={'data': 'here'})
[15:31:38] <LondonAppDev> Thanks rossjones.
[15:50:10] <LondonAppDev> rossjones: FYI, I added pagination support to ckanext-report and made a pull request: https://github.com/datagovuk/ckanext-report/pull/11
[15:51:40] <rossjones> LondonAppDev  that's fantastic, thank you.  Will discuss it during our standup tomorrow and see if dread has time to take a look.
[16:05:19] <LondonAppDev> rossjones great. I'll be flying to Canada tomorrow so won't be able to make the call myself but I guess you guys can just look at it and merge it if all looks good? I checked to ensure it was backward campatible with reports not using pagination.
[16:07:46] <rossjones> it's not the ckan team standup, just the DGU one. I'll try it on my VM beforehand and so it should be quicker to merge then :)
[16:08:00] <LondonAppDev> sweet thanks
[16:14:11] <LondonAppDev> rossjones do you work for Data Gov UK?
[16:16:41] <LondonAppDev> Did anyone here ever use SaltStack to deploy CKAN instances?
[16:22:42] <corebits> LondonAppDev: I currently use ansible for deploys, on centos/rhel 7
[16:24:10] <corebits> Hey Guys, someone recently was talking about updating SSl documentation, anyone recall who that was ? I need to do some work on our ssl implementation.
[16:50:21] <rossjones> LondonAppDev  'work' is a loaded word, but I guess so.
[17:06:40] <LondonAppDev> corebits: ok cool. Very brave going off docs and doing it on CentOS ;).
[17:07:09] <LondonAppDev> rossjones: that's cool, I guess it's based in London right?

2015-12-08
[11:40:11] <wardi_> will be late for this meeting
[11:40:44] <amercader> wardi_: will you make the second half?
[11:41:03] <wardi_> yes, i should be able to
[11:41:30] <amercader> great, I need to talk about $$$ semi-urgently
[11:41:52] <amercader> rossjones: are you joining today? I want to talk about flash
[11:41:56] <amercader> *flask
[11:42:45] <rossjones> Yup.
[11:43:13] <rossjones> amercader although flash might be interesting :)
[11:43:14] <amercader> awesome
[11:43:27] <amercader> tech of the future
[12:02:28] <rossjones> Call time!
[12:04:00] <rossjones> brook ?
[12:13:03] <LondonAppDev> Hey guys, is there no relationship between Package.owner_org and Group.id ?
[12:13:59] <rossjones> You mean an FK? Surprisingly I don't think so.  It's pretty new, used member table previously
[12:15:05] <LondonAppDev> yeah FK
[12:15:08] <LondonAppDev> Ahhh okl
[12:37:50] <LondonAppDev> So it means there is no way to get the owner org name without doing another query right?
[12:38:01] <rossjones> :( Use package_show?
[12:39:04] <LondonAppDev> I'm basically doing it in SQLAlchemy for reports.
[12:39:15] <LondonAppDev> Want to list a bunch of datasets with owner org names.
[12:39:45] <rossjones> Yeah, you'll have to join
[12:40:59] <LondonAppDev> Sweet. I think I found the solution.
[12:41:01] <LondonAppDev> Cheers rossjones.
[12:41:06] <rossjones> np
[13:24:24] <rossjones> wardi_  amercader  I may have spoken too soon - lots of imports, although most will just be exposing the underlying libraries - https://github.com/ckan/ckan/wiki/Pylons-imports
[13:25:21] <amercader> good lord
[13:26:43] <rossjones> A few paste or dupes might have slipped in to that list.
[13:27:04] <rossjones> someone needs to investigate whether request is just a wsgi.request, and so forth.
[13:27:45] <rossjones> I think the goal should be to turn those into 'from ckan.X' so we can hide the implementation detail, and add some to the toolkit.
[14:34:57] <LondonAppDev> Can pagination of datasets be completely handles in a template?
[14:38:11] <brook> Does anyone know of any Backbone JS models/collections for working with the CKAN API, especially for resources?
[14:41:25] <rossjones> LondonAppDev  Yes, but don't.
[14:41:52] <LondonAppDev> rossjones I'm trying to add pagination to a report.
[14:42:00] <LondonAppDev> with the ckanext-report extension.
[14:42:48] <rossjones> Ah. Right.
[14:42:50] <rossjones> Um.
[14:43:05] <rossjones> Yeah, you may have to unless you fancy adding pagination support to the extension ;)
[14:46:14] <LondonAppDev> rossjones I'll give it a shot.
[14:46:20] <LondonAppDev> Can't be too difficult.
[14:59:20] <rossjones> Famous last words :)
[15:00:04] <rossjones> I've updated the Wiki page about Pylons imports, looks like if I send a PR for config in toolkit, there's only really translator that is commonly imported -> https://github.com/ckan/ckan/wiki/Pylons-imports
[15:01:36] <rossjones> The problem is how do we get people to update their extensions if they're not depending on a version of CKAN that will contain these in toolkit? i.e. if it goes into 2.6 but someone is still on 2.4, they can't update their extension :(
[15:03:49] <wardi_> they can try: except: around their import to support both
[15:04:26] <wardi_> or we could publish a python module that does that for them
[15:06:03] <rossjones> auto github PRs ;)
[15:06:42] <wardi_> pip install ckansix
[15:06:54] <rossjones> hahaha
[15:07:07] <wardi_> there's nothing we can't fix with another layer of abstraction
[15:07:29] <rossjones> Wish I knew why config was overlooked in toolkit when it was made :(
[15:38:56] <wardi_> maybe you're supposed to be getting your config from an IConfigurable plugin once and saving it yourself
[15:49:11] <wardi_> then the next problem is: where do you put that state?
[16:04:35] <rossjones> Exactly, I don't think anybody bothers, they just access the config object whenever they need things.
[16:15:11] <LondonAppDev> rossjones, the report cache seems to store the report as a JSON string in a single text field so unfortunately pagination at the database level is not possible.
[16:24:43] <rossjones> Hmm. This is not ideal.
[16:27:46] <LondonAppDev> no haha
[16:28:17] <LondonAppDev> Not ideal, but it will allow the benefits of pagination on the client side at least.
[16:46:13] <rossjones> If you're stuck sending the whole thing anyway :
[16:55:49] <LondonAppDev> Still have to send the whole thing but we can reduce the number of rows displays in the browser at a time.
[16:56:10] <amercader> brook: IIRC ckanjs was this: https://github.com/okfn/ckanjs-deprecated
[16:56:20] <amercader> note the deprecated in the repo  name
[16:58:16] <brook> Thanks
[17:49:03] <LondonAppDev> Which version of Bootstrap are we on?
[18:02:32] <Zharktas> 2.3
[18:02:45] <Zharktas> there is an issue to update to 3.something
[18:02:50] <Zharktas> but its a lot of work

2015-12-07
[00:25:45] <wardi_> mchelen: I'll take a look at it
[00:29:24] <mchelen> wardi_: thanks, its a very simple change to get the fixes in the ckan:2.4 docker image used by default
[09:31:34] <rstolt> Hi is there a reason why the requests version isn't bumped up? It's constantly on 2.3.0 from CKAN version 2.3 until 2.4.1.
[10:13:35] <rossjones> rstolt  it's probably that nobody sent a PR :)
[13:08:14] <rossjones> wardi_  am I just blind or does https://github.com/ckan/ckanapi#bulk-operations not actually explain how to dump? The next section mentions datapackages but i guess load doesn't work with those?
[14:31:40] <wardi_> rossjones: the docs are thin, but load with --datapackages should work
[14:32:12] <wardi_> note that ckanapi doesn't do any transforming and just dumps your ckan metadata as into the json hoping that it's valid for the datapackage format
[14:32:29] <wardi_> (well, it transforms the urls because the files are downloaded)
[14:33:16] <rossjones> ah i thought it was special.  just wanted the json lines to use with load... but if it works that's cool. Will send a PR to docs to move the dump above the load ;)
[14:33:51] <wardi_> good idea
[16:59:19] <rossjones> 1. I have a background task that is triggered within IDomainObjectNotification ... 2. this sends a job via celery which 3. runs a task.  4. This task updates the object, 5. Goto 1.
[16:59:30] <rossjones> How do I escape this loop?
[17:27:52] <wardi_> rossjones: other than with a terrible global/context flag?
[17:28:44] <rossjones> Yes, or worse, with a revision tag or something.
[17:28:54] <rossjones> I see this might be a possible flaw in our design :(
[17:29:39] <wardi_> rossjones: make your celery update idempotent so it can tell when it doesn't need to make the change (again)
[17:30:12] <rossjones> Yeah, that's the approach I'm taking.
[17:30:23] <wardi_> rossjones: what's the thing that your task is doing?
[17:30:25] <rossjones> But it does trigger 4 different background tasks :( QA, Archival etc
[17:30:45] <rossjones> It's during QA.  If the resource doesn't have a format, I'm going to set it to whatever QA decided the content was.
[17:31:48] <wardi_> so there should be no loop if you're setting all the formats, right?
[17:34:55] <rossjones> Right. It just feels a bit wasteful to re-trigger all those background tasks I guess.
[17:35:31] <rossjones> Oh. Wait. I've got an idea.
[17:37:45] <rossjones> But I'm not going to tell you because you'll think we're nuts for 2 reasons :)
[18:40:39] <wardi_> rossjones: aw. that sounds interesting
[19:35:40] <rossjones> wardi_  it's because our workers load their own copies of ckan... 8|
[20:14:47] <wardi_> oh, so you just have different configuration for the worker to prevent the extra scheduling
[20:16:56] <rossjones> Yeah, may end up looking at that route.

2015-12-06
[21:32:10] <mchelen> idk if anyone here works on the datacats package, but i submitted a PR that would be nice to get merged

2015-12-05

2015-12-04
[16:32:47] <LondonAppDev> Hey guys has anyone seen this before when doing "db load" paster command: https://gist.github.com/LondonAppDev/a4c85ed142eb8682e949
[16:37:51] <palcu> Is there an example where I can add my own custom method to an existing model, like Group for example? My actions are getting bigger and I want to keep my code clean.
[16:39:43] <wardi_> what sort of thing would your method do? Why not just write a function (and do you really need to work with the models directly, you might be coupling your code too tightly to ckan internals)
[16:41:04] <wardi_> LondonAppDev: you have datasets without a creation date?
[16:41:16] <palcu> I've defined myself a custom ID as a GroupExtra. And I wanted a class method like Group.getByCustomId(100) let's say, that returned my Group.
[16:41:28] <LondonAppDev> wardi_ yeah possibly if there is no creation date in the harvested metadata.
[16:41:32] <LondonAppDev> Maybe I should default to today.
[16:41:53] <wardi_> LondonAppDev: that might work around the inflexible search index code
[16:42:03] <palcu> I know I can subclass Group to CustomExtensionGroup and define my class method there.
[16:42:47] <wardi_> palcu: or just write a function that does what you need :-)
[16:43:19] <palcu> yeah, you're right, I was thinking in a complicated manner
[16:43:34] <wardi_> sqlalchemy models are pretty complicated things, I wouldn't go there for fear of *interesting* bugs
[16:45:08] <LondonAppDev> Is there a way to backup/restore using postgresql dumps? I tried it and I got a HTTP 503 service unavailable error.
[16:45:14] <LondonAppDev> Is there like another step to intiiate it or something?
[16:45:20] <LondonAppDev> I also tried db init.
[16:45:36] <LondonAppDev> As in, running db init after importing the postgres dump.
[16:46:27] <wardi_> LondonAppDev: I restore the db, run db upgrade then rebuild the search index, and that's worked so far
[16:47:08] <LondonAppDev> Fantastic let me try db update. Cheers wardi_
[16:47:20] <wardi_> LondonAppDev: I'm pretty sure db init does the same thing
[16:47:57] <LondonAppDev> I'll tell you in 2 mins if it worked or not. db init definitely didn't work.
[16:49:30] <LondonAppDev> Maybe more than 2 mins as db import is huge :)
[17:07:23] <LondonAppDev> wardi_ I think it worked. But there is zero datasets however I am re-building the index now.
[17:07:32] <LondonAppDev> Thank you.
[17:21:11] <wardi_> LondonAppDev: oh, so is db init different than upgrdae?
[17:21:49] <LondonAppDev> wardi_ I think so. Why would there be two names for the same thing otherwise?
[17:22:08] <wardi_> historical reasons. we have lots of those
[17:24:32] <LondonAppDev> wardi_: 'init' calls model.repo.init_db() and 'upgrade' calls model.repo.upgrade_db(self.args[1]) where the argument is the version.
[17:26:01] <wardi_> noted
[17:41:01] <LondonAppDev> On https://github.com/datagovuk/ckanext-report#registration is there any reason "import reports" is within register_reports() and not at the top?
[17:45:16] <wardi_> LondonAppDev: IIRC the paster startup time at dgu was getting obscene
[17:45:48] <LondonAppDev> Ah ok.
[17:45:49] <LondonAppDev> Makes sense.
[17:53:40] <LondonAppDev> Have a great weekend CKAN devs!

2015-12-03
[11:56:27] <rossjones> wardi_ won't make the call today, but added a note about dropping 2.6 support.  Would be interested if there was any interest in considering it during the call.
[13:59:18] <wardi_> vitorbaptista: join us for the meeting?
[14:01:49] <wardi_> brook: meeting?
[16:44:34] <LondonAppDev> Hey guys, does anyone have any advice for checking for duplicate datasets in CKAN?
[16:48:01] <rossjones> LondonAppDev you mean with the same title?
[16:48:31] <LondonAppDev> rossjones, yes. Is it just a case of querying Postgres?
[16:49:03] <rossjones> LondonAppDev or using the paster shell to query via the CKAN models. Either/Or.
[16:50:20] <rossjones> paster --plugin=pylons shell -c $CKAN_INI
[16:50:24] <LondonAppDev> OK rossjones thanks I'll check it out. Do you know if there are any reporting extensions that add graphical reports?
[16:50:28] <rossjones> erm, without the -c
[16:51:06] <rossjones> No, the only reports I know about are ones we have at https://data.gov.uk/data/report but not graphics (you could add them I suppose).
[16:51:36] <rossjones> That's done via https://github.com/datagovuk/ckanext-report
[16:52:03] <LondonAppDev> Oh brilliant.
[16:52:08] <LondonAppDev> Thanks rossjones!
[16:52:19] <rossjones> No probs, I've just landed MORE work on your plate I think ;)
[16:52:46] <rossjones> You have to implement the report generation yourself in your plugin.  I think only our versions of the extensions generate the reports.
[16:52:55] <rossjones> i.e. QA generating broken link reports.
[16:54:07] <LondonAppDev> Sweet
[16:54:09] <LondonAppDev> yeah I can do that
[17:19:40] <rossjones> amercader i think that PR is better now next time you look :)
[19:23:40] <laurentgoderre> Hey fellows!
[20:40:38] <laurentgoderre> Hey guys, I'm starting the work on this: https://github.com/ckan/ckan/issues/2602

2015-12-02
[17:55:34] <rehunted> I'm in trouble with datapusher. I have one XLS that uploads fine, but CSV does not, it claim invalid field name
[17:55:43] <rehunted> the column contains a text like:
[17:56:11] <rehunted> { 'Item': 'Key','Item': 'Key'} and the CSV is quoted with ", so, the line is
[17:56:47] <rehunted> "columnA,columnB,"{ 'Item': 'Key','Item': 'Key'}" # this does not process fine in 0.0.6,
[17:56:58] <rehunted> I don't see any change to fix it on 0.0.7
[17:57:19] <rehunted> I tried replacing ' with " and it worked fine, proves:
[17:57:31] <rehunted> http://comovamos.eokoe.com/dataset/cali-subjetivos_anual/resource_data/a59e1573-2c91-4179-8fee-d8f3f95b2e4d
[17:58:03] <rehunted> hmm, user is : admin and password is admin too
[17:58:41] <rehunted> if someone look at http://comovamos.eokoe.com/dataset/cali-subjetivos_anual/resource_data/d6813f16-69d9-4249-96f3-dec0e2d651a7
[17:58:51] <rehunted> will see the error from datapusher:  {"help": "http://comovamos.eokoe.com/api/3/action/help_show?name=datastore_create", "success": false, "error": {"fields": ["\"\"NSE_1\"\" is not a valid field name"], "__type": "Validation Error"}}
[17:59:23] <rehunted> diccionario_encuestas_cali_2007.csv is a valid CSV, generated with QUOTE_ALL
[18:00:31] <rehunted> diccionario_encuestas_cali_2006-escape.csv is a patched version (different year, but the data structure is the same) with s/'/"/g
[18:00:48] <rehunted> (replace ' with ") and then the files looks like:
[18:01:37] <rehunted> "{""58"":...""}" ("" instead of \" but I guess it is fine too)

[09:39:32] <knud> Good morning. What configuration do I have to change to allow creation of datasets via the REST API (in CKAN 2.4.1)?
[09:42:13] <knud> It doesn't seem to be any of the options in http://docs.ckan.org/en/ckan-2.4.1/maintaining/authorization.html
[09:44:51] <knud> Or do I need to implement IAuthFunctions?
[11:05:59] <rossjones> knud, am not sure, but you should probably use the v3 API if at all possible.
[12:19:03] <knud1> rossjones, thanks. So, there is nothing analog to the ckan.auth.create_user_via_api setting for datasets?
[12:20:19] <Zharktas^> you could just use the v3 api which has package_create
[12:30:45] <knud1> zharktas^ thanks - I don't think the method is the problem. It seems that CKAN is configured not to allow package creation via any API. My question therefore is: how do I change this setting?
[12:31:21] <knud1> I get a "not authorized" error for both v3 API and the old school one
[12:31:47] <knud1> curl -H "Authorization: ..." -X POST -d @new_dataset.json http://datenregister.local/api/3/action/package_create
[12:31:54] <knud1> {"help": "http://datenregister.local/api/3/action/help_show?name=package_create", "success": false, "error": {"message": "Zugriff verweigert: Benutzer  hat keine Berechtigung Pakete zu bearbeiten", "__type": "Authorization Error"}}
[12:32:31] <Zharktas> i would think that you can't actually disable it ?
[12:32:38] <knud1> hm
[12:32:57] <Zharktas> except if your api key does not have rights to create dataset to specific group or org
[12:33:07] <knud1> I use the api key of a sysadmin user
[12:34:15] <Zharktas> and you can create datasets via web interface ?
[12:34:19] <knud1> yes
[13:23:23] <LondonAppDev> Hey guys, in the CKAN harvester why is fetch_stage() and gather_stage() seperate?
[14:01:34] <rossjones> LondonAppDev I think it's just to handle cases where you have one document that contains links to multiple datasets to harvest, some harvesters skip the fetch entirely (for instance if your are harvesting data.json which contains all of the needed data).
[14:01:48] <rossjones> Sorry, I mean skip the gather.
[14:58:37] <LondonAppDev> Cheers rossjones. I meant to ask fetch_stage() and import_stage().
[14:59:07] <LondonAppDev> "gather" seems to get the list of records.
[14:59:18] <LondonAppDev> "fetch" seems to get the specific record
[14:59:28] <LondonAppDev> "import" seems to add it to the CKAN database.
[15:00:07] <LondonAppDev> Looks like "fetch" and "import" could be done by function calls in the same request because they are both executed in the fetch_consumer process.
[15:00:21] <LondonAppDev> But yes I see why it's split up.
[15:01:01] <wardi_> knud1: do you have any plugins enabled that might be interfering?
[15:10:16] <knud1> wardi_ no, but I found an embarrassing other reason why it didn't work
[15:10:30] <knud1> let's just say it works now, thanks all! :)

2015-12-01
[08:50:38] <i-tu> Hi! Is there interest in a conversion to Bootstrap 3? Issue 2602 on github seems to indicate that. I've been working on a BS3 conversion for a while. It's mostly working and I would love to contribute to CKAN. However, the work is incomplete and I need help to do it the right way.
[08:51:27] <i-tu> I've only converted templates my custom theme extension uses, and I'm sure there's a lot of other corners which need to be worked on
[08:51:44] <i-tu> I wrote a brief summary here: https://github.com/ckan/ckan/issues/2602#issuecomment-159856318
[08:57:37] <i-tu> I'm working on this for a customer project, and the right time to do work on this in the context of the project (ie. paid) is right now. So if you have any input, don't hesitate to share :)
[10:15:45] <rossjones> i-tu I think 2.5 is imminent, so it might be best to target that, then it might make the 2.6 release... I'll raise it at the meeting today (unless you want to come along and discuss it).
[12:01:36] <wardi_> rossjones: meeting?
[12:03:50] <rossjones> yup
[12:29:00] <amercader> wardi_: http://data.beta.nyc/dataset/mean-streets-2014-data/resource/e28db028-4557-4218-b900-6ad81d133148?view_id=7802cfd1-4eed-4d9d-9591-bebf539594ea
[12:29:46] <wardi_> nice
[12:30:02] <amercader> there is also ckanext-geoview for WMS,etc: https://salforddataquay.uk/dataset/schools-in-salford/resource/64b6e52d-6b03-4253-bae1-24bb76859730
[12:35:39] <rossjones> NYC also use the less sexy, but vaguely useful MS viewer for MS docs - http://data.beta.nyc/dataset/nyc-open-data-coordinators/resource/c61ca28b-acbc-4386-ae09-2b4ba3ba45a5
[12:37:47] <wardi_> for sure. very useful
[12:39:05] <rossjones> Is there anything special I need to do to get spatial tests running?
[12:40:47] <rossjones> i.e. have they been broken for quite a long time?
[12:44:50] <amercader> rossjones: seems to be a config problem, I'll push a fix
[12:45:33] <rossjones> Oh, great thanks.  Have a minor PR to move imports into the functions where they are used (only for plugin.py) in my endless attempt to get paster to startup in less than 8 seconds.
[12:47:06] <rossjones> Fixing import celery in some extensions (in the plugin.py) took 2 seconds off startup time for me.
[15:30:30] <rossjones> amercader any suggestions for what to call this markdown branch so that it gets into changelog? Don't have a ticket #
[15:32:40] <amercader> rossjones: just add a quick note on the changelog as part of the PR, and we'll polish it when the release happens
[15:32:57] <rossjones> ack
[19:43:03] <rossjones> We don't have a way of having specific deps for users running Py2.6 do we?  :(

2015-11-30
[17:32:41] <th0br0> Any devs around?
[18:22:56] <wardi_> th0br0: ... yes

2015-11-29

2015-11-26

[14:04:41] <wardi_> rossjones_: meeting?
[14:29:25] <travis-ci> ckan/ckan quiet-activity-logs 3521c58 https://travis-ci.org/ckan/ckan/builds/93358343 David Read: The build was broken.

2015-11-25
[15:37:40] <sudobangbang> I cannot find any documentation on how to override CKAN password reset email links and templates
[15:37:53] <sudobangbang> ckan/lib/mailer.py is business logic
[15:38:10] <sudobangbang> but I see the email template is hardcoded
[15:38:18] <sudobangbang> is there a way to change this for plugins?
[15:38:24] <sudobangbang> extend it I mean?
[15:39:16] <rossjones> sudobangbang you're waiting for https://github.com/ckan/ckan/pull/2465 I think.
[15:39:40] <sudobangbang> ahh
[15:39:44] <sudobangbang> thanks rossjones
[15:39:46] <rossjones> It's on the 2.5 milestone, so I expect it'll be on master soon - not sure what version you're running.
[15:39:56] <sudobangbang> 2.4
[15:40:06] <sudobangbang> rossjones: is there a way to at least change the reset_path url?
[15:40:12] * sudobangbang is not familiar with ckan
[15:41:02] <rossjones> sudobangbang that'll involve lots of messing about with the routing - if you look at ckan/config/routing.py you'll be able to find the current path - and then you should be able to delete that and re-create it in your own extension.
[15:41:25] <sudobangbang> k, I'll look into that, thanks again rossjones
[15:41:33] <rossjones> np
[18:01:53] <rstolt> Hi is there a way to overwrite the munge_tag logic in custom harvesters? Kind of missing the allowance for german umlauts in tags.
[21:59:05] <travis-ci> ckan/ckan formats e22c07a https://travis-ci.org/ckan/ckan/builds/93244834 David Read: The build failed.
[22:28:34] <travis-ci> ckan/ckan quiet-activity-logs 7cdd044 https://travis-ci.org/ckan/ckan/builds/93246652 David Read: The build was broken.

2015-11-24
[11:07:44] <LondonAppDev> In order to override a template in another jisc extension, do I need to inherit from the existing extension or can I just use the same template name and add my plugin after the existing one in ckan.plugins?
[11:38:50] <LondonAppDev> Basically I want to modify the template for the "ckanext-harvester" plugin which is used by a number of other plugins. I want to make changes to all of them.
[12:01:34] <wardi_> LondonAppDev: you just need the template
[12:02:20] <LondonAppDev> wardi_ it just overrides based on the template name?
[12:02:49] <LondonAppDev> Does it not matter which order I define the plugins in the ckan.plugins settings option?
[12:02:55] <wardi_> yes, the full template path and the order of the plugin loading
[12:03:07] <wardi_> first plugin wins
[12:03:20] <wardi_> I think I wrote something about this in the docs
[12:03:36] <LondonAppDev> Oh, I did look but couldn't find anything.
[12:03:48] <LondonAppDev> I may have missed it.
[12:03:57] <wardi_> rossjones: meeting?
[12:04:17] <wardi_> brook: ^
[12:53:01] <LondonAppDev> Hey guys, would you typically discuss any pull requests or issues with the ckanext-harvest project in the call? Or is it strictly only the ckan project? Just for future reference if I ever make any pull requests for the harvester.
[12:53:23] <wardi_> LondonAppDev: we do discuss those on the call if they are brought up
[13:07:51] <LondonAppDev> OK good to know. Thanks wardi_.
[15:02:42] <LondonAppDev> I'm overriding this template in my extension: https://github.com/ckan/ckanext-harvest/blob/master/ckanext/harvest/templates/source/new_source_form.html. It works fine if I just override with {% ckan_extends %} and add extra content, however if I add an example copy of the original file inside my extension, I get " UndefinedError: "harvesters" not defined" on line 25.
[15:23:09] <LondonAppDev> I put the full stack trace on SO: http://stackoverflow.com/questions/33897353/override-the-templates-in-an-existing-extension-in-ckan
[15:35:07] <LondonAppDev> Ah damn I think I figure it out. It's because it's changed the templates_new.
[15:35:10] <LondonAppDev> I missed that.
[16:31:11] <travis-ci> ckan/ckan master ed30bd0 https://travis-ci.org/ckan/ckan/builds/92962427 Joe Tsoi: The build has errored.
[18:43:11] <mattfullerton> In case anyones still around, Im having a problem that seemingly out of nowhere no views are pulling data from the datastore, although the datastore is there and working
[19:02:44] <wardi_> mattfullerton: I don't follow
[19:03:09] <mattfullerton> I suddenly get messages about trying to use the dataproxy
[19:03:18] <mattfullerton> for datastore resources
[19:07:04] <wardi_> I'm not familiar with the dataproxy I'm afraid :-(
[19:10:00] <mattfullerton> it shouldnt even be using it, I think its actually just stuff at the recline view level. The point is the views are not able to get data out of the datastore (using ckanb
[19:10:07] <mattfullerton> (using ckan.js?)
[19:14:44] <mattfullerton> though I see now this is something entirely at the JS level there are no errors in the logs. Guess Ill have to debug there.
[19:17:01] <mattfullerton> Perhaps I need to migrate after that datastore_active change
[19:17:19] <wardi_> oh. that's likely
[19:17:34] <mattfullerton> :)
[19:17:42] <mattfullerton> the pitfalls of running master
[19:22:44] <mattfullerton> how well tested is that actually?
[19:23:01] <wardi_> the migration?
[19:25:25] <mattfullerton> ok, sorry, after db upgrade, new search index and apache restart, I have my view back
[19:25:42] <wardi_> it's better tested already!
[19:26:10] <mattfullerton> thanks for facilitating my thinj-out-loud forum
[19:26:30] * wardi_ is almost as good as a rubber duck
[19:31:33] <mattfullerton> now Im just wondering if the datapushg
[19:31:39] <mattfullerton> datapusher needs to be amended
[19:31:54] <mattfullerton> there was stuff in there about updating datastore_active
[19:33:11] <mattfullerton> (i thought)
[19:33:56] <wardi_> I think the datastore takes care of that
[19:34:01] <wardi_> *plugin

2015-11-23
[11:53:03] <yanik> doese ckan datasetore uses master-slave replication? since i have ckan.datastore.write_url and ckan.datastore.read_url in my config
[12:04:08] <nigelb> So, what do people think about adding some documentation to use ssl certs for postgres authentication?

2015-11-22

2015-11-21

2015-11-20
[13:59:10] <LondonAppDev> When running `paster --plugin=ckanext-harvest harvester clearsource <source_id> --config=/etc/ckan/default/production.ini` it just seems to hang. Is there a way I can check if it's doing anything?
[14:19:02] <LondonAppDev> "Reharvest" is grayed out on my CKAN panel because the harvest is "Running", however I want to kill it and re-start it.
[14:19:36] <LondonAppDev> On some I can click "Clear" and then do it again, but it seems to just freeze up if I "Clear" a harvest with too many datasets.
[14:31:17] <Zharktas> it
[14:31:25] <Zharktas> it'll clear eventually
[14:31:36] <Zharktas> it might take awhile though
[14:32:17] <Zharktas> and you propably could do it from paster where the web request wouldn't timeout
[14:32:53] <LondonAppDev> Zharktas: OK cool thanks.
[14:34:26] <LondonAppDev> Zharktas, do you know if there is any way to kill a job without having to clear the source?
[14:35:31] <LondonAppDev> Found it: job_abort
[14:35:58] <rossjones> I have finally found out why our paster commands wait 9 seconds before doing anything. Time for a drink!
[14:36:14] <LondonAppDev> why does it?
[14:40:59] <rossjones> Imports in our plugin.py files.  We have lots of extensions, and when they're loaded, so are the top level imports.  For instance, importing celery at the top of a plugin.py adds .2 seconds to load time.
[14:41:15] <rossjones> Not that it matters for the wsgi app, it bugs the hell out of me when running paster commands during dev :(
[14:52:06] <LondonAppDev> rossjones: oh cool. Well done for figuring it out.
[14:52:35] <rossjones> Now I've got to check 20-odd plugins for make sure there are no import-time side-effects :(
[14:58:02] <LondonAppDev> rossjones: do you use PDB?
[14:58:31] <rossjones> Sometimes.
[14:58:48] <LondonAppDev> Cool, that might make it easier to debug.
[17:03:40] <wardi_> run-snake-run is nice
[17:56:49] <LondonAppDev> Is it possible to override the templates in another CKAN extension?
[17:57:21] <wardi_> sure, you can go many layers deep with overriding extensions
[17:57:33] <wardi_> it gets a bit hard to follow when you do that, though
[17:57:38] <LondonAppDev> Yeah..
[17:58:26] <LondonAppDev> I basically want to replace the `config` field with user friendly drop down options on the harvester form.

2015-11-19
[08:28:27] <teemu> wardi_: Hi, I have a couple of questions about fluent_text_output validator in ckanext-fluent https://github.com/open-data/ckanext-fluent/blob/master/ckanext/fluent/validators.py#L165-L176
[08:29:12] <teemu> wardi_: first is a note that the json.loads doesn't necessarily return a dict, but for example may return a number.
[08:29:49] <teemu> wardi_: So only cases where the non-dict value is a non-valid json string goes in the exception handler
[08:31:13] <teemu> wardi_: second is a question about whether the value should be wrapped in the dict if it is not one or not. As I see it non-dict values should perhaps be just passed through the translation as already translated entities
[08:32:03] <teemu> wardi_: what I'm perplexed about is what situation the ValueError handler is intended to fix?
[08:58:03] <rossjones> teemu he'll be asleep at this time, best try this PM.
[08:58:19] <rossjones> or try mailing the list
[08:59:01] <teemu> rossjones: if he doesn't notice the highlights from backlog I'll use another approach, but thanks for the heads up :)
[09:02:21] <rossjones> :D
[09:11:10] <yanik> good morning, guys
[09:57:23] <rstolt> Hi, just a quick question.
[09:57:39] <rstolt> The created (or general all dates) in the last harvest job dashboard are always one hour behind.
[09:57:47] <rstolt> The server date is correct i.e. Do 19. Nov 10:42:23 CET 2015 and the server timezone is also correct i.e. Europe/Berlin.
[09:58:10] <rstolt> Also added the ckan.display_timezone to the configuration, but the displayed dates keep staying one hour behind.
[09:58:19] <rstolt> Any pointers?
[11:34:45] <rstolt> Seems like it only is fixed in current CKAN master. Will this be released soon and also be merged into earlier CKAN releases?
[12:05:01] <rossjones> rstolt if you have the ticket number, I can ask on the call this afternoon (unless you'd like to attend and ask)?
[12:08:25] <rstolt> rossjones: It's ticket https://github.com/ckan/ckan/issues/2494. Cheers :)
[12:08:51] <rossjones> rstolt you're on 2.4?
[12:10:23] <rstolt> rossjones: Nah rolling on a 2.3 instance.
[12:10:58] <rossjones> You should upgrade :)
[12:13:30] <rstolt> rossjones: That works hassle-free?
[12:18:18] <yanik> rstolt check time in database, i had similar problem, but not with CKAN
[12:25:47] <rossjones> rstolt pretty much, I'd try it on a staging box, but things are definitely getting better and easier :)
[12:30:52] <rstolt> rossjones: Asked PM several times, they seemed *scared*. Gonna push again ;D
[12:31:45] <rossjones> Just don't ask ;)
[12:33:10] <rstolt> yanik: there its stored also on hour behind because of datetime.datetime.utcnow in https://github.com/ckan/ckanext-harvest/blob/master/ckanext/harvest/model/__init__.py#L191
[12:33:22] <rstolt> yanik: I guess :)
[14:04:13] <wardi_> amercader, rossjones: meeting?
[14:04:25] <rossjones> Isn't it at 3?
[14:05:14] <wardi_> 2pm UTC is what I have on my calendar
[14:06:24] <wardi_> brook: ^?
[14:06:28] <rossjones> Yup, you're right.
[14:06:43] <rossjones> morty - coming on the call?
[14:06:46] <brook> Can't this week, I'm afraid.
[14:07:03] <rossjones> brook also known as "assign me as many PRs as you like" ...
[14:07:34] <amercader> Sorry, can't make it either
[14:07:50] <amercader> So happy to take some PRs a s punishment as well :)
[14:11:04] <rossjones> s/some/all/

2015-11-18
[13:22:35] <LondonAppDev> How can I change the "This is a featured section" part of the home page?
[13:22:44] <LondonAppDev> I changed the text but the blank image remains.
[13:27:36] <LondonAppDev> Sound it, need to do it in a custom extension.
[13:27:40] <LondonAppDev> Found it*
[13:34:12] <yanik> hi guys, continue our talk: where is the best place to update global context ( g) ?
[13:35:07] <yanik> it works almost anywhere, but, for example, if i put it in IConfigurer.update_config if wood update only once
[13:36:51] <yanik> LondonAppDev, i belive you should just change spefici template
[13:37:24] <LondonAppDev> Cheers yanik. Yeah I figured it out. need to override /home/snippets/promoted.html.
[13:37:43] <yanik> LondonAppDev, add single template file in your plugin templates and register this templates folder
[13:51:39] <LondonAppDev> Thanks yanik, yeah I got it now.
[15:10:41] <yanik> guys?
[15:38:24] <yanik> adding it in plugin file body(not class) still require server reload, and i need live calculating ;/
[16:28:36] <yanik> can i use CKAN for commercial purposes ?
[17:56:36] <rossjones> yanik as long as you follow AGPL licence
[18:26:17] <travis-ci> ckan/ckan test-exists-validators 93f96f7 https://travis-ci.org/ckan/ckan/builds/91869137 Ross Jones: The build failed.
[18:41:11] <rossjones> PEP8. I would put money on it.
[19:48:37] <TkTech> rossjones, Yup, forgot double spacing.

2015-11-17
[08:29:27] <rossjones> Has anyone tried running CKAN with Pypy?
[09:34:41] <rossjones> nigelb Could you merge https://github.com/okfn/CKANClient-J/pull/4 please?
[09:36:20] <nigelb> rossjones: done :)
[09:36:32] <rossjones> Thank you!
[09:36:48] <rossjones> Even with my terrible grammar :(
[09:37:14] <nigelb> rossjones: and you're English!
[09:38:07] <rossjones> In my experience, nearly everyone who speaks English as their second language speaks, and writes it better than I do.
[09:38:22] <rossjones> Except maybe my wife :)
[09:42:48] <nigelb> haha
[12:03:36] <amercader> wardi_, joet : meeting?
[12:03:53] <wardi_> yes!
[12:09:22] <joet> oh yeah
[12:12:02] <joet> i'm being booted out of the call everytime i call, been having connection problems all day
[12:17:28] <travis-ci> ckan/ckan 1651-ubuntu-14.04 13d2e88 https://travis-ci.org/ckan/ckan/builds/91579358 amercader: The build was broken.
[12:29:03] <rossjones> amercader to review https://github.com/ckan/ckan/pull/2726 I just need to make sure instructions work and tests run on 14.04, right?
[12:29:47] <amercader> rossjones: yes, I'll ping you once the packages are actually uploaded to packaging.ckan.otgh
[12:29:52] <amercader> .org even
[12:30:11] <rossjones> Cool, thanks. Will try out the tests on 1404 in the meantime, if I've got a VM somewhere ;)
[12:52:29] <amercader> rossjones: this fixes the failures on master (bad merge) https://github.com/ckan/ckan/pull/2737
[13:02:21] <rossjones> Okay, thanks.
[13:03:26] <rossjones> Will merge it once travis is happy :)
[13:04:31] <rossjones> Hmm can't follows installation docs on a branch without working ckan, can't get a working ckan without docs.  8|
[13:12:42] <LondonAppDev> What would be the best practice for changing the CKAN "hero" background image on the index page?
[13:57:22] <rossjones> LondonAppDev if there's no ckan.ini setting for it, and you can't do it in CSS, you can override the homepage template
[13:59:23] <rossjones> => nosetests --ckan --reset-db --with-pylons=test-core.ini ckan
[13:59:29] <rossjones> tells me there is no such option --ckan :(
[14:01:14] <rossjones> luckily it's documented if I read a bit further ;)
[14:18:44] <rossjones> amercader "FATAL:  password authentication failed for user "datastore_default"" is expected atm (from what wardi_ said during the call)?
[14:19:46] <amercader> shouldn't be if you are testing ckan core. You'll need to create the users and set the pwd manually before running the tests though
[14:22:20] <rossjones> seems to be going well so far :)
[14:22:57] <rossjones> Okay, will merge https://github.com/ckan/ckan/pull/2737 and then merge master onto this 1404 PR.
[14:45:01] <LondonAppDev> Thanks rossjones.
[16:02:55] <LondonAppDev> I added an image file to my extension under `/ckanext/public/my_file.png`. It's accessible when I install the extension using `python setup.py develop` but it doesn't work if I do `python setup.py install`. Any ideas why this might be?
[16:04:42] <Zharktas^> you got manifest.in in you plugin ?
[16:04:59] <Zharktas^> non-python files won't get installed without it
[16:43:14] <LondonAppDev> Zharktas^: I see the file and it has recursive-include. I think I need to add my file ext to this. Thanks
[17:54:01] <rossjones> It looks like demo.ckan.org is running ckanext-dcat - does this mean i can remove all of the cruft for trying to render rdf in packagecontroller.read()?
[17:54:20] <rossjones> I haven't deleted any code in ages :(
[17:56:52] <wardi_> rossjones: yes, I think so
[17:59:26] <rossjones> Wooo
[19:19:59] <rossjones> Fixed.

2015-11-16
[17:27:43] <wardi> I feel like we should flatten revisions for storage instead of having revisioned versions of every table. The only thing we do with old revisions is compare them to other revisions, not arbitrarily join with other things in the DB
[17:34:06] <rossjones> Right, totally disconnect the revisions from the main objects you mean? Definitely some cleanup in the models as well (https://github.com/ckan/ckan/blob/master/ckan/model/package.py#L485 should be a field just like https://github.com/ckan/ckan/blob/master/ckan/model/package.py#L50 ... for instance
[18:09:05] <wardi> rossjones: yes, metadata_created should be a normal field. I'd like to be able to update it if I'm harvesting datasets for example
[18:24:48] <rossjones> Yup, we hacked around it on DGU, but it's no prettier.
[18:25:12] <rossjones> I'd fix it, but have too many PRs already that need finishing.
[18:25:25] <rossjones> Might be a good starter ticket?
[18:29:15] <wardi> removing vdm? :-)
[18:43:13] <wardi> let's add a new tag "good for contribution; difficulty: hardcore"

[13:35:05] <yanik> is setup_template_variables of plugins.IResourceView right place to setup extra template context?
[13:35:31] <yanik> by updating data_dict
[13:46:15] <wardi> yanik: that sounds rigth
[14:10:55] <yanik> wardi, ty
[14:14:25] <yanik> wardi, how you dubug CKAN? i do not found proper information
[14:23:44] <wardi> yanik: I use the werkzeug debugger (from paster serve) and ipdb. I know others that use pycharm for fancier gui debugging
[14:23:54] <wardi> what information are you missing?
[14:24:58] <yanik> i think you should update docs, and add page about debugging , just a suggestion
[14:25:08] <yanik> i will look into this
[14:25:24] <wardi> that's a good idea
[14:28:39] <yanik> I mean i will look about paster serve werkzeug :) can't really product worthy docs at this stage
[14:33:27] <yanik> and paster chapter is lack of werkzeug ;/
[14:36:02] <wardi> what I mean is when you run "paster serve" and an exception occurs you get the werkzeug interactive debugger in your browser
[14:38:09] <yanik> got it
[14:41:40] <wardi> frequently the easiset thing for me is to stick a {{0/0}} in a template where something isn't working right so I can poke around
[14:41:52] <wardi> it's a hack.. but it works pretty well :-)
[14:43:17] <wardi> the paid version of pycharm lets you stick breakpoints into your jinja templates.. very slick but I haven't adopted an IDE just yet
[15:05:37] <yanik> wardi, thx for tips!
[15:11:13] <yanik> great, at least i see my context now, thats start :)
[15:18:51] <yanik> it's shame setup_template_variables don't work globally, i can only affect specific pages
[15:19:13] <rossjones_> yanik like a 'include this on every page' var?
[15:19:39] <yanik> rossjones, yup, i need it for mu menu
[15:20:02] <wardi> there is the pylons "g" object you can use
[15:20:19] <yanik> i generate menu from database, stored as a tree
[15:20:28] <yanik> will look into it, thx
[15:22:10] <wardi> yanik: from an IConfigurable.configure method config['pylons.app_globals'].jinja_env.globals is a copy of that object
[15:22:52] <yanik> thx !!
[16:04:35] <TkTech> wardi, once the move to flask is done the flask-debugtoolbar extension is extremely handy and easy to extend
[16:04:39] <TkTech> Basically a direct port from django
[16:42:17] <rossjones> TkTech things will get worse before they get better moving to Flask :(
[16:42:31] <rossjones> where worse->occassionally clunky shims
[16:46:04] <TkTech> Assuming you care at all about compatibility, which I don't really :)
[16:46:21] <rossjones> Nor me, but ....
[16:46:38] <TkTech> There are so many breaking changes that need to be made, it would almost certainly be less time consuming, cleaner and a far lower LOC count by burning it all to the ground and doing it from scratch.
[16:47:36] <TkTech> CKAN as it currently stands has many poor practices, especially when looking at general code quality and consistency as well as query performance.
[16:47:47] <TkTech> Totally usable, but many parts of the code are an utter nightmare to work on.
[16:47:49] <wardi> you need to add all the changes required to all the extensions that people use, otherwise we throw away the biggest benefits of using ckan
[16:47:55] <rossjones> No comment ;)
[16:48:25] <rossjones> wardi I think having an extension amnesty where, for the v.important ones we fix up thinks like importing pylons.config etc would help a lot.
[16:48:46] <TkTech> Most of the extensions I've seen are trivial and a lot of the effort involved in them is working *around* CKAN limitations.
[16:49:21] <TkTech> I'm sure there are huge exceptions, but a 3-6 month heads up on breaking changes should be enough for anyone to maintain an extension actually in use.
[16:50:04] <rossjones> Any longer and they'd forget I suppose, and they don't *have* to upgrade to newer version until they're ready.
[16:50:26] <TkTech> Yup, one of the joys of a universe where every extension is a version controlled repo and open source.
[16:50:57] <wardi> I'm not sure who's going to fund a mega-rewrite, and have even less idea who's going to fund updating the extensions that make ckan interesting
[16:51:09] <rossjones> The usual suspects I imagine.
[16:52:02] <wardi> right
[16:52:03] <TkTech> wardi, I've looked over most of CKAN several times. For the general "idea" of what CKAN does, it should be possible to rewrite in a tiny fraction of the work, using what was learned from the first couple of times around.
[16:52:07] <rossjones> rshk did start on https://github.com/catalog-ng/catalog-ng-poc-flask-api-only but it isn't ckan.
[16:52:24] <wardi> any rewrite isn't going to be ckan
[16:53:10] <wardi> so if it isn't ckan, will it be compelling enough to convince current ckan users to switch?
[16:54:15] <TkTech> If it looks like CKAN, walks like CKAN, and talks like CKAN, isn't it CKAN?
[16:54:26] <rossjones> Have to draw distinction between end-users, those who write code and those who have to deploy/maintain it I suppose. All have different worries.
[16:54:26] <TkTech> There's no reason the web API can't be identical for example
[16:54:59] <rossjones> I think identical API should be the only hard-requirement ;)
[16:55:28] <wardi> yeah, that was my hope, keep as much of the API as possible
[16:56:04] <wardi> the templates need to be broken in a big way to update bootstrap regardless, but then there's the temptation to go completely headless
[16:56:06] <rossjones> Should be easy-ish to move https://github.com/rossjones/ckan-mini to flask
[16:56:15] <rossjones> :P
[16:56:27] <TkTech> Could an extension not implement the shims necessary to move from one to the other?
[16:56:45] <TkTech> With an expiry date set from day one - "this will not be supported past X"
[16:57:16] <wardi> yes, but that's sounding less like a rewrite and more like what I was thinking
[16:57:30] <rossjones> A slow painful migration from one to the other?
[16:57:32] <TkTech> No, I would still very much suggest a rewrite from the ground up
[16:57:49] <rossjones> Can we use mongo this time?
[16:57:52] * rossjones ducks
[16:57:53] <TkTech> Just an extension to provide identical shims for some of the most used methods, like package_show
[16:58:13] <wardi> sounds like dkan :-)
[16:58:16] <TkTech> You could probably use whatever you want, CKAN hardly uses any Postgres features :)
[16:58:59] <rossjones> Cool, Go it is !
[17:00:05] <TkTech> Now that's a change that might not get supported much
[17:00:21] <TkTech> If you keep the same dependencies adoption is probably a lot easier to push.
[17:00:34] <TkTech> "Do we need a new database? Nope, just this alembic migration."
[17:00:41] <rossjones> I can;t imagine the Association will care much, nor fund it, so I am quite pessimistic about it.
[17:00:42] <TkTech> "Do we need a new search index? Nope, still solr"
[17:01:53] <TkTech> Can dream can't we?
[17:01:59] <TkTech> While we're at it we'd get off the AGPL
[17:02:13] <rossjones> That way it';d HAVE to be a re-write.
[17:02:28] <TkTech> There's little point in a chunk-by-chunk rewrite
[17:02:37] <TkTech> It really would be less effort, ultimately, to rewrite.
[17:03:03] <TkTech> Could probably cut the line count by a full order of magnitude
[17:03:06] <wardi> the value in CKAN is in the API, plugin interaces, existing extensions and everyone's existing data already loaded into a ckan. Any rewrite will have huge problems moving even a healthy chunk of that over
[17:03:30] <TkTech> Sure, and how long do you want to keep that?
[17:03:33] <TkTech> 5 year compatible cycles?
[17:03:34] <TkTech> 10?
[17:03:57] <TkTech> Eventually you need to break things or you end up with a stagnant, broken interface no one likes to work with
[17:05:06] <rossjones> Until someone has to take over pylons maintenance and port it to Py3 ;)
[17:05:20] <TkTech> Yeah, now *that* will never happen. Pylons has no community.
[17:05:33] <rossjones> I meant from the core ckan team ;)
[17:05:44] <rossjones> One of them'll end up doing it ;)
[17:05:44] <wardi> First we break/rewrite all the controller and template code, keeping the action layer and below. That solves the larges problem (pylons) and limits the damage to extension compatibility to template changes
[17:05:52] <TkTech> But at the same time, if CKAN currently works for a project, and your extensionscurrently work for a project, just fork and freeze.
[17:05:59] <TkTech> No one *forces* you to update to a new version of CKAN.
[17:06:43] <rossjones> It'll be like Perl 6/Python 3 all over again :D
[17:07:29] <wardi> a complete rewrite will take a year+ then many times that trying to get the community of extensions over
[17:07:57] <rossjones> If we break controllers, people will still have to fix their extensions that contain controllers
[17:09:07] <wardi> rossjones: yes, but I think that breakage is worth it because it's the thing tying us most to pylons
[17:09:56] <rossjones> I do agree it's the most sensible route, but still leaves us with things like VDM which'd take longer to get rid of if you wanted it to be mostly painless.
[17:10:38] <rossjones> I mean the migration being painless.
[17:11:51] <wardi> vdm is exposed in the API so that will require some API breakage.
[17:12:18] <wardi> unless we replace it with some other data versioning
[17:14:38] <rossjones> Like the nice simple one in the sqlalchemy docs, hopefully.
[17:15:48] <rossjones> although that does look like what vdm probably started out as ... http://docs.sqlalchemy.org/en/rel_1_0/orm/examples.html#versioning-objects

2015-11-15

2015-11-14

2015-11-13
[09:37:13] <LondonAppDev> Hey guys, does anyone know of any open CSW feeds I can test the CSW harvester with?
[10:33:59] <rossjones> LondonAppDev there are a couple at https://data.gov.uk/harvest
[12:27:17] <LondonAppDev> rossjones: thank you.
[12:39:54] <LondonAppDev> Anyone had any experience install libxml2-2.9.1 on Ubuntu 12?
[18:48:32] <TkTech> wardi, btw, why solrpy? By far the least popular Solr library so wondering why it was chosen?
[21:05:26] <wardi> TkTech: https://github.com/ckan/ckan/pull/2352
[21:07:35] <TkTech> wardi, So what stopped the merge a few months ago? Discussion seems to have died.
[21:08:04] <TkTech> wardi, I've had to fallback to raw_query() a *lot* due to the lack of Solr3.3+ support in solrpy
[21:08:50] <wardi> your pain isn't being shared with those that could make it go away :-)
[21:09:38] <wardi> amercader is reviewing that PR, why not voice your opinion there?

2015-11-12
[11:13:10] <LondonAppDev> Does anyone know what encoding is allowed for dataset 'notes' field in CKAN?
[11:13:30] <LondonAppDev> It's not liking my UTF-8 string.
[13:34:41] <LondonAppDev> I am getting this error when harvesting items: https://gist.github.com/LondonAppDev/c0c3b8dcc595da6bdfbc. It seems to only occur when assigning special characters to the 'notes' of a dataset. Any idea why this is?
[13:45:33] <rossjones_> LondonAppDev what is the output from psql ckan -c 'show server_encoding' ?
[13:45:59] <LondonAppDev> Let me check...
[13:47:35] <rossjones_> That looks like an 'after the fact' stacktrace. Is there any other logging, or do you have a small (maybe ckanapi based) repro?
[13:48:50] <LondonAppDev> rossjones_: The database encoding is UTF-8 https://gist.github.com/LondonAppDev/dd77f376e871496ddb93
[13:49:10] <LondonAppDev> rossjones_ I get the error while running a paster command.
[13:49:38] <LondonAppDev> rossjones_ there is no other logging for this one as far as I know.
[13:49:46] <rossjones_> Which paster command?
[13:50:13] <rossjones_> Looks like the problem is in oaipmh/harvester.py
[13:50:21] <rossjones_> line 490
[13:50:27] <LondonAppDev> It's harvester fetch_consumer
[13:50:44] <LondonAppDev> rossjones_ full command is "paster --plugin=ckanext-harvest harvester fetch_consumer --config=/etc/ckan/default/production.ini"
[13:50:51] <LondonAppDev> Yes the error is in the harvester.py
[13:51:19] <LondonAppDev> It's pulling the description from an OAI-PMH feed.
[13:51:34] <LondonAppDev> And then placing it in content['notes'] of the dataset object.
[13:51:44] <rossjones_> which one are you using the kata-csc one or the openresearchdata one?
[13:52:01] <LondonAppDev> I'm using my own one which I forked from openresearchdata
[13:52:09] <LondonAppDev> But based it on the same as thiers.
[13:52:24] <rossjones_> Have you changed the harvester.py?  Can you point me at the repo?
[13:53:02] <LondonAppDev> rossjones_ this is the harvester.py https://gist.github.com/LondonAppDev/095f36756ce7774af16e
[13:53:58] <LondonAppDev> In OAI-PMH there can be multiple <description> fields.
[13:54:15] <LondonAppDev> The existing OAI-PMH harvester will only take the first and store it in Notes.
[13:54:45] <LondonAppDev> As you can see in the code I've added '_extract_description()' to merge the list of <description> fields into one string.
[13:54:51] <LondonAppDev> The issue is occuring here.
[13:55:43] <rossjones_> That's a huge try/catch ;) Was just about to post I think the problem is in https://gist.github.com/LondonAppDev/095f36756ce7774af16e#file-gistfile1-txt-L221
[13:56:29] <rossjones_> Why not get more detail about the exception from that method?
[13:57:01] <LondonAppDev> The issue seems to occur after that method though, when the data is being commited with special chars in it.
[13:57:10] <LondonAppDev> I stepped through that method and it seems fine.
[13:57:20] <LondonAppDev> If I change it to return 'hello' it works perfectly.
[13:57:46] <LondonAppDev> If I add the special character (which I believe to be Mac OS version of ') then it gives me that commit error.
[13:58:34] <LondonAppDev> rossjones_ database is correct if encoding is UTF-8 right?
[13:59:13] <rossjones_> Yeah
[13:59:36] <amercader> sorry, can't make the meeting today
[13:59:39] <LondonAppDev> rossjones_ ok cool. Thanks for looking at it, I think I need to do more digging :)
[13:59:55] <rossjones_> I would have guessed that error might be when accessing the session after a request has finished, but not really sure in this case.
[14:00:01] <rossjones_> amercader nor me
[14:02:32] <wardi> joet: meeting?
[15:58:21] <wardi> amercader: dang, you're too quick
[15:58:53] <amercader> haha, I have a personal thing with `package_id`on the resource dict
[15:59:25] <amercader> I just need to spread the word about it
[15:59:30] <wardi> I was trying to figure out if package_search could be used on the resource_id
[15:59:55] <wardi> (then you have the nicer url in one query)
[16:00:15] <amercader> I don't think we index resource ids, do we?
[16:01:03] <wardi> maybe we should
[16:04:01] <amercader> index all the things
[16:04:55] <wardi> +1
[16:36:08] <travis-ci> ckan/ckan remove-dumper af62b8d https://travis-ci.org/ckan/ckan/builds/90762008 David Read: The build failed.

2015-11-11
[15:30:28] <amercader> wardi: I've been testing it a bit and it seems to work fine but just want to know if you can think of a potential issue with using scheming and using free extras
[18:06:18] <wardi> amercader: just the problem of users entering a name that conflicts with an extra in the schema
[18:06:40] <wardi> but if that was resolved, somehow then great
[18:07:06] <wardi> scheming just needs a config option to enable the free-form fields in the form again
[18:07:12] <wardi> s/config/schema
[18:16:26] <amercader> wardi: in my case the free form extras are created by a harvester, which I control, and I'm taking care that this doesn't happen
[18:17:30] <wardi> didn't we add code that prevented extras with the same names as fields in the schema at one point?
[18:18:11] <wardi> on another topic, does datastore record a date of the last update for a resource anywhere?
[18:26:10] <amercader> Yes and not as far as I know
[18:27:25] <wardi> so for scheming I think we just need a form snippet for the dataset/group/org extras..
[18:30:48] <amercader> And an 'extras' field to the default schema?
[18:30:59] <amercader> Or would that be taken care of automatically
[18:31:31] <wardi> yeah, I think that makes sense. it's most like the other things in the config that way, and users can choose where it appears in the form
[18:31:41] <wardi> s/config/schema
[18:31:48] <amercader> :)
[18:33:51] <amercader> The DataStore updated date should be trivial to add, something similar to #2234 BTW ;)
[18:34:30] <wardi> it will make small updates quite a bit slower though
[18:35:36] <wardi> oh, thanks for the reminder on that PR :-)

2015-11-10
[07:33:53] <teemu> wardi: any comments on https://github.com/open-data/ckanext-scheming/pull/101
[12:03:50] <amercader> wardi, joet, rossjones ,brook : quick call?
[12:32:32] <wardi> dang, missed it
[12:35:12] <wardi> wanted to ask about https://github.com/ckan/ckan-service-provider/issues/31
[12:42:07] <wardi> teemu: i should merge that
[12:42:27] <teemu> wardi: nice :)
[12:44:23] <wardi> a test would be nice though
[12:58:31] <teemu> wardi: setting up the environment so I can run scheming tests always takes a while. Shouldn't it just be "assert_equals(u'', scheming_language_text(u''))"?
[14:14:51] <wardi> probably, but that code would also handle {} better than we are now, i think
[14:21:56] <wardi> oh, no that case was handled. this is just for empty strings
[17:24:32] <rossjones> sorry, missed the call, was in a meeting.

2015-11-09
[16:41:13] <palcu_> hello. Is there a way I could access the Pylons Python shell in CKAN?
[17:02:15] <rossjones> palcu_ paster --plugin=pylons shell $CKAN_INI
[17:02:22] <rossjones> where $CKAN_INI is the full path to you .ini file
[17:02:35] <palcu_> thanks :)
[17:03:16] <rossjones> np
[17:05:26] <palcu_> I am trying to add a group_extras field. I thought it would be good idea to follow the IDatasetForm tutorial, but just change it for groups. Sadly, I see that create_group_schema is not implemented and the flow is different.
[17:06:22] <palcu_> Is there an extension example that uses form_to_db_schema and db_to_form_schema that I could lookup?
[17:08:42] <Zharktas> palcu_: http://docs.ckan.org/en/latest/extensions/plugin-interfaces.html#ckan.plugins.interfaces.IGroupForm
[17:09:54] <palcu_> but I don't understand how to get the field from the form and add tie it as a group_extra
[17:10:17] <Zharktas> https://github.com/ckan/ckan/tree/master/ckanext/example_igroupform
[17:10:39] <Zharktas> that was lousy example apparently
[17:11:28] <palcu_> yep
[17:15:34] <Zharktas> https://github.com/yhteentoimivuuspalvelut/ckanext-ytp-main/blob/master/ckanext/ytp/organizations/plugin.py#L144 well this is ours, it
[17:15:56] <Zharktas> it's ugly and it's for orgs but basically orgs are groups
[17:18:43] <palcu_> yep, I'm looking for orgs, thanks
[20:13:00] <palcu_> is there an IUserController or I have to overwrite the default methods?
[20:13:30] <palcu_> I would like to add a new field to the register user form, that will be the ID of a group and automatically add that user to the group
[23:25:51] <palcu_> it's ok... I've managed to hack it around

2015-11-08

2015-11-07

2015-11-06
[09:58:06] <rossjones> How does anyone feel about recommending to plugins that they don't try and install deps already provided by CKAN?  Would need a list of what is available I guess.  Just thinking a documentation change.
[13:58:36] <20WACFJ2F> ckan/ckan 1651-ubuntu-14.04 609dee4 https://travis-ci.org/ckan/ckan/builds/89639262 amercader: The build failed.
[14:33:42] <travis-ci> ckan/ckan 1651-ubuntu-14.04 7518391 https://travis-ci.org/ckan/ckan/builds/89644750 amercader: The build failed.

2015-11-05
[01:36:49] <mchelen> i'm looking at the ckan docker images
[01:37:18] <mchelen> is it possible to remove the default password issue by configuring pgsql to only accept connections from localhost?
[03:20:22] <mchelen> after some more reading, it sounds like the datacats containers are the way to go
[14:01:43] <wardi> LondonAppDev_: paster shell is a thing
[15:03:03] <wardi> amercader: oops, mis-tagged my comment on #2234. SHould I just merge?
[15:05:27] <amercader> wardi: I saw them, 1st one makes sense, the second I need to look into
[15:05:41] <amercader> I'll look at it in just a bit
[15:05:50] <wardi> ok, thanks
[15:36:17] <amercader> Has anyone found that their nosetests get suddenly "Killed"?
[15:36:21] <amercader> eg:
[15:36:22] <amercader> ................................Killed
[15:36:37] <wardi> running locally?
[15:37:52] <amercader> it's on vm, after a source install
[15:38:55] <wardi> low ram and the oom killer?
[15:39:20] <joet> that's a new one
[15:39:25] <amercader> good point, I'll increase the vm memory
[16:07:27] <joet> amercader, that packaging pr seems to work for me
[16:08:36] <joet> only one tiny aside , i had to add --provider=virtualbox because I think i have libvirt as default, would be nice to be able to specify that from command line
[16:08:40] <joet> but doesn't really mater
[16:08:50] <joet> want me to merge?
[16:09:44] <amercader> This seems worth documenting
[16:10:08] <amercader> But don't hold the merge :)
[16:48:24] <rossjones> The lack of migrations in plugins is now really getting to be a pain :( I don't suppose someone wants to volunteer to implement it?
[18:57:09] <amercader> wardi: the killed tests were caused indeed by low memory, thanks for your pointer!
[21:45:19] <TkTech> amercader, Was the memory low due to something else running, or something going terribly wrong in the tests?

2015-11-04
[07:01:37] <LondonAppDev_> Hello
[08:23:12] <teemue> wardi: in ckanext-scheming, is dataset_slug preset field supposed to fill automatically based on title? Documentation says so but it doesn't seem to work and I can't find where it should do that. My title and name fields are exactly like in the default dataset schema example.
[08:32:40] <teemue> am I interpreting correctly that it's actually the "title" preset that does this with "data-module": "slug-preview-target"?
[09:05:14] <LondonAppDev> Hey guys, are there any guides anywhere about the server resources required for a CKAN install?
[10:00:14] <rossjones> LondonAppDev like ram, disk etc?
[10:00:19] <LondonAppDev> Yes
[10:00:43] <rossjones> Not that I know if, but tailored to what you're expecting to get traffic wise I guess.
[10:01:21] <rossjones> Like, not 1G ram - 40Gb disk (if you're storing files, running varnish etc).
[10:01:48] <LondonAppDev> rossjones: you think 1G ram is sufficient?
[10:01:49] <rossjones> but if you're using the extension that is uploading to S3 then less ... I guess the point I'm getting at is "it depends"
[10:02:02] <LondonAppDev> I see.
[10:02:10] <LondonAppDev> Is Varnish complicated to setup with CKAN?
[10:02:24] <brook> LondonAppDev: There's a bit of info in the ckan/ckan/wiki. I'm not sure where they come from though: https://github.com/ckan/ckan/wiki/CKAN-hosting-guidelines
[10:02:24] <rossjones> Not really. You might get away with nginx caching ...
[10:03:21] <rossjones> brook I guess they're as good number as any for a base install.
[10:03:58] <rossjones> We run with about >32G RAM, but we have Drupal and billions of background tasks.
[10:04:50] <LondonAppDev> I have a server with 4GB ram but over 100k datasets and it's incredibly slow.
[10:04:57] <LondonAppDev> Postregres is killing it.
[10:05:03] <LondonAppDev> But I havn't set up Varnish yet.
[10:05:49] <Zharktas> are you sure that you are running out of memory
[10:06:12] <Zharktas> with ckan and its plugin you can get lots of slowdowns due to unoptimal queries
[10:06:29] <rossjones> And postgres default config isn't great...
[10:07:01] <LondonAppDev> actually it's CPU. Postgre is chewing up 99% CPU most of the time.
[10:07:24] <Zharktas> we are running our instances with 4GB and only time its in heavy usage is during solr indexing or harvesting
[10:08:08] <LondonAppDev> I think it's the Solr indexing that is causing my problem too.
[10:08:22] <LondonAppDev> I need to dig around a bit and see what I can find.
[10:09:27] <Zharktas> but i would guess that it is some unoptimal sql query if its postgresql eating the cpu
[10:10:05] <rossjones> I bet it is the activity query that wardi mentioned yesterday in this channel somewhere...
[10:10:50] <rossjones> LondonAppDev Are you logged in as the user that imported the datasets?
[10:11:05] <LondonAppDev> Yes.
[10:11:14] <LondonAppDev> rossjones: yes could that be the issue?
[10:13:55] <rossjones> tried it logged out.
[10:14:00] <rossjones> s/tried/try/
[10:14:05] <LondonAppDev> rossjones: oh wow. I just navigated as an anon user and it works a lot faster.
[10:14:22] <rossjones> It's the acitivity count at the top of the screen ....
[10:14:39] <LondonAppDev> Oh really. Does it query all datasets that the logged in user added?
[10:14:44] <LondonAppDev> Ahhh yes I know the big you mean.
[10:15:14] <LondonAppDev> Wow thanks a lot for the tip rossjones.
[10:15:15] <rossjones> this one -> https://www.evernote.com/l/ARmw1hrr4ctETKeAhiIIoYkO3JYlKp0nQiY
[10:15:26] <rossjones> It's just a horrendous query.
[10:15:48] <LondonAppDev> Ahhhh that makes sense. Thanks a lot :)
[10:15:53] <LondonAppDev> Appreciate your help.
[10:16:06] <LondonAppDev> I was surprised why non of my users complained about the speed.
[10:17:07] <rossjones> :D
[10:19:08] <rossjones> LondonAppDev the ticket is at https://github.com/ckan/ckan/issues/2008 - would be useful to record you've still got this problem ....
[10:24:05] <LondonAppDev> rossjones: ok I added a comment to the ticket.
[10:25:20] <rossjones> Coolm ta.
[10:43:35] <mattfullerton_> I have to confess, I removed the activity list stuff from my template and now the problem is gone
[10:50:27] <teemue> wardi: never mind. despite evidence to the contrary it was a local issue after all. sorry for the inconvenience.
[16:01:34] <LondonAppDev> Anyone know how I can purge a dataset using the REST API?
[16:46:25] <LondonAppDev> Is there a way to get an interactive shell with CKAN? Similar to the Django interactive shell?
[17:38:51] <travis-ci> ckan/ckan alexandru-m-g-package-search-facets-speed 27789db https://travis-ci.org/ckan/ckan/builds/89264241 David Read: The build failed.

2015-11-03
[11:06:29] * NOTICE: [freenode-info] if you're at a conference and other people are having trouble connecting, please mention it to staff: http://freenode.net/faq.shtml#gettinghelp
[11:16:08] <joet> rstolt, I'm going to guess that they've become subgroups of each other, but I've never looked into the subgroups code
[11:36:57] <rstolt> joet: According to the group database table they are still of type 'group'.
[11:39:08] <joet> yeah, take a look at the members table
[11:39:37] <joet> see if there is an entry in the members table for each other there
[11:39:47] <joet> I'll have a go at recreating this
[11:49:31] <rossjones> That's the last we'll see of joet - last seen diving into the sub-groups code ....
[11:50:28] <rstolt> Hm when I delete related db entries from the member_revision and member table the contoller for these groups work again.
[11:51:41] <rossjones> rstolt Sounds like a cycle bug.  Did you explicitly add the groups as sub-groups of others?
[11:52:59] <joet> i'm so brave
[11:53:09] <joet> yeah that's  what I think it is
[11:56:30] <rossjones> Would not surprise me at all if it didn't stop you doing it.
[11:57:38] <joet> I can't even add a group as a subgroup at the moment, but i'm trying using ckanapi
[11:58:14] <rstolt> rossjones: No sub-groups invloved. We create them via a paster command which delegates to / utilises ckan.logic.action.create group_create.
[11:58:29] <joet> eh
[12:00:11] <rossjones> Is the ckan-meeting call happening today?
[12:00:56] <wardi> I'm there
[12:07:19] <LondonAppDev> Is it open to anyone to join?
[12:07:47] <wardi> yes! https://plus.google.com/hangouts/_/event/cb1vmkss426lkqicj94a3amvd1c?authuser=0&hl=en-GB
[12:07:55] <wardi> https://pad.okfn.org/p/ckan-meeting
[12:07:56] <LondonAppDev> Oh cool what time is it at?
[12:08:24] <wardi> LondonAppDev: just started
[12:08:38] <LondonAppDev> Ah it's now. I have something else on right now but will join the next one.
[12:38:49] <wardi> LondonAppDev: for sure, join us on Thursday
[12:39:05] <LondonAppDev> Yeah I put it in my calendar already. Thanks wardi.
[13:48:31] <LondonAppDev> Is there a way to delete all datasets associated with a specific organization from the CLI ?
[13:55:02] <LondonAppDev> I think I figured it out. I can do it using the harvester plugin.
[13:55:14] <LondonAppDev> Anyone know why the "paster" command is called "paster" ?
[13:57:26] <amercader> LondonAppDev: it's just the name of the library that powers the CLI
[13:58:42] <LondonAppDev> It's this? http://pythonpaste.org/script/
[14:00:06] <LondonAppDev> Do you know how I can do step through debugging with paster? If I'm running through paster server /etc/conf.ini
[14:04:17] <joet> LondonAppDev, just add a pdb.set_trace() somewhere in the code that you want to start debugging at
[14:04:37] <LondonAppDev> OK fantastic. Thanks a lot joet.
[14:04:41] <joet> install ipython and ipdb
[14:04:56] <joet> into your virtualenv
[14:04:59] <joet> ipdb is great
[14:42:08] <LondonAppDev> joet you are right, this is very cool. Very cool indeed.
[14:50:43] <yanik> hi, it is possible to not log in user automatically after registration?
[14:52:15] <yanik> or should i implement plugin on IAuthFunctions: user_create
[15:28:18] <yanik> my idea was just copy default user_create and just delete all session items before returning success
[15:28:30] <yanik> but somehow this don't work ;/
[15:32:17] <joet> yanik, you'd probably need to override the user controller
[15:32:51] <yanik> joet, and i can't do it through the plugin?
[15:33:04] <joet> yeah you can, it's a bit long winded
[15:33:57] <joet> create a new controller that subclasses UserController, customize the new method and redefine the route /user/new in after_map in the IRoutes interfafce
[15:35:42] <yanik> this is right direction?
[15:35:43] <yanik> https://gist.github.com/wide-awake/86a55f61317acb8aab0d
[15:35:57] <yanik> oh, thx
[15:36:13] <yanik> so small change and require so much rewriting
[15:36:35] <joet> not so much rewriting, you just need to hook into the right place
[15:37:30] <joet> https://github.com/ckan/ckan/blob/master/ckan/controllers/user.py#L245-L258 is probably the lines you want to take a look at
[15:37:52] <yanik> thx!
[15:46:27] <yanik> joet, and i cant super from old _save_new? if you will have couple minutes i will show you final code, after it will work? And i put it in blog, so people will have example
[15:46:41] <yanik> since i have so few, mostly from github
[15:47:05] <yanik> show code for review I mean
[15:47:09] <joet> if you run super then it'll call the old code
[15:47:25] <yanik> yup, and return render ;/
[15:47:33] <joet> you mostly want to copy most of the old cod
[15:47:49] <joet> and leave out the programmatically logging in section and probably just  redirect to the login page
[16:04:22] <mattfullerton> Does anyone in here have experience with CKAN slowing down hugely when a user is logged in? I mean page loads (more or less all page loads) taking 4-7s instead of 300ms
[16:09:36] <yanik> run in debug mode and check render time in console
[16:09:41] <yanik> maybe problem in frontend
[16:14:57] <mattfullerton> what exactly do you mean with frontend? I see from Chromes stats how long it takes to get a response, and using lynx on the server directly shows the same behavior
[16:15:33] <mattfullerton> will have to play with debug mode tomorrow I guess
[16:22:58] <yanik> i mean in console you get render time for ll urls
[16:23:10] <yanik> and can spot a problem
[16:34:47] <wardi> mattfullerton: yes, it was related to the dashboard activity query for us
[16:35:32] <wardi> the query to show the little notification of new activities is terrible. I made it a little better but it really needs a complete rewrite
[16:40:37] <mattfullerton> yeah but it really is all pages
[16:41:01] <mattfullerton> i shortened the beaker secret which seemed to reduce it a bit but the problem is still there
[16:41:08] <mattfullerton> anyway tomorrow :)
[16:43:08] <wardi> mattfullerton: that call is made on all pages to calculate a little number that's shown in the header
[16:43:26] <mattfullerton> ooooooh. good point
[16:43:52] <mattfullerton> i actually dont need that number
[16:44:22] <yanik> i probably should remove it too :D
[16:44:26] <wardi> but as always with performance things, measure first. :-) That was a huge blob for me in run-snake-run for every page
[17:17:30] <rossjones> rgrp Any progress on info about the dat integration proposal?  Is it still being discussed with you and Waldo?

2015-11-02
[12:36:14] <LondonAppDev> Hello
[12:37:06] <LondonAppDev> Does anyone know of a CKAN install with over a 500,000 datasets?
[13:18:35] <rossjones> LondonAppDev no, i think catalog.data.gov may be the largest I know of.
[13:26:57] <amercader> rossjones: the Canadians will get angry if they hear you: http://open.canada.ca/data/en/dataset
[13:27:10] <wardi> hehe. we don't get angry
[13:27:23] <rossjones> oh wow. my apologies ;)
[13:28:10] <wardi> plus most of our datasets come from nrcan and should really be merged together
[13:28:16] <nigelb> rossjones: you'll get a lof of those from the canadians ;)
[13:28:30] <nigelb> (apologies, I mean)
[13:28:39] <nigelb> You know, writing documentation is hard.
[13:28:47] <nigelb> I've been struggling with this ckan on ssl documentation.
[13:28:51] <wardi> mostly we just appreciate being noticed :-)
[13:28:58] <nigelb> I don't even know if it should live with our main docs.
[13:29:03] <nigelb> because these go out of date *real* fast.
[13:29:23] <nigelb> I'm working on writing something up so it can be in a PR and thoroughly debated
[13:48:40] <LondonAppDev> Thanks rossjones and amercader. My one is currently on 120k and it's slowing down but it's just on a dev server right now and doesn't have super high specs.
[13:49:47] <rossjones> LondonAppDev Varnish all the things!
[13:51:20] <rossjones> s/Varnish/Caching layer of choice/
[13:51:50] <LondonAppDev> rossjones that's a good idea.
[13:51:56] <LondonAppDev> thank you.
[13:52:34] <rossjones> we cache pretty much everything for non-logged in users.
[13:52:46] <rossjones> and serve static assets as close to the front (nginx) as we can
[13:53:33] <amercader> LondonAppDev: also check https://github.com/ckan/ckan/wiki/Performance-tips-for-large-imports. It might be out of date and is focused on imports, but there might be some useful pointers
[13:53:52] <LondonAppDev> Oh fantastic. Thanks a lot I'll read through it.
[14:14:21] <LondonAppDev> Can anyone contribute to the CKAN projects on GitHub or is it only a select people?
[14:17:58] <amercader> LondonAppDev: everybody can contribute. Pull requests are reviewed and merged by the tech team or the maintainers of the extensions
[14:18:20] <LondonAppDev> OK cool.
[14:18:22] <LondonAppDev> Thanks.
[14:18:37] <LondonAppDev> I have made a pull request.
[20:10:56] <travis-ci> joetsoi/ckan fixed-resource-tests 5c0db57 https://travis-ci.org/joetsoi/ckan/builds/88858116 joetsoi: The build failed.
[20:14:11] <joet> hmmm should turn that off

2015-11-01

2015-10-31

2015-10-30
[10:11:35] <rossjones> corebits did you get to the bottom of your datapusher woes?
[12:52:18] <corebits> rossjones: not as of yet, hoping to get back on it today.
[12:52:45] <rossjones> That gist suggests it killed CKAN
[12:52:54] <rossjones> Or at least it stopped returning responses.
[12:55:30] <corebits> yes, that is what I had come too, nothing was indicated in the ckan logs at the time which was odd
[12:56:01] <corebits> I will re-run shortly and see if I can get it cough up some more info
[12:56:45] <corebits> I am running 2.3 if that matters ..
[17:11:19] <LondonAppDev> Hi all.

2015-10-29
[10:22:08] <rossjones> corebits on data.gov.uk we just use feature branches. and on ckan core too i guess.
[10:22:51] <rossjones> and typically centralised.
[11:04:16] <travis-ci> datagovuk/ckan solr-errors 65460e0 https://travis-ci.org/datagovuk/ckan/builds/88088417 David Read: The build has errored.
[11:07:49] <travis-ci> datagovuk/ckan travis 9ea61f5 https://travis-ci.org/datagovuk/ckan/builds/88089109 David Read: The build has errored.
[11:08:10] <travis-ci> datagovuk/ckan release-v2.2-dgu 65460e0 https://travis-ci.org/datagovuk/ckan/builds/88088492 David Read: The build has errored.
[11:45:37] <rossjones> eeek, will let dread know we should turn that off :)
[11:51:01] <rossjones> Does travis just pick up any build of anything that is forked from ckan?
[11:58:49] <Zharktas> travis lets you configure the repos which are built in there, datagovuk has configured that their fork needs travis and the fork still has the same .travis.yml which notifies this channel :p
[12:01:07] <nigelb> I think we can still change that.
[13:19:28] <rossjones> No idea who has access to travis from ckan assoc side. presumably nigelb  ;)
[13:22:15] <amercader> rossjones: I think that if you have perms on the github repo you can modify travis settings
[13:22:26] <rossjones> oh neat.
[13:22:37] <rossjones> will check with dread if he's sorted it.
[14:01:28] <wardi> rossjones: meeting?
[14:01:43] <rossjones> Sorry, conf call w/work
[14:01:56] <rossjones> which is a shame I wanted to discuss rq
[15:01:19] <TkTech> rossjones, When is this meeting?
[15:02:05] <rossjones> TkTech According to https://pad.okfn.org/p/ckan-meeting it is 12UTC on Tuesday, 1400 UTC on Thursday.
[15:02:59] <TkTech> Shame, seems like I missed it by an hour. Would also like to be in the rq discussion.
[15:06:27] <rossjones> TkTech there's a PR at https://github.com/ckan/ckan/pull/2706 if you want to comment on the approach (until next meeting).  Not keen on doing more until I've a clearer idea if it is a good approach.
[15:09:55] <rossjones> amercader are you after comments on https://github.com/ckan/ideas-and-roadmap/pull/160 ?
[15:10:02] <rossjones> Because I have some comments :)
[15:12:47] <TkTech> rossjones, I added a comment to your comment :)
[15:13:20] <amercader> I was planning to expand the last section before pinging the list, but by all means go ahead
[15:13:48] <amercader> You missed my presentation during dev meeting
[15:14:33] <amercader> :)
[15:15:43] <rossjones> :(
[15:15:52] <rossjones> TkTech that code is for putting stuff on the queue, not taking it off ;)
[15:16:21] <TkTech> rossjones, Process is identical
[15:16:41] <rossjones> Is creating a connection everytime some enqueues a task a good idea?
[15:17:17] <TkTech> No, but that's not how you do it
[15:17:29] <TkTech> https://gist.github.com/TkTech/4e9f10e91382abe347bf
[15:17:36] <TkTech> This is how you would do it in flask for example.
[15:17:52] <rossjones> I know, originally I was creating the redis_conn on first use, but ended up moving it there for some random reason I can't remember - might have been trying to make it available to tests.
[15:18:18] <rossjones> yes, that gist, but only on first use (because paster).
[15:19:21] <TkTech> But back to your PR, I'd immediately lean away from using rqworker
[15:19:31] <TkTech> It really is only a development helper
[15:19:43] <rossjones> I'm cool with that
[15:19:54] <rossjones> hadn't even got anywhere near that far yet.
[15:20:12] <TkTech> By pure convention, tasks.py is typically stateless (this is also true for celery, gearman, etc...)
[15:20:26] <TkTech> So stuff like the global redis_con and init_tasks should be elsewhere
[15:20:31] <rossjones> Yes, definitely bad naming.
[15:20:36] <rossjones> maybe queue.p
[15:20:38] <rossjones> y
[15:20:59] <rossjones> this is supposed to be the func you call to enqueue a task from inside ckan (or plugin
[15:21:33] <TkTech> Ah yes, would definitely rename it in that case
[15:22:30] <rossjones> One thing I don;'t like about rq - is that you have to import the function so that you can call enqueue_call - any suggestions for how to handle that?  a ITemplateHelpers style plugin for task name->function?
[15:22:43] <rossjones> we will end up with logic_layer funcs importing random functions ..
[15:24:22] <TkTech> I much prefer explicit functions, I actually really dislike actions, helpers and such that work by name.
[15:24:33] <TkTech> Makes testing and static analysis almost impossible for one thing
[15:24:54] <TkTech> BUT, what you want is totally possible.
[15:25:13] <TkTech> Subclass Job and wrap Job.create
[15:25:30] <TkTech> First argument is the function object, if isinstance(func, basestring): func = lookup_func(func)
[15:26:01] <TkTech> Well
[15:26:02] <TkTech> Actually
[15:26:15] <TkTech> You don't even need to do that, since enqueue() accepts strings
[15:26:45] <TkTech> rossjones, https://github.com/nvie/rq/blob/master/rq/job.py#L120
[15:28:33] <rossjones> Oh, that'll make it a lot easier.
[15:28:57] <rossjones> We accept PRs ;)
[15:29:31] <TkTech> I've been sending PRs :)
[15:30:27] <TkTech> ... sometimes duplicates because I forgot I already fixed something and its been 3 months since it was reviewed...
[15:30:58] <rossjones> Yeah :( I still need to do that ticket gardening for old issues ..
[15:31:29] <rossjones> Probably "First page of results" syndrome.
[15:31:45] <rossjones> i.e. once your issue/PR falls off the first page, it's doomed.
[15:31:51] <rossjones> Not necessarily true, but it happens :(
[15:33:31] <TkTech> That's pretty accurate
[15:37:09] <TkTech> wardi is two cubicles down, so I can always go annoy him :)
[15:44:11] <rossjones> You could just throw something, it's easier :)
[15:51:27] <rossjones> amercader is the datapackage stuff going ahead?  from okf or outside?
[15:52:36] <rossjones> I know, should have gone to the meeting :(
[16:24:07] <amercader> rossjones: you mean the work related to the spec? Yes, it's going ahead once everyone is happy with the spec
[16:30:34] <rossjones> cool
[19:52:37] <corebits> Anyone using Datapusher/Datastore for 1M+ records ? Working on importing from csv, but it keeps bailing out after 268k records.
[20:02:33] <MattiMo> running out of memory somewhere along the line?
[20:02:40] <MattiMo> corebits:
[20:35:30] <corebits> MattiMo: possibly, I'm still digging ...
[20:36:50] <corebits> Am I missing something here http://pastebin.com/dKBSBT1z

2015-10-28
[02:15:08] <poolparty> does CKAN support PATCH?
[02:15:14] <poolparty> the action API i mean
[08:26:07] <yanik> hi guys
[08:26:58] <yanik> how come i see pbkdf2_sha512 password encoding in CKAN code and and "pbkdf2_sha256$20000 .. " in database? :)
[08:27:55] <yanik> ops, WRONG question, don't read :)
[08:28:34] <yanik> (did not noticed this is old rows)
[12:28:19] <travis-ci> ckan/ckan master fee3bbb https://travis-ci.org/ckan/ckan/builds/87870811 amercader: The build was broken.
[19:06:24] <corebits> What type of git workflows have you guys managed to get approved by your Orgs ? We are looking at a forking workflow, curious what others are using

2015-10-27
[12:02:00] <wardi> amercader, joet, rossjones, brook: meeting?
[12:02:17] <amercader> ups, isn't it in an hour?
[12:02:37] <wardi> oh, maybe time change has messed me up
[12:03:14] <amercader> nope, google says it, so we have a meeting now https://www.google.co.uk/search?q=12pm+utc
[12:03:44] <wardi> ah, you had a time change and I didn't
[12:04:07] <wardi> I'm fine with doing it in an hour
[12:05:55] <wardi> nm, it's on right now
[13:03:27] <wardi> rossjones: persona is dead?
[13:39:39] <rossjones> wardi last year -> http://identity.mozilla.com/post/78873831485/transitioning-persona-to-community-ownership
[13:39:51] <rossjones> sorry, missed meeting, just back from London.
[13:40:23] <rossjones> Dead in as much as it really needed Moz's marketing power and won't be as influential without it.
[13:46:46] <wardi> rossjones: ah, I missed that, the last I remember hearing was about its new name
[13:47:57] <rossjones> wardi identity is really too important to leave to silos like twitter, or google or whatever :(
[13:49:24] <wardi> rossjones: I agree, also it's a wickedly hard problem to solve
[13:49:47] <rossjones> Yeah, persona was a good first attempt though.
[17:26:52] <TkTech> 150 columns!
[17:57:09] <rossjones> S'awesome eh TkTech

2015-10-26
[09:02:10] <yanik> hi guys
[09:03:13] <yanik> so far ckan goes well on my project, but integration is painful :(
[10:16:50] <yanik> rossjones, i test your ckan-persona plugin fix, but it has weird bug in chrome
[17:56:55] <rossjones> yanik weird how so?
[17:59:53] <yanik> rossjones, it login me again, 5 sec after logout, somethink about sessions, i think. I switch from persona, for now, but can give you test report if you want to
[18:28:17] <rossjones> I wonder why it was not kill the session.  If you could post any info as a ticket, I'll take a look, but I don't really have a use-case for it (I wish persona wasn't dead :( ).

2015-10-25
[23:02:58] <poolparty> I'm trying to override a ckan action called **ckan.logic.action.delete.organization_delete**
[23:03:06] <poolparty> in a an extension
[23:03:37] <poolparty> I've create the appropriate folder structure in my extensions
[23:03:52] <poolparty> ckanext/<plugin_name>/logic/action/delete.py
[23:04:05] <poolparty> is there anything else I need to do to register this action override?
[23:04:10] <poolparty> i don't see much about this in the docs
[23:09:56] <poolparty> nope, that's all I needed to do, THANKS!

2015-10-24

2015-10-23
[13:11:04] <rossjones> what's the best way to start a discussion about another field in the core resource schema? ML?
[14:46:15] <travis-ci> ckan/ckan rq c3e3087 https://travis-ci.org/ckan/ckan/builds/87040107 Ross Jones: The build has errored.
[15:25:20] <wardi> rossjones: PR? :-)
[15:27:15] <rossjones> Yeah.
[15:27:17] <rossjones> missing redis
[15:30:49] <rossjones> Not sure logging PRs to irc is wise...
[15:37:01] <wardi> hmm?
[15:38:05] <rossjones> the emails are punishment enough, not much to be gained from everyone seeing them .. no?
[15:39:07] <wardi> I'm lost. I was saying a PR is a good way to discuss adding a new field to our solr schema
[15:46:22] <rossjones> Ah sorry, I thought you meant travis posting to IRC.
[15:46:28] <rossjones> Yes, I guess a PR would do it ;)
[15:47:21] <wardi> "show me the code!" mind you I'm one of the most guilty of rambling on the ideas repo without any concrete code to have reviewed
[15:52:54] <rossjones> I view the ideas repo as "someone should fund this possibly significant piece of work", rather than actual issues.  It's an opportunity to persuade someone to fund it.
[15:53:15] <rossjones> Current plan with PRs is start them, wait until dread gets bored of waiting and finishes it.
[15:54:04] <wardi> dreads sound useful. We should get one of those here
[15:54:46] <rossjones> We can loan him to you if you like ;)
[17:24:08] <nigelb> this reminds me
[17:24:13] <nigelb> I have a PR for SSL documentation.
[17:24:18] <nigelb> I should finish that and push it.

2015-10-22
[00:19:30] <junkmob> I have a custom plugin and I'm registering custom actions
[00:19:52] <junkmob> however, it's returning me the wrong action for my action name even though it's primary
[00:20:04] <junkmob> where is the action lookup code?
[00:21:12] <junkmob> I assume the Toolkit for my extensions should have this logic it in, but it's hard sniff out
[01:26:28] <junkmob> how does a plugin tie into a delete hook?
[01:26:45] <junkmob> is there a special function I should override?
[10:31:17] <rossjones> If anyone's looking for some CKAN work, and has contributed before, please ping me, I've got a lead for you!
[14:56:18] <joet> hey wardi_ so your validator method of making external api call works a treat, but have you had to make an external call in a validator in the case of package_delete?
[14:56:33] <joet> I will be able to use IPackageController.after_delete, but was just curious in your case
[15:25:59] <wardi_> joet: I have never tried that, no
[15:33:30] <joet> fair, after delete will work in my case
[16:46:22] <wardi_> joet: I completely forgot what I suggested that for, would you remind me?
[16:53:15] <joet> I wanted to call an external api and store the result in the package dict, your suggestion was to do it all in a validator
[16:53:17] <joet> works fine
[16:53:40] <joet> ipackagecontroller.after_create is a bit problematic when it comes to messing aroudn with the package_dict.
[16:54:15] <wardi_> oh ok, why do you need to do something similar on delete?
[16:55:49] <joet> just to call an external api function
[16:56:00] <joet> but after_delete works fine in this case
[16:56:35] <wardi_> ok, I was worried the two were similar but done in different ways, sounds like they aren't related

2015-10-21
[01:41:15] <travis-ci> wardi/ckan 2696-resource-errors-block b33a08d https://travis-ci.org/wardi/ckan/builds/86528204 Ian Ward: The build failed.
[10:31:08] <Vilsepi> gah, finally managed to hunt down my problem with the text_view resource plugin. I had ckan.site_url different from the actual url I was using to access the site, and in the datapreview.py there is a check to see whether the resource is local or remote. This check returned that the resource would be remote, even though it actually is on the same machine, just using a different hostname. :)
[13:57:02] <joet> anyone had datastore_active=false cached by solr before? and you have to add a new resource to get it updated, even if the original source is in the datastore?
[15:36:02] <swimcasual> ha!
[15:36:04] <swimcasual> https://github.com/KSP-CKAN/CKAN/pull/268
[15:39:13] <DragonDave> swimcasual: you probably want #ckan on irc.esper.net :P
[15:40:23] <swimcasual> nope, this is the one, just a funny Google search uncovered that
[16:37:23] <rossjones> wardi_ what's the easiest way for me to revert that merge? I guess I was just too quick on the trigger :(
[16:38:15] <wardi_> there's a "revert" button on https://github.com/ckan/ckan/pull/2698
[16:38:45] <rossjones> Creates a new PR.
[16:42:14] <rossjones> Shame we can't disable the merge button for certain users on github ...
[17:11:38] <amercader> joet: maybe this will help with this: https://github.com/ckan/ckan/pull/2234
[17:31:45] <travis-ci> ckan/ckan 2234-persist-datastore_active 0c020f7 https://travis-ci.org/ckan/ckan/builds/86667365 amercader: The build has errored.
[17:47:39] <travis-ci> ckan/ckan 2234-persist-datastore_active 0c020f7 https://travis-ci.org/ckan/ckan/builds/86667365 amercader: The build has errored.
[21:17:29] <junkmob> what DefaultGroupForm or DefaultOrganizationForm functions handle form updates?
[21:25:33] <junkmob> form_to_db_schema is the answer i believe

2015-10-20
[00:20:23] <wardi_> junkmob: a blank query should return facets with the number or results for each org
[00:22:18] <wardi_> oh, maybe you need to pass the facets, just a sec
[00:25:23] <wardi_> echo '{"facet.field":["organization"]}' | ckanapi -r http://my.ckan.site action package_search -i
[00:26:16] <wardi_> ^ this sort of api call will add a "search_facets" dict to the results that will include counts for each org
[00:31:48] <junkmob> wow, wardi_, you are the best
[00:32:01] <junkmob> thanks
[00:33:07] <wardi_> add a rows:0 in there to not bother fetching datasets into the results
[00:49:26] <junkmob> wardi_: one last thing, off the top of your head, is there some magic that needs to happen for my template helper to be seen?
[00:49:41] <junkmob> there's already a template helper being used in this ckan extension
[00:49:57] <junkmob> and I don't see them having to register it with the plugin like the docs talk about
[00:50:03] <junkmob> but mine is definitely not being seen
[00:51:08] <wardi_> junkmob: helpers do need to be registered
[00:53:35] <junkmob> wardi_: ahh, so this doc is up to date then? http://docs.ckan.org/en/latest/theming/templates.html#adding-your-own-template-helper-functions
[00:53:40] * junkmob must be
[00:55:57] <junkmob> wardi_: nevermind, i figured it out!
[12:02:18] <wardi_> rossjones: meeting?
[12:05:07] <rossjones> Yeah, one sec.
[23:39:15] <swimcasual> question here: i'm new to CKAN but it seems common in the ckan extensions I've been groking
[23:39:15] <swimcasual> that all CRUD operations do not go through the models and ORM but through the action API
[23:39:28] <swimcasual> is that right?
[23:40:48] <swimcasual> one of the examples I'm looking at is a ckan extension with a few plugins in it
[23:41:30] <swimcasual> I'm noticing the template helpers use the action API alot
[23:43:10] <swimcasual> of course, being new and naive, i could have this all wrong

2015-10-19
[00:24:58] <junkmob> factory_boy is not listed as a dependency but is required
[00:25:03] <junkmob> what version should I be using?
[08:49:25] <rossjones> junkmob it's in https://github.com/ckan/ckan/blob/master/dev-requirements.txt
[08:49:28] <rossjones> oh.
[08:49:29] <rossjones> sigh.
[13:45:48] <rossjones> Am I right in thinking that if I use the OrganizationFactory in new tests, any action func that tries to look it up in DB will fail?
[13:48:27] <rossjones> Looks like it is calling organization_create, but no members being set :(
[14:33:03] <amercader> rossjones: factories create an actual object so lookups should work
[14:33:14] <amercader> you can pass a list of members to the constructor
[14:33:26] <rossjones> Just discovered using setup_class was causing me the problems.
[14:33:54] <rossjones> :(
[21:24:56] <junkmob> where is the glue code that connects the route organizations_index to the controller GroupController
[21:24:59] <junkmob> i cannot find it
[21:25:20] <junkmob> put another way, how are the routes mapped to the right controller and where can i find that code?
[21:26:11] <wardi_> junkmob: ckan/config/routing.py
[21:29:50] <junkmob> thanks wardi_, but that doesn't seem to point to a GroupController
[21:30:48] <wardi_> the organization controller inherits from GroupController
[21:31:19] <junkmob> wardi_: ah, i see it now in SubMapper
[21:31:20] <junkmob> thanks
[21:31:27] <junkmob> didn't see that argument before
[21:33:13] <wardi_> this code is pretty tricky to find your way around.
[21:44:27] <junkmob> if I have a ckan extension project and I want to add package_count to the organization_item.html
[21:44:31] <junkmob> how would one do that?
[21:45:58] <junkmob> I see that package_count is referenced in the GroupController
[21:45:58] <junkmob> https://github.com/ckan/ckan/blob/master/ckan/controllers/group.py#L355
[21:46:21] <junkmob> but my organizations_index route only seems to touch GroupController.index
[21:50:35] <junkmob> I guess i could subclass OrganizationController and override the index function to do what I want, but that seems like overkill
[21:51:39] <wardi_> junkmob: what's the thing you're trying to do?
[21:53:56] <junkmob> wardi_:  i want to put the package_count associated with a organization into the organization_item.html template
[21:54:06] <junkmob> package_count is referenced here https://github.com/ckan/ckan/blob/master/ckan/controllers/group.py#L355 in GroupController
[21:54:29] <junkmob> but that's a function that sadly is not called for my organizations_index route
[21:56:53] <wardi_> you can get that from the facets returned by a package_search if your datasets are public. Maybe use IRoutes to override the organization_index route so you can pass that data to your template
[21:57:59] <junkmob> wardi_: let me repeat back what I think you said
[21:58:07] <wardi_> or you could write a helper that gives you the package_count values for all orgs (by doing a package_search) then pass the values into the organization_item snippet for display
[21:58:24] <junkmob> 1. I'll have to override OrganizationController
[21:58:43] <junkmob> 2. use this call https://github.com/ckan/ckan/blob/master/ckan/controllers/group.py#L345
[21:58:48] <junkmob> to get the package_count
[21:59:02] <junkmob> 3. and render my organization_item template
[22:00:13] <junkmob> wardi_: I'm guessing that either one of those options still require me to override the controller as I understand it
[22:01:39] <wardi_> hmm. this is hard to explain. You can either override the route so you can use your own controller for that page
[22:01:52] * junkmob nods
[22:02:15] <wardi_> or you can create a helper that gets the package_counts for all organizations and do everything by extending the templates
[22:02:39] <junkmob> thanks for you help wardi_, I'll look into #2
[22:03:15] <junkmob> boomers > http://docs.ckan.org/en/847-new-theming-docs/template-helper-functions.html
[22:03:26] <junkmob> one good thing about CKAN is the amount of documentation
[22:04:39] <wardi_> that will be the cleaner way I think. I would make a get_package_count_by_organization helper function that calls package_search with zero rows, just to retrieve the #packages for each org
[22:05:32] * junkmob hands wardi_ a beer and twinkie
[22:05:45] <wardi_> that helper could return a dict of org-name:#packages, then you extend organization_list.html to pass in the #packages to each organization_item.html snippet
[22:52:17] <junkmob> wardi_: I think I almost got it, however, the solr query for this is beyond me. I'm trying to come up with the *fp* for number of projects per organization
[23:16:03] <junkmob> is there a way to debug helpers?

2015-10-18

2015-10-17

2015-10-16

2015-10-15
[09:40:54] <travis-ci> ckan/ckan master ac221ec https://travis-ci.org/ckan/ckan/builds/85491491 Ross Jones: The build was broken.
[10:21:06] <rossjones> Once again, build not actually broken, just Travis having a bad day :(
[12:52:52] <Vilsepi> I'm trying to get the new text_view working with xml resources in CKAN 2.4.1. I added the text_view, image_view and recline_view plugins in the ini file, set views.default_views = text_view, set preview.xml_formats = xml wsdl wsdl+xml. I have 2 resources, one is of type wsdl and other is xml. I ran paster views create, but no views show up. If I go to the Manage -> Views -> New View, there's only Image in the dropdown menu, but nothing else. Any idead
[12:53:52] <Vilsepi> I've been reading this mostly http://docs.ckan.org/en/latest/maintaining/data-viewer.html#text-view
[13:00:08] <Vilsepi> I assume that text_view does not require datastore or datapusher if using uploaded resources
[13:30:43] <amercader> Vilsepi: are your files hosted on the same server as ckan? if not you will need to add the resource_proxy plugin
[14:03:32] <rossjones> brook - call?
[14:17:41] <Vilsepi> amercader: yes they are. But do you know whether text_view requires datastore or not?
[15:06:58] <amercader> Vilsepi: no, text_view does not require datastore. But if the text file is hosted elsewhere you'll need the resource_proxy plugin
[15:07:11] <amercader> and btw the setting is ckan.views.default_views , not  views.default_views
[15:32:52] <rossjones> Ah Joel not on IRC - can't open his dat doc.
[15:40:14] <rossjones> Have emailed.
[21:47:40] <wardi_> mstantoncook: welcome!
[21:47:58] <mstantoncook> hi
[21:48:05] <wardi_> mstantoncook: you should use an irc proxy or log in from a server that stays online, it's hard to reply to you :-)
[21:48:54] <mstantoncook> Yeah. I think there is cloudirc these days
[21:50:28] <wardi_> You say you're going to be hanging around I just wanted to welcome you to attend a dev meeting if you're interested in chatting

2015-10-14
[06:37:48] <mstantoncook> Hi. I'm Mitchell Stanton-Cook. I've just recently come on at XVT (Bronze CKAN member, xvt.com.au) as a CKAN & Python Dev. It looks like most of the discussion is done on dev-mailing & GitHub issues these days. Anyway, just wanted to say Hi as you're going to be seeing a fair bit of me now
[09:22:37] <teemue_> wardi_: I added the tests to ckanext-scheming/pull/87 last week. Anything else missing before you can merge?
[11:36:03] <Vilsepi> I'm trying to upgrade Solr from 3.x to 5.3.1, but I keep getting NotFound errors in CKAN, any ideas? I did the Solr installation somewhat like this https://github.com/vrk-kpa/api-catalog/blob/64dd59f059cbc2c567274cc4f181170ce36d0092/ansible/roles/solr5/tasks/main.yml and used solr_url = http://localhost:port/solr/corename in ckan.ini
[11:43:28] <Vilsepi> I tried our own schema.xml that works with solr3 and the default schema from ckan, and ran reindex with paster
[11:46:05] <amercader> Vilsepi: IIRC there were some changes needed in the schema.xml file for Solr 5 to work https://github.com/ckan/ckan/issues/2524
[11:53:05] <Vilsepi> ahh, I was looking at some older issues but missed that one, thanks
[12:32:46] <Vilsepi> hmm, well the search under organization view works, but the main dataset search says no datasets found no matter which query
[14:20:07] <Vilsepi> actually, I realized my datasets were in private state. I can't remember whether default ckan returned private datasets or not in the main search
[14:39:39] <wardi_> teemue_: looks great, thanks!

2015-10-13

[08:59:37] <mattfullerton> nigelb: are you there?
[09:00:43] <nigelb> mattfullerton: yep, what's up?
[09:25:39] <mattfullerton> sorry, back now. I tried your fix with CKAN/SSL/packages, and it worked, with CKAN - the resource_proxy works now. I also tried it with the datapusher virtualenv, but there I still have: Error([('SSL routines', 'SSL3_GET_SERVER_CERTIFICATE', 'certificate verify failed')],)
[09:26:25] <mattfullerton> Just in case you know off the top of your head why that would be. We have a workaround where we set verify=False in all of the relevant places for datapusher, and as its only accessing a local server, we could live with it
[09:26:47] <nigelb> the thing to figure out in this instance (if possible), is which particular file it's failing with.
[09:26:58] <nigelb> if it's failing with an external resource which has a self signed cert, nothin we can do.
[09:27:16] <nigelb> if it's failing with a file hosted on this instance, we'll probably need to dig more.
[09:28:20] <Zharktas> it would be nice to disable cert verification via env variable or something
[09:28:33] <nigelb> yeah, I'd love for that to be a ckan setting.
[09:31:22] <mattfullerton> the problem is systemic
[09:31:33] <mattfullerton> at the end of a datapusher run, datapusher contacts the CKAN instance itself
[09:31:37] <mattfullerton> the API
[09:31:43] <mattfullerton> and thats where the failure becomes
[09:31:45] <mattfullerton> comes*
[09:31:57] <mattfullerton> we have no control over the SNI etc. of the SSL
[09:32:36] <Zharktas> you can disable verification from api as well, but it's a chore
[09:32:58] <Zharktas> i've done couple times when i needed to test something in dev environment
[09:33:07] <mattfullerton> to be clear, Im talking only about the datapusher, not ckan
[09:33:31] <mattfullerton> we had a similar problem with ckan but there the extra packages did the trick
[09:33:51] <mattfullerton> we also have no problems in general pull resources from http/https for datapushing
[09:34:15] <mattfullerton> its just this last step where datapusher contacts CKAN
[09:35:14] <mattfullerton> e.g.: https://github.com/ckan/datapusher/blob/master/datapusher/jobs.py#L175
[09:36:27] <Zharktas> if you disable the verification from that, it still fails ?
[09:36:43] <mattfullerton> nope, if i change each of those lines to include verify=False, then it all works
[09:37:06] <mattfullerton> so as I say I can live with this, its an extreme edge case because we cant alter the SSL setup of the CKAN
[09:51:07] <nigelb> that's incredibly weird.
[09:51:14] <nigelb> It shouldn't fail when talking to ckan.
[09:52:56] <Zharktas> if the whole ckan is behind self-signed cert, it will always fail since the api call get https url
[09:53:36] <nigelb> yeah, but in this instance, ckan isn't behind a self-signed cert
[09:54:05] <nigelb> oh. hrm.
[09:54:58] <nigelb> mattfullerton: check if your requests version matches between ckan virtualenv and datapusher virtualenv?
[09:55:27] <mattfullerton> its not self certed, but it is suffering from the SNI problem
[09:56:18] <mattfullerton> Another option would be a sep. internal ckan_url for datapusher, but, anyway
[09:56:54] <mattfullerton> I cant check anything right now :( Im only allowed in via teamviewer with telephone accompanyment (were in Germany ;-))
[09:57:44] <mattfullerton> but I think i did requests[security] upgrade
[09:58:24] <mattfullerton> I see datapusher should be getting the latest requests (or the system one???): https://github.com/ckan/datapusher/blob/master/requirements.txt
[09:58:38] <Zharktas> so the problem actually is that you can't get the python module installed to ckan instance which fixes sni ? :p
[09:59:08] <nigelb> He got the python module installed for the ckan instance and datapusher
[09:59:11] <nigelb> it worked for ckan
[09:59:13] <nigelb> but not for datapusher
[09:59:16] <mattfullerton> no, there is no problem with the ckan instance
[10:00:17] <Zharktas> maybe i just shutup since i actually don't know all of context :p
[10:01:21] <nigelb> maybe verify=False is the solution until we can reproduce a minimal test case.
[10:03:56] <mattfullerton> Ill check the versions of environment packages next time I get a chance
[10:04:00] <mattfullerton> thanks!
[10:04:56] <mattfullerton> The other option of course is to add Python 2.7.9 to the system and then redo the virtualenv with that python. Seems like a lot of work though.
[12:04:06] <wardi_> rossjones, amercader: meeting?
[12:04:21] <amercader> ups, sorry 2 secs
[13:19:51] <yanik> sorry for unnamed docs PR :)
[13:25:48] <joet> haven't come across it myself to be honest
[13:26:12] <joet> yanik, thanks for the docs change, you'll have to change the  writing style to get it merged
[13:26:45] <joet> to something like "If you get the error" "then"
[13:27:02] <yanik> joet, you mean spelling? i got it 5 times
[13:27:20] <yanik> do you try follow docs on clean ubuntu 12.04 & package install?
[13:27:37] <joet> yanik, I mean instructional style
[13:27:51] <joet> all the rest of the docs are "you should run this command and that command"
[13:28:09] <yanik> joet, ok, i will make it more similat to all docs instructions you have
[13:28:26] <joet> yeah there are some style guides in the docs themselves
[13:28:50] <joet> http://docs.ckan.org/en/latest/contributing/documentation.html
[13:29:19] <joet> the error is the important thing here, I don't want to get it rejected just because of some style issues!
[13:29:20] <yanik> "first pancake is always lumpy" :)
[13:30:03] <joet> :p
[13:38:46] <yanik> what is the best way to make raw sql query through session from plugin? I found ckan.model.Session.query, but i don't need query models
[13:41:57] <yanik> also i found .plugins.interfaces.ISession, but it is extend all my sessions, right?
[13:52:43] <joet> yanik, where are you doing this? you need to query the database from some extra stuff in your templates or is this in a custom action?
[13:55:54] <yanik> joet, i need extra template context from third part DB tables (not CKAN)
[13:56:27] <joet> but tables in the same db?
[13:57:23] <yanik> ofc
[13:57:37] <yanik> thats why i need same session, from ckan
[13:58:54] <joet> in your own controller?
[13:59:10] <yanik> no idea, i have almost clean plugin :)
[13:59:39] <yanik> i try check other plugins, but they mostly use ckan.model.Session.query
[14:00:19] <joet> oh, well either way you should be able to use the raw sql alchemy session.execute()
[14:00:55] <joet> personally I'd probably use sqlalchemy core, but that would probably involve mapping the tables from your 3rd party tables which might be too much hassle.
[14:02:13] <joet> or model.meta.engine might help you along, but I prefer avoiding raw sql myself
[14:02:14] <yanik> joet, i want to use sqlalchemy too, but I don't yet understand CKAN much, so raw will be simplest way
[14:03:00] <yanik> if i could just import sqlalchemy session and make queries, it wood be perfect
[14:03:50] <joet> yanik, just use model.Session (if it lets you execute queries using execute, I can't remember the full syntax)
[14:04:10] <joet> it'll always refer to the current session
[14:04:11] <yanik> i search it on github, thx :)
[14:04:15] <joet> you won't need to worry
[14:07:48] <yanik> we probably need docs for this one as well
[14:11:25] <joet> well most of the time you'd be adding a bunch of actions that get called in whatever custom controllers you add
[14:11:43] <joet> that would probably end up being mapped tables
[14:12:09] <joet> so some docs on how to add tables and let sqlalchemy know about them in the extension would be good
[14:14:22] <yanik> ok, i will produce some, if reach good understanding of topic

2015-10-12
[11:22:32] <amercader> joet: I'm checking your branch on the packaging repo: https://github.com/ckan/ckan-packaging/pull/6
[11:23:12] <amercader> the idea is that you run the packaging commands inside a vagrant box right? so `vagrant up` on your branch should be enough?
[11:23:49] <amercader> I'm getting this when running it: https://gist.github.com/amercader/cfd4abf2601a9cdf81bf
[11:25:08] <joet> amercader,  yeah vagrant up should be enough
[11:25:30] <amercader> did you find this? ^
[11:25:32] <joet> I'll take a look not sure I have come across that error
[11:27:02] <joet> https://github.com/ansible/ansible/issues/8644
[11:27:46] <amercader> got it, just upgraded ansible thanks
[11:28:20] <amercader> joet: are the prompts meant to be private? (for ckan version etc)
[11:28:35] <joet> amercader, yeah there is a bug at least on my set up of ansible that prevents it from being shown
[11:28:57] <joet> i figured it wouldn't be a huge issue, it might have been fixed now in a newer version
[11:29:05] <amercader> ok, I'll check on my end
[11:29:44] <amercader> so, if we wanted this to work for lucid and trusty we can have two vagrant files / ansible scripts
[11:30:13] <amercader> and I guess that the idea is that we run it locally and then upload the builds to s3
[11:30:36] <amercader> or on a packaging server really
[11:32:55] <joet> yeah, we can probably just write a bash script to do it
[11:33:01] <joet> i thought we were getting rid of the packaging server
[11:33:39] <joet> bash script to do the two different builds that is
[11:35:57] <joet> also we'd need to pacakging servers, or we could get the packaging server to run the vagrant scripts and do all the vm stuff itself
[11:38:01] <amercader> joet: having all core devs (or anyone really) being able to build the packages sounds like a good plan. The packages need to end up in S3 anyway (http://packaging.ckan.org/)
[11:38:42] <amercader> we'll need to change the name or have two folders for each distro though
[11:38:55] <joet> yeah that's what I was badly wording in my comment
[11:40:24] <amercader> saw it now, exactly
[11:40:59] <amercader> Oh cool, once you boot up the vagrant vm you can just run `vagrant provision` to just run the ansible bit
[11:42:59] <joet> yeah i should add a read me
[11:43:23] <joet> we probably don't need to be constantly clearing the ckan directory as well
[11:43:37] <joet> but it's probably safer to leave it atm
[14:51:02] <yanik> do you think it is possible to sync django and ckan sessions over user email? i use Persona on both sites, but still have different sessions
[14:51:23] <yanik> sides*, and one domain true proxy system
[14:51:34] <yanik> thought
[14:51:39] <yanik> sorry, a bit tiered :)
[16:10:41] <travis-ci> ckan/ckan 2681-lazy-json c7c0d3e https://travis-ci.org/ckan/ckan/builds/84938046 David Read: The build failed.
[16:55:16] <sudobangbang> Why do I see Django references in CKAN templates and CSS?
[16:59:20] <joet> what references are those?
[17:03:14] <sudobangbang> joet: they seem to be in templates and themeing
[17:03:15] <sudobangbang> https://github.com/ckan/ckan/search?utf8=%E2%9C%93&q=django
[17:03:24] <sudobangbang> just wondering why. did this use to be a Django app?
[17:03:51] <joet> those are in the docs
[17:03:56] <sudobangbang> ah, just the docs
[17:03:58] <sudobangbang> i see
[17:04:15] <joet> presumably sphinx doesn't have a jinja2 markup tag
[17:04:26] <sudobangbang> sounds like sphinx ;-)
[17:04:28] <sudobangbang> thanks joet
[17:05:42] <sudobangbang> joet: one more question. is there any movement or talk about porting this off Pylons to Pyramid or some other framework? Just wondering
[17:06:23] <joet> if you're interested go read https://github.com/ckan/ideas-and-roadmap/issues/30
[17:07:01] <joet> and https://github.com/ckan/ckan/wiki/Flaskification
[17:07:16] <sudobangbang> nice, thanks again joet
[17:08:02] <joet> but yes, all the core devs would love to see it happen, it's a case of making it happen
[17:10:05] <joet> (if you're up for helping :p )
[17:12:23] <sudobangbang> joet: i sure am up for helping (if i have the time, as is the case for everyone)
[17:13:39] <joet> yeah that's pretty much the problem

2015-10-11
[19:38:32] <sudobangbang_> hello everyone! someone recommended CKAN to me as a 'Django' app but I see it's actually Pylons. There's some references to 'django' in the templating stuff. For my own curiosity, did this use to be a Django app? Why the template references?

2015-10-10

2015-10-09
[16:18:53] <travis-ci> ckan/ckan upgrade-requirements 5f10aef https://travis-ci.org/ckan/ckan/builds/84530889 David Read: The build was broken.

[09:42:50] <mattfullerton> Quick Q, before I say something wrong, CKAN with Python 3 is a complete no go, right?
[09:43:37] <Zharktas> yes
[10:11:22] <rossjones> mattfullerton would be good to quantify the breakage though, in case it is more than just Pylons not supporting it.
[10:12:02] <mattfullerton> We should  make a CKAN Hackathon for answering questions like that
[10:12:11] <mattfullerton> also CKAN as an SPA
[10:28:11] <rossjones> mattfullerton if you wanted to add an SPA to my ckan-mini side-project, that would be cool ;)
[10:28:53] <mattfullerton> unfrtunately theres a huge void between the fun things Id like to do and what I have to do :(
[10:29:03] <mattfullerton> but i do want top respond to that thread
[10:29:34] <mattfullerton> i also want to blog about integrating an angular app into an existing CKAN
[10:29:35] <rossjones> Tell me about it ... not enough hours in the day
[10:29:46] <mattfullerton> to save others pain in case anyone is crazy enough to try it
[10:29:48] <rossjones> ooh. angular.  Is there an angular-ckan extension?
[10:30:06] <mattfullerton> not yet, but i could quickly make one
[10:30:55] <mattfullerton> what would then be nice is to model the api as an angular service, though that might be some work as its an action api and not rest
[10:40:14] <rossjones> mattfullerton there's v2 of the api https://data.gov.uk/api/rest/package/naptan for instance.
[10:40:32] <rossjones> But I've no idea if it's a good idea long term to rely on it.
[12:10:20] <nigelb> Okay, folks I need your opinions.
[12:10:27] <nigelb> https://gist.github.com/nigelbabu/076ad12c13b2071de8e1
[12:10:37] <nigelb> this is fairly mature and probably ready to go into the documentation.
[12:10:50] <nigelb> I'm happy to lead this effort but this will lead to a lot of edge cases with misconfiguration.
[12:10:58] <nigelb> Increasing the support load.
[12:11:07] <nigelb> But I still think it's a good piece of documentation to land.
[12:11:08] <nigelb> Thoughts?
[12:18:00] <mattfullerton> rossjones: yep, familiar with that but was assuming it was deprecated
[12:18:13] <nigelb> brook / rossjones / wardi_ ^
[12:18:17] <mattfullerton> but youre right if it works
[12:19:34] <mattfullerton> nigelb: There needs to be a warning attached to add_header Strict-Transport-Security - I got burned by that running something else on the server that wasnt https
[12:20:02] <nigelb> yeah, I got burned too
[12:20:05] <nigelb> I intend to add that warning.
[12:20:13] <nigelb> this is among the reasons why it will take some time to land
[12:20:16] <nigelb> needs a bit of review.
[12:20:36] <nigelb> from devs as well as ckan site admins
[12:20:40] <nigelb> what is missing, etc.
[12:22:36] <nigelb> Overall, I will still get the documentation as a pull request
[12:22:38] <nigelb> and add more things.
[12:22:42] <rossjones> nigelb have we got a working setup with just nginx yet?
[12:22:48] <rossjones> I don't like apache
[12:23:04] <nigelb> I haven't done this in a while
[12:23:14] <nigelb> where this -> use nginx only
[12:23:29] <nigelb> Anyway, that is orthogonal to the issue of ssl with ckan
[12:23:38] <nigelb> since SSL is mostly at the nginx level *anyway*
[12:30:01] <mattfullerton> I could contribute the config for SSL with just apache if thats any help
[12:30:17] <mattfullerton> you have to separately store the chain cert for example
[12:31:40] <nigelb> mattfullerton: I want to give as little options as possible.
[12:31:47] <nigelb> so there's as little chance as possible for things to go wrong.
[12:31:52] <mattfullerton> ok, good point
[12:31:57] <nigelb> The more open ended we leave things
[12:32:02] <mattfullerton> its good that theres a recommended way
[12:32:06] <nigelb> the more difficult answering support questions will be
[12:32:10] <nigelb> this is already hard enough.
[12:32:13] <mattfullerton> yep
[12:32:32] <nigelb> And the recommended SSL configurations change pretty often
[12:32:38] <nigelb> so that's one thing we need to be careful about.
[12:32:55] <nigelb> For instance my gist above doesn't get an A+ on ssllabs anymore.
[12:33:03] <nigelb> Because you need to generate a dhparams file
[12:33:07] <mattfullerton> :(
[12:33:33] <nigelb> I also want to add in some documentation on how to fix it if things go wrong.
[12:33:49] <nigelb> Like what to do if you mess up HTST
[12:34:08] <mattfullerton> nigelb: out of interest, in your work, do you have a lot of people where the ssl config is out of their control because some other department handles it? It led me to have a very weird SSL problem where the answer is probably upgrading to python 2.7.9
[12:34:25] <mattfullerton> Docs on the dangers of SSL regarding views extensions would be good too
[12:34:38] <nigelb> Most often peope want me to set it up because they don't know how.
[12:34:48] <nigelb> But once you set it up, for instance with SNI, you end up weird problems
[12:34:52] <nigelb> we tend to not use SNI.
[12:34:55] <mattfullerton> OK thats a nicer problem
[12:35:20] <mattfullerton> yes, well, please dont start, at least until ubuntu 16 is out
[12:35:28] <nigelb> Heh.
[12:35:48] <nigelb> I want documentation to support 12.04
[12:35:56] <nigelb> Then I can write SSL docs targetting 12.04
[12:36:02] <nigelb> because the apache version changed in between
[12:36:51] <mattfullerton> sorry its an edge case that was driving me mad: datapusher, in fact python/requests in general, cant access CKAN with some SSL configs because of a deficiency in Python <2.7.9
[12:37:11] <mattfullerton> I thought CKAN 2.5 was moving to 14.04
[12:37:27] <nigelb> mattfullerton: yep
[12:37:31] <nigelb> that's the SNI problem :)
[12:37:34] <nigelb> there's a way around it.
[12:37:42] <nigelb> I recently read some docs about it.
[12:37:49] <nigelb> Let me hunt that down.
[12:39:55] <nigelb> mattfullerton: http://docs.python-requests.org/en/latest/community/faq/#what-are-hostname-doesn-t-match-errors
[12:40:13] <nigelb> so the fix is to `pip install pyopenssl ndg-httpsclient pyasn1`
[12:40:20] <nigelb> worth trying the next time you hit it :)
[12:42:02] <mattfullerton> thats fantastic, thanks, which Id had you around yesterday ;-)
[12:43:16] <nigelb> :)
[12:43:35] <nigelb> all of these painful knowledge is learned from having hit it in the past.
[12:43:53] <nigelb> mattfullerton: http://nigelb.me/2014-11-04-ie8-ssl-woes-and-nginx-superhero.html
[12:44:01] <nigelb> that one is my favorite ssl side effect.
[12:44:13] <nigelb> win xp and ie8 combo does not like cache headers when using ssl.
[12:44:27] <nigelb> and only when downloading a file.
[12:45:08] <mattfullerton> I saw something about that funnily enough today when looking into what CKANs stated IE support is
[12:45:51] <nigelb> Adam and I spent weeks figuring out what's wrong. It didn't help that I don't have a windows box.
[12:46:28] <mattfullerton> OK, well now I know who to ask next time I have SSL woes.
[12:46:43] <nigelb> :)
[12:47:10] <mattfullerton> If you ever have windows things that need a quick look at, give me a shout. Im in your debt now ;-)
[12:47:19] <nigelb> :)
[12:50:34] <Manish_> can you please provide me how can i use email validation on custom field if its valid email then next otherwise it returns me an error
[12:50:36] <Manish_> http://stackoverflow.com/questions/27967020/how-can-i-define-custom-validator-in-ckan-2-2
[12:50:41] <Manish_> refrence url

2015-10-08

[07:26:17] <i-tu> ls
[07:26:43] <i-tu> (mistype, sorry about that)
[09:16:23] <mattfullerton> Good morning CKAN! I am pulling my hair out almost does anyone know off the top of their heads where resource_proxy would write a log error? Im getting 502 Bad Gateway/Connection refused from resource proxied items
[10:49:23] <rossjones> mattfullerton is it not logging to the ckan log?
[10:51:33] <mattfullerton> nothing :(
[10:51:44] <rossjones> which version?
[10:51:53] <mattfullerton> although by now I traced the problem to python sockets
[10:52:00] <rossjones> oh cool.
[10:52:01] <mattfullerton> requests, urllib etc can get those urls
[10:52:08] <mattfullerton> but sockets create_connection cannot
[10:52:22] <mattfullerton> the question is how to make sure sockets is aware of  the proxy server
[10:52:31] <mattfullerton> ive tried SOCKS_PROXY to no avail
[10:52:47] <mattfullerton> and unfortunately right now I have to run for lunch, but any tips appreciated!
[10:52:53] <rossjones> where is sockets.create_connection used?
[10:53:01] <rossjones> will catch you after lunch - it's more important ;)
[11:59:10] <mattfullerton> i dont know for sure if that is used, it was just a way of generating the same failure. Somewhere through googling the HTTPConnection Pool error lead me to the sockets package
[12:26:43] <rossjones> mattfullerton do you know what your proxy actually is?  Do you need to export HTTP_PROXY and https_proxy ?
[13:03:57] <mattfullerton> yes, yes and yes
[13:04:22] <mattfullerton> requests and urllib seem to use HTTP_PROXY
[13:27:40] <rossjones> mattfullerton if you were in the debugging mood, I'd check the env var is available in the virtualenv/apache wsgi env.
[13:52:56] <mattfullerton> its interesting you say that :) I noticed some odd behaviour there earlier in general should stuff from /etc/environment end up in the virtualenv or not?
[14:02:24] <wardi_> rossjones: meeting?
[14:03:27] <rossjones> Sure, one second.
[14:05:21] <mattfullerton> will you guys make a decision on recommended docker? :D
[14:05:33] <wardi_> amercader, brook, joet ^
[14:06:40] <wardi_> mattfullerton: I think a few of us are away, might need to wait to next week
[14:07:20] <mattfullerton> OK, cool, just sounded from the mails & github that it was something that needed an executive decision
[14:14:54] <mattfullerton> @rossjones, the reason it doesnt log anything in particular is clear: https://github.com/ckan/ckan/blob/fd2006509c1be0dee6bd9b1910d550fdb71e8426/ckanext/resourceproxy/controller.py
[14:16:44] <mattfullerton> And I suspect it isnt anything special with socket, just requests, and indeed probably a proxy config not getting through
[14:16:49] <mattfullerton> <debugging>
[14:20:19] <rossjones> mattfullerton could try SetEnv in your apache config to set the proxies.
[14:20:30] <rossjones> that should make it available to the wsgi process.
[14:21:30] <rossjones> Oh, actually I may be wrong about that.
[14:35:45] <mattfullerton> in any case I see they arent getting through
[14:35:48] <mattfullerton> the answer? https://gist.github.com/GrahamDumpleton/b380652b768e81a7f60c
[14:50:42] <travis-ci> ckan/ckan master a6256ac https://travis-ci.org/ckan/ckan/builds/84313232 Ross Jones: The build was broken.
[14:51:47] <mattfullerton> so the setting is actually os.environ[HTTP_PROXY] = http://server:port' in the files /etc/ckan/default/apache.wsgi and /etc/ckan/datapusher.wsgi
[16:24:42] <joet> so making authenticated api calls with the cookie as a logged in user, I seem to remember this wasn't an intentional side effect
[16:26:02] <joet> I want to make use of it by having a bunch of actions and api calls made in javascript without having to use the api key
[16:26:17] <joet> is this a "bad thing"?
[16:34:54] <joet> otherwise i'd need to find another way to pass the apikey around to the javascript, which sort of makes me queezy
[16:44:11] <Zharktas> passing apikey would be worse than just using cookies in js calls
[16:44:52] <joet> yeah i agree, i just don't want to start using it and then we all agree that it should be removed
[17:39:10] <wardi_> joet: that's going to have to keep working, but I might push for changing e.g. some of the defaults for what happens on user_show where the behaviour changes depending on the user. This would affect both apikey and cookie auth cases
[17:41:55] <wardi_> oh, for the cookie auth case we were talking about adding a required csrf token
[17:42:32] <joet> yeah I figured we'd basically have to keep it until someone adds a fancy json web token way of calling authenticating api calls or whatever is hip and cool
[17:42:43] <wardi_> that change will take a couple versions to transistion in I expect
[17:43:34] <joet> ...
[17:43:51] <wardi_> we need to deprecate the current behaviour first, don't you think?
[17:43:55] <joet> do we really throw a KeyError when an action is not found?
[17:44:50] <rossjones> normally it just 409s everything
[17:46:33] <joet> hum, wardi_ well now that I'm going to be depending on it, i'd rather not :p
[17:47:23] <wardi_> rather not have a version of ckan that optionally enforces the new more-secure calls?
[17:49:55] <joet> i thought you meant deprecating cookie auth altogether
[17:50:29] <rossjones> wardi_ I am thinking I might look at rq tomorrow, just to see if I can come up with something ... any preference for how the rqworker should be started? supervisor?
[17:51:41] <wardi_> no, cookie needs to work, we just need to add a token to make it safer. I'm saying we release a ckan version that optionally enforces the required token and deprecate that use, then then next version we always require the token along with a cookie
[17:52:35] <joet> ah yeah, that sounds good
[17:52:47] <wardi_> rossjones: no, that should be up to the user, right? Like datapusher, postgres, solr, redis..
[17:53:33] <rossjones> wardi_ sure, how about 'up to the user' but here's a sample supervisor conf/upstart script.
[17:53:49] <rossjones> I mean systemd
[17:53:59] <wardi_> that makes sense
[17:54:10] <rossjones> Cool. That's the easy bit done...

2015-10-07

[08:11:59] <yanik> how come i don't have responsive styles (css and html classes) in my local package install? if i copy style from ckan demo and add classes -- responsive appears
[08:12:17] <yanik> it's because i use 2.4?
[08:12:35] <yanik> and any chance i can grab them? :)
[08:13:05] <yanik> i mean responsive html (with classes) since i copy main.css from ckan demo :))
[08:29:25] <Zharktas> yanik: 2.4 is somewhat responsive, demo.ckan.org shows how much :p
[08:33:48] <yanik> yup, and it's weird. I just replace page.html from 2.4 trough the plugin and now i have responsive container
[08:33:56] <yanik> maybe i have <2.3 ;/
[08:35:42] <yanik> oh, im on 2.2.3 :(
[08:43:46] <Zharktas> initial responsive templates were implemented in 2.3
[13:50:59] <knud> Hi. I have two questions about custom dataset forms and tag vocabularies, as documented in http://docs.ckan.org/en/ckan-2.4.1/extensions/adding-custom-fields.html#tag-vocabularies
[13:51:47] <knud> 1. the fields that use the tags seem to contain an array, rather than a single value - is that intended?
[13:53:11] <Zharktas> knud: you can have multiple tags in single dataset
[13:53:18] <knud> 2. the fields are not included in the json output that is returned via the API (/api/rest/dataset/name-of-dataset).
[13:55:15] <knud> zharkatas: I understand that. What I want to do is a field (country-code in the example) that would be restricted to contain a value from a restricted vocabulary of terms (e.g., a list of country codes).
[13:55:50] <knud> So, in this case I wouldn't expect a list of values, but a single value.
[13:56:52] <knud> sorry, zharktas, not zharkatas
[13:57:02] <Zharktas> then you would need to replace the template and the validators
[13:58:03] <Zharktas> knud: for 2. you need to implement show_package_schema for it to be converted from extras field
[13:58:40] <Zharktas> and the rest api won't convert it :p
[13:59:21] <knud> well, the docs show nicely how to achieve the desired outcome for the dataset form (using an html select). There is no mention of the dataset view. I guess I could just do country_code[0], but that feels hackish.
[14:00:50] <knud> regarding the rest api: how would I include the field as part of the extras?
[14:09:12] <knud> or should I ignore the docs at http://docs.ckan.org/en/ckan-2.4.1/extensions/adding-custom-fields.html#tag-vocabularies, and instead write my own validators and use convert_to_extras/convert_from_extras to have the fields included in the extras?
[14:24:03] <knud> ok, I seem to get there by doing exactly that. Last question: did this work in previous versions of CKAN (1.8) by using tag vocabularies? It's what I did in a plugin some years ago, and it seems to have "just worked".

2015-10-06
[13:37:48] <yanik> i know i can add my styles from a plugin
[13:38:17] <yanik> but i want specifically have one compiled file
[13:48:45] <wardi_> joet: I think brook and amercader were working on that for a multilingual site, I'll see if they chime in on the list
[14:05:07] <i-tu> yanik: AFAIK, all the LESS including bootstrap is compiled into public/main.css so all you need to do is have your own ckan extension overriding main.css.
[20:04:54] <adambecker> Hi all  I don't imagine someone would be able to help me troubleshoot why I'm getting a 500 from demo.ckan.org? https://github.com/ckan/ckan/issues/2676
[20:05:27] <adambecker> Spinning something up locally so that I can see the logs, but of course ^^ would be easier :)

[00:17:22] <wardi_> joet: come back! I want to respond!
[10:35:49] <i-tu> I've changed a vendor js- file (bootstrap.min.js) but the change does not appear in CKAN. The bootstrap JS file is served at fanstatic/vendor/:version:2015-10-05T16:26:31.23/:bundle:bootstrap/js/bootstrap.min.js . How do I update the vendor fanstatic js files?
[10:38:39] <i-tu> I checked that the correct file is served at http://domain/base/vendor/bootstrap/js/bootstrap.min.js
[11:22:29] <wardi_> joet: TkTech had to force a commit to be able to call package_create from after_create https://github.com/open-data/ckanext-stcndm/commit/6829660df808dfbad1e5774fa3f7989304d55aaf#diff-1da639707198051f1733fcc2a9370dabR189
[11:22:54] <wardi_> I bet the same is required for package_update
[11:27:07] <joet> yeah looks useful
[11:27:41] <joet> i just need save another id from an external api that I wanted to call in package_create
[11:28:31] <joet> i sort of decided yesterday that I would just override the package_create action, as I couldn't manage adding the extra in after_create
[11:28:50] <wardi_> oh, you're modifying the same package?
[11:33:05] <wardi_> you could use a validator to insert the value into the extra field while it's being saved
[11:33:30] <wardi_> that keeps your business logic tied to that one dataset type
[11:35:25] <joet> i need the package_id first right?
[11:35:40] <joet> well i need the package_id, to send to an external api call
[11:35:55] <joet> this occurs after validation? unless i'm misreading you
[11:38:46] <joet> the other way is to create on the external api first and just force ckan to keep the same id
[11:39:21] <wardi_> you can create the package id early, but yes, normally it's created down in the dictization layer
[11:40:01] <wardi_> or getting the id from the external service would work too
[11:41:40] <wardi_> validation is the only thing stopping users from choosing package ids, your id validator could grab the id from the service and use that (assuming you trust the service not to give out duplicates, I don't trust my users that much)
[11:42:33] <joet> yeah, I was hoping I'd just be able to force the extra in after_create
[11:43:01] <wardi_> you probably can if you commit first
[11:43:52] <wardi_> lots of options!
[11:44:03] <joet> yeah, I knew i'd have to manually start messing with sqlalchemy objects myself so I was deliberating whether it was just better to wrap package_create using IActions
[11:44:21] <joet> it's probably most efficient to add the package extra manually in after_create
[11:44:35] <joet> there is a session.flush just before after create, so I have the package id already
[11:45:25] <joet> so i could just add a PackageExtra object to the session myself, but I wasn't sure if there was a cleaner way avoiding sqlalchemy.
[11:45:51] <wardi_> yes, the other two ways that involve setting the id early
[11:46:04] <joet> also, I'd have to add it to only the show schema afterwards as well so my extra shows up
[11:46:26] <joet> but i worried about how package_update would interact with it after, which is probably worrying about it too much
[11:47:11] <wardi_> if I was doing it I would make a validator on create and treat it like a regular extra on update/show
[11:48:12] <joet> a validator to insert the extra? you mean making the external api call in the validator?
[11:48:25] <wardi_> sure, why not?
[11:49:40] <joet> hadn't considered it, makes me feel uneasy on an initial thought
[11:50:12] <wardi_> is doing it in after_create any better?
[11:50:23] <joet> that is true
[11:50:56] <joet> it does mean I can use the validator to throw back any bad api calls  to the external service without having created a dataset on ckan
[11:51:05] <wardi_> you need your package id early, so use a validator like https://github.com/open-data/ckanext-canada/blob/494dc0744/ckanext/canada/navl_schema.py#L216-L223 on the id field in your create schema
[11:51:45] <joet> i'm mainly convinced as there is existing code :p
[11:52:08] <joet> where as I'd fear what would happen adding the packageextra object because screw vdm
[11:52:22] <wardi_> sure. no reason to change unless you want to add other dataset types that behave differently
[11:53:54] <wardi_> on another topic, what did we decide to use for the "standard" multilingual extras for title and notes? was it title_lang and notes_lang?
[11:56:11] <joet> I don't remember, i don't even remeber deciding to put them into different fields
[11:58:51] <joet> which goes to another topic, having looked at how reddit uses pylons/postgres, I came to the conclusion it would be worth considering having the dataset table as just 'id' column and 'data' jsonb column and everything is an extra into the 'data' column
[11:59:25] <joet> but i'm filing that under stuff that will never happen
[12:01:57] <wardi_> no, that's a crazy way to use postgres
[12:02:26] <joet> you should look at the reddit code
[12:02:35] <joet> they just use it as a massive key value store
[12:02:47] <joet> it's pretty crazy
[12:03:00] <wardi_> yeah, let's not go there
[12:04:29] <wardi_> rossjones: meeting?
[12:05:08] <yanik> rossjones, hi
[12:05:20] <yanik> and everybody :)
[12:06:55] <yanik> is this not common, to make custom templates for ckan? we try to use completely different structured templates and it's something like my worst nightmare
[12:06:57] <rossjones> agh, meeting - two ticks
[12:07:12] <rossjones> yanik, i'll grab you after call, just gimme a bit
[12:07:29] <yanik> thx bro :)
[12:08:02] <joet> yanik you're free to ask in the call if you'd like
[12:12:14] <yanik> don't bother) I'm ask too much anyway
[12:32:00] <rossjones> wardi_  http://apiserver-dev.cloudapp.net
[12:34:44] <rossjones> https://github.com/datagovuk/api_etl/blob/master/manifests/health.yml
[12:46:25] <rossjones> yanik - you had a question ...
[12:47:15] <rossjones> ah he's gone
[12:50:15] <yanik> just disconnected
[12:51:18] <rossjones> yanik cool, what was the question?
[12:51:36] <yanik> rossjones, what is the best practice if i need extend change alot of templates? maybe just copy all ckan templates to my folder and working on?
[12:52:02] <yanik> i start with completely different structure and it turn to be nightmare :)
[12:53:08] <yanik> i notice people only change colours, nobody mad enough to change templates itself
[12:53:10] <rossjones> How different is different?  In a perfect world most of your changes would be your templates overriding some of the jinja blocks.
[12:53:47] <rossjones> yanik here are our (data.gov.uk) templates -> https://github.com/datagovuk/ckanext-dgu/tree/master/ckanext/dgu/theme/templates
[12:53:57] <rossjones> we basically just override most of them.
[12:54:03] <yanik> yup, plugins do so, and it's nice, but i more changes
[12:54:22] <yanik> i have more changes
[12:54:47] <yanik> you guys are cool, but i don't have years of CKAN in my pocket :P
[12:55:09] <rossjones> yanik it's only jinja, right? pretty close to django templates.
[12:55:27] <rossjones> You can override the base.html and then replace whole templates if you want.
[12:55:36] <rossjones> You just need to know which actions renders which template.
[12:56:10] <yanik> i see, i know that, but its much work to do, that what i was afraid :)
[12:56:23] <yanik> and yes, it's not so hard, just many blocks
[12:56:45] <Zharktas> you actually can't help it if you have vastly different templates
[12:56:56] <Zharktas> some one has to implement them :p
[12:57:27] <rossjones> yanik if you are brave, and your customer isn't risk-averse, I've got something you might try ....
[12:58:44] <yanik> rossjones, thx for your time, mate
[12:58:48] <yanik> see ya
[13:36:25] <yanik> i promise
[13:37:14] <yanik> is it common to rewrite ckan less files and can i do it from plugin?
[13:37:36] <yanik> or i should rewrite ckan core lib

2015-10-05
[12:57:22] <amercader> wardi_: I'm feeling less and less enthusiastic about the approach we discussed for multiple platform tests on circleci
[12:57:51] <amercader> I got this far: https://gist.github.com/amercader/10a22094082fdb324cad
[12:58:39] <amercader> Supervisor is run just so the container is running I can `docker exec` things later
[13:01:10] <amercader> but now I need to make sure that postgres and solr run when the container is runnnig. I guess that the proper Docker way would be to have separate containers and link them to the main tests one. Or we could manage postgres and solr with supervisor, but I'd really like to avoid having to maintain too many custom scripts. Do you have any recommendation on this
[13:01:10] <amercader> front?
[13:01:45] <amercader> Also `docker exec` is not something that works great in circle ci: https://circleci.com/docs/docker#docker-exec
[13:38:39] <wardi_> so a single script run in the container might be the only way
[13:39:35] <wardi_> we do run our postgres and solr in separate containers, and we deal with postgres starting slowly with a dumb loop that retries until it can get a response to a query
[13:41:35] <wardi_> circleci's docker has given us some trouble too (redis container just doesn't work, we can't delete containers)
[13:43:07] <wardi_> the circle.yml you had that just runs the test in the container they give us was really nice and simple though. should we run ubuntu install tests separate from our normal test run?
[13:45:29] <amercader> my intention was to run the "normal" tests on both ubuntu 12.04 and 14.04 to make sure we cover both platforms
[13:46:58] <amercader> maybe that's overkill as long as we test with the proper requirements, but in any case using my circle.yml would be essentially moving from travis to circleci with no gain (apart from some speed). And losing the two iterations that we run now (python versions)
[13:47:45] <amercader> I'm not saying we shouldn't do it, but it's not the problem I was trying to solve in the first place :)
[13:58:20] <wardi_> amercader: true
[13:58:50] <wardi_> it might be even faster if the parallel nose magic stuff works
[13:59:01] <joet> amercader, are we still planning on building packages for 12.04 as well?
[13:59:02] <wardi_> though that's still not what you were trying to fix :-)
[13:59:18] <joet> i'll need to change build scripts to accomodate if we are
[14:00:24] <joet> 12.04 is supported till just about 2018, so i guess yes?
[14:00:53] <amercader> joet: definitely for some versions, so people that are currently using the packages have time to update
[14:01:47] <amercader> I was meaning to catch up with you about this but I'm signing off soon
[14:02:16] <amercader> We can do a mini packaging sprint in Brighton
[14:17:46] <wardi_> amercader: so what you have there but a script instead of exec commands and we pass $CIRCLE_BRANCH as a parameter
[14:22:09] <wardi_> you can mount the already-checked-out ckan directory into the containers with -V
[21:23:04] <joet> anyone ever tried calling package_update during IPackageController.after_create, or will I manually have to add an extra using create(pkg_object)
[21:23:22] <joet> ?

2015-10-04

2015-10-03

2015-10-02
[09:38:56] <amercader> wardi_: could you point me to some of your circleci docker conf to help me get started?
[09:39:25] <amercader> ups, too early in ottawa...
[09:42:19] <nigelb> heh
[11:03:49] <mih> Since we updated our ckan-instance, we have a blog-page included. Could someone explain for what it should be used please ?
[12:00:39] <amercader> mih: maybe you have ckanext-pages enabled? it has a blog feature. Otherwise this doesn't sound like core ckan
[12:14:41] <mih> oh yes, we have ckanext-pages enabled
[13:50:49] <wardi_> amercader: https://github.com/datacats/datacats/blob/master/circle.yml is how we test datacats against three versions of ckan, one in each container
[13:53:10] <wardi_> amercader: your test.sh equivalent would be use docker run ubuntu 12.04 | 14.04 with a script that installs ckan and its dependencies
[13:54:54] <wardi_> for cases where the dependencies haven't changed we can make tests way faster by publishing ubuntu 12.04 | 14.04 images that have all the dependencies pre-installed
[13:57:34] <wardi_> that's pretty much what the datacats/ckan images are https://hub.docker.com/r/datacats/ckan/tags/ (but for different versions of ckan, not ubuntu)
[14:17:26] <amercader> thanks wardi_
[14:18:40] <amercader> wardi_: so what you are suggesting is not building an image to run the tests, but use the default ubuntu 12/14 image and run a script that installs everything and runs the tests against it?
[14:19:12] <wardi_> amercader: we could do it either way
[14:20:02] <wardi_> we could have an image with the dependencies installed, then install the dependencies on it (which should be a no-op unless the dependencies have changed)
[14:20:59] <wardi_> that's simple and should be reliable and fast in the common cases
[14:23:08] <amercader> so we have ckan/ckan-tests-lucid, ckan/ckan-tests-trusty images built with postgres, solr and the python reqs.
[14:23:40] <amercader> and on each test run we reinstall the python reqs to make sure we catch the changes, is that what you mean
[14:23:41] <amercader> ?
[14:23:48] <wardi_> yes
[14:24:17] <wardi_> (also the ubuntu packaged dependencies)
[14:24:37] <amercader> yeah, basically everything we install on travis
[14:25:20] <amercader> I guess that to make sure that the base test images don't get too much out of sync we could rebuild them automatically from the requirements on master somehow
[14:25:48] <wardi_> amercader: they need to be tagged with the base release version I think
[14:25:56] <amercader> or enforce to rebuild them every time requirements change
[14:26:28] <amercader> ok
[14:27:03] <wardi_> then tag with a hash of the requirements or something?  I think just installing again from a base version not too far in the past will be simpler
[14:27:36] <amercader> yeah
[14:28:14] <amercader> cool, that was useful. I wasn't seeing how we could use the different containers on circle ci for different images as they seem to suggest that they are used just to parallelize the runs
[14:28:43] <amercader> I did setup the normal master tests for CKAN to see how fast they run by default: https://circleci.com/gh/amercader/ckan
[14:29:44] <wardi_> nice!
[14:29:46] <amercader> they do seem to run faster, basically because they cache the python reqs (which you can also do in travis)
[14:30:50] <amercader> and I didn't use the parallel thing
[14:32:29] <wardi_> so it will be slower than that including downloading our ckan-tests images, hopefully that will be cached too
[14:33:42] <amercader> the tests themselves take around 14 min, so that's the biggest part of it
[14:37:56] <wardi_> your circle.yml is nice and clean.
[14:39:52] <wardi_> I'm worried about that getting obfuscated in docker calls :-(
[15:29:57] <amercader> wardi_: yeah that's a worry, essentially we will spread our test environment on a Dockerfile somewhere and then on test.sh
[15:30:34] <amercader> I guess we can keep everything in the main repo somewhere
[15:31:16] <wardi_> amercader: it is possible to run one command at a time from the circle.yml
[15:31:27] <wardi_> e.g. with "docker exec ..."
[15:32:46] <wardi_> then there would just be one line at the top that chooses the image based on the node and the rest are prefixed with "docker exec"
[15:33:26] <wardi_> that will expose the failing command in circleci's interface much better, and give us the nice separate timing info
[15:34:28] <amercader> I see
[15:42:48] <wardi_> hmm. but the parallel option is on the command? maybe that doesn't work
[16:01:31] <amercader> wardi_: then I guess we need to wrap the whole thing in a single command:
[16:01:32] <amercader> case $CIRCLE_NODE_INDEX in 0) bash -x docker run ckan/tests-lucid ~/install-ckan-and-run-tests.sh ;; 1) bash -x docker run ckan/tests-trusty ~/install-ckan-and-run-tests.sh ;; esac:
[16:19:11] <wardi_> amercader: no, I just tried it, it does work we just need to add "parallel: true" to each command
[16:19:33] <wardi_> I'm going to switch my datacats tests to run that way now
[16:22:02] <amercader> Cool
[17:04:38] <wardi_> amercader: my circle.yml without the shell script: https://github.com/wardi/datacats/blob/parallel-yaml/circle.yml

2015-10-01

[05:43:22] <rossjones> nigelb morning, did you manage to find those logs?
[05:44:18] <nigelb> Never got the time to look.
[05:44:21] <nigelb> let me do that now.
[05:45:13] <nigelb> rossjones: I can see lots of error
[05:45:15] <nigelb> s
[05:45:25] <nigelb> if you can trigger one now, I can tail it and give you the error you're hitting
[05:49:47] <rossjones> there you go :)
[05:50:21] <rossjones> it's a resource_create call
[05:51:43] <nigelb> rossjones: KeyError: 'format'
[05:52:11] <rossjones> ah, is that required, thought it was optional.  will try
[05:52:52] <rossjones> Yeah, that fixed it. I guess we need to fit that so it doesn't 500 ... will create a ticket. thanks!
[05:53:17] <nigelb> rossjones: I have a feeling we did fix it.
[05:53:24] <nigelb> datahub is running an ancient version of ckan :)
[05:53:43] <rossjones> and demo ? ;)
[05:53:54] <nigelb> also probably old
[05:54:22] <nigelb> hrm, 2.4
[05:54:23] <nigelb> so yeah
[05:54:27] <nigelb> might want to file a bug :D
[05:58:55] <rossjones> Done!
[06:00:31] <rossjones> nigelb is there a stacktrace? I am thinking it's probably in datapusher
[06:02:07] <nigelb> there is
[06:02:10] <nigelb> one sec, pasting
[06:02:27] <rossjones> ta
[06:02:39] <nigelb> http://dpaste.com/01MSQPQ
[06:02:53] <nigelb> you seem to have given http://test as the url?
[06:09:03] <rossjones> Yeah, but datapusher shouldn't kill core ckan should it?  I think the format error must be elsewhere.
[06:09:34] <nigelb> I don't know anymore.
[06:09:41] <nigelb> I haven't touched ckan code in a while.
[06:12:13] <rossjones> Any other stack traces that are interesting?
[06:13:11] <nigelb> Now I get a NotFound
[06:13:44] <nigelb> http://dpaste.com/2PX6954
[06:15:25] <rossjones> That's a DCAT one, will add.
[06:17:38] <nigelb> aha
[06:19:53] <rossjones> The nice thing about stacktraces is they make for good starter-bugs I think, so worth adding tickets for them.
[06:36:27] <rossjones> nigelb should be fewer of those in future - https://github.com/ckan/ckanext-dcat/pull/41
[06:38:25] <nigelb> hurrah :)
[14:01:02] <wardi> rossjones: meeting?
[14:01:14] <rossjones> Sorry, not today
[14:11:30] <yanik> it is even possible to configure reverse proxy to serve couple ckan pages ( for example localhost:5000/datasets as localhost/datasets) in same time i have django app running on localhost (port 80)
[14:12:10] <yanik> have my head on this problem for weeks now :)
[14:19:39] <wardi> sure, what's serving django?
[14:21:33] <yanik> gunicorn + nginx, but for tests i have my usual python server
[14:23:08] <wardi> with nginx you can certainly proxy specific paths along, without a web server in front I don't know
[14:24:48] <yanik> so user even never reach django router, will be redirected and show ckan page?
[14:25:21] <wardi> proxied, not redirected, but yes
[14:25:49] <yanik> ok, i just should know it is possible, will dive in docs
[14:27:21] <yanik> wardi, thx
[18:08:43] <adsii1970> If someone is there, I need some help...
[18:10:39] <wardi> adsii1970: it's better to just ask your question :-)
[18:11:27] <adsii1970> Ok, am new to the whole github thing. Am trying to make a mod CKAN-able, and have done everything but upload the stuff to github
[18:11:49] <adsii1970> So my question is... how do I correctly set up github. All I have is an empty repository set.
[18:12:20] <wardi> what's your mod?
[18:13:28] <adsii1970> It's more like a flag set. I've been designing flags by request, so decided instead of sending individual file links, I would use CKAN. Eventually, I will have a new part too, but it is still in development.
[18:14:04] <adsii1970> So the "mod" essentially is a whole bunch of flags for now.
[18:14:18] <wardi> adsii1970: are we talking about the same ckan? does yours relate to kerbals?
[18:14:27] <adsii1970> Yes, it does...
[18:14:47] <adsii1970> And I just saw the notice... *NOT* related to Ckan....
[18:14:54] <wardi> this is the channel about ckan.org, not that ckan :-)
[18:15:15] <adsii1970> ah, well, this the one that was listed on CKAN's site... so sorry for the confusion...
[18:15:27] <wardi> oh, where?
[18:15:42] <adsii1970> Yeah, on their website...
[18:15:56] <wardi> please ask them to correct that :-)
[18:16:26] <adsii1970> https://github.com/KSP-CKAN/CKAN/wiki/New-Developers'-Guide
[18:17:14] <adsii1970> Well, let me depart here... have a great day...
[18:17:15] <wardi> this is #ckan on freenode, they're on a different IRC server
[20:42:18] <joet> bloody vdm

2015-09-30
[01:04:43] <travis-ci> wardi/ckan 2382-package-search-performance f1ff96f https://travis-ci.org/wardi/ckan/builds/82848389 Ian Ward: The build was broken.
[01:46:12] <travis-ci> wardi/ckan 2647-user-password-hash 85bbec4 https://travis-ci.org/wardi/ckan/builds/82851590 Ian Ward: The build has errored.
[08:30:06] <rossjones> nigelb do you get the errors from demo.ckan.org?
[08:30:44] <nigelb> er, it doesn't get emailed out.
[08:30:49] <nigelb> But I can dig it out, if you'd likle
[08:31:20] <rossjones> Lots of calls to resource_create failing, and no stack trace :(
[08:31:43] <rossjones> Also, I've had lots of organization_list_for_user timing out, but no idea why - maybe just a stray/apache process or something

2015-09-29
[12:02:39] <amercader> dev meeting: https://plus.google.com/hangouts/_/event/cb1vmkss426lkqicj94a3amvd1c?hl=en-GB&authuser=1
[13:15:48] <rossjones> wardi do you know if Denis is actually using ckanext-webhooks anywhere?
[13:21:36] <yanik> how come if i serve with paster on PUBLIC VIRTUAL IP (VIP) ADDRESS , ckan available locally, but not from Internet?
[13:21:51] <yanik> i have simple ubuntu 12.04 on Azure
[13:22:51] <yanik> i tried everything ;(
[13:38:07] <rossjones> yanik you're binding to an internet accessible address?>
[13:38:45] <rossjones> If it binds to 127.0.0.1 it means it will only be accessible to services on that machine.  You probably want either an external IP or 0.0.0.0
[13:38:55] <yanik> no-no
[13:39:06] <rossjones> oh-oh
[13:39:09] <rossjones> ?
[13:39:29] <yanik> i'm binding on PUBLIC VIRTUAL IP, put it in hosts variable on development setting file
[13:39:44] <rossjones> but that doesn't work?
[13:39:50] <yanik> yup
[13:40:08] <rossjones> just nothing, no errors, no connection attempts?
[13:40:15] <yanik> so it's not internet accessible, i guess, since i can easy get it locally
[13:40:54] <yanik> http://104.46.38.107
[13:41:06] <yanik> same on http://oasisvm1.cloudapp.net
[13:41:11] <rossjones> You use that IP in your .ini?
[13:41:25] <rossjones> Not that I think you should have paster directly accessible mind, but that's another issues
[13:41:43] <yanik> yup i use that IP on my ini as host
[13:41:52] <yanik> and as url
[13:42:00] <rossjones> and paster starts up fine...
[13:42:05] <yanik> yup
[13:42:21] <yanik> Starting server in PID 45729.
[13:42:21] <yanik> serving on http://100.112.72.96:5000
[13:42:21] <yanik> 2015-09-29 13:13:49,986 INFO  [ckan.lib.base]  / render time 1.337 second
[13:42:33] <yanik> the second one when i try access with httpie
[13:42:53] <yanik> i mean succcess connection
[13:43:04] <rossjones> Have you got port 5000 open in azure?
[13:43:23] <yanik> oh, i should? i will try
[13:43:33] <rossjones> :D
[13:43:56] <jabr> yanik: under Settings for the VM you'll have a Endpoints option.
[13:44:09] <yanik> my other team member create Azure for me, they all .NET developers and have one-button relese, so not really understand me :D
[13:44:14] <jabr> by default all ports are blocked
[13:44:20] <yanik> thx <3
[13:44:44] <rossjones> I actually like azure.
[13:45:07] <yanik> and what tool you use for deploy ckan?
[13:45:09] <jabr> it's gotten a lot better over the years
[13:45:11] <yanik> fabric script?
[13:45:32] <rossjones> I'm sure there's actually a CKAN Azure Image .,..
[13:46:23] <yanik> yup, but only 2.1
[13:47:09] <rossjones> Shame.
[14:00:25] <wardi> rossjones: ckanext-webhooks is being used on one site and it works, but I think we're moving to using https://github.com/datacats/ckanext-geopusher with celery in the future
[14:00:47] <rossjones> Ah okay.
[14:01:54] <wardi> webhooks didn't solve the general problem of letting anyone subscribe to anything, we were just using it as a way to launch certain jobs
[14:03:48] <wardi> it's kind of a hard problem. How do you restrict what requests users can make, and how to you handle slow responses (another thing we need celery for)
[14:04:23] <rossjones> wardi Yeah, I was thinking more of system extensions rather than user-driven webhooks, but I guess some things are still problematic.
[14:04:40] <rossjones> Slow reponses is the same for AMQP as for HTTP I would have thought - short timeouts ;)
[14:04:48] <wardi> so for us, if we have a queue anyway (something I was initially trying to get away from) we don't need webhooks anymore
[14:04:59] <rossjones> That makes a lot of sense.
[14:06:01] <wardi> I'd like celery+redis to be standard ckan components at some point, then extensions can just assume they're there for the jobs they have
[14:06:44] <rossjones> That would be nice - should do the same with deps as well - as in CKAN already includes requests, you don't need to include it too.
[15:31:51] <yanik> by default ckan search whole words only, any chance i can change this behaviour ?
[15:37:27] <rossjones> yanik you can change that, but it's all in solr config - it will dramatically increase the size of your index though./
[15:48:50] <yanik> rossjones, thank you, wood be nice have this note in docs thought
[15:49:44] <rossjones> yanik I guess so, PRs welcome when you've worked it out ;)
[15:50:06] <yanik> i can change the docs? great! :D
[15:51:20] <yanik> I also have one more major note for package install guide :)
[17:43:05] <TkTech> 1000th star on Github
[20:53:05] <amercader> woo! well done everybody!
[20:53:15] <amercader> thanks for flagging it TkTech
[21:08:44] <TkTech> :)

2015-09-28
[07:25:52] <jabr> Would it be possible to make a plugin that checks the request header for a given username parameter (set by secure reverse proxy) and based upon that log the appropriate ckan user in before loading a page? I'd like to avoid the login step.
[07:26:38] <jabr> I've got an IAuthenticator plugin doing the automatic login, but it requires that the user visits /user/login first.
[07:34:35] <nigelb> are you trying to setup something like a single-sign on?
[07:36:49] <jabr> yes. A very, very simple one.
[07:40:38] <rossjones> jabr the key thing to implement in IAuthenticator is the identify() method, which should set c.user to the username, and c.userobj to an instance of model.User
[07:40:46] <almalerik> Hi all, can someone help me? i modified the postgres package.metadata_modified with a different date but after that resource preview(datapush) return an error
[07:41:07] <rossjones> almalerik in raw sql?
[07:41:25] <rossjones> you also need to update package_revision where id='whatever' and current=True
[07:41:27] <almalerik> yes
[07:41:53] <almalerik> i'll try ... thanks
[07:43:26] <jabr> rossjones: yes, but that still requires users to visit /user/login in order to get logged in.
[07:43:43] <rossjones> jabr um, I didn't think so.
[07:44:32] <rossjones> jabr if you check out https://github.com/ckan/ckanext-persona/blob/master/ckanext/persona/plugin.py all the login call does it get or create a user, and then set some session vars.
[07:45:08] <rossjones> and then identify tells ckan which user it is by looking up user based on those session vars.
[07:45:44] <almalerik> thk #rossjones, you are right!
[07:46:15] <jabr> rossjones: i've been looking at the persona plugin. Mine is basically the same, but it requires a visit to /user/login in order to fire those actions.
[07:48:46] <rossjones> jabr if you check out https://github.com/ckan/ckan/blob/master/ckan/lib/base.py#L249 on line 267 it calls your plugin, the the method _identify() is called __before each controller action.  So I don't know why you think it *has* to call /usr/login
[07:49:07] <rossjones> jabr How are you passing the auth details from your proxy to CKAN?
[07:49:48] <jabr> as a header paramater like 'user-id': <username>
[07:50:21] <rossjones> So you could implement identify() to pull that header from the request and then model.User.get() the user model?
[07:50:43] <jabr> i actually only set c.user, not c.userobj
[07:50:51] <rossjones> jabr that should be okay as well.
[07:51:06] <rossjones> but better to set c.userobj
[07:52:27] <jabr> Here's my code http://dpaste.com/3Q31BYM
[07:55:19] <rossjones> jabr so ... identify is going to get called on *every* request, so you could do ... http://dpaste.com/13RNXCQ
[07:57:59] <rossjones> Does that make sense?
[07:59:21] <jabr> i tried it. It works.
[07:59:27] <rossjones> :D
[07:59:43] <jabr> And, yes, it makes sense. Because login only fires when visiting /user/login, right? :)
[07:59:48] <rossjones> correct.
[08:00:06] <jabr> Well, thank you very much. You made my day :)
[08:00:35] <rossjones> No problem!
[08:01:27] <rossjones> almalerik if you change stuff in sql (you really shouldn't, but I do too :( ) then you should always check if it has a *_revision table and make sure the current one is up to date.
[08:09:32] <almalerik> Thanks Ross, my mistake was not rebuild search-data ..... i know that is not a good change data from sql but i have to start a new ckan portal import data from a old site with some old data and we would like to have original creation data date
[08:18:04] <jabr> I glanced over model.user, but not sure. Is there a username equivalent to ckan.model.User.by_email(email)?
[08:37:46] <rossjones> jabr model.User.get() will look up either by name or ID.
[08:38:05] <rossjones> where name is the username.
[08:41:31] <jabr> rossjones: thanks :)
[08:41:46] <jabr> wasn't sure if name == username.
[10:11:40] <nigelb> rossjones: did you setup harvesting for datahub?
[10:16:32] <rossjones> nigelb maybe.
[10:16:44] <nigelb> rossjones: that just spammed me for the last few hours :)
[10:16:47] <nigelb> one mail per run :D
[10:16:52] <nigelb> I've silenced it with a >/dev/null 2>&1
[10:17:40] <rossjones> what? it emails people every harvester run ?
[10:17:44] <rossjones> omg. sorry.
[10:18:25] <nigelb> cron on okf servers email sysadmin if there's output :)
[10:19:22] <rossjones> urgh. sorry.
[10:19:25] <nigelb> no harm done
[10:19:29] <nigelb> other than me going WHOA
[10:19:32] <nigelb> when I logged in :D
[10:19:43] <rossjones> nigelb at least you may be able to close down any old existing ckan.net sites now - just harvest them onto datahub ;)
[11:02:50] <jabr> setting a form attr to disabled through the form macro makes ckan believe the field to be empty. Any way around that? The only alternative I see right now is form.hidden()
[11:04:02] <jabr> trying to override edit_user_form.html so that username and email fields are disabled.
[11:04:14] <jabr> might be a smarter way to go about this?
[11:15:31] <nigelb> rossjones: I closed down pretty much everything :D
[12:24:29] <rossjones> amercader is the new datahub going to be on 2.4 as well?
[12:25:07] <amercader> rossjones: yes
[12:25:22] <rossjones> Cool.

2015-09-27
[11:26:55] <nigelb> rossjones: Ow. Maybe you should spend your time automating the task.
[11:56:34] <yanik> i have weird error on production.ini, similar development.ini with debug=true is okay. https://gist.github.com/dudehaveadream/6f28207b051001735a6a
[11:59:07] <nigelb> yanik: who owns the /tmp/default folder?
[11:59:15] <nigelb> I suspect you ran paster as root at some point?
[11:59:27] <yanik> yup
[11:59:32] <nigelb> The easiest fix is to delete /tmp/default folder.
[11:59:52] <nigelb> and then start again. It'll clear the sessions, but I don't think it should be a problem on a dev server.
[12:00:25] <yanik> thx man, i should run paster without sudo, right?
[12:01:55] <nigelb> yes, preferably.
[12:02:22] <nigelb> You usually have no reason to run it as sudo (unless you want it on port 80 or some such)
[12:02:30] <nigelb> But if you want port 80, you shouldn't be using paster :)
[12:03:03] <yanik> ha, but now i have permission denied on dev :D
[12:03:21] <yanik> i ran both: develop and production, on different ports
[12:03:34] <nigelb> what ports?
[12:03:44] <nigelb> are you using different ini files?
[12:03:55] <yanik> yup
[12:04:15] <yanik> 80 on production ran by apache2, and usual 5000 on development
[12:04:31] <nigelb> do they both have the same site ID?
[12:04:46] <nigelb> ckan.site_id setting.
[12:05:01] <yanik> yes, should i change it?
[12:05:06] <nigelb> They need to be different, they're probably the same, based on what's going on.
[12:05:11] <nigelb> I'm surprised you haven't had other problems.
[12:05:14] <yanik> oh, ssame site ID gives same sessions
[12:05:25] <nigelb> with the same site ID means same solr index
[12:05:38] <yanik> i see, thx for help
[12:05:38] <nigelb> so if you delete something on dev, it'll be removed from search on prod as well.
[12:05:53] <nigelb> you're probably better off not sharing sessions :)
[12:06:07] <nigelb> It would be a security risk, I'd think.
[12:06:37] <yanik> anything else i should know about development and production settings difference? )
[12:07:02] <nigelb> yes, one sec, let me confirm that it's actually true.
[12:07:22] <nigelb> Use different storage_path
[12:07:32] <nigelb> and session.secret
[12:08:11] <yanik> and ckan.site_id is just some random string?
[12:08:25] <yanik> cause i notice simular path and folders
[12:09:18] <nigelb> er, no.
[12:09:35] <nigelb> ckan.site_id is what you name your instance. It's used for solr index and session storage
[12:09:42] <nigelb> I would recommend naming them perhaps dev and prod
[12:09:54] <nigelb> you'll have to reindex solr after making any changes, btw.
[12:11:28] <yanik> oh god
[12:21:38] <yanik> that broke whole my system :) anyway, now i understand CKAN a bit better, thx
[12:28:12] <nigelb> sorry!
[12:28:24] <nigelb> but once you get this done, it'll be less fragile and prone to easy breakage.

2015-09-26
[14:38:09] <rossjones> Spending my Saturday updating random ckan servers, maybe I should get a life or something
[17:45:52] <yanik> hi guys, what template file responsive for single dataset view?
[17:46:04] <yanik> naming is not obvious for me
[18:25:38] <yanik> it's package/read.html

2015-09-25
[06:17:24] <rossjones> wardi that CLA ticket at https://github.com/ckan/cla/issues/4 has reared its ugly head again on the Global User Group mailing list :(
[06:32:45] <nigelb> oh boy
[06:32:51] <nigelb> that was a nasty one
[06:51:11] <teemue> wardi: Hi, I tried to use ckanext-scheming to add a date field to a resource, but got "StatementError: datetime.datetime(2017, 1, 1, 0, 0) is not JSON serializable" error when setting a value for it. Date fields seem to work fine for datasets. Is there some difference in how they're handled?
[14:09:30] <wardi> teemue: sounds like a bug, please report it along with your schema on the chanext-scheming repo
[14:10:20] <wardi> rossjones: yes, I'm getting lots of notifications in my email again. what's new on the CLA front?
[14:10:33] <rossjones> wardi very little

2015-09-24
[14:20:01] <rossjones> oops did I miss the team call?
[14:20:02] <renancarvalho> guys, I'm following CKAN the site of the tutorial about ckanext-spatial, I did all part of installation, but I can not display the map on the page.
[14:20:09] <renancarvalho> https://ckanext-spatial.readthedocs.org/en/latest/install.html#ubuntu-12-04-postgresql-9-1-and-postgis-1-5
[14:20:22] <rossjones> renancarvalho do you get an error?
[14:23:37] <renancarvalho> no, I think I'm crashing it in the process, after I made the installation of ckanext-spatial think I do not know how to use it, how to display the information on the screen etc.
[14:23:39] <renancarvalho> rossjones: ^
[14:24:17] <renancarvalho> rossjones: the tutorial is not very clear
[14:24:39] <rossjones> after you've added the plugin to the ckan.plugins section of the .ini file, unless you are doing weird things in your own theme plugin, it should just show I think.
[14:25:21] <rossjones> You did this section -> https://ckanext-spatial.readthedocs.org/en/latest/install.html#configuration ?
[14:25:23] <rossjones> renancarvalho
[14:55:36] <i-tu> Hey all, I'm working on a new CKAN-project. We'd like to use Bootstrap 3, instead of the default Bootstrap 2.
[14:56:47] <i-tu> I've already gotten the CKAN 2.4.1 .less-files to compile against BS 3, and now we would work on the templates to bring them up to speed (incompatibilities like .span break the layout)
[14:58:50] <yanik> action/package_search API response is horrible
[15:00:35] <yanik> it's hard to make /dataset page analog, with that kind of API response structure >:)
[15:01:12] <i-tu> Does anyone have any experiences of using BS3 with CKAN? I noticed data.gov.uk has bs3 at least in some .css-file
[15:05:30] <rossjones> i-tu everything about data.gov.uk is custom and half still on genshi.  might be best to work from ckan core ... there is a ticket - https://github.com/ckan/ckan/issues/2602
[15:10:18] <OJ_Simpson> When using the spatial harvester, when I run the gather_consumer command, I get a connection error that does not seem anything to do with the URL that I give the source. Does anybody know of a fix for this?
[15:11:36] <rossjones> OJ_Simpson can you paste the connection error into a gist, or pastebin, and any logging output ?
[15:12:36] <OJ_Simpson> http://pastebin.com/vX2BcD6z
[15:12:43] <OJ_Simpson> there is no error logged
[15:12:51] <OJ_Simpson> (That I can find anyway)
[15:14:40] <i-tu> rossjones: one concern is that if ckan moves on to bootstrap 3, we will have to do extra work on the frontend later
[15:15:15] <rossjones> OJ_Simpson is your queue running?
[15:15:49] <rossjones> i-tu it may affect lots of people, best raise any issues on that ticket, I'm not really sure about front-end stuff.
[15:15:59] <rossjones> OJ_Simpson Could not connect: Connection refused
[15:18:11] <OJ_Simpson> rossjones: what queue?
[15:18:41] <rossjones> the queue it connects to to get jobs ...
[15:19:01] <rossjones> https://github.com/ckan/ckanext-harvest#installation
[15:23:17] <OJ_Simpson> how would I find out?
[15:24:17] <OJ_Simpson> I think I have it, thank you
[16:43:48] <rossjones> OJ_Simpson great.
[16:44:22] <renancarvalho> guys
[16:44:28] <renancarvalho> i have a error
[16:45:01] <renancarvalho> when i will install Shapely get error that geo_config use -- libs
[16:45:15] <renancarvalho> and Shapely use clibs
[16:45:22] <renancarvalho> someone get this error ?
[16:45:46] <rossjones> why does that rings a bell.
[16:46:39] <rossjones> Does it say ... ValueError: Usage: geos-config [OPTIONS]
[16:46:44] <rossjones> can you pastebin it?
[16:51:53] <renancarvalho> rossjones: http://pastebin.com/TNWR6TTF
[16:52:41] <rossjones> http://stackoverflow.com/a/30926558
[16:53:07] <rossjones> not exactly the same error, but likely cause.
[16:55:38] <rossjones> renancarvalho and there was this discussion at https://lists.okfn.org/pipermail/ckan-dev/2015-September/009268.html as well - but I think it looks like dependency hell :(
[17:34:02] <renancarvalho> and this error VDM only works with SQLAlchemy versions 0.4 through 0.8, not: 1.0.8
[18:59:16] <renancarvalho> have some demo server of ckan with feature of geolocation ?
[19:01:01] <renancarvalho> i need test the funcionality to undertand how it work
[19:01:16] <renancarvalho> rossjones: you know ?
[19:04:58] <renancarvalho> argh
[19:05:21] <renancarvalho> not need install extension spatial to add information with geolocation
[19:05:32] <renancarvalho> he recognize automatic
[19:05:42] <renancarvalho> hsheet
[19:05:59] <renancarvalho> i lost a big time with this
[20:42:00] <novastohsu> Hi all.
[20:42:47] <novastohsu> Question for ya'. For relationships created via the api (`ckan.action.package_relationship_create`) -- are there any UI elements that are updated to show relationships?
[20:42:56] <novastohsu> If not -- what's the purpose/design of package relationships?
[20:45:26] <wardi> novastohsu: the ui wasn't built but some users have built their own. there's a recent ticket about this
[20:46:48] * novastohsu takes a look
[20:46:54] <wardi> https://github.com/ckan/ckan/pull/2625 and an older one https://github.com/ckan/ckan/issues/1406
[20:48:01] <novastohsu> Oh -- okay, I gotcha.
[20:48:06] <novastohsu> Thanks for pointing me in the right direction!
[21:04:59] <novastohsu> Hm. Another question -- are there any best practices for making "related datasets"?
[21:05:23] <novastohsu> I'm going through the spec (https://github.com/ckan/ckan/wiki/Spec:-Related-Items) and it's hard to determine if there's a pattern for associating datasets/packages through the UI.
[21:05:40] <novastohsu> (/cc @wardi)
[21:06:59] <wardi> novastohsu: there's package relationships and then there's loosely relating them with extra fields. either way you need to customize the UI to show those relationships the way you want
[21:07:25] <novastohsu> Ok, thanks!

2015-09-23
[08:16:03] <rossjones> New NASA open data portal - yay. Based on Socrata - boo :( https://data.nasa.gov/data
[09:06:37] <yanik> i lost paster command for runung ckan via development.ini, please share :) google don't help me
[09:08:00] <rossjones> paster serve --reload  # I think this defaults to looking for development.ini
[09:08:02] <rossjones> or
[09:08:13] <rossjones> paster serve /path/to/development.ini --reload
[09:08:26] <rossjones> yanik ^
[09:09:48] <yanik> thx, rosslones, I knew I can rely on you :)
[09:14:30] <rossjones> good heavens, don't do that!
[09:18:21] <rd_> hi there, someone know lexvo project?
[13:21:37] <yanik> Any suggestion why ./bin/less resturn: "Command failed: NameError: #grid > .core > .span is undefined in /usr/lib/ckan/default/src/ckan/ckan/public/base/vendor/bootstrap/less/navbar.less on line 199," error
[13:24:25] <yanik> Tried to switch to debug=true again, on clean CKAN instance
[13:28:18] <Roux_taff> hi there
[13:28:27] <Roux_taff> was wondering if you had some inputs on http://dataverse.org/
[13:29:11] <Roux_taff> some research colleagues want to use an instance of this to release their datasets and I was wondering whether it made sense or I should counter-advise them to use ckan
[13:30:27] <rossjones> looks very much like socrata
[13:31:04] <nigelb> looking at a ckan bug is very similar - http://devopsreactions.tumblr.com/post/129204653568/looking-at-a-simple-bug
[13:58:36] <yanik> you cant cange templates while debug=true, it is because ckanext package installed as develop?
[13:58:50] <yanik> debug=false*
[14:56:55] <rossjones> Roux_taff you might try asking the people at http://data.bris.ac.uk/data/ for their experience.
[14:57:25] <rossjones> yanik I haven't experienced that, normally changes show for me.
[15:44:53] <wardi> rossjones: do you know what http://beta.ons.gov.uk/ is built on?
[15:46:29] <rossjones> It's a single page angular app I think, with a static version - backend is custom afaik
[15:46:34] <rossjones> it's pretty nice
[15:46:55] <wardi> is it open source?
[15:47:35] <rossjones> Was just wondering that, I'm not sure.
[15:48:00] <rossjones> If you're on twitter, you might ask @jukesie
[15:49:27] <DragonDave> Or on https://www.reddit.com/r/dataisbeautiful/comments/3m23zj/hi_everyone_were_matt_jukes_and_rob_fry_from_the/ :P
[15:49:42] <wardi> yeah, that's where I found it :-)
[15:50:04] <DragonDave> ahhh :)
[15:50:39] <DragonDave> https://github.com/ONSdigital/florence I think it might be
[15:51:16] <rossjones> JAVA!
[15:51:17] <wardi> hmm. Mar4 and no forks
[15:51:28] <rossjones> I think they're busy hiring atm
[15:52:06] <rossjones> DragonDave are you sure it's not https://github.com/ONSdigital/babbage ?
[15:52:33] <DragonDave> might be
[15:52:41] <DragonDave> florence is looking a bit frontendy
[15:53:24] <DragonDave> babbage is 4 months without an update, though, and says alpha
[15:53:56] <DragonDave> [florence is 7 without, mind]
[15:55:02] <rossjones> DragonDave branches are being updated.
[15:55:11] <DragonDave> :cool
[15:55:16] <rossjones> babbage -> Updated 7 minutes ago
[15:55:49] <rossjones> https://github.com/ONSdigital/florence/blob/master/src/test/java/com/github/onsdigital/api/DataIT.java
[15:55:50] <DragonDave> ah, and they've got a "live" version :)
[16:00:23] <rossjones> What is it you were hoping to investigate wardi ?
[16:01:08] <wardi> just curious what they've used and if any of the viz stuff could be reused
[18:36:24] <user1_> Can CKAN integrate with an existing AD domain?
[18:58:32] <corebits> user1_: you can look at ckanext-ldap, works for auth against an AD domain
[19:12:19] <user1_> Thank you for that. How does CKAN handle version controlling and managing permissions?
[19:17:11] <corebits> user1_: have you reviewed the authorization documentation, http://ckan.readthedocs.org/en/latest/maintaining/authorization.html
[19:21:11] <user1_> that is very helpful. thank you
[19:22:18] <user1_> what about provenance/auditing support?
[19:38:52] <wardi> user1_: all the revisions to dataset metadata are tracked and available through a web interface, is that what you mean?
[19:42:22] <user1_> yea like generating reports which would include storing of author, creation date, most recent editor and updated date
[19:43:18] <user1_> what is the ckan default integrated security is like?
[19:43:24] <wardi> I'm not aware of existing reports, but the data is there and an API available to pull it out
[19:49:11] <user1_> what is the ckan default integrated security is like?

2015-09-22
[18:24:34] <wardi> TkTech: https://github.com/KSP-CKAN/CKAN
[18:24:56] <TkTech> That's hilarious
[18:25:28] <Zharktas> they're just whoring google results for ckan metadata :p
[18:25:42] <TkTech> Next-level SEO
[18:25:53] <wardi> https://github.com/ckan/ckan/issues?q=is%3Aissue+label%3A%22wrong+CKAN%22
[18:28:59] <TkTech> Hah, that must get annoying after awhile.
[18:35:01] <wardi> I started tagging them because it seemed like we were getting a lot, but only 10 over a few months isn't terrible
[18:37:15] <wardi> we get confused with c-kan less often, but he does skew the google trends numbers

[06:50:30] <jabr> Hi, I'm having this issue: https://github.com/ckan/ckan/issues/2255 But I'm not good with Docker. Tried to "rebuild" solr image, but no fix. May have done it wrong.
[08:53:58] <nigelb> rossjones: http://buytaert.net/always-be-shippable
[08:54:10] <nigelb> As this release's release manager, I thought you'd find that inspiring :D
[08:55:03] <rossjones> nigelb you're shipping the next release? that's awesome
[08:55:24] <rossjones> Also, did I break something? I mean recently
[08:58:43] <nigelb> rossjones: I thought you were :D
[08:58:46] <nigelb> I haven't looked.
[08:58:53] <rossjones> First I've heard ;)
[08:59:19] <rossjones> I think dread is doing it again, with someone from Aus shadowing..
[11:04:57] <OJ> Hi guys,
[11:04:57] <OJ> I am looking to extract data from CKAN in the ISO-19115 format, so that it can be passed on to another system. I have tried a few solutions which have come to no avail and I just wondered if anybody can suggest something that may be of help to me.
[11:04:57] <OJ> I also have a question at StackOverflow: http://stackoverflow.com/questions/32715038/harvesting-from-thredds-or-ckan-using-geonetwork.
[13:05:41] <travis-ci> ckan/ckan 2636-fix-encoding-create-ext 6296d88 https://travis-ci.org/ckan/ckan/builds/81576963 Ian Ward: The build was broken.
[13:08:14] <OJ> An updated link to my recent Stack Overflow link: http://stackoverflow.com/questions/32717718/publishing-ckan-data-in-an-iso-19115-format
[13:33:15] <rossjones> wardi joet brook Started https://github.com/ckan/ckan/wiki/Flaskification to keep track of the problems.
[13:34:09] <wardi> rossjones: cool!
[13:34:14] <brook> thumb_emoji.gif
[13:35:11] <rossjones> To quote my daughter: It's gonna be a mare!
[13:35:16] <rossjones> I've no idea what that actually means.
[13:52:50] <wardi> the python routes module we're using is 3.x compatible (at least the latest version is)
[13:57:46] <wardi> hmm. guess that doesn't help.
[14:01:39] <wardi> rossjones: these aren't problems if we're just trying to implement the action api on flask, right?
[14:13:33] <rossjones> sorry, brb, solr has just dropped ALL our datasets :(
[14:26:04] <kalxas> rossjones, wardi is there a decision about moving to flask?
[14:26:35] <rossjones> kalxas we'd like to seems to be the general concensus - we're just trying to work out how much it'll hurt
[14:27:55] <kalxas> I guess porting pylons to python3 would hurt much more...
[14:27:58] <wardi> If we're not rewriting the front end, maybe pyramid will hurt less than flask
[14:28:12] <rossjones> def clear(package_reference=None) <--- this just ruined my day :(
[14:28:25] <rossjones> wardi no swearing please.
[14:28:32] <wardi> given the routing and g conflicts
[14:28:34] <wardi> hehe
[14:28:58] <rossjones> going from a framework nobody uses to a framework nobody uses seems unwise.
[14:29:23] <wardi> yep
[14:29:30] <kalxas> rossjones, +1
[14:30:20] <kalxas> indeed, few people seem to use pyramid these days
[14:30:39] <kalxas> in the geospatial world, mapfish was never ported to pyramid and left to die
[14:34:07] <rossjones> kalxas I think the problem is finding funding for any of this work, nobody wants to pay for it.
[14:38:04] <rossjones> Turns out I wiped the solr index :(
[14:38:53] <wardi> backport that progress counter and at least you get something to watch while it rebuilds
[14:39:02] <rossjones> hehehe
[14:39:09] <rossjones> takes a couple of hours :(
[14:49:23] <rossjones> we could just stay on pylons on py 2 until py2 is no longer supported as well :)
[14:51:02] <wardi> then rewrite in node.js?
[14:52:02] <rossjones> it's the future.
[14:52:45] <rossjones> But seriously, I'm all out of ideas how we can maintain perfect backward compat without just staying where we are.
[14:53:11] <wardi> shims and more shims
[14:53:45] <rossjones> We could up with a worse mess than we started with.
[14:53:49] <wardi> tell people not to use the things that will break and provide things that won't when we switch later
[14:53:52] <rossjones> s/could/will/
[14:53:57] <kalxas> "maintain perfect backward compat" does not exist :)
[14:54:25] <rossjones> I think the best we can do is "here are a list of things that WILL break, please fix em".
[14:56:37] <TkTech> Nothing wrong with breaking changes on a major release. Keeps the fellow devs employed.
[14:56:44] <wardi> I think targetting the action api only makes sense. The front end is going to be broken by the move to bootstrap 3 regardless
[14:57:59] <wardi> how about ckanext3-foobarbaz for the next iteration of extensions
[14:59:01] <wardi> (or ckan 4 for flask if bootstrap 3 lands sooner)
[15:08:48] <rossjones> would be nice to not have to have all the pages redesigned though, and workflow and things.
[15:09:08] <rossjones> and tests ..
[15:09:54] <wardi> do they need to be redesigned? can we just not use g.stuff any more and switch all the routes to flask's routing?
[15:10:12] <rossjones> Sure, but would be reasonably big-bang.
[15:10:26] <rossjones> unrelated - do PRs to CKAN *have* to have a corresponding ticket?
[15:10:58] <wardi> rossjones: I turn my issues into PRs so I don't have two numbers to deal with
[15:11:07] <wardi> it's kind of terrible, but it works
[15:11:08] <rossjones> how?
[15:11:19] <wardi> hub pull-request -i (issue number)
[15:11:34] <rossjones> hub?
[15:11:48] <wardi> some github wrapper for the git command
[15:11:55] <rossjones> cool... will take a look
[15:12:16] <wardi> also lets you do things like "hub remote add rossjones" without the full url
[15:12:24] <rossjones> ah that's nice.
[15:12:32] <rossjones> So ... who is going to create the CKAN3 repo?
[15:12:58] <wardi> not a branch?
[15:13:11] <rossjones> could do, will get very messy I think.
[15:13:26] <wardi> we're alread there
[15:13:32] <rossjones> :D
[15:13:50] <rossjones> would be nice to have a repo that has a flask app, the logic layer and associated code, and nothing else :)
[15:14:12] <wardi> how would we merge fixes into it though
[15:16:48] <rossjones> well, i was hoping everyone would stop working on 2 and dive onto 3 ;)
[15:18:01] <wardi> I can imagine my clients joy when I tell them I need a year or two to get back to the functionality they already have
[15:18:11] <rossjones> :D
[15:21:07] <rossjones> I think that's part of the reason nobody wants to fund it.
[15:31:20] <wardi> *that* approach, sure. can we write some shims that emulate the flask way of doing things instead of a third way? That would let us delete them eventually
[15:31:44] <rossjones> I think there's little choice really.
[15:34:29] <rossjones> It's just eventually is a very long time ;)
[15:47:31] <wardi> are flask's g and pylon's app_globals fundamentally different somehow?
[15:50:07] <wardi> I'm trying to understand how https://github.com/ckan/ckan/wiki/Flaskification#flask-g end result 2 might be bad
[15:51:31] <OJ> Does anybody know of a way to produce ISO 19115 formatted files from CKAN instances?
[16:07:56] <wardi> OJ: more work has been done on importing than exporting I think, but there is some recent work in, ckanext-spatial?
[16:12:07] <plaguewolf> hmmm
[16:12:33] <plaguewolf> any recommendations for mono on linux? i keep getting freezes when installing after downloads
[16:13:00] * wardi directs plaguewolf to the /topic
[16:13:37] <plaguewolf> whoops
[16:13:38] <plaguewolf> lol
[16:14:38] <wardi> OJ: adding a template to render xml from datasets the way you want it is pretty easy though
[16:15:10] <wardi> there's a better way I'm forgetting, though. amercader would be the one to ask when he gets back
[16:22:54] <rossjones> wardi adding the globals to g is fine. Unless they depend on pylons in some way :)
[16:23:04] <kalxas> OJ, you mean something like this? http://labs.geodata.gov.gr/dataset/city-blocks-kalamaria (Metadata -> Download As)
[16:25:03] <OJ> kalxas: yes thats right
[16:25:35] <OJ> kalxas: is that GeoNetwork?
[16:25:49] <kalxas> no, pycsw integrated into CKAN
[16:25:56] <kalxas> checkout https://github.com/PublicaMundi/ckanext-publicamundi
[16:27:48] <OJ> kalxas: Ah yes I have already had a look at that. I have just emailed somebody from PublicaMundi as I had problems with the setup of it, I will wait to hear back from him also
[16:28:06] <kalxas> I got your e-mail and already responded ;)
[18:23:13] <TkTech> wardi, Why do people think #ckan is related to KSP?

2015-09-21
[12:26:22] <Manish_> How can i add custom validation on extra fields in plugin.py ?
[12:27:20] <Manish_> i have added field such as "domain" i want to put custom validation which is special characters are not allowed using plugin? any one can help me on this
[13:18:45] <wardi> Manish_: the tutorial covers IDatasetForm plugins, or you might consider using ckanext-scheming to add your custom validator
[14:57:19] <mona_> hi
[14:57:36] <mona_> Anybody there for support?
[14:59:37] <DragonDave> I'd ask the question and see if anyone bites -- different people know different things.
[15:06:39] <wardi> mona_: also, please hang around to wait, some of us pop in and out time permitting
[15:06:59] <wardi> wait for an answer I mean
[15:07:55] <mona_> Our company is doing a small research on  a Data and  Content Management System that can be integrated with ArcGis server
[15:08:45] <mona_> and have a few questions in terms of features and technical questions with regards to the same
[15:33:47] <joet> don't ask to ask!
[15:33:51] <joet> oh wait he's gone already
[15:45:38] <joet> wardi was it you who was talking about refacotring resource_update to not be implemented using package_update last week?
[15:48:11] <wardi> joet: yes
[15:49:04] <wardi> rossjones and I
[15:49:12] * DragonDave discovers
[15:50:04] <joet> would it be a huge amount of work? I just bump into occasionally and think, "oh crap its in terms of package_update"
[15:50:21] <wardi> joet: I don't think so, no
[15:51:07] <rossjones> joet are you volunteering? ;)
[15:51:13] <wardi> I was the original cause of resource_update calling package_update because I have schemas that need information from the dataset to validate the resources
[15:51:45] <wardi> but I would be fine with just doing the validation across the dataset, then saving the dataset and updating just the one resource
[15:52:44] <joet> rossjones,  it would make my life easier
[15:53:04] <rossjones> Mine too.
[15:53:06] <rossjones> :D
[15:53:55] <rossjones> Also, I was thinking of adding etags to resource_download() tonight, based on the hash - this would also make my life easier :)
[15:54:25] <rossjones> In fact, I'd like etags everywhere .. ;)
[16:16:41] <mona> Our company is doing a small research on  a Data and  Content Management System that can be integrated with ArcGis server and have a few questions in terms of features and technical questions with regards to the same
[16:31:31] <wardi> mona: what are your questions?
[16:34:11] <mona> Does the software support integration with ArcGis server
[16:34:12] <mona> ?
[16:35:20] <mona> Does it provide feature like search engine with indexing capability, cataloging  capability, version controlling, support provenance (auditing)
[16:35:37] <mona> Can the software integrate with an existing AD domain?
[18:04:46] <rossjones> mona I think the answer to most of your questions is Yes - except for "Does it support integration with ArcGis?" which I'm not sure what you mean
[18:14:09] <mona> we have lot of geo-spatial data coming from ArcGis servers that we need to manage
[18:14:45] <mona> so we are looking for something that we can support integration with ArcGis and geospatial artifacts
[18:20:40] <rossjones> mona you can harvest it all into CKAN using https://github.com/ckan/ckanext-spatial but beyond bringing it into CKAN I'm not sure.
[18:21:05] <rossjones> You might get a more useful answer on the mailing list
[18:25:08] <mona> Ah ok..  think I did post the same quesitons here http://ckan.org/contact/
[18:27:56] <mona> do you know what search engine do you use on the back end?
[18:35:22] <rossjones> mona Solr
[18:36:13] <rossjones> That URL is just for contacting OKF Services I think, rather than CKAN users generally - the users list is at https://groups.google.com/forum/#!forum/ckan-global-user-group
[18:36:32] <mona> oh ok, I will use that
[18:37:04] <mona> and you said 'yes' for, software can integrate with an existing AD domain?
[18:37:46] <mona> Doe sit support Access control over content? Can pieces/sections of content be assigned to specific users or groups of users with varying levels of privilege? E.g. make some folders public for read-only access, allow new content only from certain sets of users, allow overwriting content only for certain other sets of users
[18:39:18] <rossjones> Folders don't really make sense in CKAN, it works with Organizations/Teams/Groups, that own Datasets, that each contain several resources.  Permission is given based on your role in the organization that owns the dataset - if you are an editor or admin you can modify datasets.
[18:39:45] <rossjones> But I think one of the joys of CKAN is that it is pretty flexible and with extensions you can change nearly everything.
[18:41:16] <rossjones> You can find lots of extensions at http://extensions.ckan.org - by searching for geo, or active directory for instance
[18:53:24] <mona> that link helps, thanks
[18:54:33] <mona> will you be able to provide me software's implementation/technology architecture
[19:38:55] <renancarvalho> hello, i have a problem with instalation of geospatial in ckan
[19:39:11] <renancarvalho> i follow the tutorial https://ckanext-spatial.readthedocs.org/en/latest/install.html
[19:39:44] <renancarvalho> but i don't know how i do show in view page to input data in dataset with geolocations

2015-09-20

2015-09-19
[07:27:01] <Manish_> How can i call helper method  h.method_name() function using jquery in jinja template <a  onclick = {{ h.method_name() }} > event ?
[07:28:39] <Manish_> I need to call helper function on  onclick event using jquery in jinja template
[07:29:10] <Manish_> Any one can help me on this
[09:17:49] <Manish__> how to call helper function in jquery in ckan ?
[09:18:00] <Manish__> is this possbile in ckan
[09:18:10] <Manish__> anyone can help me on this

2015-09-18
[08:44:37] <rstolt> How would I approach a CKAN extension / plugin which has to store data (i.e. validation results) in a seperate database? Does CKAN provide there something for plugin authors or do I have to resort to own database handling via for example psycopg?
[09:59:21] <rossjones> rstolt might be worth seeing how the tracking middleware does it ( https://github.com/ckan/ckan/blob/master/ckan/config/middleware.py#L330 ) - it creates its own session for writing to the DB.
[12:39:16] <yanik> can you suggest code samples where templates are modificated?
[12:51:18] <rossjones> yanik try ckanext-persona! (also there are two PRs for you to try ;) ).
[13:00:29] <yanik> rossjones, thank you for dat PRs, just lay my hands on it ;)
[13:00:51] <rossjones> yanik did you install with git clone ?
[13:02:44] <yanik> somehow it is not possible for me
[13:02:53] <yanik> so my fork and clone after
[13:03:00] <yanik> i fork*
[13:05:30] <yanik> i must finish my prototype until Monday, maybe i can finish some TODOs on this package, since CKAN core too big for me right now
[13:05:51] <yanik> i must finish my prototype until Monday, maybe i can finish some TODOs on this package later, since CKAN core too big for me right now
[13:09:22] <rossjones> yanik TODOs are always good.
[13:43:49] <wardi> rstolt: logging validation failures is a wishlist item for one of my clients (they have users that don't know how to API and want to see their failures in a web interface)
[13:55:05] <rstolt> wardi: We might put it on GitHub (though it validates not against the CKAN schema) in the future.
[14:00:20] <wardi> rstolt: can you do it in two parts? if the json-schema validation is done as normal ckan validation then the logging of validation errors would be generic and reusable
[14:01:02] <wardi> you also only want logging for api users, right?
[14:03:50] <rstolt> wardi: You mean so log entries can be associated to API users?
[14:04:23] <rstolt> wardi: Current use case is for portal owner only.
[14:06:00] <wardi> no, I mean you don't want to log validation errors that happen in the form
[14:07:34] <rstolt> wardi: No, I only want to log violations against a JSON schema.
[14:08:29] <rstolt> wardi: And this should happen on every creation or modification.
[14:09:35] <rstolt> wardi: Therefore covering API + harvesting + web UI
[14:09:55] <rstolt> wardi: I guess ;P
[14:21:02] <rstolt> wardi: But there will be an web interface to see the violations, but that's gonna be a Java portlet using the gathered violations from the CKAN plugin.
[14:25:12] <wardi> rstolt: ok, wouldn't fit my use :-)
[14:25:55] <rossjones> wardi if you write it, we'll definitely use it ;)
[14:33:58] <wardi> rossjones: do you also have users that can't API?
[14:34:46] <rossjones> By can't API do you mean don't use it - yes, plenty ;)
[14:35:40] <wardi> (these are users that make us provide endpoints SpelledLikeThis and withParametersLikeThis because "that's the only thing java supports")
[14:35:51] <Manish> in ckan is there any option to get user rating for dataset ?
[14:36:04] <rossjones> Manish No. Still no. Nobody has added it yet.
[14:36:54] <rossjones> wardi what do you think about fixing https://github.com/ckan/ckan/blob/master/ckan/logic/action/update.py#L108 so that it doesn't package_update each time? Makes using resource_update with several resources in the same package a nightmare
[14:37:15] <wardi> rossjones: in my case I mean they can call an api but they can't read errors returned for themselves, they just tell us it's broken if their data isn't accepted
[14:37:35] <rossjones> wardi no, never get any like that, but I think most users are harvesters.
[14:38:30] <Manish> so instead of rating do we able to provide like or unlike functionality like facebook ? where number of like is shown under dataset details page
[14:38:47] <wardi> rossjones: I was the cause of resource_update calling package_update because IDatasetForm operates on a whole dataset and some validators could behave differently if they don't have access to the whole dataset
[14:39:13] <wardi> I'm sure we can make it smarter so it does less work
[14:39:57] <wardi> i.e do the validation on the whole datset but only apply changes done to the resource being updated
[14:40:20] <rossjones> Was just reading http://stackoverflow.com/questions/32649012/ckan-unintentional-additional-datapusher-jobs-being-triggered-on-resource-update and reminded me of the pains I've had using resource_update with lots of resources on same dataset (until I switched to package_show/update).
[14:40:48] <wardi> I think it's fair to say validation that changes something in the dataset or other resources doesn't have to work
[14:41:50] <rossjones> There's no use-case for resource validation relying on package info is there?
[14:42:04] <wardi> I have some, yes
[14:42:35] <wardi> some file type uploads are only allowed with certain dataset types is one
[14:42:58] <rossjones> Ah right. :(
[14:43:17] <wardi> but that should be cheap: we have the whole package dict in solr
[14:44:20] <wardi> hmm. I actually also have a need to update a dataset field when a resource changes.
[14:44:57] <rossjones> yeah, it's really the package_update that's the pain, not necessarily the package_show.
[14:45:07] <wardi> I need to mark the dataset for re-approval for publishing..
[14:45:19] <wardi> so, how about just avoiding updating other resources on resource_update?
[14:45:51] <wardi> (but continue to allow updating the dataset and the one resource)
[14:49:41] <rossjones> That might work.
[14:49:58] <rossjones> I have a horrible feeling that we have so many things hanging off package updates though, I need to check.
[14:50:10] <rossjones> like triggering QA.
[14:52:44] <wardi> if we pull the inside parts of package_update out into functions resource_update can call, we could speed it up quite a bit, I'm sure
[14:53:27] <wardi> how does our action magic work again? does it ignore _prefixed functions?
[14:57:23] <rossjones> I *think* so.
[14:58:02] <rossjones> Yes - https://github.com/ckan/ckan/blob/master/ckan/logic/__init__.py#L360
[14:59:25] <wardi> yeah, there's that charming function
[15:00:26] <rossjones> not forgetting the best bit - https://github.com/ckan/ckan/blob/master/ckan/logic/__init__.py#L396
[15:01:54] <wardi> yeah.
[15:02:16] <wardi> it's a noble goal.. but.. yeah
[15:06:51] <rossjones> It's on my hit-list.
[15:08:08] <rossjones> Right. StackOverflow. I;m going in. If I don't make the next tech team meeting, I'm still looking at the [ckan] tag...

2015-09-17

[00:30:05] * TOPIC: The open source platform for open data: datahub.io & ckan.org | *NOT* related to Kerbal Space Program | Meeting info and notes: https://github.com/ckan/ckan/wiki/Dev-Meeting-Notes | This channel is logged https://botbot.me/freenode/ckan/
[05:52:08] <Manish_> {% block package_metadata_fields_frontend_app %} 		{% set tag_values =  h.gettag_list() %} 		{{ tag_values }} 		{% set frontend_app_attrs = {'data-module': 'autocomplete', 'data-module-tags': '', 'data-module-source': tag_values } %} 		{{ form.input('frontend_app', id='field-frontend_app', label=_('Frontend App'), placeholder=_('eg. Frontend app'), value=data.frontend_app, error=errors.frontend_app, classes=['control-full'], attrs=fro
[05:53:18] <Manish_> and my tag_value look like this : {'ResultSet': {'Result': [{'vocabulary_id': u'f29e336e-963d-434d-b507-f90e18127060', 'display_name': u'domain', 'id': u'b7b5c180-1b23-4562-9f57-4620f9483c52', 'name': u'domain'}, {'vocabulary_id': u'f29e336e-963d-434d-b507-f90e18127060', 'display_name': u'frontendapp', 'id': u'd35805ae-829c-4b39-82e8-800caa39f590', 'name': u'frontendapp'}}}
[05:54:33] <Manish_> i want to show resultset :  result : name : such as domain at the time of keypressing in jinja template
[05:55:31] <Manish_> any one can help me to get this value as a suggestion for field value
[06:40:59] <rossjones> hey Manish_.  please don't post big chunks of code in IRC, best to use pastebin or gist.github.com ...
[06:56:59] <rossjones> Manish_ you might find http://docs.ckan.org/en/latest/theming/index.html useful ...
[08:47:29] <rstolt> Is there a way to hook into CKAN API actions (i.e. /api/3/action/package_create), or better said overwrite them?
[08:48:00] <rstolt> My current use case / requirement is to take the POSTed JSON dataset, validate it against a JSON schema (https://raw.githubusercontent.com/fraunhoferfokus/ogd-metadata/master/OGPD_JSON_Schema.json) and transform it into a CKAN compliant dataset.
[08:51:48] <rossjones> rstolt what about IDomainObjectNotification?
[08:51:55] <rossjones> oh maybe not.
[08:53:59] <rstolt> rossjones: I guess IDomainObjectNotification fires a tad to late, as I understand it.
[08:54:00] <rossjones> rstolt I am not sure that http://docs.ckan.org/en/latest/extensions/plugin-interfaces.html#ckan.plugins.interfaces.IActions will allow you to overwrite package_create - but if it does you could overwrite with one that does the conversion and then calls the original?
[08:56:12] <rstolt> rossjones: Worth a try :)
[09:41:08] <rossjones> rstolt which portal are you working on?
[09:42:06] <rstolt> rossjones: https://www.govdata.de
[09:42:26] <rossjones> Oh, nice, didn't know that existing!
[09:43:01] <rossjones> what;'s it currently running on? I noticed jsessionid in the URL :(
[10:26:39] <rstolt> rossjones: Portal runs on Java (Liferay)
[10:26:47] * rossjones shivers
[11:42:34] <wardi> IActions does let you override actions, that doesn't make it a good idea :-)
[11:43:20] <wardi> if you're transforming some other format maybe add a new action, or write what you need as a harvester or an import script?
[11:43:59] <wardi> You can do what you describe with IDatasetForm.validate (you can do almost anything there to transform the data both going in and coming out)
[11:44:33] <wardi> rstolt: what do you want to happen if the json schema validation fails? should the dataset be accepted regardless?
[12:02:07] <rstolt> wardi: For the import (POST) via API the actual import should be rejected when invalid, when it's valid it should be transformed into the CKAN schema (in our case it needs to be done for the three properties / fields groups, tags and extras because this is where the two schemas clash).
[12:03:30] <rstolt> wardi: So IDatasetForm.validate also engages with API actions (i.e, create)?
[12:06:06] <wardi> rstolt: yes, it's called from create, update and show
[12:07:27] <wardi> for update/create it can return validation errors for any fields passed (e.g. from the json schema validator)
[12:09:19] <rstolt> wardi: Ok will give it a spin, Ta for the feedback :)
[12:09:21] <wardi> this was pretty much the exact use case I was thinking of when I added that method to the interface. I just happend to need it for ckanext-scheming because I needed to swap in a schema based on the dataset type
[12:10:21] <wardi> I recommend you do your validation and conversion, then pass your data_dict to toolkit.navl_validate so the core schema still gets used
[12:15:59] <rstolt> wardi: Is there also a property or something the like to determine if the create is triggered via an API call or the CKAN UI (dataset edit)?
[12:16:22] <wardi> sounds like you should make a different action
[12:17:03] <wardi> yes, there is a way to check if it was called from the api, but having different behaviour in that case is pretty terrible
[12:17:18] <rstolt> So a different action == API endpoint?
[12:17:20] <wardi> actions are nice because they're simple and mostly behave the same way everywhere
[12:17:26] <wardi> rstolt: yes
[12:18:05] <wardi> I really dislike when features are hidden from the api and only avaiable from the UI
[12:18:32] <rstolt> wardi: Are there some custom action examples in the CKAN examples folder?
[12:20:17] <wardi> not simple ones, but the IActions interface is just a get_actions() method that returns a dict of string->functions. ckanext/datapusher includes some
[13:11:55] <travis-ci> wardi/ckan 2647-user-password-hash d35ec41 https://travis-ci.org/wardi/ckan/builds/80821003 Ian Ward: The build was broken.
[13:34:44] <travis-ci> wardi/ckan 2647-user-password-hash aa59743 https://travis-ci.org/wardi/ckan/builds/80824339 Ian Ward: The build was broken.
[14:05:24] <brook> https://github.com/okfn/ckanext-panama/blob/multilingual-groups/ckanext/panama/plugin.py
[18:13:19] <travis-ci> wardi/ckan 2647-user-password-hash 46ec988 https://travis-ci.org/wardi/ckan/builds/80873711 Ian Ward: The build was broken.

2015-09-16
[18:14:10] <rehunted> hello, someone can help me debug an error on datapusher OR ckanserviceprovider
[18:14:14] <rehunted> IDK where it is yet.
[18:14:38] <rehunted> I have a docker configured CKAN: my images are here: https://github.com/eokoe/appcivico-ckan-comovamos
[18:15:47] <wardi> rehunted: datapusher is a challenge with docker because it need bidirectional communication with your ckan
[18:15:49] <rehunted> if anyone want to reproduce the error. I have datapusher working fine, but when I open /dataset/eaz/resource_data/625b4790-ad29-4817-9998-eb8f736199f4
[18:16:04] <rehunted> wardi, yeah, I know that, and I have it working
[18:16:26] <rehunted> my error now is, I get " Error: cannot connect to datapusher " on the screen, but when I look at
[18:17:03] <rehunted> database "datastore", its ok, all processed fine. and when I look for job_id and job_key for ask for the status, I got error from datapusher, but the error came from ckanserviceprovider
[18:17:08] <rehunted> just a second
[18:18:31] <rehunted> https://gist.github.com/renatocron/5047db6e19e1d45075d1
[18:18:40] <rehunted> all description in order there ^
[18:19:01] <rehunted> the odd is, when I do: curl http://datapusher:8800/job/d675f9d5-803c-46b5-a689-11bc3f29faae -H 'Authorization: cbbc8c0d-3711-4232-bcf3-b7f9913f510d'
[18:19:19] <rehunted> and those values are ok, I get an error from dist-packages/ckanserviceprovider/web.py
[18:19:56] <rehunted> even if I remove -H the error continues. it only stop if I change to a non-existing jo
[18:19:57] <rehunted> job*
[18:20:11] <wardi> Manish: in debug mode it seems every single .js file is included at the bottom of the page, with debug=false a giant minified link is included
[18:20:17] <Manish> also i want to rise one important point on ckan api for tag_show while i am trying { id : 'tag_name' } as data_dist its not working it only works with tag id but in api clearly mentioned we can use both id and name as id parameters
[18:21:57] <Manish> @wardi so that mean i can use autocomplete function also in my js
[18:22:04] <Manish> let me try
[18:22:19] <Manish> Thanks wardi for your help
[18:25:51] <rossjones> rehunted What flask version are you using? Also flask-login - it's not pinned as a version in the setup.py so it may have changed ...
[18:26:58] <rehunted> I had an image (from cache) working, that was building a month ago, but I lost that. rossjones I will try to look for this
[18:27:04] <Manish> http://docs.ckan.org/en/ckan-2.2/api.html#ckan.logic.action.get.tag_show please correct this api if anyone can
[18:27:10] * rehunted not a python person
[18:27:43] <rossjones> rehunted it looks like flask-login has is_authenticated in some cases, and is_authenticated() in others ... :(
[18:27:57] <rehunted> on flask init __version__ = '0.10.1'
[18:28:14] <rehunted> dist-packages/flask/__init__.py *
[18:28:22] <rossjones> and flask-login?
[18:29:30] <rossjones> Does anyone know if ckan-service-provider is used anywhere other than datapusher?
[18:29:45] <rehunted> https://gist.github.com/renatocron/1fa4c5fdaf3553c6e462 do you known what file is it?
[18:29:57] <rossjones> dist-packages/Flask_Login-0.3.0
[18:30:15] <rossjones> Looks like the most current version, trying to find a machine where I have it working so I can check ... two-ticks
[18:30:23] <rehunted> So I think it is not installed
[18:30:37] <rehunted> rossjones, okay, thank you
[18:31:32] * rehunted should I do an virtualenv in some place? the Dockerfile install and init it, but none place run 'activate'.
[18:32:12] <rossjones> I've no idea on the docker setup and whether it uses virtualenv :(
[18:32:24] <rehunted> it looks pretty simple
[18:32:24] <rossjones> if from the terminal you do
[18:32:25] <rossjones> python
[18:32:27] <rossjones> import flask
[18:32:31] <rossjones> and it breaks, then yes.
[18:33:14] <rehunted> it just install some python* https://gist.github.com/renatocron/039403e9e7edc3852287 and then run virtualenv on a dir, and use pip to install deps
[18:33:27] <rehunted> then, apache is who run the script
[18:34:04] <rehunted> rossjones, I did that, and import run fine.
[18:34:06] <rossjones> https://github.com/GovLab/noi2/issues/7 looks promising
[18:34:55] <rehunted> well, let me build again with "Flask-Login==0.2.11" on reqs.txt
[18:35:10] <rehunted> Flask itself is not on .txt
[18:35:18] <rossjones> it's in setup.,py I think
[18:35:22] <rehunted> I've downloaded version 0.0.6 btw
[18:36:06] <rehunted> maybe this packages=find_packages(exclude=['doc', 'tests*']),
[18:36:09] <rehunted> look for Imports?
[18:36:10] <rossjones> It's still not pinned in master for ckan-service-provider ... :(
[18:36:20] <rossjones> rehunted it's on https://github.com/ckan/ckan-service-provider/blob/master/setup.py#L55
[18:36:23] <rehunted> or Requests have it as deps
[18:36:43] <rehunted> hmm, mine setup.py does not have this
[18:36:54] <rossjones> 8|
[18:36:59] <rehunted> # https://packaging.python.org/en/latest/technical.html#install-requires-vs-requirements-files
[18:36:59] <rehunted> install_requires=[],
[18:37:03] <rehunted> maybe be that!
[18:37:09] * rehunted pulling tarball from master
[18:37:30] * rehunted or should I just add those to .txt
[18:37:57] <rossjones> rehunted this is probably just a version nightmare, you're running a modern ckan?
[18:38:48] <rehunted> 2.3.1
[18:39:05] <rehunted> but the datapusher machine is aside.
[18:39:16] <rehunted> tho, I tested against 2.4 too
[18:39:40] <rehunted> But I trace the error until can reproduce it with curl, so, is not ckan-itself
[18:39:46] <rossjones> right, so datapusher 0.6 requires ckanserviceprovider==0.0.3 in the requirements file.
[18:40:06] <rehunted> rossjones, btw, on 2.4 I can't make organizations dataset count working, that's why I'm using 2.3.1
[18:40:20] <rossjones> ckanserviceprovider==0.0.3 requires an old version of flask, and any version of flask_login (which has been updated 2 days ago).
[18:40:43] <rehunted> rossjones, oh, sorry, now I get it. the setup.py is from ckanserviceprovider==0.0.3, not datapusher
[18:40:47] <rehunted> hmm
[18:40:48] <rossjones> tyup.
[18:41:09] <rossjones> Maybe just try forcing flask-login==0.2.11 to install.
[18:41:18] <rehunted> but I should exists a dir /usr/local/lib/python2.7/dist-packages/flask_login then?
[18:41:28] <rossjones> pip uninstall flask-login
[18:41:33] <rossjones> pip install flask-login==0.2.11
[18:41:59] <pkmniako> Hi
[18:42:04] <rehunted> Uninstalling Flask-Login:
[18:42:05] <rehunted> /usr/local/lib/python2.7/dist-packages/Flask_Login-0.3.0.egg-info
[18:42:05] <rehunted> /usr/local/lib/python2.7/dist-packages/flask_login.py
[18:42:05] <rehunted> /usr/local/lib/python2.7/dist-packages/flask_login.pyc
[18:42:47] <pkmniako> I'm havig problems making my Kerbalstuff mod into CKAN
[18:42:51] <pkmniako> having*
[18:43:24] <rehunted> rossjones, doing that, but I killed the container ! Need do this on Dockerfile
[18:43:44] <rehunted> because the main process is datapusher/main.py, not apache or supervisor!
[18:45:20] <rossjones> pkmniako wrong CKAN ... this is for github.com/ckan/ckan ....
[18:45:49] <rossjones> Can someone change the channel title to tell people there are no Kerbals here please?
[18:45:56] <rossjones> nigelb? ^^
[18:46:13] <rossjones> rehunted lemme know if it works for you and I'll send a PR to the service-provider ...
[18:47:28] <rossjones> switching languages is messing with my brain.
[18:48:48] <rehunted> rossjones, how make pip non-interative ?
[18:48:51] <rehunted> -r ?
[18:49:03] * rossjones shrugs
[18:49:06] <rossjones> one second
[18:49:16] <rossjones> -q
[18:49:18] <rossjones> for quiet
[18:49:19] <rehunted> heehe no
[18:49:21] <rehunted> -r is for
[18:49:24] <rehunted> requirements
[18:49:26] <rehunted> okay
[18:49:54] <rehunted> I guess I will ned | yes
[18:50:06] <rossjones> probably
[18:50:12] <rehunted> -y
[18:50:20] <rehunted> workerd fine I guess =D
[18:50:37] <rehunted> build complete, turning up
[18:51:00] <rehunted> ah!
[18:51:06] <rehunted> rossjones, it worked!
[18:51:15] <rossjones> great and dammit, both at the same time :)
[18:51:23] <rossjones> tests are failing, so this is good.
[18:51:53] <rehunted> hahaha
[18:51:56] <rehunted> greate!
[18:52:12] <rossjones> I'll send that PR in a minute and ask someone to review at the team meeting in the morning.
[18:52:59] <rehunted> okay! /me fixing in the dockerfile itself for now
[18:55:09] <rossjones> Tests are broken for entirely different reasons :)
[18:55:17] <rossjones> Yak shave time!
[19:21:25] <rossjones> rehunted PR in, it'll probably stop anyone deploying datapusher (since Monday) so hopefully it'll go in soon.

[07:40:18] <Manish__> is there any way to add user rating in ckan where user can put his rating on dataset ?
[08:07:52] <rstolt> As I currently understand the dataset validation it's very fine granular (like in field / key based), can I replace it with a single JSON schema validation? As I also have to add extra fields holding the validation state with the dataset I guess IDatasetForm is the way to go / implement it in?
[08:13:18] <rossjones> rstolt yes, IDatasetForm should help with that.
[08:13:33] <rossjones> Manish__ You will have to write an extension to do it.
[08:22:37] <Manish__> i have write an extension but cannot see 5 star on UI where user can rate on dataset. could you provide me any refrance of that
[08:27:56] <rossjones> Manish__ do you provide a template? Can you point me to the repo?
[08:28:52] <Manish__> sure
[08:29:38] <Manish__> and yes i want user to put his rating for dataset from dataset detail page also to let you know i am using odp_theme template for the same
[08:30:18] <Manish__> but as i have gone through with CKAN documentation it shows me rating is hidden we need to enable it
[08:34:34] <rossjones> Manish__ I thought the rating was based on the tracking information, the number of times it had been viewed - rather than user ratings.
[08:34:58] <rossjones> Regardless your problem will be the templates if everything is configured properly.
[08:35:59] <rossjones> You will either have to modify the odp_theme, or provide you own theme extension to override the relevant parts and include the ratings.
[08:37:46] <Manish__> ok
[08:38:16] <rstolt> rossjones: So can I implement the validation against a JSON schema in IDatasetForm.validate which will differ from the CKAN schema format (I guess)?
[08:39:08] <rossjones> rstolt or you could just use ckanext-scheming?
[08:40:10] <rossjones> Hmm, IDataset form may be tricky if you want to replace all of the validation.
[08:41:18] <rossjones> i.e. you can override the schema, but it is still going to check each key/value and run the validation functions at that granularity - https://github.com/open-data/ckanext-scheming should allow you to work around that.
[08:43:47] <rossjones> I think I'd rather have ckanext-schema or something very, very like it as the default validation/schema ... would involve less code for a start :)
[08:45:38] <rstolt> rossjones: I guess another approach would be to use the IPackageController interface and do an update on the invalid datasets after the actual validation? Do I have access to the datasets in it's after_create and after_update methods?
[08:47:28] <rossjones> You get the package in create, and after_create gets the context and data - https://github.com/ckan/ckan/blob/master/ckan/logic/action/create.py#L201
[08:48:15] <rossjones> the data you get in after_create is the post-validation dict.
[08:50:56] <rossjones> I'm not 100% sure why after_create is called straight after create
[08:51:11] <rstolt> rossjones: Can I disable the CKAN validation? So package equals dataset? And the data going into after_create also equals the created dataset?
[08:53:44] <rossjones> rstolt I don't think disabling it is possible, I might be wrong - wardi would know for sure.
[08:55:57] <Manish__> hi rossjones : do we show all database  tags in suggestion list while creating dataset on metafields ?
[08:56:35] <rossjones> Manish__ I have no idea, I'm sorry. What are you seeing?
[08:58:06] <rossjones> rstolt you could monkey patch https://github.com/ckan/ckan/blob/master/ckan/lib/navl/dictization_functions.py#L222 but I wouldn't recomment it.
[08:58:15] <rossjones> s/recomment/recommend/
[08:58:47] <rossjones> rstolt is there something about ckanext-scheming that wouldn't work for your use-case?
[08:58:56] <Manish__> see i have tags in my database which i have instered in database those tags would come appear as a suggestion while user type any other tag in metafields to provide him that we have those tags already in database
[09:01:02] <rstolt> rossjones: I guess the only problem would be to transfrom an existing JSON Schema (https://github.com/fraunhoferfokus/ogd-metadata/blob/master/OGPD_JSON_Schema.json) to yet another schema, or does it support existing JSON schemas out of the box?
[09:02:28] <rstolt> rossjones: So our use case is to validate all incoming datasets, validate them store thes validation results in a database and add the validation state as an extra field to the dataset.
[09:02:54] <rstolt> s/validate them/
[09:03:05] <rossjones> scheming looks a little different - https://github.com/open-data/ckanext-scheming/blob/master/ckanext/scheming/ckan_dataset.json
[09:04:25] <rstolt> rossjones: Also don't the validation rules in them, or are them mapped to CKAN validators?
[09:04:34] <rstolt> + see
[09:06:42] <Zharktas> in that example thei are in preset file https://github.com/open-data/ckanext-scheming/blob/master/ckanext/scheming/presets.json
[09:17:22] <yanik> hi rossjones, you on https://github.com/ckan/ckan/issues/2630 ?
[09:17:38] <rossjones> yanik I am assigned to it yes.
[09:17:53] <rossjones> In a team meeting today, so unlikely to get near it until tomorrow.
[09:18:37] <rstolt> At which point would I then be able to collect the validation results and process them further?
[09:23:08] <yanik> rossjones, just wondering, no raw :)
[12:12:49] <wardi> rstolt: you can completely override validation in recent ckans
[12:14:32] <wardi> rstolt: http://docs.ckan.org/en/latest/extensions/plugin-interfaces.html#ckan.plugins.interfaces.IDatasetForm.validate lets you do thing like replace ckan's validators with JSON schema
[12:16:15] <wardi> you just need to be able to move the data you want to save into some place that will be saved by the models, typically as extra fields
[12:17:22] <wardi> that kind of thing change won't be easy, because if your validation doesn't store the core fields the way ckan expects, other ckan code will start to fail
[12:17:30] <wardi> s/thing//
[12:18:55] <wardi> ckanext-scheming assumes you're ok with using ckan validators (which are a little weird) and the "normal" way of extending datasets
[12:21:10] <wardi> rstolt: your definition of validation sounds different than ckan's. for ckan when something doesn't validate it won't be stored, the validation errors are sent back to the caller
[15:15:34] <rstolt> wardi: Ta for your input, got it working :)
[15:25:48] <wardi> rstolt: validation based on json schema?
[15:27:45] <rstolt> wardi: yup (that is the incoming dataset on actions *package_update* and *package_create*)
[15:36:17] <wardi> great!
[17:20:51] <Manish> is this possible to add jquery library in ckan jinja template ?
[17:21:32] <rossjones> Manish what have you tried?
[17:22:39] <Manish> i want to use autocomplete external library on my metafield
[17:25:20] <Manish> i am get { result : ['tag1', 'tag2',...] } from my plugin on my template which is package_metadata_fields.html i want to give this data as suggestion for user while user type any keyword in input field
[17:26:03] <Manish> so is this possible to add jquery autocomplete library with this data to provide them as a suggestion
[17:27:04] <Manish> that we have those tags in our system if you want to use then you can use these tags else you can add other then that i store addition tags in my database
[17:27:51] <Manish> https://github.com/manishjakhodecdn/extrafield/blob/master/ckanext/extrafields/templates/package/snippets/package_metadata_fields.html#L68
[17:28:20] <Manish> this is the url where i want user can see suggestion of those tags
[17:29:28] <Manish> and this is plugin method where we are getting list of tags : https://github.com/manishjakhodecdn/extrafield/blob/master/ckanext/extrafields/plugin.py#L183
[17:30:13] <Manish> i have also used template helper and its method https://github.com/manishjakhodecdn/extrafield/blob/master/ckanext/extrafields/plugin.py#L232
[17:30:42] <Manish> rossjones can you please help me on this
[17:32:53] <rossjones> Manish You should look at how the other autocompletes work.  For instance, there is an autocomplete for tags in /dataset/new when you are creating a dataset.
[17:33:49] <Manish> yes but those are free tags i want to use my system tags which i have already in my database
[17:36:19] <rossjones> I don't mean use the current tags lookup, just see how it's done - it uses JS to query a controller to get results.  If you are just trying to provide a fixed list in the template you might consider using a helper function and ITemplateHelpers - http://docs.ckan.org/en/latest/extensions/plugin-interfaces.html#ckan.plugins.interfaces.ITemplateHelpers
[17:42:45] <Manish> yes thats what i have used in my case. and i am getting response from get_helper function { result : ['tag1', 'tag2',...] } on my template but when i am using {{ h.gettag_list() }} data-module-source data is not appearing in as a suggestion
[17:45:18] <Manish> so i want to use jquery library in ckan template where i can parse my response which comes form get_helper function so i can get those data tags as a suggestion while i type anything in meta field
[17:54:58] <wardi> Manish: you can edit a template to include resources, but I know there is fanstatic way of declaring the resource your page needs, somehow
[17:59:16] <Manish> @wardi : that mean can i custom js under fanstatic public directory and make my data as a global javascript variable so i can get variable in whole template
[17:59:58] <Manish> and then parse id of input to perform autocomplete this data as a suggestion list on template
[18:06:25] <wardi> there ought to be a clue here http://docs.ckan.org/en/latest/contributing/frontend/index.html
[18:07:14] <wardi> is all JS combined, minified and served to every page?
[18:10:02] <Manish> i don't think so because if its in combined then i can use jquery function on my template i guess
[18:11:17] <Manish> for that i guess we do need to add npm external modules
[18:12:09] <Manish> but i am that much sure

2015-09-15
[06:11:34] <Manish_> Hello rossjones
[06:12:20] <Manish_> is there any possible way to create vocabulary in ckan which can be created through other users as well except Sysadmin
[09:07:48] <travis-ci> pmlrsg/ckan master 8cb1006 https://travis-ci.org/pmlrsg/ckan/builds/80392414 root: The build was broken.
[10:03:07] <travis-ci> pmlrsg/ckan master 14e4c86 https://travis-ci.org/pmlrsg/ckan/builds/80401281 root: The build was broken.
[10:20:49] <travis-ci> pmlrsg/ckan master ebc0548 https://travis-ci.org/pmlrsg/ckan/builds/80399696 root: The build was broken.
[10:34:00] <rossjones> Is it normal we get other people's broken builds in IRC?
[10:41:44] <Manish_> how to enable user to rate on dataset using 5 star rating
[10:42:00] <Manish_> how to show 5 star rating in ckan
[10:52:19] <rossjones> It's tuesday, so that means me asking whether call is in 9 minutes or in an hours time.
[10:52:20] <rossjones> ?
[10:55:24] <bac_1> rossjones: that'll be us, sorry - I'll take the line out of the travis.yml file
[10:55:43] <rossjones> bac_1 no worries, was just confused :)
[10:57:37] <OJ> This will be the last one:
[10:59:26] <wardi> rossjones: it's an hour i think
[11:06:51] <rossjones> wardi cool, Steven's going to pop along to chat about the meeting/call he's set up.
[12:27:29] <rossjones> wardi https://github.com/datapressio/solr-agent shows how to construct the solr urls for creating/deleting cores.
[12:29:27] <rossjones> specifically https://github.com/datapressio/solr-agent/blob/master/solr-agent.go#L99
[13:00:15] <rossjones> persumably there's an update as well as create

2015-09-14
[05:19:55] <Manish_> how to create another organization category in ckan ? is this possible to create through extension
[05:20:38] <Manish_> which contains page like organization

2015-09-13

2015-09-12

2015-09-11
[13:53:20] <rossjones> If I submit a PR that deletes the PEP8 tests, would someone merge it?
[13:53:50] <nigelb> lololololol
[13:53:51] <yanik> you hate PEP8?
[13:54:06] <nigelb> I knew that tweet had something to do with ckan :D
[13:54:36] <yanik> oh, a joke. i see
[14:02:42] <rossjones> yanik it runs last and so after waiting 20 minutes you find out you have an extra line in a file. then you re-run the tests and wait 20 minutes.  and for some reason travis picks up some that I don't seem to see locally :(
[14:03:15] <rossjones> And now I've got a totally random error that I've never seen before at test_datapusher_creates_default_views_on_complete
[14:25:18] <rossjones> and now it's gone. that's not a good thing is it :(
[14:33:56] <wardi> rossjones: that race has been there for a while..
[14:34:41] <wardi> rossjones: do you have the exact version of the pep8 library? When I run them locally I see the same errors
[14:35:09] <rossjones> I am using 1.4.6
[14:36:22] <rossjones> Found another race :(
[14:36:50] <wardi> rossjones: I'm not sure then. mind you I've always had trouble running the core ckanext tests so I haven't looked into that datapusher issue
[14:38:55] <rossjones> am just trying to get rid of the BaseException.message deprecation warnings ... I'll get through these tests somehow!
[15:03:00] <rossjones> I am surprised how many places do raise NotFound - with no () and no arg.
[15:03:47] <nigelb> kill the whole thing with fire.
[15:04:00] <nigelb> I'm very happy to kill of old storage code.
[15:04:39] <nigelb> more code to be killed. I think there's some JS code as well that needs dying.
[15:12:19] <rossjones> nigelb you can help out with my flask work if you like ;)
[15:13:07] <nigelb> rossjones: I probably will :)
[15:13:25] <nigelb> I'd like to first kill datapusher
[15:13:31] <rossjones> and I've got some code for dumping a ckan instance into mongo ;(
[15:13:34] * rossjones ducks
[15:13:49] <nigelb> rossjones: eventually open and consitent data? :D
[15:14:03] <rossjones> No sharding, no data loss :)
[16:43:00] <rossjones> I am so jealous of this PR - https://github.com/ckan/ckan/pull/2614 look at the number of lines removed!!!
[17:50:11] <travis-ci> ckan/ckan master 4ca2e61 https://travis-ci.org/ckan/ckan/builds/79889443 Ross Jones: The build was broken.
[17:57:12] <rossjones> It wasn't really broken, it's a spurious failure - have restarted the travis run. The error occurred only on 2.6 and it shouldn't have.

2015-09-10
[04:05:12] <Manish_> How to get dataset name under create_package_shema ?
[04:05:29] <Manish_> anybody knows how can i get in plugin.py
[05:40:07] <Manish_> when i try to associate group i am getting this error : DataError: "Only lists of dicts can be placed against subschema ('groups',), not <type 'dict'>"
[05:42:01] <Manish_> parsing parameters in package_update api {'id': u'manish-final3', 'groups': [{'name': u'test11-dm'}, {'name': u'test11-ph'}]}
[05:43:54] <Manish_> can anyone help me on this ?
[07:22:07] <Manish_> https://github.com/manishjakhodecdn/extrafield/blob/master/ckanext/extrafields/plugin.py#L71
[07:22:18] <Manish_> i am getting error while calling package_update
[07:22:37] <Manish_> i have used IDomainObjectNotification
[07:22:47] <Manish_> can anyone help me on this
[07:25:53] <Manish_> https://github.com/manishjakhodecdn/extrafield/blob/master/ckanext/extrafields/plugin.py#L75
[07:26:47] <Manish_> @rossjones can you please help me on this while i am calling package_schema it returns me internal server error
[07:27:40] <Manish_> *package_update
[07:50:25] <rossjones> Manish_ to call package_update, you need to pass the whole package and you definitely shouldn't do this inside validation
[08:06:41] <Manish_> @rossjones so i can't call like that i am calling api under this function https://github.com/manishjakhodecdn/extrafield/blob/master/ckanext/extrafields/plugin.py#L69
[08:08:59] <rossjones> Pass the entity (which is a model, not a dictionary) into the function and work on the model, don't try and call package_update ...
[08:09:30] <rossjones> here - https://github.com/manishjakhodecdn/extrafield/blob/master/ckanext/extrafields/plugin.py#L268
[08:11:12] <rossjones> in that function update_group_associations, you need to use groups = package.get_groups()
[08:12:25] <rossjones> and then you can fetch/create the group objects and then call mynewgroup.add_package_by_name()
[08:14:23] <Manish_> in this function i am just trying to associate dataset value to group which is created through dataset domain field
[08:14:27] <Manish_> https://github.com/manishjakhodecdn/extrafield/blob/master/ckanext/extrafields/plugin.py#L69
[08:19:50] <rossjones> Manish_ I need to get on with my work I'm afraid, but I think the approach you should investigate should be something like https://gist.github.com/rossjones/ee9ad6e72aee88aaaa44
[08:21:35] <Manish_> Thanks rossjones that make sense
[08:21:40] <Manish_> thanks alot
[08:21:44] <Manish_> ..:)
[08:22:05] <rossjones> no problem
[08:38:10] <rossjones> amercader will try and get to those tests today, am in harvesterland atm ...
[08:38:22] <rossjones> wardi you were interested in what queries get run to do a purge - something like https://github.com/ckan/ckanext-harvest/blob/master/ckanext/harvest/logic/action/update.py#L118-L164
[08:38:27] <amercader> rossjones: no rush
[08:38:46] <rossjones> amercader great, my favourite words ...
[09:19:48] <travis-ci> ckan/ckan master 0cb66fe https://travis-ci.org/ckan/ckan/builds/79618240 amercader: The build was broken.
[09:25:58] <Manish_> is there any option to set  sys.setrecursionlimit(limit) in ckan
[09:26:26] <Manish_> my recursion limit is 1000
[09:32:20] <joet> Manish_,  I would probably first question why I needed a recursion limit higher than 1000
[09:39:23] <Manish_> I am getting this error : runtimeerror maximum recursion depth exceeded while getting the str of an object
[09:42:03] <yanik> probably even 10k don't help you :)
[09:42:21] <joet> at a guess without seeing the code, increasing recursion limit won't help as yanik says
[09:42:31] <joet> there's probably an underlying problem with the code itself
[09:43:17] <joet> calling __str__() on an object shouldn't really make you hit the recursion limit
[12:41:15] <rossjones> Manish_ if it is related to the IDomainObjectNotification it is probably related to changing the object in notify_after_commit which is then triggering the notification again.
[13:52:23] <rossjones> joet is the call at 3 or 4 today?
[13:58:12] <joet> 3 i believe
[13:58:59] <rossjones> cool. ta
[14:01:18] <wardi> yanik: https://plus.google.com/hangouts/_/event/cb1vmkss426lkqicj94a3amvd1c?authuser=0&hl=en-GB
[14:07:48] <yanik> wardi, thx!
[14:08:16] <yanik> but i without video by now
[14:08:22] <yanik> I'm*
[14:09:08] <rossjones> yanik we're voice only :)
[14:09:19] <rossjones> Next is Tuesday
[14:12:42] <yanik> cool, i'm on,
[14:12:53] <yanik> sorry i'm on work
[15:55:00] <rossjones> ckanext-harvest PR for moving to v3 API is at https://github.com/ckan/ckanext-harvest/pull/158 - but there's an issue. will there being no extras key in package_search results be problematic when creating local datasets?
[16:05:07] <wardi> rossjones: why would there be no extras in package_search?
[16:05:32] <rossjones> I thought they got promoted to top level keys nowadays?
[16:06:14] <rossjones> oh no, you're right.  must be something else entirely then ;)
[16:06:16] <wardi> rossjones: only if you have a schema that does that (such as with scheming)
[16:07:07] <rossjones> right. am still slowly remembering how stuff works, it's just taking some time :)

2015-09-09
[14:46:34] <travis-ci> joetsoi/ckan itranslation-interface 8d0d27e https://travis-ci.org/joetsoi/ckan/builds/79478942 joetsoi: The build was broken.
[14:51:10] <rossjones> wardi I think it's the whole, fetch all the revisions and delete them one at a time - and we can'd do pkg.all_revisions.delete() because of a missing option in VDM :(
[15:13:52] <yanik> i got strange sessions conflict, when use ckan-persona plugin. Login alright, but when i try change username (because it's random) website hit 500 and visually log me out. But only visually, so i must press logout to get my new username appear logged in. Maybe someone got same error? Probable should post this on stackoverflow.
[15:18:45] <rossjones> yanik do you have the log for the 500 (in a gist/pastebin) ?
[15:23:28] <rossjones> If I had to guess I'd think it'd be something around https://github.com/ckan/ckanext-persona/blob/master/ckanext/persona/plugin.py#L70 and https://github.com/ckan/ckanext-persona/blob/master/ckanext/persona/plugin.py#L81
[15:24:40] <rossjones> You could try doing https://gist.github.com/rossjones/6342bfb41ba09544ae6b after the name change, see if it helps.
[15:31:46] <Manish> https://github.com/manishjakhodecdn/extrafield/blob/master/ckanext/extrafields/plugin.py#L60
[15:32:28] <Manish> i want to call this function after packageController save_new method i am getting error dataset not found
[15:34:04] <Manish> Can anyone help me how can i call this method after _save_new because i have found save_new method of package is created dataset after _modify_package_schema
[15:35:34] <Manish> @rossjones can you please have a look i have created this plugin for adding group through dataset extrafields
[15:39:10] <yanik> thx rossjones! full description http://stackoverflow.com/questions/32483829/ckan-persona-sessions-conflict-after-username-update
[15:39:28] <yanik> i will check and provide answer in SO if i can
[15:42:12] <rossjones> Manish look at the docs for IDomainObjectNotification - it'll be called whenever there's a change to a database model and you can check for new items or updated items ...
[15:46:41] <rossjones> so yanik, I think it's a but - the IAuthenticator isn't called when user_update is processed to log the user out - so the session is incorrect.
[15:47:01] <rossjones> Will either need doing at https://github.com/ckan/ckan/blob/master/ckan/controllers/user.py#L260 or at https://github.com/ckan/ckan/blob/master/ckan/logic/action/update.py#L666
[15:47:15] <rossjones> s/but/bug/
[15:53:53] <rossjones> yanik the bug is at https://github.com/ckan/ckan/issues/2630
[15:54:07] <yanik> ok, will check it first think in the morning
[15:54:40] <yanik> rossjones, thx
[15:54:46] <rossjones> np
[17:16:58] <Manish> @rossjones thanks always for your help
[17:18:29] <Manish> but i cannot associate dataset with the IDomainObjectNotification

[08:04:59] <rossjones> Does anyone else have a problem where model.Package.purge() takes 5 minutes per dataset (and locks postgres at 100% CPU) ?
[08:12:43] <rstolt> Another day another try. When harvesting a dictionary (data_dict: {'title': 'Data Explorer', 'view_type': 'recline_view', 'description': '', 'resource_id': u'153c3db3-af05-4f57-b71c-80f0c916235c'}) of the recline_view plugin is validated and causing an validation error. To tackle this error I need to know why something from the recline_view plugin is a validation target.
[08:17:04] <rstolt> It first complains of a missing name. When I add a name property to the dict it moans about an integrity violation: (IntegrityError) null value in column "view_type" violates not-null constraint, though it's set in the data_dict (see above).
[08:17:22] <rstolt> s/of/about
[08:22:39] <rossjones> rstolt is it a part of the resource dict? should the schema for it be ignore_missing or something similar?
[08:28:41] <rstolt> rossjones: Not sure I understand your question. This line https://github.com/ckan/ckan/blob/ckan-2.3/ckan/logic/action/create.py#L360 / method call is causing the error and the first dict passed raises the mentioned errors. As far as I can tell is the resource is here passed via the context.
[08:33:59] <rstolt> So this data goes into the _validate method are (in order) a data_dict related to the recline_view plugin (????), a schema with validation mapping, and the resource via the context.
[08:44:54] <yanik> hi guys, can you give me an idea for django and ckan password synchronization? i use same DB for both
[09:07:55] <Manish_> is this possible to create multiple group using group_create api ?
[09:08:22] <Manish_> groupCreaated = { 'name' : 'test3' , 'title' : 'test3', 'users': [{ 'capacity': 'admin', 'name' : 'admin' }], 'type': 'group' }
[09:08:28] <Manish_> group_created_string = logic.get_action('group_create')(context1, groupCreaated)
[09:08:36] <Manish_> groupCreaated = [{ 'name' : 'test5' , 'title' : 'test5', 'users': [{ 'capacity': 'admin', 'name' : 'admin' }], 'type': 'group' },{ 'name' : 'test6' , 'title' : 'test6', 'users': [{ 'capacity': 'admin', 'name' : 'admin' }], 'type': 'group' }]
[09:08:48] <Manish_> group_created_string = logic.get_action('group_create')(context1, h.json.dumps(groupCreaated))
[09:09:22] <Manish_> i have tried to create group like this and once group test3 created then test4 replace test3
[09:09:43] <Manish_> so is this possible to create multiple groups at a same time
[09:11:00] <joet> yanik, you either want a custom authentication backend for django or you want a custom authentication backend for ckan using IAuthenticator.
[09:12:02] <joet> Manish, no, not that I'm aware of, also you try to use the plugin toolkit when writing ckan extensions
[09:12:22] <yanik> joet, what about creating django user when ckan one is created?
[09:12:24] <joet> so call toolkit.get_action instead of importing logic and using logic.get_action in your extension
[09:12:31] <yanik> is this bad solution?
[09:14:35] <joet> i don't think there is an extension point in ckan  in user_create to allow you to hook into actions after users are created
[09:16:00] <joet> it might work, but I'd be worried about things constantly going out of sync
[09:16:57] <joet> you'd have to worry about username changes, password changes and whatever other stuff falls out from it.
[09:17:29] <yanik> yup :( so maybe i just use same password encoding and same table
[09:18:17] <yanik> so far have no idea how can i affect  _set_password from user models
[09:18:20] <yanik> so far have no idea how can i affect  _set_password from user model
[09:20:18] <joet> well ckan uses pkbdf2 as does django (by default), we use passlib to handle it, so there are some other additional things in the hash string
[09:20:57] <yanik> yup, password string pattern is not same
[09:21:36] <joet> but really, I would just think about using a custom auth backend
[09:21:39] <joet> https://docs.djangoproject.com/en/1.8/topics/auth/customizing/#specifying-authentication-backends
[09:21:44] <yanik> i will try work on this, and will release django-ckan package if succeed
[09:22:02] <joet> http://docs.ckan.org/en/latest/extensions/plugin-interfaces.html#ckan.plugins.interfaces.IAuthenticator
[09:22:16] <yanik> thx
[09:22:51] <joet> you can take a look at http://seanh.cc/posts/ckanext-persona/ https://github.com/ckan/ckanext-persona if you need an example to look at that seanh wrote a while ago
[09:23:31] <yanik> txh, examples always welcomed :)
[09:26:36] <Manish_> How to trake dataset changes in log file is there any plugin available to minimize the dataset corruption.
[09:26:41] <Manish_> *track
[09:26:44] <yanik> ha-ha, maybe i just use mizzila persona for both sides :D
[09:26:56] <yanik> mozilla*
[09:28:26] <joet> heh, that's possible, there are some other auth backends out there written for both, probably an ldap one there if you have an ldap server going
[09:29:13] <yanik> and lust make sessions sync, so user don't login twice
[09:29:33] <yanik> will try both options :)
[09:51:59] <rossjones> rstolt sorry, I'm not sure.  Perhaps it would make more sense for harvester to remove resource_view stuff from harvested datasets as it's possible you don't have the same plugins installed - bound to cause problems.
[09:53:08] <rstolt> rossjones: That rescourceview
[09:54:13] <rstolt> stuff is not part of the harvested datasets, and when deactivating the resource_view plugin I walk into another error branch
[09:54:43] <rossjones> ugh.
[09:54:50] <joet> I don't know why it's harvesting in the resource views anyway
[09:54:53] <rossjones> and it's the ckan harvester, right?
[09:56:07] <rstolt> rossjones: I guess it has to do something with our deployment or included plugins as it works on my development vagrant box. Fun times ;D
[09:57:11] <rstolt> rossjones: Yes the one from GitHub extended with a bunch of custom ones.
[09:59:31] <rstolt> rossjones: Do you got an idea why tags relations of harvested datasets might be broken? Worked on 1.8.* but seems to be broken on 2.3, for me in both cases (vagrant box and deployment box).
[10:12:18] <rossjones> rstolt I've only really looked at harvesting at quite a shallow level ... and we don't use tags at all on our ckan.
[10:12:26] <rossjones> we gave up when we got to 10k tags
[10:14:06] <rstolt> Ok. Ta for all your feedback :)
[10:23:47] <rossjones> rstolt it could do with moving to use v3 of the CKAN API as well if you're looking at submitting a PR? ;)
[10:31:37] <rstolt> rossjones: Would do if that wouldn't be beyond my python skills ;P But if have to get dirty and will find a fix I will open a PR. Though it would be more motivating if they get merged and not dangle around (https://github.com/ckan/ckanext-harvest/pull/150) ;D
[10:33:32] <amercader> sorry rstolt, we have many open fronts
[11:10:41] <rossjones> amercader let's look at open stuff Thurs and maybe dgu could take a few of these? we use it quite a lot ...
[11:37:12] <yanik> any idea why i hit 500 error when just switch DEBUG to true in production.ini? Oo
[11:37:41] <rossjones> yanik running through apache?
[11:37:46] <yanik> yup
[11:37:51] <rossjones> you can't do that (successfully) I don't think
[11:38:12] <rossjones> If you're debugging in production, just run another paster serve on a different port ;)
[11:39:13] <yanik> ok, will try run development.ini on different port with paster
[11:40:00] <rossjones> vague recollections of it having something to do with full_stack=true in config, but can't be sure it is that.
[11:49:06] <rossjones> oh, the UI for ckanext-harvest is really nice
[11:54:30] <yanik> share shoot
[11:55:58] <joet> rossjones, yanik 500ing when people are turning on debug=true in a production environment is a feature not a bug :p
[11:56:36] <joet> otherwise i'm sure there would be a dozen deployments out there in the wild running in debug mode.
[11:57:17] <yanik> joet, i see, security feature :D
[12:00:09] <joet> i'm sure idiots like me would have done some debugging on a server and then forgotten to turn off debug mode.
[12:03:39] * rossjones goes to check his servers
[12:26:47] <Manish_> def _check_tags(key, data, errors, context): how can i get dataset name from this function
[12:37:22] <travis-ci> ckan/ckan master 6a1826f https://travis-ci.org/ckan/ckan/builds/79459473 Joe Tsoi: The build was broken.
[12:38:14] <joets> fs
[12:38:41] <joets> bloody travis, coming over here, complaining about broken build
[12:38:42] <joets> s
[12:45:38] <yanik> from england ?))
[12:48:20] <yanik> I have rights confusing here.  Cant install package without sudo, since environment in /usr/lib.. . But if  i install with sudo and run paster without sudo - it's cant find package :) Any suggestions?
[12:48:32] <yanik> last question for today, i promise
[12:50:17] <Zharktas> you could create the virtual_env to somewhere else if you must run something without root
[12:50:20] <Zharktas> ?
[12:50:36] <yanik> ok, i'll try
[12:52:55] <yanik> finally, i figure it out
[12:52:59] <DragonDave> :)
[13:03:10] <rossjones> yanik i know you never should, but you can run sudo /usr/lib/ckan/default/bin/paster .... but don't use a virtualenv like Zharktas suggested :)
[13:05:18] <Zharktas> i'm just guessing, i just use sudo in our envs :p
[13:08:36] <yanik> i just login as root and install without sudo
[13:08:48] <yanik> no idea why, but it worked :D
[13:09:02] <Zharktas> that's the same as running with sudo :p
[13:09:40] <yanik> but sudo don't work, I should read book about Linux rights, i guess
[13:17:30] <DragonDave> Generally my strategy for python module installation these days is `pip install --user`
[13:17:53] <DragonDave> but I don't know if that helps for this specific instance
[13:18:31] <yanik> will consider this, there is no issue anymore)
[13:19:01] <DragonDave> :)
[13:49:36] <wardi> rossjones: yes, purge barely works. pretty sure there's a ticket about improving that
[13:49:37] <travis-ci> ckan/ckan master bdde94c https://travis-ci.org/ckan/ckan/builds/79469619 joetsoi: The build was broken.
[13:50:03] <rossjones> wardi going to have a look this pm
[13:53:12] <wardi> rossjones: sounds great! might be fun to see the EXPLAIN on the query it's running
[14:05:04] <travis-ci> ckan/ckan master d9ebb7e https://travis-ci.org/ckan/ckan/builds/79469937 Joe Tsoi: The build was broken.

2015-09-08

[07:14:20] <rstolt> Why is in the CKAN harvesting process a dict coming from the recline_view plugin being validated (which is also missing a name key and therefor bringing the whole harvesting process to a halt and might also causing the still present DetachedInstanceError (https://github.com/ckan/ckanext-harvest/issues/151))?
[08:46:52] <Manish_> 'domain' : [ toolkit.get_validator('ignore_missing'), toolkit.get_converter('convert_to_extras'),getGrouplist(self,schema.domain)]
[08:47:27] <Manish_> how can i pass this domain field name in method getGrouplist()
[08:47:48] <Manish_> this is the filed which i have added using extrafield plugin
[08:48:21] <Manish_> i want to parse into this function : def getGrouplist(self):     context = {'model': model,                    'session': model.Session,                    'ignore_auth': True                    }                                                            data_dict = { 'sort': 'name' }                    grouplist = logic.get_action('group_list')(context, data_dict)     for grouplistitem in grouplist:         complexdata = { 'id': gro
[09:17:33] <rossjones> Manish_ look at https://github.com/ckan/ckan/blob/master/ckan/logic/converters.py
[09:18:21] <rossjones> and https://github.com/ckan/ckan/blob/master/ckan/logic/validators.py#L24
[09:20:21] <Manish_> but the filed domain i have added is from extrafield plugin which i have used in schema.update({ 'domain' : [ toolkit.get_validator('ignore_missing'), toolkit.get_converter('convert_to_extras'),getGrouplist(self)] })
[09:21:13] <Manish_> and i want to get field vaule in getGrouplist method which i have used at the top of the plugin
[09:23:02] <Manish_> i want parse the field value in getGrouplist(self,fieldvalue) something like that
[09:26:58] <Manish_> i want to call group_create  API by that field
[09:33:47] <rstolt> Seems like adding 'defer_commit': True to the context fixes the DetachedInstanceError while harvesting.
[09:36:42] <rstolt> Another problem I'm currently facing is that tags are created while harvesting but their relations are not established, means clicking on a tag of a harvested dataset (e.g. dataset?<tagname>) produces an empty listing. Any pointers why?
[09:37:56] <rstolt> Had a similar problem with groups, which had to be build locally prior to harvesting. Could this also be the case for tags?
[11:08:48] <Manish_> groupCreaated = { 'name' : 'clinic_dm', 'title' : 'clinic', 'users': [{ 'capacity': 'admin' }], 'type': 'group' }     group_created = logic.get_action('group_create')(context, groupCreaated)     print group_created     return
[11:09:41] <Manish_> when i am try to creating group it will change my last group but can't create a new group in database schema
[11:13:00] <rstolt> ???
[11:21:20] <Manish_> it fixed now i haven't updated my development.ini with ckan.auth.user_create_groups = true
[12:03:55] <rossjones> brook is team meeting on?
[12:04:18] <brook> Should be!
[12:04:30] <rossjones> at 1pm uk time?
[12:15:56] <yanik> invite me too :D
[12:28:04] <rossjones> sorry yanik missed that :(
[12:28:31] <Manish_> hi @rossjones : schema.update({                 'domain' : [ toolkit.get_validator('ignore_missing'), toolkit.get_converter('convert_to_extras'),getGrouplist(self, value)]                 })
[12:28:50] <Manish_> when i am calling this it returns me value is not defined
[12:28:59] <Manish_> can you help me on this
[12:29:38] <rossjones> Manish_ where's your github/bitbucket repo?
[12:29:39] <Manish_> i want to parse domain extrafield value in getGrouplist function
[12:30:05] <Manish_> ok i will update it over my github
[12:34:13] <rossjones> Manish_ you are aware that getGroupList() has to return a function ... ?
[12:34:44] <Manish_> yes i have created that function on the top of the plugin
[12:35:08] <Manish_> i want to parse the extrafield parameter in that function
[12:35:33] <Manish_> i am commiting my code over github now please give me a min
[12:45:16] <Manish_> @rossjones : this is git hub url : https://github.com/manishjakhodecdn/extrafield/blob/master/ckanext/extrafields/plugin.py
[12:45:51] <rossjones> It's currently failing because of https://github.com/manishjakhodecdn/extrafield/blob/master/ckanext/extrafields/plugin.py#L13-L14
[12:46:27] <yanik> rossjones, I'm not team member, just kidding
[12:46:51] <rossjones> yanik I don't think it matters, if you're interested in joining I doubt anyone would object - always nice to have more people to assign bugs to ;)
[12:46:59] <Manish_> yes because i want to get domain field value in function which i have created getGrouplist
[12:47:05] <rossjones> Manish_  How about we take a step back - what is the end result you want to achieve ...
[12:47:59] <Manish_> i want to add group by domain field value in ckan and domain extrafield is coming form my plugin
[12:48:20] <rossjones> So everytime you see a new domain field, you want to create a new group?
[12:48:20] <Manish_> which belongs to dataset extrafield
[12:48:37] <yanik> rossjones, i'm really want to join. Working on CKAN project only for couple weeks, but I think I can contribute in future :P
[12:48:58] <rossjones> yanik I'll make a note to check if you're on IRC for the next one ;)
[12:49:08] <yanik> sure, thx
[12:49:25] <Manish_> no if i have add tag in domain field i want field value creates new group
[12:50:07] <Manish_> if group is not exists then it create new group and if it exist then dataset would be added into this
[12:50:18] <Manish_> Does it make sense ?
[12:50:48] <rossjones> Yes and no. I mean, yes, it makes sense, no I'm not sure this is the best way. gimme 5 mins.
[12:51:02] <Manish_> ok
[12:51:30] <Manish_> i just want to create group by this extrafield value only
[12:52:22] <Manish_> but i cannot parse extrafield value in the function which i have created on the top of the plugin
[12:53:10] <Manish_> so i want to parse field value in the function so i can call group_create api
[12:53:12] <rossjones> I'm not sure this is the correct approach.
[12:53:45] <rossjones> Manish_ so I create a package and the value of domain is 'wombles' - if that group doesn't exist, you want to create it and assign the package to that group?
[12:54:06] <Manish_> yes
[12:55:26] <Manish_> and if it is exist then i will get it in suggestion list in domain field.
[12:55:59] <Manish_> and if it is exist then i can create another dataset into this 'wombles' group
[12:56:17] <Manish_> may be you are clear now
[12:57:28] <Manish_> i just want to parse domain field value in the function then it will work fine because i have tested it already
[13:01:10] <rossjones> Why don't you simplify, if there is no group with the same name as the domain field, you will create that group -> showing lists of groups is not done as part of package update schema.
[13:02:11] <Manish_> yes thats what i want but i cannot parse field value using in plugin.py
[13:02:18] <Manish_> in the function
[13:02:53] <rossjones> try printing out the data field ...
[13:03:00] <Manish_> ok
[13:04:30] <rossjones> Make the function look like https://gist.github.com/rossjones/f23252e23664750c72c7 and use that name in the schema...
[13:05:53] <rossjones> ..but I think this is going to lead you down a rabbit hole when you try and assign the group to the dataset - perhaps you would be better using the IDomainObjectModification plugin ...
[13:06:54] <Manish_> can you but the requirement i different thats why i created this extension
[13:07:23] <Manish_> i know i need to check many thing by that
[13:07:38] <Manish_> first i have to check the list of groups
[13:07:52] <Manish_> then all entities of all groups
[13:08:00] <Manish_> then i have create new group
[13:08:17] <rossjones> sure, but I don't think the validator is the right place to do that.
[13:08:34] <Manish_> but where i need to call the function that you have to provide me
[13:08:53] <Manish_> in schema.update({ within that })
[13:12:09] <rossjones> Manish_ I'll point you in the right direction, but I'm not doing it for you :)
[13:12:32] <rossjones> I think you'd be better looking at an existing extension in depth and understanding how the various parts work.
[13:12:32] <Manish_> ok rossjones
[13:12:50] <Manish_> sure thing Thanks alot rossjones
[13:12:54] <Manish_> for your help
[13:17:52] <Manish_> Done Thanks rossjones
[15:48:37] <rgrp> really want to acknowledge rossjones here for his helpfulness to the channel :-)
[16:26:30] <rossjones> thanks rgrp, we should have a training day next time there's a mass of ckan devs in one place - it might help us improve the docs where they're possibly not clear with "How do I .." sections

2015-09-07
[05:50:40] <Manish_> Hello All, anybody know extension for commenting and rating which can stored all comments and rate which provided by users or visitors within CKAN database
[05:50:59] <Manish_> I have used disqus but all comments are stored over disqus
[05:51:38] <Manish_> Is there any other extension available with the UI like disqus
[05:53:05] <Manish_> Also i am very Thanks to @rossjones for default organization issue. it was fixed
[05:53:23] <Manish_> @rossjones Thanks for you help
[06:39:13] <Manish_> @rossjones i have used your extension "Ckanext-commets" but after installation i haven't found any UI appeared on datasets detail page like disqus
[12:03:04] <Manish_> i am using discourse commenting for dataset but i am using this error :
[12:03:06] <Manish_> DEBUG: discourseUrl = 'https://meta.discourse.org/'; discourseUserName = 'manishjakhode'; discourseEmbedUrl = 'http://s1.cdnsolutionsgroup.com/dataset/mindtree';  pkg_dict = '{ "domain": "Health", "license_title": "Creative Commons Attribution", "maintainer": null, "relationships_as_object": [], "private": false, "maintainer_email": null, "num_tags": 0, "key_entities": "", "id": "db580bcb-4b52-435f-9ac8-8af2ba14ea4d", "metadata_create
[12:03:45] <Manish_> any one knows how to use discourse extension for comments
[12:24:31] <rossjones_> Manish_ that doesn't look like an error ...
[12:25:25] <rossjones_> It looks like DEBUG output
[12:36:35] <Manish_> @rossjones : but my UI is not appeared for comments while i am using discourse extension
[12:37:14] <Manish_> @rossjones i cannot see any UI for comment on dataset detail page
[12:59:57] <rossjones_> Manish_ have you done - https://github.com/ckan/ckanext-disqus#comments-threads -?
[13:00:18] <rossjones_> Wait - discourse ... sorry. I thought you were doing disqus ;)
[13:00:48] <Manish_> its a disqus not discourse
[13:01:40] <Manish_> i want to my all comments in my CKAN instance not over to disqus server
[13:01:44] <rossjones_> So for disqus you need to do https://github.com/ckan/ckanext-disqus#comments-threads in your own templates.  ckanext-discourse doesn't add anything to package page as far as I know.
[13:02:10] <rossjones_> I don';t think there is a complete-in-ckan commenting solution at the moment.
[13:04:05] <Manish_> So that mean there is no option to available to store user comments in ckan database ?
[13:04:33] <Zharktas> there are work in progress plugins but they are far from perfect
[13:05:20] <Manish_> and what about ckanext-comments which is made by rossjones ?
[13:05:38] <Manish_> is this also not available for the same ?
[13:06:24] <rossjones_> yeah, he's a loser, I don't think he finished it ;)
[13:06:48] <Manish_> omg
[13:07:10] <Manish_> so i think i need to use disqus only for commenting
[13:07:21] <Manish_> do we have any option for rating also ?
[13:07:56] <rossjones_> what type of rating? user-rating?
[13:08:24] <Manish_> i want to put star rating below the additional info for each dataset
[13:08:42] <Manish_> and that should store in my database
[13:09:12] <rossjones_> So there's is tracking, which is based on views ... otherwise I'd check out http://extensions.ckan.org
[13:09:52] <Manish_> there is no extension available for user star rating from 1 to 5 for dataset
[13:10:45] <rossjones_> Manish_  Well, if you're looking for something to help out with ;)
[13:11:46] <Manish_> ok cool..:)
[13:14:00] <rossjones_> finishing ckanext-comments is fairly far down my list ..
[13:14:30] <rossjones_> Manish_ have you tried http://extensions.ckan.org/extension/ytp-comments/ ?
[13:17:59] <Manish_> yes i have tried it but its also having same problem
[13:18:10] <Manish_> UI is not appeared
[13:21:48] <rossjones_> well, it has a template for package_read, have you got your own package/read.html template?
[13:41:22] <rossjones_> Manish_ I just install ytp-comments and it works for me, I can even add comments!
[13:42:08] <rossjones_> So I think you've missed a step in your setup
[13:43:23] <Manish_> Yes Thanks rossjones
[13:43:29] <Manish_> now it works fine
[13:43:46] <Manish_> i have missed out the step for init db
[13:43:54] <Manish_> but now its working fine Thanks alot
[13:47:12] <rossjones_> no problemn
[16:36:43] <ozooner> Hi, I have a question regarding testing - is it possible to change configuration options during tests? e.g change ckan.auth.create_dataset_if_not_in_organization = true

2015-09-06

2015-09-05
[09:12:04] <Manish_> Hello All,
[09:12:15] <Manish_> i have tried this API  ckan.logic.action.create.organization_member_create(context, data_dict)
[09:12:51] <Manish_> but system shows me that i am not authorized to do this even
[09:12:59] <Manish_> *event
[09:14:04] <Manish_> i want to add all users as organization member while they are creating their account from registration page in CKAN instance
[09:14:12] <Manish_> anyone can help me on this
[10:22:51] <rossjones> Manish_ you should be using get_action from ckan.logic  like https://gist.github.com/rossjones/98b7101589d59618d42c
[10:23:27] <rossjones> you may well need to add "user": c.user to the context, if it is internal and you don't want to do auth "ignore_auth": True
[10:25:08] <rossjones> Manish_ you might find more help in http://docs.ckan.org/en/latest/extensions/index.html and http://docs.ckan.org/en/latest/contributing/architecture.html and http://docs.ckan.org/en/latest/api/index.html
[12:58:09] <wardi_> rossjones: ckanapi.LocalCKAN is nice for this too
[18:14:43] <rossjones> wardi done a bit more on flask, thinking it might be easier to rip out everything *except* the logic layer ;)

2015-09-04
[05:20:43] <Manish__> Is there any way to add organization default for all registered users and role as a editor in CKAN ?
[05:22:36] <Manish__> @wardi Thanks for your yesterday's help thats works for me
[05:26:02] <Manish__> i need to make one organization default for all registered user at the time of registration
[05:26:16] <Manish__> Any one can help me on that
[05:37:31] <Zharktas> Manish__: yes it's possible
[05:37:42] <Manish__> How ?
[05:38:02] <Manish__> @Zharktas How ?
[05:40:44] <Zharktas> Manish__: https://github.com/yhteentoimivuuspalvelut/ytp/blob/ddc7cba0c7690f3ad1ced693bc3699d10ee8b459/modules/ckanext-ytp-main/ckanext/ytp/organizations/plugin.py#L77 we modified the original action to call member create automatically
[05:42:42] <Manish__> do i need to install this extension ?
[05:43:54] <Zharktas> no, you can make similar modification to your own extension
[05:44:02] <Zharktas> it's not that difficult
[05:44:59] <Manish__> i am not using any extension for registration process is this possible to set default organization in user controller ?
[05:46:24] <Zharktas> you need to implement it, there's no existing implementations in ckan core that i know
[05:49:47] <Manish__> ok i guess i need to create new extension for registration and need to add this action
[09:37:08] <Manish__> @Zharktas i guess you give me refrence to create default organization using plugin
[09:38:26] <Manish__> but my concern is to i want to add all users within organization which i have already created at the time of registeration
[09:39:19] <Manish__> suppose i have existing organization already and i want to add member in this organization at the time of registration
[09:40:55] <Manish__> I want to add user to be a member or editor of existing organization at the time of registration.
[09:46:49] <Manish__> anyone can help me i have one organization for whole system already and i want all registered user to be a member of this organization at the time of registration
[09:48:43] <Zharktas> use the api then
[10:08:08] <Manish__> which one can please suggest me ?
[10:09:51] <Zharktas> http://docs.ckan.org/en/latest/api/index.html#ckan.logic.action.create.organization_member_create
[10:10:07] <Zharktas> or you could read the documentation yourself ;)
[14:32:00] <rossjones> It's Friday, so I've started the Flask migration ....
[14:42:12] <wardi_> rossjones: I'm very interested
[14:56:16] <rossjones> Just pushed a branch, am trying to clean up dispatching now. Want to have it serve all the API calls, which is sort of does now ... sort of.
[14:56:44] <rossjones> It is intermingled with lots of Pylons nonsense though (like translation stuff, so very messy).
[14:57:04] <rossjones> wardi_ https://github.com/ckan/ckan/tree/flask-poc
[14:57:23] <wardi_> can we avoid translation stuff at the api layer and below?
[14:58:00] <wardi_> ah, I guess not
[14:59:19] <gr8> we would like to count our resource-downloads? - how is this possible withouth using google-analytics?
[15:01:22] <wardi_> gr8: if you're hosting the files you could analyze your server logs
[15:01:26] <rossjones> wardi_ it's the logic layer :(
[15:12:43] <gr8> hm would that be the same behaviour like it is done when tracking packages (tracking_summary)?
[15:17:29] <rossjones> gr8 you mean the TrackingMiddleware ..?
[15:17:43] <gr8> yes
[15:18:58] <rossjones> You could probably modify that middleware to hand GET requests to whatever the download path is for resources to record the info I would have though.
[15:22:18] <rossjones> sigh. typing too fast, that makes no sense.
[15:22:41] <rossjones> Maybe you could modify the TrackingMiddleware to also handle GET requests to the download path for resources.
[16:00:15] <rossjones> wardi_ I got as far as trying to get auth working, but repoze doesn't seem to be setting REMOTE_USER in the environ and I'm stuck for now :(
[16:30:19] <Manish> Hello All
[16:30:53] <Manish> I am trying to call user_show method in ckan plugin.py
[16:30:55] <Manish> context = {'model': model, 'session': model.Session,            'user': c.user or c.author}              data_dict = logic.clean_dict(unflatten(logic.tuplize_dict(logic.parse_params(request.params))))             user_list = logic.action.get.user_show(context, request.params['suid'])             #user_list = logic.get_action('user_show')(context, request.params['suid'])                          print user_list             return
[16:31:24] <Manish> like that but getting error : Error - <type 'exceptions.AttributeError'>: 'unicode' object has no attribute 'get'
[16:31:34] <Manish> any one can help me on this
[16:31:59] <Manish> @slifty Hello slifty
[16:32:34] <Manish> this is my code :  context = {'model': model, 'session': model.Session,            'user': c.user or c.author}
[16:32:46] <Manish> data_dict = logic.clean_dict(unflatten(logic.tuplize_dict(logic.parse_params(request.params))))
[16:32:59] <Manish> user_list = logic.action.get.user_show(context, request.params['suid'])
[16:33:08] <Manish> print user_list
[16:33:28] <Manish> is there anything wrong

2015-09-03
[09:34:40] <Manish__> Hello All
[09:35:10] <Manish__> Anyone knows how to create two contact form within ckan
[09:35:33] <Manish__> i want to include it on ckanext_page extension
[09:35:42] <Manish__> in content area
[09:41:55] <Manish__> @shellac_ do you have an idea how to use multiple contact form in ckan ?
[09:43:31] <shellac_> Manish__: No, no idea. Sorry.
[09:47:02] <Manish__> @shellac no problem Thanks
[10:33:34] <wardi_> Manish__: an IRoutes plugin lets you add a controller to create a new form
[10:39:42] <Manish__> @wardi_ Thanks
[13:31:50] <rossjones> Hate for the day goes to the Routes library for being broken and making my life difficult.
[16:27:50] <benjwadams> How does ckan compare to other projects, say, GeoNode?  I've used the latter in the past.  We're definitely looking for something with strong CSW and metadata integration and searching capabilities
[20:16:37] <travis-ci> ckan/ckan master c357989 https://travis-ci.org/ckan/ckan/builds/78638011 Ian Ward: The build was broken.
[22:09:54] <travis-ci> wardi/ckan 2581-fix-lazyjson 54e05de https://travis-ci.org/wardi/ckan/builds/78660418 Ian Ward: The build was broken.

2015-09-02
[06:31:57] <Manish_> Hello All any one can help me on providing htpasswd for CKAN instance
[06:33:06] <Manish_> i have use <Location>AuthType Basic AuthName "Restricted"  AuthUserFile /etc/httpd/.htpasswd require valid-user
[06:33:16] <Manish_> i have use <Location>AuthType Basic AuthName "Restricted"  AuthUserFile /etc/httpd/.htpasswd require valid-user</Location>
[06:34:26] <Manish_> in Virtual host but the problem is the user which i have create for securing domain is not allow to add other user using CKAN instance
[08:33:15] <Manish_> hello Slifty
[08:34:10] <Manish_> can please help me to get basic authntication work for CKAN instance
[11:34:41] <travis-ci> ckan/ckan release-v2.4.1 8994fab https://travis-ci.org/ckan/ckan/builds/78376914 amercader: The build was broken.
[12:05:16] <amercader_> New CKAN 2.3.2 and 2.4.1 patch releases available, please upgrade your instances: https://lists.okfn.org/pipermail/ckan-announce/2015-September/000016.html
[12:08:08] <Zharktas> http://docs.ckan.org/en/latest/upgrade-package-to-patch-release.html not working ;)
[12:08:23] <amercader_> *sigh
[12:08:34] <amercader_> thanks for flagging Zharktas
[12:33:29] <nigelb> I'm on a mission to get rid of the old storage code as much as possible.
[12:33:42] <nigelb> and basically dead code.
[12:50:32] <rossjones> nigelb you can save the templates though right ...
[12:51:00] <nigelb> rossjones: The template code is already gone.
[12:51:08] <nigelb> I'm removing old tests and old server side code
[12:51:17] <rossjones> Cool!
[12:51:28] <nigelb> probably frontend as well.
[12:51:42] <nigelb> all I'm leaving behind is code for people to still view files uploaded using old filestore
[12:51:43] <rossjones> will there be anything left?!
[12:51:51] <nigelb> useful for migration from old to new filestore
[12:51:53] <rossjones> Oh we're JUST talking about storage - cool.
[12:52:07] <nigelb> yeah, JUST storage.
[12:52:20] <nigelb> the ofs-based filestore is pretty much history now and it's been a few releases.
[12:52:57] <rossjones> Yeah, sounds like a good candidate for deletion
[12:53:02] <amercader_> nigelb: it's alive in many live instances, so if we can keep the dowload functionality that'd be great
[12:53:14] <amercader_> but happy to see the rest go
[12:53:32] <nigelb> amercader_: yeah, that's why I'll leave the download functionality for a while.
[12:53:47] <nigelb> It'll probably wait for a major release to actually go away.
[12:58:59] <rossjones> seems to be the weather for PRs that delete code ;)
[16:28:45] <wardi_> rossjones: my favourite time of year

2015-09-01
[07:11:20] <mih> We would like to update to CKAN 2.3.2 - I know that there will be a release tomorrow. However, is it already possible to install it (since there will probably any changes until tomorrow)?
[10:50:54] <rstolt> I'm trying to create groups via group_create, but I'm currently struggling with an AttributeError: 'function' object has no attribute 'keys' raised within /usr/local/ckan.dev/pyenv/src/ckan/ckan/lib/navl/dictization_functions.py", line 235, in validate. Whyo? Is there a way to bypass this validation or am I using the wrong schema (currently default_update_group_schema)?
[10:52:33] <rstolt> Using default_update_group_schema from ckan.logic.schema as it makes the most sense to me.
[11:07:35] <wardi_> rstolt: what are you passing to group_create?
[11:11:15] <rstolt> wardi_: Pastebined the relevant pieces here (http://pastebin.com/raw.php?i=tu8H9wJc)
[11:25:10] <rstolt> Basically the problem seems to be that type of schema to validate gainst is expected to be from type dict, but is somehow between method calls transformed into something of type function which than crashes.
[11:58:02] <wardi_> rstolt: pastebin link just says "refresh to continue". try bpaste.net?
[12:14:23] <rstolt> wardi_: https://bpaste.net/show/1360c80d30a2
[12:20:02] <rstolt> FYI CKAN version is 2.3
[12:37:29] <rstolt> Seems like the schema property in the context dict is causing the problem when omitted it works.
[12:43:34] <wardi_> how does that code work? is it part of an extension?
[12:43:47] <wardi_> yes, passing things by the context dict is dangerous
[12:44:08] <wardi_> (or at least, can lead to some really strange results)
[12:45:08] <wardi_> but.. if that's what you want you need to call default_update_group_schema() because it's a function that returns the schema
[12:45:27] <wardi_> you're better off not passing it it all, though
[12:47:29] <rstolt> Is part of a CKAN paster command building a non-remote group_list / cataloque (though it currently only adds on per command run).
[13:01:03] <rstolt> Should it be problematic to use _create_group in a for loop (who even does a look up and filter if the given group is already in group_list)?
[13:01:23] <rstolt> For eg. I want to add group health which is not in group_list and I get struck with a ckan.logic.ValidationError: None - {'name': ['Group name already exists in database']}.
[13:04:01] <rstolt> Prolly a non purged dataset / group.
[13:48:15] <wardi_> rstolt: it's not safe to reuse a context dict to multiple action calls. That's why ckanapi.LocalCKAN creates a new one each time
[13:48:38] <wardi_> rstolt: if you have a deleted group it still claims the name, you might need to purge it first
[14:16:10] <rstolt> wardi_: When calling purge it bemoans a missing id, which is unclear how to get hold of since the call group_list action doesn't return nothing.
[14:18:31] <Zharktas> rstolt: most if not all api's accept id or name
[14:18:58] <Zharktas> so you could supply it in this case as 'health'

2015-08-31
[12:04:48] <rstolt> Can somebody tell me the status of this (https://lists.okfn.org/pipermail/ckan-dev/2014-November/008394.html)? Stumbled over the same problemo while trying (and testing) to create groups from a non remote harvester.
[12:05:02] <rstolt> https://lists.okfn.org/pipermail/ckan-dev/2014-November/008394.html
[13:22:17] <rossjones> rstolt is this still a problem in recent versions? I thought purging had been addressed?
[13:22:52] <rossjones> But there is also https://github.com/ckan/ckan/issues/2438 for deleted items that keep the name in use.
[13:26:30] <rstolt> It seems to be still a problem in CKAN 2.3. Tried to create a bunch of groups, deleted them via the UI and on re-creation of the groups I got group by name xy already exists, though they aren't avail under /groups nor the API.
[13:28:18] <rstolt> Now I'm tyring to reactivate them when avail but that fails on me too.
[13:36:39] <rossjones> rstolt ah I see. So it is 2438 (but for groups) that is the issue.  Did you purge the groups after deleting them?
[13:37:42] <rstolt> Nope did'nt purge, don't know how.
[13:38:22] <rossjones> There *used* to be a URL at /ckan-admin/trash ... try that.
[13:40:32] <rossjones> Alternatively you can call group_purge API call, or copy the top class from https://github.com/nhsengland/ckanext-nhsengland/blob/master/ckanext/nhsengland/commands.py
[13:41:11] <rstolt> Managed it via ckan-admin/trash.
[13:42:31] <rossjones> That was 50/50 whether that still existed and then 20/80 whether it actually worked :)
[13:43:54] <rstolt> Though when I now recreate the groups (from an non remote harvester in it's import stage) they still in an deleted state Groupname[Deleted], so I suggest the purge didn't went all the way down to the db.
[13:44:40] <rstolt> s/suppose/suggest
[13:45:54] <rossjones> my zap above command definitely works but it does delete/purge the datasets as well.
[13:55:44] <rstolt> Should that be part of the core commands? As I remember I also have to purge harvester via paster --plugin=ckan dataset purge <harvester-dataset-id> before readding them.
[14:02:58] <rossjones> Not sure of harvester, but yes, it should be in lib/cli.py probably as group purge.
[20:22:03] <wardi_> has anyone used the fact that datastore_create can alter a table? the code looks a little broken

2015-08-30

2015-08-29

2015-08-28
[09:47:37] <rstolt> Hi. How are groups resolved while harvesting? Do I have to build a local group catalogue or are the fetched from a source API endpoint? What's the way to resolve them when harvesting from an JSON (or a zip of JSON files) holding the datasets.
[10:00:04] <amercader> rstolt: if you are using the ckan harvester it depends on the "remote_groups" configuration:
[10:00:10] <amercader> remote_groups: By default, remote groups are ignored. Setting this property enables the harvester to import the remote groups. There are two alternatives. Setting it to 'only_local' will just import groups which name/id is already present in the local CKAN. Setting it to 'create' will make an attempt to create the groups by copying the details from the remote CKAN.
[10:02:53] <rstolt> So when harvesting JSON and zips of them I have to take care that the therein related groups are present. Is there a paster command to create a bulk list of groups?
[10:05:48] <amercader> rstolt: are you harvesting a remote CKAN instance?
[10:07:47] <rstolt> amercader: It's kind of mixed. Several remote CKAN instances, some simple endpoints providing JSON files or JSON files zipped together.
[10:09:37] <amercader> just to clarify, the ckan harvester will only help you with the remote ckan instances, the other ones you will need to handle separately, either with a new harvester or just a custom script that uses the api. In this case, you will have to take care of handling the groups yourself
[10:13:33] <rstolt> amercader: Which is the ideal point (i.e. method) in the harvester class to hook into? My gut tells me the import_stage.
[10:14:13] <amercader> rstolt: is this a one off thing or needs to be done regularly
[10:16:01] <rstolt> amercader: I guess more off regularly nature, cause the JSON files content might change and therefor also include / introduce new groups.
[10:16:08] <rstolt> *of
[11:48:57] <rstolt> amercader: So I will handle it in import_stage method of the Json / JsonZip harvester?
[11:49:55] <amercader> rstolt: yes, very likely (eg check if the remote group exists locally, create otherwise, etc)
[11:50:45] <rstolt> amercader: Thanks for the feedback :)
[11:50:56] <amercader> no worries, good luck!
[12:50:32] <rossjones> amercader do you know anyone other than DGU using the gemini harvester?
[12:50:56] <amercader> rossjones: no
[12:51:05] <amercader> I don't think it is tbh
[12:51:16] <amercader> *anyone
[12:52:13] <rossjones> Okay, will ask morty to send the PR along anyway.
[12:53:00] <rossjones> And now he's our harvesting expert...... ;)

2015-08-27
[04:49:24] <HyperJohnGraham> so i am setting up ckan for the nth time
[04:51:12] <HyperJohnGraham> just followed the instructions for package install on ubuntu 12.04 but when i got to adding ckanext-spatial it choked on geos
[04:51:48] <HyperJohnGraham> do i need to install from source on ubuntu 14.04 ?
[04:52:17] * HyperJohnGraham grumbles about an easy button
[04:53:41] <nigelb> HyperJohnGraham: yes, for 14.04 you need to install from source. we don't have a package yet.
[04:53:52] <nigelb> One of these days, I really need to setup a PPA.
[04:54:07] <HyperJohnGraham> can i get ckanext-spatial running on 12.04 ?
[04:54:31] <HyperJohnGraham> from packages
[04:56:11] <nigelb> HyperJohnGraham: You should be able to, yes.
[04:56:24] <nigelb> what exactly was it failing?
[04:56:26] <HyperJohnGraham> geos stops me
[04:56:31] <nigelb> do you have a traceback?
[04:57:00] <HyperJohnGraham> nope got frustrated and deleted the VM
[04:57:34] <HyperJohnGraham> it wants 3.3 and has 3.2 with no geos-config
[04:57:50] <nigelb> what wants a 3.3?
[04:57:54] <HyperJohnGraham> geos
[04:58:04] <HyperJohnGraham> ckanext-spatial
[04:58:06] <HyperJohnGraham> sorry
[04:58:18] <HyperJohnGraham> from git
[04:58:48] <nigelb> did you follow these instructions?
[04:58:49] <nigelb> http://docs.ckan.org/projects/ckanext-spatial/en/latest/install.html#ubuntu-12-04-postgresql-9-1-and-postgis-1-5
[04:58:52] <nigelb> they're specifically for 12.04.
[04:59:24] * nigelb -> afk
[04:59:27] <HyperJohnGraham> i will try again
[05:23:41] <nigelb> HyperJohnGraham: Next time you hit an error, just pastebin it in here or write an email to ckan-dev list
[05:23:59] <HyperJohnGraham> ok thanks
[05:57:34] <HyperJohnGraham> Downloading/unpacking Shapely>=1.2.13 (from -r pip-requirements.txt (line 3))   Downloading Shapely-1.5.11.tar.gz (174Kb): 174Kb downloaded   Running setup.py egg_info for package Shapely     ERROR:/usr/lib/ckan/default/build/Shapely/setup.py:Path to geos-config is not set     ERROR:/usr/lib/ckan/default/build/Shapely/setup.py:Cannot find geos-config to get headers and check version.     ERROR:/usr/lib/ckan/default/build/Shapely/setup.py:If availa
[05:58:10] <HyperJohnGraham> Running setup.py install for Shapely     CRITICAL:/usr/lib/ckan/default/build/Shapely/setup.py:Shapely >= 1.3 requires GEOS >= 3.3. Install GEOS 3.3+ and reinstall Shapely.
[05:58:22] <HyperJohnGraham> same error as before
[06:00:58] <nigelb> aha
[06:01:16] <nigelb> HyperJohnGraham: so you need to install a slightly older version of shapely which doesn't have that dependency
[06:01:35] <nigelb> it's worth filing a bug against ckanext-spatial to mention that this is a problem, so someone can update the docs with this.
[06:01:46] <HyperJohnGraham> gotcha
[06:02:00] <HyperJohnGraham> how much older ??
[06:02:34] <nigelb> it'll be a trial and error to see whcih one will work on 12.04
[06:02:43] <nigelb> Just make sure you mention that version in the bug.
[06:02:46] <HyperJohnGraham> gotcha
[06:03:21] <nigelb> Try 1.4.4
[06:03:26] <HyperJohnGraham> ok
[06:03:26] <Zharktas> we have locked shapely to 1.3.3 in our installations, newer ones had some dependancy issue
[06:03:41] <nigelb> 1.5.x requires GEOS >= 3.3
[06:09:01] <HyperJohnGraham> hmmm this happens when i am running "pip install -r pip-requirements.txt"
[06:09:21] <HyperJohnGraham> which is trying to install Shapely>=1.2.13
[06:09:58] <HyperJohnGraham> so i will change to Shapely=1.4.4
[06:10:33] <HyperJohnGraham> ==
[06:36:58] <HyperJohnGraham> ok i got both ckanext-spatial and ckanext-harvest installed
[07:43:42] <mih> hmm how is it possible to count only resource-downloads (without google-analytics)?
[08:57:17] <rossjones> Anyone know if it is possible to get ckanext-harvest to only harvest from one remote organisation?
[09:27:56] <rstolt> rossjones: I guess in the import_stage you could filter them out of the incoming harvest_object, but not quite sure as I'm a total ckan noob :D
[09:29:02] <rossjones> rstolt I am just being lazy going through the source/docs for the CKAN harvester, might someone know offhand to save me time ;)
[09:34:01] <rstolt> The remote organisation comes in one harvester source or is it spread over several?
[09:50:07] <rossjones> rstolt at the moment we're pulling every remote org instead ... I'll read the docs ;)
[09:51:54] <rossjones> looks like I want remote_orgs but only works if IDs match .... nevermind
[09:56:17] <Zharktas> remote_orgs is useless since most of the time you get some remote guids which will never match your own instance guids
[10:15:47] <rossjones> Zharktas I think what I want/need is to be able to specify a filter to the ckan harvester so I can narrow down what should be harvested.  Am sure if I read further in the docs I'll find it ;)
[14:30:43] <rstolt> Should custom (e.g. coming from extensions) config entries being prefix with ckanext? Basically ckanext.<extension-name>.<config-key> vs ckan.<extension-name>.<config-key>.
[14:31:37] <rstolt> The docs (http://ckan.readthedocs.org/en/ckan-2.3/extensions/custom-config-settings.html) say the later case is standard.
[15:22:14] <wardi_> rstolt: I've just been using <extension-name>.<config-key>, but amercader likes ckanext.<extension-name>.<config-key>
[15:23:30] <amercader> everybody loves the second option! :)
[15:31:52] <rstolt> So ckan.<extension-name>.<config-key> is the way to go?
[15:37:01] <joet> rstolt, yeah as long as it doesn't clash and is documented tbh
[15:37:54] <rstolt> Ok. Ta.
[15:41:44] <amercader2> rstolt: ckanext.<extension-name>.<config-key>

2015-08-26
[05:51:13] <Manish_> Hello All can any one suggest me how to use custom field validation
[05:51:20] <Manish_> in CKAN instance
[08:00:19] <rstolt> Why are some groups (after harvesting them with configured to create remote_groups) marked as <groud-name>[Deleted] and as a consequence also not showing up under /groups?
[08:00:32] <rstolt> *group-name
[08:03:57] <rstolt> What also is strange to me is that some groups are created on harvesting but are loosing the associated entities / dataseta, so that they are listed on /groups but with an indictator of 0 datasets.
[08:04:07] <rstolt> *datasets
[08:14:44] <rstolt> Also when comparing the API responses against a specific group (which is marked as deleted on the harvesting system) the state property is *active* on the havesting source system and *deleted* on the harvesting system. So what is causing this state shift?
[12:33:06] <rstolt> Is that (https://lists.okfn.org/pipermail/ckan-dev/2014-February/006859.html) still a problem?
[12:35:46] <rstolt> Purged (via dataset purge <dataset-id>) a deleted harvester source, readded it and now when starting the harvest consumer command (paster --plugin=ckanext-harvest harvester gather_consumer --config=/path/to/production.ini) for the gathering queue I get a KeyError: "Action 'harvest_source_show_status' not found".
[12:47:50] <rstolt> Not all at once ;P
[14:38:57] <rstolt> Also wondering how an DetachedInstanceError('Instance <User at 0x7f52b5a7d250> is not bound to a Session; attribute refresh operation cannot proceed',) can happen while harvesting one source and being totally obsolete when harvesting another source.
[14:39:47] <joet> rstolt, when did you install the harvest extension?
[14:41:04] <rstolt> joet: We build wheel from a hand-patched GH clone, so might be a week old, or so :D
[14:41:38] <joet> what version of ckan are you running?
[14:46:34] <joet> rstolt, ^^
[14:47:42] <rstolt> joet: The built wheel defo contains the latest GH commits (Last one Jul 21, 2015), CKAN version is 2.3. Did scan the changelogs for 2.3.1 and 2.4 and didn't find anything relevant; though in 2.4.0 the https://github.com/ckan/ckan/blob/master/ckan/new_authz.py seems to have change massively.
[14:48:35] <rstolt> Which (new_authz.py) seems to be causing the DetachedInstanceError
[14:49:05] <joet> it shouldn't be, if you pastebin (or gist or equivalent) the traceback, I can take a look at some point
[14:55:13] <rstolt> joet: Pastebin (http://pastebin.com/raw.php?i=ymxrsZmT) for recent error with additional own log entries.
[14:57:31] <joet> :/
[15:00:10] <joet> ok hard to tell without a full traceback, can you test things locally? and can you reproduce it?
[15:01:18] <rstolt> joet: An additional *name* attribute check in https://github.com/ckan/ckan/blob/ckan-2.3/ckan/new_authz.py#L118 did force an database hit, but that's trs hacky ;D
[15:02:09] <rstolt> joet: yes running the CKAN system locally and every harvesting run against this one source causes the mentioned error.
[15:03:17] <joet> well you can try catching the detachedinstance error at that point and logging the full traceback
[15:03:35] <joet> the other time this occured was on this line https://github.com/ckan/ckanext-harvest/blob/master/ckanext/harvest/harvesters/base.py#L122
[15:03:46] <joet> if you want long boring details you can see https://github.com/ckan/ckan/pull/1714
[15:04:20] <joet> but it wouldn't suprised me if there is a case where the session is closed again, or some rollback has invalidated the user object or something
[16:54:58] <rstolt> It seems like this method call (https://github.com/ckan/ckanext-harvest/blob/master/ckanext/harvest/harvesters/ckanharvester.py#L314) is causing the DetachedInstanceError.
[16:58:09] <rstolt> Also seeing this error (http://pastebin.com/raw.php?i=eTQgC4rE) in the log which might cause the Session data lost

2015-08-25
[07:16:16] <L1042> according to the page view tracking-feature: I visited a package, but the counter wasn't increased -- so it is still 0. What could be the reason for it?
[10:02:15] <L1042> according to the page view tracking-feature: I visited a package, but the counter wasn't increased -- so it is still 0. What could be the reason for it?
[10:04:17] <Zharktas> did you run the paster command afterwards ?
[10:09:09] <L1042> paster tracking update? -- yes
[11:57:36] <rstolt> I'm having another harvesting problem. When I harvest the following entity (http://suche.transparenz.hamburg.de/api/3/action/package_show?id=bebauungsplan-harburg-24-hamburg) I see a *groups* data structure with the properties title, description, name and id. When I look into the datastructure (via log file entries) coming into the import_stage of the harvester only the id property is left. How so? Who's eating my data?
[11:59:23] <amercader> rstolt: groups are separate entities and not imported by default, check the "remote_groups" config options if you want to import them: https://github.com/ckan/ckanext-harvest#the-ckan-harvester
[12:08:27] <rstolt> amercader: Thanks, that was the missing piece. Can I configure this globally via the ini configuration? As we are having a lot of harvesting sources (~ 20 of them).
[12:14:37] <rstolt> amercader: Ok sorry wasn't the missing piece. Still reducing the groups dict only leaving the id property. Is a single entry (i.e Using config: {u'remote_groups': u'create'}) in the harvester config sufficient?
[12:17:34] <Zharktas> rstolt: you don't need unicode strings if you input the config from the browser interface
[12:17:53] <Zharktas> {"remote_groups": "create"} should be enough
[12:18:10] <rstolt> That's an excerpt from the log file ;D
[12:18:20] <Zharktas> ah :p
[13:09:59] <yanik> hey guys :) any idea how can i extend user register functionality? for instance send mail just before created new user
[13:12:11] <yanik> i know i must extend controllers.user.new method, but how? :)

2015-08-24
[04:47:15] <Manish_> how to create custom Facets for sidebar using ckan 2.4 ? also i want to include datasets custom field in sidebar
[04:48:09] <Manish_> anyone can help me on this ?
[05:40:43] <Manish_> How to create custom category in CKAN 2.4 ?
[05:40:57] <Manish_> like Group, Organization
[05:41:08] <Manish_> Anyone can help me on this
[07:10:25] <Manish_> can anyone help me on this  : http://stackoverflow.com/questions/32175329/how-to-add-custom-category-in-ckan-instance
[08:09:14] <rossjones> Manish_ you need to implement IGroupForm in your extension - http://docs.ckan.org/en/latest/extensions/plugin-interfaces.html?highlight=igroupform#ckan.plugins.interfaces.IGroupForm
[08:09:40] <rossjones> For instance, organizations are groups, so you can implement if for your custom category
[08:10:09] <rossjones> And you want http://docs.ckan.org/en/latest/extensions/plugin-interfaces.html#ckan.plugins.interfaces.IFacets for your facets
[09:52:16] <mih> we are using the pdf_view-extension -- however, currently it is neccessary to add a view for each dataset. How is it possible to automatically add a pdf-view for pdf-files? - in production.ini the default_views-setting contains pdf_view as well
[12:19:26] <amercader> mih: that should be enough ( I mean `ckan.plugins = ... pdf_view` and `ckan.views.default_views = ... pdf_view`. You probably also need the `resource_proxy` plugin enabled
[16:28:09] <guest56789> is there any ckan-extension which counts the resource-downloads?
[16:29:06] <guest56789> (google analytics is no option for us.)
[17:39:13] <tbnorth> hi all - working on a ckan deployment.  Re metadata - if I have an ISO 19115/19139 description of the data set as .xml, will ckan just display a selected subset of that, or make the whole thing viewable?
[17:42:20] <Manish> hello all
[17:42:46] <Manish> is anyone help me to show my custom field in facet_list item
[17:43:13] <Manish> in sidebar of CKAN instance
[17:44:37] <Manish> i have added new custom fields name : domain and i want to show domain in sidebar also the belonging tags to domain into side bar
[18:56:56] <rossjones> manish have you implemented an IFacets plugin as described at http://docs.ckan.org/en/latest/extensions/plugin-interfaces.html#ckan.plugins.interfaces.IFacets ?

2015-08-23

2015-08-22

2015-08-21
[05:03:02] <Manish_> hi all
[05:03:43] <Manish_> i have added custom field in CKAN instance but its only work for 1 field
[05:05:23] <Manish_> if i have add more then 1 fields it returns me usr/local/s3.cdnsolutionsgroup.com/pyenv/lib/python2.6/site-packages/sqlalchemy/orm/unitofwork.py:79: SAWarning: Usage of the 'related attribute set' operation is not currently supported within the execution stage of the flush process. Results may not be consistent.  Consider using alternative event listeners or connection-level operations instead.   sess._flush_warning("related attribute
[05:10:52] <Manish_> i am getting this error on console Error - <type 'exceptions.KeyError'>: 'resources'
[05:11:34] <Manish_> anyone can help me on this
[05:16:34] <Manish_> hi slifty
[05:16:48] <slifty> hey Manish_
[05:16:50] <Manish_> can you help me on above error
[05:17:08] <Manish_> Actually i have add custom fields
[05:17:32] <Manish_> and its work with only one add custom fields
[05:17:59] <Manish_> but if i am inserting other fields it returns me error Error - <type 'exceptions.KeyError'>: 'resources'
[05:18:27] <Manish_> Have you faced this problem on CKAN instance
[05:19:21] <Manish_> i have followed : http://docs.ckan.org/en/latest/extensions/adding-custom-fields.html
[05:19:34] <Manish_> but its only work for 1 custom fields
[05:32:33] <Manish_> Hello Slifty
[05:32:58] <Manish_> Do you know how to resolve this problem
[05:33:33] <slifty> alas, it's been a little while since I was neck deep in ckan
[05:35:16] <Manish_> can you help me to resolve this problem
[08:49:37] <bla_> Hi! We are updating CKAN from 2.2 to v. 2.3.1 -- according to the instructions we updated the solr-schema, and now we would like to upgrade the DB (via paster db upgrade). However, we get following error:  ckan.lib.search.common.SearchError: SOLR schema version not supported: 2.0. Supported versions are [2.3] --- so, is it neccessary to update the DB first and then updating the schema.xml-file from solr?
[08:51:25] <amercader> bla_: did you restart jetty?
[08:51:39] <amercader> (or tomcat, whatever you are running solr on)
[08:52:05] <bla_> tomcat - yes!
[08:53:08] <amercader> and the schema returned by solr itself is 2.3? You can check it querying http://localhost:8080/solr/#/collection1/files?file=schema.xml
[08:53:20] <amercader> or similar, depending on your setup
[08:56:29] <bla_> hmm returns following: <schema name="ckan" version="2.0">
[08:57:25] <bla_> is there something like a cache which needs a "clean"?
[08:57:46] <amercader> bla_: I don't think so. How did you update the schema.xml file?
[08:58:01] <bla_> because the schema-file in /etc/solr/.../schema.xml is different to them in web
[08:58:29] <bla_> according to the instructiions: sudo mv /etc/solr/conf/schema.xml /etc/solr/conf/schema.xml.bak sudo ln -s /usr/lib/ckan/default/src/ckan/ckan/config/solr/schema.xml /etc/solr/conf/schema.xml
[08:59:03] <amercader> and can you confirm that /usr/lib/ckan/default/src/ckan/ckan/config/solr/schema.xml is the right one (2.3)?
[09:03:08] <bla_> ahh, found it - configured schema-file for solr is not in /etc/solr - so, schema-file wasn't updated! thank you, amercader!
[09:24:22] <amercader> bla_: glad you find it
[09:24:29] <amercader> *found
[10:04:40] <bla_> unfortunately another error: I looked through the internet, but couldnt find any solutions. When I change the schema.xml-file (from version 2.0 to 2.3), it is not recognized any more - that means, I can call localhost/solr - but it seems solr couldnt find the configurations any more ("404 missing core name in path")
[10:09:05] <bla_> anyway...strange...
[10:12:54] <bla_> looks like the dataDir-property is not recognized any more....whyever...
[10:19:55] <rstolt> When running the paster --plugin=ckanext-harvest harvester fetch_consumer --config=/etc/ckan/default/production.ini command from the cli, I get the following error: DetachedInstanceError('Instance <User at 0x7fe868906910> is not bound to a Session; attribute refresh operation cannot proceed'. Any pointers on why (missing config entry, user role)?
[15:34:41] <rstolt> It seems like it crashes here (https://github.com/ckan/ckan/blob/ckan-2.3/ckan/new_authz.py#L118) due to the missing name property. Whyo?

2015-08-20
[05:29:04] <Manish_> Hi
[05:29:51] <Manish_> I have added extrafield extension but my database schema is not change
[05:30:51] <Manish_> i haven't found how to show those added fields on CKAN view. and how to store those fields in database
[05:44:49] <nigelb> Manish_: What is this extrafield extension?
[05:45:30] <Manish_> I have found on github to make add new fields while adding new dataset
[05:47:10] <nigelb> can you link me to the extension?
[05:47:26] <nigelb> I'm not familiar with this particular extension.
[05:47:36] <nigelb> if you're looking to add extra fields to the dataset form
[05:47:46] <nigelb> You should look at the IDatasetForm interface in CKAN.
[05:48:11] <nigelb> http://docs.ckan.org/en/latest/extensions/adding-custom-fields.html
[05:48:11] <Manish_> Yes i have tried this as well
[05:48:30] <nigelb> And what went wrong?
[05:48:31] <Manish_> but the problem is my database schema is not changed
[05:48:43] <nigelb> The database schema is not expected to be changed.
[05:48:51] <nigelb> The data is stored in the extras table.
[05:49:20] <Manish_> Ok got your point
[05:49:41] <Manish_> so can i get those fields from extra table ?
[05:51:47] <Manish_> and also those fields are not visible on CKAN
[06:09:05] <nigelb> please follow that guide
[06:39:27] <Manish_> i have follow Guide and getting this error  : IndentationError: unindent does not match any outer indentation level
[06:41:39] <nigelb> well, try to find the line number there is an identation error and fix it?
[06:48:55] <Manish_> def update_package_schema(self) :
[07:00:14] <Manish_> Thanks nigelb
[07:00:19] <Manish_> for you help
[07:00:28] <Manish_> problem is solved now
[08:24:38] <mih> Hello! we are getting following error: 'module' object has no attribute 'hybridmethod' - any idea how we could fix that?
[08:31:43] <nigelb> without giving a full traceback, it's pretty much impossible to help.
[08:40:26] <mih> oh, here it is: http://pastebin.ca/3116983
[13:37:37] <Manish> i am getting this error while adding more then one custom fieldsError - <type 'exceptions.KeyError'>: 'resources
[13:38:22] <Manish> Anyone can help me to add multiple custom fields in ckan
[14:37:55] <yanik> Do you think it will be hard, to integrate CKAN with some python CMS, like wagtail? For content-management. I know about WordPress integration but i want to use Python ecosystem only
[14:44:24] <rossjones> yanik should be okay, most integrate with drupal or ckan, but as long as you can solve the shared auth it'll be okay.
[14:45:03] <yanik> thx ross
[14:45:33] <rossjones> yanik there's an IAuthenticator plugin interface you can use.
[14:46:22] <yanik> yup, but in this stage i'm don't sure how much work it takes
[14:47:59] <rossjones> yanik if you get your CMS to authenticate via CKAN, or CKAN to authenticate with CMS, it shouldn't be too much - but I can't really quantify it I'm afraid.
[14:50:29] <yanik> what about routing system? but this part is not hard too, since wagtail is a django :)
[15:01:48] <rossjones> You could just proxypass /dataset and /publisher etc to the CKAN endpoint.
[15:05:55] <yanik> thx, i will consider that!

2015-08-19
[07:46:52] <yanik> any idea why simple pages extension cause this? https://gist.githubusercontent.com/wide-awake/e39b3b7ab9e006e43e83/raw/7ce8fc57b8287d2a905dbf560c7605fad0295ce4/error.log
[07:48:57] <yanik> i add pages successfully, and they looks alright as a list but when i open full url i got "Server Error An internal server error occurred" and above is apache2 ckan_default.error.log
[07:51:56] <Zharktas> that would be broken python code in file controller.py since it uses varibale lxml before it has a value
[07:52:26] <yanik> oh, so package is broken ?
[07:52:55] <yanik> i use this one https://github.com/ckan/ckanext-pages
[07:58:06] <yanik> and yup, looks like they tests are failed, thx
[08:05:57] <yanik> Got it. It was missing lxml dependency.
[08:05:57] <yanik> Install like this (Ubuntu 12.04):
[08:05:57] <yanik> apt-get install libxml2-dev libxslt1-dev python-dev
[08:05:57] <yanik> apt-get install python-lxml
[08:06:12] <yanik> Thx <Zharktas> :)
[10:38:58] <rstolt> Wondering if the following path (https://github.com/ckan/ckanext-harvest/blob/master/ckanext/harvest/templates_new/base.html#L5) is correct? Stuck at the "AttributeError: 'module' object has no attribute 'ckanext-harvest/styles/harvest.css'" issue mentioned here (https://github.com/ckan/ckanext-harvest/issues/103).
[12:03:30] <rstolt> amercader: Do you have an idea for my problem stated at 12:38?
[12:18:28] <rossjones> rstolt I'd guess it may not be, normally they're ckanext/name/something ...
[12:19:58] <rossjones> but I wouldn't take my word for it ;)
[12:20:31] <rossjones> Oh no, wait, it's fanstatic. I've no idea.
[12:21:03] <rossjones> rstolt the file it is trying to load is at https://github.com/ckan/ckanext-harvest/tree/master/ckanext/harvest/fanstatic_library/styles
[12:21:41] <rossjones> and you'll notice at https://github.com/ckan/ckanext-harvest/blob/master/ckanext/harvest/plugin.py#L228 it gives it the name ckanext-harvest so it is probably right
[12:25:32] <rstolt> Looking at your last GitHub line link it also seems okay to me.  Ta for the help.
[12:27:18] <amercader> rstolt: how did you install ckanext-harvest?
[12:30:54] <rstolt> amercader: We install it via an tar.gz located in a requirements folder in an other ckan-extension, but basically via pip install --no-index -f /usr/lib/ckanext-govdatade/requirements <package.-name>.
[12:33:10] <rstolt> Happens of course in an active virtual python environment
[12:33:44] <amercader> rstolt: the tar.gz are just the sources from github? or is it build soemhow?
[12:37:36] <amercader> can you paste me the exact install command. I'm pretty sure the problem is there, as this is not how the extension is generally installed, and maybe something is missing on setup.py or another file to include all files
[12:37:40] <rstolt> amercader: I added two additional entries to the MANIFEST.in (http://pastebin.com/raw.php?i=4V3hyGnk) coming from a git clone, than I do an *python setup.py sdist* and copy the tar.gz over to the requirements folder of the mentioned ckan-extension .
[12:43:25] <rstolt> amercader: we try to install it as a deb package. Here's (http://pastebin.com/raw.php?i=dNJ2gA3H) an extract from the postinst control which does the relevant installation.
[12:50:08] <amercader> rstolt: I'm not sure what's going, I'm not familiar with this way of using pip install. I would imagine that installing ckanext-harvest under the ckanext-govdatade package may be causing the issues.
[12:50:56] <amercader> I replicated your steps but running `pip install --no-index -f pat_to_tar_gz ckanext-harvest` instead and seemed to work fine
[12:51:37] <amercader> sorry I can't be of more help. I'd suggest trying to install it in a way closer to the supported one
[12:55:07] <rstolt> amercader: Thanks for your help, as always :D Do you see a need to add the recursive-include for the styles to the MANIFEST.in (see http://pastebin.com/raw.php?i=4V3hyGnk)) to this PR (https://github.com/ckan/ckanext-harvest/pull/150) on GitHub?
[12:56:11] <amercader> rstolt: yes, the MANIFEST should include all non python files that need to be shipped with the extensions (also the fanstatic folder)
[12:59:26] <rstolt> amercader: Done.

2015-08-18
[08:03:40] <mih> How is it possible to delete a CKAN-user (including all depending data)?
[08:26:15] <mih> since - we have a strange problem: we looked through the users-table and find a few users which seem to be inserted by hackers (or something like that). in general, acces to /user/register is denied -- so, any ideas how it is still possible to create users (e.g. via api)?
[08:48:10] <brook> mih - perhaps an existing user has invited another person to join a group or organization. I think that will create a user.
[11:01:41] <amercader> what a mess with group_list... it should be an "interesting" discussion on the dev meeting  https://github.com/ckan/ckan/issues/2554#issuecomment-132171669
[11:07:15] * brook buys provisions
[13:22:59] <travis-ci> ckan/ckan master 5acbd99 https://travis-ci.org/ckan/ckan/builds/76100901 amercader: The build has errored.
[14:22:49] <yanik> any legal ckan developers here?
[14:24:32] <yanik> I have architecture question. I need to extend basic CKAN functionality. It will be better to extend ckan code or interate it with Django(like example) true the API and write all new features in Django apps?
[14:25:35] <yanik> and test API hard so it will be easy to update ckan in feature
[14:42:32] <amercader> yanik: I'm pretty sure all of us are law-abiding devs :)
[14:43:08] <amercader> yanik: I would suggest building your custom features in a ckan extension. These docs shoudl get you started: http://docs.ckan.org/en/latest/extensions/index.html
[14:43:32] <yanik> thx, legal dev :D

2015-08-17
[11:26:39] <yanik> Hey guys. i try install ckan on ubuntu 14.04 by following docs. but i have error "JSP support not configured" on  my  http://localhost:8983/solr/ page. Can you help? The only answer on stackoverflow not help at all
[11:27:36] <yanik> or it will be the better just switch to ubuntu 12.04 and start from screech ?
[11:30:10] <nigelb> yanik: I'm guessing you installed solr-jetty?
[11:30:23] <nigelb> I *think* there's a problem on 14.04 with solr-jetty and solr-tomcat works better.
[11:30:40] <yanik> i just follow the official docs
[11:31:20] <yanik> so should i try switch to solr-tomcat ?
[11:33:53] <nigelb> Worth trying. Or try installing solr directly https://www.digitalocean.com/community/tutorials/how-to-install-solr-on-ubuntu-14-04
[11:34:18] <yanik> ok, thx man :) have a good day
[11:42:57] <yanik> yeah, it helps
[11:44:07] <yanik> how can i now switch it solr-jetty for this installation?
[11:59:00] <rossjones> wardi_ you're on holiday - stop beating me to emails when you're not working :P
[12:04:37] <nigelb> lol
[12:06:48] <nigelb> rossjones: Though that email makes me realize we can never get rid of the OFS stuff any time soon.
[12:07:04] <nigelb> what I'd love to do is rip it out from core and make it a plugin so people can fallback if they'd like.
[12:07:09] <nigelb> but there's no clean way to do it :|
[12:07:29] <rossjones> nigelb I think maxious did a cloud-based storage extension somewhere, can't find it right now though.
[12:07:41] <rossjones> i.e from browser straight to S3.
[12:07:49] <nigelb> rossjones: Yep, yep. That's all fine.
[12:07:56] <nigelb> What I want to do is remove the old dead code.
[12:08:09] <rossjones> nigelb just delete it, see if anyone notices :)
[12:08:27] <nigelb> If I delete it people will have to go to the version *just before deletion* to upgrade to new filestore.
[12:08:31] <nigelb> That's the problem :\
[12:08:37] <nigelb> I could potentially make it read-only.
[12:08:47] <nigelb> as a first step
[13:30:57] <yanik> Ha-ha, hit another problem in ubuntu 12.04 now
[13:31:01] <yanik> have a bad luck ;/
[13:31:19] <yanik> can you look nigelb? :) http://codeshare.io/QLany
[13:31:32] <yanik> it's "HTTP ERROR 500
[13:31:32] <yanik> Problem accessing /solr/. Reason:
[13:31:32] <yanik> Unable to find a javac compiler;"
[13:31:50] <yanik> i figure out its something with folder rights?
[13:31:54] <nigelb> nope
[13:31:59] <nigelb> check out common errors
[13:32:02] <nigelb> In the docs
[13:32:06] <yanik> thx!
[13:32:11] <nigelb> you need to set JAVA_HOME in /etc/default/jetty
[13:32:20] <nigelb> Or in tomcat's config
[13:32:25] <nigelb> I think that's the case, at least.
[13:32:56] <yanik> done it before
[13:34:25] <yanik> my JAVA_HOME=/usr/lib/jvm/java-6-openjdk-amd64/
[13:35:17] <yanik> and i use solr-jetty, i switch OS to 12.04
[13:35:59] <yanik> was hoping docs will work from scratch , for 12.04, buy they not
[13:40:55] <yanik> wow, different error
[13:41:04] <yanik> Problem accessing /solr/. Reason:
[13:41:04] <yanik> Unable to load class for JSP
[13:42:21] <yanik> you mean check solr docs or ckan docs?
[13:44:14] <nigelb> bah, the one I thought was the error for JDK
[13:44:26] <nigelb> I'm not exactly sure what's the cause of the one you're seeing now.
[13:44:28] <nigelb> never seen it before.
[13:47:27] <yanik> maybe i switch JDK to version 7?
[13:49:04] <wardi_> rossjones: just got back. the trick to fast emails is doing no research and providing no links to specific source locations ;-)
[13:49:15] <yanik> wow, error switches from this to this one: It is currently set to "Unable to find a javac compiler;
[13:49:15] <yanik> com.sun.tools.javac.Main is not on the classpath.
[13:49:15] <yanik> Perhaps JAVA_HOME does not point to the JDK.
[13:49:15] <yanik> It is currently set to "/usr/lib/jvm/java-6-openjdk-amd64/jre"
[13:49:15] <yanik> "
[13:49:41] <yanik> but my JAVA_HOME is JAVA_HOME=/usr/lib/jvm/java-6-openjdk-amd64/, how its even possible?
[13:50:17] <yanik> speaking to me?
[13:51:51] <yanik> file /etc/default/jetty
[14:44:10] <yanik> hey guys, can you tell my any grown CKAN apps hosted on github?
[14:45:07] <yanik> i cant figure out the best project structure, and don't sure what should i keep in repository
[20:47:05] <corebits> wardi_: Thanks, Really looking forward to the next iteration. After some holiday's ;)

2015-08-16

2015-08-15
[15:33:21] <SkramX> whats the largest dataset anyone has seen or put onto CKAN datastore and used the API with?
[15:36:07] <almereyda> We also had this discussion today here at #cccamp ; did anybody try mirroring OSM dumps in CKAN?
[15:36:55] <SkramX> oh cool - I have heard of CCC via 2600 but never via open data circles
[15:37:34] <SkramX> @almereyda - I suppose it would be limited by CKAN datastore which I believe can only be backed by postgres.. so it all depends on the machine CKAN runs on
[15:37:43] <SkramX> also has anyone done a clustered/sharded/partitioned approach for CKAN?
[15:46:21] <almereyda> i believe ckan can also talk to object storage, like swift, ceph, glusterfs, etc., no?
[15:49:07] <SkramX> but that wouldnt be queryable via API - that would be just flat files, right?

2015-08-14
[11:03:51] <amercader> corebits: congrats, http://open.alberta.ca looks stunning
[15:49:38] <corebits> amercader: Thank you, we are quite happy with how it has turned out so far.
[15:50:15] <amercader> corebits: is that Morraine lake on the front page?
[16:00:50] <corebits> It might be, I would have to check
[16:06:28] <corebits> amercader: the shot is actually of Lake Louise
[16:07:30] <amercader> corebits: that's the one I meant! they are next to each other
[16:07:38] <amercader> one of the most beautiful places I've been
[16:08:27] <corebits> Yes, very close. And a good reminder I haven't been for a few years.
[16:08:31] <corebits> ;)
[22:15:37] <wardi> corebits: congrats!

2015-08-13

2015-08-12
[15:28:02] <corebits> Hi all, wanted to say once again thanks for all the terrific support and guidance, the new http://open.alberta.ca is being unlocked today.
[15:28:31] <corebits> Has been a fun journey for sure. ;)
[15:34:04] <muloka> nice, congrats
[15:34:15] <muloka> what version of ckan are you using ?
[15:38:51] <corebits> 2.3
[16:05:55] <denisz> great job corebits, congrats on the rollout. site looks really nice
[16:18:37] <corebits> Thanks, Offcial announcement should be later today, working out a few wrinkles ...
[16:18:39] <corebits> ;)
[16:19:21] <corebits> Moving to ckan is a huge step above the old http://data.alberta.ca

2015-08-11
[08:32:00] <rossjones> jmignault does  http://stackoverflow.com/questions/30355839/ckan-local-installation-500-error-on-solr-jsp-support-not-configured  help?
[11:50:12] <mih_> hi! we are currently updating to ckan 2.3.1 (from 2.2) - we noticed that the pdf_preview-plugin was removed in ckan 2.3. What is the new option to view pdf-files?
[11:51:45] <mih_> probably recline_view?
[11:54:37] <mih_> mean pdf_view ;)
[11:56:27] <wardi> mih_: yes that one. should be mentioned in the release notes
[12:03:57] <amercader> dev meeting: https://plus.google.com/hangouts/_/event/cb1vmkss426lkqicj94a3amvd1c?hl=en-GB&authuser=0
[12:04:07] <amercader> rossjones: do you want to join?
[12:07:25] <rossjones> will it result in more work for me?
[12:07:33] <rossjones> aye, gimme a min.
[12:33:51] <rossjones> imghdr
[13:00:30] <amercader> sorry guys need to drop the flask fan club, speak on Thu/next week
[13:01:49] <wardi> amercader: hah!
[13:02:04] * wardi will have no internet thursday
[13:04:33] <amercader> wardi: enjoy your vacation and forget about ckan!
[14:04:52] <rossjones> Don't worry, we'll make amercader listen to us ramble on about Flask ;)

2015-08-10
[10:44:02] <amercader> rossjones: do you know if DGU caches CKAN API calls?
[10:44:31] <amercader> or anybody else?
[10:44:40] <amercader> namely package_show of course
[10:46:19] <joet> amercader, if i recall they just use varnish, not sure of the exact setup
[10:47:56] <amercader> cool, will be good to know details of this
[11:39:13] <rossjones> amercader we use varnish and we also rate limit in nginx
[11:39:54] <rossjones> nginx -> varnish -> (ckan or durpal).
[11:47:58] <amercader> rossjones: how do handle keeping the cache up to date (eg after a dataset update), do you have extensions to ping varnish after an update? or is it just time based?
[11:48:11] <amercader> sorry, I'm not super familiar with these tools
[11:48:34] <rossjones> it gets ejected after a bit, unless you're logged on and then we often don't cache at all
[11:48:43] <rossjones> caching is for spiders in our case. mostly.
[11:50:21] <amercader> so you are not actively purging individual entries in the cache, just expiring them after a bit
[11:55:41] <rossjones> As far as I remember yes.
[11:56:01] <rossjones> dread might have a better memory, and should be on the call tomorrow.
[11:56:11] <amercader> cool, tahnks
[11:56:19] <rossjones> amercader: Do you know if there's been any discussion of https://github.com/ckan/ideas-and-roadmap/issues/152 anywhere?
[11:56:49] <amercader> not that I'm aware of
[11:56:52] <rossjones> sigh
[11:56:56] <rossjones> ok.
[11:57:24] <rossjones> I'll save the ML grumpy mail until I'm feeling more grumpy.
[12:48:11] <rossjones> Who knew that there's a sqlalchemy example (http://docs.sqlalchemy.org/en/rel_1_0/orm/examples.html#versioning-objects) for how to version objects ... ?
[12:50:04] <nigelb> so we kill vdm tomorrow?
[12:50:37] <rossjones> why wait?!
[12:55:04] <nigelb> rossjones: :D
[13:37:12] <knud> Hi. A question regarding ckanext-harvest: When is a job "finished"?
[13:38:31] <knud> gather queue and fetch queue seem to be done, all objects seem to have been imported, yet the job still shows up as "running"
[13:39:11] <Zharktas> you need to run the harvester again, if the job is done, it will mark it as finished
[13:40:45] <Zharktas> unless it's crashed or something, then it will never finish
[13:40:59] <knud> That did it, thanks.
[13:41:23] <knud> is that intended? I did run it, it finished, but the status remained at "running".
[13:42:27] <Zharktas> you are supposed to run it in cron, it will mark it finished at some point
[13:43:35] <Zharktas> and if there's a new job, cron will execute it eventually
[13:44:05] <Zharktas> it was confusing at first :p
[13:54:23] <knud> zharktas: hm, ok. I'm adjusting the harvester code at the moment, so I'm running it manually from the command line, using paster.
[14:11:44] <knud> another thing I noticed about ckanext-harvest: I can set the 'type' field only on the first import. If the dataset gets updated later, changes to 'type' in the code are ignored.
[18:39:15] <jmignault> Hey, all. I am installing ckan on Ubuntu from source, running solr on Jetty, and cannot access http://localhost:8983/solr. I get a 500 and the message that 'JSP support not configured. I have searched and not found an answer. Any suggestions?

2015-08-09

2015-08-08

2015-08-07
[07:25:20] <Zharktas> what would be the easiest way to migrate existing datasets (with existing custom schema) to ckanext-scheming and ckanext-fluent ?
[08:30:29] <rossjones> HyperJohnGraham wardi is right, you should use the ckanapi so you can add pages like http://hpwren.ucsd.edu/cameras/BL.html as a dataset, but you should probably check out https://github.com/open-data/ckanext-scheming as a useful extension.
[08:38:07] <davidmiller> Morning ckan!
[08:38:24] <davidmiller> Where is the appropriate place to discuss potential ckan security issues?
[08:47:27] <brook> davidmiller: Please send security issues to security@ckan.org. Thanks!
[08:47:37] <davidmiller> tvm brook !
[09:43:31] <rossjones> brook has the security repo moved?
[09:44:25] <brook> rossjones: It's no longer on github.
[09:44:30] <rossjones> gitlab?
[09:45:26] <brook> I couldn't possibly say. (Yes).
[09:46:19] <amercader> https://gitlab.com/ckan/ckan-security
[09:46:42] <amercader> you should have access rossjones
[09:49:23] <rossjones> 404 for me with my ross@servercode acct :(
[09:51:57] <amercader> You are listed as this user:  rossjones
[09:52:21] <rossjones> thanks amercader I'll see if I can remember how I authd ;)
[09:57:14] <rossjones> I've got a couple more, will send via list
[16:30:20] <64MADJQ52> rossjones I dont want to add web pages ... I want to add the folders under those pages that hold millions of images.
[16:30:46] <64MADJQ52> Hmmm that's not me ;)
[16:31:25] <HyperJohnGraham> Ahhh hThats better
[16:32:41] <HyperJohnGraham> is there an existing method for injecting the urls of an image archive ?
[17:36:28] <rossjones> HyperJohnGraham Not one called inject_urls_from_this_archive, no ;) Datasets are metadata, and have associated resources - resources are normally data files of some description.  You probably want a dataset per camera, and then a resource per whatever.  Probably not a resource per file as you'll end up with thousands.
[17:48:45] <wardi> Zharktas: ckanapi dump datasets ... | munge_my_json.py | ckanapi load datasets ...
[17:49:22] <wardi> Zharktas: with separate instances holding the old and new metadata
[17:49:48] <wardi> not that this won't automatically re-upload files or datastore tables for you
[17:49:54] <wardi> *note
[17:50:19] <wardi> that would be a cool thing to add to ckanapi though
[19:22:32] <Zharktas> wardi: thought as much that i need to do this with two instances, oh well got to do it some day

2015-08-06
[09:06:44] <rossjones> HyperJohnGraham are the images served via an HTTP endpoint somehow?
[11:44:17] <wardi> HyperJohnGraham: how will you represent them? About how many datasets will you have any how many resources will each dataset have?
[11:46:23] <wardi> I like using the API to load metadata. "ckanapi load datasets" can bulk load and comes with an option to work in parallel with multiple processes remotely or locally on the instance directly
[14:02:32] <amercader> dev meeting?
[14:02:32] <amercader> https://plus.google.com/hangouts/_/event/cb1vmkss426lkqicj94a3amvd1c?hl=en-GB&authuser=0
[15:55:09] <rossjones> amercader on your call, could you assign someone my new PR #2571 please? ;)
[15:57:28] <amercader> good stuff rossjones, I might be able to have a look at it tomorrow, if not next Tue will be adopted by someone
[15:57:58] <rossjones> amercader great thanks.  I need to merge the new datastore/pusher stuff to DGU ( :(  ) and don't want to merge it twice ;)
[15:58:16] <rossjones> We are slowly moving towards just using core ckan. Slowwwwwly.
[15:58:37] <amercader> amazing
[15:59:38] <rossjones> Another couple of years and we'll be there.
[19:18:51] <HyperJohnGraham> rossjones yes http://hpwren-cams.ucsd.edu/cameras/
[19:19:44] <HyperJohnGraham> wardi we are constantly adding cameras currently recording a frame every 2 minutes
[19:20:37] <HyperJohnGraham> we are collaborating with other universities who want to do 1 frame per second
[19:22:04] <HyperJohnGraham> te intention is to make the system a searchable archive for researchers to download blobs of data packages by their search params
[19:24:32] <HyperJohnGraham> we also intend on adding lots of metadata like viewshed from camera location. Model and camera settings.

2015-08-05
[10:40:15] <shellac> asked a bit late yesterday: I need to mass-move packages from one group to another. Is there a simple way to do this?
[10:40:55] <shellac> it seems like going direct to the database member table will do the trick, but perhaps there are issues here?
[10:41:27] <shellac> (there is also member_revision, of course)
[10:44:18] <joet> shellac, you can probably use group_update
[10:45:35] <joet> shellac, you can give group_update a list of datasets and it'll update the memebers
[10:45:58] <joet> there was some annoying behaviour that if you didn't provide the list of datasets in the data_dict it would wipe out all the members
[10:46:08] <joet> but this sounds like the behaviour you actually want
[10:50:05] <joet> so you could do something like "ckanapi action group_show id=mygroup | jq '.+{"datasets":[]}' | ckanapi action group_update -i" using wardi's ckanapi command line
[10:50:52] <joet> although i think the key is probably going to be "packages" or something like that
[10:50:56] <shellac> oh lord, this sounds exciting :-)
[10:51:29] <shellac> thanks, will have a go. will dump database first, though.
[14:08:50] <rossjones> Hi, tests are failing for me on master - is this expected?
[14:10:23] <amercader> rossjones: no, they should be fine. Look ok on travis
[14:10:35] <amercader> rossjones: welcome back by the way :)
[14:12:02] <rossjones> amercader thx. don't suppose you've seen https://gist.github.com/rossjones/da881ad1763b2d86e855 before?
[14:14:13] <amercader> no, sorry
[14:14:23] <rossjones> I hate computers.
[14:14:35] <amercader> it does look terrible though, date - int?
[14:14:58] <rossjones> yeah, no tz on the timestamp without timezone.
[14:15:03] <rossjones> wonder whether it's a setup thing
[14:15:30] <rossjones> turning off tracking and trying again :)
[14:28:37] <rossjones> amercader if you wanted to re-add me to the org so I can store some branches there... that'd be very cool.
[14:28:42] <rossjones> :P
[14:31:38] <amercader> done
[14:32:36] <rossjones> thx :)
[16:18:46] <rossjones> amercader looked like it wanted me to rebuild the DB after making sure my VM had a valid timezone set (and postgres told about it).
[18:17:54] <HyperJohnGraham> Hi All
[18:19:49] <HyperJohnGraham> I am interested in publishing 50TB of jpeg images from webcams on mountain tops
[18:20:37] <HyperJohnGraham> I have servers that hold the data already on the web so i dont want tocopy them into a new place
[18:21:21] <HyperJohnGraham> I am running the ckan docker on a VM that has a NFS mount to the images
[18:22:41] <HyperJohnGraham> What path should i take ? write a harvester ? use the API to index them ?

2015-08-04
[05:19:27] <manish_> hello Group
[05:19:48] <manish_> i am getting error while i am customizing theme in ckan
[05:20:46] <manish_> while adding this line in my developement.ini  : #ckan.plugins = stats text_view recline_view odp_theme
[05:20:57] <manish_> i am getting plugin not found error
[05:21:07] <manish_> anyone can help me out
[12:01:41] <wardi> amercader: can't make this meeting
[12:02:04] <wardi> joet, brook ^
[12:04:02] <amercader> wardi: there aren't any new PRs or issues so we can probably skip it. I'll wait for a few minutes in case someone comes by
[16:25:06] <shellac> I need to move all packages in one group to another group
[16:25:29] <shellac> is there an easy way to do this? is it best to go direct to the database?
[19:02:33] <corebits> wardi: just looking at ckanapi 3.5 datapackages option, does a path exist to import from datapackages as well ?
[21:28:14] <TkTech> (He's on vacation, may not respond for awhile)
[21:59:08] <corebits> TkTech: Thanks.

2015-08-03

2015-08-02

2015-08-01

2015-07-31
[10:35:30] <amercader> https://caniusepython3.com/check/1a16c0fe-93a0-4ae6-93c1-1b9c27b8a14f
[10:35:39] <amercader> almost
[10:36:22] <amercader> although is misleading, because we are stuck on some particular versions of the ones passing which probably don't support python 3
[10:50:53] <travis-ci> ckan/ckan 1903-new-authz-removal 65abbc3 https://travis-ci.org/ckan/ckan/builds/73534715 amercader: The build has errored.
[12:38:25] <wardi> amercader: neat
[12:40:06] <wardi> i bet a bunch of our pinned versions are because pylons
[12:40:25] <amercader> yep
[12:43:23] <wardi> i still think we should make a headless ckan (api, some plugin interfaces, db, solr) and focus on porting that
[12:48:02] <wardi> haven't figured out the business case though.
[13:35:32] <amercader> good lord group_list is the most inefficient action I've seen
[13:36:15] <amercader> "ask for everything just in case we need it later"
[13:42:19] <wardi> amercader: more include_datasets, include_users parameters required to go with the changes to the other actions

2015-07-30
[08:13:10] <pauli_> Heya. Someone got a hint for me on how to fix the following Error?  PluginError: Plugin class '<GovDataHarvester>' does not implement an interface, and it has already been defined in e nvironment ''pca''
[08:13:13] <pauli_> GovDataHarvester source here (https://github.com/fraunhoferfokus/ckanext-govdatade/blob/master/ckanext/govdatade/harvesters/ckanharvester.py) on GitHub.
[10:22:26] <pauli_> What's also strange is that the system tries to load an extension that's not configured in the ckan.plugins list.  A puzzzled me.
[10:35:11] <amercader> pauli_: try an run `python setup.py develop` on your extension with the virtualenv enabled
[10:35:42] <amercader> it looks like there were changes in the registered plugins and perhaps you have outdated references
[10:35:43] <amercader> https://github.com/fraunhoferfokus/ckanext-govdatade/commit/6714ccb4f6bc32a843788741ca3262681b3ce74a
[10:39:33] <amercader> Also if your plugin class has a __init__ method you should probably call super().__init__() as the parent classes are likely to do some stuff in there as well
[10:39:35] <amercader> https://github.com/fraunhoferfokus/ckanext-govdatade/blob/master/ckanext/govdatade/harvesters/ckanharvester.py#L53
[10:43:00] <pauli_> amercader: Does the position of the plugins in the ckan.plugins list matter? Our build sets it at the beginning an it halted / faulted the whole CKAN instance; a move to the end made this disappear.
[10:43:20] <pauli_> amercader: Gonna try your suggestions.  Ta.
[10:43:23] <amercader> pauli_: yes, it does
[10:43:37] <amercader> they will be loaded in the order you define them
[10:44:11] <pauli_> So advice would be to add custom ones at the end.
[10:46:03] <amercader> it depends, if you want to make sure for instance that your plugin overrides a particular url or template you should put them last
[10:46:41] <amercader> or if you load your harvesters before the harvest plugin perhaps this causes issues if your harvesters extend the core ones
[16:47:22] <corebits> On 2.3 If I use the paster datapusher submit command, I only process files the datapusher already knew about. How do I get all available uploaded resources into datapusher for processing ?
[16:48:49] <corebits> Example, I have 500+ CSV files as attached resources, I'd like to process them all with datapusher. #paster datapusher submit only sees 17 that I previously submitted to the datastore
[17:04:41] <amercader> corebits: looking at the documentation for the paster datapusher it looks like your best bet is getting the dataset ids somehow (eg package_search with res_format:CSV) and then use them to call `paster datapusher submit <id>` on each of them
[17:18:15] <corebits> amercader: that seems to be a reasonable approach. Although passing the ID to datapusher submit, appears to have no effect.
[17:19:31] <wardi> corebits: which id are you passing?
[17:19:49] <corebits> I passed the resource id
[17:21:38] <amercader> no, it's the dataset id you need to pass
[17:21:54] <amercader> corebits: ^
[17:22:18] <corebits> One moment, Iwill try this again
[17:24:39] <amercader> boo ckanext-scheming doesn't allow me to override the additional info table from my extension
[17:25:13] <amercader> I'll investigate a bit more tomorrow
[17:28:18] <corebits> Hmmm, passing the dataset id has the same effect.
[17:33:57] <corebits> I'll come back around to this issue later. The datapusher is working fine for newly added resources.
[17:34:52] <corebits> Got word were launching sometime in the second week of august.
[19:12:15] <travis-ci> ckan/ckan master a286399 https://travis-ci.org/ckan/ckan/builds/73430296 Ian Ward: The build was broken.

2015-07-29

2015-07-28
[12:02:02] <wardi> meeting?
[12:12:08] <amercader> https://github.com/ckan/ckanext-dcat/#profiles
[12:18:50] <amercader> main.debug.min.css
[12:27:24] <amercader> https://gitlab.com/ckan/ckan-security/issues/5
[16:40:34] <amercader> woo, I closed the oldest open CKAN issue!
[16:40:36] <amercader> https://github.com/ckan/ckan/pull/348
[17:06:58] <nigelb> amercader: \o/
[17:07:16] <nigelb> I need to rip out some dead code this week.
[17:19:50] <wardi> amercader: nice!

2015-07-27

2015-07-26

2015-07-25
[21:53:42] <rehunted> hello, Did paster was removed from https://github.com/ckan/ckan/tree/master/bin?
[21:57:07] <rehunted> okay, I guess paster is a python commaand
[21:57:18] <rehunted> and that Virtualenv is not activated
[21:57:46] <rehunted> since i'm running the Dockerfile, I should update it, because it is wrong/missconfigured
[22:45:21] <rehunted> oh I got it!
[22:45:49] <rehunted> i'm using https://github.com/ckan/ckan-docker and I replacted _src with the ckan source itself
[22:45:57] <rehunted> but it should be the ckan
[22:46:27] <rehunted> pasterscript was not installed, because none deps were installed!

2015-07-24
[08:13:59] <pauli> Someone in here w/ experience in running CKAN w/ a master slave Solr infrastucture? Is possible to split CKAN Solr reads and writes? Ta in advance.
[10:06:50] <sergio-m2c> hello?
[10:22:43] <sergio-m2c> hi?
[12:37:38] <pauli> Just trying to access the /harvest path of an ckan 2.3.1 instance wo/ much success. The only Error I'm seeing in the logs is a template (source/search.html?) cannot be found one.  Any hints on how to fix this?
[12:51:47] <amercader> pauli: I remember a user having the same issue, but I wasn't able to reproduce it: https://github.com/ckan/ckanext-harvest/issues/103
[12:52:06] <amercader> can you paste the stacktrace in a pastebin or gist
[13:01:15] <pauli> amercader: One month valid pastebin http://pastebin.com/raw.php?i=EFGSmzH3
[13:02:40] <pauli> amercader: /harvest/new seems to work, though prompting me for a password ;D
[13:08:30] <amercader> pauli: that is to be expected if you are not a sysadmin
[13:08:41] <amercader> (the login prompt)
[13:09:13] <amercader> I can't see anything on the stack trace. I'm assuming you added the harvest plugin to your ini file
[13:09:34] <amercader> is this a new install or upgraded from a previous version?
[13:11:27] <pauli> amercader: Sorry I'm taking everything regarding /harvest/new back it sadly fails too, see other pastebin http://pastebin.com/raw.php?i=mr5xc5Wi
[13:13:19] <pauli> Yes is configured as a plugin and also shown via api/3/action/status_show. Install is a fresh one.
[13:17:01] <pauli> amercader: Also have this behaviour on a via Vagrant provisioned box, which worked fine w/ 2.3.0
[13:19:00] <amercader> pauli: could you paste a pip freeze of your virtualenv please?
[13:19:33] <pauli> amercader: Sorry for getting all query on you ;D Is there a reason why ckanext-harvest isn't on the CheeseShop?
[13:19:42] <pauli> amercader: One sec
[13:22:08] <pauli> amercader: Have a peek http://pastebin.com/raw.php?i=UDp5V863
[13:25:44] <amercader> pauli: nothing suspicious there
[13:26:42] <amercader> I'll have to do a fresh install and try to reproduce it. It'd be helpful if you could add the links to the pastebins as a comment on the issue I linked before on ckanext-harvest
[13:27:02] <amercader> regarding pypi, I guess because no one has asked before :)
[13:27:24] <amercader> and we are not following  a version number release schedule, rather a rolling one
[13:34:43] <pauli> amercader: Should I post them in the comments or create new ones? Have set a one month livetime on all of them.
[13:35:33] <amercader> If you don't mind creating permanent ones that will be tidier
[13:44:53] <pauli> amercader: Done.
[13:46:06] <amercader> thanks, I'll try to have a look soon
[13:46:19] <amercader> did a server restart have any effect?
[13:54:39] <pauli> amercader: Sadly no, tried several times.
[18:16:27] <corebits> Hey Guys, We just added a new field to a custom ckanext-scheming schema. What would be my best approach to perform a bulk insert for this new field.
[18:18:04] <wardi> corebits: package_patch one at a time?
[18:19:01] <wardi> you could get your list of datasets with package_list then loop over them with `ckanapi action package_patch` calls
[18:19:59] <corebits> Ok, let me peek at that. I had not see package_patch previously
[18:56:48] <wardi> corebits: it's a 2.3 thing
[19:22:04] <corebits> wardi: Perfect, since were on 2.3 for this release. Just trying out package_patch now
[19:23:37] <corebits> Just realized this could likely be one of my last few tasks on this project. :(
[19:24:07] <wardi> corebits: moving on to something different?
[19:28:57] <corebits> Phase 1 is wrapping up. I may get the oppourtunity for a phase 2. Unsure yet
[19:38:18] <corebits> wardi: I presume I can utilize package_patch similar to how you describe thhe package_update example here https://github.com/ckan/ckanapi#shell-pipelines
[19:40:57] <wardi> yes, but you'll need to get the list of ids or names then loop over them

2015-07-23
[10:01:00] <shellac> we're serving up ckan at a non-top level url. site_url is http://example.com/data/, and we've adjusted the theme so resources (e.g. css) are resolved accordingly. however this interacts badly with serving over https
[10:02:15] <shellac> any better ways to do this? tempted to try site_url='//example.com/data/' or even more simply '/data/', but I'll bet something will expect to be an absolute url
[10:14:07] <Zharktas> our site_url is just https://somedomain.com
[10:14:27] <Zharktas> and then we have site_url_internally = https://somedomain.com/data/
[10:22:09] <Zharktas> at least archiver is using that convention
[10:30:30] <shellac> Zharktas: yes, I'm tempted to simply not use site_url. the docs suggest we're sort of abusing it.
[10:30:32] <shellac> thanks
[17:08:24] <joet> bloody detached instance errors, all I want is a session.rollback in an action. it's no much to ask
[18:45:03] <wardi> joet: for sure, we should be able to manage transactions
[18:46:23] <joet> wardi, this was in a test, the rollback invalidates anything in the test run, which causes some problems
[18:47:10] <joet> i tried adding a begin_nested(), but I suspect check_access, get_action or somewhere else is running multiple calls to commit(), so I don't really have control over the nested transaction
[18:47:30] <joet> and I'm not really in the mood to step through code execution to find where it is today

2015-07-22
[10:59:16] <travis-ci> ckan/ckan release-v2.3.1 920313d https://travis-ci.org/ckan/ckan/builds/72093716 David Read: The build was broken.
[12:31:30] <travis-ci> ckan/ckan release-v2.4.0 abe2de0 https://travis-ci.org/ckan/ckan/builds/72102616 David Read: The build has errored.
[13:43:35] <wardi> \o/

2015-07-21
[06:41:48] <R0ok_> hi people. I've been working on an ansible playbook for building & deploying ckan on ubuntu. check it out & contribute if you can :) https://github.com/oguya/ansible-ckan
[15:12:44] <corebits> What is the best way to trigger datapusher to process existing resources ?
[16:01:10] <amercader> corebits: starting from ckan 2.3 there is a "paster datapusher" command to resubmit files I think
[17:06:05] <corebits> amercader: thank you, that was exactly the option I was looking for ;)
[17:55:09] <TheCoffeMaker> Hi ... sorry to bother ... I'm having a few issues with a ckan instalation ... I'm using de docker image and when I try to see a csv dataset it throws an error with the dataproxy ... checking the dataproxy it says that it shouldn't be used anymore

2015-07-20
[15:07:20] <knud> good afternoon
[15:17:18] * wardi waves
[17:35:35] <travis-ci> ckan/ckan release-v2.3.1 276bfc1 https://travis-ci.org/ckan/ckan/builds/71803099 David Read: The build was broken.
[17:57:25] <travis-ci> ckan/ckan release-v2.4.0 9f3090d https://travis-ci.org/ckan/ckan/builds/71805086 David Read: The build was broken.

2015-07-19

2015-07-18

2015-07-17
[10:21:25] <travis-ci> ckan/ckan 2538-organization-search 226c641 https://travis-ci.org/ckan/ckan/builds/71393145 Brook Elgie: The build was broken.
[10:23:44] <brook> Travis Roulette
[10:37:09] <DragonDave> I'm currently finding it's about 50/50 as to whether Travis successfully installs the unchanged prerequisites to a build.
[10:37:19] <DragonDave> which is unhelpful

2015-07-16
[00:19:41] <coasterz> I was succesfuly able to make the ckanext-dcat work just fine on 2.2
[00:21:00] <coasterz> Now I just need to figure out how to replace a few tags on import, as they have special chars tag+ tag's etc. Any tips on that would be super appreciated
[09:32:54] <travis-ci> ckan/ckan master db19a58 https://travis-ci.org/ckan/ckan/builds/71218337 Joe Tsoi: The build was broken.
[09:33:09] <joet> oh fs
[14:52:16] <travis-ci> ckan/ckan release-v2.3.1 efe4d4f https://travis-ci.org/ckan/ckan/builds/71257536 amercader: The build was broken.
[17:38:26] <plaguewolf> hello all. does anybody know what the deal is with the missing contracts?
[17:38:50] <plaguewolf> things were working fine up until i added the last few mods, then when i start a new game i have no contracts
[17:39:33] <wardi> plaguewolf: sorry, wrong ckan
[17:39:51] <plaguewolf> ah, woops.

2015-07-15
[19:03:05] <coasterz> Hey guys, What is the best method to determine what version of ckan an extenison supports ? Currently trying to get ckanext-dcat working with 2.3 without success
[19:05:46] <coasterz> I keep getting back "No harvester could be found for source type dcat_json"

2015-07-14
[12:04:02] <joet> brook meeting?

2015-07-13
[13:41:20] <pauli_> How can I enable login to the console in CKAN paste commands? Don't want to fall back onto simple print statements.
[13:41:38] <pauli_> s/login/logging
[14:38:14] <wardi> pauli_: you can use a different ini file for your paster commands that inherits from the default one but overrides the logging settings
[15:11:53] <pauli_> Wardi: Ta.Delicacy was qualname and handler naming; but's working now :D
[18:40:45] <sublimate> Hi all, is there a general command for me to be able to watch all less files in CKAN and its extensions?

2015-07-12

2015-07-11

2015-07-10
[13:08:00] <mih> When ckan 2.4 will be released?
[13:13:24] <mih> approximately?

2015-07-09
[09:29:27] <mih> anyone here who has expierence with the budgets-extension?
[10:19:14] <rgrp> mih: yes - though can i recommend asking your question in the forums as not many folks here know about that http://discuss.okfn.org/category/openspending
[11:05:23] <mih> rgrp: thanks!

2015-07-08
[09:16:58] <mih> does anyone already have tested the ckanext-budgets?

2015-07-07
[12:01:57] <wardi> meeting? https://pad.okfn.org/p/ckan-meeting
[12:25:49] <joet> haha wardi it just occured to me linking to the old docs on that issue would probably boost their search ranking some more
[12:26:29] <wardi> won't matter if I kill them
[12:27:03] <wardi> maybe include the search query too so I can add the redirects necessary to fix the links on the first page of results

2015-07-06
[08:53:12] <travis-ci> ckan/ckan 2489-admin-config-tests 840f335 https://travis-ci.org/ckan/ckan/builds/69692714 joetsoi: The build was broken.
[09:33:21] <travis-ci> ckan/ckan 1792-filterable-resource-views 1fb28ae https://travis-ci.org/ckan/ckan/builds/69702371 Vitor Baptista: The build has errored.
[16:46:06] <coasterz> Hi guys' I have hit a brick wall trying to harvest some csw records. The portal I am harvesting from does not have the recordsSchema in the http://www.isotc211.org/2005/gmd format, only the http://www.opengis.net/cat/csw/2.0.2 schema formats. When harvesting from this esri geoportal can I somehow tell the harvester to use the csw schema vs. the gmd schema ?
[16:46:50] <coasterz> I have modified the csw harvester to look only for the csw schema, and can get an index of the records, but cannot obtain any metadata

2015-07-05

2015-07-04

2015-07-03
[06:34:18] <R0ok_> thanks guys, I've finally figured it out! app_instance_uuid = `/path/to/virtualenv/bin/python -c "from paste.script.util import uuid; print uuid.uuid4()"`
[06:34:34] <R0ok_> beaker.session.secret = /path/to/virtualenv/bin/python -c "from paste.script.util import secret; print secret.secret_string()"
[07:34:50] <R0ok_> Thanks for the help people. I'm currently writing an ansible playbook to deploy solr-2.3 on a clean ubuntu 14.04. https://github.com/oguya/ansible-ckan
[07:35:07] <R0ok_> s/solr/ckan/
[14:11:35] <carneirao> Hi! I'm following this tutorial: https://ckan.readthedocs.org/en/1377-javascript-tutorial/theming/templates.html . But I'm having problems in the step 6.
[14:11:54] <nigelb> carneirao: what are you trying to do?
[14:11:59] <nigelb> that tutorial is really old
[14:12:29] * wardi wants to nuke all the old docs on rtd
[14:12:34] <carneirao> Log returns this: http://pastebin.com/V3ekmkm6
[14:12:57] <nigelb> wardi: so do I, so do I.
[14:13:20] <wardi> nigelb: I have the permissions now, I think
[14:13:43] <nigelb> wardi: It's not a permission thing, the last time I tried, there was no option to.
[14:14:20] <nigelb> carneirao: fairly sure you don't have a file called plugin.py
[14:14:33] <nigelb> or you've made a mistake somewhere about defining it.
[14:15:26] <nigelb> Please try using http://docs.ckan.org/en/latest/theming/templates.html instead of the one you're following.
[14:15:35] <carneirao> (default)vagrant@vckan:/usr/lib/ckan/default/src/ckanext-example_theme$ ls ckanext/example_theme/
[14:15:35] <carneirao> fanstatic  __init__.py  plugin.py  public  templates  tests
[14:15:43] <carneirao> fanstatic  __init__.py  plugin.py  public  templates  tests
[14:16:18] <nigelb> what does entry_points in setup.py say?
[14:20:48] <carneirao> http://pastebin.com/DPLf6UuB
[14:21:18] <nigelb> can you rename example_theme to something else
[14:21:25] <nigelb> and run python setup.py develop
[14:21:35] <nigelb> and change the entry in development.ini and try again?
[14:23:48] <nigelb> carneirao: you should probably talk in the channel instead of PMing
[14:24:00] <nigelb> I'm going to step away soonish and someone else will be able to help you if I need to run.
[14:24:34] <wardi> nigelb: ugh, you're right
[14:24:43] <wardi> even the redirects don't help us
[14:29:27] <wardi> nigelb: nuclear option would be to push commits to each of those branches that remove the docs dir :-)
[14:32:44] <nigelb> wardi: The problem is, sometimes the branch doesn't exist.
[14:32:54] <nigelb> so you're fighting a phantom :)
[14:33:03] <wardi> we can make branches :-)
[14:33:05] <nigelb> deleting the branch on github doesn't delete the branch on readthedocs.
[14:33:10] <nigelb> +1 to that.
[14:36:06] <wardi> ok, that's doable. I'll make an issue
[14:37:10] <carneirao> Somebody had this problem? http://pastebin.com/V3ekmkm6
[14:42:52] <joet> wardi, nigelb, I went through a few of the old issues to remove the links from the github issues, hopefully this will drop their search ranking
[14:43:18] <wardi> not dead enough! :-)

2015-07-02
[13:58:26] <R0ok_> hi people. Is there a way of getting app_instance_uuid and beaker.session.secret without running `paster make-config` ?
[15:24:08] <wardi> R0ok_: interesting question. you could generate them yourself then insert them into your ini at a later time
[15:55:35] <R0ok_> wardi: I think you can generate app_instance_uuid=`python -c 'import uuid; print uuid.uuid4()'` but I don't know how to generate beaker.session.secret
[15:56:07] <wardi> R0ok_: IIUC you just need a long random string
[15:59:18] <R0ok_> wardi: well, that might be tricky, there are several attacks involving PRNG. That's why I was asking how paster generates beaker.session.secret
[16:07:44] <wardi> R0ok_: SystemRandom is a good thing
[16:12:47] <DragonDave> Digging around, https://github.com/terrasea/pastescript/blob/ca62407fa7cc467a7e3c16a237475dbe5bffa9d5/paste/script/util/secret.py
[16:12:52] <DragonDave> tldr; urandom
[16:13:08] <DragonDave> but falling back to python's random if it fails
[16:13:23] <wardi> isn't that what SystemRandom does?
[16:15:02] <wardi> oh, you found the exact implementation :-)
[16:15:46] <DragonDave> from https://github.com/terrasea/pastescript/blob/ca62407fa7cc467a7e3c16a237475dbe5bffa9d5/paste/script/appinstall.py#L321

2015-07-01
[11:46:04] <joet> wardi, is there a cheat sheet for jq at all
[11:46:43] <joet> I'm generally too lazy t oread through the entire documentation
[11:47:22] <joet> and all I really want is the commands i'd use 80% of the time, like sed and awk are super complex, but you only need the simpler forms 80% of the time.

2015-06-30
[12:18:28] <joet> apologies for the numerous sirens during the dev meeting coming from my mic
[12:18:44] <joet> I assure you they were not after me
[12:18:58] <wardi> it kept things exciting
[12:19:05] <wardi> like we're on a police drama or somethign
[18:53:26] <carneirao> hi! For what reason ckan don't let me add datastore from organization page ?
[18:54:21] <carneirao> The 'add datastore' button doesn't is not appear.
[18:59:20] <carneirao> Someone, please?
[19:02:13] <carneirao> Well, I've just restart apache and the button appears again. No explanation for that...
[21:13:29] <carneirao> \quit

2015-06-29
[01:18:33] <tato> Hey guys, I'm trying to understand some CKAN basics and I have the following question: can you list all resources? e.g. something like /resource (the same way /dataset and /organization works). Or would you need an extension for this?
[01:19:18] <tato> I know that when searching on /dataset, you search through the resources as well, but I was wondering if there was a specialized screen for this.
[02:56:40] <wardi> tato: no, you'd need to write an extension for that sort of thing (maybe you have too many resources per dataset?)
[03:06:12] <tato> wardi: thanks, and yes the problem is that I'm creating one dataset per "meeting", to which I attach multiple resources (e.g. agenda, meeting notes, documents brought up during the meeting). CKAN would provide a lot of value if I could do full-text search on those resources.
[03:06:52] <tato> I know full-text search on resources is a different problem, and I'm already testing/reading about it, I just wanted to clarify if the first use-case was possible within CKAN's current capabilities.
[15:06:21] <gimpyBum> love this app!  2 Questions - Is there a list of additional repo's that can be added? and is there a centralized plugin list?

2015-06-28

2015-06-27

2015-06-26
[19:23:10] <carneirao> Hi! I've configurated CKAN basic site right now. But I can upload files. In the second step from 'Add dataset' form, there is no field to upload data. In 'theory' datastore is configurated. Someone could help me, please?
[19:23:31] <carneirao> Sorry... I can't upload files...
[20:02:27] <wardi> carneirao: did you set your storage_dir setting?
[20:50:15] <carneirao> Sorry, my boss wanted talk to me. Yes! I've started all install process again, including this part. Now the basic site works. The problem now is data preview. When I try to access some csv file, for example, I receive this message:
[20:50:56] <carneirao> Could not load view: DataProxy returned an error (Data transformation failed. error: An error occured while connecting to the server: Unable to connect to server at URL: http://192.168.1.135/dataset/58acc606-0365-4e8a-a75b-dc2665114b47/resource/06661365-4180-43ba-949e-ecd17f30b222/download/alcolismo.csv)
[20:51:23] <carneirao> I'm looking for documentation about this dataproxy right now.
[21:07:38] <carneirao> Thx!

2015-06-25
[07:39:57] <Guest95605> Hi! What is the best way for displaying budget data? - have anyone tested ckanext-budgets? (ckan 2.3)
[18:27:26] <sublimate> Hi! I'm trying to set up ckanext-harvester, and I think I have it correct, but when I go to add a new harvester source the Source Type dropdown simply doesn't exist!
[18:27:33] <sublimate> Has anyone ran into this before?
[18:47:59] <sublimate> http://i.imgur.com/9o6UqxH.png Here's the problem I'm describing in a screenshot :)

2015-06-24

2015-06-23
[12:00:46] <wardi> meeting? https://pad.okfn.org/p/ckan-meeting
[16:48:15] <carneirao> hi! I'm trying to install ckan and I'm having dificult because virtualenv and pip. Ckan deb package doesn't install, and the message is: ImportError: No module named _io
[16:49:15] <carneirao> I've trying to solve this since yesterday and all articles says virtualenv has problems in Ubuntu 14.04. Did you have similar problems like this?
[16:55:15] <sublimate> carneirao, Have you tried recreating your virtualenv?
[16:57:09] <carneirao> Yes, some article says to use
[16:57:30] <carneirao> sorry... 'deactivate' command. There is no 'deactivate' in my SO...
[16:58:19] <carneirao> They say to use mkvirtualenv. This doesn't exists. Just virtualenv and pip.
[16:59:14] <DragonDave> I believe mkvirtualenv is installable by `pip install virtualenvwrapper` but I've never gone down that route.
[16:59:17] <wardi> deactivate is an alias that's present when a virtualenv has been activated
[17:00:07] <DragonDave> (virtualenv is activated by `. <virtualenvdir>/bin/activate`, and adds (<virtualenvdir>) to your prompt.)
[17:00:09] <carneirao> I've installed virtualenvwrapper but thereis no mkvirtualenv command.
[17:00:13] <DragonDave> huh.
[17:01:29] <carneirao> There is some material that you know that I can use ?
[17:01:32] <carneirao> Please ?
[17:02:10] <carneirao> Oh boy... my english is really bad! Sorry!
[17:04:17] <DragonDave> https://virtualenvwrapper.readthedocs.org/en/latest/ appears to have a workflow for starting with virtualenvwrapper which has more details
[17:42:42] <carneirao> Ok, thanks!

2015-06-22
[10:56:57] <travis-ci> ckan/ckan release-v2.3.1 c059ab2 https://travis-ci.org/ckan/ckan/builds/67817635 David Read: The build was broken.
[11:46:16] <travis-ci> ckan/ckan master ae633a7 https://travis-ci.org/ckan/ckan/builds/67821132 amercader: The build was broken.
[12:11:47] <travis-ci> ckan/ckan 1976-crash-without-siteurl 563fffe https://travis-ci.org/ckan/ckan/builds/67824299 amercader: The build was broken.
[13:15:29] <amercader> sorry about the master breakage, I did a bad merge. Hopefully is all good now
[13:26:11] <joet> sanity check https://github.com/ckan/ckan/blob/master/ckan/controllers/package.py#L1057-L1060 these lines seem unnecessary?
[13:26:33] <joet> check_access is run as part as get_action

2015-06-21

2015-06-20

2015-06-19
[13:17:06] <DragonDave> New version of Messytables on PyPI (0.15.0) -- supports Python3.
[13:18:48] <wardi> cool!

2015-06-18
[13:05:52] <pauli_> Someone got a hint why "FactoryError: Cannot generate instances of abstract factory Dataset; Ensure Dataset.Meta.model is set and Dataset.Meta.abstract is either not set or False." bubbles up when calling *factories.Dataset()*?
[13:16:43] <wardi> pauli_: no, are you using it as part of ckan extension tests?
[13:17:17] <wardi> my guess is the pylons/sqlalchemy stuff might not be configured
[13:18:34] <pauli_> Yes using it to test an extension. How do I configure the pylons/sqlalchemy stuff?
[13:18:55] <pauli_> Is that documented somewhere?
[13:21:37] <pauli_> Ok the problem was using a to new factory_boy version (i.e. 2.5.2) instead of 2.1.1.
[13:23:00] <wardi> ah, good to know
[14:02:10] <wardi> meeting https://pad.okfn.org/p/ckan-meeting
[20:47:41] <travis-ci> ckan/ckan master bc66ed3 https://travis-ci.org/ckan/ckan/builds/67427883 Ian Ward: The build has errored.
[20:55:55] <travis-ci> ckan/ckan master bc66ed3 https://travis-ci.org/ckan/ckan/builds/67427883 Ian Ward: The build has errored.

2015-06-17
[00:04:51] <wardi> yes, the tag_string stuff is causing me grief on another site, they modified their schema to require it but package_show doesn't produce a tag_string so I can't copy datasets via the api :-(
[00:05:02] <wardi> I think ckan tags are best avoided
[00:14:45] <joet> :/
[00:17:22] <joet> I've got the code example working now and cleaned up it's a bit nicer now
[09:05:51] <pauli> Hello again. Is there callback / function I can hook into when data harvesting is finished?

2015-06-16
[08:07:13] <pauli_> Hello. What does forward-reference-<hash> dataset mean? I got a lot of them harvesting into a CKAN v2.3 instance, when hearvesting into a CKAN v1.8.2 instance these dataset are not present. Example http://83.212.122.164/dataset/new_resource/forward-reference-dcb52ed6-58dc-4fa5-9e69-c56af024c602 (not my server) Any pointers?
[12:00:29] <wardi> meeting? https://pad.okfn.org/p/ckan-meeting
[12:05:27] <wardi> anyone?
[14:52:30] <coreybits> Hi all, is anyone here actively using the csw harvester ?
[14:52:40] <Zharktas> yes
[14:53:13] <coreybits> I am stuck hitting a specific url, and cannot seem to source the problem
[14:53:50] <coreybits> http://pastebin.com/JXQMgrA8
[14:56:17] <coreybits> I can harvest from other csw servers, just not this one.
[14:57:37] <coreybits> any debug tips would be appreciated
[14:59:06] <Zharktas> https://github.com/ckan/ckanext-spatial/blob/master/ckanext/spatial/harvesters/csw.py#L139 i would try to figure out why ids is empty array
[15:02:52] <Zharktas> for example figure out if those new, delete and change are empty and why
[15:03:00] <Zharktas> or guids_in_harvest
[15:12:54] <coreybits> Zharktas: Thank you. I will dig some more, that helps
[21:31:58] <joet> how can I force a field in a schema to be validated before another field
[21:32:04] <joet> or, can we force ordering
[22:10:21] <wardi> joet: you can do your validation in __before
[22:10:44] <wardi> joet: or name it something that sorts before the other field
[22:13:26] <joet> yeah I found the stuff you added to the docs
[22:13:33] <joet> this is more uncomfortable than I hoped
[22:23:42] <joet> having a custom field that gets converted to a list of tags is quite painful
[22:34:15] <joet> this code is now pretty hideous, not even sure I want it as a tutorial any more :p
[22:34:19] <joet> cheers anyway wardi
[22:37:10] <joet> it does however work
[22:48:27] <wardi> joet: a list of real ckan tags?
[22:52:50] <joet> wardi, so the adding custom field tutorials and example_idatasetform has you save 'country_code' with a 'convert_to_tags' and in the frontend has a dropdown to select the country code
[22:53:05] <joet> i'm extending the tutorial so you can select multiple country codes
[22:53:43] <joet> you can already do it via the api, so it's just a matter of getting the web ui right and saving it similar to how tags are saved with tag_string
[22:53:52] <joet> but it's a bit of a pain.
[22:53:55] <joet> well quite alot of a pain.
[22:54:01] <joet> wardi ^^
[22:56:00] <joet> the tags automatically get validated after tag_string, so there is no need to use __before, as I have discovered.
[22:57:30] <joet> annoyingly I tag_string is added in the package controller, so it doesn't show up in the api when you run a package_show
[22:57:42] <joet> but I have a dangling 'country_code_string' in my tutorial

2015-06-15
[10:20:28] <travis-ci> joetsoi/ckan itranslation-interface df383f4 http://travis-ci.org/joetsoi/ckan/builds/66842324 joetsoi: The build was broken.
[13:16:36] <wardi> hmm. is it just me or is db clean broken on master
[14:09:08] <joet> noooooo
[14:10:16] <wardi> joet: ?
[14:11:17] <joet> the thougth of paster db clean being broken again
[14:12:08] <joet> huum, seems ok to me wardi?
[14:12:08] <wardi> the fix is small, I'm just trying to pin down how my db got in this state
[14:12:40] <wardi> it's failing for my trying to get the site user (why would db clean need the site user I wonder)
[14:13:09] <joet> yeah this sounds familiar
[16:15:34] <joet> :/
[16:42:35] <joet> merge conflicts hurt my stupid brain
[16:55:41] <joet> wardi, my brain has melted slightly
[16:57:55] <joet> https://github.com/ckan/ckan/pull/1886 https://github.com/ckan/ckan/pull/2209
[16:58:17] <joet> mostly the same except you've done vocabulary_list as well, so I'm still merging it in
[16:58:38] <joet> I just got super confused in the 3 way merge when it looked like I was merging code that was already in.
[17:05:13] <joet> wardi do we just want https://github.com/wardi/ckan/commit/c863e1768d3ff4e06780cca0e3f54e9ce9b17e6c ? from #2209 as #1886 has the code that is almost identical to it for tags
[17:18:36] <wardi> joet: just closed 2209
[17:19:05] <wardi> I like vocabulary_list better without the possibility of including datasets
[17:19:32] <joet> fair enough

2015-06-14

2015-06-13

2015-06-12
[09:51:47] <fki> Hello! I have a quick question about CKAN deployment with the paster server and Apache as Proxy configured to serve in a subdirectory. Do I need the Apache HTML Proxy in addition, because all fanstatic resources are not served.
[18:24:44] <coreybits> Hey all, Im just hitting a snag working on harvesting some resources from a csw endpoint
[18:24:51] <coreybits> https://geodiscover.alberta.ca/geoportal/csw?request=GetCapabilities&service=CSW
[18:25:21] <coreybits> I can harvest from here just fine, http://www.dggs.alaska.gov/geoportal/csw?request=GetCapabilities&service=CSW
[18:34:33] <coreybits> http://pastebin.com/JXQMgrA8
[18:36:14] <coreybits> Any tips would be appreciated ;)
[21:54:00] <travis-ci> ckan/ckan make-vocabulary-dictize-faster 90d0ddd http://travis-ci.org/ckan/ckan/builds/66607148 David Read: The build was broken.

2015-06-11
[14:01:57] <wardi> https://pad.okfn.org/p/ckan-meeting
[14:06:11] <pauli> Someone w/ harvesting knowledge in here?
[14:26:08] <wardi> pauli: it's usually better to ask your actual question
[14:31:01] <pauli> Is harvestering between a CKAN server 1.8.* and one or more running a different version i.e. 2.3 problematic?
[14:43:32] <joet> pauli, should be fine in my experience

2015-06-10
[10:02:35] <joet> anyone happen to know how babel translator comments work with jinja templates?
[10:20:59] <joet> ah cool any comment with a preceding {# TRANSLATORS: <some note>  #} is associated with the translaton string
[10:56:23] <pauli> Hi.  I got the task to sync CKAN data with an elasticsearch index. After searching for a *hook-into* point I'm still kind of standing in the dark. Anyone around to give me a direction pointer?
[10:57:22] <pauli> s/data/datasets
[11:00:32] <pauli> Wave if you read messages in this channel.
[11:02:44] <wardi> pauli: you have many options
[11:03:34] <wardi> an idatasetform or ipackagecontroller extension would work
[11:04:39] <wardi> or you could insyall the existing webhooks extension and do your indexing as a service
[11:06:38] <wardi> or you can used the recently changed api and update from a cron job
[11:37:07] <pauli> Ok gonna research these options, ta.
[14:34:36] <pauli> wardi:so with the API option I guess would use the package_activity_list API function and react on the activities(?)
[14:36:37] <pauli> Is it also possible to mix the idatasetform option w/ harvesters (I have a set of custom ones), or are these independent *steps*?
[14:42:48] <wardi> idatasetform is more for customizing the metadata accepted/produced
[14:46:25] <pauli> So wich of the three options would be the most elegant / best practice to sync to elasticsearch after harvesting?
[15:12:11] <wardi> any will work, but if you already have IDatasetForm plugins it might be nice to implement your elasticsearch stuff another way
[15:23:14] <wardi> pauli: I think IPackageController after_create/update/delete would be the simplest extension approach
[15:23:53] <pauli> So harvesters are kind of IDatasetForm plugins? *puzzled me*
[15:24:56] <pauli> regarding your 17:12 answer
[15:25:39] <wardi> I haven't been using the harvester extension, but I think there's an idatasetform on the receiving side to allow setting the id field (no longer required as of ckan 2.3)
[15:28:39] <pauli> Much appreciation for your pointers.

2015-06-09
[12:01:01] <wardi> meeting! https://pad.okfn.org/p/ckan-meeting
[12:27:46] <travis-ci> ckan/ckan master 2b27a58 http://travis-ci.org/ckan/ckan/builds/66036482 amercader: The build was broken.

2015-06-08
[17:49:03] <xarthisius> hi, is there a way to specify order of actions during 'db init'? I have a problem when trying to create new db with certain plugin (NaturalHistoryMuseum/ckanext-ldap)
[17:49:42] <xarthisius> https://paste.lugons.org/show/XUMcDrAB2k1Z6hswVKFU/
[17:50:40] <xarthisius> when I remove ldap from plugins, run init db, add ldap afterwards it doesn't complain
[17:56:07] <xarthisius> I guess creating sql table during SingletonPlugin.configure() is not a greatest idea...

2015-06-07

2015-06-06
[03:21:44] <nigelb> xarthisius: hi!
[03:22:02] <nigelb> xarthisius: since I've literally written the documentation and led this discussion, I'm happy to help.
[03:22:16] <nigelb> xarthisius: Can you point me to your instance? That'll help me spot issues immediately.
[16:17:06] <xarthisius> nigelb: thanks!  https://fido.ncsa.illinois.edu/ckan/
[16:18:30] <xarthisius> and this link https://goo.gl/yytdKR has example mixed content (https/http)
[16:47:43] <nigelb> xarthisius: okay, first off, you haven't configured nginx correctly.
[16:48:13] <nigelb> You're missing this line https://gist.github.com/nigelbabu/076ad12c13b2071de8e1#file-ckan_nginx-conf-L33
[16:51:36] <xarthisius> hmm, I do have it
[16:52:14] <xarthisius> https://paste.lugons.org/show/wMVIysWY3RONBbmwVItG/
[16:52:24] <xarthisius> that's the relevant part of the config
[16:59:23] <nigelb> xarthisius: can you restart nginx and then apache?
[17:03:39] <xarthisius> it was using wrong nginx it seems, give me a sec
[17:04:46] <nigelb> aha.
[17:05:06] <nigelb> I've done ssl config enough times that I know which line causes what problem :)
[17:09:34] <xarthisius> since we're running it in docker container, I wanted to skip the one shipped with ckan/ckan
[17:09:42] <xarthisius> we already have one running there
[17:17:53] <xarthisius> correct me if I'm wrong but if I access port 8080 directly I should skip the nginx runnig there, right?
[19:49:01] <xarthisius> nigelb: I think I've got it right this time

2015-06-05
[13:22:39] <programmingError> hello
[19:09:47] <xarthisius> hi, I'm trying to run ckan with SSL, I'm hitting issue described in https://github.com/ckan/ckan/pull/1632
[19:10:15] <xarthisius> even though I'm using config for nginx/apache described here https://gist.github.com/nigelbabu/076ad12c13b2071de8e1 it still doesn't work properly
[19:11:13] <xarthisius> could anyone point me to the wiki mentioned in issue #1773 or other suitable place?

2015-06-04

2015-06-03
[15:52:15] <yoman> hi. is there a "right" way to get paster to print its output to stdout? i can redirect but it mixes it up with the other logging on stderr
[20:30:04] <wardi> uh
[20:30:29] <wardi> I don't recall saying anything about 2.5
[20:31:01] <wardi> *anyone saying anything

2015-06-02
[12:03:36] <wardi_> meeting?
[12:04:09] <wardi_> https://plus.google.com/hangouts/_/event/cb1vmkss426lkqicj94a3amvd1c?authuser=0&hl=en-GB
[12:04:13] <amercader> wardi_: yes, come join us!

2015-06-01
[17:32:18] <wardi_> I need something like https://forge.typo3.org/projects/extension-solr/wiki/Dynamic_Fields
[17:35:29] <wardi_> I think I'll follow the official example schema http://svn.apache.org/viewvc/lucene/dev/tags/lucene_solr_4_3_0/solr/example/solr/collection1/conf/schema.xml?view=markup#l179
[17:36:58] <wardi_> ugh. it's kind of terrible though

2015-05-31

2015-05-30

2015-05-29
[15:11:42] <acorbi> Hello Everyone! Is there any documented way of defining in an extension a custom plugin Interface (as in IResourceController, IFacets, etc...) which can be then implemented by another extension
[15:12:21] <acorbi> Concretelly, I would like to extend https://github.com/okfn/ckanext-issues so an interface method is called everytime an Issue is created or deleted
[15:12:34] <acorbi> Concretelly, I would like to extend https://github.com/okfn/ckanext-issues so an interface method is called everytime an Issue is created or deleted
[15:46:10] <wardi_> acorbi: does subclassing not work?
[15:47:26] <acorbi> can you please extend on that?
[16:04:11] * NOTICE: [freenode-info] channel flooding and no channel staff around to help? Please check with freenode support: http://freenode.net/faq.shtml#gettinghelp
[19:58:57] <wardi_> microsoft contributing to ckan?

2015-05-28
[14:30:42] <wardi_> can't make the meeting today

2015-05-27
[13:22:14] <kalxas> amercader, it seems there is a problem with the video in hangout
[13:23:08] <amercader> kalxas: I know, the guys in canada are aware of it and working on ti
[13:23:10] <amercader> it
[13:23:21] <kalxas> ok thanks
[13:23:29] <amercader> thanks
[14:40:58] <kalxas> hi amercader, thanks for the link to PublicaMundi :)
[14:41:39] <amercader> kalxas: I had more on it first, but there wasn't enough time I'm afraid
[14:42:09] <kalxas> this happens all the time on presentations
[17:03:38] <kalxas> amercader, is there a hangout link for the meetings?
[17:04:12] <amercader> kalxas I'm not sure actually
[17:04:18] <amercader> wardi_: ^ ?
[17:04:42] <kalxas> I have a link for the government working group
[17:04:47] <kalxas> but not for the technical one
[17:09:23] <amercader> kalxas: can you try this one? https://plus.google.com/hangouts/_/gsowqairkypouuftamk6jlaipqa
[17:24:04] <kalxas> wardi_, can you please post the pad link here too? :)
[18:07:56] <kalxas> wardi_, we lost you from hangout

2015-05-26
[11:20:38] <palcu> I've requested to be added to the Romanian translators team. We've already translated 90% of the new strings and want to contribute back. :-) https://www.transifex.com/projects/p/ckan/language/ro/ http://data.gov.ro/
[12:01:52] <wardi_> meeting? https://plus.google.com/hangouts/_/event/cb1vmkss426lkqicj94a3amvd1c?authuser=0&hl=en-GB

2015-05-25
[05:30:52] <witness> Hi
[05:31:02] <witness> I am trying to use setup ckan.
[05:32:45] <witness> but, when I am trying to install ckan. It is giving me issues like File "/usr/local/bin/virtualenv", line 11, in <module>
[05:32:45] <witness> sys.exit(main())
[05:32:45] <witness> File "/usr/local/lib/python2.7/dist-packages/virtualenv.py", line 824, in main
[05:32:45] <witness> symlink=options.symlink)
[05:33:17] <witness> on executing command virtualenv --no-site-packages /usr/lib/ckan/default
[05:35:14] <witness> Can any body help me with the solution ?
[05:35:18] <witness> Thanks
[13:17:47] <wardi_> witness: would you paste the complete error to a pastebin or gist?
[15:47:42] <joet> wardi, dumb question about scheming. Is there an easy way to have common fields across multiple dataset types
[15:47:59] <joet> say I wanted all my datasets to have an ISBN field, but I don't want to repeat myself each time
[15:48:04] <wardi_> just presets where you could define all the field attributes
[15:48:22] <joet> that's what I wanted to add as part some tutorial somewhere
[15:48:31] <wardi_> let me find an example
[15:48:42] <joet> cool
[15:49:42] <wardi_> https://github.com/open-data/ckanext-canada/blob/wet4-scheming/ckanext/canada/schemas/dataset.yaml#L16-L17  https://github.com/open-data/ckanext-canada/blob/wet4-scheming/ckanext/canada/schemas/presets.yaml#L8-L20
[15:50:09] <wardi_> there's a bunch of examples in the presets.yaml, actually. including ones with choice lists
[15:50:30] <joet> ok, that is pretty cool
[15:50:54] <joet> I was assuming presets were just referring to "default text in a field"
[15:51:15] <wardi_> it's default everything, so you can define the whole field
[15:52:08] <joet> that is really cool
[15:52:54] <joet> I sort of want to just use scheming in the tutorial, but at the same time, perhaps core ckan docs should only refer to core ckan and perhaps link to extensions
[15:53:36] <wardi_> dread was talking about adopting scheming into core. I'd like it to be a little more mature first
[15:54:03] <joet> for now, I think I'll just have to do both
[15:54:10] <wardi_> I'd also like it to work with orgs and groups, and facets
[15:54:29] <joet> show you how to handle multiple datasets just using ckan and perhaps link to scheming docs and add a tutorial there
[15:54:54] <wardi_> right, scheming is missing a tutorial.. and y'know.. docs
[15:55:38] <joet> yeah I won't promise that I'll add one, but I'll give it a go if I have enough time.
[15:55:59] <wardi_> at least tell me which parts are broken or hard to understand
[15:59:50] <witness> hi wardi_
[16:00:09] <witness> Here is the pastebin link http://pastebin.com/QDRBQeHt
[16:01:59] <joet> witness you probably want a sudo before your virtualenv command https://xkcd.com/149/
[16:02:05] <wardi_> witness: you don't have permission to create a virtualenv there, why not create it in your home directory
[16:02:28] <wardi_> or what joet says
[16:03:00] <joet> if you're just setting up a dev environment, I'd set it up somewhere in your home directory
[16:03:34] <witness> Sure, let me try
[16:03:34] <joet> the ckan docs are aimed at someone setting up a production server.
[16:04:46] <joet> perhaps while I'm looking at the docs, that's one thing we could add
[16:05:30] <joet> django has a "first steps" style tutorial, we could add a similar thing, telling people how to use "paster serve" and other similar things
[16:07:30] <wardi_> joet: first steps would probably be better for most people

2015-05-24

2015-05-23

2015-05-22
[18:15:05] <travis-ci> ckan/ckan 2429-remote-config 293b803 http://travis-ci.org/ckan/ckan/builds/63683335 amercader: The build was broken.

[02:24:29] <CheeseburgerWalr> Hey there.  Big fan of what you created with CKAN, just wondering if it would be usable for other applications such as pulling headlines/links from a prescribed set of blogs...
[10:55:40] <wardi> oh. oh. i want to respond to the rest api and osx tickets
[14:05:10] <amercader> wardi: do you want to try the hangouts thing? I have another call now
[14:10:04] <wardi> when will you be available?
[14:10:11] <wardi> amercader: did I get the time wrong?
[14:10:30] <amercader> wardi: It's 3:10 my time
[14:10:45] <wardi> amercader: when are you able to try?
[14:10:50] <amercader> now
[14:11:01] <wardi> did you get the invite from ashley?
[14:11:13] <amercader> checking
[14:11:35] <amercader> nope
[14:11:54] <amercader> both on adria.mercader@okfn.org and amercadero@gmail.com
[14:12:45] <wardi> hmm. check g+?
[14:13:02] <amercader> found them!
[16:33:20] <acorbi> Hi Everyone! Anybody knows why I cannot change a dataset's type using CKANAPI like this:
[16:33:25] <acorbi> dataset_metadata = ckanapi_utils.get_package_contents(dataset['id'])
[16:33:37] <acorbi> patched_metadata['type'] = 'new_type'
[16:33:45] <acorbi> dataset_metadata = ckanapi_utils.update_package(dataset_metadata)
[16:34:14] <acorbi> ckanapi_utils. are just wrappers to the corresponding API methods
[16:34:22] <acorbi> (package_show and package_update)
[16:35:39] <acorbi> !! typo on second code line (patched_metadata should be dataset_metadata)
[16:44:46] <acorbi> or any ideas in general on how to change the type of a dataset?
[16:44:50] <acorbi> programatically?
[16:47:55] <coreybits> acorbi: I would like to know this as well, I am using ckanext-scheming and have to move a number of records from one dataset_type to another
[16:50:45] <acorbi> coreybits: Have you tried anything already?
[16:52:38] <amercader> acorbi, coreybits: This is actively prevented now, I guess because the schema to be used to validate the data depends on the type on the database and not the one on the parameters https://github.com/ckan/ckan/commit/7224d4c76e2f74af52ae9af6798cf3ed1c6034c9
[16:53:12] <amercader> I'm sure a case could be made to allow this, I suggest you create an issue so it can be discussed
[16:53:33] <acorbi> amercader: THx a lot for the info
[16:53:49] <acorbi> so basically, we can re-enable that by tweaking ckan/logic/action/update.py , right?
[16:54:40] <amercader> well, as it is it may cause unexpected results, as the validation will be done against the schema for the previous type
[16:55:11] <amercader> but you can try
[16:55:15] <acorbi> amercader: good to know, actually I just need to move the datasets once
[16:55:20] <amercader> ok
[16:55:29] <acorbi> so i can do a one-time action and then change the code back to normal
[16:55:32] <acorbi> Ill try
[16:55:40] <acorbi> thx!
[16:59:50] <acorbi> ok! works fine
[17:00:17] <acorbi> I'll analize if there is any "secondary effects"...
[17:00:44] <amercader> (   )
[17:02:27] <acorbi> hehehe
[17:02:58] <acorbi> BTW: Any things to be aware of while managing different dataset types within the same ckan instance?
[17:04:34] <amercader> in the main search page, only datasets of type "dataset" (default) will be displayed unless you set ckan.search.show_all_types=true
[17:04:43] <amercader> by default the API returns all types
[17:08:54] <acorbi> wonderful hint!!! I already noticed that and was wondering how to workaround it
[17:16:38] <wardi> acorbi: ckanapi_utils.. why not use ckanapi?
[17:16:56] <acorbi> ckanapi_utils is just a wrapper for ckanapi
[17:17:10] <acorbi> utility class
[17:17:32] <wardi> ckanapi_utils = myckan.action ?
[17:17:44] <wardi> sorry, not important
[17:18:25] <wardi> yeah, we disabled the type changing because I wasn't comfortable changing the validation rules based on one set of rules, then..what.. revalidating?
[17:19:00] <wardi> if you have an idea about how to handle that please submit a PR
[17:23:53] <wardi> or should we just validate according to the target type.  That would be more like what would happen if you delete then recreate
[17:24:23] <amercader> wardi: that sounds sensible
[17:24:40] <amercader> what happens if you can't find a plugin for a type?
[17:24:49] <wardi> amercader: it means you can't write a validator that would prevent changing type, but that might be ok
[17:33:13] <wardi> amercader: I think the fallback applies
[17:41:11] <amercader> https://github.com/ckan/ckan/pull/2429
[17:41:16] <amercader> ups, wrong chat
[17:54:14] <travis-ci> ckan/ckan 2429-remote-config 4634c3f http://travis-ci.org/ckan/ckan/builds/63682334 amercader: The build was broken.

2015-05-21
[10:10:04] <joet> wardi, do you remember that renaming organizations issue, where the dataset's organization in solr would need to be renamed?
[10:10:10] <joet> was that ever created in an issue?
[11:15:49] <wardi> joet: don't know. i have a little script to force reindexing of an orgs packages though
[11:16:32] <joet> wardi, that would be useful
[11:16:42] <joet> uses ckanapi?
[11:27:39] <joet> wardi, (i'm interrupting your breakfast i know), do you just force the reindex of the org packages? I can't remember the discussion and couldn't find it in the meeting notes, did we ever decide if there was a better fix for it?
[11:59:03] <wardi> joet: I think we said "we need a queue for this"
[11:59:38] <wardi> it's a ckanapi cli + paster search-index one-liner
[11:59:49] <wardi> I'll dig it up when I get to the office
[14:40:13] <amercader> wardi, brook: I won't be able to attend the dev meeting sadly
[15:00:51] <wardi> https://plus.google.com/hangouts/_/event/cb1vmkss426lkqicj94a3amvd1c?authuser=0&hl=en-GB  meeting?
[15:08:13] <wardi> all done

2015-05-20
[00:19:45] <wardi> coreybits: i think you would need to register a new controller to do that, but it's certainly possible
[00:20:20] <wardi> or submit an issue or even pr to add the feature to core
[09:58:42] <acorbi> Hi Everyone. One question about plugins implementing the IDatasetForm interface
[09:59:06] <acorbi> I have a plugin which provides particular form customizations BUT only for a certain dataset_Type
[09:59:09] <acorbi> I have a plugin which provides particular form customizations BUT only for a certain dataset_type
[09:59:22] <acorbi> say library records
[09:59:49] <acorbi> def package_types(self):
[09:59:49] <acorbi> return ['library_record']
[10:00:12] <acorbi> for that, i have defined the package_types() function to return the package_type the plugins needs to react to
[10:01:08] <acorbi> but it happens, that the template customization that i define in this plugin, also have effect for "standard" datasets ( package_type == dataset )
[10:02:21] <acorbi> for instance. if I call http://URL/dataset/new?type=library_record I expect the customizations defined in the plugin to take effect. Which actually happens
[10:03:47] <acorbi> but when I call http://URL/dataset/new I just expect that the plugin does not have any effect, because it is only intended to react to type=library_record
[10:04:21] <acorbi> I am doing any false assumption here? maybe overseeing anything? Can you point me to a plugin which actually reacts only to a certain type of package?
[10:04:25] <acorbi> Thanks in advance...
[10:37:51] <wardi> acorbi: did you set your plugin as the fallback?
[10:38:04] <wardi> (don't do that)
[10:38:09] <acorbi> Nope, i did not
[10:38:19] <acorbi> isFallback returns False
[10:39:45] <acorbi> wardi: Do I understand the expected behaviour correctly? Reading the docs, I understand that if I set the value returned by package_type, then the plugin will ONLY override templates in case the type matches
[10:40:15] <acorbi> but in my case, it is overriding anytime
[10:40:29] <wardi> did you put your templates in the same paths as the default ones?
[10:40:46] <wardi> (don't do that)
[10:42:42] <acorbi> Yes I did
[10:42:54] <acorbi> my intention is to override certain UI elements
[10:43:01] <acorbi> but ONLY for that particular package_types
[10:43:15] <acorbi> should I put the templates in a different path then?
[10:43:23] <wardi> yes :-)
[10:43:33] <acorbi> something like templates/my_package_type/ ?
[10:43:37] <acorbi> mmm I see
[10:43:46] <wardi> when they are the same they will always override
[10:43:53] <acorbi> Ok got it
[10:44:00] <acorbi> ok, this makes sense
[10:44:05] <acorbi> thanks!
[14:29:42] <travis-ci> ckan/ckan 2429-remote-config 3bfee86 http://travis-ci.org/ckan/ckan/builds/63324326 Brook Elgie: The build was broken.
[14:36:16] <travis-ci> ckan/ckan 2429-remote-config 720d0cb http://travis-ci.org/ckan/ckan/builds/63329679 amercader: The build was broken.
[15:05:52] <poguez_> Buenos das gultec
[15:08:30] <poguez_> psenme una hebilla
[15:08:31] <poguez_> https://www.youtube.com/watch?v=JnoQ_0Mm6r4
[15:08:53] <poguez_> hhaha sorry wrong channel

2015-05-19
[12:00:04] <wardi> meeting? https://plus.google.com/hangouts/_/event/cb1vmkss426lkqicj94a3amvd1c?authuser=0&hl=en-GB
[21:56:10] <coreybits> I am using ckanext-scheming, and when I set the option ckan.search.show_all_types = false
[21:56:18] <coreybits> sorry = true
[21:56:44] <coreybits> I can see all dataset_types under the default of dataset
[21:56:59] <coreybits> is it possible to set another dataset_type as the default
[21:58:19] <coreybits> so for example I have dataset, publications, foip, and all-resources.
[23:13:31] <wardi> coreybits: what do you mean by setting it as the default?
[23:54:41] <coreybits> wardi: with the setting 'ckan.search.show_all_types = true' all dataset_types are shown under /dataset, I would like this under /all-resources with /dataset still displaying dataset_type = dataset
[23:56:11] <coreybits> seems the 'dataset' type is the default, and I would like to make 'all-resources' the default type

2015-05-18

2015-05-17

2015-05-16

2015-05-15
[08:30:17] <palcu> is there  way I can limit which files can be uploaded using the FileStore by extensions? For example I don't want to allow PDFs to be uploaded.
[08:51:22] <grrrrrrrr> Do people know of any issues around the embeds not working
[08:54:11] <grrrrrrrr> I'm finding that they just show a blank page with the correct coloured background
[14:57:45] <Niall_> Hello, I'm having problems using the helpers add_url_param and remove_url_param on pages that have an id in their URL.
[14:58:07] <Niall_> I submitted it as an issue; just wondering if I'm making a mistake or if it's a bug: https://github.com/ckan/ckan/issues/2430

2015-05-14

[09:39:14] <grrrrrrrr> wardi_, How did you get your tag translations to work? did you use multilingual_tags?
[09:39:42] <grrrrrrrr> do you need to provide a translation for them all to not show the english?
[10:17:18] <travis-ci> ckan/ckan master 269ddc0 http://travis-ci.org/ckan/ckan/builds/62526815 joetsoi: The build was broken.
[10:49:43] <wardi_> grrrrrrrr: i'm using fluent tags from ckanext-fluent. they're stored as json per-language lists in a dict
[10:55:32] <grrrrrrrr> wardi_, thanks
[11:05:02] <wardi_> grrrrrrrr: i'm using a 'keywords' extra because tags can't be changed easily
[11:06:12] <grrrrrrrr> wardi_, I looked at fluent but found it hard on the brain
[13:59:15] <joet> :(
[13:59:50] <joet> i broke master. I am sorry
[14:06:02] <joet> it's all that renaming from new_, missed it in the merge. :/
[14:58:22] <wardi_> will be a couple minutes late
[15:01:54] <wardi_> https://plus.google.com/hangouts/_/event/cb1vmkss426lkqicj94a3amvd1c?authuser=0&hl=en-GB
[17:53:37] <wardi_> grrrrrrrr: sorry about that
[17:54:28] <grrrrrrrr> that's fine
[17:54:30] <wardi_> multilingual metadata is a hot topic. everyone likes to do it their own way it seems
[17:54:48] <grrrrrrrr> yeah shamne it ends up as a hack
[17:55:17] <wardi_> grrrrrrrr: I hope that fluent is the leasy hacky.. but it is the most prone to break other systems
[17:55:22] <wardi_> *least
[17:56:17] <wardi_> I haven't convinced amercader yet, but he maintains way more sites than I do, so I understand his position
[17:58:25] <grrrrrrrr> yeah he does lots
[17:58:30] <grrrrrrrr> poor sod

2015-05-13

[06:33:58] <grrrrrrrr> hello ritta_
[06:34:13] <grrrrrrrr> how you like the ckan?
[07:03:24] * nigelb waves to grrrrrrrr
[07:03:32] <nigelb> How's Dar? :)
[07:12:23] <grrrrrrrr> wet
[07:12:29] <grrrrrrrr> how are you?
[07:12:40] <grrrrrrrr> but I have an umbrella now
[07:19:42] <nigelb> grrrrrrrr: Heh, dry. But it *is* raining outside.
[07:30:14] <grrrrrrrr> here monsoon
[07:32:23] <nigelb> Brilliant. I'm jealous.
[07:54:29] <ritta_> hello grrrrrrrrr and everyone
[07:55:31] <ritta_> I've introduced to this platform with grrrrrrrrr
[07:56:23] <ritta_> ...though novice to ckan but like it
[10:04:32] <wardi_> grrrrrrrr: hello!
[10:27:24] <grrrrrrrr> wardi_, hi there
[10:27:43] <grrrrrrrr> I'm working with the tanzanians
[10:29:36] <grrrrrrrr> http://opendata.go.tz
[10:30:12] <grrrrrrrr> wardi_, they have same issues as you with bi-lingual needs
[10:30:44] <grrrrrrrr> wardi_, I will try to get somehwere with that pull request too
[10:30:56] <grrrrrrrr> I've just been very busy
[10:59:59] <niall_> @Wardi: Yesterday I asked a question about hooking into the controller before create/update/deletion of groups. You recommended trying db_to_schema as that is called at the right time - just wondering if you had any advice about how to access the instance of the group?
[11:54:21] <wardi_> niall_: at that level everything is json, you'd have to query the model yourself
[12:05:07] <niall_> Wardi: If we query for a group in the db_to_form_schema, won't the group_show API action call db_to_form_schema getting us stuck in a loop?
[12:29:55] <niall_> @wardi - sorry that last question wasn't necessary - got it working now. I appreciate your help, cheers!
[12:30:58] <grrrrrrrr> anyone know about how to change the labels in recline?
[12:31:09] <grrrrrrrr> rgrp, ^
[12:44:31] <rgrp> grrrrrrrr: which labels?
[12:45:00] <rgrp> and generally worth asking on recline github issues ....
[12:52:24] <grrrrrrrr> on the bar graph

2015-05-12

[12:00:14] <wardi> https://plus.google.com/hangouts/_/event/cb1vmkss426lkqicj94a3amvd1c?authuser=0&hl=en-GB
[12:26:01] <joet> apologies, I have to drop off for another meeting :(
[14:00:26] <Kudos_> Is anyone running ckan with solr 5 by chance? It looks like I have it up and running in my test environment but I am wondering if anyone has had any success/problems with it?
[14:13:52] <joet> Kudos_, only in development
[14:14:23] <joet> but I've had no problems with any branch/version of ckan I've been working with so far
[14:18:03] <Kudos_> Thanks. I had a few problems setting it up but I think that is fairly normal for solr it seems. :)
[18:48:14] <travis-ci> ckan/ckan master 60a7edf http://travis-ci.org/ckan/ckan/builds/62277346 David Read: The build has errored.
[18:50:36] * wardi kicks travis
[19:45:22] <wardi> yey
[19:45:42] <wardi> I wonder why tests just get hung up on travis sometimes

2015-05-11
[12:20:13] <Niall> Hello
[12:22:06] <Niall> We're struggling to get the IMapper before_insert hook to work. Does anyone have any ideas why it seems never to get called. Details are here: http://stackoverflow.com/questions/30163162/ckan-imapper-plugin-appears-to-do-nothing
[13:39:59] <wardi> Niall: I've never used IMapper, but if you don't get a response create an issue and it will get assigned to someone tomorrow.
[13:57:15] <Niall> Cheers Wardi, will do ;)
[13:58:31] <wardi> Niall: may I ask what your plugin needs to do? There might be a higher level interface to get what you want
[13:58:56] <wardi> that one is about as low-level as it gets
[14:07:42] <Niall> We have set up a fewcustom tables. One with a new model and one association table between our model and the Group model. On insert/delete/update of a group or our model, we want to manipulate the associations table
[14:29:27] <wardi> Niall: so an IGroupForm won't work in your case?
[14:33:47] <Niall> Is there a before_save hook for iGroupForm?
[14:48:40] <wardi> Niall: at the moment you can create a form_to_db schema whose validators are called every time a user submits an update.. so it's more involved than what you're trying but it can be customized per-field
[14:52:23] <Niall> Great idea! Thank Wardi, we'll look into trying out that method now.
[16:17:05] <ozooner> Hi. I am having trouble extending certain templates. Is this a known problem in ckan 2.3? f.x extending templates/organization/read.html works whereas templates/organization/read_base.html doesn't...
[16:35:19] <wardi> ozooner: is your plugin load order causing a different one to be used?
[16:40:00] <ozooner> No, when I edit the file directly in src/ckan/ckan/templates/organization/read_base.html, I see the changes
[16:40:23] <ozooner> I also disabled other plugins just-in-case something was overriding mine
[16:42:37] <ozooner> Aha, it seems to be vagrant box not syncing some files...when inside VM i see the files are empty. Thanks for responding
[16:42:54] <ozooner> weird is that it's only some files that got synced empty

2015-05-10
[16:41:18] <wardi> SkramX__: -p runs multiple in parallel

2015-05-09
[01:30:55] <wardi> mikeberg: yes, right now you need to customize before_index and your solr schema
[01:32:22] <wardi> SkramX__: huh. file a bug and i'll have a looj
[01:33:38] <wardi> mikeberg: i want to make the solr schema generic and add the before_index stuff in scheming, but haven't yet
[13:20:57] <SkramX> wardi: created the issue as you suggested: https://github.com/ckan/ckanapi/issues/43
[13:21:10] <SkramX> thanks for taking a look when you get a chance!
[13:40:17] <wardi> SkramX: thanks will do
[13:40:41] <SkramX> thanks
[22:31:16] <SkramX> wardi: thanks again for the quick close on the ckanapi question
[22:31:49] <SkramX> is POST any faster than GET in this case? perhaps a feature request would be parallelization of the code?
[22:32:33] <SkramX> its averaging 3+ seconds per dataset which at 60,000 datasets will take 2 days
[22:34:39] <SkramX> (i would use their data.json but it doesnt include titles for the resource links)

2015-05-08
[08:27:33] <amercader> mmm, read the docs is putting ads in http://docs.ckan.org
[10:31:39] <wardi> amercader: yeah. an easy fix is to use github pages
[10:32:53] <wardi> that has the side-effect of disabling old docs (i think that's a plus)
[16:16:07] <notallrobots> hey all
[16:16:20] <notallrobots> just quick question about download errors
[16:16:39] <notallrobots> I am on OSX, most mods download and install just fine
[16:16:52] <notallrobots> however, sometimes I get a RecvError notification
[16:17:05] <notallrobots> looks like this http://imgur.com/tL9fua0
[16:17:35] <notallrobots> not sure how to fix this-- the mods are up to date and compatible with what I already have
[16:18:10] <notallrobots> im on the latest version as well
[16:18:55] <notallrobots> Any ideas? The migration plugin and auto-detection are non functioning as well, not sure if that's related
[16:20:40] <wardi> notallrobots: wrong ckan :-)
[16:20:50] <notallrobots> crap
[16:20:54] <notallrobots> thanks
[17:32:04] <mikeberg> wardi: We're doing some faceting on some of the data for fields created by the scheming extension. Noticed that the multiselect control stored data as serialized JSON in the db. What would the best approach be to facet on this? We were thinking maybe putting something between the DB and the solar index so it indexes based on decserialized json but wanted to touch base to see if you've tried something something like this already
[21:08:58] <SkramX> hey all - any `ckanapi` wizards? getting an error with ckanapi dump datasets: https://gist.github.com/marks/ec66e11c5ebf0639b077
[21:09:12] <SkramX> ckanapi.errors.ValidationError: {u'__type': u'Validation Error', u'name_or_id': u'Missing value'}
[21:21:28] <mikeberg> SkramX: you hosting in paster, do you have the debug console up?
[21:22:12] <mikeberg> SkramX: nvm, console command. my bad
[22:17:36] <SkramX> I got disconnected earlier.. did anyone ever answer my question by any chance?
[22:18:12] <SkramX> oh cool, logs. yeah, mikeberg - console command...

2015-05-07

[10:46:58] <mattfullerton> @wardi, @coreybits: Shouldn't http://docs.ckan.org/en/latest/maintaining/configuration.html#ckan-resource-formats also be relevant for the autocomplete?
[10:48:09] <mattfullerton> amercader: There's a slim chance I can make 15:00 UTC. Here's hoping.
[10:49:49] <amercader> mattfullerton: great! I need to get back to you on the geoview issue, it's on my list
[10:50:46] <amercader> DragonDave: I can find someone at OK to have a quick look (joet?), I guess the API is unchanged?
[10:51:06] <DragonDave> should be
[10:51:26] <DragonDave> the biggest concern is that I didn't understand what was going on with ilines.py
[10:52:02] <mattfullerton> amercader: no problem, I'm still overjoyed at the functionality that is there. I have a nice showcase of geo sources now.
[10:52:14] <DragonDave> it's intended to be a straight port
[10:52:36] <amercader> DragonDave: that's our critical usage of messytables https://github.com/ckan/datapusher/blob/7cb30a01ea18470a1985de99142a3377d1b632f4/datapusher/jobs.py#L332:L348
[10:52:43] <amercader> if this works I'm happy :)
[10:53:31] <amercader> mattfullerton: it's good, and there is a also huge room from improvement
[10:54:37] <amercader> DragonDave: basically we will deploy your new branch in a ckan instance with datapusher + datastore and see if csvs and excels are imported / recognized in the same way
[10:54:40] <amercader> I am sure they will
[10:54:47] <DragonDave> cool
[10:54:57] <DragonDave> if it breaks, then new test cases :P
[10:55:08] <joet> amercader, missed the first part is this a PR?
[10:55:09] <amercader> DragonDave: do you have a link for your new work?
[10:55:49] <DragonDave> it's the py23 branch on okfn/messytables https://github.com/okfn/messytables/pull/124
[10:56:28] <amercader> cheers
[11:03:48] <DragonDave> amercader: afk food ~ 1hr.
[12:04:07] <DragonDave> back
[12:07:53] <wardi> m
[12:09:19] <wardi> mattfullerton: good idea, maybe a parameter to autocomplete from that list instead of existing ones
[14:39:18] <amercader> wardi, joet: looks like I'll probably be late / miss dev meeting
[14:41:43] <wardi> amercader: ok

2015-05-06
[11:36:54] <travis-ci> ckan/ckan make-vocabulary-dictize-faster 48a2162 http://travis-ci.org/ckan/ckan/builds/61449375 David Read: The build has errored.
[14:27:04] <DragonDave> Hi; I've got some major structural changes to messytables which brings it into Python3 (whilst preserving Py2.6 / 2.7).
[14:27:59] <DragonDave> With the exception of PDFTables support (not ported the library to Py3) it's passing all the tests, but it might have other problems which haven't been detected.
[14:31:10] <DragonDave> It's been reviewed inside ScraperWiki but I'd like external buy-in / people screaming "stop stop stop" :)
[17:35:43] <HyperJohnGraham> Hi All
[17:36:50] <HyperJohnGraham> I am installing ckanext-spatial and wanted to use PostGIS 2
[17:37:16] <HyperJohnGraham> when i run "sudo -u postgres psql -d ckan_default -c "SELECT postgis_full_version()"" to check the postGIS install i get an UNKNOWN
[17:37:32] <HyperJohnGraham> POSTGIS="2.0.3 r11128" GEOS="3.3.8-CAPI-1.7.8" PROJ="Rel. 4.8.0, 6 March 2012" LIBXML="2.8.0" LIBJSON="UNKNOWN"
[17:38:16] <HyperJohnGraham> LIBJSON was installed from libjson-glib-1.0-0 libjson-glib-dev
[17:38:42] <HyperJohnGraham> Is this going to break anything or is it just Whining ! :)

2015-05-05
[12:02:24] <wardi> https://plus.google.com/hangouts/_/event/cb1vmkss426lkqicj94a3amvd1c?authuser=0&hl=en-GB meeting?
[12:03:36] <mattfullerton> I would be interested in joining you guys again if you're meeting
[14:11:27] <amercader> sorry mattfullerton just noticed your message, no need to ask, just come join us on the hangout!
[14:11:39] <amercader> next one is Thursday 15:00 utc
[14:21:18] <pdurbin> rgrp: Hi! I just replied to you here: [okfn-labs] common APIs and metadata from repositories - https://lists.okfn.org/pipermail/okfn-labs/2015-May/001611.html
[16:40:30] <coreybits> wardi: I need to be able to hide empty fields when using scheming, could you point me in right direction.
[16:42:02] <coreybits> Also are hidden fields an option with scheming
[16:48:31] <wardi> coreybits: just override the template that loops over the fields for display
[16:48:52] <wardi> then add whatever logic you like for hiding fields
[16:50:11] <wardi> scheming/package/snippets/additional_info is probably what you want
[19:38:13] <coreybits> Thks wardi that was the tip I needed.
[20:19:00] <wardi> \o/

2015-05-04
[08:59:01] <mrwiredancer> Hello
[09:00:07] <mrwiredancer> I'm new to ckan. I just modified some files in /lib folder and wondering how to make it effective
[09:01:03] <mrwiredancer> seems I need to "restart" the app or recompile the files somehow.

2015-05-03

2015-05-02

2015-05-01
[20:34:40] <coreybits> Where can I add to the format_autocomplete ?
[20:35:03] <coreybits> resource format autocomplete that is
[20:36:09] <wardi> add to?
[20:37:03] <coreybits> add a few more extensions to the list, rss, kml etc
[20:40:10] <wardi> coreybits: ah, good question. looks like the format_autocomplete action just looks at formats that exist in other resources
[20:41:08] <wardi> you could override the template and have it pull from your own list instead
[20:44:30] <coreybits> interesting, I was thinking it came from a list already, I will have to see on an empty instance
[20:48:40] <coreybits> You are correct, that is probably a better method anyways.

2015-04-30
[15:01:41] <wardi> https://plus.google.com/hangouts/_/event/cb1vmkss426lkqicj94a3amvd1c?authuser=0&hl=en-GB

2015-04-29

2015-04-28
[14:47:55] <Coasterz> Morning all
[14:55:22] <Coasterz> wardi: would you happen to have a moment to help point us in the right direction, ckanext-scheming with validation on multiple_select, multiple_checkbox fields
[14:57:38] <wardi> Coasterz: just replying to your ticket now
[14:59:22] <Coasterz> oh man, I swore I tried that. I'll go back and test again
[15:00:18] <wardi> I'm saying you're right, that feature is missing
[15:00:47] <wardi> maybe easiest is to put scheming_required after scheming_multiple_choice and special case when the value is a list
[15:01:03] <wardi> (I don't think ckan's not_empty handles that)
[15:43:05] <wardi> hey-hey ckancon2015 will have internet
[17:13:17] <mikeberg_> wardi: I'm trying to override 'templates/scheming/snippets/form_field.html' in your scheming extension but not having any luck. Is there a different way to do it other then putting the new template in the same relative location and calling {{ ckan_Extends }} ?
[17:19:29] <wardi> mikeberg_: you can set a different "form_snippet" in your schema
[17:20:06] <wardi> oh, you're asking about form_field
[17:22:03] <wardi> mikeberg_: you could override the one above: scheming/package/snippets/package_form.html
[17:22:40] <wardi> mikeberg_: what are you trying to accomplish? {% ckan_extends %} should work fine
[17:53:12] <mikeberg_> wardi: I'm just modifying form_field.html to add a div with a unique Id for each form field, we're trying to target some styling to specific form fields
[17:54:43] <mikeberg_> wardi: in my extension I copied form_field.html and put it in "ckanext-myext/ckanext/scheming/templates/snippets/form_field.html", added {{ ckan_extends }} but it still is using the form_field from the scheming extension and not my override
[17:59:46] <wardi> mikeberg_: is your plugin listed first in the plugins setting?
[18:03:46] <mikeberg_> wardi: no its at the end of the plugin chain
[18:04:06] <mikeberg_> wardi: I'll keep digging, sounds like I'm doing the right things though right?
[18:17:05] <wardi> mikeberg_: put yours first and it will be able to override templates
[18:17:13] <wardi> (at least put it before scheming)
[18:18:16] <mikeberg_> wardi: thanks
[20:52:14] <mikeberg> wardi: Going crazy with this override, so I'm loading my schema before scheming_datasets, have {% ckan_extends %} at the top and its in the same location in my ckanext that it is in scheming-datasets and still its using the scheming_dataets version of 'form_field.html'
[21:10:23] <wardi> mikeberg: by loading the schema you mean your plugin comes first, and you are adding your template directory in your plugin, right?
[21:10:51] <mikeberg> yes to both
[21:12:12] <wardi> plugin load order is a bit complicated. are you importing the scheming plugin.py file from your module?
[21:13:01] <wardi> or a similar thing to check: what does the template directory path list look like on your site?
[21:13:32] <wardi> template_paths in ckan.config.environment
[21:14:19] <wardi> or rather, g.template_paths
[21:42:54] <wardi> mikeberg: can you show the value of {{ g.template_paths }} from a template that you do have control over?
[22:11:33] <coreybits> wardi: were not doing anything fancy yet in our extension, just mainly overriding presets.json and adding our own datasets.json files. Were including our files in our config file with scheming.dataset_schemas scheming.presets
[22:12:22] <coreybits> would load order of those be an issue I wonder
[22:12:49] <wardi> coreybits: plugin load order affects template_paths order
[22:13:48] <coreybits> so we have changed to loading ours first, and then loading scheming afterwards.
[22:14:42] <coreybits> You mention importing the plugin.py from scheming, shouldn't need to do that if were just trying to override the templates right ?
[22:23:41] <wardi> that's right. can you see what's in g.template_paths?
[22:33:00] <mikeberg> wardi: this is a little large but here's {{ g.template_paths }}: ['/usr/lib/ckan/default/src/ckan/ckanext/stats/templates', '/usr/lib/ckan/default/src/ckanext-pages/ckanext/pages/theme/templates_main', '/usr/lib/ckan/default/src/ckanext-spatial/ckanext/spatial/templates', '/usr/lib/ckan/default/src/ckanext-ab_scheming/ckanext/ab_scheming/templates', '/usr/lib/ckan/default/src/ckanext-scheming/ckanext/scheming/templates', '/usr/lib/cka
[22:34:12] <mikeberg> wardi: my irc is truncating, here: https://gist.github.com/mikekberg/e2184b28f78cbad26a24
[22:34:24] <mikeberg> wardi: ab_scheming is our extension
[22:35:34] <wardi> mikeberg: that looks good. can you try without {% ckan_extends %}?
[23:33:10] <coreybits> wardi: Thanks for your help. that seems to have solved the issue, we had tried with and without the ckan_extends. I guess it was the load order after all
[23:57:39] <wardi> oh, i've been there.. 3 levels deep of extensions overridding and extending templates. not fun

[11:59:24] <wardi> meeting? https://plus.google.com/hangouts/_/event/cb1vmkss426lkqicj94a3amvd1c?authuser=0&hl=en-GB
[12:00:23] <palcu> after an upgrade from 2.0 to 2.3 I now get when I try to download any file from the filestore
[12:00:36] <palcu> https://gist.github.com/palcu/fd187147aca1bce61d8e
[12:01:02] <palcu> do I have to run `paster db migrate-filestore`?
[12:49:22] <palcu> nop, it did not work after I ran that command :(
[12:51:15] <amercader> palcu: this looks like a file permissions problem, ensure that your storage_dir is owned by the www-data user
[12:51:58] <amercader> this is generally /var/lib/ckan/default or similar
[12:52:07] <palcu> so I have `ckan.storage_path = /var/lib/ckan/default`
[12:52:36] <palcu> https://gist.github.com/palcu/0af2d94ec8e58d7bb82f
[12:52:56] <palcu> the resources folder appeared after I ran migrate-filestore
[12:54:49] <palcu> amercader: ^
[13:03:35] <palcu> ok, I replaced ckan.storage_path w/ ofs.storage_dir and it now works
[13:26:45] <Guest24188> we are still running on an instance ckan v1.4(.3) - are there (really) big security issues, so that we should immediately upgrade to the newest version?
[14:03:51] <amercader> Guest24188: I would strongly recommend to upgrade to a more recent version
[14:04:05] <almereyda> hrr, this answer arrived only seconds too late.
[14:04:33] <almereyda> I was about to look for a security advisory, but that's not necessary anymore.

2015-04-27
[19:38:13] <mikeberg> wardi: Is there a way in your schming extension to get the current `dataset_type` for a page? we're doing some styling on search/entry forms and we'd like to change verbage based off dataset_type
[19:46:25] <wardi> mikeberg: it should be passed in to all the templates
[19:46:30] <wardi> as 'dataset_type'
[19:47:06] <mikeberg> wardi: its just a global or is it sitting under an object somewhere?
[19:47:43] <wardi> it's passed to each template, so it's local to that template e.g. {{ dataset_type }}
[19:47:55] <mikeberg> wardi: awesome, thanks
[19:48:32] <wardi> mikeberg: I'm a fan of debugging template by sticking a {{1/0}} in and poking around with the interactive debugger
[19:49:00] <wardi> there you can see all the variables, call code interactively, etc.
[19:49:25] <mikeberg> wardi: ahh awesome, ok thanks. Is there a way to trigger the shell without the 1/0 trick?
[19:49:37] <wardi> I hear pycharm has an even cooler thing, but I haven't learned that yet
[19:49:55] <wardi> (you can set breakpoints in jinja templates on a live site)
[19:49:56] <mikeberg> wardi: I noticed there is a ckan-dev with remote debugging and ipython shell
[19:50:29] <wardi> that sounds cool too
[19:51:00] <mikeberg> wardi: if you feel adventurous https://github.com/NaturalHistoryMuseum/ckanext-dev
[19:51:24] <mikeberg> ward: I've manged to get python to start but paster isn't hosting pages so I gave up
[19:51:52] <mikeberg> wardi: that aliceh75 guy isn't an irc regular is he?


2015-04-26

2015-04-25
[03:41:31] <jiraiyah> god damn, not this again http://prntscr.com/6xuyht
[03:41:39] <jiraiyah> can anyone identify what is this about?

2015-04-24

[09:18:28] <palcu> hello
[09:19:05] <palcu> when I install a custom plugin to a production CKAN that was installed from a .deb, do I have to chown everything to a specific user?
[09:19:21] <palcu> because my custom theme does not load and I cannot debug because the installation is using Apache
[09:26:03] <amercader_> amercader: I have been trying to reproduce https://github.com/OpenDevelopmentMekong/ckan-2.3/issues/1 in order to open that PR we mentioned yesterday. I have deployed a vanilla CKAN 2.3 instance and wrote a little python script using ckanapi to imitate the import scripts that produce the error.  I could not reproduce it then so I believe the problem is very specific to the import scripts we are using
[09:26:58] <amercader_> I just wanted to let you know. Now i need to attend other matters but I keep on trying to find the Issue of that date comparison thingy, which seems to be very tricky
[09:27:56] <acorbi> I have been trying to reproduce https://github.com/OpenDevelopmentMekong/ckan-2.3/issues/1 in order to open that PR we mentioned yesterday. I have deployed a vanilla CKAN 2.3 instance and wrote a little python script using ckanapi to imitate the import scripts that produce the error.  I could not reproduce it then so I believe the problem is very specific to the import scripts we are using. I just wanted to let you know. Now i need to a
[09:28:32] <acorbi> oh boy, i logged in with your nickname before, I am still a bit sleepy....
[09:29:55] <amercader> acorbi: was freaking out for a second :D Am I talking to myself??
[09:30:34] <amercader> acorbi: np, if the issue surfaces again let me know
[09:31:05] <amercader> palcu: you should install your plugin on /usr/lib/ckan/default/src using root
[09:31:32] <amercader> make sure to do `python setup.py develop` with the virtualenv activated
[09:32:46] <acorbi> amercader: Lol, I freaked out as well! ok, keep in touch. BTW, you saw https://github.com/ckan/ckan/issues/2405 ??
[09:34:32] <amercader> acorbi: yes, the multilingual plugin definitely needs testing / fixing on 2.3. we should polish it and add the fixes to 2.3.1 pathc release
[09:35:07] <amercader> acorbi: if you have the change the issue is likely located on these methods : https://github.com/ckan/ckan/blob/master/ckanext/multilingual/plugin.py#L194
[09:35:13] <amercader> *chance
[09:36:25] <acorbi> roger that
[09:55:22] <palcu> amercader: yes, it was installed correctly. I forgot to set in production.ini `ckan.homepage_style = 3`
[09:55:26] <palcu> thanks
[09:55:36] <amercader> palcu: cool!
[17:57:26] <travis-ci> ckan/ckan 2344-igroupform 4175107 http://travis-ci.org/ckan/ckan/builds/59911545 David Read: The build was broken.

2015-04-23

[09:39:57] <palcu> hello, I'm trying to create a custom theme, but I don't know if it's being loaded
[09:40:07] <palcu> is there a log I could check or something?
[09:40:55] <joet> palcu, set debug = true in your config
[09:41:00] <joet> if you scroll to the bottom of the page
[09:41:17] <joet> tehre should be a "debug" link, click on that, and it'll tell you all the templates used.
[09:41:42] <palcu> yes, but my example_theme is not used and I don't know where to start checking what mistake did I do :)
[10:18:24] <palcu> my problem was I was setting the plugin name in ckan.views.default_views, not ckan.plugins :(
[10:54:02] <joet> ah always worth checking the basic parts :/
[10:54:11] <joet> wardi what was that travis alternative you mentioned?
[10:58:20] <wardi> circleci
[10:58:39] <wardi> it's great
[11:01:19] <joet> yeah it just crossed my mind, since ubuntu 15.04 is released today, and it just highlighted that travis is still using 12.04 which is annoying.7
[13:55:22] <acorbi> Hi everyone, I have recently successfully deployed CKAN v2.3 on http://data.opendevelopmentmekong.net/, everything works fine besides search which is not returning any results when I use the top search bar or the one on http://data.opendevelopmentmekong.net/dataset.
[13:56:19] <acorbi> Strangely, if I search within an organization, search does return results : http://data.opendevelopmentmekong.net/organization/cambodia-organization?q=a&sort=score+desc%2C+metadata_modified+desc
[13:57:00] <acorbi> If I use the API directly http://data.opendevelopmentmekong.net/api/3/action/package_search?q=a it returns empty even if there are  2222 datasets....
[13:57:41] <amercader> acorbi: without the q=a it returns 2208 dataset to me
[13:58:04] <acorbi> true
[13:58:16] <amercader> acorbi: actually http://data.opendevelopmentmekong.net/dataset works fine for me
[13:58:22] <acorbi> yes, for me as well
[13:58:30] <acorbi> but expected behaviour is that it returns results
[13:58:45] <amercader> acorbi: sorry. my bad
[13:59:02] <acorbi> I mean, when querying something simple as a
[13:59:10] <amercader> this is weird
[13:59:19] <acorbi> or take this example
[13:59:20] <acorbi> http://data.opendevelopmentmekong.net/dataset?q=Human
[13:59:30] <acorbi> that query should return at least this dataset
[13:59:31] <acorbi> data.opendevelopmentmekong.net/dataset/human-development-index-trends-1980-2013
[13:59:36] <acorbi> http://data.opendevelopmentmekong.net/dataset/human-development-index-trends-1980-2013
[13:59:42] <amercader> have you reindexed the datasets after the upgrde?
[13:59:49] <acorbi> yes
[14:00:07] <acorbi> and actually querying directly on Solr returns expected results
[14:00:28] <amercader> sigh, that's a new one
[14:00:36] <amercader> do you use a custom schema?
[14:00:42] <amercader> solr schema I mean
[14:01:06] <acorbi> let me double check, but it should be normal ckan 2.3 schema
[14:02:00] <acorbi> this one https://github.com/OpenDevelopmentMekong/ckan-2.3/blob/master/ckan/config/solr/schema.xml
[14:04:26] <acorbi> All packages are indexed
[14:04:27] <acorbi> root@ckan:/# paster --plugin=ckan search-index check --config=/etc/ckan/production.ini  Packages not indexed = 0 out of 2222
[14:08:53] <amercader> acorbi: I can't see how a plain ckan would do that
[14:08:59] <amercader> things to check:
[14:09:15] <amercader> - disable any customizations (plugins, and stuff like https://github.com/OpenDevelopmentMekong/ckan-2.3/commit/f02a6a1de8a0fe68ecdb9add5a7028ab6e9694c2)
[14:09:53] <amercader> - check /var/log/jetty/catalina.log (?) for the Solr log after doing a query from ckan to see if it gice more clues
[14:11:19] <acorbi> checking...
[14:13:33] <amercader> btw I'd love a PR with that _date fix ;)
[14:15:43] <acorbi> on my TODO list ;)
[14:17:42] <acorbi> I can confirm that disabling https://github.com/OpenDevelopmentMekong/ckan-2.3/commit/f02a6a1de8a0fe68ecdb9add5a7028ab6e9694c2 does not help
[14:35:54] <acorbi> amercader: I just disabled ALL plugins and search works as expected
[14:36:07] <acorbi> before I just disabled googleanalytics and our own theme
[14:36:11] <acorbi> but did not help
[14:36:16] <acorbi> so it must be an Issue of the others
[14:36:35] <acorbi> i have to go AFK now but I'll come back to you once I discover which one is provoquing it
[14:36:42] <acorbi> and I'll do that PR as well
[14:36:47] <acorbi> thanks for your help
[14:37:26] <acorbi> it has to be one of these: stats image_view text_view webpage_view recline_view recline_grid_view recline_graph_view recline_map_view pdf_view datastore datapusher resource_proxy multilingual_dataset multilingual_group multilingual_tag geojson_view wms_view
[14:39:15] <acorbi> any candidate in your opinion?
[14:57:15] <amercader> acorbi: multilingual_* seem like the most plausible culprits
[14:58:02] <amercader> IIRC multilingual required some custom fields in the schema so it might be worth checking that
[14:59:46] * wardi dreams of a generic solr schema that supports multilingual, fluent and inline repeating fields
[15:00:16] <wardi> https://plus.google.com/hangouts/_/event/cb1vmkss426lkqicj94a3amvd1c?authuser=0&hl=en-GB
[15:00:19] <amercader> so elasticsearch :)
[15:00:19] <wardi> meeting?
[15:00:28] <wardi> amercader: oh?
[15:01:20] <amercader> as it is schemaless...
[15:01:35] <amercader> but I think your case can be achieved with solr as well
[15:01:38] * wardi wonders how that can work
[15:02:57] <joet> solr 5 has a schemaless mode
[15:03:19] <joet> but they recommend you just use it to build your schema, not really for use in production.
[15:03:22] * wardi wants to learn more of this magic
[15:03:53] * wardi is in a noisy office
[15:17:50] <amercader> http://data.gov.uk/dataset/highways_agency_planned_roadworks
[15:19:30] <wardi> sound cutting out for me :-(
[15:32:10] <amercader> http://datahub.io/dataset/europeana-sparql

2015-04-22
[06:46:23] <shantanu> Hi, I am in the process of upgrading ckan from 2.2 to 2.3.1. I am unable to display previews of excel and csv files
[06:49:49] <shantanu> the datapreview throws an error at this line 67 in reclineview/plugin.py - resource_view_json': json.dumps(data_dict['resource_view'])}
[06:50:33] <shantanu> the function is called by controllers/package.py where the data_dict passed has no key resource_view defined
[06:50:44] <shantanu> any ideas what I'm missing?
[15:30:55] <joet> lazy request: do we have a template helper that does a json.loads on a string?
[15:31:15] <joet> feel like I've bumped into it before or written it myself several times at this point
[15:31:18] <joet> losing track
[16:44:26] <wardi> joet: hmm. why are we passing json to a template instead of the decoded version?
[16:45:54] <joet> because I'm abusing a database field
[16:46:31] <joet> I do feel a bit bad
[16:48:33] <wardi> another correct answer is "because spatial"
[16:50:00] <wardi> I've started decoding those things and returning them in the package dict. I know amercader doesn't approve, but.. json strings in json is just so terrible
[16:51:55] <amercader> wardi: can you elaborate on that? where in spatial is this used?
[17:04:36] <wardi> amercader: spatial is an extra field that contains a json string, so when you get it from the api you need to decode it (even though it's embedded within json)
[19:59:09] <amercader> wardi: that's not spatial's fault! :) at least until recently it was the only way of encoding complex structures in extras values
[19:59:33] <amercader> if any, it's our dictization / validation's fault
[19:59:50] <amercader> but I also like values as json (not strings)

2015-04-21
[12:00:11] <wardi> meeting! https://plus.google.com/hangouts/_/event/cb1vmkss426lkqicj94a3amvd1c?authuser=0&hl=en-GB
[21:22:04] <travis-ci> ckan/ckan 2344-igroupform 24b163a http://travis-ci.org/ckan/ckan/builds/59429143 David Read: The build has errored.

2015-04-20

2015-04-19

2015-04-18
[12:53:51] <acorbi> Hi everyone, maybe somebody can answer me this quickly: I am runing paster --plugin=ckan db clean -c /etc/ckan/production.ini, to clean the database and load a sql dump afterwards.
[12:54:36] <acorbi> The command seems to hang up. I had 0 datasets in the CKAN instance, so it should not take long in cleaning the DB
[12:55:13] <acorbi> Is this a know Issue
[12:55:15] <acorbi> Is this a know Issue?
[12:58:54] <acorbi> or maybe somebody knows an alternative sql query to clear the database easily....
[13:34:52] <palcu_> I've had the same issue
[13:34:53] <palcu_> https://github.com/ckan/ckan/issues/2306
[13:45:39] <wardi> we should apply that fix
[13:46:11] <wardi> acorbi: short version: stop serving the site and it will work

2015-04-17

2015-04-16
[13:28:46] <wardi> my apologies, I'll be half an hour late to the meeting today
[13:35:23] <wardi> looks like I might be building validation for datastore_upsert
[14:58:35] <amercader> 5 min late to meeting sorry
[15:35:38] <joet> amercader, do we just have a romantic ckan dev meeting for two?
[15:35:49] <amercader> haha
[15:35:56] <amercader> I say abort mission
[15:36:04] <amercader> I can't talk much anyway
[15:36:19] <amercader> unless you also want to hear crying and shouting
[15:36:23] <amln> :(
[15:37:08] <wardi> still in another mtg :(
[15:38:07] <amercader> that came up really bad, there is also lots of laughing
[15:38:15] <amercader> how are you amln ?
[15:38:40] <amercader> joet: let's call it a day
[15:38:49] <joet> yeah
[15:46:58] * wardi catches up on the pad
[15:47:50] <wardi> i guess nothing happened. ok, then
[15:55:06] <joet> there was a candlelit dinner with soft music
[17:36:06] <wardi> was there a specific spelling for ckancon chosen last year?

2015-04-15
[11:47:12] <georgiabullen> hi all
[11:47:28] <georgiabullen> has anyone had this issue before? CKAN is rounding my lat/lon fields and removing decimal points
[15:29:38] <mikeberg> wardi: morning, do you have a way in the scheming extension to get what dataset_type is being created?
[15:52:35] <wardi> ...

2015-04-14
[11:59:29] <wardi> meeting?
[12:00:13] <wardi> https://plus.google.com/hangouts/_/event/cb1vmkss426lkqicj94a3amvd1c?authuser=0&hl=en-GB

2015-04-13
[12:07:04] <ilab> Hi, when creating the apache config file, do I replace default.ckanhosted.com with default.mydomain.com or just mydomain.com?
[12:26:00] <brook> ilab: With whatever your domain is. default.ckanhosted.com is just an example of a subdomain being used.
[12:31:51] <ilab> brook: Got it. Thank you.
[20:38:33] <badbruce07> hey good afternoon. I need some help in ckan. For a main page i'm trying to show in a column the group with the most datasets, having the group as a heading and two of the datasets as examples or most viewed. How do I do that codewise?

2015-04-12
[20:55:23] <mattl_> Good evening! I have a question about the CKAN API output format and autocomplete format, is there any chance that someone has a moment?

2015-04-11
[15:26:27] <poguez_> wardi: what talk are you in?
[15:26:39] <poguez_> @ pycon
[16:15:15] <wardi> poguez_: nedbat's talk
[16:15:47] <wardi> 710a
[16:19:26] <poguez_> wardi: let's meet for lunch i'm in 511
[16:26:47] <wardi> poguez_: sure!
[16:27:24] <poguez_> wardi: let's meet outside the 511
[16:28:21] <wardi> sounds good
[16:33:41] <wardi> poguez_: my talk is done, want me to wait?
[16:40:38] <poguez_> Im heading there

2015-04-10

2015-04-09
[04:47:37] <nesher_> how do I find if a website is ckan or not and the version ?
[04:50:01] <Zharktas> http://whateverdomain/api/util/status
[04:53:40] <nesher_> I found this on stackoverflow. But could get the expected json result for http://daten.berlin.de/api/util/status
[04:54:09] <nesher_> so -- "/api/util/status" Is it reliable ?
[04:55:32] <Zharktas> i would guess that daten.berlin.de is not ckan
[04:55:50] <Zharktas> layouts are different, urls are different
[04:56:01] <Zharktas> and the api does not exist
[04:57:14] <nesher_> aah ok. It works for most of the others. So I got it. Thank you for clarifying. I picked the daten.berlin.de website from http://ckan.org/instances/
[05:54:23] <Zharktas> nesher_: it appers that daten.berlin.de has drupal frontend and ckan somewhere behind it so the api is not in the same url namespace at least
[05:54:50] <nesher_> ahh! makes sense.. I should have looked at the src..
[15:02:28] <amercader> apols, can't make the dev meeting today, at least the first half
[15:03:22] <wardi> ooh meeting
[15:04:33] <wardi> https://plus.google.com/hangouts/_/event/cb1vmkss426lkqicj94a3amvd1c?authuser=0&hl=en-GB
[15:07:47] <joet> https://github.com/ckan/ckan/pull/2200
[16:22:19] <amercader_> wow looks like wardi really loves circleci!
[16:22:44] <amercader_> joet, wardi: happy to take some of your new prs if you want
[16:24:39] <joet> amercader_, you probably have enough as it is :p

2015-04-08

2015-04-07
[00:03:33] <ilab> I'm a rails dev and a python/django newbie. Following the second doc I fail at paster --plugin=ckan create -t ckanext ckanext-example_theme with a slew of errors ending with "ImportError: No module named plugin"
[00:10:11] <ilab> Actually, I had a typo and that last command now passes.
[00:19:38] <ilab> This can't seriously be the way you change the color scheme.
[06:16:59] <shantanu> Hi, I'm upgrading my ckan 2.2 instance to 2.3.1 and encountering this error while editing resources - Error - <class 'jinja2.exceptions.UndefinedError'>: 'resource_form_snippet' is undefined
[06:17:07] <shantanu> any idea how this can be solved?
[06:22:10] <Zharktas> shantanu: most likely you have old dataset edit function somewhere
[06:22:36] <Zharktas> we had the same problem since we had overwritten the ckan function with our own modification
[06:42:26] <shantanu> thanks Zharktas, can you guide me what specific function do I have to look for?
[06:42:41] <shantanu> the error trace isn't very friendly
[06:44:15] <Zharktas> shantanu: old: https://github.com/ckan/ckan/blob/ckan-2.2.2/ckan/controllers/package.py#L784 new: https://github.com/ckan/ckan/blob/master/ckan/controllers/package.py#L769
[06:50:11] <shantanu> Thanks a lot Zharktas.. I'll have a look
[09:49:52] <acorbi> Hi Everyone: I have a performance question depending on amount of stored datasets and bootup times. In the context of http://data.opendevelopmentmekong.net/, which is an instance based on CKAN v2.2.1 deployed through uwsgi on a server with 2core and 4GB of memory (using docker containers), currently with VERY low traffic and 13 datasets are hosted. In this scneario, bootup times after restart of the docker container is quick and does no
[09:50:15] <acorbi> the bootup time and derivated Issues increase considerably with the number of datasets. On the very same hosting, and being populated with ~2000 datasets, the CKAN instance takes up to 20 minutes to boot and sometimes shows an erratic behaviour after rebooting ( Internal Server Errors, random URLs and resources not being loaded). So, here my questions: - Do the characteristics of the described system (number of datasets, traffic) comply
[09:50:30] <acorbi> - Do the characteristics of the described system (number of datasets, traffic) comply with the "small to medium" instance type mentioned on https://github.com/ckan/ckan/wiki/Hardware-Requirements?
[09:50:38] <acorbi> - During the bootup process, activity on the CKAN and Postgresql side can be detected. both components take a big percentage of the CPU during the bootup (~20 minutes). What is supposed to be happening behind scenes?
[09:50:42] <acorbi> - Is there any possible action to be done in order to reduce the booting time of a restarted CKAN instance? (DB/Solr/ckan conf.)
[09:50:45] <acorbi> - Is there any action in general to profile performance and/or detect errors that you would recomend to use?
[12:00:43] <wardi> https://plus.google.com/hangouts/_/event/cb1vmkss426lkqicj94a3amvd1c?authuser=0&hl=en-GB
[12:00:49] <wardi> meeting?
[12:04:11] <wardi> brb
[12:04:20] <wardi> that ticket is related to another of mine
[15:32:09] <rossjones> Hi wardi - looks like I'll not be working on CKAN in the future, new job, not ckan.  Should I just unassign myself from tickets where I am assigned so that someone else could pick them up?  I can detach myself from the org (I think) once I've done that.
[15:35:30] <wardi> rossjones: :-(
[15:35:38] <wardi> rossjones: sure, that makes sense
[15:35:52] <rossjones> Cool, I'll do that now - not too many I don't think.
[15:36:51] <joet> rossjones, you could do them anyway :p
[15:37:07] <joet> that would be the quickest way is to fix the issues and then they'd be closed
[15:38:03] <rossjones> joet hehe, unfortunately I have an insane amount of stuff to learn for new job - I think free time is going to be even rarer than normal
[15:38:16] <wardi> rossjones: something fun I hope?
[15:40:03] <rossjones> wardi it's Massive Data - like Big Data but bigger.  Storage related mostly.
[15:46:23] <wardi> storage and networking, I imagine. cool
[15:49:48] <rossjones> Yup, and a few other bits too - it's part of the local University, so trying to sneak back into academia while they're not looking :)
[16:43:20] <amercader_> rossjones: good luck on the new gig
[16:43:43] <amercader_> maybe you'll find the need for a new ckan storage backend to support Massive Data
[16:44:31] <rossjones> amercader_ thx :)

2015-04-06
[22:00:16] <poguez_> denisz wardi  are you guys attending pycon?
[22:00:39] <denisz> poguez_ yes we are!
[22:01:11] <poguez_> denisz: good to hear about that!
[22:01:16] <poguez_> when are you guys arriving?
[22:02:01] <denisz> thursday afternoon, you?
[22:05:29] <poguez_> denisz: tomorrow night!
[22:17:47] <denisz> poguez_ nice, we should get together for dinner on thursday or one of the other days
[22:18:20] <poguez_> sure denisz
[22:18:29] <poguez_> let's alzo organize BoF
[22:19:25] <poguez_> we are developing some ckan extensions that i might like to show you & wardi to give us some advice :)
[22:25:19] <denisz> yes, for sure. I think we just add it to https://us.pycon.org/2015/community/openspaces/
[22:27:43] <denisz> poguez_ and send an email to me or wardi on thursday if you want to get together for some poutine. you can reach us both at contact@boxkite.ca
[22:27:51] <denisz> we should be in town by ~5pm
[22:28:38] <poguez_> sure!, thanks denisz
[23:57:59] <ilab> Hi, I need to change the color theme on a local instance of ckan. I'm following this documentation: http://docs.ckan.org/en/latest/theming/css.html which appears to require that I've previously followed this documentation: http://docs.ckan.org/en/847-new-theming-docs/theming/templates.html

2015-04-05

2015-04-04

2015-04-03

2015-04-02
[15:05:04] * wardi stuck in a meeting
[15:05:17] <joet> http://bit.ly/ckandevmeeting
[15:07:32] <joet> wardi, we can wait.
[15:08:17] <joet> it's just brook and myself atm
[15:11:06] <wardi> coming
[17:13:49] <MikeBerg> wardi: rumour has it you wrote the scheming extension
[17:14:10] <wardi> MikeBerg: git history says that too
[17:14:46] <MikeBerg> wardi: that git, always taddling
[17:15:34] <MikeBerg> wardi: loving the extension! could only imagine the joy it would be doing that manually
[17:17:30] <MikeBerg> Is there a required validator or a way I can mark the field as required in the JSON? I don't see required in the list of ckan validators
[17:19:15] <MikeBerg> ok, in hindsight I should have checked your docs on github
[17:19:19] <MikeBerg> just ignore me
[17:26:31] <wardi> looking for "required": true ?
[17:36:14] <MikeBerg> yeah :D
[17:36:51] <MikeBerg> Just for my own curiosity sake, the code that reads the JSON files would all be in the plugin.py right?
[17:38:14] <MikeBerg> just trying to walk through how everything in ckan is working, Is there a page request lifecycle doc anywhere? I guess I could divide by 0 in a template and crawl the stacktrace
[17:44:51] <wardi> MikeBerg: yeah, I'm fond of {{1/0}} debugging
[17:46:21] <MikeBerg> wardi: pylons has the best interactive debugger of all time

2015-04-01
[11:27:10] <joet> I merged new_tests -> tests. I hope I haven't broken master :p
[11:29:16] <wardi> woo!
[11:32:52] <joet> I still think a surfin' bird cover where the lyrics are "everybody's heard about the merge" should exist.
[11:33:07] <joet> perhaps it can be the next ckan song.
[11:40:15] <wardi> is steven here?
[11:41:38] <joet> did we ever decide on whether we should add stuff to the changelog as we go?
[11:45:28] <joet> I've also merged https://github.com/ckan/ckan/pull/2258 and support to text browsers should go top of the list in the change log for 2.4
[11:46:32] <joet> on a serious note https://github.com/ckan/ckan/pull/2206 has an api change should really go into the changelog, and I'm just worried we'll have forgotten by the time it roles round
[11:47:04] <joet> but I'm happy to add a note to change the change log as i merge
[12:03:13] <brook> I think it's better to add to the changelog as we go. It can be reviewed before a release for relevance.
[12:17:19] <wardi> joet: good catch. i can add that
[14:27:40] <amercader_> please please add to the changelog as we go, don't worry about formatting.
[14:28:04] <amercader_> otherwise I need to dig stuff before release and things get forgotten
[14:47:50] <joet> cool, will do
[15:20:16] <georgiabullen> hi all!
[15:20:33] <georgiabullen> i have a quick question about the recline preview for maps if anyone has a minute...
[15:22:26] <joet> I probably won't be of any help, but don't ask to ask, just ask.
[15:22:51] <georgiabullen> i'm wondering if there's a way to access the geojson feed of the data via the api
[15:23:01] <georgiabullen> so that I could use it in another visualization
[15:23:19] <georgiabullen> it might be a recline question actually
[15:26:12] <georgiabullen> i'm using the data from a resource in another website as part of a visualization
[15:26:56] <georgiabullen> but via the API, I basically need to create a geojson file from the datastore api, OR if recline offers that as an api request (or something) i could do that...
[15:26:59] <georgiabullen> does that make sense?
[15:29:20] <joet> not sure i can help you on this one, you might get a wider audience on ckan-dev mailing list.
[15:29:35] <georgiabullen> ok i can email there or search the archives
[15:41:24] <travis-ci> ckan/ckan master 54f70a2 http://travis-ci.org/ckan/ckan/builds/56735657 joetsoi: The build was broken.
[15:57:30] <georgiabullen> i found an answer! http://stackoverflow.com/questions/25539838/how-can-i-load-data-from-a-ckan-api-into-a-recline-js-generated-map-on-an-extern
[15:57:35] <georgiabullen> if anyone else was interested.
[17:43:41] <MikeBerg> Hey Guys! I'm new to ckan and working on an open data portal for the alberta government. Is there class library documentation somewhere? specifically I'm looking for a method to return a list of all loaded plugins, i've dir'd ckan.plugins but I don't see anything
[17:43:54] <MikeBerg> where can I find the docs around the ckan internal class library?
[17:45:59] <wardi> MikeBerg: ckan.plugin.PluginImplementations gets you plugin objects by the interfaces they implement, is that what you want?
[17:46:30] <wardi> MikeBerg: the API status_show gives you a list of plugins enables in the config
[17:48:57] <MikeBerg> wardi: ckan.plugin.PluginImplementations is perfect! thanks a ton. I assume that an object I can just iterate over?
[17:49:25] <wardi> MikeBerg: check out how it's used other places
[17:49:44] <wardi> it's a function that returns an iterable
[17:50:03] <MikeBerg> wardi: Will do, thanks a ton you saved me a couple hours. I owe you a beer
[17:51:20] <wardi> MikeBerg: sounds good. coming to http://opendatacon.org/? :-)
[17:52:46] <MikeBerg> wardi: Maybe, I just got on this project so in the process of spinning up on how ckan works. I think the other dev might be going, I'll see if I can tag along
[17:53:15] <MikeBerg> wardi: I'm just a python fanatic and happy I found a government project that uses python :)
[17:56:50] <wardi> MikeBerg: going to pycon?
[17:58:49] <MikeBerg> wardi: I wish, tickets sold out before I got a chance to get one. I wonder if ebay has any, I'd love to go
[19:08:09] <wardi> MikeBerg: if you're in Calgary I'll collect next time I'm in town
[19:46:09] <MikeBerg> wardi: Deal!

2015-03-31
[11:59:55] <wardi> https://plus.google.com/hangouts/_/event/cb1vmkss426lkqicj94a3amvd1c?authuser=0&hl=en-GB
[12:43:06] <wardi> where is the security email posted on ckan.org?
[13:01:32] <joet> hum, I have no idea, but I guess we could add it to the read me on the github repo
[13:10:00] <wardi> I think it should be https://github.com/ckan/ckan/blob/master/CONTRIBUTING.rst and the linked doc, and on the http://ckan.org/contact/ page
[13:10:33] <wardi> I can do the first two, but not the third
[13:20:45] <joet> hum, for the blocked users, I guess I could check for side_effect_free in check_access or something
[13:22:25] <joet> doesn't feel very general though
[13:29:17] <joet> also it'd be adding some implicit magic. I could imagine writing another auth function in a few months time with it throwing a NotAuthorized and not being able to figure it out why it isn't working as check_access is doing some more implicit magic about banning blocked users from doing anything
[14:32:57] <wardi> yeah. magic is worrying
[14:34:58] <brook> wardi: I'm looking at https://github.com/ckan/ckan/pull/2359 again - including hidden form fields in the confirm submit. Now I've looked at is more closely I think you're right. The confirm submit form is unrelated to the parent form element that it sits in. I hadn't appreciated this when I was reviewing the code snippet.
[14:39:15] <brook> So a solution may need to specify a token field (or a data-module-token attribute, which I prefer). However, this requires a decision about the general direction for how we want to handle CSRF tokens. I think we should discuss this at Thurs dev call, if you're around.
[14:49:39] <wardi> brook: sure, I should be there
[20:54:05] <gnat_x> hi folks. i have an example of the things that have been going on with our ckan instance, where things are partially broken.
[20:54:36] <gnat_x> take this public data set: https://data.opentechinstitute.org/dataset/cyber-security-definitions
[20:55:01] <gnat_x> notice the logo in the top left doesn't load, and the that the connection seems ot time out.
[20:56:46] <gnat_x> similar behavior on the preview of specific data.

2015-03-30
[12:55:07] <joet> i should merge the new tests change
[12:55:29] <wardi> joet: please
[12:55:54] <wardi> I should merge the datastore memory fix
[12:56:32] <joet> we'll have to go through the exisintg pull requests to fix all the test renames
[12:57:29] <wardi> it's not that bad, when git can detect a file move it can do the merge itself
[13:01:02] <joet> oh, I didn't know git would be that clever
[13:02:51] <wardi> it can work, but git is easily thrown off if you move only parts of files or create another file in the old one's place
[15:32:56] <gnat_x> hi folks. we're having an issue with our ckan datastore.
[15:33:43] <gnat_x> one of our xls resources choked on upload, was removed and replaced. every few days it has been giving us issues.
[15:34:18] <gnat_x> creating a brand new resource resource with the sam xls file, and removing the old resource seems to have cleared it up.
[15:35:33] <gnat_x> now we can update as expected, and things seem happier.
[15:36:10] <gnat_x> a) i'm not sure how to get more useful debugging information.
[15:36:21] <gnat_x> b) is this the right place to ask things like this?
[15:36:55] <gnat_x> c) is the component interaction documented anywhere? it seems like some of the pieces keep moving while other choke up.
[16:10:08] <wardi> gnat_x: this is the right place. sounds like a datastore+datapusher issue?
[16:10:41] <wardi> if you're regularly updating you could try using the datastore API instead of datapusher (simpler and easier to debug)
[16:12:06] * gnat_x goes to look at the docs on datastore API again.
[16:12:39] <gnat_x> lazy question... does the datastore API support pushing an update xls file?
[16:12:59] <gnat_x> the main issue is that the people generating the data we're sharing prefer to work in excel.
[16:13:35] <wardi> that's not an issue ckan can fix :-)
[16:13:58] <wardi> but it would be awesome if someone would make an excel plugin that could push directly to the datastore
[16:14:32] <gnat_x> wardi: that's what i figured. :)
[16:14:51] <gnat_x> i think we'll have to build them an interface eventually

2015-03-29
[16:46:49] <jeffszusz> hey guys, trying to update to the newest ckan
[16:47:04] <jeffszusz> having some trouble with the 'ckanext-spatial' plugin
[16:47:55] <jeffszusz> the instructions are super old though - has this plugin been replaced by something else?
[16:54:58] <jeffszusz> we're seeing the error "Attribute Error: type object 'ColumnProperty' has no attribute 'ColumnComparator' "
[16:56:49] <jeffszusz> which appears to be a SQLAlchemy problem
[19:41:03] <jeffszusz> I cleared my ckan_default and datastore_default databases to start fresh (we only had test data in there), but now even though the data is gone, ckan is still saying "7 datasets available"
[19:41:07] <jeffszusz> how do we clear that out?

2015-03-28

2015-03-27
[16:32:40] <badbruce07> good afternoon everyone. I need a take on this. Is there a way to modify the group tab name in ckan and call it something else?
[20:56:19] <badbruce07> Does statistics retrieval work on CKAN 2.2? In documentation it says "CKAN 1.X only". What would it take to support statistic retrieval on CKAN 2.2?

2015-03-26
[15:15:42] <coreybits> Hi All, is a dev meeting taking place today ?
[15:17:55] <brook> Hi coreybits - should be, in 45mins. 4pm GMT. Here's the pad: https://pad.okfn.org/p/ckan-meeting
[15:29:09] <coreybits> brook: thank you
[16:00:10] <wardi> https://plus.google.com/hangouts/_/event/cb1vmkss426lkqicj94a3amvd1c?authuser=0&hl=en-GB
[16:00:20] <wardi> meeting ^
[19:49:54] <gnat_x> hi folks, i keep having and issue where every few days something stops working.
[19:50:26] <gnat_x> the web interface for ckan works, but the data never shows up in preview, and the datastore api stops working
[19:51:15] <gnat_x> hrm. actually it looks like the datastore api is working but the preview isn't.
[19:51:44] <gnat_x> i've been fixing it by rebooting the virtual machine it is hosted on, but i would like to find a more durable solution.
[19:52:09] <gnat_x> and i'm still confused by the component interaction in, so i can't tell what's not working.

2015-03-25
[08:53:54] <rossjones> Anyone know who built http://data.yorkopendata.org/dataset ?

2015-03-24
[12:00:17] <wardi> meeting?
[12:00:22] <amercader> yes!
[12:00:26] <wardi> https://plus.google.com/hangouts/_/event/cb1vmkss426lkqicj94a3amvd1c?authuser=0&hl=en-GB
[12:22:15] <acorbi> Hi Everyone, I am having an Issue while creating packages with extras using ckanapi
[12:22:46] <wardi> acorbi: what's up?
[12:23:07] <acorbi> if a call the package_create method with more than 1 extras dict in the extras list, i get ERRO 500
[12:23:25] <acorbi> but if i just put just 1 dict, it does not break
[12:23:36] <acorbi> and the dataset is created with the extra field as expected
[12:24:01] <acorbi> so this works:
[12:24:01] <acorbi> 'extras': [{'value': 'aodajshd', 'key': 'Published under'}]
[12:24:28] <acorbi> but this doesnt:
[12:24:28] <acorbi> 'extras': [{'value': 'aodajshd', 'key': 'Published under'}, {'value': 'asajkdhkjad', 'key': 'Publication date'}]
[12:24:58] <wardi> acorbi: that's odd
[12:25:32] <wardi> acorbi: pastebin your traceback?
[12:25:39] <acorbi> sure
[12:28:56] <acorbi> http://pastebin.com/6Rj8piSz
[12:29:10] <acorbi> traceback + a bit of code
[12:29:37] <acorbi> The strange thing fact is that this code was working before
[12:30:05] <acorbi> so it might be caused by another component of the ckan instance that might have changed
[12:30:16] <acorbi> by the big question is what? and how it relates to this...
[12:34:16] <acorbi> oh, i think i got it
[12:34:22] <acorbi> look at this
[12:34:51] <acorbi> http://pastebin.com/rupSTmeN
[12:36:01] <acorbi> validate_not_empty is a validator being exposed by another plugin running in the instance
[12:36:13] <acorbi> which validates extra fields
[12:36:54] <acorbi> it has to be related, but I do not understand why the error is triggered only when  >1 extras are specified in the list
[12:41:53] <acorbi> I got an idea, I will deactivate that plugin which ships the validator and run the code again
[12:44:40] <acorbi> exactly, that validator was the Issue
[12:45:11] <acorbi> after disabling the plugin which has it, now I can add more than 1 extra dictionaries in the 'extras' list parameter
[12:45:23] <acorbi> mmmm but still do not understand the problem
[12:45:27] <acorbi> wardi: any ideas?
[12:45:41] <wardi> acorbi: in a meeting, just a minute
[12:45:48] <acorbi> oh yeah, sure
[12:54:46] <wardi> acorbi: kind of sounds like an issue with your validator, or maybe an issue with combining extras and convert_to_extras?
[12:55:06] <wardi> acorbi: try to pin it down and submit an issue
[12:55:19] <acorbi> wardi: ok, working on that today
[12:55:41] <acorbi> thanks for your time and asking for pastebins , it helped me spot the Issue
[15:06:50] <acorbi> wardi: I just shaw this https://github.com/ckan/ckan/issues/2150
[15:08:38] <acorbi> it is not related to the validator as I guessed but to the way extras and the convert_to_extras work
[16:17:04] <wardi> acorbi: I know it's supposed to be possible to mix them, but I have never tried
[16:17:27] <wardi> if that issue is still open maybe it's broken :-(
[16:17:43] <acorbi> oh, it is supposed to be fixed on 2.3
[16:17:55] <acorbi> the problem is that I have to stick to 2.2.1 BTM
[16:18:13] <acorbi> I am trying ntoll's patch now
[16:18:21] <acorbi> would be a good solution
[16:21:28] <brook> Is there a python method to make a slug name from a title string in CKAN?
[16:22:16] <amercader> brook: munge is the word you need to look for :)
[16:22:56] <amercader> acorbi: if that patch fixes the issue please add a comment to the issue with your setup and example dataset, as I was having trouble reproducing it
[16:23:09] <brook> I feel like those munge methods are pursuing me.
[16:23:28] <acorbi> amercader: roger that
[16:24:51] <wardi> wow. munge_title_to_name is complicated
[17:55:20] <amercader> wardi: +1, we've used slugify in the past. It may be worth the extra requirement just to not have to deal with it ourselves https://github.com/un33k/python-slugify
[18:01:11] <wardi> amercader: the bit about leaving extra room for '_'s that will be added on collisions is worrying

2015-03-23
[13:51:56] <rossjones> Anyone any clues why we have datapusher 1.0 when the github version is 0.6 and the cheese-shop version is 0.5?
[14:07:56] <mikekamm> hello
[14:09:57] <mikekamm> I'm new to CKAN and I'm wanting to test CKAN. I'm trying to set-up an online data portal to collect and organize all information around ancient civelizations. There is so much information out there but very poorly indexed. ANyways, I wanted to install it using docker on google cloud, but can anyone help me do tat?
[14:17:28] <mikekamm> help
[16:14:10] <amercader> rossjones: seanh change the versioning number policy when he refactored and cleaned up the whole thing before 2.3 (1.0 to 0.0.x). I've updated pypi now (an oversight)
[16:14:16] <amercader> *changed
[16:14:55] <rossjones> thx amercader. I think out bug is related to one of the tickets that was closed, but having a hard time narrowing it down - think it's because we're using s3-archiver :(
[16:15:17] <rossjones> Once it has been pushed to s3, datapusher no longer works.

2015-03-22

2015-03-21

2015-03-20
[15:27:00] <acorbi> Hi Everyone
[15:27:39] <acorbi> amercader: Here is the paster on-liner we came up yesterday with to purge all datasets marked as 'deleted': http://wiki.opendevelopmentmekong.net/code_snippets
[15:27:47] <acorbi> *one-liner

2015-03-19
[15:33:54] <joet> acorbi, sounds cool, you should share it with the ckan-dev list, it'll just get lost to the irc history logs here
[15:35:28] <acorbi> Sure, good idea. sending an email now
[15:38:19] <acorbi> Also, i wanted to ask for some support. Does anybody know alternatives to the web interface (ckan-admin/trash) to purge deleted datasets. On http://data.opendevelopmentmekong.net there are around 15K datasets and when i call the trash URL the request times out
[15:39:16] <rossjones> acorbi there's a paster command, it may be broken, I can't remember.
[15:39:47] <wardi> sounds like our trash page is broken if it's timing out :-/
[15:39:48] <acorbi> on the docs i only found a paster command for deleting datasets by id (one by one), no bulk delete AFIK
[15:40:06] <rossjones> acorbi http://docs.ckan.org/en/latest/maintaining/paster.html?highlight=purge#dataset-manage-datasets
[15:40:13] <amercader> acorbi: paster dataset purge, but it only works on one dataset
[15:40:25] <acorbi> well it worked in my DEV ENV which had only around 500 datasets
[15:40:31] <joet> it's more likely that nginx times out and the query gets stopped and the transaction rolls back
[15:40:38] <joet> (for the trash page)
[15:40:41] <rossjones> amercader did it used to? Am pretty sure I purged datahub all at once.
[15:40:46] <rossjones> Maybe I didn't.,
[15:40:52] <rossjones> Old age == Bad memory
[15:40:53] <amercader> so you probably want paster dataset list + magic in editor + paster dataset purge
[15:41:02] <amercader> rossjones: I'd be happy to be wrong
[15:41:20] <rossjones> amercader you're never wrong.
[15:41:36] <acorbi> yeah, some bash scripting might do it
[15:41:48] <rossjones> looked it up amercader, you were right.
[15:41:50] <amercader> wardi: the trash page has some hideous logic on the controllers that deals with revisions
[15:41:59] <amercader> I don't dare looking at it
[15:42:09] <acorbi> or you think a postgresql query would be possible?
[15:42:23] <acorbi> something like DELETE where state=='deleted"' or something like that?
[15:42:37] <amercader> acorbi: you'll need to do lots of joins :)
[15:42:44] <acorbi> :-(
[15:43:04] <amercader> acorbi: it's not really nice https://github.com/ckan/ckanext-harvest/blob/master/ckanext/harvest/logic/action/update.py#L118
[15:43:36] <amercader> anyway, need to drop now, I'll try to be back asap
[15:43:48] <acorbi> amercader: thx, ill take a look
[15:50:38] <acorbi> oh, i managed to find a volunteer to write a shell script to purge all datasets marked to delete
[15:50:51] <acorbi> :-)
[15:57:30] <coreybits> What is the recommended version of Solr these days ?
[15:59:34] <nigelb> coreybits: Unofficially, I'd say 4.7.1
[15:59:37] <joet> coreybits, all versions of solr should work fine
[16:00:06] <nigelb> Anything above that I've had a bit of trouble on Ubuntu's Java version.
[16:00:06] <joet> it depends on how you want to set it up, if you follow the docs you should get what ever version is in the ubuntu repos
[16:00:24] <nigelb> I'm sure it'll work, but you'll need to do more work.
[16:00:32] <wardi> meeting?
[16:00:37] <joet> otherwise I use solr 5 for my dev work, there was a lot of work done by the solr guys to get solr 5.0 "easy to use"
[16:01:01] <nigelb> joet: Ooh. I need to ansiblize that one.
[16:01:01] <wardi> https://plus.google.com/hangouts/_/event/cb1vmkss426lkqicj94a3amvd1c?authuser=0&hl=en-GB
[16:04:18] <coreybits> pefect thanks guys, building out our redhat 7 infrastructure now, would like to be as current as I can
[16:06:32] <coreybits> joet: have you noticed anything severe using solr 5 with 2.3 ?
[16:07:34] <joet> coreybits, no, but I've only been using it in development, so take that with a grain of salt
[16:08:00] <coreybits> Of course.
[16:13:25] <travis-ci> ckan/ckan master b09652a http://travis-ci.org/ckan/ckan/builds/55041369 David Read: The build was broken.
[17:27:36] <travis-ci> wardi/ckan 2349-rename-new-tests d62c011 http://travis-ci.org/wardi/ckan/builds/55052691 Ian Ward: The build was broken.

[11:05:02] <badbruce007> hey guys, I got a question. I'm trying to set up ckan-harvester to import datasets from a website to the one I'm working on right now. However, when I check my gather_consumer.log file I keep getting errors saying `Unable to get content from the URL` and the dataset is not retrieved. How do I resolve such an issue?
[14:11:20] * wardi eyes auth_is_anon_user
[14:22:51] <rossjones> fight, fight, fight...
[14:22:58] <rossjones> get it wardi
[14:24:00] <wardi> moving all the test around has caused some new test failures that seem to be related to stale stuff in c (yay)
[14:27:09] <rossjones> c?
[14:38:35] <wardi> our favorite global (thread-local) mutable storage
[14:39:15] <wardi> even flask has one, so that migration won't save us from this particular bad idea
[14:40:38] <rossjones> Oh, *that* c.
[14:40:53] <rossjones> It'll never happen :(
[14:41:27] <wardi> I suspect it's only one letter to not draw attention to itself
[14:42:07] <wardi> I tend to prefer single letter variables for temporary things and for-loops
[14:42:24] <rossjones> yeah, same here.  mostly. until ppl moan at me.
[14:42:48] <rossjones> Why doesn't django need it?
[14:43:13] <wardi> the request is passed in. you can attach stuff there as required
[14:43:21] <rossjones> yeah, I guess that makes sense.
[14:43:57] <rossjones> so ckan has two contexts, the threadlocal global and the content{}
[14:44:21] <rossjones> s/content/context/
[14:44:23] <wardi> there's some other single-letter-global thing too, I thought
[14:44:27] <rossjones> g
[14:44:31] <wardi> yeah, that one
[14:44:42] <rossjones> Never really looked at it too closely
[14:44:54] <nigelb> though, I think flask one isn't thread local
[14:45:18] <wardi> nigelb: the 'request' object is, there must be another one
[14:45:39] <nigelb> I was thinking of g when I said that.
[14:45:58] <wardi> does flask have a 'g'?
[14:46:02] <nigelb> yeah.
[14:46:04] <rossjones> Most use of c is hidden now isn't it?
[14:46:23] <wardi> rossjones: not well enough. it's breaking my stuff
[14:46:54] <nigelb> I want to remove c from the templates if it's not alreday.
[14:47:47] <wardi> nigelb: there's quite a bit of work to do for that, I think
[14:48:13] <nigelb> Yeah, but that's the first step I feel.
[14:48:21] <nigelb> and then we deprecate calling it from templates
[14:48:25] <nigelb> and then stop populating it.
[14:48:31] <wardi> true
[14:48:52] <nigelb> long, long, long way ahead.
[14:48:56] <rossjones> I didn't think it was used as much in templates any more?
[14:49:02] <rossjones> I seem to recall only one or two places.
[14:50:05] <wardi> if we have 3-month releases all those steps could be done by next year :-)
[14:50:42] <nigelb> lots of hits with a simple grep
[14:50:51] <rossjones> wardi 3 month *sounds* nice, but if each one is 3 months late ;) Not sure there are enough people contributing to manage that are there?
[14:51:03] <rossjones> nigelb did you grep 'c.' ?
[14:51:06] <rossjones> nigelb did you grep 'c.\' ?
[14:51:16] <rossjones> oops 'c\.'
[14:51:30] <wardi> rossjones: and a word boundary
[14:51:48] <nigelb> ' c\.' actually.
[14:52:15] <nigelb> some of those look legitimate.
[14:52:15] <rossjones> me too, lots more than I thought there should be.
[14:52:32] <nigelb> the facets stuff is scary
[14:52:37] <rossjones> c.userobj seems to be quite prevalent
[14:52:37] <nigelb> Because it uses c, it's hard to test.
[14:53:05] <nigelb> c.is_myself. wat.
[14:53:41] <wardi> '\bc\.' is a little better, no?
[14:54:10] <nigelb> oh boy, it gets worse :D
[14:55:01] <joet> rossjones, the threadlocal globals and context are the same thing.
[14:55:03] <nigelb> so, one step in there would be to deal with facets in a way that doesn't involve abusing c.
[15:00:10] <joet> wardi does just removing the c stuff in auth_is_anon_user just break?
[15:00:48] <joet> if we just use context['user'] instead?
[15:00:50] <wardi> joet: that's what I'm trying
[15:01:06] <wardi> it seems silly to bother with c if we're passing the context dict
[15:01:31] <joet> yeah, and if it doesn't work it'd be better to see why we aren't setting context['user']
[15:03:38] <wardi> joet: seems to work
[15:05:12] <joet> great, enjoy nuking that code then
[15:07:35] <nigelb> woo
[15:08:12] <wardi> well, tests pass for me at least, for what that's worth
[15:09:00] <nigelb> that means there's only about 100 ways it'll break...
[15:09:13] <joet> it'd be nice to delete it but you could just swap it so it tries the context before c.user and log a deprecation message if c is there
[15:09:23] <joet> *is used
[15:09:32] <joet> (i'd prefer to just delete)
[15:09:57] <wardi> it's probably broken. our controllers do context['user'] = c.user or c.author  everywhere
[15:10:10] <wardi> which I also think it nuts
[15:10:59] <wardi> well, let's talk about it at the meeting
[15:30:33] <amercader> wardi, joet: sorry, but I'll miss the meeting today, hopefully just the first half
[15:31:00] <acorbi> Hi everyone! I would like to share with you a wordpress plugin that i have written for interfacing CKAN and WP. Surprisingly it is called wpckan :-) and you can find infos on  https://wordpress.org/plugins/wpckan/ and https://github.com/OpenDevelopmentMekong/wpckan. Feedback and/or improvements Ideas are welcome

2015-03-18

[04:20:45] <nigelb> wardi: Nice job on datacats!
[12:00:16] <travis-ci> ckan/ckan 2344-igroupform a6541f3 http://travis-ci.org/ckan/ckan/builds/54855558 David Read: The build was broken.
[14:12:50] <wardi> nigelb: thanks. just getting started :-)
[14:46:40] <SkramX> im working on a ckan install someone else did and trying to help them enable datastore
[14:47:04] <SkramX> i followed the plugin instructions and the table metadata table is now there but i'm not seeing a way to upload data in the UI
[14:47:13] <SkramX> is there something else that needs to be configured?
[14:47:53] <SkramX> ah. filestore isnt default?
[17:12:02] <rossjones> Finally managed to get my preview using google-doc previewer on a site I'm playing with.  It's pretty simple too - but not as flexible as recline (obviously).
[17:12:17] <rossjones> http://liverpool.servercode.co.uk/dataset/lcc-payments-of-invoices-to-vendors-over-500-april-2012/resource/a03edab7-ccbb-4af8-89e6-032716e56d0c
[17:13:20] <rossjones> Should I wrap this up as a proper extension do you think? Is it worth it?
[17:14:45] <amercader> rossjones: it looks useful!
[17:20:26] <rossjones> amercader it's pretty much just - https://github.com/rossjones/ckanext-liverpool/blob/master/ckanext/liverpool/templates/gdoc_preview.html
[17:20:56] <rossjones> I'll try and get that wrapped up into something useful this week then.
[18:16:51] <SkramX> how does one increase the upload file size limit?
[18:18:03] <SkramX> ugh, sorry - found the answer
[18:43:00] <travis-ci> wardi/ckan 2349-rename-new-tests 0e731b4 http://travis-ci.org/wardi/ckan/builds/54908517 Ian Ward: The build was broken.
[18:47:43] <travis-ci> wardi/ckan 2349-rename-new-tests a144219 http://travis-ci.org/wardi/ckan/builds/54908529 Ian Ward: The build was broken.
[21:40:33] <badbruce007> hey guys, I got a question. I'm trying to set up ckan-harvester to import datasets from a website to the one I'm working on right now. However, when I check my gather_consumer.log file I keep getting errors saying `Unable to get content from the URL` and the dataset is not retrieved. How do I resolve such an issue?
[22:35:20] <badbruce007> anyone can resolve this? `ERROR [ckanext.harvest.harvesters.base] Unable to get content for URL`

2015-03-17
[12:00:31] <wardi> meeting?
[12:00:47] <wardi> https://plus.google.com/hangouts/_/event/cb1vmkss426lkqicj94a3amvd1c?authuser=0&hl=en-GB
[12:18:56] <rossjones> joets I just unassigned myself from that bug, I'm not likely to be contributing so much in the near future.
[12:19:07] <rossjones> Sorry
[12:19:18] <joets> ha
[15:00:01] <rossjones> wardi denisz congrats on releasing datacats - looks *very* nice.
[15:00:50] <denisz> thanks rossjones!
[15:04:41] <rossjones> denisz if it had https://github.com/ckan/ideas-and-roadmap/issues/113 it would mean you'd never have to touch git directly I guess?
[15:04:58] <rossjones> i.e. you wouldn't have to clone and configure your own extensions.
[15:06:48] <denisz> yes, that would be ideal
[15:07:20] <denisz> right now you can still put a path to git in a requirements.txt somewhere
[15:07:45] <denisz> and since most ckan extensions are valid python packages, they will get installed
[15:07:49] <denisz> but I tend to clone them
[15:08:15] <rossjones> Looking forward to getting some time this evening to give it a try.
[15:09:19] <denisz> awesome, please let wardi or I know how it goes
[15:09:48] <denisz> I've been using it to develop a couple of our production sites, but not many people have used it so far. You might be about user #7 or so
[15:12:45] <amercader> denisz: I get "Error processing request" when trying to register to datacats.com. I get a confirmation email, but clicking the link also gives "Error processing request"
[15:16:16] <denisz> amercader looking into it
[15:17:04] <amercader> denisz: I hope is not because of an "" on my name ;)
[15:17:17] <denisz> I think it is heh!
[15:17:34] <denisz> I will fix that
[15:17:43] <rossjones> Failed when I posted my public key :( Sorry.
[15:19:20] <rossjones> Oh wait, it remembered my key, but gave me an error anyway.
[15:19:37] <denisz> the regex we use for validation there is a bit too strict
[15:21:03] <denisz> also, right now datacats doesn't read your public keys, it uses one in ~/.datacats. rossjones do a `datacats deploy` first and that will give you a public key to use. I'll submit an issue that we should also read your regular public keys
[15:21:40] <rossjones> denisz will do, am getting a bit distracted, I really should wait until this evening :)
[15:21:55] <denisz> yea, get back to work!
[15:22:30] <rossjones> "Compiling!"
[15:25:44] <denisz> heh
[15:26:38] <wardi> amercader: your name shouln't break our mailer code any more
[15:28:13] <amercader> wardi, denisz: thanks, works now
[15:38:05] <joets> amercader, you should change your name :p
[15:39:29] <amercader> joets: https://twitter.com/amercader/status/541887985810427904
[15:39:42] <amercader> I'll make an exception for wardi and denisz for now :)
[15:41:56] <wardi> amercader: we appreciate it
[15:42:17] <denisz> hehe. I want to support unicode domains too, for when china finally buys-in big on open data
[15:43:42] <joets> amercader, hahaha wow.
[16:54:19] <joets> ckan lied to me again
[17:19:22] <joets> any one ever needed easy way to turn off the repoze.who middleware for tests?
[17:19:52] <joets> I don't want it to redirect 401 forbiddens to the login for tests, I want to know that my code correctly 401'd
[18:28:05] <wardi> joets: hmm. pass an extra parameter?  ?redirect=nothanks
[18:29:35] <joets> i just want it disabled for my tests :(
[18:30:05] <wardi> so some kind of magic then? :-|
[18:30:56] <joets> well no, I would prefer a way to disable it in the config
[18:31:28] <joets> ckan.go_away_repoze_who_I_am_busy_running_tests = true
[18:32:24] <wardi> that's reasonable, we have established patterns for setting config settings from tests
[18:41:45] <joets> yeah I was hoping for a way around, because even if I add it now, I won't really be able to use it till 2.4, as I don't want travis to be running off master for my ext
[18:42:26] <joets> I've ended up just indirectly testing it for now which is a bit rubbish

2015-03-16
[13:07:56] <joet> dammit, half our actions raise NotFound without providing a message :(
[13:11:34] <nigelb> \o/
[13:11:43] <nigelb> joet: Good First Bug :D
[13:12:41] <joet> it's not a bug, I was just lazy and hoping to wrap all my code using the actions in a single try...except block and just flashing which every error message about which ever object wasn't found
[13:13:07] <joet> but now, I have to have multiple try blocks just so the right message about the right missing object is missing.
[13:13:39] <nigelb> ew
[13:14:00] <nigelb> joet: that sounds like a bug :\
[13:14:50] <joet> I wouldn't call it a bug, as nothing is broken. It's just more annoying for users of the code/plugin writers
[13:14:56] <joet> so maybe a missing feature :p
[13:15:01] <nigelb> riiiiiight
[13:58:18] <wardi> aw yea
[13:58:46] * wardi merged rename-legacy-tests
[13:59:10] <wardi> next up, rename new_tests
[14:00:25] <wardi> joet: add NotFound subclasses for specific things?
[14:00:55] <rossjones> wardi +1 for renaming all the things!
[14:01:16] <nigelb> next up, delete the old templates
[14:01:21] <nigelb> and get rid of genshi.
[14:01:23] <nigelb> with fire.
[14:01:53] <joet> wardi, that would be even better
[14:02:55] <joet> although then I'd prefer to have them all in ckan.exceptions and not import NotFound as ObjectNotFound in plugins.toolkit
[14:03:37] <joet> althougth we'd probably have to leave ObjectNotFound to not break extensions.
[14:04:11] <wardi> old templates ate already gone, no?
[14:04:27] <nigelb> wait, really?
[14:04:33] * nigelb really needs to follow ckan development
[14:07:41] <wardi> joet: we can export them from plugins.toolkit too DatasetNotFound, OrganizationNotFound etc
[14:08:20] <joet> yeah
[14:08:49] <wardi> "this is the interface where we'll try extra hard not to break things" is a valuable concept
[14:08:55] <nigelb> +1
[14:09:48] <joet> also on a random note, anyone else tried sqltap? it's pretty cool, we're calling model.User.get a few too many times on some pages :p
[14:09:55] <rossjones> I removed the templates, but genshi still included :(
[14:10:10] <joet> tempted to add it to our dev-requirements
[14:10:21] <rossjones> joet what does it do?
[14:10:38] <wardi> joet: doesn't sqlalchemy save us from issuing duplicate queries like that?
[14:10:38] <rossjones> Do the user.get calls actually hit the database, or does sqlalchemy cache the calls?
[14:10:46] <joet> some wsgi middleware that adds localhost/__sqltap__ and tesll you all the hits to the database
[14:11:08] <joet> wardi, no, sqlalchemy will make sure the object is the same, but it'll still run the query
[14:11:38] <rossjones> joet can you make sqltap explode if a query takes longer than 20ms?
[14:11:40] <wardi> oh. I use logging for that, but having queries for a specific request might be useful.
[14:11:56] <wardi> especially if we start tracking them along with the tests over time
[14:12:26] <joet> i find it useful to check the database requests whenever i load a page when doing development
[14:12:38] <wardi> joet: +1
[14:14:26] <joet> if you've used the django_debugtoolbar/ pyramid_debugtoolbar to check whatever quries have been made, it's basically just that on a seperate page
[14:15:02] <joet> gives you a nice stacktrace as well
[14:20:47] <joet> https://github.com/ckan/ckan/compare/master...joetsoi:sqltap_middleware?expand=1
[14:41:16] <brook> joet: that's useful, thanks for pointing it out

2015-03-15

2015-03-14

2015-03-13
[16:10:24] <rossjones> wardi do you use the datastore?
[16:35:20] <wardi> rossjones: yes, but not with datapusher
[16:39:26] <rossjones> wardi and it's stable and doesn't cause problems?
[16:42:29] <rossjones> i.e. I just get 504s from http://data.nhm.ac.uk when I up the limit param too high
[18:05:27] <wardi> rossjones: I also only use it from an instance that's not public and I don't think my users know how to use the api
[18:05:41] <wardi> so I'm not a great example
[18:08:55] <rossjones> ah ok.

2015-03-12
[14:56:47] <mih> In our package-api there exists a key 'url' - why is it null and how it is possible to be set automatically (by ckan)?
[15:06:10] <wardi> mih: what would you like it to be set to?
[15:06:59] <wardi> That's a core field that I assume is there for historical reasons. On one site I work on we use it as the "homepage url" for more information about the dataset
[15:11:30] <mih> in our environment we have been using it as the "homepage url" (e.g. http://<ckan>/dataset/<packageid>) as well since a few years. however, we recoginzed that it is not filled anymore automatically by ckan ;-)
[15:12:12] <mih> so, we will change to another solution
[15:38:07] <wardi> what do you mean by filled automatically?
[16:07:16] <mih> When I added a dataset, the value of the 'url'-key was set by CKAN wardi
[16:07:45] <wardi> what was it set to? do you just mean there was a text field in the form?
[16:16:29] <varunity> wardi:  Thanks for your comments yesterday, my IRC client froze on me so I couldn't reply.
[16:26:36] <mih> it was set to http//<ckan>/dataset/<packageid>
[16:28:28] <mih> does not matter; i already found an better way ;-)
[17:23:03] <rossjones> One day, I'll actually send a pleasant email to the ckan-dev ML.
[17:34:41] <wardi> rossjones: it's good to have goals
[17:40:31] <rossjones> wardi was hoping steering group might steer a bit.
[17:40:54] <rossjones> Maybe I am just getting hung up on the governance unnecessarily.
[17:41:45] <wardi> if it doesn't interfere with development, good. if it does things developers are bad at, even better :-)
[17:42:33] <rossjones> was hoping it might have a, erm, vision or something.
[17:43:15] <wardi> hmm. anything in particular?
[17:50:47] <wardi> the only things I can think of are technical, and are mostly already tickets in the ideas repo
[17:50:55] <rossjones> which of the ideas repo should people be working on (other than things that interest them)? Which will contribute to ckan take up?
[17:51:12] <rossjones> Thinking more of at a features level.
[17:51:41] <wardi> anything that makes views better/easier
[17:51:59] <rossjones> :D
[17:52:08] <wardi> I expect cool visualizations would attract people
[17:53:02] <wardi> better geo stuff too
[17:53:30] <rossjones> Yup, but should ckan be providing tools to make vis easier, should it be providing more QA stuff, should it be more linked-data friendly.
[17:53:31] <rossjones> etc
[17:54:17] <wardi> more integration things "hey look, I click this button in excel and my dataset is updated"
[17:54:26] <rossjones> Yeah, ecosystem stuff.
[17:54:33] <rossjones> That in particular would be v.cool.
[17:54:45] <rossjones> Food time.
[17:54:52] <wardi> I don't think it's hard either
[17:55:36] <wardi> and it would give me cover to work on making the api cleaner and faster (which I find more interesting)
[18:20:34] <rossjones> wardi would love a faster api. and maybe a bit more consistent with paging etc.
[18:21:49] <wardi> I want to implement indexed-based pagination and deprecate offsets
[18:22:02] <rossjones> that'd be nice.
[18:22:51] <wardi> if we have that we could wrap it with something that streamed multiple calls in a single response in front
[18:24:59] <rossjones> got an example in mind?
[18:25:27] <wardi> "give me all the dataset metadata"
[18:26:33] <rossjones> My pain points atm is when I have ops to perform on every, say resource.  Today I had a map of old urls to new urls, and had to call resource_search for the old url, and then resource_update on each one where it was used - couldn't do it in package_update because our 2.2 crashes when a dataset has too many resources.
[18:27:14] <rossjones> It was either that or do it in postgres, and I'd rather not (and I don't have direct access to the DB).
[18:27:47] <rossjones> Guess it's not an easy problem to solve.
[18:29:21] <rossjones> Perhaps I need a resource_find_and_update call.
[18:29:58] <wardi> or have package_update not crash when it has lots of resources
[18:30:30] <rossjones> wardi well yeah, I think 2.3 will fix that.
[18:30:32] <rossjones> probably
[18:31:03] <wardi> if the db migration ever finishes
[18:31:52] <rossjones> :D
[18:32:02] <rossjones> Am about to try it, I guess I'll find out
[18:36:20] <rossjones> template breakage.
[18:41:59] <rossjones> Do we have a list of the new plugins to install for 2.3
[18:42:18] <wardi> just what's in the changelog
[18:48:16] <rossjones> Cool. Feels a lot snappier than 2.3. Will let the ckan guys on the team know they can upgrade :)
[18:48:22] <rossjones> s/2.3/2.2/
[18:50:01] <rossjones> It's beer o'clock. ttfn
[21:50:35] <travis-ci> ckan/ckan 1753-rename-legacy-tests 1118b61 http://travis-ci.org/ckan/ckan/builds/54159912 Ian Ward: The build was broken.

2015-03-11
[08:33:25] <rossjones> badbruce07 any error messaages?
[18:15:01] <SkramX> is there a way to make a user an admin via the UI? I only see instructions for from the command line using paster
[18:17:10] <wardi> SkramX: you can only do it with paster or with the api, AFAIK
[18:19:29] <SkramX> thought so
[20:58:34] <varunity> Hello everyone. I'm trying to connect to ckan using curl according to the docs here: http://docs.ckan.org/en/latest/maintaining/filestore.html#filestore-api but I'm getting a 404 as the reponse
[21:02:12] <varunity> anyone else ever seen this type of behavior? I'm wondering if I am specifying the header information correctly.
[21:29:53] <wardi> varunity: maybe, I see the headers in those examples are different
[21:30:11] <wardi> but if you're not authorized I wouldn't expect a 404
[21:35:48] <badbruce007> hey guys? anyone got filestore set up on their ckan websites?
[21:38:37] <badbruce007> i was checking out the documentation on this link http://docs.ckan.org/en/latest/maintaining/filestore.html
[21:40:49] <badbruce007> but as I got to filestore API, I ran the python code that had import requests as a line of code and at the end of it, Error 404 was returned as the output
[23:02:06] <wardi> badbruce007: does your dataset exist?
[23:02:41] <wardi> try package_show with the same id

2015-03-10
[23:23:44] <badbruce07> Hey guys? I have a question. Is there a datastore extension that I can install from github?
[23:24:44] <badbruce07> I went through the documentation but it doesn't work when I reach Set Permission

[13:48:01] <joet> heh
[13:48:11] <joet> "TypeError: submit_and_follow() takes at least 3 arguments (3 given)"
[13:48:41] <rossjones> nice
[13:48:57] <joet> i provided a keyword argument, but it expected another one
[13:49:01] <joet> error message amused me
[13:52:28] <wardi> I think I ran into the same error calling that same function
[13:53:59] <wardi> which reminds me. time to merge #2221
[13:54:39] <wardi> joet: tell me when you're done writing tests :-)
[13:58:13] <joet> wardi, i'm working on an extension so feel free
[14:03:20] <wardi> want to merge that then rename new_tests (I'll 'from ckan import tests as new_tests' in ckan/__init__.py to avoid breaking things)
[14:04:02] <rossjones> wardi when are you going to merge scheming?
[14:04:37] <wardi> merge scheming? it can live as an extension until there are more users I think
[14:04:46] <rossjones> :(
[14:04:52] <wardi> why :(?
[14:05:06] <rossjones> You'll be unsurprised to hear how much I dislike current schema management
[14:06:07] <wardi> I'm liking the freedom of merging stuff without meetings :-P
[14:06:32] <rossjones> :)
[14:06:50] <joet> yeah, rossjones i'm going to merge you annakarenina test fix
[14:06:59] <joet> i hope no one minds, it seems reasonable enough.
[14:07:04] <wardi> sure
[14:07:39] <rossjones> thanks, pointing at random domains where ownership changes is one the many banes of my life (after a DGU dataset ended up pointing at a casino).
[14:07:56] <joet> ok done.
[14:10:06] <rossjones> thanks
[14:30:11] <markbrough> why do datasets on datahub.io now have to belong to an organisation?
[14:32:11] <wardi> spam, iirc
[14:32:47] <markbrough> ah ok
[14:33:48] <markbrough> presumably if i want to upload a dataset from an organisation not listed i should just create a new organisation then
[14:34:41] <wardi> yes, and that likely needs approval
[14:35:06] <travis-ci> ckan/ckan master 446853f http://travis-ci.org/ckan/ckan/builds/53805212 Joe Tsoi: The build has errored.
[14:35:28] <markbrough> i was trying to upload ugandan budget data and there was no relevant organisation, so i just created a "markbrough" organisation: http://datahub.io/organization/markbrough
[14:36:14] <wardi> huh, ok
[14:41:43] <rino_> Trying to install spatial plugin, when I try to initialize the db or restart server i get: TypeError: __init__() takes exactly 1 argument (2 given)
[14:41:54] <rino_> which originates on File "/usr/lib/ckan/default/src/ckanext-spatial/ckanext/spatial/model/package_extent.py", line 45, in setup
[14:43:00] <rino_> Looks like a table fails to be created. Don't see anything related to this in the tickets on git. Any ideas?
[14:43:14] <joet> rino_, what version of ckan are you using?
[14:43:36] <joet> and if you could pastebin the full traceback that might be helpful
[14:45:49] <rino_> http://pastebin.com/Y36JUycA
[14:46:38] <rino_> using sources -  ckanext-spatial.git@stable & ckan.git@ckan-2.3
[14:48:13] <rino_> installing on ubuntu 14:04 with postgresql-9.3-postgis-2.1
[14:50:36] <joet> hum could be a new issue for 2.3
[14:56:48] <rino_> have also tried the master of the plugin, but don't think I have tried master or unstable for ckan base...so many iterations my notes are a mess.
[14:58:37] <joet> yeah, i'm just seeing if i can recreate it now
[15:01:54] <rino_> thanks joet. ckan-docker is using 14:04, so it seems possible but I am not a docker guru and can't figure out the version combo from the build files
[15:14:59] <joet> rino_, I can't recreate your error, but i'm suprised you didn't run into a few other problems
[15:16:09] <joet> rino could you run a "pip show sqlalchemy" in your virtualenv?
[15:17:49] <rino_> Version 0.9.6
[15:19:00] <joet> ah ok, i got a different error to you but it's likely the same problem
[15:19:03] <rino_> I followed a ticket recommendation to change GeoAlchemy>=0.6 to -e git+https://github.com/chokoswitch/geoalchemy.git#egg=GeoAlchemy
[15:19:28] <rino_> in the pip-requirements file
[15:28:05] <joet> hum, I cannot recreate it, we'll have to see if amercader can when he finds the time.
[15:28:37] <coreybits> rino_: I had to bump geoalchemy to 0.7.1 to get up and running on centos7
[15:29:15] <rino_> thanks again joet.
[15:29:56] <rino_> coreybits: Just update the pip-requirements file for the spatial extension?
[15:31:31] <coreybits> rino_: yes, then --upgrade
[15:32:10] <coreybits> again this was on Centos7, so could be a differnt set of problems I had encountered
[15:32:37] <rino_> well it is worth a try.
[15:49:09] <rino_> coreybits: what version of python are you running on centos7?
[15:50:27] <coreybits> the default install 2.7.5
[15:54:03] <rino_> basically same here, 2.7.6

2015-03-09
[14:45:37] <nigelb> excellent, github.com/okfn/ckan should now redirect to the right place.
[14:46:02] <DragonDave> ooh, how do you do that?
[14:46:18] <nigelb> emailing github support :)
[14:46:24] <DragonDave> ahh
[16:00:19] <rossjones> Anyone fancy writing an extension for http://okfnlabs.org/blog/2015/03/06/goodtables-web-service.html ?
[16:38:08] <wardi> rossjones: it's important to you that the author be fancy? I'm kind of drab, myself
[16:38:49] <nigelb> wardi: Make sure you wear a bowtie while writing it.
[16:38:57] <DragonDave> Bowties are cool.
[16:39:04] <wardi> hehe
[16:39:27] <nigelb> A friend's got a design for Mozilla bowties
[16:39:37] <nigelb> that he sends to people who ask for it :)
[17:03:43] <rossjones> wardi fancy is optional, I should rephrase and replace fancy with 'interested in'
[17:03:54] <rossjones> Is it a local colloquiawotsit?
[17:04:08] <wardi> rossjones: no, I'm just being a dick
[17:04:19] <rossjones> wardi that's my job :")
[17:11:36] <rossjones> wardi did anyone ever decide on whether doing PEP style docs for CKAN was a good idea?
[17:11:52] <rossjones> As a step on from just throwing stuff into the ideas-and-roadmap repo.
[17:13:58] <wardi> brook wrote one: https://github.com/ckan/ideas-and-roadmap/pull/93
[17:14:37] <wardi> would have to ask him if he thinks it helped or not
[17:15:49] <wardi> the pep process might need a benevolant dictator to make work well, otherwise they can just get pulled in every direction
[17:16:29] <rossjones> We should try and get a steering group together :)
[17:17:33] <wardi> I think our best strategy is to get thing developed as extensions first, then get adoption, then talk about pulling into core. for things that can be written as extensions, at least
[17:18:24] <rossjones> wardi and how about taking things out? For instance, should someone want to replace the datastore with a different implementation?
[17:19:44] <wardi> good question. you'd like some discussion and buy-in before working on a pr
[17:19:53] <rossjones> Pretty much.
[17:20:03] <rossjones> Maybe issues are the way to go.
[17:20:27] <rossjones> Nothing stopping someone just writing a spec and seeing if it works, will check with brook.
[17:20:33] <wardi> how do we swap out the datastore when sql is exposed?
[17:20:42] <rossjones> *stop* exposing SQL :)
[17:21:12] <wardi> so you want to be able to extend and override the datastore actions
[17:21:12] <rossjones> 99% of use will be select, for which it's exposing internals of the DB :( Perhaps better to take just the fields and the where clause?
[17:21:46] <rossjones> Actually I want to stop imports coming through CKAN entirely, so something *like* datapusher, but not datapusher, can just push direct to the DB.
[17:21:55] <rossjones> datastore should be just about reading from the db.
[17:21:58] <wardi> join and specific filters and aggregates are pretty sweet, when you need it
[17:22:21] <rossjones> Sure, would need to work out a sensible solution for that.
[17:22:21] <wardi> not that I use that feature myself at the moment
[17:22:39] <rossjones> We're using it on our health service stuff atm, and it's a bit, erm, hit and miss.
[17:23:58] <wardi> I think it would be cool to let users customize how datastore accepts data and makes queries
[17:24:24] <wardi> the sql is already an optional thing, you wouldn't have to provide that on another implementation
[17:25:01] <wardi> if you like elastic search or redis or some column-store thing it would be cool to be able to use it
[17:25:12] <joet> +1 rossjones :p
[17:27:06] <rossjones> I'd kinda like to be able to layer pretty rest endpoints on the top as well, so for bus timetables I can do /api/bus/X22 and it'll select * from 22222223334455566 where route='x22';
[17:27:18] <rossjones> obviously, a lot of curating involved in that.
[17:28:14] <wardi> rossjones: maybe a datastore_type field on resources that chooses the right plugin?
[17:28:29] <joet> but you I think you're both right, perhaps what we need is some more intermediate glue
[17:28:47] <rossjones> that might do it, might also let those who are that way inclined put their RDF into a triplestore.
[17:29:04] <rossjones> joet sort of like a data router, I think datastore_type might work.
[17:29:13] <joet> the datastore could just be exposing sql/alchemy to extension writers with useful tidbits that makes it easy for an extension writer to write api/bus/X22 style apis
[17:29:45] <rossjones> joet every extension I've seen just imports ckan.model anyway :)
[17:30:26] <rossjones> Vaguely related, did you see https://github.com/cphsolutionslab/ckanext-dataproxy
[17:30:27] <rossjones> ?
[17:31:01] <joet> yeah i mean the datastore can take care of initial importing/provides easy ways for exts to create tables / database views and some default blueprint api endpoints that extensions customize
[17:32:01] <joet> then again, there are some pure javascript things that then excludes
[17:32:04] <rossjones> That might work, minus importing via the CKAN API and writing to the database out of process :")
[17:32:41] <rossjones> Is "sending insert statements to datastore" something that people actually use?
[17:33:34] <joet> rossjones, the reason I said extension writers is because you can vaguely trust them
[17:33:45] <rossjones> Most of them.
[17:34:22] <rossjones> joet I haven't written any for a while, so maybe your statement holds true.
[17:35:51] <rossjones> joet wardi I gotta run, but will try and make the meeting tomorrow, as I sort of want to agitate until we can come up with a skeleton agenda for 2.4 :)
[17:36:07] <joet> rossjones, most people aren't about tomorrow
[17:36:20] <rossjones> joet Ah, ok, next week then.
[17:36:57] <rossjones> Will see if I can get any sort of steerage from steering group in the meantime.  ttfn.
[19:44:11] <adkpete> Are their any guides/tips for getting the spatial extension to work on Ubuntu 14.04 with postgresql-9.3-postgis-2.1?

2015-03-08

2015-03-07

2015-03-06
[05:38:01] <ageara> amercader Thnks for stocking the Cheese Shop

2015-03-05
[16:01:27] <wardi> meeting?
[16:01:54] <wardi> https://plus.google.com/hangouts/_/event/cb1vmkss426lkqicj94a3amvd1c?authuser=0&hl=en-GB
[16:02:05] <amercader> yeah, why not?
[16:02:32] <joet> yeah
[16:23:20] <brook> wardi Sorry - I am here!
[16:35:23] <amercader> ageara: https://pypi.python.org/pypi/ckan/2.3

2015-03-04
[13:13:28] <amercader> good lord, read the docs chose the best day possible to break
[13:13:38] <amercader> I can't build the docs for 2.3 :(
[13:19:56] <joet> :(
[13:20:32] <kalxas> amercader, is today the release day?
[13:24:18] <amercader> kalxas: yes, it's basically all done, just trying to sort the docs before announcing
[13:24:59] <kalxas> cool
[13:36:54] <wardi> \o/
[13:37:15] <wardi> and :( for readthedocs
[13:40:21] <travis-ci> ckan/ckan master 805d5a7 http://travis-ci.org/ckan/ckan/builds/53039448 amercader: The build was broken.
[13:42:34] <wardi> for other projects i build to a gh-pages repo. no version switching but it's nice and simple
[13:46:16] <amercader> yyyyyyyyyyyyyyyyyyyyyeeeesssssssss, found the bug in rtd
[13:46:48] <amercader> and deleted the old offending branch (and a couple hundred more at the same time)
[13:47:05] <rossjones> amercader and my wip :(
[13:47:49] <amercader> rossjones: ups, really sorry about that. I thought I had only deleted old branches from trac
[13:50:08] <rossjones> amercader don't worry, not a biggie. I;ll undelete when I get time to finish it :)
[13:50:23] <rossjones> Ooh release email! Nice Job amercader !
[13:50:40] * rossjones can't remember how to get the bot to give props
[13:51:24] <wardi> woooo
[13:51:30] <amercader> pffiu, honestly everything went downhill since yesterday evening: datapusher/ckanserviceprovider versions mess. new packaging server, read the docs breaking...
[13:51:39] <rossjones> :(
[13:51:46] <rossjones> You should make someone else do it next time :)
[13:51:46] <wardi> amercader: nicely done
[13:51:52] <amercader> thank god is over, I think I'll take it easy the rest of the day...
[13:52:04] <amercader> until the breaking reports start coming!
[13:52:09] <amercader> cheers guys
[13:52:15] <rossjones> Yeah, prepare for the deluge...
[13:54:28] <wardi> bug reports are how oss devs know they have users
[14:04:51] <rossjones> Who is going to be the first to deploy it live? Any takers?
[14:06:25] <Zharktas> i probably try to persuade our client that we should upgrade but it might take a few weeks to actually deploy
[14:10:14] <joet> amercader, just go down to the pub now :p
[14:13:13] <wardi> given some of the bug reports we've seen some people have been running master in production
[14:13:31] <wardi> nice to have those people :-)
[14:14:13] <joet> double edged sword :p
[14:16:05] <joet> should have a flow diagram "are you running master branch?" -> "in production?" -> "don't do that"
[14:16:57] <wardi> add a banner to the template :-)
[14:17:24] <wardi> but no, it's nice to have those bug reports early
[14:17:28] <joet> yeah
[14:17:47] <rossjones> I start to upgrade datahub.io from master, but the storage thing is problematic.
[14:19:44] <wardi> storage thing?
[14:23:28] <rossjones> wardi it's all on google storage atm
[14:27:04] <wardi> oh
[14:33:13] <rossjones> wardi it'd be nice it CKAN had options (like it used to) to upload straight to S3/some-cloud-storage. Maybe for 2.3
[14:33:14] <rossjones> 4
[14:47:14] <wardi> rossjones: for sure. iirc the old code was too specific to one provider and not possible to extend
[14:49:00] <rossjones> wardi I think it was just too complicated :)
[14:51:53] <wardi> can't remote upload be all done with js in the resource form?
[14:54:12] <rossjones> wardi I guess so.
[14:54:23] * rossjones doesn't like JS
[14:57:20] <joet> wtf. my test is breaking, but if i set a breakpoint and the continue it passes with no problems. non-determinism ftw
[14:59:27] <almereyda> rossjones : now i do
[14:59:46] <rossjones> almereyda :) Here's where all the cool kids hang out :)
[15:00:19] <rossjones> almereyda so you're going to use ckan as part of http://blog.14mmm.org/transformap-explained/ ?
[15:00:47] <almereyda> rossjones : let's talk after my food session or anytime soon. seeya!
[15:01:03] <rossjones> :D

2015-03-03
[09:38:30] <travis-ci> ckan/ckan release-v2.3 3bf1d0a http://travis-ci.org/ckan/ckan/builds/52767958 amercader: The build was broken.
[11:27:57] <amercader> nigelb: I vaguely remember you showed me once a website that showed travis runs but much faster?
[11:32:55] <joet> good lord, ckan did something that made my life easier for once.
[11:33:05] <joet> feels good
[11:33:34] <rossjones> joet lies!
[11:34:27] <joet> I wanted a search form and the search_form.html snippet is actually reusable and does what you want
[11:35:04] <joet> it should of on a list of things extension writers might like to use.
[12:02:30] <wardi> amercader: circleci? drone.io?
[12:03:12] <joet> dev meeting?
[12:03:17] <wardi> https://plus.google.com/hangouts/_/event/cb1vmkss426lkqicj94a3amvd1c?authuser=0&hl=en-GB
[12:03:22] <amercader> wardi: it was actually a different frontend for travis, not a different platform
[12:04:41] <wardi> should we switch to some pr/issue urls that include datapusher?
[12:05:57] <joet> if we know what that link is
[12:06:22] <wardi> maybe it's in some old meeting notes
[12:21:16] <nigelb> amercader: travis-lite.com
[12:21:31] <nigelb> amercader: the same URLs work, it just doesn't do things client side.
[12:26:02] <DragonDave> that looks very broken to me
[12:26:30] <DragonDave> https is 9 months out of date, just gives a default heroku app message
[12:26:43] <nigelb> damn.
[12:27:40] <nigelb> indeed, looks like it's dead.
[13:02:57] <nigelb> amercader: did you guys talk about the library upgrade last week?
[13:03:02] <nigelb> Or did you skip it.
[13:03:12] <wardi> re nigelb's item is there any reason we shouldn't upgrade our js?
[13:03:46] <nigelb> I have a feeling things will break.
[13:03:56] <wardi> that's a good reason :-)
[13:04:10] <wardi> can always open a pr and see what does break
[13:04:17] <nigelb> That's why I wanted to start early
[13:04:22] <nigelb> and find things that break.
[13:06:06] <amercader> nigelb: I think we should update. The things more likely to break are recline, etc but i'm not sure if these use their own jquery
[13:06:15] <joet> nigelb, best time to upgrade
[13:06:22] <joet> most time until next release
[13:06:27] <amercader> now is a good time to upgrade
[13:06:30] <amercader> yes
[13:07:02] <amercader> actually we should do all big renames now like the new_* ones
[13:07:08] <nigelb> okay, I'll get cracking then.
[13:07:27] <nigelb> It's nice to be in a dev meeting after a while :)
[13:07:54] <amercader> nigelb: come more often!
[13:08:43] <nigelb> I'll come on every other tuesday!
[13:10:45] <wardi> sounds good :-)
[13:15:10] <joet> although it'd be nice to be able to back out of the changes
[13:34:53] <amercader> resource views , responsive design, regenerate api keys...
[13:35:17] <amercader> what major features/ changes do you think should be highlighted on the changelog?
[13:41:33] <wardi> better support for custom dataset types, lighter api with more fields made optional
[13:41:51] <amercader> nice
[13:43:52] <wardi> actual package ids in resources now
[19:20:55] <travis-ci> ckan/ckan release-v2.3 0f7e7f1 http://travis-ci.org/ckan/ckan/builds/52935480 amercader: The build was broken.
[23:10:04] <travis-ci> ckan/ckan release-v2.2.2 e27d378 http://travis-ci.org/ckan/ckan/builds/52971398 amercader: The build has errored.

2015-03-02
[18:11:30] <joet> god dammit, the delete_all() in tests doesn't reset postgres sequences. We'd need a 'truncate blah reset identity'
[18:29:31] <rossjones> If only we'd know about docs.google.com/gview?url= earlier - might have not had to rely on jsonpdataproxy :(
[18:36:16] <joet> anyone thought of writing a template helper to render an atom/rss2 feed?
[18:37:11] <joet> so people can have easy 'integration' with their <insert blog>
[18:37:14] <wardi> joet: why a template helper?
[18:37:31] <joet> wardi, doesn't have to be a template helper
[18:38:03] <joet> but just something that grrabs the feed and dump it in a template/front page whatever
[18:38:24] <wardi> are we not using a jinja template for rss feeds now? or do you mean we're missing some types of feeds?
[18:38:53] <rossjones> joet there used to be something back in the dark days that would add menu items etc from rss/wordpress feeds.
[18:38:55] <wardi> oh, a thing that returns a feed as a list
[18:38:59] <joet> yeah
[18:39:15] <rossjones> https://github.com/okfn/ckanext-wordpresser
[18:39:41] <rossjones> Although not so much for adding things to the first page, presumably you mean like blog post synopsis etc?
[18:39:42] <wardi> joet: can we add an action for the feed instead?
[18:40:32] <wardi> then we can call it, other sites can call it all the same
[18:42:11] <joet> rossjones, yeah blog post synopsis is pretty much it
[18:42:57] <joet> wardi, I don't see why not
[18:42:57] <rossjones> Loads of people seem to want embedded twitter streams and other stuff like that.  Maybe ckanext-widgets?
[18:43:24] <wardi> rossjones: that's a good idea
[18:43:29] <joet> yeah that is good
[18:43:40] <rossjones> I knew I'd have one this year at some point :)
[18:44:20] <wardi> I want datasets showing up on pintrest
[18:44:43] <rossjones> Like twitter cards .... dataset cards ... rgrp was after those a year or two ago :")
[18:45:27] <rossjones> Sort of like the thing at https://dev.twitter.com/cards/overview
[18:45:49] <rossjones> Maybe that can go in ckanext-widgets too? At /dataset/name/card? or something
[18:48:26] <joet> there you go rossjones https://github.com/ckan/ideas-and-roadmap/issues/134
[18:48:50] <rossjones> Hah, great, I'll get the blame now if it all goes wrong!

2015-03-01

2015-02-28

2015-02-27
[12:42:13] <nigelb> someday, I want to get ckan's API explorer to this level https://developers.google.com/drive/v2/reference/permissions/get
[12:42:28] <nigelb> language selecter and you can enter the parameters right there.
[13:05:15] <rossjones> nigelb like http://swagger.io ?
[13:07:09] <nigelb> rossjones: yep

2015-02-26
[09:06:21] <rossjones> nigelb have you visited github today? interesting new banner
[09:11:28] <nigelb> rossjones: I have, I'm going to try to see if that can be fixed.
[09:11:42] <rossjones> nigelb thanks, it's bugging me on every screen :)
[09:13:10] <nigelb> rossjones: Me too. And I've started work for a while.
[09:13:19] <rossjones> :D
[13:29:26] <mih> When I need to change values before a resource is saved ("before_update") - which plugin/interface do I need to implement? - according to "my" interfaces.py the IResourceController does not contain a method called "before_udpate" (CKAN 2.2.1)
[13:35:30] <rossjones> mih IDomainObjectModification with judicious use of isinstance(entity, model.Resource)  and check operation == model.domain_object.DomainObjectOperation.new or .changed
[13:38:17] <Zharktas> before_update for resource controller has been implemented in 2.3 apparently
[13:42:26] <mih> thank you rossjones
[14:38:19] <wardi> or an idatasetform plugin
[15:44:31] <joet> anyone ever thought of using the schema/validation outside of action functions?
[15:47:01] <amercader> joet: should work fine no? as long as you pass a dict and a schema with the expected format
[15:49:48] <wardi> joet: I've thought of a decorator that applies a navl schema for validating parameters before the function is called
[15:50:30] <joets> wardi, yeah I added that to a few of the action functions a while back
[15:50:48] <wardi> joets: oh you did? cool
[15:51:02] <joets> https://github.com/ckan/ckan/blob/master/ckan/logic/__init__.py#L496
[15:51:11] <joets> i only used it for action functions at the time though
[15:52:28] <joets> but yeah i'm taking some request parameters and using them in a controller  and then later passing them into some action function
[15:53:16] <joets> but it makes some sense to try and reuse the validation stuff we have instead of having a bunch of code that makes sure that something is an integer in my controller
[15:53:55] <wardi> yes, then we might also improve some of the existing validation (like say, having docstrings)
[16:06:53] <joets> http://bit.ly/ckandevmeeting ?
[16:07:17] <amercader> yeah, I have loads of urgent 2.3 prs :)
[16:07:50] <joets> wardi, broook?
[16:08:26] <amercader> brook is not around today
[16:10:00] <ageara> last dev meeting notes Jan 27 ? https://github.com/ckan/ckan/wiki/Dev-Meeting-Notes
[16:10:19] <amercader> ageara: we need to move the new ones from here https://pad.okfn.org/p/ckan-meeting
[16:10:27] <amercader> thanks for flagging it
[16:13:41] <joets> wardi, ?
[16:14:26] <joets> https://cwiki.apache.org/confluence/display/solr/Major+Changes+from+Solr+4+to+Solr+5
[16:29:28] <amercader> wardi: friendly reminder about https://github.com/ckan/ckan/pull/2307/files
[16:34:46] <wardi> dang. missed the meeting again
[16:36:12] <wardi> I'll try setting a reminder on my phone
[16:37:28] <wardi> amercader, joets: I'm up for the meeting now if you want
[16:44:58] <wardi> ok, next tuesday it is
[16:45:06] <amercader> wardi: we did a quick one, we left your issues to discuss for tuesday
[16:48:23] <wardi> oh, great. thought you didn't get to the prs and real issues
[16:48:33] <wardi> mine can certainly wait

2015-02-25
[16:18:39] <nigelb> you listen to the signal that ckan will raise.
[16:19:20] <rossjones> nigelb it's very similar to https://docs.djangoproject.com/en/1.7/topics/signals/
[16:20:12] <wardi> webhooks is nice because it would let users write that stuff in any language, but preventing their use as an attack vector is a little tricky
[16:20:34] <nigelb> oh yeah, that's a better example.
[16:20:49] <nigelb> blinker is what flask uses because of it's strong anti-NIH leanings :)
[16:20:50] <rossjones> I think something very similar to rehook would be ideal for that wardi
[16:20:53] <wardi> those are in the same process that's handling the request
[16:21:11] <rossjones> https://github.com/jstemmer/rehook
[16:21:27] <wardi> (leading to "why in the heck are my pages loading so slow??")
[16:22:05] <rossjones> yeah, doing as little as possible in process for plugins is a good thing.
[16:22:59] <wardi> rossjones: that looks nice
[16:23:44] <rossjones> and install is pretty straightforward.
[16:27:22] <wardi> if we were running our web stuff behind tornado then async stuff would be a matter of "just use tornado's thing from your extension"
[16:28:36] <wardi> instead of setting up and monitoring yet another service. but that way leads to more code duplication and NIH
[16:28:45] * wardi is conflicted
[16:37:40] <rossjones> wardi yeah, it's hard to tell, I think if installation is reasonably straight forward (single command), and doesn't involve large amounts of configuration.... I suspect it's too late in most cases, backwards compatability is a killer.
[17:26:37] <wardi> rossjones: you're right

[03:53:22] <nigelb> bah
[03:53:37] <nigelb> sorry guys, I had a doctor's appointment and I was in call most morning :(
[11:19:55] <nigelb> rossjones: You about?
[11:20:23] <nigelb> Can you give me some context to get an idea of maxious' pull request?
[11:20:48] <rossjones> nigelb yes.
[11:21:16] <rossjones> It used to create a thread pool every time a controller was created, now it creates a threadpool in the plugin.
[11:21:48] <rossjones> it creates X threads that sit there waiting for things to do, every time you make an API request it will send a short message to one of the threads which will deliver it to Google.
[11:23:05] <rossjones> Need to check things like - threads actually only created once, putting stuff onto the queue timeouts immediately if it can't put the message on the queue (in case it's full), thread death handled to queue doesn't fill up with jobs that never get processed, threads remember to remove the job from the queue when done.
[11:23:07] <rossjones> Etc.
[11:23:23] <nigelb> aha, thanks.
[11:23:45] <nigelb> Will it be enought to test it under dev server? would recommend a test with apache as well?
[11:24:07] <rossjones> Yes and yes.
[11:24:37] <rossjones> I wonder if it would be better for all this type of thing to be done with denisz webhook extension.  Python's pretty naff at concurrency.
[11:25:30] <nigelb> indeed.
[11:25:32] <rossjones> https://github.com/ckan/ideas-and-roadmap/issues/122 and https://github.com/deniszgonjanin/ckanext-webhooks
[11:30:23] <nigelb> that needs more time and more patience than I have right now.
[11:30:26] <nigelb> Probably for the weekend.
[11:38:49] <nigelb> rossjones: alternatively, CKAN can emit signals for before and after action API call.
[11:38:58] <nigelb> Something like what blinker lets you do
[11:39:01] <nigelb> (pythonhosted.org/blinker/)
[11:39:08] <nigelb> It's what flask has
[11:41:14] <rossjones> nigelb sure, that's what django does too.  Except in Django's case, it's still inline with the request.
[11:42:35] <rossjones> I think django tends to use celery and workers to trigger async/background tasks.  My main worry with that approach is that you end up with a hard-to-install/configure system.
[11:47:49] <nigelb> blinker is more painless.
[11:48:07] <nigelb> I think having people being able to subscribe to things like this is good for the extension ecosystem
[11:48:24] <nigelb> the question is whether we need just the data from an API call or need to modify it.
[11:50:13] <rossjones> nigelb I don't think blinker solves problems where it needs to make a http request, or send mail, or something else that might take an indeterminable amount of time and block the actual request.
[11:53:54] <nigelb> rossjones: ah, these signals are not async.
[11:54:00] <nigelb> (I hadn't realized that)
[11:54:09] <nigelb> No, it doesn't solve that problem.
[11:56:24] <nigelb> rossjones: I still don't understand the overhead of a celery queue. Perhaps I need to use it myself to understand.
[11:58:03] <rossjones> nigelb really it just puts data into a queue (or redis) for you, and arranges for a worker process (external to the sending process) to pick it up and do some work.
[11:58:39] <nigelb> that sounds better in my head than dabbling with threads in python.
[12:01:11] <rossjones> nigelb indeed.
[12:01:17] <rossjones> it's how some other stuff already works.
[13:00:08] <mattfullerton> Hi Folks, I was just wondering if there is a CKAN/Pylons archetiecture picture anywhere. Google has not helped me.
[13:47:08] <wardi> nigelb: +1
[13:51:00] <nigelb> wardi: to which bit? :)
[14:06:15] <wardi> the not hacking a worker pool in threads in a wsgi applicatiob
[14:10:15] <nigelb> Excellent, just confirming.
[14:10:30] <nigelb> I wasn't sure if you went all the way back to my blinker conversation.
[16:17:40] <wardi> nigelb: I haven't heard of blinker
[16:18:06] <nigelb> wardi: It's a signaling library.
[16:18:11] <nigelb> Basically, my thought process was
[16:18:21] <nigelb> If you just want to do something when a particular API is fired
[16:18:26] <nigelb> or after it's called
[16:18:32] <nigelb> you don't need to override the API.

2015-02-24
[10:15:36] <travis-ci> ckan/ckan release-v2.3 c3b067a http://travis-ci.org/ckan/ckan/builds/51953981 amercader: The build was broken.
[12:01:31] <wardi> https://plus.google.com/hangouts/_/event/cb1vmkss426lkqicj94a3amvd1c?authuser=0&hl=en-GB
[12:01:37] <mattfullerton> Hi CKAN, is there a dev meeting now, and are you totally preoccupied with 2.3 release or is there time for anything else? I might be able to do some work on views/previews but wanted to talk it over first. Rufus suggested this was the right venue.
[12:02:19] <amercader> mattfullerton: come join us
[12:03:33] <amercader> nigelb, joet, brook ^
[12:04:05] <amercader> mattfullerton: pad with agenda, add your stuff if you want : https://pad.okfn.org/p/ckan-meeting
[12:35:35] <amercader> wardi: yes,please
[12:40:17] <joet> nigelb, we're moving onto general questions if you're available
[12:48:01] <travis-ci> ckan/ckan master 17f7fde http://travis-ci.org/ckan/ckan/builds/51968311 amercader: The build was broken.
[12:53:45] <mattfullerton> I also haven't figured out how to do without getaction yet
[15:11:06] <wardi> mattfullerton: Forgot to mention on the call, modifying resource extras from an IDatasetForm does let you store/retrieve actual json if that's something you want
[15:11:28] <mattfullerton> perfect
[15:12:28] <wardi> in scheming I think I store only strings so that my behaviour is consistent between package and resource extras
[15:12:52] <wardi> but this is just how it's stored in the db not how it's presented at the api
[17:51:11] <coreybits> wardi: could you point me in the direction where I might modify the dataset_slug for -scheming
[18:41:26] <wardi> coreybits: that's the dataset_type field

2015-02-23
[13:04:59] <seluan> Hi there! I'm dealing with an issue on a ckan 2.0 instance running on a ubuntu desktop  (Ubuntu 12.04.3 LTS ). We have a problem downloading some of the files. I could not identify the source. The site returns the following error "Internal server error". I looked through the logs in Apache error log and found this Error - <class 'pairtree.storage_exceptions.FileNotFoundException'.
[13:05:08] <seluan> The first thought was that the files are missing or maybe a matter of file rights but I checked and the files are in place and have identical rights as the files that can be downloaded.  I tried to find a link between non-functional files by the date they were added but the error occurs randomly.  Full loghttps://redmine.seluan.ro/attachments/download/6/ckan%20apache%20error%20log.txt  Any help would be much appreciated. thank you in ad
[13:22:51] <nigelb> wardi: Do you know how realiable the frontend tests are?
[13:23:10] <nigelb> I've been thinking of doing an upgrade to latest jquery and other libs on master at some point before 2.4.
[13:24:45] <joet> nigelb, since we've branched it's probably the best time to suggest it. Things'll break but we have the most time till next release to find breakages, perhaps put it in the next meeting notes?
[13:27:23] <nigelb> joet: will do.
[13:47:29] <joet> anyone know of the top of their heads whether you can customise the emails sent out by ckan?
[13:48:25] <rossjones> joet that sounds like an awesome new feature if not :)
[13:49:02] <rossjones> there's https://github.com/ckan/ckan/blob/master/ckan/templates/activity_streams/activity_stream_email_notifications.text for notifications
[13:50:36] <joet> alas, I don't think it'll help my cause
[13:51:40] <rossjones> maybe another one for the ideas-and-roadmap list?
[13:51:45] <rossjones> I'll add it.
[13:52:35] <joet> some password reset emails are being rejected by google, it's hard to determine the cause
[13:53:45] <rossjones> joet is the sending mail server set up correctly?
[13:56:10] <joet> rossjones, yup, changed the helo address/mail_from address etc
[13:56:37] <rossjones> spf records?
[13:56:52] <joet> this server is on cloud hosting though, so i'm taking a punt and guessing that people have used the cloud hosting to relay spam before
[13:57:22] <joet> rossjones, i'm not in control of the spf records alas, and i think i'll have to tell them to get them setup
[13:57:35] <rossjones> joet possibly, but more likely high link to text ratio and no spf, dkim
[13:58:13] <joet> i've tried telnetting myself a test email but it hates that as well
[13:58:16] <joet> with not link
[13:59:37] <rossjones> joet PM me the domain if it isn't sensitive
[14:03:28] <joet> rossjones, i'm just going to ask them whether they have some mail relays that I can send the messages through instead of sending them direct from the server, that should fix things.
[14:04:14] <rossjones> joet can try out http://www.kitterman.com/spf/validate.html
[14:05:11] <joet> cheers, the answer is no, but seeing as they'll have to jump through local government to get it setup I'm going to guess they won't like it.
[14:05:37] <joet> either way there's not much I can do
[14:05:38] <rossjones> my commiserations.
[14:06:48] <joet> rossjones, i'll report back in this time in 5 years when they've set up the spf record.
[14:07:29] <rossjones> joet optimistic. I like it.
[14:07:50] <rossjones> it'd be quicker to just set up mailgun.
[14:38:40] <wardi> nigelb: I haven't worked on any front end tests that use js
[14:41:27] <wardi> yeah, getting email delivered is a terrible problem. +1 to mailgun or sendgrid or some other paid service
[15:22:10] <nigelb> wardi: I've raised an item for tomorrow
[15:22:21] <nigelb> since we branched off 2.3, now would be a good time to land it so we can fix breakages.
[15:22:58] <nigelb> Mostly, I'm trying to solve extension authors' pain of having to bundle the libs we already have because we have way too old versions.
[15:31:47] <wardi> nigelb: cool, will we see you tomorrow?
[15:32:27] <nigelb> yep!
[16:13:33] <wardi> nice!

2015-02-22

2015-02-21
[00:39:38] <ageara> Can anyone advise on the data that 2.3 is likely to make it to the Cheese Shop?
[00:40:03] <ageara> that should be date :P old habits die hard
[00:40:32] <ageara> https://pypi.python.org/pypi/ only seems to have the 2.2 patch release

2015-02-20
[17:50:22] <Zharktas> thanks wardi_ for the interview thing :p
[18:43:24] <wardi_> Zharktas: my pleasure. Good to speak to everyone

2015-02-19
[15:33:37] <joet> as solr isn't running at that point
[15:34:05] <joet> maybe if i throw a --reset-db in there it'll clean itup
[15:34:29] <wardi_> mih: ok, so if you upload a file with the api the last_modified date isn't updated?
[15:34:50] <wardi_> it looks like there's some js that updates that field on the front end
[15:36:36] <amercader> mih, wardi_ : https://github.com/ckan/ckan/issues/1874#issuecomment-61622046
[15:36:53] <mih> wardi_: no, the file was uploaded through the web
[16:02:37] <wardi_> https://plus.google.com/hangouts/_/event/cb1vmkss426lkqicj94a3amvd1c?authuser=0&hl=en-GB
[16:03:41] <joet> just getting a drink 1 sec

[00:28:35] <wardi_> joet: gsoc project: port ckan action api to flask :-)
[00:30:49] <joet> hahaha, wardi_ yeah  i think they can get that done in less than a month
[00:31:41] <joet> wardi_, i was going to mention it in the dev meeting, but if you can think of anything suitable, the 3 i chose, I thought are managable and have a bit of meat to them.
[00:34:50] <joet> If I was going to suggest move to flask, it would "get the default about page on ckan served by flask,  and the rest served by pylons without the user noticing"
[05:44:12] <nigelb> hrm.
[05:44:30] <nigelb> why does the default config say text_view and recline_view instead of *preview*
[09:47:29] <nigelb> amercader: quick check, the plugins are called text_preview and recline_preview, right?
[09:48:00] <amercader> nigelb: in ckan<2.3 yes, on ckan>=2.3 they are called text_view and pdf_view
[09:48:22] <nigelb> ahhh
[09:48:25] <nigelb> cheers.
[09:52:04] <davidmiller> Is there a currently open issue for "The Data[store|pusher] guesses types wrong quite a lot, which results in the data API returning nonsense" ?
[09:52:29] <davidmiller> I can find lots of tangenitally related issues but not sure if I'm entering the wrong search incantations :(
[09:53:10] <nigelb> davidmiller: check on datapusher
[09:53:14] <nigelb> it's probably filed there.
[09:54:22] <davidmiller> https://github.com/ckan/datapusher/issues/48
[09:54:27] <davidmiller> nigelb: Ta !
[09:54:35] <davidmiller> Right repo helps a lot :)
[09:54:42] <nigelb> :)
[09:55:05] <amercader> davidmiller, nigelb : type guessing it's actually done by messytables
[09:55:26] <amercader> but we maybe can tweak the conf from datapusher
[09:56:43] <nigelb> Indeed.
[09:56:49] <nigelb> It's either a messytables bug
[09:56:54] <nigelb> Or a bug in how we use it.
[09:56:58] <davidmiller> amercader: Rite - in the first instance I was thinking to just expose an option to "Be less clever"
[09:57:41] <amercader> ckanext.datapusher.dumb_factor = 3
[10:14:31] <davidmiller> If I want to override a couple variables in a plugin...
[10:14:44] <davidmiller> e.g. TYPE_MAPPING & TYPES from https://github.com/ckan/datapusher/blob/master/datapusher/jobs.py
[10:14:51] <davidmiller> Obviously I can monkeypatch it.
[10:15:07] <davidmiller> Is there a more elegant CKAN-ish way to expose those as user definable?
[10:16:18] <nigelb> expose it as a config?
[10:18:06] <amercader> davidmiller: the "ckan way" would be to provide  a config option for simple stuff (a string or a number) but for dicts and classes an extension point to modify these from your own instance probably makes more sense
[10:18:32] <amercader> eg IDatapusher.get_types() or whathever, which will use the current as default
[10:25:48] <davidmiller> amercader: Does that mean it has to be coupled to CKAN core despite being a setting for a plugin?
[10:26:05] <davidmiller> /me feels like he's missing something
[10:26:17] <davidmiller> Like "How to use IRC commands".
[10:33:51] <nigelb> davidmiller: what do you mean by coupled to core?
[10:34:46] <nigelb> It's already coupled to core as it's bundled with core.
[10:35:59] <amercader> davidmiller: sorry, you are right this is datapusher I though it was part of core
[10:37:30] <amercader> then I guess the best way is to support some sort of datapusher configuration (via ini, json, yml or whatever works best)
[10:38:02] <amercader> I can't recall it right now but I think you already can set up some config for datapusher? (db location and stuff)
[11:22:53] <rossjones> davidmiller you could totally re-implement the non-documented datapusher interface to work how you'd like :)
[11:24:09] <rossjones> it's only really one file
[11:47:56] <davidmiller> So it turns out that the datapusher has a python config file at /usr/lib/ckan/datapusher/src/datapusher/deployment/datapusher_settings.py - which is news to me :)
[11:48:14] <davidmiller> Maybe that's what amercader is talking about.
[11:48:48] <rossjones> wardi_ am sure you had a comment on it, can you remember where the ticket was about allowing API calls with cookie for auth.
[11:53:35] <otfrom> morning!
[12:48:51] <rossjones> otfrom have been pointed to https://github.com/ckan/ckan-security/issues/5 by dread.
[12:49:00] <rossjones> Ah, it's private. That's no good.
[12:49:23] <otfrom> (/  )/
[12:49:39] <rossjones> And not very useful :*( amercader  should be be having *all* security discussions in private?  This one in particular seems fairly harmless.
[12:50:16] <otfrom> does it have the justification for removing accessing the api via the cookie there?
[12:50:21] <otfrom> s/via/with
[12:51:39] <rossjones> otfrom yes, it's wrt crsf. I don't think it'll be doing anything to stop you making ckan api calls in the browser in the near future.
[12:52:05] <otfrom> cool
[12:52:15] <otfrom> is there anyway to add me to the group on that repo?
[12:52:42] <otfrom> or do I have to sign something in blood first and promise to convert by 1st born child to open data? ;-)
[12:52:50] <rossjones> I think one of the OKF services team may need to do that.
[12:52:56] <rossjones> Not sure I have perms.
[12:53:03] <rossjones> And I'm knee deep in something else atm.
[12:53:18] <rossjones> otfrom Can't see why not though. You're trustworthy enough. Mostly.
[12:53:41] <otfrom> ooh, definitely not trustworthy. But very huggy
[12:53:53] <otfrom> I suppose someone will have to make a judgement call.
[12:53:56] <otfrom> (>'o')>  <('o'<)
[12:53:58] <rossjones> I'll vouch for that.
[12:56:03] * rossjones is afk
[12:56:19] <otfrom> thx rossjones
[14:23:43] <wardi_> joet: let's make both suggestions then we can meet in the middle and be all done!
[14:24:59] <joet> I love it when a plan comes together... and that plan is hope the magical coder fairies fix things for us.
[14:25:10] <wardi_> davidmiller: +1 on a "be less clever" option for datapusher
[14:26:11] <wardi_> It should be two steps: 1. load all the data as text/list/json into a column in the datastore, 2. attempt clever things to load data into other columns
[14:27:05] <wardi_> joet: it's nonbelievers like you keeping the coder faries away
[14:28:52] <joet> we should accept everyone will push crap to the datastore, so we should use the postgres jsonb type so we can just push json to it instead (and subsequently still have to deal with the problem later) and screw guessing columns
[14:29:37] <davidmiller> wardi_: So, what works for me is https://github.com/ckan/datapusher/pull/65
[14:29:48] <wardi_> joet: if we have the original data in a column we can guess a column wrong bug stillbe able to fix it later (in postgres where it's fast)
[14:30:01] <davidmiller> e.g. I can define my own set of messytables types for the datapusher to use, override weightings, etc
[14:30:55] <davidmiller> That means you get be less clever, but also be more clever if you want :)
[14:31:09] <wardi_> davidmiller: hmm. wouldn't you want to configure types for each file?
[14:32:52] <davidmiller> wardi_: Me personally, no :)
[14:33:06] <wardi_> :-)
[15:29:49] <mih> when we update a resource-file, the last_modified-field is not updated (ckan 2.2.1). is that a known issue?
[15:30:20] <wardi_> mih: I think the last modified refers to the metadata
[15:31:27] <mih> wardi_: the documentation says: "last_modified: the date when this resources data was last modified (NB: not the date when the metadata was modified)."
[15:31:28] <joet> brook, weird question, how did you solve your travis issues in the end?
[15:32:13] <mih> found an issue on github: https://github.com/ckan/ckan/issues/1874
[15:32:30] <brook> joet: added --ckan to the nosetest command
[15:32:54] <brook> joet: in travis-run.sh
[15:33:02] <joet> ah cheers
[15:33:29] <joet> probably not my issue then, still I'm pretty sure the paster db init line fails in each one of our tests in travis-build.bash

2015-02-18
[12:57:29] <joet> I was going to leave mentioning google summer of code till tomorrows meeting but another friend told me that the deadline for organisations to apply is the 20th. Just something to think about if we want ckan on there
[12:58:22] <wardi_> joet: I think it's a great idea
[16:42:51] <amercader_> wardi_: congrats on the USODI contracts, exciting stuff
[16:45:52] <rossjones> Oh cool, how many did you get wardi_ ?
[16:47:26] <rossjones> ah found it - https://usopendata.org/2015/02/18/ckan-multisite/
[16:47:34] <amercader_> all of them!
[16:50:09] <DragonDave> Ooh, that sounds shiny! :)
[17:16:38] <wardi_> amercader: thanks!
[17:18:02] <wardi_> hoping to have something on the data export front real soon

2015-02-17
[07:39:28] <red_vex_> Hi all. Im looking for some guidance on how to change the links and URL slugs of Datasets, Organizations etc to something else. Where and what files should I be looking to edit. Is it an easy or difficult task?
[11:45:54] <rossjones> anyone ever had problems with filestore writing 0 byte files?
[11:55:57] <amercader_> rossjones: no, sorry
[11:56:13] <rossjones> amercader s'okay, I think I found it in our ckanapi wrapper.
[11:56:20] <rossjones> perhaps.
[12:03:22] <amercader_> hey, we should do a meeting
[12:03:38] <wardi_> yes
[12:04:16] <amercader_> https://plus.google.com/hangouts/_/event/cb1vmkss426lkqicj94a3amvd1c?authuser=0&hl=en-GB
[12:05:14] <amercader_> rossjones: you still busy? ^
[12:05:39] <rossjones> amercader_ don't think I'll be doing the calls any more I'm afraid.
[12:05:49] <wardi_> boo
[12:06:03] <joet> was it something we said? come back!
[12:06:23] <rossjones> not being pad for ckan work atm (or for last few weeks) - awfully mercenary I know :)
[12:06:28] <rossjones> s/pad/paid/
[12:06:37] <wardi_> rossjones: I can dig it
[12:06:44] <rossjones> :D
[12:47:05] <amercader_> thanks guys, the new call format with party and drinks and stuff was awesome, shame rossjones could not join the fun
[12:47:16] <rossjones> :P
[12:47:44] <wardi_> the live music was a nice touch
[13:27:03] <rossjones> wardi_ not getting assigned tickets and PRs was a nicer touch :)
[14:06:11] <nigelb> rossjones: biggest trick the devil ever pulled ;)
[14:06:23] <rossjones> nigelb :D
[14:09:48] <rossjones> nigelb I am writing scrapers atm. Very relaxing
[14:11:55] <nigelb> rossjones: you changed jobs?
[14:12:01] <rossjones> sorta.
[15:50:08] <jlehtone> wardi_: About our Finnish CKAN meetup on this Friday 17:00UMT. We could chat with you with Adobe Connect Pro. It will be at https://connect.funet.fi/kata/. There we can share screens also if needed. We could test this beforehand. razz0 can test this with you eg. tomorrow.
[16:01:11] <wardi_> never tried adobe connect, would be worth trying in advance
[16:05:18] <coasterz> wardi_: how complete would you say ckanext-scheming is ?
[16:07:19] <wardi_> coasterz: it works well if you have some custom templating wrapping it
[16:11:46] <coasterz> wardi_: yes, I have it in test right now. I like it so far, and am hoping to use it on the AB site.
[16:13:59] <coasterz> Anything major I should be aware of, aside from templating ?
[16:31:03] <wardi_> coasterz: not that I'm aware of
[17:53:29] <coasterz> wardi_: thanks
[18:07:58] <amln> ckan browser-based search doesn't support regexp, does it?
[18:08:15] <amln> or am i being an idiot?
[18:09:06] <wardi_> amln: certainly not full regexp, but there is some solr advanced text stuff.. let's see if I can find that page
[18:11:23] <amln> wardi_: i've seen http://wiki.apache.org/solr/DisMaxQParserPlugin via the API guide.
[18:11:55] <amln> I'm after datasets starting with [Zz]
[18:12:15] <amln> (and thence working backwards)
[18:12:28] <amln> "datasets from Air to ... Xrays"
[18:12:34] <amln> (via breastfeeding data)

2015-02-16
[17:01:29] <coasterz> wardi_: is ckanext-scheming in active use on open.canada ?
[17:09:11] <wardi_> coasterz: not yet
[17:09:37] <wardi_> when it is our datasets will be so much nicer from the api
[17:10:54] <coasterz> Im just getting familiar with it now, I feel it will allow me a much cleaner approach to handling different types of datasets.
[17:12:28] <wardi_> coasterz: we'll start having different types too. still need to write a unified search of some sort though (ckan currently provides a different search for each dataset type)
[17:13:39] <amercader_> wardi_: not sure if you are aware of this one http://docs.ckan.org/en/latest/maintaining/configuration.html#ckan-search-show-all-types
[17:14:34] <wardi_> amercader_: now I am, thanks. I'm thinking the facets are going to be the challenge. I
[17:15:02] <wardi_> I'd like to make it clear somehow that selecting one of the types will give the user more facets
[17:33:36] <coasterz> wardi_: its most likely deeper in the templates than I have gone yet, but can I have camel-photos in the breadcrumb, and other in page links when viing /camel-photos/
[17:37:14] <wardi_> coasterz:yes, that's not done yet. also many places in ckan link to /dataset regardless of the dataset type, causing problems
[17:43:06] <coasterz> wardi_: I see how it is a challenge, is it on the roadmap as of now ?
[17:43:25] <wardi_> well, I'm interested in it, at least :-)
[17:43:54] <wardi_> as much as possible I'll make my solution reusable
[17:43:58] <coasterz> That is close enough for me ;)
[18:03:59] <acorbi> Hi Everyone, i am having issues while instantiating an instance of ckanapi.LocalCKAN  , please see following pastebin http://pastebin.com/XgJaMHuv . Anything i am missing in order to be able to use LocalCKAN?
[18:04:42] <acorbi> The error log shows that the get_site_username() method is throwing the error
[18:05:29] <acorbi> maybe i need to configure something in particular in development.ini? Any property i should pay particular attention at?
[18:12:25] <wardi_> acorbi: LocalCKAN only works from ckan extensions
[18:13:01] <wardi_> and things like paster commands
[18:13:02] <acorbi> ok got it. That's the case. it is missing the context, right?
[18:14:01] <acorbi> i basically wrote python scripts which use currently RemoteCKAN to import data
[18:14:06] <wardi_> ckanapi's cli uses a paster command to init ckan to use the LocalCKAN class
[18:14:30] <wardi_> you could look at how that code works
[18:15:28] <acorbi> sounds good. i will give it a though. Thanks!
[18:17:04] <wardi_> acorbi: looks like it uses ckan.lib.cli.CkanCommand to do the set up https://github.com/ckan/ckanapi/blob/master/ckanapi/cli/paster.py
[18:24:00] <wardi_> acorbi: if you find a simpler way, please submit a pr to ckanapi :-)
[18:24:33] <acorbi> wardi_: Sure I'll do
[18:25:09] <wardi_> it would be nice if LocalCKAN "just worked" but I think you would have to pass the path to the ini file at a minimum

2015-02-15

2015-02-14

2015-02-13
[08:55:05] <nigelb> FYI, I've just reverted https://github.com/ckan/ckanext-googleanalytics/issues/6 for causing huge issues with Apache and mod_wsgi.
[09:06:39] <rossjones> nigelb great.
[09:08:13] <nigelb> I don't know how to make it better, sadly :(
[09:08:26] <nigelb> rossjones: can't it just use a celery queue instead of launching it's own threads?
[09:11:24] <rossjones> nigelb it *could*, and I'm not a big fan of python threads - but it's possibly just a bug where threads are not dying when they should (which is why I don't like threads ;) ).  It'd be a busy queue though.
[09:13:02] <nigelb> heh
[09:13:11] <nigelb> we hit 4000 threads every day.
[09:13:18] <rossjones> I think, I might be mis-remembering, that it was setting up a pool of threads to handle requests as they came in. If that's true then the threads probably aren't being released into the pool.
[09:13:19] <nigelb> I was going craazy debugging mod_wsgi
[09:13:42] <nigelb> On that note, Graham is awesome and willing to help so much.
[09:15:43] <rossjones> Graham?
[09:17:33] <nigelb> rossjones: mod_wsgi maintainer
[09:20:10] <rossjones> Ah right.
[09:23:24] <rossjones> nigelb I think the problem is here - https://github.com/ckan/ckanext-googleanalytics/commit/f4fce4760194be9434a7fd3d547eb2e2aceab82f#diff-43f893a81f5c731419c98705a226b371L63 - creating a threadpool each time a controller is created.
[09:24:14] <rossjones> probably my fault for suggesting a threadpool instead of just creating a thread when needed :(
[09:24:17] <nigelb> that ends up creating one for every request.
[09:24:19] <nigelb> :(
[12:39:51] <rossjones> DragonDave did you do any work on 'Humanitarian Data Exchange' ?
[12:54:27] <DragonDave> I was doing data ingest for it
[12:54:36] <DragonDave> And Aidan is heavily involved
[13:04:53] <DragonDave> rossjones: any particular reason? :)
[13:54:30] <seanh> Ugh, setting up the harvester
[13:54:55] <seanh> search/index.py crashes with "not JSON serializable" when trying to serialize a package dict
[13:59:53] <rossjones> DragonDave someone just trying to find someone involved with it earlier.
[14:01:43] <DragonDave> ah
[14:02:03] <rossjones> and i had thought you were involved, just wasn't sure how.
[14:20:12] <travis-ci> ckan/ckan 2204-resource-views-cli 7cb05d0 http://travis-ci.org/ckan/ckan/builds/50633042 amercader: The build was broken.
[14:37:17] <shellac> is there a way to log sql statements in ckan?
[14:37:41] <shellac> I know sqlalchemy can do it, but I can't see how to pass that option through
[14:45:34] * shellac hacks it in a little
[15:04:55] <triplecheesesina> hello
[15:04:57] <triplecheesesina> anyone about?
[15:05:15] <triplecheesesina> can someone help me understand how ckan storage works? is it just on the local filesystem?
[15:05:36] <triplecheesesina> i looked at this https://slack-redir.com/link?url=https%3A%2F%2Fgithub.com%2Fckan%2Fckan%2Fblob%2Fmaster%2Fckan%2Fcontrollers%2Fstorage.py&v=3
[15:05:41] <triplecheesesina> ugh.
[15:05:53] <triplecheesesina> sorry. this. https://github.com/ckan/ckan/blob/master/ckan/controllers/storage.py
[15:28:45] <amercader> triplecheesesina: this controller is legacy code, I recommend you have a look at the docs http://docs.ckan.org/en/latest/maintaining/filestore.html
[15:28:57] <amercader> and yes, for now is local filesystem only
[15:29:22] <amercader> rossjones: I'll take thi of your hands if you don't mind https://github.com/ckan/ckan/issues/2234
[16:43:20] <rossjones> amercader sure, no problem.

2015-02-12
[19:00:54] <coasterz> wardi_: Thanks, not actively seeking. lots of ground to cover in next few months.
[20:14:29] <juliaelman> hello #ckan! who is a good person to connect with as a project lead for the Humanitarian Data Exchange Project?
[21:16:48] <seanh> wardi_: rossjones Although I still love Java, I'm gonna be doing http://hypothes.is/ with Nick and Aron (so more like JavaScript :(
[21:20:40] <seanh> juliaelman: afaik the hdx people don't hang out on #ckan. Is there any info about who they are on the site itself? Great project that one
[21:21:24] <juliaelman> @seanh ah, ok! there is no information that i can find on the website specifically about who to connect with.
[21:21:52] <juliaelman> I am helping run a hackathon and thought this would be a great project to feature!
[21:22:28] <juliaelman> Would just like to talk to whomever helps coordinate the project, setups issues, releases, etc.
[21:25:04] <seanh> Yeah I can't find it, sorry. http://www.unocha.org/ is the organisation they work for
[21:26:32] <seanh> Aha, this is them: https://github.com/OCHA-DAP
[21:29:57] <wardi_> seanh: that's cool
[21:50:34] <juliaelman> @seanh yar. that is what i could find too. thanks for your help!!!
[21:50:55] <juliaelman> ugh. sorry for the @ sign... been suing Slack way too much lately. :\
[22:41:29] <coasterz> Ok, after some messing about I was able to get postgis working properly. I can now use ckanext-spatial on centos7 and presumably rhel7

[04:35:28] <Guest29890> hi
[06:41:20] <Guest29890> hello
[06:41:33] <Guest29890> i have setup CKAN as production
[06:41:46] <Guest29890> and i setup email notification for CKAN
[06:41:53] <Guest29890> follow: echo '{}' | paster --plugin=ckan post -c /etc/ckan/production.ini /api/action/send_email_notifications > /dev/null
[06:42:24] <Guest29890> and when i run this command above on command line
[06:42:38] <Guest29890> i got result: No handlers could be found for logger "ckanext.datastore.plugin"
[06:43:34] <Tin> hi
[06:43:49] <Tin> i have setup CKAN such as production server
[06:44:14] <Guest5599> and i setup email notify for CKAN follow: echo '{}' | paster --plugin=ckan post -c /etc/ckan/production.ini /api/action/send_email_notifications > /dev/null
[06:44:45] <Guest5599> but i didn't receive email when i try to reset password for user on ckan
[06:45:26] <Guest5599> and when i run command above on server, i got error: No handlers could be found for logger "ckanext.datastore.plugin"
[06:45:42] <Guest5599> could you guys help me ?
[11:38:16] <travis-ci> ckan/ckan test-cli-autodoc 92460e1 http://travis-ci.org/ckan/ckan/builds/50472632 amercader: The build was broken.
[11:52:57] <amercader> does anyone know where or how is decided that when you do abort(401) on a controller you get redirected to the login page?
[12:03:27] <seanh> This tutorial is a bit out of date now: http://docs.ckan.org/en/latest/extensions/adding-custom-fields.html
[12:03:33] <seanh> The templates seem to have changed a lot
[12:03:44] <seanh> Why we need tests for examples used in docs
[12:03:54] <nigelb> amercader: try trac.
[13:10:13] <rgrp> hey folks - has datastore api changed on demo.ckan.org?
[13:10:24] <rgrp> only ask as http://dev.rufuspollock.org/ckan-explorer/?endpoint=http://datahub.io works but http://dev.rufuspollock.org/ckan-explorer/?endpoint=http://demo.ckan.org does not
[13:11:53] <rgrp> and if you look at JS console you can action api giving a 500
[13:12:23] <seanh> This is great: https://gist.github.com/bobbygrace/9e961e8982f42eb91b80
[13:16:25] <amercader> rgrp: the api has no changed, it looks like internal server errors on that instance
[13:16:34] <amercader> something regarding the db: SSL connection has been closed unexpectedly
[14:07:40] <shellac> what's the best way to remove the contents of a ckan instance -- remove all datasets, resources and relations?
[14:08:29] <shellac> we have a dev instance that needs a clear out
[14:42:45] <wardi_> shellac: drop the db?
[14:45:05] <shellac> wardi_: won't I lose users etc?
[14:45:19] * shellac not actually sure what's in there
[14:46:15] <shellac> (and orgs, groups)
[14:53:39] <wardi_> shellac: usethe cli dataset purge command then
[14:56:52] <shellac> wardi_: probably safest.
[14:57:01] <shellac> thanks
[15:03:40] <shellac> gah, bitten by https://github.com/ckan/ckan/issues/2186 again
[15:41:19] <travis-ci> ckan/ckan release-v2.3 9735e42 http://travis-ci.org/ckan/ckan/builds/50494151 Tom Mortimer-Jones: The build was broken.
[15:52:55] <amercader2> I might be a few minutes late for the meeting, sorry
[16:03:26] <seanh> http://bit.ly/ckandevmeeting
[16:04:37] <amercader> wardi_, joet : ^
[16:05:23] <coasterz> Morning all, anyone have success running ckanext-spatial on centos/rhel 7 ?
[16:05:39] <amercader> https://pad.okfn.org/p/ckan-meeting
[16:12:08] <mih> coasterz: we are running it on centos 6
[16:14:19] <coasterz> mih: I just got bumped from 6 to 7, for coming up launch.
[16:14:59] <wardi_> amercader: i missed it i guess
[16:15:05] <coasterz> Anything in the setup that you recall stand out as different. eg postgis/psql ?
[16:15:20] <amercader> wardi_: nothing important at all
[16:15:50] <amercader> wardi_: I assigned this to you as seanh can't take care of it
[16:15:52] <amercader> https://github.com/ckan/ckan/pull/2182
[16:16:01] <amercader> just needs to be checked for status I guess
[16:17:13] <seanh> wardi_ and other non-OK people who may not know: I've resigned from Open Knowledge and will be finishing at the end of this week basically (was going to announce this in a dev meeting but I didn't manage to make it to one that you were at)
[16:17:37] <seanh> My new job isn't CKAN so I'll be leaving the CKAN world at least for now it looks like
[16:17:44] <amercader> boo
[16:18:37] <joet> hiss
[16:18:41] <amercader> surely you can still spend some evenings refactoring cli or replacing vdm?
[16:21:19] <coasterz> seanh: sorry to hear.
[16:21:51] <coasterz> I was just pondering this morning, what comes after this ckan portal im on now.
[16:59:55] <wardi_> seanh: :-(
[17:02:52] <wardi_> coasterz: if you want more ckan work I know some people looking
[17:13:57] <rossjones> seanh NOOOOoooooooo........
[17:14:11] <rossjones> You need to unquit now.
[17:21:47] <rossjones> More seriously, good luck seanh, hope it goes really well.
[17:22:46] <wardi_> seanh: what sort of work will you be doing?
[17:23:12] <rossjones> Java!

2015-02-11
[17:20:11] <coasterz> Anyone running ckanext-spatial on centos/rhel 7 yet ?

2015-02-10
[12:02:05] <wardi_> meeting?
[12:02:13] <amercader_> yeah
[12:02:17] <wardi_> https://plus.google.com/hangouts/_/event/cb1vmkss426lkqicj94a3amvd1c?authuser=0&hl=en-GB
[12:03:23] <amercader_> joet: ^
[12:04:21] <amercader_> rossjones: ^
[12:10:36] <rossjones> :( No tickets/prs please amercader_
[14:18:52] <stwange> anyone know offhand which package (if any) provides vdm.sqlalchemy for python? I've tried python-sqlalchemy but it's not that one
[14:18:58] <stwange> on Debian Wheezy
[14:21:35] <stwange> sorted with pip, thanks anyway
[14:23:23] <travis-ci> ckan/ckan release-v2.0.6 2389401 http://travis-ci.org/ckan/ckan/builds/50203819 amercader: The build was broken.
[15:21:24] <stwange> paster db init -c /etc/ckan/default/development.ini gives me sqlalchemy.exc.ProgrammingError: (ProgrammingError) column user.password does not exist have I missed a step?
[15:24:26] <stwange> looks like the user table exists but only has id, name, apikey, created and about
[15:24:47] <joet> stwange, did you get halfway thorugh a db init before?
[15:25:16] <stwange> possibly joet, I didn't have everything I needed from pip, not sure how far it got. I'll drop the database and try again?
[15:25:25] <joet> stwange, pretty much
[15:25:53] <joet> db clean, might not be enough you might have to dropdb/createdb
[15:27:13] <stwange> beautiful :D thanks joet
[15:27:29] <joet> yeah it's annoying, should fix that really :/
[15:28:44] <stwange> also, just as a quick aside, I *think* the .deb I installed created a symlink from /usr/share/solr/webapp/ to /var/lib/jetty/webapps/solr/ but it should have been from /usr/share/solr/web/
[15:30:44] <amercader> stwange: the package install does not create any jetty/solr symlinks (link to the schema.xml file needs to be created manually) so I'd say this was part of the solr-jetty install
[15:30:54] <joet> yeah this sounds familiar
[15:31:25] <joet> https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=683854
[15:31:44] <joet> can't remember the status of it, but that really should of been fixed by now.
[15:31:44] <stwange> ah ok :) thanks

2015-02-09
[15:09:54] <rossjones> amln just noticed capgemini got the new publicdata.eu - how did that happen?
[15:20:41] <amln> PanEU project?
[15:21:31] <amln> On one bid, there were only two bidders -- CapGem and Deliotte (or was it PwC)?
[15:22:05] <amln> mega project, that needed that sort of org to manage it.
[15:25:42] <rossjones> Well, they'll be good at managing :) Will be interesting to see what they use to deliver it.
[15:30:15] <knud> I have problems porting a CKAN 1.8 db to a fresh 2.2 install. Out of ~800 datasets, only 73 show up in the 2.2 install. Does anyone have experience with this stuff?
[15:31:34] <rossjones> knud have you re-indexed after updating the solr schema?
[15:33:22] <knud> rossjones: I have used paster db dump / load. At the end of the load process, it updates indeces - if that's what you mean.
[15:34:09] <rossjones> knud your /dataset page is populated from solr, so if you're only seeing 73 items, that's what solr thinks there is.
[15:35:13] <rossjones> did you db dump, db upgrade, db load?
[15:36:32] <rossjones> Never having used dump/load, I dunno.  When I do upgrades I just back up the db with pgdump and then run paster db upgrade
[15:37:44] <knud> rossjones: ah. So you do pgdump on the old site, then db upgrade on the new site?
[15:38:10] <knud> I'm a little confused about what db upgrade actually does. Does it upgrade the dump before you load it?
[15:38:12] <rossjones> Normally in place.  pgdump so I can get back to where I was if something goes horribly wrong.
[15:38:32] <rossjones> the upgrade runs migrations to add new tables, rows etc, and remove unused ones.
[15:39:17] <rossjones> db upgrade works on the database itself, not your dumped copy
[15:45:15] <knud> Ok. But then in my case it would only make sense to upgrade the db after I have loaded the dump, correct?
[15:46:14] <knud> Actually, I think db load already does this:
[15:46:17] <knud> Loaded CKAN database: /home/ubuntu/datenregister-20150209.psql
[15:46:17] <knud> Upgrading DB
[15:46:17] <knud> Rebuilding search index
[15:46:17] <knud> 2015-02-09 16:35:48,992 INFO  [ckan.lib.search] Rebuilding search index...
[15:46:17] <knud> 2015-02-09 16:35:49,003 INFO  [ckan.lib.search] Rebuilding the whole index...
[15:46:18] <knud> 2015-02-09 16:38:40,422 INFO  [ckan.lib.search] Finished rebuilding search index.
[15:46:18] <knud> Done
[15:47:07] <rossjones> oh. i didn't think it did that.
[15:48:36] <rossjones> psql ckan_default -c "select * from migrate_version"; # will show you the current version of the database.
[15:49:38] <rossjones> knud I'd suggest checking out what solr's doing.
[15:50:09] <knud> thanks. It's 59 on the old CKAN, and 71 on the new.
[15:50:32] <knud> "paster db version" also gives you the version, by the way
[15:50:56] <rossjones> knud I'll actually reads the docs one day
[15:53:31] <knud> rossjones Heh. Anyway, so I'll have to figure out what changed between v59 and v71 to see why most of the datasets weren't imported correctly.
[15:54:33] <rossjones> knud probably around https://github.com/ckan/ckan/blob/master/ckan/lib/search/index.py#L105 unless you have your own extension doing stuff as well.
[15:58:03] <knud> thanks, I'll try to figure it out from there. Might write to the list as well to see if someone else has had this problem.
[16:04:05] <knud> rossjones: looking at the 'package' table in the DB, the missing datasets are actually there. At least I know that.
[16:04:39] <rossjones> do they all have a value of 'active' in the state column?
[16:04:52] <rossjones> just to rule out one option :)
[16:05:53] <knud> most of them do, at least more than the 73 that show up in CKAN
[16:07:06] <rossjones> if you manually reindex, how many does it tell you it has indexed?
[16:09:03] <knud> stupid question: how do I actually do that?
[16:09:15] <rossjones> paster search-index rebuild
[16:10:24] <rossjones> you can also give the short-name of a single dataset, if you want to test what happens when you try and index one of your missing ones.
[16:13:15] <knud> paster search-index rebuild does the indexing, but does not tell me how many were indexed.
[16:13:39] <knud> "paster search-index check" says "Packages not indexed = 0 out of 774"
[16:13:45] <rossjones> oh.
[16:13:47] <rossjones> weird.
[16:13:57] <rossjones> are you running varnish?
[16:14:09] <rossjones> no, now I'm stretching.
[16:14:18] <wardi_> did your groups become organizations with private datasets?
[16:16:36] <wardi_> (wild guesses here, 1.8 predates my involvement)
[16:17:12] <knud> I don't think so. /organization says there are 0 organizations.
[16:18:14] <knud> Interestingly, I can see the missing datasets when I go directly to them via /dataset/ - they just don't show up in the overview page. And search does not find them.
[16:18:36] <knud> Anyhow, you've already been a great help, thanks! Got to go now...
[16:19:08] <wardi_> knud: can you do "ckanapi action package_show id=<some dataset id>" and paste the result somewhere?
[16:19:24] <wardi_> where some dataset id is one of the ones that don't appear
[16:22:58] <knud> wardi_ how do I do the api call? Is there an interface for that other than http?
[16:23:57] <wardi_> you can use ckanapi with that command^ or browse to http://site/api/action/package_show?id=...
[16:32:07] <knud> ok, thanks. I pasted the result of a missing dataset here: http://pastebin.com/qGAZkPHg
[16:36:35] <knud> I need to do run, will be back in about 30 minutes.
[16:40:09] <wardi_> "type": "datensatz",
[16:45:16] <joet> wait
[16:45:19] <joet> this sounds familiar
[16:46:53] <rossjones> has it translated the type field? :)
[16:47:02] <joet> knud, wardi_ has pretty much hit the nail on the head, I remember running into issues with your datasets when I harvested them into publicdata.eu
[16:48:47] <wardi_> so in 1.8 all the dataset types were shown in a single search?
[16:50:48] <joet> I wasn't about for 1.8 either, but I just came across the  "type": "datensatz" and  have some faint memory to change the type to dataset when harvesting.
[16:50:53] <rossjones> wardi_ yes, as i recall. the dataset types were new
[17:13:08] <wardi_> knud: 'type' is a special field in ckan 2.x, you will probably find the rest of your datasets under /datensatz instead of /dataset
[20:19:24] <knud> wardi_ thanks for the type hint, that could actually be at the bottom of it

2015-02-08

2015-02-07

2015-02-06

2015-02-05
[08:51:07] <acorbi> Zharktas: Hi! Just wanted to let you know that your fix seems to work perfect ( https://github.com/ckan/ckan/pull/2023/files + https://github.com/ckan/ckan/pull/1895/files ) Thanks man! This is a life-saver
[11:20:17] <amercader> wardi_, seanh, brook, rossjones: I'm sorry but I won't be able to make it to the dev call later today
[11:20:29] <amercader> happy to take some PRs as punishment :)
[11:24:04] <rossjones> Nor, but happy for amercader to take some PRs as punishment too
[11:24:32] <amercader> haha
[12:47:55] <WingTH> hi all
[12:48:45] <WingTH> I having problem using ckan with uwsgi. I suspect that  first load will consume whole CPU to do something until it finished then the page will show
[12:49:10] <WingTH> at first CKAN installation it take less than minute and after we put the data into ckan it increaseing the time that need for first load and now it's taking too long like ~10 minutes
[13:05:58] <wardi_> WingTH: first load?
[13:12:54] <WingTH> first load mean first access after restart ckan service
[13:14:46] <WingTH> You  can leave answer here. @acorbi will follow my question
[13:14:52] <WingTH> gotta go
[14:02:46] <wardi_> acorbi: are you loading your datasets with a normal user account or with the site user? For 2.2 I strongly recomment using the site user to avoid activity stream performance problems
[14:06:07] <acorbi> wardi_: hi! when you mean loading you mean  package_create? What do you mean by Site user vs normal user account? I used sysadmin api key for package_create in my scripts
[14:10:01] <wardi_> acorbi: re WingTH's performance question. The site user is a user with a name matching the site_id. It's the default user ckanapi uses when run locally. actions done with that user don't add activities and there is a bad performance problem with activities in 2.2
[14:10:50] <wardi_> so use the site user's api key, or load them locally with ckanapi instead
[14:13:00] <acorbi> oh, i see https://github.com/ckan/ckanapi/#localckan
[14:13:12] <wardi_> yeah, or with the command line
[14:13:54] <acorbi> i have written some python scripts for those imports, they are shipped and installed along https://github.com/OpenDevelopmentMekong/ckanext-odm_utils
[14:14:57] <acorbi> is LocalCKAN a recent addition to ckanapi? i do not remember reading about it... or maybe id overseen it
[15:54:49] <joet> anyone ever had 'global_conf' keyerrors when running tests using the FunctionalTestBase?
[15:58:28] <joet> eugh it's because I was specifying -c test.ini instead of --with-pylons
[16:00:39] <wardi_> anyone up for a dev meeting?
[16:01:38] <wardi_> or should we skip this one?
[16:02:05] <wardi_> joet, seanh, brook ^
[16:02:54] <seanh> Sorry, I don't have time. Doing prep for a CKAN training that I need to travel to on Sunday
[16:03:03] <joet> i'm about for this one
[16:03:29] <brook> I think we're leaving it
[16:03:41] <wardi_> brook: so you're a no?
[16:04:26] <brook> I'm here, but dread has now gone
[16:05:06] <wardi_> ok, three's probably fine
[16:05:22] <wardi_> https://plus.google.com/hangouts/_/event/cb1vmkss426lkqicj94a3amvd1c?authuser=0&hl=en-GB
[16:25:04] <travis-ci> joetsoi/ckan 1847-pylons-clean-middleware b4c9676 http://travis-ci.org/joetsoi/ckan/builds/49620903 joetsoi: The build has errored.
[16:34:45] <jlehtone> wardi_: That would be great. I'll be in contact with you. Thank you.

2015-02-04
[10:06:35] <acorbi> wardi_: i might need a little more details on where to tweak ckan2.2.1 to reduce the loading time on organization pages with many datasets
[10:06:51] <acorbi> wardi_: can you help me out for a couple of minutes?
[10:10:14] <acorbi> or maybe anyone here can help me? We are experiencing long load times on http://data.opendevelopmentmekong.net/ when loading organization pages which contain a big number of datasets
[10:10:46] <acorbi> i am aware about the fact that this has being fixed on v 2.3 but by the moment we will stick to 2.2.1
[10:11:55] <Zharktas> acorbi: https://github.com/ckan/ckan/pull/2023
[10:12:42] <acorbi> Zharktas: Thanks, i am reviewing that pr
[10:52:17] <acorbi> Zharktas: I have made the modifications on the groups.py as listed here https://github.com/ckan/ckan/pull/2023/files . Restarted my CKAN instance but with no effect. Anything i am missing?
[10:59:42] <Zharktas> there was another pr for the organization read, which pretty much does the same thing to it as those changes
[11:00:44] <Zharktas> https://github.com/ckan/ckan/commit/db91fb566cbb965a8e8e5e943204cf8cf8ced086
[11:00:45] <Zharktas> this
[11:02:45] <acorbi> yeah, same same
[11:03:25] <acorbi> stupid question: Just changing the python code should be enough for the changes to be applied, correct? no need even to restart ckan
[11:03:48] <Zharktas> nope, restart is needed
[11:04:02] <Zharktas> at least in our environment
[11:04:28] <acorbi> i see, but no other action is required for the change to be applied... correct?
[11:05:58] <Zharktas> correct
[11:11:07] <acorbi> Im suspecting that changes are not being applied on my environment ( Vagrant+Vbox+Ubuntu) I am inserting an typo on the code as test an CKAN is not breaking...
[11:11:38] <acorbi> mmm i am going to see if i can test this somewhere else... Thanks for your support
[11:21:30] <travis-ci> ckan/ckan release-v2.3 efe5dde http://travis-ci.org/ckan/ckan/builds/49441414 amercader: The build was broken.
[12:31:48] <wardi_> joet: nice!
[12:41:03] <joet> wardi_, graphs are always fun.
[15:03:29] <jlehtone> Hi all. We are having the second CKAN meetup in Finland on Friday 20th February arranged by Open Knowledge Finland and CSC - IT Center for Science. We are expecting 10 - 15 developers or persons otherwise intrested in CKAN. We tought that it would be nice to have some core CKAN developer participate shortly via skype. We could discuss about future development of CKAN, some part of CKAN in general or about a topic familiar to the developer. Participants can
[15:30:41] <DragonDave> jlehtone: if you were pasting a message it was cut off at 'Participants can'...
[17:32:57] <jlehtone> Ok, thanks. End of message: Participants can also have some questions. Nothing big or special really. 15 min chat at 17:00 UTC would be great. Is anyone interested to join? Or can you tell someone who we could ask? br, Juho
[17:39:05] <wardi_> jlehtone: can you give a bit more warning next time :-)
[17:39:32] <wardi_> oh. Feb 20, sorry I though you were saying today
[17:39:58] <wardi_> jlehtone: I can likely attend

2015-02-03
[12:06:32] <amercader> wardi_, rossjones, brook, seanh, joet: dev meeting, maybe?
[12:07:00] <rossjones> Not for me today I'm afraid.
[12:07:02] <joet> indeed
[12:07:11] <wardi_> sure lets
[12:07:23] <amercader> rossjones: you know what that means...
[12:07:41] <rossjones> amercader wouldn't assign anything to me atm :)
[12:07:52] <wardi_> https://plus.google.com/hangouts/_/event/cb1vmkss426lkqicj94a3amvd1c?authuser=0&hl=en-GB
[12:08:54] <wardi_> rossjones: no, but I would ;-)
[12:10:02] <rossjones> wardi_ ok, but nothing that needs fixing in next week or two :)
[12:22:16] <joet> oh it's in the title
[17:57:38] <acorbi> hi everyone. I am having some performance Issues with organizations & groups with a big number of datasets. To reproduce it , just select the "ODM Cambodia" organization on http://data.opendevelopmentmekong.net/organization which contains ~5K datasets. It takes around one minute for the page to load
[17:59:21] <acorbi> Any clues on what can be causing this? Our Sysadmins report that uwsgi (python code) is what is experincing the load. The CP load increases up to 100% when this page is loaded...
[18:06:25] <acorbi> ok, this is a Known Issue
[18:06:26] <acorbi> https://github.com/ckan/ckan/issues/2008
[18:06:35] <wardi_> acorbi: yes, organization_show se.. yes :-)
[18:07:06] <wardi_> oh, no not that issue
[18:07:42] <acorbi> not this one? do you have a link to any relevant Issue or fix?
[18:07:47] <wardi_> that one is about activities lists. your issue is about organization_show collecting all the orgs datasets for historical reasons
[18:07:56] <acorbi> true
[18:08:44] <wardi_> acorbi: what version are you running?
[18:08:51] <acorbi> 2.2.1
[18:10:18] <wardi_> acorbi: I think this was fixed on master and in the upcoming 2.3 release
[18:13:33] <acorbi> wardi_: Is there any patch i could apply? We will stick fwith 2.2.1 for the launch (which is happening soon)
[18:25:51] <wardi_> acorbi: hack group_dictize or pass in {'limits': {'packages': 20}} or similar to the context in organization_show
[18:27:19] <acorbi> wardi_: Adding 'limits' seems a good one. I'll definitelly try it. Thanks!
[20:03:43] <wardi_> w

2015-02-02
[07:44:33] <mattva01> so I have a question about ckan urls
[07:45:37] <mattva01> i've got ckan running in docker and proxied behind apache, but some of the urls aren't correct
[07:46:31] <mattva01> the culprit seems to be the url() template helper which doesn't use ckan.site_url and instead falls back on pylons default url. What do I need to set to fix this?
[08:59:20] <Zharktas> is there some functionality to reactive deleted user ?
[11:21:46] <brook> I have a IDatasetForm plugin that is limited for use only for a custom package type (as defined in package_types) and I'm using the various read_template, new_template, edit_template etc methods to specify which template should be used. However, I'd also like make some changes to the normal package pages for datasets with the default type 'dataset'. Do I need to make a separate IDataForm plugin?
[11:32:01] <amercader> brook: two different templates on your extension, one called package/read.html (or whichever one you need) and another called package/read_custom.html, which is the one referenced on the IDatasetForm read_template method
[11:32:06] <amercader> would that work?
[11:32:41] <amercader> package/read.html would be picked up on a default dataset package and the other on your specific dataset type
[11:32:59] <amercader> *disclaimer*: I just made that up
[11:34:15] <brook> amercader: Would that mean my plugin's package_types would have to be registered as the default?
[11:34:34] <amercader> brook: no
[11:35:26] <amercader> if your plugin registers its own template directory, all templates with the same name as core one will override the core ones. That's independent from IDatasetForm
[11:36:25] <brook> amercader: Ah! That worked. I tried that earlier, but must have been caught out by caching or something. Thanks!
[11:36:58] <amercader> brook: the only problem is that I don't know if another extension (eg a specific project that wants to customize the theme) will be able to modify the dataset page them
[11:44:08] <amercader> rossjones: did you guys started work on the vocabularies improvements that we talked about a while ago? https://github.com/ckan/ideas-and-roadmap/issues/103
[11:45:08] <rossjones> amercader yes in datagovuk/ckanext-taxonomy
[11:45:19] <amercader> rossjones: cheers
[12:23:23] <ntoll> hi, what's my best bet for using the CKAN API via Java. I'm hoping the answer is going to be "just use the ckan.jar file found at this location..." ;-)
[12:24:55] <amercader> ntoll: the only client I know is this one https://github.com/okfn/ckanclient-j, which doesn't seem super active
[12:25:00] <Zharktas> https://github.com/okfn/ckanclient-j there's 3 years old client which propably does not work with anything more recent ;)
[12:25:23] <rossjones> try tim lebo's fork - https://github.com/timrdf/CKANClient-J
[12:25:31] <ntoll> right... so I've already asked rossjones (its author)
[12:25:32] <ntoll> hey rossjones
[12:25:33] <ntoll> ;-)
[12:26:00] <rossjones> It couldn't have been me, I don't do Java (contrary to job title on latest contract - sigh).
[12:28:39] <ntoll> rossjones, I'm a Java dev according to my contract
[12:29:12] <rossjones> the shame :(
[12:29:47] <rossjones> ntoll you know we're colleagues from this week, right?
[12:29:59] <ntoll> rossjones, yup
[12:30:03] <ntoll> I feel honoured
[12:32:35] <rossjones> it'll wear off.
[12:45:35] <amercader> rossjones, ntoll: who joined what?
[12:46:47] <ntoll> he joined us
[12:46:52] <ntoll> temporarily
[12:47:03] <ntoll> we all stop end of March for project hard stop
[12:47:40] <amercader> great news
[12:47:48] <amercader> ross joining, not the hard stop
[12:49:38] <rossjones> @amercader will be nice to do something that isn't directly ckan, for a change :)
[12:50:50] <amercader> I can totally relate to that ;)
[15:23:40] <tomkralidis> anyone know where kindly is hanging out these days?
[15:37:04] <travis-ci> ckan/ckan master cf63aa0 http://travis-ci.org/ckan/ckan/builds/49190374 Ross Jones: The build was broken.
[23:26:17] <coasterz> Hi all, is anyone aware of a ckan extension for handling Foip type data requests/responses ?
[23:34:11] <denisz> coasterz not that I'm aware of. Canada does use ckan for disclosing what requests have been answered, but not for request/response workflow https://github.com/open-data/ati-summaries
[23:34:30] <denisz> it would be a great extension to have
[23:35:08] <coasterz> Yes, I agree this would be great to have, but even the partial workflow is helpful
[23:35:32] <coasterz> is this in use on the open.canada site ?
[23:38:46] <coasterz> In use currently I should say, I do see some ATI search functionality on open.canada
[23:45:57] <coasterz> For the current week if I can get foip/ati type data publishable in ckan, that will be a great start.

2015-02-01

2015-01-31

2015-01-30
[09:12:31] <rossjones> That master failure was an error fetching deps.
[09:12:32] <rossjones> Sigh.
[15:13:04] <seanh> rossjones: Do you know what a city council has to do to get datasets from its own ckan site harvested into data.gov.uk?
[15:18:41] <rossjones> seanh sign in to DGU, go to /harvest/new
[15:19:24] <rossjones> If they need to be admins of a publisher, it's either contact form and wait, or ask me to add you as an admin ;)
[15:20:55] <seanh> rossjones: Can you add me as an admin of the Salford City Council publisher please! My username seanh
[15:23:08] <rossjones> seanh done.
[15:23:20] <rossjones> There are a couple of people already set up as editors, they may have left (it happens
[15:25:08] <seanh> Cheers
[15:26:08] <seanh> This is an interesting one: they have 42 datasets on dgu already which they've asked me to import into the new Salford CKAN site which I've done, and they've also asked for the Salford site to be harvested into dgu
[15:26:26] <seanh> Will it duplicate the datasets? They have the same names so I guess it should identify them
[15:26:48] <seanh> The Salford copies don't have all the fields that the dgu ones do (I whitelisted them), will it delete any fields from dgu?
[15:27:38] <rossjones> seanh who knows!
[15:28:31] <rossjones> It should update cleanly, but dread would know for definite (he's on holiday today).  I can't imagine there's a lot of data they've added on the site though.
[15:28:55] <rossjones> seanh I'd say "Use it as documented", if it breaks, it's our problem to fix it.
[15:32:21] <seanh> I'll hold off for a little bit, until they've confirmed that they're happy with the whitelist we used for importing

2015-01-29
[09:32:03] <rgrp> rossjones / dread do you know api call to get http://data.gov.uk/publisher as json? is this the organization api call?
[09:35:24] <rossjones> rossjones yes, it's http://data.gov.uk/api/3/action/organization_list
[09:35:33] <rossjones> rgrp yes it's http://data.gov.uk/api/3/action/organization_list
[09:35:35] <rgrp> perfect - thanks ...
[09:35:38] <rossjones> Need more coffee.
[09:36:19] <rossjones> rgrp you know we have a clean csv export now - datasets on one csv, resources on another (and referenced).
[09:36:40] <rgrp> rossjones: it would be lovely to have a JSON file link from that publisher page :-)
[09:36:50] <rossjones> at http://data.gov.uk/data/dumps/data.gov.uk-ckan-meta-data-latest.csv.zip or http://data.gov.uk/data/dumps/data.gov.uk-ckan-meta-data-latest.json.zip
[09:37:08] <rossjones> Yes, I agree. It'd be lovely
[09:37:26] <rossjones> PRs welcome ;)
[09:37:28] <rossjones> j/k.
[09:37:34] <rgrp> rossjones: how come http://data.gov.uk/api/3/action/organization_show?id=department-for-business-innovation-and-skills doesn ot work?
[09:37:37] <rgrp> do i need to post?
[09:37:49] <rossjones> um, works for me with a GET
[09:37:58] <rgrp> ah - it does work - my apologies - just slow (so 404 from bad query before still there)
[09:38:01] <rgrp> thx!
[09:39:03] <rgrp> looks like child "publishers" are not included in http://data.gov.uk/api/3/action/organization_show?id=department-for-business-innovation-and-skills
[09:40:19] <rgrp> but child has it in groups field ...
[11:12:40] <realitygaps> hmm setting up datastore on a ckan 2.0 and getting Error - <class 'sqlalchemy.exc.ProgrammingError'>: (ProgrammingError) permission denied for schema public
[11:12:51] <realitygaps> i ran set_permissions.sql and seemed to execute correctly , any ideas?
[11:18:38] <realitygaps> ProgrammingError: (ProgrammingError) permission denied for schema public  'CREATE TYPE "nested" AS (json json, extra text)' {}
[11:18:38] <realitygaps> Any ideas what permission i could be missing?
[11:18:51] <realitygaps> its when executing the test datastore api call with curl
[12:49:53] <wardi_> rossjones: ah, separate csvs for datasets and resources. good idea.
[12:53:37] <wardi_> do you have a way to import that as well?
[13:21:55] <rossjones> wardi_ no, not atm.  It's fairly custom for our schema - and likely to break when we get to too many resources, which won't be far off.
[13:22:04] <rossjones> It's just better than the last one with 200 columns.
[14:21:34] <realitygaps> Meh was postgres settings  in the end, works now
[15:59:21] <wardi_> anyone up for a meeting?
[15:59:34] <amercader> let's do this
[16:00:06] <wardi_> https://plus.google.com/hangouts/_/event/cb1vmkss426lkqicj94a3amvd1c?authuser=0&hl=en-GB
[16:01:44] <amercader> seanh, joet, rossjones ^
[16:02:04] <rossjones> :( Can't do today. Please don't assign me stuffs.
[16:02:15] <amercader> :)
[16:23:06] <rossjones> amercader grrrr
[16:24:08] <amercader> rossjones: it's just a tiny one :p
[16:24:13] <amercader> you can ignore it
[16:24:23] <rossjones> :|
[17:48:44] <amln> lordy. a ckan-dev post with terminal output as TEXT.
[17:52:46] <wardi_> :-)
[22:18:40] <travis-ci> ckan/ckan master 8f298cd http://travis-ci.org/ckan/ckan/builds/48818143 David Read: The build has errored.

2015-01-28

2015-01-27
[17:01:38] <rossjones> that isn't really metadata that is core.
[17:01:50] <rossjones> sort of why I wanted namespaced extras :)
[17:01:58] <wardi_> but I can see the argument that we should only have core ckan fields in one object
[17:02:13] <wardi_> namespaced extras would make harvesting and adding local metadata easier
[17:07:52] <rossjones> could you imagine the pain trying to update all the code that depends on it being the way it is currently? :(
[17:29:09] <wardi_> rossjones: actually I'm wrong, that wouldn't work once a site wanted to, say, make its titles consistent
[17:29:33] <rossjones> Not sure I understand.
[17:30:57] <shellac> so close. can you interpret this for me? ckanapi.errors.ValidationError: {u'__junk': [u'The input field __junk was not expected.'], u'__type': u'Validation Error'}
[17:31:04] <wardi_> namespacing extras to allow sites to add detail to harvested datasets doesn't work for a site that wants to change metadata not in extras
[17:31:36] <shellac> that seems to be simply complaining about __junk?
[17:31:57] <wardi_> shellac: seems like a broken error message, it should be telling you the field you passed that it wasn't expecting
[17:32:11] <shellac> ah, hmm
[17:32:57] <shellac> time to chop out things until it works then
[17:33:04] <shellac> thanks

[10:03:33] <seanh> There's an interesting "See Also" box at the very bottom of this page: http://docs.ckan.org/en/latest/api/index.htm
[10:03:44] <seanh> Who inserted that then? :)
[10:03:56] <seanh> http://docs.ckan.org/en/latest/api/index.html
[11:07:27] <rossjones> seanh that's ever so slightly random
[11:12:21] <nigelb> seanh: I think that's because of a sqlalchemy import
[11:12:35] <nigelb> probably because _or is being imported into delete.py
[11:13:01] <nigelb> that's coming from the sqlalchemy documentation for _or :)
[11:13:04] <seanh> Yeah looks like it
[11:13:09] <seanh> It didn't use to be there though
[11:13:11] <nigelb> kinda nice how the documentation comes with the coe :)
[11:13:15] <nigelb> *code
[11:13:19] <seanh> Someone's been doing direct imports
[11:13:23] <nigelb> indeed
[11:13:36] <nigelb> I thought we changed rules to allow that.
[11:13:57] <nigelb> I blame dread :)
[11:18:44] <rossjones> I'll submit a PR once I've made some changes to this branch.
[11:42:02] <rossjones> git checkout -b fix-direct-import ......pep8 tests fail :(
[11:42:12] <rossjones> but they're not failing on master, are they?
[11:49:37] <rossjones> Have I got the wrong version of pep8 that thinks ## is bad but didn't previously?
[11:51:03] <rossjones> I have :(
[12:00:51] <amercader_> dev meeting, exciting!
[12:01:26] <wardi_> https://plus.google.com/hangouts/_/event/cb1vmkss426lkqicj94a3amvd1c?authuser=0&hl=en-GB
[12:03:32] <amercader_> seanh: ^
[12:35:56] <travis-ci> ckan/ckan release-v2.3 a4257e7 http://travis-ci.org/ckan/ckan/builds/48472733 andreivicentiuhincu: The build was broken.
[12:45:12] * rossjones feels bad for trying to give more work to amercader_
[12:45:29] <amercader_> :)
[12:46:27] <wardi_> amercader_: with a young child at home you don't get much sleep anyway, right?
[12:47:39] <amercader_> wardi_: the sleep situation has improved recently
[13:03:29] <rossjones> I don't mind being in 'charge/responsible' for getting dates and stuff (sprint day and social) organised once I've found out about the sprints at europython. It will be between 20 - 26 July in Bilbao.
[13:12:57] <rossjones> Can anyone explain why - a) I've pushed today and git says 14 days ago, b) some of amercader's old commits appear in my PR?   https://github.com/ckan/ckan/pull/2185
[13:13:31] <rossjones> ah. amercader did you actually push to it?
[13:14:00] <rossjones> crikey how confusing is that UI. https://github.com/ckan/ckan/pull/2185/commits is more helpful.
[14:56:57] <mih> currently we have some resources which are not added to the datastore (since datastore was introduced afterwards). How is it possible to add all existing resources to the datastore (e.g. through a script)?
[15:36:27] <mih> ...or: is it possible to add resources to datastore through the datapusher-service? - or when using an API only through datastore_create-Action-API?
[15:38:54] <rossjones> mih if you don't have many, you can install datapusher, and use the manage button on resources individually to submit them for processing.  if you have lots you'll need to make an API call to ....
[15:39:26] <rossjones> https://github.com/ckan/ckan/blob/master/ckanext/datapusher/logic/action.py#L20 for each resource_id
[15:40:05] <rossjones> (again it's provided by datapusher).
[15:50:31] <mih> thanks rossjones -- so, if one has no direct access to the CKAN-server and resources are added through CKAN-API, it is neccessary to call the datastore_create-API for pushing data to datastore
[15:51:59] <rossjones> mih if datapusher is enabled on there, you can tell it to push a resource to datapusher.  if not you'll need to do the work yourself with datastore_create I think.
[15:52:15] <rossjones> I'm not sure what happens with file-uploads via API.
[15:58:02] <amercader_> rossjones: not sure what's going on with these commits
[15:58:20] <amercader_> I pushed some translations stuff to master but not to any other branch
[15:58:37] <rossjones> looks like you pushed to my branch, I have rebased from master, but not sure why yours got special treatment :)
[15:59:12] <rossjones> says yesterday on https://github.com/ckan/ckan/pull/2185/commits
[16:00:01] <rossjones> and 2 from last october. I wonder if github is broken.
[16:03:43] <amercader_> that is worrying. I definitely didn't (consciously) push to your branch
[16:04:44] <rossjones> Didn';t think you would have. Checking with a friend if he has any ideas.
[16:05:00] <rossjones> If he doesn't, I'll ask 'support'.
[16:07:55] <amercader_> I think github got confused, I guess merging master should make them go away
[16:09:50] <rossjones> Yeah, looks better. But now I am worried.
[16:30:47] <brook> rossjones: Are you working in your own repository (rossjones/ckan)? If so, when you rebased, was it from ckan/ckan master, or your rossjones/ckan master?
[16:36:09] <rossjones> it's a branch on the ckan org, so i rebased off ckan/master.
[16:36:59] <rossjones> merging master into my branch removed them, so I obv did something wrong, or GH was just getting confused.
[16:37:12] <rossjones> And I have history of screwing up my PRs :)
[16:37:59] <brook> Bummer - was hoping it was something to do with rebasing off the old repo.
[16:38:25] <rossjones> Maybe GH just hates us coz we have so many branches ...
[16:44:16] <shellac> does anyone have an idea what might cause this error: ckanapi.errors.ValidationError: {u'__junk': [u'The input field __junk was not expected.'], u'extras': [{u'key': [u'Missing value'], u'value': [u'Missing value']}], u'__type': u'Validation Error'}
[16:44:31] <travis-ci> ckan/ckan closed-organizations 24ee4b1 http://travis-ci.org/ckan/ckan/builds/48502359 Ross Jones: The build was broken.
[16:44:36] <shellac> I get it creating packages via ckanapi
[16:44:51] <shellac> (or rather trying to create)
[16:45:24] <rossjones> shellac did you send 'extras':[{}] as part of the request?
[16:45:43] * shellac looks
[16:45:56] <shellac> nope, doesn't look like it
[16:46:45] <rossjones> it appears to be complaining that the extras you send didn't contain a "key" or a "value" field.  Could you put the call you're making in a pastebin/gist?
[16:46:50] <shellac> but I did send an extras value (non-empty)
[16:48:58] <shellac> https://gist.github.com/shellac/deab81066045b7719cda
[16:49:10] <shellac> ...it will need some reduction...
[16:49:50] <wardi_> shellac: that's not how extras are specified, you need one object per extra unless you're using a custom schema
[16:50:07] <rossjones> although you way seems to make a lot more sense (to me), each extra is a separate dict with {'key': 'blah, 'value': 'blah}
[16:50:29] <rossjones> wardi_ I think I prefer shellac's way though :(
[16:50:43] <shellac> aha, I understand
[16:50:44] <wardi_> yeah, that's why I use a custom schema :-)
[16:51:17] <rossjones> Same here, but recently have started thinking I'd like to keep the top level cleaner and not so cluttered :(
[16:51:23] <shellac> I'm migration some harvester code to ckanapi, and the data form is similar ... but not quite the same :-)
[16:51:34] <wardi_> it lets me pretend that extras aren't a thing. actually, I'm doing the same for tags now too
[16:51:50] <shellac> s/migration/migrating/ (illiterate me)
[16:52:20] <shellac> thanks for the help
[16:52:41] <wardi_> rossjones: define clutter :-)
[16:53:49] <rossjones> wardi_ https://github.com/datagovuk/ckanext-dgu/blob/master/ckanext/dgu/forms/dataset_form.py#L234-L301
[16:59:23] <wardi_> yikes. mixing underscores and dashes?
[16:59:38] <rossjones> everyone in the world has contributed to that extension.
[17:00:01] <wardi_> at least there's no camel case in there
[17:00:53] <rossjones> YET
[17:01:02] <wardi_> what I mean is, what belongs as a top-level field totally depends on the client
[17:01:30] <rossjones> Sure. but i think there's a clear distinction in some cases for things that are really just so the extension can remember something.

2015-01-26
[10:09:37] <rossjones> Morning.
[10:10:56] <rossjones> It appears that datapusher, when given an XLS file, only processes the first sheet - does anyone know if that is intended behaviour? Or is it a constraint of only having one db table per resource with datastore?
[10:18:43] <joet> rossjones, i'm going to assume it was intended, it was just for the preview I assume to start with.
[10:20:37] <mih> Morning ;-)! Another datapusher-question: When updating a resource-file, we are getting an "Process completed but unable to post to result_url"-error-message. The log-file has following error-entry: JobError: CKAN bad response. Status code: 409 Conflict. At: http://test-ckan.com/api/3/action/resource_show. Response:   {u'error': {u'__type': u'Validation Error', u'id': [u'Fehlender Wert']}, Any ideas what could be the reason for it?
[10:22:51] <rossjones> mih that doesn't look like a valid id.
[10:24:00] <rossjones> I've no idea where that id would have come through
[10:27:35] <mih> hm a few days ago the site switched to https. Could that be a problem too since ckan.site-url-setting is still without https?
[10:28:47] <rossjones> I can't imagine it's related.  When you update a resource (in a dataset) it should send the resource id to datapusher - not sure why it would pick up a title instead of the id.
[10:29:13] <rossjones> I'm still getting up to speed with data(store|pusher) though
[11:24:45] <wardi_> mih: site url does need to be correct for datapusher to work, yes
[11:38:40] <rossjones> wardi_ wouldn't throw a validation error though if it couldn't get to the server would it?
[12:41:09] <travis-ci> ckan/ckan release-v2.2.2 a47992c http://travis-ci.org/ckan/ckan/builds/48335195 amercader: The build was broken.
[13:06:09] <wardi_> rossjones: who knows. i've heard the datapusher errors need work
[13:47:50] <joet> seanh, did you ever have an idea for the implementation of "append_unused" on losser, most things I've come up with feel really ugly.
[13:47:50] <mih> thanks @ wardi_ & rossjones ;-)!
[13:54:01] <seanh> joet: It is awkward, yeah
[13:54:11] <seanh> I had some idea but now I can't remember what it was!
[13:54:27] <seanh> It's kind of needed, though
[13:55:38] <joet> seanh, I'm thinking i might be able to side step it slightly
[13:56:24] <joet> at the moment you can match multiple keys and it becomes one column, but it might be possible to say "match multiple keys, turn each one into a column"
[13:56:47] <joet> because they really just want the extras in the the ckan dataset dict
[13:56:48] <seanh> Hmm, yes I see
[13:57:54] <joet> alas, that's the best I've got so far.
[13:57:55] <seanh> I think we'd still need append unused one day, but match multiple is also a useful feature in itself
[14:47:53] <rossjones> seanh am I imagining that there is a way of viewing the datapusher task errors in the UI somewhere?
[14:48:05] <rossjones> or does it exist somewhere
[14:51:56] <seanh> In CKAN, go to "Manage" a resource I think
[14:53:41] <rossjones> seanh ah cool, we don't have that, guess I should add it :)
[14:57:05] <rossjones> seanh awesome, that's exactly what i was looking for :)
[15:16:18] <mih> if we would like to use a custom map with the geospatial-extension -- which requirements does it have to meet?
[15:16:58] <travis-ci> ckan/ckan release-v2.2.2 a47992c http://travis-ci.org/ckan/ckan/builds/48335195 amercader: The build was broken.
[16:13:52] <amercader_> mih: if you mean having a different base map on the map widgets, have a look at this: http://docs.ckan.org/projects/ckanext-spatial/en/latest/map-widgets.html
[16:37:12] <mih> amercader_: I am not really familiar with (building) maps - however, we would like to use a custom map instead of open street map. So, which requirements does such custom map have to meet (e.g. providing WMTS?)?
[16:42:32] <amercader_> mih: you will need a map server that supports the XYZ convention: http://docs.ckan.org/projects/ckanext-spatial/en/latest/map-widgets.html#custom
[17:27:50] <mih> amercader_: thank you! so, it is not absolutely neccessary that, e.g., the server provides WMS-GetCapabilities/GetMap?
[20:07:25] <opensas> I'm trying to install the ckan harvest extension from here: https://github.com/ckan/ckanext-harvest
[20:07:33] <opensas> I'm having trouble with the pip install part
[20:07:44] <opensas> when I issue: pip install -r pip-requirements.txt
[20:07:47] <opensas> I get:
[20:07:50] <opensas> OSError: [Errno 13] Permission denied: '/usr/lib/ckan/default/build'
[20:08:19] <opensas> If I run it with sudo it goes ok, but I'm not sure that's the right way to do it

2015-01-25

2015-01-24

2015-01-23
[10:34:00] <TeddyDD> hello

2015-01-22

2015-01-21
[12:29:27] <rossjones> Anyone any idea why datastore sets 'datastore_active' at runtime rather than at datastore_create time?
[12:30:36] <rossjones> Looks like it does one sql query per resource after package_show - and on packages with more than a couple of resources this seems a bit, erm, wasteful.
[12:30:53] <rossjones> i.e. I have packages with > 100 resources.
[12:58:32] <wardi_> rossjones: what does datastore_active mean? just that there is a table for that resource?
[12:58:45] <rossjones> yes.
[13:01:57] <wardi_> yeah, let's store that in the resource dict instead
[13:13:15] <wardi_> and that will remove one sporadic travis failure case too
[14:00:30] <rossjones> let's hope so, i thought it was fixed.
[14:00:41] <rossjones> just branches that hadn't merged in master for a while.
[14:01:02] <rossjones> Now worries that the 'before' isn't always working.
[14:01:13] <rossjones> but have bigger issues to worry about :(
[15:16:13] <acorbi> Hi everyone, hope you are all good!
[15:18:23] <acorbi> I have a question regarding doing LOT of calls to the CKAN api using ckanpi https://github.com/ckan/ckanapi . Basically, i am writing a script which migrates content exported from WP (in xml format) into CKAN. For that, i parse the xml file and for each entry i call the package_create API method. My aim is to migratearound 10K Wp Posts so there are a lot of calls to the API to be made and it breaks from time to time with a the followin
[15:19:18] <acorbi> any ideas/experience on how to proceed in these situations where lots of API calls are done in a brief period of time?
[15:22:09] <rossjones> acorbi what's the error? It got truncated
[15:22:59] <DragonDave> The last we saw was: "it breaks from time to time with a the followi..."
[15:36:07] <acorbi> oh wait, ill post it again
[15:36:17] <acorbi> need to reproduce it first
[15:36:31] <acorbi> but it is basically a 500 Internal Server Error
[15:36:40] <acorbi> ckanapi.errors.CKANAPI
[15:36:59] <rossjones> acorbi anythin in the logs?
[15:39:20] <acorbi> Error is this kanapi.errors.CKANAPIError: ['http://127.0.0.1:8081/api/action/package_show', 500, u'\n    <html>\n    <head>\n    <title>Server Error</title>\n    \n    </head>\n    <body>\n    <h1>Server Error</h1>\n    An internal server error occurred\n    \n    </body>\n    </html>']
[15:41:43] <rossjones> acorbi can you do it with CKAN set to debug=True, you might get the actual underlying exception then to put into a pastebin.com
[15:42:02] <acorbi> ok, let me check
[15:46:52] <acorbi> here you go http://pastebin.com/c7AmScK8 ( it is quite criptic tho)
[15:49:23] <acorbi> Ok, i turned that chunk of text into an html file and could read this: error: can\'t start new thread
[15:49:54] <acorbi> any pylons limitation regarding max number of concurrent threads?
[15:50:26] <acorbi> FYI: im testing the script in a development instance (not deployed)
[15:52:24] <rossjones> The problem is the ckanext.googleanalytics.controller which is starting threads to notify google in the background, it's run out of threads.  Perhaps disabling it whilst you do the import might be wise :)
[15:52:40] <rossjones> maxious ^^
[15:53:57] <acorbi> that sounds resoanble, i see this on the error
[15:53:57] <acorbi> \nModule ckanext.googleanalytics.controller:65 in __init__         view \n >>  t.start()
[15:54:14] <acorbi> i am going to try now and come back to you
[15:54:26] <rossjones> ok
[15:55:30] <acorbi> running again, if it takes a while is a good signal :-)
[15:56:35] <rossjones> Fingers crossed.
[16:19:14] <acorbi> rossjones: looks good, by the moment it has not crashed. Keep those fingers crossed a little bit please ;-)
[16:52:41] <rossjones> acorbi can i uncross my fingers now?
[17:07:07] <acorbi> rossjones: yes, definitelly! That seems to be the reason. many many thanks
[17:07:25] <acorbi> i'll open an issue on the repo for googleanalytics
[17:08:36] <acorbi> This has been a serious for me while developing this import scripts. Specialy, while runing them on an instance on Webfaction, since they block the access to the machine when the number of threads reaches 300
[17:10:04] <acorbi> Well, actually, there is already an Issue related
[17:10:04] <acorbi> https://github.com/ckan/ckanext-googleanalytics/issues/12

2015-01-20
[11:49:47] <george_s> tuesday meeting is on, yes?
[11:58:08] <amercader> wardi, rossjones: the okf guys are away at our retreat and won't be able to join the dev meeting
[11:58:10] <wardi_> george_s: I believe so
[11:58:18] <wardi_> ah
[11:58:23] <wardi_> right, forgot about that
[11:58:25] <amercader> feel free to assign stuff away if you want
[11:58:45] <wardi_> nah, let's do it next week
[11:58:59] <george_s> retreat? cool. somewhere exotic I hope
[11:59:30] <amercader> george_s: cold cambridge, nothing really exciting
[11:59:55] <george_s> by the way, I'm back after a much regretable absence. Can grab something for testing though
[12:00:27] <wardi_> 2.3 branch is good to test :-)
[12:01:05] <george_s> a pull request or just general testing?
[12:01:46] <wardi_> if you're looking for something specific, feel free to grab any pull request or unassigned issue that interests you
[12:02:45] <george_s> okay, cool. It's late here so I'll check the lists tomorrow and make a start on something
[12:16:58] <joet> our 2.2.1 docs build on read the docs is broken, annoying the pdf version builds and the html version fails with no decent error message.
[12:18:15] <rossjones> phew, thought i was gonna miss the call.  next week is cool by me too.
[12:18:41] <Zharktas> and it's annoying that 2.2.1 ckan has api link on dataset page to broken docs :p
[12:22:08] <joet> Zharktas, that's why I'm trying to get the build for it fixed :p
[12:23:36] <amercader> the docs are fixed on 2.2.2
[12:24:09] <mih> does anyone know a CKAN-instance where the spatial-extension is working? - e.g. on the datahub, there is a 409-conflict-error (http://datahub.io/dataset/flickr-shapefiles/resource/36ef2daf-8e50-4f14-92df-6f60720950ee)
[12:24:17] <joet> amercader, there's a g.ckan_docs_version, and people will use the branch they're checked out on
[12:48:50] <rossjones> mih that's a problem with file-sizes (and presentation) rather than anything else. you may have the same problem elsewhere.
[12:59:16] <mih> rossjones: thanks!
[13:03:53] <rossjones> I need to implement datastore. I can't implement datastore. Might just hit the bottle instead.
[13:30:15] <wardi_> rossjones: can't implement datastore?
[13:30:40] <rossjones> wardi_ the way we do our resources, it zaps em all.
[13:30:56] <rossjones> in datastore_create
[13:32:39] <rossjones> so it works, and then it breaks during validation. which is a pain.
[18:18:04] <joet> Hahaha awesome
[18:18:27] <joet> Ckan is on tonights BBC news
[18:18:37] <joet> Well data.gov.uk

2015-01-19
[15:21:52] <mih> I am trying to add a packge through the CKAN-action-API (package_create). Probably, the extras are causing a problem.  It looks like following: {"title":"test","author_email":"test@test.test.com","maintainer":"test","maintainer_email":"test","license_id":"CC-BY-3.0","type":"dataset","extras":[{"key":"Key1","value":"val1"},{"key":"key2","value":"val2"}],"name":"testpackage"}
[15:22:53] <mih> without extras it does work - so, what is wrong with the extras?
[15:22:54] <mih> ;-)
[15:23:38] <wardi_> mih: you don't get an error? what happens?
[15:26:12] <mih> wardi_: I am doing it through PHP and stream_context_create - but I do not get any specific error-message. The package could not be added.
[15:27:09] <wardi_> ckan returns errors in the response if validation fails somewhere
[15:27:59] <wardi_> try again with "ckanapi action package_create -i < your_dataset.json"

2015-01-18

2015-01-17

2015-01-16

2015-01-15

[12:05:46] <seanh> Weird, why is CKAN giving me an "organization_create requires an authenticated user" error when I'm using ckanapi, and I *am* passing an apikey?
[12:14:53] <seanh> Ah, I was sending it an api key from the wrong site, there's no nice "that's not a valid api key" message (maybe there shouldn't be)
[13:17:47] <wardi> joet: nice work on the memory leak
[13:19:25] <wardi> something about an attribute called __shared_state really smells
[13:21:33] <joet> it's a thread local object if i recall
[13:21:51] <joet> I've been going in circles for a while, I might stop for some lunch, it;'s giving me a headache trying to figure itout
[13:22:24] <joet> thing is, the weakref objects suggest that these should of been garbage collected
[13:22:31] <joet> but something else is holding onto them.
[13:37:31] <wardi> joet: gc.collect doesn't do anythin?
[13:39:05] <joet> nope
[13:44:48] <rossjones> are we sure it isn't how pylons works? by keeping hold of the body and just overwriting part of it with the next response?
[13:45:10] <rossjones> I know it was a dumb suggestion, and I haven't been able to check - but does it still happen with https://github.com/ckan/ckan/issues/1847#issuecomment-63877579 ?
[13:45:16] <rossjones> just out of interest
[13:46:14] <joet> rossjones, I'll give it a go
[13:46:27] <rossjones> ta
[15:21:09] <seanh> rossjones: Another odd one in the dgu schema is this "individual_resources" key, how does that differ from "resources"?
[15:27:54] <joet> ok, I've determined that it'll keep up to a maximum of 10 responsesin memory. Although I don't know where this behaviour is defined
[15:36:16] <wardi> so that's not a leak, right? sounds like a debugging thing
[15:38:56] <rossjones> seanh we have individual resources which are normal resources, timeseries resources which have a date attached and additional_resources which are documentation
[15:39:53] <rossjones> joet wardi fork pylons?
[15:39:58] <joet> yeah it's not a leak, alice said it was leaking 20mb per request, the thing is if you make 10 new requests
[15:40:12] <joet> although the reported memory usage stays the same, the usage in guppy is lower
[15:40:32] <joet> from waht I've come across in blogs/articles, this is just how python behaves with memory
[15:40:58] <joet> as in, if you just allocated a crap ton of memory to serve a whole bunch of requests, it stands to reason that'll be needed again soon
[15:41:15] <wardi> they won't get used again though, right?
[15:41:22] <joet> so the wsgi/paster process will keep a hold of it
[15:41:43] <wardi> there's no good reason to store responses, other than debugging
[15:41:54] <joet> pretty much, I don't know why they're kept
[15:42:21] <joet> or why it's 10
[15:42:21] <joet> I'll try again with debug = false
[15:42:51] <joet> paster allows you to go back and look at a debug page on previous requests
[15:42:52] <joet> it could be that
[15:44:00] <rossjones> if debug is true it has to keep it in mem for the debug page, no?
[15:44:48] <joet> yeah that's what I'm thinking
[15:45:12] <joet> although alice said it happened even in production
[15:45:23] <joet> i'll just have to give it a try
[15:55:52] <seanh> rossjones: dgu apparently has tag names with spaces and stuff in them as well?
[15:56:59] <wardi> we've added "'" to our tags (French is hard without them)
[15:57:44] <seanh> So if I'm gonna harvest datasets from DGU into another CKAN site, I probably want "individual_resources" from DGU to go into "resources" on the other site then? (And ignore DGU's "resources")
[15:58:24] <seanh> Ah maybe I'll just copy "resources" actually, I'm guessing that contains all of the different types of resources
[15:59:26] <amercader> seanh: you should probably ignore validation when harvesting ckan datasets to other instances, and just import a plain data_dict
[15:59:33] <rossjones> seanh if you were going to harvest, I'd say use the nightly json dump :)
[15:59:56] <rossjones> there are lots of weird corners of DGU where it behaves a lot differently than core.
[16:00:32] <seanh> I just need the 34 resources from one organization, it's a couple of lines of Python to get them as JSON from the API. Then I'm just whitelist-filtering the keys out of them, since DGU's schema contains a ton of stuff that the default schema won't accept
[16:00:47] <seanh> This does mean that some info is lost in the import I guess
[16:01:02] <joet> ok, I'm pretty sure it's because by default paster's http server has a default of 10 threads running
[16:01:24] <seanh> But I don't think I can import things like custom top-level dataset fields, when the target site doesn't have those fields in its schema
[16:01:31] <rossjones> seanh I wouldn't even try and map most of the DGU schema, there's lots in there that wouldn't make any sense outside of DGU.  Merging additional_resources, individual_resources and timeseries_resources seems like the best approach
[16:02:13] <seanh> I was guessing the "resources" was a merge of those three, haven't looked at many datasets though
[16:02:29] <seanh> I'm not actually using the harvest btw, this is just a teeny api script
[16:03:06] <seanh> Yeah there seems no point in mapping all the custom fields and extras and stuff ... The Salford city won't do anything with them and may crash
[16:03:39] <amercader> dev meeting?
[16:04:08] <wardi> https://plus.google.com/hangouts/_/event/cb1vmkss426lkqicj94a3amvd1c?authuser=0&hl=en-GB
[16:15:49] <joet> {% set show_organizations_selector = organizations_available and (user_is_sysadmin or dataset_is_draft) %}
[16:15:57] <joet> https://github.com/ckan/ckan/blob/master/ckan/templates/package/snippets/package_basic_fields.html#L59
[16:16:49] <brook_> https://github.com/ckan/ckan/pull/1188
[16:33:34] <travis-ci> ckan/ckan 1753-rename-legacy-tests 01826e7 http://travis-ci.org/ckan/ckan/builds/47133093 David Read: The build was broken.
[16:44:18] <joet> there's probably somewhere where it's logical to clean up the response right? i'm hoping __after__ in http://pylons-webframework.readthedocs.org/en/latest/controllers.html#wsgicontroller-methods is called after the response is sent to the client.
[16:49:05] <seanh> Would cleaning up the response object afterwards help? Does the thread hang on to the memory it had at the end of processing the response, or just the max memory it had at any point while processing it?
[16:49:54] <joet> it's the response string that hangs around, when the thread gets reused, it knows the response isn't needed anymore
[16:50:19] <joet> but yeah the thread hangs onto the memory
[16:50:34] <joet> the string doesn't get garbage collected
[16:55:56] <seanh> So if another much smaller request comes along and happens to use the same thread, after that the thread would be taking up much less memory?
[16:56:09] <joet> yeah
[16:56:13] <seanh> I see
[16:56:22] <seanh> Sounds like cleaning out the request would work then
[16:56:37] <seanh> Also, just hit your server with lots of iny requests to "flush it out"
[16:59:50] <wardi> amercader: is the thing in Cambridge the same one I attended a day of last year?
[17:00:38] <amercader> wardi: this year is an OKF-wide thing, so we don't have time to meet just our unit (ie for talking about ckan)
[17:02:19] <wardi> that's too bad. There'll be another ckan-con thing attached to okfest this year though, right?
[17:03:10] <amercader> last I heard is that there won't be an okfest this year
[17:03:12] <amercader> not sure why
[17:03:40] <amercader> but we could do a ckan con / dev meeting if there is interest
[17:05:29] <wardi> I would come out. should I open an ideas ticket?
[17:05:34] <rossjones> amercader somewhere sunny please.
[17:06:26] <rossjones> And the assoc should pay for it.
[17:07:42] <amercader> rossjones: I'm partial to Barcelona, but any Mediterranean / Caribbean / Pacific Island will do
[17:07:46] <amercader> wardi: go for it!
[17:09:08] <rossjones> Europython is in Bilbao isn't it?
[17:10:10] <amercader> some serious food there
[17:10:20] <rossjones> http://www.europython-society.org/post/106049286320/europython-2015-will-be-in-bilbao-spain
[17:10:47] <rossjones> Now we're talking.
[17:21:31] <rossjones> https://github.com/ckan/ideas-and-roadmap/issues/120   <-- thanks @wardi - worth mailing the list too
[17:24:41] <wardi> rossjones: will do
[17:59:44] <amln> and there's the 24 hour ferry from Portsmouth :P

2015-01-14

[06:20:55] <shan17j> anyone here?
[06:21:01] <thelaptop> no
[06:21:18] <shan17j> haha.. I'll ask anyway..
[06:22:23] <shan17j> I'm trying to implement an extension to dataset search.. when I search through the UI, the before_search method gets called, however when I submit the form through Javascript, the method doesn't get called
[06:22:28] <shan17j> any idea?
[11:27:36] <amercader> rossjones: dgu down?
[11:28:44] <amercader> rossjones: sorry, my bad, was trying https
[11:29:10] <rossjones> umm. is that not on?
[11:29:10] <rossjones> I thought we turned it on already
[11:29:58] <rossjones> Not much point now, will be banned in tories get back in
[11:39:21] <nigelb> rossjones: what'll be banned? dgu or https?
[11:39:27] <nigelb> both sound fairly scary.
[11:39:29] <rossjones> https
[11:39:41] <nigelb> :O
[11:39:47] <nigelb> too secure?
[11:39:50] <rossjones> nigelb http://www.independent.co.uk/life-style/gadgets-and-tech/news/whatsapp-and-snapchat-could-be-banned-under-new-surveillance-plans-9973035.html
[11:40:14] <rossjones> Don't think it'll ever actually happen - there's always a gap between what politicians say and what actually happens :)
[11:41:17] <nigelb> rossjones: we have local carriers wanting to ban them for money reasons
[11:41:21] <nigelb> this is... interesting.
[11:41:36] <nigelb> they cite security reasons, but we know it's money reasons.
[11:41:46] <nigelb> And this is the ISPs and cellphone providers, not politicians.
[11:57:04] <brook_> I'm getting errors when trying to view a resource. Log says: Error - <type 'exceptions.KeyError'>: 'resource_id'
[11:57:11] <brook_> More in the pastebin: http://pastebin.com/vMkGDCSQ
[11:57:50] <brook_> Any ideas? I can create datasets and add resources, but can't view resource pages.
[11:59:42] <nigelb> you've not enabled debug=True?
[11:59:59] <nigelb> there's no traceback to usefully say what's wrong :(
[12:00:21] <nigelb> oh this is production
[12:00:32] <brook_> I'll try debug - though this is meant to be a production instance. I get the same problem with the paster server though
[12:05:25] <rossjones> Next time I say I am going to fix group_*, I'd appreciates if someone shouted at me to step away from the computer.
[12:09:18] <joet> brook_, do you have a resource view active?
[12:09:18] <wardi> i think mixing return_id_only in the keys to package and group create would be ok. we already have a bunch of reserved keys with special meanings there
[12:10:01] <rossjones> problem is dictization really.  thinking we should remove group/dataset_*_dictize and keep it in the actions.
[12:10:11] <joet> I'm going out on a limb here and take a look at the plugin code that handles the resource view, there is a chance it's looking for the resource_id in the context.
[12:10:29] <brook_> joet: just recline_view
[12:10:36] <joet> hum
[12:12:48] <wardi> rossjones: how about just slimming down the dictization stuff so that it doesn't do things like get 1000 packages when you ask for a tag
[12:13:06] <nigelb> yeah
[12:13:09] <nigelb> +1 to that.
[12:13:20] <nigelb> dictization shouldn't really fetch anything from anywhere.
[12:13:24] <brook_> nigelb and joet: a more useful stacktrace: http://pastebin.com/TjCjGjPj
[12:13:29] <nigelb> it should ideally just convert an object to a dict.
[12:13:44] <nigelb> the rest of that logic needs to go into the action function
[12:13:55] <rossjones> wardi the problem is that dictzn stuff calls other dictization stuff, which skips the schema, and then we have difference in args between the action and dictzn stuff - it's messy and error prone and not easy to follow :(
[12:14:07] <nigelb> huh, that doesn't make any sense.
[12:14:10] <rossjones> think we should have table_dictize and then put the logic in the logic layer
[12:14:23] <wardi> +1
[12:14:42] <nigelb> rossjones: hah, yeah. we're saying the same thing :D
[12:14:44] <rossjones> will make it easier to track the parameters that are valid and ensure consistency in how they're used
[12:14:58] <nigelb> brook_: I've not touched the resource views, so this isn't familiar territory for me.
[12:15:04] <nigelb> joet: ^ perhaps you know?
[12:15:08] <rossjones> right. I'm on it. Deep breath ......
[12:18:24] <joet> odd, pretty sure most of us would of run into it?
[12:19:00] <joet> i'm thinking maybe check_access in the template needs the resource_id passed as a parameter in the data_dict
[12:20:59] <joet> brook_, what branch are you on?
[12:21:12] <brook_> master
[12:21:47] <brook_> joet: Like you say, others would have run across this
[12:22:53] <joet> from the traceback it looks like line 113 should be h.check_access('resource_view_create', {'resource_id': whatever_ourtemplate_variable is)
[12:23:08] <joet> but i'm trying to recreate it locally now
[12:26:57] <brook_> joet: if the user is a sysadmin, there's no error. I guess because the check access always allows sysadmins.
[12:27:38] <joet> brook_, the call to check_access always returns True for sysadmins
[12:28:02] <joet> so all auth checks are always wrapped in it, I can't remember where the code is exactly
[12:28:41] <joet> wow
[12:28:53] <joet> brook_, ok if you're not logged in it's fine
[12:29:01] <joet> if you're logged in as a normal user it breaks
[12:29:22] <nigelb> joet: the check_access code is iether in logic/__init__.py
[12:29:30] <nigelb> or logic/auth/__init__.py
[12:30:25] <brook_> joet: just checked and this happens on my normal development install too. I'll make an issue. Likely introduced recently with the resource view changes that have been going on. We probably all use sysadmin users so no one has noticed it yet :D
[12:31:00] <joet> ssh
[12:31:03] <joet> sshh :p
[12:31:41] <brook_> Thanks :)
[12:32:30] <joet> it just needs a parameter in that line, but we'll need some tests for all types of users just trying to view a resource page with and without a view of some form
[12:35:09] <nigelb> brook_: heh, fun :D
[12:35:41] <brook_> nigelb: At least I know it's not specifically my thing :)
[12:40:54] <joet> ok, unless you use the decorator logic.allow_anonymous_access, anonymous users will return false in new_auth.is_authorized before your auth function is called. You learn something everyday.
[13:58:19] <wardi> joet: that's not very nice
[15:32:40] <rossjones> Does someone get the error emails from master.ckan.org?  Any chance you might find the one for http://master.ckan.org/dataset/utf-8-test/resource/ed0f1c18-5f36-4167-b29e-d70533d1da7c/new_view?view_type=basicgrid to see what the problem might be?
[15:33:01] <rossjones> pjakobsen Sorry to hear DPM didn't work, do you have an organization set up on datahub.io?
[15:33:30] <rossjones> Your auth problems may be that you don't have a group set up.
[15:50:53] <amln> rossjones: "error_emails_to": "",
[15:51:08] <rossjones> useful :)
[15:51:20] <rossjones> Send em to nigel ;)
[15:51:31] <amln> meanie.
[15:51:43] <amln> sentry's only on demo.ckan.org at the mo.
[15:51:48] <rossjones> :(
[15:53:47] <rossjones> Datastore says: Error: CKAN DataStore bad response. Status code: 500 Internal Server Error. At: http://master.ckan.org/api/3/action/datastore_create. blah blah
[15:54:29] <rossjones> Probably a utf problems.
[15:59:46] <amercader> brook_: developing with a sysadmin account, I've been bitten many times by this :)
[16:01:42] <amercader> rossjones: https://gist.github.com/amercader/8c7d16cfee478c20bfed
[16:02:00] <rossjones> ta-da - utf8 problem :)
[16:02:13] <brook_> amercader: Thanks for the merge :)
[16:02:16] <amercader> + terrible error reporting
[16:02:47] <rossjones> I gotta implement datastore soon, so will take a look I guess.
[16:03:12] <wardi> wow, the multiple inheritance in the old tests sure makes things interesting
[16:06:03] <rossjones> wardi don't go there without a torch, several days supply of food and an overly adventurous mood.
[16:07:13] <wardi> I was just in a maze of twisty little passages, and now my torch went out
[16:08:18] <rossjones> wardi I'm seriously considering just paying someone to spend a month re-writing all the tests so we can delete the old ones.
[16:08:26] <DragonDave> wardi: You are likely to be eaten by a grue.
[16:08:31] <rossjones> + selenium tests
[16:08:51] * wardi was eaten by a grue
[16:13:59] <rossjones> Am I right in thinking that datapusher will push the data once, but then not push it on changes to the resource url?  It explicitly excludes resources that have a url_type of datapusher - https://github.com/ckan/ckan/blob/master/ckanext/datapusher/plugin.py#L106-L108
[16:16:08] <wardi> There's an issue where datapusher only updates if the url changes, I think
[16:18:50] <rossjones> I think it excludes datapusher url_types (which it sets after pushing data) - it's confusing me.  I need to change it anyone so it isn't 'all or nothing'.
[17:10:04] <dread_> Isn't it now the "CKAN Association Government Working Group" call? wardi
[17:18:42] <dread_> hoorah it has now started
[17:24:22] <dread_> rescheduled for next week

2015-01-13

[16:08:49] <pjakobsen> what is the current method of grouping datasets together into "projects" or related areas of interest for speficic audiences?  Is there a plugin for that, or is that what groups are for?
[16:09:10] <rossjones> groups I think. They're pretty generic.
[16:09:35] <pjakobsen> For example, we have economists working only on trade data, they don't want to see anything else.
[16:10:12] <pjakobsen> Does group mean "group of data" or "group of people" or both?
[16:11:13] <rossjones> group of data.
[16:11:21] <rossjones> you could just create a new organization though for them
[16:11:34] <pjakobsen> ok
[16:11:37] <rossjones> On DGU we call organizations, publishers.
[16:11:46] <pjakobsen> DGU?
[16:11:52] <rossjones> data.gov.uk
[16:11:58] <pjakobsen> Ah.
[16:12:05] <rossjones> Am sure some other sites change the name as well.
[16:13:23] <pjakobsen> Just in case I can't get Data API working on datahub.io, where is the best place to run the latest CKAN...? Amazon?
[16:13:36] <pjakobsen> I wonder what the monthly cost would be to get decent performance.
[16:14:03] <pjakobsen> $600 / month hosted CKAN with OKFN is probably the way to go, no?
[16:14:35] <pjakobsen> It hopefully guarantees that it *just works* out of the box
[16:15:17] <rossjones> pjakobsen I guess so, but there's a CKAN image on amazon from linkdigital too I think.
[16:15:30] <rossjones> but obviously involves more work.,
[16:15:42] <pjakobsen> rossjones: ooh.. that's a nice tip.
[16:15:49] <rossjones> amln will be able to tell you more about okf hosting.
[16:32:38] <rossjones> pjakobsen no luck with dpm?
[16:34:18] <pjakobsen> have not tried yet.
[16:35:07] <pjakobsen> But it's something stakeholders who need to uplaod data probably will not be able to wrap their heads around, so even if it works, this may be a show stopper on using datahub.io
[16:36:08] <pjakobsen> Amazon is a good option at $70  / month I hope
[16:39:45] <rossjones> pjakobsen will be hard to control usage though.
[16:40:57] <pjakobsen> true
[16:41:19] <rossjones> pjakobsen let me know how you get on, and if I get more time to set it up on datahub but it's an older version (2.1.1) so I'm not sure how fiddly it is.
[16:51:31] <amercader> seanh: can you check this when you have a sec? it's on your datapusher errors pr
[16:51:32] <amercader> https://github.com/ckan/ckan/commit/290850554bfff7e22e8cd0410074eb41b68b3563
[16:53:32] <seanh> amercader: sure
[16:53:43] <amercader> seanh: also can you give me permissions on pypi for datapusher?
[16:53:50] <seanh> does dgu put the entire data dict as a string, inside the data dict? http://data.gov.uk/api/3/action/package_show?id=air-quality-monitoring-stations1
[16:53:58] <seanh> Yeah, what's your username?
[16:54:04] <amercader> amercader
[16:54:16] <seanh> Sadly I don't think there's any proper group management on pypi, just one by one
[16:55:30] <amercader> seanh: In roles you can add more users to it
[16:55:38] <rossjones> seanh yes, I have NO idea why.
[16:56:20] <rossjones> Maybe morty can fix it ;)
[16:57:24] <seanh> I've added amercader as an owner to all my ckan-related packages
[16:57:52] <amercader> seanh: cheers, I added a new datapusher version
[16:58:31] <seanh> What's the syntax to package search for all the datasets in a group again?
[16:58:43] <seanh> ?q=group.name:foo doesn't seem to work
[16:59:04] <amercader> q=groups:foo
[16:59:38] <seanh> Thanks
[17:00:40] <seanh> On dgu that only returns one dataset (for a group that has 34), and it's not one of the datasets in group! :(
[17:03:08] <rossjones> seanh what are you doing to my server?
[17:03:52] <seanh> The thing I actually want is an organization not a group anyway though, but searching for organization doesn't seem to work either
[17:06:37] <seanh> One day I might document the search query syntax properly
[17:07:01] <amercader> seanh: you can search orgs like this http://data.gov.uk/api/action/package_search?q=organization:department-for-environment-food-and-rural-affairs
[17:07:22] <amercader> but this returns 18 and the ckan page lists 507 (http://data.gov.uk/publisher/department-for-environment-food-and-rural-affairs)
[17:07:38] <amercader> rossjones: could thisbe because of the hierarchy thing?
[17:07:40] <amercader> ^
[17:07:49] <seanh> Hmm, yeah that's returning no results
[17:07:53] <rossjones> yes, subpublishers probably
[17:09:06] <rossjones> oh no, that's very weird.
[17:09:23] <seanh> Well, organization_show gives me all the datasets anyway
[17:10:05] <amercader> not for long :)
[17:10:14] <rossjones> you know if you want the whole thing we dump the json for everything nightly
[17:10:39] <rossjones> amercader are you building a site for DEFRA?
[17:10:55] <amercader> rossjones: no, I just picked it as example
[17:13:23] <rossjones> ah, I think out API might be very strictly limited the number of rows we return in API calls, because they get hammered.  Why we also rate limit.
[17:13:35] <rossjones> because. giant schema.
[18:44:31] <coasterz> Anyone in here go down the marc21 path. Ive been requested to investigate import marc21 data in ckan.
[18:44:54] <coasterz> I am not overly familiar with marc21, so just getting started.
[18:45:01] <pjakobsen> rossjones: no dice on the dpm , just keeps returning a Not Authorized error even though I have the right API key configured etc.

[10:18:45] <rossjones> when you call group_create, it returns the output of group_dictize - when you call package_create you get the output of group_show.  Should groups not act the same as packages in this respect?
[10:19:00] <rossjones> I mean package_create => package_show
[10:20:29] <rossjones> It causes issues in new tests because the output of group_show isn't always the same as the output from group_dictize
[11:58:30] <amercader> wardi, rossjones: are you good to start the dev meeting slightly later? we are just coming off a long okf one
[11:58:43] <rossjones> sure. half hour?
[11:58:50] <rossjones> or much later?
[11:58:50] <wardi> amercader: works for me
[11:59:03] <amercader> half hour at most (I hope!)
[11:59:10] <rossjones> ok
[11:59:55] <wardi> let's say half an hour (I'll be afk)
[12:29:22] <wardi> https://plus.google.com/hangouts/_/event/cb1vmkss426lkqicj94a3amvd1c?authuser=0&hl=en-GB
[12:31:18] <amercader> rossjones: still good for you? ^
[12:31:46] <amercader> sorry, didn't see you on the call
[12:32:14] <rossjones> :D
[14:24:27] <pjakobsen> I have uploaded a dataset to the datastore at datahub.io, but the green "Data API" button doesn't show up.  Here is one of Rufus' datasets: http://datahub.io/dataset/imf-weo/resource/ea3926e3-43a8-46d0-832a-e53efd61ebb0, and here is mine: http://datahub.io/dataset/canadian-international-assistance-commitments/resource/bb78302c-5567-4617-a7b2-a9f1459cacc3
[14:25:12] <pjakobsen> Notice he has the green Data API button, but I do not.
[14:41:05] <rossjones> pjakobsen how long ago?
[14:41:23] <pjakobsen> Oh, just yesterday.
[14:41:33] <pjakobsen> I uploaded the data yesterday..
[14:41:53] <pjakobsen> Just a simple CSV file.   Could it be a templating issue?
[14:42:11] <rossjones> It doesn't look like anyone else has it active either, I wonder whether it got turned off at some point.
[14:42:50] <pjakobsen> The dataset Rufus uploaded has the button.
[14:42:54] <pjakobsen> So it is working
[14:42:59] <pjakobsen> in some cases
[14:43:08] <rossjones> I mean the thing that imports the data into the database.
[14:43:55] <pjakobsen> Right.  Does this mean that my datastore file is not available via the api?
[14:44:02] <rossjones> lemme take a look and see if the datapusher is active.
[14:44:29] <pjakobsen> rossjones: thank you
[14:46:31] <mih> If I use the api/action/resource_create-API to add new resources - should these resources automatically be added to the datastore?
[14:48:09] <pjakobsen> mih:  I think you have to include "datastore_[action]" in the call for this to happen.
[14:48:15] <mih> ...or do I have to call the datastore_create-API?
[14:48:18] <mih> alright,t hanks
[14:48:27] <pjakobsen> mih: you might like this :  http://okfnlabs.org/blog/2014/09/11/data-api-for-data-packages-with-dpm-and-ckan.html
[14:50:30] <rossjones> So, there;s no datapusher running on datahub, which normally gets uploaded files, calls datastore_* API to insert the data - I can only assume that dpm is doing this itself.
[14:51:10] <rossjones> Have you tried using dpm instead of the web ui?
[14:52:41] <pjakobsen> rossjones: No, but that was going to be my next step.  Or I could use a python script I suppose
[14:53:21] <pjakobsen> rossjones: so no datapusher available via web interface, is that a bug or a feature?
[14:53:49] <rossjones> pjakobsen it's a lack of time thing rather than a bug/feature.
[14:53:50] <pjakobsen> I have non technical people who want to upload data
[14:54:16] <pjakobsen> rossjones: If I install my own version of CKAN 2.3 would this feature be available, or is it a plugin?
[14:54:25] <rossjones> Unless anyone who knows CKAN from OKF wants to do it, it'll be a few days till i get to it.
[14:54:38] <rossjones> Yes, if you install your own, the docs will tell you have to set up the datastore.
[14:54:45] <rossjones> It'll be either master or 2.2.x
[14:55:23] <pjakobsen> OK...thank you for looking into this.  I'll try dpm now and let you know.
[15:03:53] <rossjones> pjakobsen good luck.
[15:23:24] <kvlahroMEI> hi there
[15:23:39] <kvlahroMEI> I wonder if anybody can help me in understanding the ckan roadmap?
[15:23:52] <kvlahroMEI> So are there plans/scheduls on a 2.3  release?
[15:24:47] <wardi> kvlahroMEI: latest is https://lists.okfn.org/pipermail/ckan-dev/2015-January/008536.html
[15:25:03] <amercader> seanh: I'm looking at https://github.com/ckan/ckan/pull/2145
[15:25:25] <kvlahroMEI> ah
[15:25:55] <seanh> Cool
[15:26:03] <amercader> when you say that it requires a new version of datapusher and that is backwards incompatible, it's basically that in here `status.task_info.error` used to be a string and now is the dict right>
[15:26:05] <amercader> ?
[15:26:29] <amercader> or are there other incompat changes in dtapusher?
[15:26:33] <kvlahroMEI> ok so I guess it will be out at Feb or something like that
[15:27:10] <seanh> amercader: Yes
[15:27:24] <seanh> That's right, and there are no other incompatible changes
[15:27:28] <kvlahroMEI> great, as we need to migrate/jump from an 1.8.x release, so I guess we will wait and take the 2.3. :-)
[15:28:10] <amercader> seanh: first thing I got testing this was an error because I was using the old datapusher
[15:28:19] <wardi> kvlahroMEI: preditions are hard, especially about the future :-)
[15:28:30] <wardi> *predictions
[15:28:55] <amercader> I wonder if we should a quick check on tatus.task_info.error and show old style errors as well
[15:29:29] <amercader> otherwise do we have a way of ensure that people is using ckan against the correct datapusher version?
[15:29:38] <seanh> Hmm
[15:29:49] <kvlahroMEI> not a problem, but we did some customizations and IMHO it would be wise to restart from a clean base
[15:30:09] <seanh> All CKAN Service Provider apps currently report the same version number in their API (0.1, it's hard-coded in CKAN Service Provider)
[15:30:19] <kvlahroMEI> BTW does anybody know about the Hamburg folks? At the 31C3 talk they mentioned some customizations that should go upstream?
[15:30:30] <seanh> That's something that needs fixing, then we would have a way for CKAN to check the DataPusher version potentially
[15:31:10] <seanh> I think the easiest backwards compat fix we could do is if error is a string just display it, or if it's a dict do the new behaviour
[15:31:31] <amercader> seanh: yeah, that's what I was thinking
[15:31:56] <kvlahroMEI> ok, bye bye!
[15:32:00] <kvlahroMEI> cya
[15:38:06] <seanh> You almost want the actual status dicts themselves from datapusher to be versioned
[15:38:15] <seanh> CKAN stores them in its own db, I think
[15:38:42] <seanh> So even if CKAN is running against datapusher 2.0 now, doesn't mean it was that version when a particular job status was retreived
[15:39:14] <seanh> So you might want the job status dicts to have a top-level "version" key with their own version number (or just the datapusher's version number)
[15:39:21] <amercader> good point
[16:00:29] <rossjones> wardi you mentioned group_create returning just the ID when return_id_only=True in context.  Did you have a particular place you thought should use that?
[16:01:35] <wardi> not in context, in data_dict
[16:01:46] <rossjones> it's in context for package_create :(
[16:02:04] <wardi> that's lousy, we should fix that too
[16:02:20] <rossjones> I shall, whilst I'm here.
[16:02:35] <rossjones> I'm not two PRs deep in trying to get a simple feature in DGU :)
[16:02:40] <rossjones> s/not/now/
[16:02:59] <wardi> oh.. it's hard to put it in the data dict because all the other values are there :-/
[16:03:30] <rossjones> gah.
[16:03:38] <wardi> __return_id_only :-(
[16:03:45] <rossjones> I'll add a third dict to all the action methods!
[16:03:49] <rossjones> j/k
[16:07:33] <rossjones> in context, except for group_list, it's in data_dict there.
[16:07:50] * rossjones thinks he should go get some alcohol.

2015-01-12
[14:43:43] <rossjones> Anyone know how the autocomplete works on the front-end?  if I want to use title rather than name in the dropdown?
[14:43:43] <rossjones> For group lookup
[14:43:43] <rossjones> I hate JS.
[14:55:07] <wardi> IIRC it's using api v2 to get completions
[14:56:21] <wardi> but we've overridden all that in our templates, so I don't get much chance to use it
[15:01:05] <rossjones> We seem to have two ways of doing autocomplete, the application.js stuff and the data-module stuff :(
[15:02:08] * rossjones has a little cry
[17:26:21] <wardi> amercader: welcome back!
[17:26:36] <amercader> wardi: thanks :)
[17:27:03] <rossjones> been on holidays amercader ?
[17:27:26] <amercader> rossjones: yes, a slightly longer xmas break
[17:29:37] <rossjones> well deserved :)
[17:30:31] <wardi> indeed
[17:46:33] <travis-ci> ckan/ckan closed-organizations e9775b5 http://travis-ci.org/ckan/ckan/builds/46753887 Ross Jones: The build was broken.
[19:28:59] <travis-ci> ckan/ckan master 2052628 http://travis-ci.org/ckan/ckan/builds/46764698 joetsoi: The build has errored.

2015-01-11

2015-01-10

2015-01-09
[08:58:21] <rossjones> wardi re:queues, harvest uses celery with redis/rabbit I think
[08:58:24] <rossjones> and QA.
[08:58:55] <rossjones> QA Tasks and Mail delivery seem like obvious places to try and fix as well.
[09:00:20] <rossjones> And kindly had a wiki entry for something that might use it as well - https://github.com/ckan/ckan/wiki/CKAN-Transformations
[14:32:14] <amln> hur. http://kotaku.com/coding-conference-postponed-because-one-direction-ruine-1678376514 (DjangoCon)
[18:05:55] <hannes3> hi, i feel completely lost as a user who "just" wants to query a ckan api for packages
[18:06:07] <hannes3> the api is http://suche.transparenz.hamburg.de/api/3/
[18:06:43] <hannes3> i am not even sure what documention applies but the ckan docs i looked at were more for ckan developers i think, i found no examples
[18:07:13] <wardi> hannes3: ckanapi action package_list -r http://suche.transparenz.hamburg.de/
[18:07:36] <wardi> then ckanapi action package_show id=<one of those names>
[18:08:14] <wardi> or from the web http://suche.transparenz.hamburg.de/api/3/action/package_list
[18:08:33] <hannes3> i would like to use curl or wget. right now i would just like to get a list of all packages that have "extras_registerobject_type=baugenehmigungen"
[18:08:38] <wardi> and .../package_show?id=<one of those names>
[18:08:56] <hannes3> ultimately i would like to see the contents of the field extras.number for each of those packages
[18:09:32] <wardi> package_search would let you get just the packages with that value in that one field
[18:11:00] <wardi> I think http://suche.transparenz.hamburg.de/api/action/package_search?q=extras_registerobject_type:baugenehmigungen
[18:11:30] <hannes3> ah!
[18:13:46] <hannes3> that just gives me 10 results though
[18:16:44] <wardi> you can page with start=10 ... the args here are the same for the api http://docs.ckan.org/en/latest/api/index.html#ckan.logic.action.get.package_search
[18:18:16] <hannes3> thanks!
[18:29:33] <hannes3> ok, i got my search queries working now. :)
[18:29:55] <hannes3> can i specific which fields it should return or will i always get the whole data? can i specify other formats than json?
[18:33:31] <hannes3> there is a typo on http://docs.ckan.org/en/ckan-2.2/api.html "sucess"
[18:44:50] <wardi> at the moment you get all the fields, and only json. pull requests welcome :-)
[18:45:24] <amln> sean's extension will allow specifying what fields to pull though...
[18:45:37] <amln> (client couldn't work with all the data, hence that being built)
[18:45:41] <hannes3> thanks
[18:46:00] <hannes3> i will just do something clientside to turn it into something i am comfortable working with ;)
[18:46:01] <amln> https://github.com/ckan/ckanapi-exporter
[18:46:32] <amln> https://github.com/ckan/losser may be less CKAN-y.
[18:48:01] <amln> hannes3: on the typo, the source is https://github.com/ckan/ckan/tree/master/doc/api : as wardi sez, "PRs welcome"
[18:48:42] <hannes3> it's 10s for one of you, minutes for me ;)
[18:52:42] <hannes3> no idea how to install that ckanapi-exporter without pip, pip fails either on unicodecsv (python3) or trying to write to my /usr directory
[18:52:44] <hannes3> i give up
[18:52:49] <hannes3> thanks for the suggestions though

2015-01-08
[15:16:55] <joet> Apologies, won't be in the dev meeting today I'm going to be on in transit
[15:17:46] <wardi> joet: thanks for the reminder, I almost forgot there was one
[15:59:30] <wardi> https://plus.google.com/hangouts/_/event/cb1vmkss426lkqicj94a3amvd1c?authuser=0&hl=en-GB
[16:05:35] <wardi> rossjones: ^
[16:05:46] <wardi> meeting anyone?
[16:06:17] <wardi> seanh: ^
[16:18:18] <rossjones> wardi, sorry am supply-chain today.
[16:19:19] <wardi> am supply-chain?
[16:19:52] <rossjones> more than one job, do supplychain thurs+fri
[16:20:17] <wardi> ah. anything interesting?
[16:20:38] <wardi> building a product?
[16:22:12] <rossjones> Mostly just fire fighting stuff already in production.
[16:22:49] <wardi> what's it built in?
[16:22:57] <rossjones> python mostly
[16:23:00] <rossjones> django
[16:23:17] <rossjones> a bit of twisted
[16:24:15] <wardi> denisz is working on a ckan webhooks extension and it looking at tornado to to the message sending
[16:24:30] <wardi> I know twisted better than tornado myself
[16:33:07] <rossjones> Have used tornado too, they're both 'ok'.
[16:33:17] <rossjones> webhooks extension would be nice.
[16:34:54] <wardi> yeah, it would really open up what you could do with ckan (and in any language you happen to like)
[17:36:17] <denisz> async python is a slight pain, but only because most libraries you usually depend on are not built to be non-blocking
[17:36:29] <denisz> so you can't use your favourite things
[17:40:07] <wardi> weird. why do the answers on stack overflow about making a request from tornado say to use threads?
[17:45:50] <denisz> that's nonsense
[17:46:00] <denisz> tornado has an async http client built in
[17:46:09] <denisz> the tihng i'm making is easy
[17:46:18] <wardi> yeah.. yay stack overflow
[17:46:21] <denisz> i meant more in general, building bigger things in async python
[18:16:11] <rossjones> denisz your thing is just IO though right? Get a request, make a request?
[18:18:06] <denisz> rossjones essentialy yes. it just sends out requests on ckan's behalf so that ckan doesn't get blocked
[18:18:36] <denisz> because everything in ckan needs to happen within the request-response context
[18:30:16] <rossjones> yeah, sound good.
[18:32:28] <wardi> rossjones: we were talking about queues that already exist with ckan, are you aware of anything other than the harvester and ckan service provider?

2015-01-07
[18:01:21] <amln> aye, minecraft wednesday used to involve few people in the office on thursday morning at $JOB-2
[18:05:22] <seanh> Did you see the videos of Notch's new house? :)
[19:03:49] <seanh> https://github.com/ckan/ckan-service-provider/compare/fix-example-app
[19:04:02] <seanh> That's CKAN Service Provider running with the factory/blueprint approach
[19:05:05] <seanh> It makes it all so much more comprehensible, the API is now: myapp = ckanserviceprovider.web.CKANServiceProvider(__name__); myapp.register_synchronous_jobs(func_1, func_2); myapp.register_asynchronous_jobs(func_3, func_4); myapp.run()
[19:05:28] <seanh> If you throw away my app and then make a myapp2, there's no global or shared state between the two objects
[19:05:40] <seanh> Tests are completely independent from each other
[19:05:57] <seanh> This is quite a big change so I might ask someone to review it, I'll tidy it up some tomorrow first though
[19:06:15] <wardi> is flask.current_app.job_types bad?
[19:06:28] <seanh> I don't think so
[19:06:52] <seanh> current_app is a magic variable, refers to the app object for the current http request (or "app context")
[19:08:00] <wardi> ok, I just thought I read something about that being an old way of doing things when I was skimming the flask docs
[19:08:01] <seanh> Actually if your two app objects use the same config setting for the DB URL, then they'll have the DB contents as shared state. But that's easily reset, just db.drop_all()
[19:08:10] <seanh> Hmm, I didn't see that

[09:32:23] <razz0> Hi. I'm curious if there has been any discussion among CKAN developers about using an RDF triple store like Fuseki for dataset metadata instead of a relational DB?
[09:32:33] <razz0> This approach would be useful ie. for using ontologies, multiple language support for dataset metadata and would allow for more dynamic dataset structure.
[09:50:22] <ntoll> good morning... there doesn't appear to be an API method for deleting / purging my news feed. I have a lot of entries for when I deleted a bunch of (now purged) datasets...
[09:55:01] <rossjones> ntoll you mean activity?
[09:55:34] <ntoll> rossjones, I dunno... I try to avoid CKAN internals and only work via the plugin system, but from looking at the database tables, I'm guessing yes
[09:55:34] <rossjones> http://docs.ckan.org/en/latest/maintaining/configuration.html?highlight=config#activity-streams-settings
[09:55:53] <ntoll> rossjones, that's global
[09:56:01] <ntoll> rossjones, I want to delete all the activity relating just to me
[09:56:19] <rossjones> https://github.com/ckan/ideas-and-roadmap/issues/new
[09:56:21] <ntoll> although ckan.activity_list_limit looks interesting
[09:56:25] <ntoll> rossjones, :-)
[10:05:47] <amln> ntoll: there is a ticket somewhere for creating an ability to hide the activity stream, too.
[10:06:04] <ntoll> right
[10:06:05] <ntoll> also
[10:06:15] <ntoll> I got bitten by this:
[10:06:15] <ntoll> https://dba.stackexchange.com/questions/73136/cant-list-users-select-from-user-returns-only-one-row-with-one-column
[10:06:23] <ntoll> ;-)
[10:07:04] <ntoll> this was not an obvious problem and I was left thinking wtf for about 5mins
[10:07:15] <ntoll> select (id, name, apikey) from "user" where name='ntoll';
[10:07:22] <ntoll> (note the use of double quotes)
[10:07:47] <ntoll> although this is probably something Postgres could/should address
[10:10:37] <rossjones> ntoll it's a function, I doubt they could remove it now without breaking stuff
[10:10:50] <ntoll> right
[10:10:54] <ntoll> c'est la vie
[10:11:37] <ntoll> tbh, I've not been working with raw SQL for about 6 years (ORM make you so lazy/forgetful) so I'm actually having a lot of fun remembering...
[10:12:01] <ntoll> I <3 my relational algebra / db theory classes back in the day
[10:12:55] <rossjones> similar problem with select * from group;
[10:13:00] <ntoll> yeah
[10:14:53] <rossjones> ntoll one thing to remember if you're updating stuff in ckan db, that there is normally a _revision table to match the table you are editing that will also need editing.
[10:15:08] <ntoll> rossjones, right... so I've discovered ;-)
[10:15:33] <ntoll> but is that the case with activity
[10:16:34] <ntoll> also, why is there an activity and activity_detail table..? Many (most) of the col names are the same.
[10:17:55] <rossjones> ntoll dunno.
[10:18:07] <ntoll> rossjones, I was afraid that might be the answer ;-)
[11:27:50] <seanh> ntoll: They are an unused feature
[11:27:59] <seanh> Each activity can have one or more activity details
[11:28:19] <seanh> For example activity "seanh updated the dataset foo" might have activity details like
[11:28:23] <seanh> changed title to bar
[11:28:28] <seanh> added tag x
[11:28:30] <seanh> etc
[11:28:39] <ntoll> seanh, kk
[11:28:51] <seanh> So you could have a page or something in activity streams that says actually what changed for an activity
[11:28:59] <seanh> But we never actually made use of this
[11:29:14] <ntoll> ok... so how is the "edits" count derived (on a user's page)..?
[11:29:26] <seanh> From revisions probably
[11:29:31] <ntoll> ahh
[11:29:38] <ntoll> so how are revisions linked to users..?
[11:29:41] <seanh> Oh and activities do not have revisions, they're two separate systems
[11:29:53] <ntoll> yeah, I found that out ;0-
[11:30:30] <ntoll> there's an "author" entry
[11:30:44] <seanh> I'm not sure how revisions are linked to users, I've managed to mostly avoid revisions all this time
[11:30:51] <ntoll> ok
[11:30:56] <ntoll> by username (not user id)
[11:31:01] * ntoll just looked
[11:31:55] <seanh> Oi, so I can't just put the job function registries on the flask app object's config
[11:32:10] <seanh> The object is created at run time by a factory function
[11:32:36] <seanh> But the job decorators are executed at import time and try to write to the registries, flask app doesn't exist yet
[11:40:51] <seanh> CSP's whole approach of having a dict that is a "registry" for job functions that are registered by putting a decorator on them is problematic
[11:41:41] <seanh> There's no way to have one test module register a few job functions and test an app with them, then another test module register different job modules - whichever test module runs second will still have the job functions from the first one registered
[11:41:57] <seanh> Because they're written to a global dict by decorator functions that run at import time
[11:42:22] <seanh> And if you empty out the dict after test methods, it will not get filled again (because it only gets filled at import time)
[11:42:41] <seanh> Decorators on functions run at module import time, once only. That's the fundamental trouble with this
[11:54:25] <seanh> People in #pocoo are saying just make a flask.Flask subclass with the job functions registry dict as a property of the class. Then the pattern is: construct the app object, add your functions to its registry dict, run it. No decorators. Might give that a try
[14:07:53] <wardi> seanh: sounds simple enough
[14:08:18] <seanh> Been trying to get it to actually work for a couple of hours! :)
[14:08:34] <seanh> There's a lot of state and initialisation that needs to move into the new Flask subclass now
[14:08:36] <wardi> seanh: if you register to a "service" object that sits in the module you can group all the functions for a single service though
[14:08:59] <seanh> But what's the advantage of that?
[14:09:59] <wardi> razz0: do triples represent multiple languages now? i couldn't figure that out earlier
[14:11:13] <wardi> seanh: then you can register all the functions associated with a single service with one call
[14:11:41] <wardi> it's the same thing, just packaged a little differently
[14:12:53] <seanh> Yeah I see what you mean
[14:14:08] <seanh> So that way I could still use a decorator. In my jobs.py: create global "job function registry" object, and on each of my job functions put @my_job_function_registry.async decorator. Then at app construction time, register the job function registry object with the app
[14:14:36] <seanh> But it'll take mue
[14:14:57] <seanh> me a while to get there, moving the stuff into a class has made all the tests fail in millions of bizarre ways
[14:15:48] <wardi> yeah, I think when you say "job function registry" it's the same as when I say "service"
[14:16:37] <razz0> wardi: you can have multiple label triples, each with a different language attribute
[14:20:32] <wardi> razz0: ah, ok, I think I have seen that in SKOS
[14:21:20] <wardi> razz0: changing the internal representation would mean breaking most of ckan and its extensions. We could build better rdf import/export though.
[14:23:34] <wardi> razz0: I'm working on extensions that handle multilingual metadata and custom schemas. I would like them to enable their best rdf representions for export at least
[14:26:46] <razz0> wardi: Yes, it would a huge change and take a lot of work, but I think the result would have many benefits.
[16:09:06] <seanh> Woohoo! Got the (existing) csp tests passing with a new app factory / blueprint approach
[16:09:20] <seanh> Now got to get my new tests for the example app passing at the same time, but that should be easier
[16:09:34] <seanh> There shouldn't be any global state now, unless I missed something
[16:10:19] <wardi> seanh++
[16:55:05] <rossjones> in ckan/ckanext/datapusher:DatapusherPlugin it's triggered on every resource url change which is valid (csv, xls, etc).  There's no way to control which resources may not be wanted in the datastore, say by organisation, or some specific type of dataset - anyone any ideas how we could provide that to the plugin?
[16:55:30] <rossjones> I really just want it to have a callback function, but ....
[17:17:06] <birdspider> exit
[17:34:38] <seanh> Hmph, got an sqlalchemy error from my example app tests, it's trying to delete a db table that doesn't exist for some reason, traceback originates from threading.py :(
[17:40:30] <rossjones> ouchy
[17:40:52] <rossjones> I have a healthy but possibly irrational fear of python threads.
[17:41:22] <wardi> fearing threads is rational
[17:42:13] <wardi> threads mean you need to understand much more of the project code before you can reason about how it works
[17:44:01] <rossjones> plus how concurrency works, why you need semaphores and mutexes and locks and how to handle re-entrancy and other painful stuff.
[17:44:10] <rossjones> Not necessarily Python's fault, the model is broken :)
[17:45:44] <wardi> threads are good for a kernel and device drivers
[17:47:23] <rossjones> not even sure if they're used much there, at least in linux - been a long time but most drivers were processed in a 'bottom-half' at a later time in response to an IRQ
[17:47:37] <rossjones> things might have changed in the last 12 years :)
[17:49:48] <rossjones> ah they use clone (non-process fork).
[17:49:52] <rossjones> interesting.
[17:49:58] <rossjones> anyway ... no more threads!
[17:50:22] <rossjones> laptop is apparently required for minecraft .. sigh .... ttfn
[17:50:27] <wardi> ah, neat
[17:59:04] <amln> wardi: what, "minecraft, not work time"
[17:59:29] <wardi> minecraft is serious business

2015-01-06
[17:49:12] <seanh> So what to do about ckanserviceproviders job registries? Basically it has two global dicts web.sync_types and web.async_types, and two decorators that add functions to these dicts job.sync and job.async (yes, the dicts are defined in web.py and the functions that work with them are in job.py, all of csp is like that)
[17:49:29] <seanh> They can't remain as globals or tests stomp on them
[17:50:05] <seanh> I could move the dicts to the context-global (i.e. thread-global) object flask.g
[17:50:46] <seanh> But when you define a function at module level with an @job.sync decorator, that decorator function is run at module import time which is not during an http request so it crashes because flask.g isn't available
[17:51:14] <seanh> Flask uses it blueprint pattern to get around the same problem with flask's own @app.route decorator
[17:51:35] <seanh> But these job registries are ckanserviceprovider things not flask things
[17:52:29] <seanh> One option would be: simply define your job functions without a decorator, then at startup time (when there is a request) call a function directly to register them
[17:52:34] <wardi> they should move into a csp object of some kind
[17:52:58] <wardi> the jobs should be collected into a "service" object that lives in their module
[17:53:18] <wardi> then the user registers service objects with a csp object they create
[17:53:29] <wardi> s/user/application or test
[17:54:08] <seanh> Yeah, that seems sensible
[17:54:23] <seanh> So ckanserviceprovider itself would not have any service object (it would just define the class)
[17:54:28] <wardi> right
[17:54:51] <seanh> Tests and examples would define their test and example job functions, add them to a service object, register the object with the flask app
[17:54:57] <seanh> And a real app like datapusher, the same
[17:55:55] <seanh> But my problem is ultimately where to register these service objects
[17:56:09] <seanh> I don't think you can just store objects against the flask app object
[17:56:41] <seanh> And I can't put them on flask.g either, unless I make sure there's a request before I do that
[17:56:42] <wardi> won't csp be a blueprint or something?
[17:58:04] <seanh> What I have in csp now is a blueprint where the routes are registered, and a factory function that returns a flask app object (after doing loads of config to it, including registering the blueprint)
[17:58:38] <seanh> In a test I can call that factory function to get an app, but I don't think that means I have anythong to store an arbitrary variable against
[17:59:00] <seanh> I could put it in the app object's config, I guess, but it's not really "configuration"
[17:59:20] <wardi> seems like you would want to register services with the blueprint instance, then you could have multiple csps with different sets of services served from the same flask app (if someone was to inclined)
[17:59:44] <seanh> Hmm, I'll take a closer look at blueprints, see if they can do that
[18:00:17] <seanh> So far I'm only using a blueprint because it seems to be the only way to register routes without having the app object be a global
[18:00:21] <wardi> or make a function that generates a blueprint with a set of services? not sure what the normal thing is
[18:01:34] <seanh> I think the normal thing is a views.py module containing your route functions and a module-global blueprint object, then in __init__.py you have a factory function that makes a flask app, registers the blueprint(s) on it, returns it
[18:02:37] <seanh> So the blueprint object is global, it has to be because you're gonna have view functions defined at module level using the @my_blueprint.route decorator, but that doesn't seem to any harm as the blueprint is (so far) just a place to collect route functions in
[18:04:45] <seanh> This is what I don't like about flask. How to initialise the wsgi app in a testable way should be a problem that your web framework solves for you, not a puzzle that it leaves for you to solve yourself (badly)
[18:04:55] <seanh> Anyway, let's see what else blueprints can do
[18:05:30] <seanh> There should just be One Right Way to initialise the wsgi app is what I mean, I think
[18:11:15] <SkramX_> seanh: any ever run into ckanapi-exporter only exporting the first 1k results?
[18:11:22] <SkramX_> im running it on hub.healthdata.gov whose homepage says 1698 datasets but my csv has 1001 rows (including header row)
[18:11:35] <seanh> Hmm. I still don't see anywhere for storing arbitrary state except flask.g or app.config. There is a @before_first_request decorator (both app objects and blueprint objects have it) that lets you define a function that flask should run before the first request on an app, I think flask.g may be available then so I could use that to add stuff there
[18:12:33] <seanh> Trying to decide between trying to get at flask.g that way or just using app.config
[18:12:56] <seanh> SkramX_: It should return the first 1000000: https://github.com/ckan/ckanapi-exporter/blob/master/ckanapi_exporter/exporter.py#L18
[18:13:14] <seanh> healthdata.gov may have hard-limited the num of results package_search() returns
[18:13:37] <seanh> exporter doesn't support making multiple requests to get all the datasets, that could be added though
[18:13:53] <SkramX_> gotcha
[18:13:57] <wardi> ckanapi dump datasets calls package_show on each to avoid this sort of thing
[18:14:46] <SkramX_> maybe i need to use that
[18:15:21] <seanh> That might take a long time though
[18:15:31] <wardi> not really
[18:16:00] <wardi> you might run afoul of rate limiting though
[18:16:32] <seanh> Hmm, exporter is already using ckanapi, maybe it should just be changed to call dump datasets instead?
[18:16:33] <SkramX_> let's see!
[18:17:26] <SkramX_> i just got my columns.json file the way i wanted it
[18:17:31] <SkramX_> anyway to run that code on a JSON file, seanh?
[18:18:35] <seanh> If you have all your datasets in a json file, just override exporter's get_datasets_from_ckan() function with a function that json.loads() your file and returns it
[18:18:46] <seanh> exporter doesn't have a command line option or anything for it
[18:19:09] <seanh> But its entire interaction with the ckanapi happens in that one function
[18:19:53] <wardi> would be nice if you could pipe from ckanapi to exporter
[18:21:43] <SkramX_> except ckanapi puts each dataset on a line as opposed to an array
[18:22:00] <SkramX_> not sure how ckanapi exporter will like that...
[18:22:33] <seanh> I'm pretty sure a csp app's list of registered job functions isn't "configuration" (it's always going to be the same for the same app, and doesn't come from the user or the environment in any way). But storing it against app.config looks like it would work and it a lot simpler than getting it against flask.g
[18:23:05] <wardi> seanh: then it's per-app not per-blueprint, but that might be fine
[18:23:18] <seanh> Can't ckanapi dump datasets to json?
[18:23:26] <wardi> it dumps to json lines
[18:23:49] <seanh> Is json lines valid json?
[18:23:49] <wardi> no
[18:24:01] <wardi> well, in the case of 1 record yes
[18:24:04] <wardi> :-)
[18:24:44] <seanh> Well, all you would need is a function to parse the json lines and ultimately return all the datasets as a list of dicts, then exporter could use them
[18:24:55] <wardi> or read them one at a time and avoid using up all your ram
[18:25:58] <seanh> exporter doesn't support not using up all your ram :)
[18:26:34] <SkramX_> you guys are funny
[18:26:47] <seanh> Though I suppose all it's doing is writing csv to stdout, so you could just call it again and again for each 100 datasets, it would be oblivious but the output might still be valid csv
[18:27:05] <seanh> Might output multiple header rows though, and pretty printing would break
[18:28:01] <seanh> Oh, it's time to stop working. Later!
[18:30:42] <wardi> I should write a json lines to json converter
[18:33:49] <SkramX_> im just doing it with find and replace in a text editor :\
[18:33:54] <SkramX_> well, im trying to ;)
[18:34:16] <SkramX_> i might need help getting ckanapi-exporter to use my json file.. mind helping, wardi?
[18:35:04] <wardi> python -c "import sys; print '['+(','.join(l for l in sys.stdin)).rstrip(',')+']'"
[18:36:44] <wardi> ^ that should convert json lines to json
[18:38:14] <SkramX_> thanks wardi
[19:32:45] <coasterz> Hi all, I really hate to ask this, but is anyone aware of ckan being used with google search appliances ?
[19:34:05] <wardi> coasterz: I'd expect it to just work.. is there a problem you're seeing?
[19:35:18] <coasterz> No problems, I was just informed that GSA appliances will be used on the drupal side, and asked to investigate
[19:36:13] <coasterz> I feel they are seeking to replace Solr
[19:37:13] <wardi> nothing wrong with that
[19:37:48] <wardi> you won't be able to remove solr, but letting users search with GSA seems reasonable
[19:38:54] <coasterz> That is what I was thinking, use the GSA for indexing etc, but Solr must remain.
[19:40:27] <wardi> I was wondering about the other direction: making a combined drupal+ckan solr index
[19:40:35] <wardi> probably won't get to that for a while though
[19:48:53] <coasterz> Thanks wardi, I will need to dig deeper into the intended use of the appliance.
[19:49:37] <amln> coasterz: i've heard of interest in using GSAs with ckan, but everyone we've spoken to has gone a bit quiet.
[20:02:47] <coasterz> amln: Thanks. I will discuss further with my team on the intentions. If replacing Solr is the actual goal, can I safely say that is not happening ;)
[20:06:50] <wardi> coasterz: not without significant ckan code changes and an incompatible API
[20:07:37] <coasterz> Thank you, that was my initial response, just wanted to confirm ;)

[01:42:58] <tomkralidis> hi, for CKAN search results (say, against the API), if the client request does not specify a sort field/order, is there a default sort applied?
[11:28:37] <rossjones> Anyone interested in a team meeting today?
[11:58:31] <wardi> yup
[11:59:06] <wardi> https://plus.google.com/hangouts/_/event/cb1vmkss426lkqicj94a3amvd1c?authuser=0&hl=en-GB
[12:01:27] <wardi> rossjones: ^
[12:02:11] <wardi> brook: ^
[12:29:47] <rossjones> https://github.com/ckan/ideas-and-roadmap/issues/118
[13:23:40] <joet> anyone ever had trouble overriding an extensions template from another extension?
[13:24:25] <joet> Annoyingly it works locally but not in production, I've been fiddling with the order they are listsed in the config with no joy. There must be some magic I am missing.
[13:25:38] <joet> http://docs.ckan.org/en/latest/maintaining/configuration.html#ckan-plugins suggests I should load the plugin with the template I want overridden after.
[13:30:00] <seanh> This is what I'm working on now for ckan service provider: https://github.com/ckan/ckan-service-provider/compare/fix-example-app
[13:30:07] <seanh> Got to eliminate some global state to get the tests passing
[13:35:41] <Zharktas> joet: i was fiddling other day with plugin order to override template of another extension
[13:36:11] <Zharktas> apparently the overriding plugin needs to be first that the super() calls are called in right order
[13:41:19] <joet> yeah, that was what I  thought as well, but I'm having no joy whatever order I have the plugins listed as. This is only in production as well, so I'm assuming there is some minor tweak that I've over looked
[13:55:03] <joet> annoyingly it works whatever order I put the plugins locally. So basically, blllllaaaarrgh.
[15:03:05] <wardi> joet: I tried to make that doc match the behaviour I was seeing wrt template override order
[15:04:11] <wardi> the big problem I had was related to having multiple plugins in the same module
[15:05:08] <wardi> joet: try printing out your templates dir config value on each system
[15:09:32] <seanh> The trouble I'm dealing with in ckan service provider right now has a lot to do with just doing what the flask docs tell you to do
[15:09:37] <seanh> http://flask.pocoo.org/docs/0.10/quickstart/#a-minimal-application
[15:10:11] <seanh> That hello world example has a global mutable object initialised at module scope and accessed by if __name__ == '__main__'
[15:10:39] <seanh> And the route function - there's no way to pass shared state or config into it, unless you just put it in more global objects and then just access them (which is what csp ended up doing)
[15:13:38] <joet> cheers wardi / Zharktas, it turned out to be a minor thing as I thought, ckanext-pages rendering a different template depending on whether it decided what type of 'page' it was, either 'page' or 'blog' similar to the way our groups/orgs worked
[15:14:54] <wardi> seanh: that's a script not a module
[15:15:16] <wardi> it would be bad to write a module that way
[15:15:47] <seanh> Right, but the flask docs tell you to write your whole web app in one script file like that
[15:16:01] <wardi> do they? isn't this just a simple example?
[15:16:26] <seanh> Well I'm reading through them now, but at least as far as the quick start goes they do
[15:16:41] <wardi> http://flask.pocoo.org/docs/0.10/patterns/packages/
[15:20:01] <seanh> That's right at the end of the docs though, and I'm not trying to write a large application, just a testable one without global state that persists between tests
[15:20:16] <seanh> I'll see what else they say about it, anyway
[15:29:17] <wardi> csp should provide a flash blueprint (I think) not an application object
[15:29:35] <wardi> s/flash/flask
[15:31:20] <seanh> And this will be where csp's various other globals come from: http://flask.pocoo.org/docs/0.10/tutorial/setup/#tutorial-setup
[15:32:21] <seanh> I've been thinking of csp as a lib, but in some ways it's more of a framework. The user (e.g. datapusher) provides the actual Python functions that are the tasks/jobs, but csp defines and implements the API and all the endpoints and params etc
[15:33:02] <seanh> So if you want to find the datapusher api docs, you actually have to go to the ckan service provider docs! Which is a little odd since datapusher is the app, and csp is just a lib or framework that it uses
[15:39:03] <joet> rossjones, do you mind if I add a block around https://github.com/ckan/ckanext-disqus/blob/master/ckanext/disqus/templates/package/read.html#L4 ?
[15:40:15] <joet> so another ext can override and have, for example recent comments instead
[15:43:07] <rossjones> joet erm, sure, why would I mind?
[15:43:19] <joet> dunno i thought you were vaguely responsible for ckanext-disqus
[15:43:25] <rossjones> no no no
[15:43:27] <joet> or perhaps you just mentioned it earlier
[15:43:40] <joet> ha
[15:43:41] <rossjones> those two words don't get mentioned in the same sentence as me.
[15:43:51] <rossjones> the v and r words.
[16:08:09] <seanh> Ah, this looks like what I want: http://flask.pocoo.org/docs/0.10/patterns/appfactories/
[16:24:11] <SkramX> i want to download a CKAN catalog's metadata for each dataset to CSV
[16:24:25] <SkramX> any built in way to do that or code snippet or do i need to do it myself?
[16:25:20] <wardi> SkramX: https://github.com/ckan/losser
[16:25:46] <wardi> sorry https://github.com/ckan/ckanapi-exporter
[16:28:27] <SkramX> wardi: thanks.. but i have to create my own columns.json? :\
[16:28:54] <wardi> SkramX: which columns do you want?
[16:29:17] <wardi> you can pass them as options it seems
[16:31:16] <SkramX> i mean it looks like you have to define each collumn
[16:31:32] <SkramX> not too hard -- ill try this out, thanks!
[16:36:34] <seanh> It should have a default "just export all dataset fields as columns" option but it doesn't yet
[17:03:44] <davidmiller> Question: How can I purge all datasets from an org in one command ?
[17:03:58] <davidmiller> (There are 3k && /ckan-admin/trash gives me a gateway timeout)
[17:11:27] <rossjones> davidmiller pull request :)
[17:12:51] <wardi> davidmiller: ckanapi action package_search ... | jsontool .. | while read id; do paster dataset purge "$id"; done
[17:12:51] <ntoll> cheers rossjones ;-)
[17:13:40] <ntoll> wardi, right... that's what we've found so we're just going to spoof the http post to the ckan-admin/trash endpoint ;-)
[17:14:15] <ntoll> in the hope that we don't have to write a script that does exactly what the controller does
[17:14:23] <rossjones> ntoll write a paster command?
[17:14:35] <davidmiller> rossjones: You want a PR to provide this new gateway timeout functionality to everyone ?
[17:14:44] <rossjones> davidmiller it's only fair.
[17:14:53] <rossjones> can;t keep all the best features to yourself.
[17:14:56] <ntoll> rossjones, I believe you just told me to go fuck myself ;-)
[17:15:15] <rossjones> ntoll politely i thought.
[17:15:24] <ntoll> rossjones, you're always a gentleman
[17:15:26] <ntoll> :-)
[17:16:02] <rossjones> are you using 2.3?
[17:16:13] * amln did see https://medium.com/backchannel/i-work-i-swear-a649e0eb697d earlier
[17:17:28] <rossjones> oh, there;s no package_purge to match organization_purge in actions ...
[17:20:48] <wardi> yeah, we should have that
[17:21:03] <wardi> sysadmin-only purge actions
[17:23:20] <rossjones> ntoll you want to keep the organization about too?
[17:23:27] <ntoll> nope
[17:23:35] <rossjones> paster group purge?
[17:24:19] <ntoll> rossjones, is there such a command?
[17:24:37] <rossjones> hahahaha. no.
[17:24:41] <rossjones> omg. hang on.
[17:24:42] <ntoll> :-(
[17:24:53] <rossjones> *headdesk*
[17:24:58] <ntoll> nope
[17:24:59] <ntoll> there isn't
[17:25:28] <rossjones> we have an api for organization_purge, but not for dataset_purge - and the paster commands are the opposite. sigh
[17:26:01] <rossjones> /api/3/action/organization_purge?id=myorg - no doubt it'll time out.
[17:27:04] <ntoll> rossjones, will that not just delete the org but not the datasets?
[17:27:12] <ntoll> or is there a cascade delete going on here ;-)
[17:27:28] <ntoll> y'know referential integrity and all that ;-)
[17:27:32] <wardi> hmm. why isn
[17:27:40] <rossjones> ntoll who knows what it'll do. It might, it might not, it might set your computer on fire.
[17:27:42] <wardi> t that in a purge.py file
[17:27:57] <rossjones> i think purge is on domain_object
[17:28:22] <ntoll> wardi, I wish it were in a purge.py file ;_)
[17:28:31] <ntoll> is there a purge.py file
[17:28:34] * ntoll has a look
[17:29:12] <wardi> no, it's in delete.py so I didn;t notice it
[17:30:00] <rossjones> wardi maybe we should fix the paster command by having them use LocalCKAN() so that way we can find out what api calls are missing :)
[17:30:12] <rossjones> s/paster command/cli.py
[17:30:31] <wardi> rossjones: big +1 on that
[17:31:14] <wardi> then we'll have ckanapi in requirements.txt :-)
[17:31:22] <rossjones> ntoll are you using master?
[17:31:33] <wardi> and no leaking contexts
[17:31:43] <ntoll> rossjones, latest stable ckan
[17:32:46] <rossjones> ntoll if you add a ticket that'd be cool, and if you can wait for morning I'll provide you a paster command you can use until it's all fixed properly
[17:32:54] <rossjones> in your extension
[17:33:17] <rossjones> it won't take long, but it's beer o'clock
[17:33:25] <ntoll> sure
[17:35:47] <rossjones> ntoll cool, I'll give you a shout in the morning
[17:35:49] <rossjones> ttfn
[17:35:52] <ntoll> ttfn

2015-01-05
[18:05:07] <wardi> it datapusher had an object with a register_service_jobs() method, we could just create a new object for each test
[18:05:16] <seanh> The exact same thing appears in lots of places in CKAN, lists and dicts where things get reigstered and never removed
[18:06:13] <seanh> Yeah
[18:06:38] <seanh> Because also if I make it empty those dicts after a test, they will not get filled again by the new test, since they're filled on module import
[18:21:35] <seanh> So by adding a new test module (and not changing the production code at all) I've created several failing tests in the pre-existing test modules!

[08:57:19] <Zharktas> Is it possible to change organization id from anywhere or do I have to make the change in database directly ?
[09:29:28] <rossjones> Zharktas you need to change it in group and group_revision table, and then if it is in use also the member, member_revision tables.  If it has datasets, you need to update package.owner_org as well (and probably package_revision.owner_org where current=true).
[09:29:49] <rossjones> Zharktas assuming you mean the guid id.
[09:49:44] <Zharktas> rossjones: yup. https://github.com/ckan/ckan/issues/2183 made issue about it too why I actually need to change it
[09:51:51] <rossjones> Zharktas sounds like either, we shouldn't let you set the ID in organization_create, or ensure it looks like an ID, and when checking names in organization_update, make sure we check the ID as well as name.
[09:51:56] <rossjones> sigh
[09:52:14] <rossjones> Suspect not letting you set the ID is the correct behaviour in create.
[09:55:21] <Zharktas> that would be much easier than fix this production database which is now confused :p
[09:57:35] <rossjones> Zharktas could you check my comment on https://github.com/ckan/ckan/issues/2183 is an accurate reflection?
[09:57:57] <rossjones> Have vague recollection of wardi having something to allow changing of IDs, but I am not sure if it was related (my memory sucks).
[09:58:18] <rossjones> Zharktas short term, would stop ever passing ID to organization_create.
[10:08:40] <rossjones> Zharktas I've assigned it to myself, will take a look when I'm doing work on core tomorrow unless someone else gets there first.
[10:08:51] <Zharktas> I might get a little easier with just deleting the problemous organization from our db and creating them again without risk of making the db even worse
[10:10:15] <rossjones> probably safest route. You'll probably need to purge it too, assuming purging is implemented for groups.
[10:15:55] <Zharktas> docs say that purging organizations is not implemented, so i have to clean the database anyway
[10:29:45] <rossjones> sigh.
[10:32:12] <rossjones> organization_purge and group_purge exist in 2.3
[10:33:41] <Zharktas> and 2.2 apparently, docs are just wrong :p
[10:34:28] <Zharktas> eg. this http://docs.ckan.org/en/latest/sysadmin-guide.html#permanently-deleting-datasets
[10:39:09] <rossjones> USODI are going to pay someone to tidy up the admin stuff in the web UI. Which'll be nice.
[10:48:47] <Zharktas> deleting the mangled organization, purging and creating it back without the custom id fixes our problems in production too :)
[10:53:05] <rossjones> yay
[11:43:42] <rossjones> ugh group_dictize bug.  it's possible to pass in a group object instance that does not have access to a property defined in models/group.py:Group :(
[11:44:00] <rossjones> i.e. sometimes you can call group.display_name, sometimes you can't.
[12:50:42] <rossjones> seanh are you working today? FactoryBoy is a bit broken and don't know best way to fix my issue.
[12:57:42] <seanh> rossjones: Yeah I'm here
[12:57:45] <seanh> What's the issue
[12:58:30] <rossjones> I am calling group.display_name in an action function. Works in webui and old tests, fails with factoryboy.
[12:58:50] <rossjones> Think it is because it is @property
[12:59:50] <seanh> So this is a new *_create() action, and you're writing a new factory class that calls it?
[13:08:51] <rossjones> Nope, using the group factory.
[13:09:42] <rossjones> when the test calls organization_create it tries to call group.display_name, which no longer seems to exist.  I think factoryboy is performing some magic.
[13:11:23] <rossjones> Would like to avoid replacing the display_name property with a function call, but looks like it might be the least magical approach
[13:19:47] <seanh> Hmm
[13:19:55] <seanh> Can I see the code and error somewhere?
[13:20:16] <seanh> Factory boy shouldn't be magic, it should just be calling group_create() like normal
[13:27:01] <rossjones> http://pastie.org/9814196
[13:27:58] <rossjones> Could not locate column in row is a sqlalchemy error.
[13:37:36] <amln> hum, just seen http://users.isc.org/~each/dev.html for BIND . Quite a nice doc.
[14:36:52] <wardi> bind has some interesting security history
[14:46:10] <seanh> rossjones: I think I need to see the code
[14:47:19] <seanh> This is interesting, in a ckanserviceprovider app like datapusher you havr a jobs.py module that defines your job functions and registers them with @ckanserviceprovider.job.async. Then in your main.py you import your jobs.py, and ckanserviceprovider magically knows about your job functions because of the decorators
[14:47:22] <rossjones> seanh lemme push my branch and I'll show you the line that breaks. it's literally just the one at the top of the pastie.  I've worked around for now until I can find out what's happening
[14:47:46] <seanh> But then in test.py if I import main.py, the jobs don't get registered, even though main.py imports jobs.py
[14:47:58] <seanh> I have to import jobs.py directly in test.py as well
[14:48:05] <rossjones> :( That sucks
[14:48:28] <rossjones> which do you reckon is wrong, having to do it in tests or the way decorators are used?
[14:48:46] <seanh> Ah, this is an __init__.py thing
[14:49:03] <rossjones> so you can just import the module?
[14:49:13] <wardi> I don't like side-effects of importing modules
[14:49:19] <seanh> You have to actually import datapusher.main, import datapusher isn't enough
[14:49:49] <wardi> that sort of thing is not obvious at all
[14:50:21] <seanh> Yeah it is kind of non-obvious
[14:50:43] <seanh> On the other hand the using decorators to register things pattern is an established one
[14:51:28] <seanh> Both flask and pyramid use it to route urls to handler functions, for example
[14:51:29] <wardi> but they use decorators on an object you create
[14:51:36] <wardi> not some magic global somewhere
[14:51:51] <wardi> s/on/from
[14:52:36] <seanh> These are decorators on functions you create: https://github.com/ckan/ckan-service-provider/blob/master/example/jobs.py#L7
[14:54:06] <wardi> I would prefer:  jobs = ckanserviceprovider.ServiceJobs()
[14:54:06] <wardi> @jobs.sync
[14:54:06] <wardi> ///
[14:54:30] <wardi> then the user would register all the jobs using that object with a separate call they make explicitly
[14:55:25] <rossjones> wardi likes jobs.add_async( my_imported_func ) ?
[14:55:41] <rossjones> or do you mean stlll with the decorators?
[14:56:28] <wardi> rossjones: no, the decorator adds all the functions to a ServiceJobs object then you register that set of jobs with a single new function call
[14:57:09] <wardi> that way a module can say "here are all my jobs" and the user is in charge of which ones will actually be registered
[14:57:31] <rossjones> got it
[15:04:20] <seanh> Oh dear https://github.com/ckan/ckan-service-provider/blob/master/ckanserviceprovider/web.py#L242
[15:04:49] <seanh> It has a version number string of "0.0.2" in setup.py, but the /status URL is hardcoded to report "version": 0.1 (as a floating point number)
[15:05:12] <seanh> This also means that apps built on top of ckanserviceprovider like datapusher are all hardcoded to report version 0.1 as well
[15:07:51] <seanh> I really think there was confusion about whether csp was an app or a lib
[16:42:54] <rossjones> Can anyone think of a sane reason why organization_create should accept and id field for custom ids? wardi did you not need this for something?
[16:43:27] <wardi> rossjones: I just added the ability for sysadmins to set dataset ids without a plugin
[16:43:51] <wardi> and I do use the ability to set org ids
[16:43:58] <rossjones> oh.
[16:44:08] <rossjones> that's a shame.
[16:44:24] <wardi> for me it's nice for dumping orgs+datasets and loading them in another instance
[16:44:39] <rossjones> Sure, it's easy to break though - https://github.com/ckan/ckan/issues/2183
[16:44:40] <wardi> (datasets reference the org id not name)
[16:45:20] <rossjones> At the moment you can provide anything you want in the id field to organization_create
[16:46:44] <wardi> we should be handling all the id/name stuff the same way across datasets and orgs. i suspect we aren't
[16:49:53] <wardi> how about we prevent users from using names or ids that exist as names or ids in the db?
[16:51:17] <rossjones> yeah, seems like a workable approach if we need to be able to set ids
[16:53:41] <rossjones> wardi we're good to make setting IDs in create sysadmin only though I guess?
[17:01:29] <wardi> for sure
[17:02:39] <wardi> ok, will add a comment to #2183
[17:09:07] <rossjones> thx. will claim it during call tomorrow unless anyone else really wants it :)
[17:53:59] <seanh> I'm just writing tests for the example app in ckanserviceprovider. Got a tests that asserts that the error message is "do not ...". Test passes when running just that test module. Try to run all test modules at once, error message becomes "Do not ..."
[17:59:12] <seanh> It's because both the example app and one of the other test modules register a job function called echo(), the functions are almost exactly the same but slightly different capitalisation of error messages
[17:59:26] <seanh> And the job function registering is not reset between test modules
[18:00:10] * wardi mumbles something about magic and globals modified on import
[18:01:31] <seanh> If you're writing a web app you should always provide simple setup() and reset() functions that can be called repeatedly and that setup and reset everything
[18:01:50] <seanh> Otherwise you get problems in tests, and trying to graft that  functionality on later can be hard
[18:01:59] <seanh> CKAN itself has a real bad case of this as well
[18:02:13] <wardi> or put your state in an object you can throw away and recreate any time
[18:03:29] <wardi> writing reset() function can be really hard sometimes
[18:03:38] <seanh> Yeah
[18:04:28] <seanh> In thise case we have a couple of module-global dicts that the functions are registered in
[18:04:39] <seanh> 1. Use a class and an object, then you can make it complain about overwriting registered functions
[18:04:46] <seanh> 2. Global variables!

2015-01-04

2015-01-03

2015-01-02

2015-01-01

2014-12-31
[10:17:51] <rossjones> I'm going through dread's minor PRs and reviewing them fwiw.  Then maybe next Tuesday's meeting won't be too scary.
[10:20:48] <rossjones> They're all pretty small and unintrustive
[10:34:33] <nigelb> heh
[10:38:49] <rossjones> unfortunately non of them remove VDM
[10:45:43] <nigelb> I don't think that counts as small and unintrusive
[10:47:46] <rossjones> It'd be my fave PR ever though.
[17:25:38] <wardi> rossjones: I think we need revisions, just they should be json blobs in a single table that could be purged any time, not copies of every table that has revisioned data
[17:26:25] <wardi> although IIRC amercader said he finds it useful to select across revisions.. so that might not work

2014-12-30
[06:49:49] <Zharktas> are there any other plugins for dataset commenting except disqus ?
[09:07:57] <rossjones> Zharktas not complete ones.
[09:08:07] <rossjones> Although the disqus one does have sso now.
[09:08:41] <Zharktas> might implement my own then since we can't use disqus
[09:10:54] <rossjones> I started one a while back, but never finished because we ended up carrying on with Drupal's commenting.
[09:11:41] <rossjones> and checking, it's still using genshi :( So probably not much use to you - sorry.
[10:22:01] <trickvi> do we have some sort of an architectural overview diagram from ckan?
[10:22:31] <trickvi> or is it just rtfc (read the fu**ing code) for newcomers? :)
[11:03:00] <rossjones> trickvi wardi started to document the data model, https://github.com/ckan/ckan/issues/2053, but that's it afaik
[11:04:20] <trickvi> thanks rossjones
[11:05:25] <trickvi> wardi: can I use this when describing the ckan architecture?
[11:05:43] <trickvi> it's not the code archiecture but I think this helps
[15:01:14] <rossjones> Time for my daily wtf.  WTF!
[15:01:17] * rossjones feels better
[15:02:54] <nigelb> rossjones: what part of ckan code were you reading?
[15:03:40] <rossjones> nigelb what gave it away/
[15:03:57] <nigelb> rossjones: that's when I WTF too.
[15:04:09] <nigelb> (Wordpress is an exceptional csae)
[15:04:29] <nigelb> I keep saying "CKAN is the Wordpress of open data". Its true in more ways than one.
[15:04:33] <rossjones> In this case it's just me trying to avoid having to change 3 extensions and core for the tiniest of features :(
[15:04:41] <rossjones> nigelb :D
[15:05:30] <rossjones> My brain is still rebooting after holidays.
[19:21:10] <wardi> trickvi: use away. i want to update the user graphic. some people say it looks like a lady with a beard
[19:21:57] <wardi> there's another diagram amercader made that is mor internal-architecture
[20:06:35] <wardi> trickvi: there's also this diagram, that's probably in the wrong place in the docs http://docs.ckan.org/en/latest/contributing/python.html#imports
[20:47:05] <trickvi> thanks wardi
[20:47:33] <trickvi> I liked the user graphic fwiw

2014-12-29
[09:10:43] <trickvi> oh fun, slayershackteam just "hacked" the icelandic ckan instance
[09:10:59] <trickvi> I think it's time to update the defaults
[10:35:38] <rossjones> trickvi do you know how?
[10:35:49] <rossjones> wardi I know you love VDM really.
[10:36:47] <trickvi> rossjones: installing with the defaults allows users to create a user via the web and instantly create new datasets
[10:37:02] <trickvi> I'm guessing someone has scripted the registration process
[10:37:16] <trickvi> and then is being douchy and pretending to have hacked the site
[10:37:50] <trickvi> easily fixed by changing the defaults to only allow for dataset creations as part of organisations
[10:38:29] <trickvi> so I'd say we should change the defaults to organisation based flow that can be changed to allow anyone to submit instead of the other way around
[10:39:36] <trickvi> I'll open an issue instead of discussing this here
[10:43:50] <rossjones> trickvi great, seems like a sensible approach and should be easily changed.
[10:45:30] <trickvi> done https://github.com/ckan/ckan/issues/2164
[10:46:23] <mih> the "slayershackteam" also hacked "our" ckan-instance. and it seems, several other ckan-instances also...
[10:46:42] <trickvi> mih: yeah that's them :)
[10:46:48] <trickvi> irritating stuff
[10:47:01] <trickvi> but reflects badly on ckan for no good reason
[10:47:12] <rossjones> :(
[10:47:20] * rossjones went through this with datahub.io :(
[10:47:33] <rossjones> >20k spam datasets, was no fun.
[10:48:07] <trickvi> rossjones: yeah I don't know how to get around this for public instances where you don't have a single authority to create organisations
[10:48:17] <trickvi> (although the datahub might now)
[10:48:30] <rossjones> no, datahub still has manual org creation.
[10:48:49] <rossjones> Haven't come up with a cleaner way to let people create their own orgs yet.
[10:50:55] <trickvi> yeah I just updated the ticket to suggest we disallow users from creating orgs and groups
[13:48:32] <rossjones> If you have an extra that is a boolean, you can't unset it if you're using a checkbox.  This is a bug, right?
[13:49:47] <Zharktas> checkboxes arent submitted at all in html forms if they are unchecked
[13:49:55] <Zharktas> which is still dumb
[13:53:48] <rossjones> Zharktas sure, but the absence *should* be the thing that unsets it.
[13:54:00] <rossjones> at least as far as ckan schema/forms are concerned.
[13:59:57] <rossjones> I probably need a false_if_missing instead of ignore_missing
[14:10:51] <rossjones> Notice that package_create gets around this with ```private``` by using a dropdown :(
[14:16:28] <wardi> trickvi: +1 on changing default permissions
[14:19:12] <wardi> rossjones: my extras get cleared if they aren't passed to package_update, and checkboxes seem to work
[14:19:53] <rossjones> wardi not working for me on groups :( I must be missing something in my schema, do you have a link to yours?
[14:21:09] <wardi> oh, on groups? i suspect some 'partial update' magic then. never finished sceming my orgs
[14:21:40] <rossjones> I was hoping everything would be magically fixed by the time I came back off holiday.  Must have been too many cocktails :)
[14:22:32] <wardi> partial update certainly never worked with datasets and i think i managed to remove most of that code from datasets
[14:24:28] <wardi> i hope to visit the group/org code, and maybe even users, in the 2.4 time frame
[14:24:38] <rossjones> so late 2015 ;)
[14:25:25] <wardi> if you say so :-)
[14:26:13] * rossjones shrugs
[14:32:14] <rossjones> hmm, I have bigger problems, our schema is being called twice to validate it :(
[14:53:13] <wardi> rossjones: not just once in form-to-db direction and once db-to-form?
[14:53:45] <rossjones> my debug output in my modified boolean_validator was being called twice on the way in, I think.
[14:53:51] <rossjones> My brain is still in holiday-mode.
[14:54:29] <rossjones> Think I've solved it by my boolean_validator (copy of the one in core) also handling Missing.
[19:13:26] <rossjones> dread just found a breaking test in master if you have celery installed, SkipTest() sucks.

2014-12-28

2014-12-27

2014-12-26
[18:17:19] <ahoppin> hi all, happy holidays!  I just heard that one of the -dev calls was moved to 4pm GMT for those of us in the US- could someone pls point me to the full meeting / calendar details-- thanks!

2014-12-25

2014-12-24

2014-12-23

2014-12-22
[15:24:32] * wardi glares at vdm

2014-12-21

2014-12-20

2014-12-19
[11:23:42] <mih> anyone here ;-)?
[11:31:44] <rossjones> mih hi, got a problem?
[11:32:02] <rossjones> or just after our scintillating company? ;)
[11:37:04] <mih> not really a problem; I am trying to call package_create and would like to add dataset's extras through PHP -- the extras should be defined as "list of dataset extra dictionaries". I am doing this through, e.g. $extras =  array(array("value"=>$value), array("key"=>$key)) (tried also $extras =  array("value"=>$value), array("key"=>$key))
[11:37:30] <mih> However, this seems not to work for the dataset's extras
[11:39:23] <mih> any ideas how it is possible to implement this through PHP? - otherwise I will switch to python (in this case, I have to reimplement the code to python)
[11:52:06] <Zharktas> mih: would it be easier to use json_decode and give it some json like extras: [{"key": foo, "value": bar}, {"key": baz, "value": zip}]
[11:55:46] <mih> not my preferred solution, but it is definitively worth a try - thank you! ;-)
[11:56:34] <Zharktas> or just look what kind of structure it actually decodes in php ;p

2014-12-18
[15:58:31] <wardi> who's up for a meeting?
[15:59:05] <seanh> Nothing better to do
[16:00:37] <wardi> https://plus.google.com/hangouts/_/event/cb1vmkss426lkqicj94a3amvd1c?authuser=0&hl=en-GB
[16:02:31] <wardi> bad connection day for me. I can take notes
[16:35:37] <amercader> https://github.com/ckan/ckan/blob/master/ckan/model/meta.py#L77
[16:36:56] <wardi> happy holidays!

2014-12-17

[07:15:51] <messi> i install ckan from source on my CentOS server successful
[07:16:25] <messi> after that i integrate wordpress into this ckan but it's failed
[07:17:01] <messi> Can you guys help me how to integrate wordpress into ckan
[07:17:59] <messi> i follow this http://ckan.org/2011/04/04/wordpresser-extension-released/
[07:19:26] <Zharktas> i don't use wordpress but that is 3 years old blog post, so I doubt that it would actually work with ckan 2.0+
[07:29:58] <messi> Zharktas: which is CMS you are using now?
[07:30:40] <Zharktas> we are using drupal, which also is pretty terrible
[07:33:53] <messi> thanks, do you have guide integrate drupal into ckan?
[07:34:20] <messi> could you please share me this
[07:51:54] <Zharktas> https://github.com/ckan/ckanext-drupal7 we are using this but i don't have guide to use it
[07:54:01] <messi> thanks Zharktas
[07:54:38] <messi> this work with CKAN 2.2.1
[07:54:40] <messi> ?
[07:54:49] <Zharktas> yes
[07:56:01] <messi> ok, thanks
[12:19:05] <amercader> would love people views on this, specially those who have played with the new resource views on master: https://github.com/ckan/ckan/issues/2140#issuecomment-67309881
[13:48:21] <wardi> seanh: do you know why the datapusher extension is in core but the datapusher service is a separate package? Don't you think they would be better together?
[13:49:16] <seanh> No idea
[13:49:44] <seanh> The extensions needs to be installed on the same server as ckan, the service doesn't, so they don't belong together
[13:50:03] <seanh> Then I guess they decided the extension was crucial enough to become a "core" extension
[13:50:11] <seanh> Maybe it's even enabled by default?
[13:50:41] <wardi> aren't they tightly coupled though? a change to the datapusher api would require a change to ckanext/datapusher
[13:51:03] <seanh> amercader: Do you remember anything about a fix to allow free extras to be used at the same time as custom fields using convert_to_extras?
[13:51:13] <seanh> wardi: Yeah
[13:51:18] <wardi> if they were part of the same package we could tell users "install the same version in both places"
[13:51:34] <wardi> instead of "find the right version for the version of ckan you're running"
[13:52:12] <seanh> The two components might have different dependencies though
[13:52:39] <wardi> seanh: the free extras thing is merged, but I haven't tried it yet
[13:52:52] <rossjones> Random thought, if we supported webhook notifications for new/updated etc, could we remove the need for a lot of these tiny plugins that just call a service? on resource create, call webhook, service comes to get details.
[13:53:02] <seanh> Wondering if it went into 2.2.1?
[13:53:05] <wardi> seanh: so someone might install some extra packages if they run them on separate servers. doesn't seem like much of a cost
[13:54:05] <seanh> rossjones: The plugins also do something with the data that the service provides. Displaying the status log and any errors from datapusher for example. Same with doa
[13:54:13] <wardi> seanh: i think it's an api change too big for a bugfix release
[13:54:56] <rossjones> seanh ah right, I hadn't realised that
[13:55:56] <seanh> But generic webhooks might be a good idea though, there might be multiple service plugins that could make use of them
[13:56:00] <amercader> seanh: https://github.com/ckan/ckan/pull/1894
[13:56:12] <amercader> seanh: 2.3 but no 2.2.x
[13:56:24] <seanh> Thanks
[13:58:11] <amercader> wardi: the datapusher ext in core is a proper ckan extension (ie requires ckan) so it makes sense to keep it together
[13:58:44] <wardi> amercader: sorry, are you arguing that all extensions should be included with ckan itself?
[13:58:46] <amercader> as for tightly coupled, the datapusher ckan ext talks to the actual datapusher using the ckan service provider spec (http://ckan-service-provider.readthedocs.org/en/latest/)
[13:59:39] <amercader> wardi: no, I'm saying that you will need ckan installed if you want to run, and that it doesn't make much sense to force ckan on the server that you have actual datapusher installed
[14:00:05] <wardi> a package can be a ckan extension without forcing the user to install ckan
[14:00:29] <wardi> a ckan extension is just a bunch of setuptools entry points
[14:01:11] <seanh> It is awkward developing all these different components separately and keeping htem in step with each other. But hopefully the protocols between them will become more stable (especially if a little more thought is put into it) then we can change one component without changing the others
[14:02:06] <seanh> The CKAN Service Provider spec really doesn't guarantee loose coupling. For example datapusher jobs just return results or errors as dicts serialized to json and then deserialized on the other end by the datapusher extension
[14:02:25] <seanh> Change the keys, values or structure of those dicts and ckan will crash
[14:06:24] <wardi> I'm thinking that ckanext/datapusher and datapusher could just be "ckanext-datapusher" which includes the csp part and the ckanext part, either or both could be used but if used separately the same versions should be used
[14:07:53] <seanh> Looking at the csp docs, potential coupling comes from: the names of the job types available, the data and metadata params passed to /job, the data and error dicts returned by /job/<job_id>
[14:08:30] <wardi> that would also make it easier for someone to write a competing implementation of "let's put that uploaded data into the datastore"
[14:12:52] <seanh> wardi: BUt what if we want to make datapusher ckan independen
[14:12:57] <seanh> independent?
[14:13:14] <seanh> If your site implements this datapusher api, then datapusher can parse data and push it at you
[14:13:43] <wardi> ok, still call it 'datapusher' but just include the matching ckan extension
[14:13:59] <seanh> Maybe
[14:14:27] <seanh> Would you have two different requirements files in the one ckan package then? One for datapusher and one for ckanext-datapusher
[14:14:53] <wardi> I don't put ckan in my ckanext-* projects requirements, do you?
[14:15:03] <wardi> I thought that was implied :-)
[14:16:07] <wardi> ok, or another option is have datapusher and ckanext-datapusher and tell the user that they should be the same versions (easier to get wrong, but doesn't tie datapusher to the ckan release at least)
[14:19:18] <seanh> It's not so much the CKAN dependency (though CKAN may well be needed to run the tests for a ckanext, so in the requirements-dev), it's just that ckanext-* may have a different set of requirements than service-*
[14:23:10] <wardi> right, and I don't think installing a few things you might not need for the specific way you're using a thing is a big deal
[14:24:10] <wardi> ar at least less of a problem than dealing with versioning interfaces between something very large (ckan) and something that's smaller and should be able to be developed a little more quickly
[14:27:04] <seanh> Hmm, yeah I can see the benefit
[14:27:49] <seanh> Another problem you might have though is setup.py vs requirements.txt
[14:28:10] <seanh> For example deadoralive uses setup.py iirc b/c that's what's most suitable for it (makes installing easier)
[14:28:10] <wardi> what's the problem?
[14:28:34] <seanh> But ckanext-deadoralive uses requirements.txt because that seems more appropriate for a ckan extension
[14:29:10] <seanh> I think you would have to move it all into requirements.txt (or maybe two separate requirements files). Makes installing deadoralive harder
[14:30:05] <seanh> Right now you can just do `sudo pip install deadoralive` then run `deadoralive`, you don't need to know where the files are installed
[14:30:12] <wardi> but if they were separate (like with doa) you wouldn't have a problem, right?
[14:30:17] <seanh> If you have to pip install a reqs file, you will have to find it first
[14:30:26] <seanh> Right
[14:31:08] <seanh> But wait, separate is what we're doing now. Are you simply saying that ckanext-datapusher should not be a core extension?
[14:31:34] <wardi> yes, at least that
[14:31:57] <wardi> so it's not tied to a ckan release
[14:32:54] <seanh> I see
[14:33:02] <wardi> I'll make an ideas ticket and we can argue it there
[14:33:47] <seanh> Yeah that's probably a good idea. I was thinking putting datapusher and ckanext-datapusher into one Python package or at least one git repo would be even more convenient for development, but it might make deployment more difficult
[14:34:59] <wardi> that's totally possible, just have two setup.py files (or call setup() twice in the same setup.py)
[14:35:23] <wardi> it might be surprising for users, though
[16:41:38] <seanh> Anyone got an idea how to efficiently get the name of the user who created a dataset, for every dataset in ckan?
[16:42:12] <seanh> Package search includes a creator_user_id but not the user name
[16:42:44] <seanh> Would have to call user_show() for every dataset, and it looks like user_show() calls package_show() for each of the user's datasets
[16:42:46] <wardi> make a userid->username dict?
[16:42:57] <seanh> I could cache a a user_id -> display name dict
[16:43:23] <seanh> Or I could write my own faster user_show() in my plugin
[16:43:36] <seanh> That's gonna be simpler, don't need a command or anything to pregenerate the cache
[16:43:39] <wardi> or fix our user_show :-)
[16:45:28] <wardi> include_the_stuff_i_dont_care_about=False
[16:54:30] <rossjones> seanh there's a PR waiting for feedbck from wardi to remove the user_show nastiness
[16:54:59] <rossjones> dread reviewed it but then pushed some changes, think he just wants a once-over to double-check
[16:58:00] <rossjones> seanh other option is check the packagerevision ?
[19:23:41] <wardi> rossjones: right, I'll look at that

2014-12-16
[19:07:32] <wardi> because guessing is bad and if it's in datapusher that's easier to for me to ignore
[19:07:51] <seanh> sqlalchemy's DataError's docs just say "wraps dbapi DataError", and dbapi's docs says DataError is: Exception raised for errors that are due to problems with the processed data like division by zero, numeric value out of range, etc.
[19:08:04] <wardi> and isn't the guessing already in datapusher?
[19:08:36] <seanh> So I think I'm just gonna catch that and return some error message like "There was a problem with the data: numeric value out of range, etc" for now
[19:08:45] <seanh> Guessing is currently in both places, I think
[19:40:46] <seanh> This is how far I got: https://github.com/ckan/ckan/pull/2145#issuecomment-67218239
[19:59:55] <travis-ci> ckan/ckan improve-datapusher-error-messages 75957ff http://travis-ci.org/ckan/ckan/builds/44245158 Sean Hammond: The build was broken.

[09:38:08] <mih> general question: when you are developing for CKAN, do you use an IDE or just - like me (at the moment) - shell?
[10:02:17] <rossjones> mih shell
[10:32:05] <seanh> Vim, with YouCompleteMe and Syntastic which are both very helpful. I think I'd kind of like a good IDE though, I keep thinking of switching to PyCharm
[10:34:15] <Zharktas> i've been using intellij idea, which is basically pycharm with extra features
[10:51:02] <rossjones> "docstring of ckan.logic.action.get.user_show:13: ERROR: Unexpected indentation." <-- I hate whoever added this.
[10:56:53] <rossjones> Turns out it is actually a missing : after the param name
[10:57:01] <rossjones> an hour later :(
[11:09:58] <seanh> rossjones: So if you had committed that, your docstring would have been rendered incorrectly on docs.ckan.org
[11:10:21] <seanh> We used to have hundreds of such problems in the docs and i had to go through and fix them all, and then people just kept adding more
[11:10:24] <rossjones> It was more that the error didn't really reflect the problem :)
[11:10:27] <seanh> That's why that's there
[11:10:44] <rossjones> Was indenting like crazy :)
[11:32:52] <seanh> rossjones: Ah right, hmm yeah it's not the best. rst syntax is just complicated and hard to remember, even regardless of error messages
[11:34:11] <rossjones> I'm over it now :) I'll know next time.
[12:01:58] <wardi> https://plus.google.com/hangouts/_/event/cb1vmkss426lkqicj94a3amvd1c?authuser=0&hl=en-GB
[12:03:07] <rossjones> seanh ^ ?
[12:46:26] <rossjones> And then I discover I don't actually have tobes email address :( Do you have it seanh?
[12:47:41] <seanh> Yeah I'll pm it to wardi
[12:48:30] <rossjones> Thx
[12:58:49] <rossjones> There's nothing more disheartening than getting through 1700 tests and then failing because of a pep8 violation.  Is it possible to have the pep8 test run first?
[13:03:33] <seanh> You might be able to use the nose plugin to affect the order?
[13:04:11] <seanh> You could also use a tests command (wrap it in a script or alias) that runs just the pep8 tests then runs all the tests
[13:04:39] <rossjones> latter might be easier.
[13:22:21] <wardi> my ckan dir is littered with tests-scripts, including testpep8.sh
[13:57:40] <rossjones> heh
[13:58:48] <rossjones> We are removing number_administered_datasets in favour of number_created_datasets  - what did we decide about the dashboard?  Currently have it showing the created datasets for the user - is that too big a change, should they still see datasets they can administer?
[14:02:12] <rossjones> If can't really be different than what the API returns though I think
[17:00:16] <rossjones> Any objections to me adding labels for Easy/Medium/Hard so we can label the Good for contribution tickets?
[17:00:44] <wardi> sounds good to me
[17:01:31] <wardi> with appropriate colours :-)
[17:01:44] <rossjones> I think github just autochose them.
[17:02:01] <rossjones> When I typed in easy the next colour was red, and then after that it autochose organge.
[17:02:20] <rossjones> I am flabbergasted or something.
[17:02:59] <wardi> you can change them (I remember setting "technical debt" to brown)
[17:05:59] <rossjones> Now I need to add the labels and work out whether stuff is actually easy or hard.
[17:09:40] <rossjones> It'd be nice if you could see from the issues list which ones had PRs attached too
[17:09:42] <mih> ;) hehe, thanks
[17:10:57] <rossjones> mih I'd steer clear of anything that has a commit attached to it, it means someone is already working on it.
[17:11:05] <rossjones> in theory
[17:17:19] <rossjones> if you're feeling really brave, https://github.com/ckan/ckan/blob/master/ckanext/stats/stats.py could do with a re-write.
[17:27:47] <seanh> Argh, there seems to be one intermittently failing datastore tests
[17:29:18] <seanh> But also I added new code to have datastore's db.py raise an exception, and then the datastore_create() action catches that exception and raises a toolkit.ValidationError (which ends up returnin an error dict to the api call)
[17:29:19] <rossjones> is it this problem with 8.3 again seanh ?
[17:29:24] <rossjones> ah no.
[17:29:43] <seanh> Test passes fine when run on its own, then run all the datastore tests at once and something else ends up throwing some other exception instead?
[17:30:27] <rossjones> :(
[17:30:46] <rossjones> I've had a horrific day with tests and pushing the wrong thing to a PR.
[17:30:57] <rossjones> let's just delete all the tests, we'll all be much happier
[17:31:40] <seanh> I need to debug the action
[17:31:54] <seanh> Normally I'd put a stacktrace in there and run the test
[17:32:15] <seanh> But the problem only happends when I run *all* the tests, and the action is called hundreds of times
[17:33:08] <rossjones> is that running with --reset-db
[17:33:21] <seanh> Yeah
[17:33:46] <rossjones> ow.
[17:45:21] <seanh> If I put in stack traces the test passes
[17:45:32] <seanh> Remove them again and it fails again :)
[17:45:42] <seanh> I think it's a case of tests affecting other tests, once again
[17:46:02] <rossjones> what a nightmare
[17:46:26] <seanh> Third set of tests like this, in the datapusher fixes for 2.3
[18:58:10] <seanh> This is the error message we get from sqlalchemy when datastore tries to put the value "   " into a cell in a numeric type column: https://gist.githubusercontent.com/seanh/9b62745737d3ea7f5b1d/raw/97b814f862e1e6b74ab489098713a191e58b6a98/gistfile1.txt
[18:58:32] <seanh> We just get a sqlalchemy DataError with no real info in it except that error message
[18:58:50] <seanh> (And it's formatted like that - with all the \n's and indentation)
[18:59:01] <seanh> I'm wondering what to do with this
[18:59:14] <seanh> It's a bit ugly to show to the user I think
[18:59:25] <wardi> validation in python before sending to postgres?
[18:59:41] <seanh> I could catch DataError and return something generic like "Data file contains invalid data"
[18:59:58] <seanh> wardi: Well, yes, then we could give a better error, but I consider that step 2
[19:00:06] * wardi nods
[19:01:51] <seanh> It's kind of awkward because postgres is already validating it for us bot not giving a very good error
[19:02:28] <seanh> If we add our own validation, we may say the data is good and then have postgres say it's bad (which is fine - we just fall back on a generic error based on what postgres gives us)
[19:02:43] <seanh> But we may also say the data is invalid when actually postgres would have accepted it
[19:02:57] <seanh> We're duplicating the validation, so it just seems awkward
[19:03:26] <wardi> but we can make more strict validation than what postgres gives us, and that's a good thing
[19:04:45] <seanh> I guess, yeah
[19:05:03] <seanh> Where do you think that belongs - in DataStore or in DataPusher?
[19:05:19] <wardi> datastore
[19:05:45] <wardi> unless you mean setting up (guessing) the initial validation rules, then that would be datapusher
[19:06:48] <seanh> You mean guessing the types of the columns would be in datapusher? Why not put that in datastore too?

2014-12-15

[08:24:55] <mih> is it possible to deactivate the dataproxy so that only the datastore/datapusher are used for previewing resources?
[08:30:10] <mih> furthermore, it would be interesting if the dataproxy sends requests to another services (e.g. especially google?)
[12:49:04] <mih> I have to ask again - how is it possible to deactivate the dataproxy?
[13:03:49] <mih> is it enough to remove "resource_proxy" from the plugin-list?
[13:09:59] <wardi> mih: worth trying :-)
[13:11:36] <mih> have already tried it - it's no opportunity for us, since we still want to use the pdf-preview (with datastore). pdf-preview will not work in this case
[13:36:17] <wardi> mih: I guess there are not many dataproxy users in the channel at the moment. try asking on the -dev list or stackoverflow?
[15:40:06] <seanh> What do people think - is datastore just a dumb container? Or is datapusher just a dumb transporter?
[15:40:21] <seanh> Which one of them should be responsible for validating data?
[15:41:03] <seanh> I'm thinking datastore because ultimately it has to write the stuff to the db and it may get an error back from the db - it's the only code in a position to catch and report that error
[15:41:48] <seanh> Datapusher can try to ensure that it doesn't post invalid data to the datastore, but it can't ultimately know that the datastore won't get an error when it tries to write that data
[15:42:21] <seanh> Currently I think it's more the other way round though - all the type detection, validation and error reporting code is in datapusher, and then datastore sometimes just crashes
[16:04:33] <wardi> seanh: I want datastore field validation like metadata validation
[16:04:44] <amln> seanh: in-expert view here, but (i) never trust user input; (ii) never trust developers to catch/validate, so i'd say both parts, but with an ability to push store errors to the pusher, and the pusher to the user.
[16:05:36] <wardi> because my clients see some of their stuff going into datastore and some going into metadata and think it's all the same (for example when requesting workflow changes)
[16:06:07] <wardi> seanh: I could create an ideas ticket
[16:09:10] <seanh> Currently we have type guessing in both datapusher and datastore
[16:09:24] <wardi> :-(
[16:09:37] <seanh> And validation of the data in neither as far as I've seen, if one cell's value doesn't match its column's type datastore just crashes
[16:09:39] <wardi> I create my datastore tables with types, so I've never run into that
[16:09:57] <seanh> Reporting errors to the user is messy
[16:10:16] <seanh> We have errors that come from the datapusher, e.g. it could not download the data file b/c of a 500 Server Error
[16:10:27] <wardi> we should be producing validation erros like when metadata fields are updates
[16:10:36] <seanh> And then we have errors that come from the datastore, e.g. it could not insert the data because it's invalid
[16:10:51] <wardi> but we need to reference a row and column name, so it's a little different
[16:10:51] <seanh> Yeah
[16:11:11] <seanh> I think CKAN currently asks the datapusher (not the datastore) for the error though
[16:11:19] <seanh> Not sure it supports getting errors from the datastore
[16:11:29] <wardi> we're already iterating over the data in python code I think, so it might not be much slower
[16:13:02] <seanh> So I could do 1. User adds resource to CKAN, CKAN pings DataStore. 2. DataStore gets resource from CKAN, downloads and parses data file, posts to datastore in chunks. 3 DataStore validation fails, returns error to datapusher which stores it. 4. CKAN asks datapusher for the status, gets validation error back and shows it to user!
[16:14:38] <wardi> sounds nice
[16:15:05] <seanh> That actually might be the correct distribution of responsibilities
[16:15:18] <seanh> I don't really like how job statuses are stored in both datapusher and ckan though
[16:15:48] <seanh> I don't really think they need to be stored in datapusher, it should just post the result to ckan and not save it
[16:21:36] <wardi> seanh: what are the two places those statuses are stored?
[16:22:00] <seanh> datapusher's db, and (i'm assuming) in CKAN's db somewhere as well
[16:23:30] <wardi> ckan wouldn't normally store a failed update attempt of other things.. so the datapusher might be the better place to store it
[16:24:02] <seanh> It has to be in ckan though, so ckan can display it to the user
[16:24:18] <seanh> (unless ckan fetches it from datapusher on every page load!)
[16:24:55] <wardi> it's a value that would only ever be set if the datapusher is being used, right?
[16:26:28] <seanh> I guess so, yeah. This is the asynchronous protocol between CKAN and DataPusher where CKAN asks DataPusher to push a resource, DataPusher goes and tries to do so and reports the result (successful or not) to CKAN
[16:26:50] <seanh> That little protocol is separate from the DataStore API itself, which you can use without DataPusher
[16:27:05] <seanh> The problem is very similar to the one Dead or Alive's protocol solves
[16:27:38] <mih> currently when I used datapusher, I got an error while uploading a csv-file with same column-titles (e.g. multiple columns called "test") - will this also be fixed in future?
[16:28:55] <wardi> seanh: I think I need to understand datapusher better
[16:29:59] <seanh> The problem I have right now is when datapusher sends an invalid data value to CKAN's DataStore API. Currently DataStore crashes and returns a horrible unformatted validation error from postgres to DataPusher. DataPusher essentially ignores this error, returns an even more mangled version of it back to CKAN in the job status
[16:30:04] <seanh> CKAN then displays that to the user
[16:30:09] <seanh> It's pretty funny, really
[16:30:47] <wardi> it's good to have a sense of humour about it :-)
[16:31:02] <seanh> I think I just need to 1. Make DataStore return a decent error message to whoever is using it, and then 2. Make DataPusher catch this error message properly and return it intact back to CKAN again for display to the user
[16:32:02] <seanh> Basically the error originates from PostgreSQL, gets mangled by DataStore and sent to DataPusher, which mangles it some more and sends it back to CKAN, which shows it to the user
[16:33:36] <seanh> I guess this is not that hard to fix though, but I think there's some generally design blurryness about what DataStore is meant to do and what DataPusher is meant to do, could do with clarifying one day
[16:36:33] <rossjones> +1 for a datapusher that is as stupid as possible :)
[16:37:43] <rossjones> mih I have that problem too, will be fixed when either you or I get around to fixing it I suspect unless someone gets to it in the meantime.
[16:38:08] <wardi> mih: what should it do when you have two columns with the same name?
[16:38:35] <rossjones> munge it!
[16:38:52] <rossjones> Except not sure that'll work.
[16:39:05] <rossjones> mih It is worth adding a ticket to https://github.com/ckan/datapusher/issues
[16:39:38] <wardi> how would you insert data into a table with columns with munged names?
[16:41:24] <rossjones> That's a good question :) In my case they've got a CSV with Category appearing 4 times - and I suspect it's actually several tables squashed into one.
[16:42:46] <mih> hm I don't really know the code behind datastore, but, perhaps a further mapping-table could do that (hash-columntitle <-> column-title)
[16:43:56] <rossjones> mih but what if datapusher instead renaming the second 'test' to 'test2'?
[16:44:17] <wardi> mih: I mean, what would a user pass to actually insert a value into one of the munged names?
[16:44:31] <wardi> they would need to know how to munge it on their side too
[16:51:03] <seanh> So, now let's see what the datastore tests look like, shall we?
[16:51:05] <seanh> :)
[16:52:02] <mih> would probably be faster instead of using a mapping-table, rossjones
[16:53:20] <rossjones> it would be a start if there was a useful error message so at least the csv could be fixed.  but we should definitely have a ticket for duplicate column names.
[16:56:11] <mih> I will add an issue...just a moment please ;)
[16:58:33] <rossjones> Thanks
[17:04:35] <seanh> https://github.com/ckan/ckan/blob/master/ckanext/datastore/tests/test_configure.py#L10
[17:05:05] * rossjones sobs into his cup of tea
[17:05:36] <rossjones> Maybe we should have a githook to look for FIXME and TODO in the code.
[17:07:16] <rossjones> 130 TODOs and 66 FIXMEs on my current branch :(
[17:14:35] <rossjones> Do you think it'd be sensible at tomorrows meeting to see how everyone is getting on with 2.3 PRs? And whether they need to have someone else look at them?
[17:19:49] <seanh> There's a test in here that's 250 lines long
[17:20:20] <seanh> Called "test_create_basic", no docstring
[17:23:28] <mih> rossjones: shouldn't the issue be added to the ckan-issues-list instead of the datapusher list (since datastore should cause the error)? - or would you consider the datapusher-issue-list the better option?
[17:23:52] <rossjones> errr.
[17:24:30] <rossjones> that sort of involves making a decision on where it should be fixed I suspect.  But if you're getting the error from datapusher currently, just log it there.
[17:25:39] <rossjones> If you lemme know the URL I'll add it to the list of things to discuss at tomorrows meeting so that it gets seen.
[17:39:28] <mih> rossjones: https://github.com/ckan/datapusher/issues/58
[17:43:15] <seanh> Hmm, part of the problem is that because datastore adds rows to the db hundreds at a time, it can't tell you which row or cell was invalid
[17:43:25] <rossjones> mih thanks, added to agenda
[17:43:35] <seanh> The exception from postgres doesn't contain that
[17:44:03] <seanh> It does contain the invalid value, but in the middle of a string with loads of \n's and indentation in it
[17:44:55] <seanh> I think the best we can do for a good error message from CKAN may be "There was some invalid data in rows 200-299"

2014-12-14

2014-12-13

2014-12-12
[15:45:54] <wardi> well, that's an implementation detail that the logic layer shouldn't have to know
[15:46:03] <rossjones> you're not changing the package model itself are you?
[15:46:36] <rossjones> If the convention was 'thin models' then the work would still have to be done in the action layer.
[15:46:41] <wardi> no. and that's the nice thing. "packages" from the user sent by an api call are just as good as a package that exists in the db
[15:47:17] <wardi> you mentioned the costs though, lots of conversions even when not necessary
[15:47:23] <rossjones> it's sort of why I like django, you pass the dict to a form which validates, and then it can give you a model back.
[15:47:52] <seanh> Yep
[15:48:12] <seanh> Does that couple your code to your db structure (orm objects) though?
[15:48:41] <rossjones> I don't think the costs are necessarily just in runtime costs, but added complexity of understanding what's in the dict, that people have the flexibility to add stuff to the data_dict in action layer.  For instance, you know package_show adds the package *Model* to the context?
[15:49:13] <wardi> rossjones: yeah, I don't like that
[15:49:39] <wardi> I also don't like how the harvester has to be fixed for the resourcegroups change because it's going straight to the models
[15:51:38] <rossjones> We should fix the action layer to take models, and hide the models from extensions.  Not sure how ....
[15:51:46] <rossjones> Or at least the latter.
[15:51:59] <rossjones> Which'll cause a whole world of pain on DGU, but we've gotta fix it sometime.
[15:53:07] <wardi> rossjones: I don't know if that's a good thing. it would mean we'd have to write another api layer to convert things that will be really fragile
[15:53:52] <rossjones> Yeah, you're right :(
[15:54:10] <wardi> the discomfort of using the dicts I think really helps us have a complete api
[15:54:59] <rossjones> Maybe they should be read-only going into the action layer? :P
[15:55:01] <wardi> like how my high-heeled shoes make my ass look great
[15:55:05] <wardi> hypothetically
[15:55:09] <rossjones> 8|
[15:55:56] <seanh> If CKAN had shoes the laces would be double-wrapped around itss ears and then back down again
[15:58:56] <wardi> rossjones: anyway, I'd love to have the argument when we have some time at the end of a dev call
[16:00:54] <seanh> https://github.com/ckan/ckan/pull/2143
[16:01:01] <seanh> See if Travis passes it I guess
[16:02:55] <wardi> seanh: I'm sad that we don't have a test that covers this
[16:03:08] <rossjones> was that a hint?
[16:03:13] <wardi> did we before the legacay templates were removed, or something?
[16:03:24] <seanh> Nor do we have a way to write controller tests currently, afaik
[16:03:38] <seanh> Not sure, maybe
[16:03:42] <wardi> sure we do, I've added some functional tests
[16:03:48] <seanh> Ah, didn't know
[16:04:11] <rossjones> test_package is still there in functional tests
[16:04:25] <seanh> http://docs.ckan.org/en/latest/contributing/testing.html#module-ckan.new_tests.controllers
[16:05:32] <wardi> new_test/controllers/test_package totally tests creating resources.. what's going on?
[16:06:08] <seanh> It's creating a dataset (first form) that crashes
[16:06:52] <wardi> right, and that's being done in every TestPackageControllerNew test
[16:07:25] <wardi> oh! it;s the auth that's failing and the tests are skipping that
[16:07:30] <seanh> Ah
[16:07:40] <seanh> The controller tests skip auth as well?
[16:07:45] <wardi> that's silly. I should change those tests to use a normal user
[16:07:54] <wardi> instead of a sysadmin
[16:08:33] <seanh> The action tests always skip auth so this could happen there as well
[16:11:43] <seanh> wardi: I'll fix those tests
[16:11:58] <seanh> They do fail on master with the same error, if you change them to use a normal user
[16:12:11] <wardi> seanh: awesome
[16:12:32] <seanh> Great that we have the beginning of some controller tests, too
[17:20:31] <wardi> wat. github showed me the travis test on e8bcc8f passing so I merged, but now it's back to 'queued'?
[17:36:03] <seanh> When CKAN posts to datapusher to ask it to do a job, CKAN sends along a callback URL and API key which datapusher keeps in its db
[17:36:12] <seanh> (db full of ckan sysadmin api keys unencrypted, btw)
[17:36:35] <seanh> Then when the job finishes either successfully or with an error, datapusher deletes the API key
[17:36:52] <seanh> And *then* it tries to post the result to CKAN's callback URL with no API key and gets a 403!
[17:37:19] <seanh> Admittedly it probably wasn't always doing this - I probably introduced it recently. All the tests pass tho
[17:38:45] <wardi> there's an old bug tracking our unencrypted api keys. submittor suggested using a secret in the ini file to encrypt them
[17:41:16] <seanh> I guess that would mean someone needs access to both the config file and the db to get the api keys
[17:41:46] <seanh> They are sent over the internet in plain text as well (unless both ckan and datapusher are using https)
[17:42:08] <seanh> Another way to do it would be to just put the API key of each ckan site that a datapusher instance serves in datapusher's config file
[17:42:19] <seanh> Then no api keys in the db or going over the internet
[17:42:29] <seanh> But if someone gets access to the config they have it
[17:42:50] <wardi> seanh: yeah, the threat is someone with access to db backups
[17:43:20] <wardi> we hash the passwords, but there's that other plain-text password sitting there right next to it
[17:43:55] <wardi> with the ini file someone can already spoof anyone they like, I think
[17:44:39] <seanh> Well, not with the datapusher ini file
[17:44:55] <wardi> right, I mean the ckan ini file
[17:45:38] <seanh> I think you want a way to create a user account in CKAN that can *only* do actions that datapusher needs to, or that doa needs to etc
[17:45:53] <seanh> Then put that in the datapusher or doa ini file
[17:47:20] <wardi> that would be nice
[17:48:38] <seanh> Or maybe put a secret in the ini file, and put the api keys encrypted in datapusher's db, just to make it a little harder. But that would mean datapusher needs a persistent db, and I'm not sure if it's worth the bother, trying to stop someone who has access to your ini file
[17:49:31] <wardi> yeah, probably not
[17:50:14] <seanh> If datapusher tries to fetch a resource's data file and that fails, it transforms the whole Python traceback into a string and posts that to CKAN as the error message
[17:50:23] <seanh> This is then displayed to users in the CKAN web UI
[17:50:49] <seanh> I think you may need permission to edit the dataset to see it, though
[17:51:02] <seanh> It runs all the lines and indentation together, too
[17:57:15] <travis-ci> ckan/ckan master e8bcc8f http://travis-ci.org/ckan/ckan/builds/43859852 Sean Hammond: The build has errored.
[17:58:33] <wardi> doh
[18:12:03] <sharp> anyone have any idea how I might mark related items as "featured" for the /related page?
[18:44:08] <wardi> seanh: oh, I see what happened. I merged without --no-ff so there was no merge commit
[18:44:41] <wardi> travis saw that and decided to re-run its tests, and one had an intermittent failure
[18:45:19] <wardi> sharp: the current related items feature is pretty unloved. There's a new showcase feature being built to replace it
[18:45:35] <wardi> that might be why noone is responding (not enough users)
[18:45:37] <sharp> hmm
[18:46:11] <wardi> sharp: if you file a bug someone will respond by our next dev meeting
[18:46:21] <wardi> (or shortly after)
[18:46:32] <sharp> wardi: cool, thanks
[18:47:25] <sharp> i'll have to use the related items feature on our site until then
[18:47:59] <sharp> so maybe i'll edit the db directly if we need to feature something

[14:36:24] <seanh> While I can understand wanting to break things up into separate modules. plugins and services, the monolithic approach does seem to be simpler
[14:37:08] <seanh> Working on datapusher for example usually means changing something in ckanserviceprovider, then changing something in datapusher to match that, then changing something in CKAN to match that. The datastore plugin might get involved as well
[14:38:03] <seanh> Just to test it you need CKAN run, datastore setup, datapusher running, then a variety of valid and invalid tabular data files to upload
[14:39:40] <seanh> Instead of install CKAN, run it, test it, it becomes install several different components, configure them all to work together, run them all, test, try to figure if problems are bugs or if you set it all up wrong
[14:41:02] <rossjones> The problem isn't non-monolithic services, it's too many layers in non-monolithic services ;)
[14:41:58] <rossjones> Am still of the opinion that a) ckanserviceprovider is overkill for what it's doing, b) there's no reason external services need to be written in Python ;)
[14:43:07] <seanh> I think ckanserviceprovider is a bit overkill as well. But what would you have instead of it - still a Flask app, only simpler?
[14:43:57] <seanh> I would probably say write a few services like datapusher first, get the right, and then extract out the common reusable code if there is much of it. Rather than start with the base library (ckanserviceprovider) that (still) only has one user (datapusher)
[14:44:13] <rossjones> Sure. that seems like a more sensible approach
[14:45:25] <rossjones> I think at this point, if you want queue-like behaviour with durability, then use a queue :) If something is non-critical, then fail when you need to fail and just log it.
[14:46:51] <rossjones> I asked a question on ckan-dev this morning, and was wondering if it was something you might have thought about (especially re: ckanexpress) - how would you change extensions like archiver so background workers would work with multiple instances.  You did something like that for DOA right?
[14:47:11] <rossjones> Or was that multiple workers?  Friday memory loss.
[14:48:19] <seanh> To be fair csp does use apscheduler to run jobs in the background with persistence. Not a queue exactly, but it's not really reinventing its own wheel either.
[14:49:11] <seanh> So you mean a service like doa serving multiple ckan sites?
[14:49:19] <rossjones> So if datapusher dies mid-job, does it retry on reload?
[14:49:28] <rossjones> Yes, multiple sites.
[14:49:53] <rossjones> Like, here's all the info you need to contact the originating ckan, and here's the stuff you need to do your job.
[14:50:12] <seanh> APScheduler supports that. Don't think datapusher does it
[14:50:36] <rossjones> So there's not much point having something to persist requests if it doesn't do retries.
[14:51:07] <rossjones> And not much point abstracting that out to CSP if that doesn't handle re-submitting jobs for you.
[14:51:26] <seanh> Doa can work for multiple sites. When you run it you pass it the client site URL and API key. So you can have two different cron jobs for two different CKAN sites, each cron job passes a different url and key
[14:52:33] <rossjones> Right, that sounds ideal.
[14:53:32] <rossjones> So, in theory, I could setup my own DOA service, and people could pay me micro-pennies per request to check links for them.
[14:53:42] <rossjones> If I were insane enough
[14:53:58] <rossjones> I could tell them the config to set, and it'd all be good to go.
[14:54:42] <seanh> CKAN passes a callback URL to doa each time. So if doa were extended into an actual web app it'd be simple as well: Config file contains list of base URLs for client sites it should serve, along with API key for each. Each client site provides a callback URL to doa when doa requests it
[14:55:07] <rossjones> RIght, my use-case is that - but for harvesting. Or QA (format checking).
[14:55:16] <seanh> rossjones: In theory, although it doesn't track what work it has done so not sure how you'd charge people
[14:55:26] <seanh> Charge them a flat monthly rate, keep it simple
[14:55:35] <rossjones> The charging bit was *sort* of irrelevant, just an idea.
[14:55:47] <rossjones> I've no intention of doing it, but someone could if they wanted to, I guess.
[14:56:01] <rossjones> Just to save the hassle of setting up all the background services they might want.
[14:56:10] <rossjones> Like heroku add-ons.
[14:56:31] <seanh> Yeah, so for harvesting or qa I think if you turned them into standalone services then one instance could easily serve as many client sites as you want. No reason why they need to be tied to one site, or even to CKAN
[14:56:45] <rossjones> That's sort of what I was getting at I guess.
[14:58:58] <seanh> I do like that way of doing it. As long as you keep those standalone services very simple to install and maintain, and the HTTP interface/protocol that they communicate with CKAN over is also very minimal, simple and well-documented and tested
[14:59:31] <seanh> For datapusher it's all a bit murky, which makes developing the different moving parts in tandem tricky
[15:00:38] <seanh> We have for example jinja templates in CKAN (so no tests) that are tightly coupled to the untested and undocumented structure of nested JSON objects that datapusher returns to CKAN
[15:01:57] <seanh> Ok, CKAN master is crashing for me with logic.NotFound when adding a new dataset in the web UI. Is this a problem with my setup or a bug?
[15:02:14] <rossjones> seanh any stacktrace?
[15:02:39] <rossjones> Mine was working fine a cpl days ago
[15:03:19] <seanh> https://gist.github.com/seanh/fe4c41894829106397bb
[15:03:35] <seanh> This looks to me like it may be caused by recent changes to the resource auth
[15:04:27] <rossjones> sounds plausible
[15:08:45] <sharp> hi all, got a seemingly simple thing i'm struggling with: I don't know how to choose apps and ideas to mark as featured
[15:16:27] <rossjones> seanh this one? https://github.com/ckan/ckan/pull/2037
[15:17:01] <rossjones> or https://github.com/ckan/ckan/pull/2045 - I think it moved.
[15:18:23] <seanh> Not sure, guess I'll debug this
[15:18:35] <rossjones> seanh looks like it wants package_id now, and if it finds id then looks up the resource with it.
[15:18:45] <rossjones> but the controller is probably passing in the package id as id.
[15:18:55] <rossjones> Just a thought, possibly not 100% accurate :)
[15:20:35] <rossjones> so https://github.com/ckan/ckan/blob/master/ckan/controllers/package.py#L742-L749 it passed in pkg_dict (where the id will point to package) and https://github.com/ckan/ckan/blob/master/ckan/logic/auth/create.py#L69-L73 it looks up package from package_id, and if not loads resource from id.
[15:24:57] * wardi really likes the doa design
[15:28:01] <wardi> seanh: uh, oh. I think I merged that :-(
[15:30:10] <amln> sharp: ones that are good?
[15:30:35] <sharp> amln: i don't know how to mark them as featured
[15:31:24] <wardi> seanh: it's odd though, why wouldn't our functional tests pick up resource creation failing
[15:32:02] <sharp> if i check "Only show featured items" on the /related page, nothing shows up
[15:32:27] <sharp> and i'd like to mark apps in the database to show up in this view
[15:32:48] <seanh> Why is the resource_create auth calling get_resource_object()? Surely the resource doesn't exist yet
[15:33:08] <seanh> Oh I see, "deferred auth"
[15:33:47] <seanh> rossjones: The package controller apparently passes a package dict into the resource_create auth
[15:33:54] <seanh> Not a resource dict
[15:34:08] <rossjones> seanh thought that's what i had said. at least that's what I meant to say.
[15:34:12] <seanh> So it has no "package_id" and its "id" is the package ID, not a resource ID
[15:34:18] <rossjones> Yup[
[15:34:39] <seanh> This damn passing dicts around
[15:34:49] <rossjones> I know we're a blame-free project, but that was wardi's fault :P
[15:34:59] <seanh> What is the resource_create() auth function's dict supposed to be? A resource dict presumably
[15:35:04] <wardi> did I start that? :-)
[15:35:08] <seanh> Passing a package dict to it is just wrong, surely
[15:35:15] <rossjones> Think amerc<TAB> did
[15:35:35] <rossjones> That's probably how it used to work
[15:36:17] <rossjones> Worse than passing these dicts around, is not knowing what's in them,
[15:36:28] <rossjones> extra stuff added by logic layers funcs etc
[15:37:02] <rossjones> I'm gonna stop now before I start with my premature serialization rant again :)
[15:37:33] <seanh> Sometimes I want to go back to Java
[15:37:42] <rossjones> Steady on.
[15:37:50] <rossjones> It's never *that* bad
[15:38:32] <wardi> rossjones: ooh, I missed that rant. sounds like a good one
[15:39:35] <seanh> So I can fix by instead of letting the package controller pass inn pkg_dict to resource_create auth, have it pass the minimal {"package_id": pkg_dict["id"]}
[15:39:36] <rossjones> You can imagine how it goes, fetch a pkg from the db, call a func, fetch it again, jump through hoops to serialize the object graph into dicts blah blah.
[15:39:45] <seanh> But did I break anything?
[15:39:56] <rossjones> seanh looks like the tests won't tell you :(
[15:40:01] <seanh> Nope
[15:43:21] <seanh> It's passing the dicts around that's where it all went wrong. Post data has to be received as dicts, but the first thing you do with it should be to validate it and turn it into an object with a documented interface
[15:43:55] <seanh> Then we wouldn't have all this "if it has key 'foo' then x or if it has key 'bar' not some other key then y
[15:44:51] <seanh> I thought that separating things into standalone services would kill this sort of thing and force well defined interfaces. But life finds a way - serialize a dicto to json, send it over http, deserialize on the other end, never document what's in it or even make it consistent
[15:44:57] <wardi> rossjones: the everything-as-dicts (or jsonish types) thing does make extending to add additional fields really easy, and it promotes use of the action api while discouraging internal methods that only work from extensions
[15:45:26] <rossjones> But most additional fields are added as extras, that wouldn't change.
[15:45:39] <wardi> not for me :-/

2014-12-11
[08:30:47] <george_s> hwty guys, anyone tried installing the Data Packager on the same instance as CKAN and somehow interfacing them?
[08:58:33] <rossjones> george_s like http://seanh.cc/posts/datapackager/ ?
[09:06:14] <george_s> Yup - that one. Any issues deploying data packager side-by-side with CKAN?
[09:12:55] <rossjones> seanh is the one to ask :)
[09:15:40] <george_s> cool - I'll bug seanh about it :)
[09:21:33] <amln> rossjones: you're not the only one of that opinion.
[09:22:34] <rossjones> amln lots of people know what I mean when I say OKF, or OKF. Nobody knows when I mean when I say OK.
[09:22:47] <rossjones> s/or OKF/or OKFN/
[11:12:16] <brook> Is there a way to override the templates for a specific page within CKAN in an extension, rather than the whole class of pages? So, I'd like to have a custom template for a specific dataset and resource, but not for all datasets.
[11:13:45] <amercader> brook: IDatasetForm has methods for definining the templates for that particular dataset type
[11:14:31] <amercader> eg https://github.com/ckan/ckan/blob/master/ckan/plugins/interfaces.py#L959
[11:14:44] <brook> amercader: I was hoping not to use 'type' to differentiate.
[11:15:11] <amercader> brook: the controllers will do that for you
[11:16:20] <brook> So a dataset with a custom type will behave exactly the same as any other dataset? I only want to customize its template.
[11:17:39] <Zharktas> we only put some if-elses to template to differiate with custom type attribute
[11:18:59] <brook> Zharktas: That might be enough for my purposes.
[11:21:40] <amercader> brook: are you implementing IDatasetForm?
[11:23:17] <Zharktas> brook: https://github.com/yhteentoimivuuspalvelut/ytp/blob/master/modules/ckanext-ytp-main/ckanext/ytp/dataset/templates/package/snippets/package_form.html#L7 something like this
[11:24:49] <mih> Hi! We are still running into issues with the datapusher; when we try to upload a file to the datastore, following error occurs: Process completed but unable to post to result_url  -- does anyone have any idea what could cause this problem?
[11:25:05] <amercader> mih: have you set the site_url config option in your ini file?
[11:25:23] <brook> amercader: I need to customise several pages, including datasets and resources. But only specific instances, not all of them.
[11:25:44] <mih> yes, it is set to http://0.0.0.0
[11:26:18] <brook> amercader: So will likely use IDatasetForm as part of that. Though I might be able to do it with a more general template that uses a conditional like Zharktas suggests.
[11:28:18] <amercader> brook: the issue with this approach is that if your extension is a generic one then other extensions (eg a project one) might want to override the same template
[11:28:38] <amercader> not sure if ckan will allow multiple overridings
[11:29:47] <Zharktas> it does, if template calls super, all the overrides are executed in some order
[11:30:25] <brook> amercader: I see. However, it's not for general use. It doesn't need to be too robust.
[11:35:57] <mih> could it be a firewall-problem? - or does the error-msg suggest another problem?
[11:41:05] <amercader> mih: this error means that the datapusher process finished (either successfully or with an error) but it could not push back the result to ckan
[11:41:24] <amercader> it could be a network issue, I'm afraid I can't give more details
[11:42:02] <amercader> and btw the error is terrible, and seanh  is working ion improving the feedback from errors
[11:45:56] <mih> hm, the datapusher-url is not public, so only the machine where ckan is installed on has access to the datapusher (curl 0.0.0.0:8800 from the ckan-server returns the help-link as expected) -- therefore, I am not sure where further problems (regarding network issues) could occur - any ideas?
[11:49:38] <mih> last log-entry is following: ConnectionError: HTTPConnectionPool(host='0.0.0.0', port=80): Max retries exceeded with url: /api/3/action/resource_show (Caused by <class 'socket.error'>: [Errno 111] Connection refused)
[13:48:33] <Zharktas> does someone have any idea why our organizations extra fields are emptied when i update the org through the api? the extra fields work just fine when i update the org through the web interface
[14:01:08] <mih> unfortunately, still having same problems with datapushers, hm :/
[14:07:21] <rossjones> mih is ckan the only thing listening on port 80? Can you access /api/3/action/resource_show using just the IP address?
[14:08:19] <rossjones> presumably no Host header is being sent if you are connecting to 0.0.0.0 so I would expect ckan to be listening on all hosts.
[14:13:33] <wardi> Zharktas: are you passing the extras back to organization_update?
[14:14:00] <wardi> (your members will get removed too if you don't pass them IIRC)
[14:14:13] <mih> in general, we changed our site_url-setting from a domainname (e.g. ckan.test.com) to the ip since we got an "could not connect to datapusher-error
[14:15:08] <mih> @rossjones: i will try it - how could we fix it, when /api/3/action/resource_show is not accessible through the ip? - changing back to domainname?
[14:18:01] <Zharktas> wardi: probably not, was just thinking the same since our schema modification also affect to api, so extra fields are not in extras anymore when i call organization_show to get the original organization
[14:22:06] <rossjones> mih yes, and making sure your machine can resolve that name to your IP address.  If necessary update /etc/hosts
[14:22:26] <rossjones> if you can't "ping ckan.test.com" then it won't work.
[14:22:37] <rossjones> if "ping ckan.test.com" returns the IP address, you're all good.
[14:23:09] <mih> 127.0.0.1 -> test-domain is already included in the hosts; ping is possible
[14:23:27] <mih> it's a bit strange...
[15:08:08] <wardi> Zharktas: yes, you need to be careful to adjust both sides when you're moving fields around in a custom schema
[15:08:20] <wardi> (show and update)
[15:59:33] <amercader> I'll be 5 min late to the dev call, sorry
[15:59:56] <wardi> https://plus.google.com/hangouts/_/event/cb1vmkss426lkqicj94a3amvd1c?authuser=0&hl=en-GB
[16:03:02] <wardi> we're talking metadata schemas for a few minutes until amercader arrives
[16:03:29] <kalxas> https://github.com/geopython/pycsw/issues/95
[16:05:00] <wardi> probably bad connection on my end :-(
[16:05:33] <wardi> please carry on the meeting
[16:06:01] <wardi> (does it sound like audio encoding junk or mic noise?)
[16:06:21] <brook> Just very faint
[16:08:53] <mih> is it needed that the datapusher is configured via VirtualHost 0.0.0.0:8800 instead of VirtualHost 127.0.0.1:8800? - or shouldnt that make any big differences?
[16:10:45] <mih> thus: 127.0.0.1 instead of 0.0.0.0
[16:18:41] <kalxas> http://kalxas.github.io/publicamundi-presentation/#/
[16:18:46] <kalxas> http://publicamundi.eu/
[16:19:53] <kalxas> http://labs.geodata.gov.gr/
[16:29:33] <kalxas> https://github.com/geopython/pycsw/issues/95
[16:31:14] <kalxas> https://github.com/PublicaMundi/ckanext-publicamundi
[16:31:46] <kalxas> https://github.com/ckan/ckan/blob/master/requirements.txt#L43
[16:36:21] <wardi> https://github.com/open-data/ckanext-fluent
[16:37:35] <kalxas> https://github.com/PublicaMundi/ckanext-publicamundi/blob/master/ckanext/publicamundi/lib/metadata/schemata/inspire_metadata.py
[16:40:03] <kalxas> https://github.com/PublicaMundi/ckanext-publicamundi/blob/master/ckanext/publicamundi/lib/metadata/serializers.py
[16:44:01] <kalxas> https://github.com/PublicaMundi/ckanext-publicamundi/blob/master/ckanext/publicamundi/plugins.py#L261

2014-12-10
[16:10:57] <seanh> There's just loads of columns where we *know* the data going in is always str, but the column typee is uniode
[16:11:05] <seanh> I don't want to do a db migration
[16:55:39] <rossjones> seanh where are get_job and add_pending_job called from? surely that should pass through unicode?
[16:56:37] <wardi> +1 better to have unicode at the edges
[16:58:13] <rossjones> exactly.
[17:23:10] <seanh> I guess so
[17:23:49] <seanh> In some cases, like job_id for example, the problem is really that the db column type should not be unicode, the job_id's are never unicode
[17:24:25] <seanh> So it kind of spoils the interface that db.py presents to other modules, to make  them have to do db.get_job(unicode(job_id)) everywhere
[17:24:46] <seanh> Probably some other things have no reason not to be done on the edges though
[17:31:04] <zr2d2> hi, i'm trying to debug a ckan extension, and I'm currently calling to extension by curling it's route, which is being proxied through mod_wsgi. Is there a better way it load ckan amd extensions for testing?
[17:33:42] <wardi> zr2d2: are you testing a controller?
[17:34:49] <zr2d2> @wardi: yes
[17:35:28] <zr2d2> technically, it's code called by the controller
[17:35:53] <wardi> zr2d2: unit tests or interactive tests?
[17:36:19] <wardi> s/unit/automated
[17:38:12] <zr2d2> at this point, interactive
[17:38:16] <wardi> if I'm testing interactively I would use paster serve instead of apache. for automated tests I use the pylons TestApp thing
[17:38:49] <zr2d2> maybe i'll get time to add automated tests in the future
[17:39:26] <wardi> paster serve with debug=True in the ini gives you a nice interactive debugger when things fail
[17:41:02] <zr2d2> how about if i was testing code outside the controller? i have a function outside the controller class thats returning nil
[17:41:30] <wardi> if it's an action function you can just call the api
[17:41:58] <wardi> if it's something simple you can call it from paster shell or a unit test
[17:42:34] <zr2d2> alright
[20:12:25] <rossjones> Anyone currently on a tea-break? *cough*https://github.com/opendata/CKAN-Multisite/issues*cough*
[20:23:37] <amln> rossjones: *cough*, OKFN -> OKF -> OK
[20:23:46] * amln still is in the middle.
[20:40:51] <wardi> rossjones: I was just suggesting to usodi to break up their proposal and submit parts to our ideas repository, but it looks like you've already done that :-)
[20:48:03] <wardi> amln: whoa. OK
[20:48:30] <wardi> I didn't notice that
[20:55:46] <rossjones> amln I know force of habit now (and I don't like the new name ;) )
[20:56:39] <rossjones> wardi yeah, should be easier to discuss in chunks.  What he really wants, I think, is some idea of which bits can be done as discrete pieces of work so they can send out the RFPs and budgets etc. So a good chance to get a lot of the roadmap done :)

[10:28:22] <acorbi> HI everyone. I have some issues deploying a new set of .po files (for th and km) into a running CKAN instance
[10:28:56] <acorbi> what i did is to SCP the .po files to their respective LC_MESSAGES folders under src/ckan/ckan/i18n/
[10:29:15] <acorbi> then run python setup.py compile_catalog -> .mo files are generated correctly
[10:29:45] <acorbi> then i restart the CKAN instance but the strings are not getting translated. any clues on this?
[10:36:21] <acorbi> Did i forgot something, or is this the expected way to do it?
[11:58:45] <nigelb> acorbi: it sounds like the expected way.
[11:59:46] <acorbi> hi nigelb, thanks for your reply
[12:00:47] <acorbi> for some reason, the changes on the strings were no appearing. However i have integrated the updated .po and .mo files in my provisioning scripts and once deploy they work.
[12:01:04] <nigelb> wait, what do you mean?
[12:01:10] <nigelb> when does it work?
[12:25:07] <acorbi> let me explain it
[12:25:34] <acorbi> i have an ansible deployment script which installs CKAN from source
[12:26:40] <acorbi> this scripts clone a fork of ckan which contains the updated .po and .mo files available here https://github.com/OpenDevelopmentMekong/ckan/tree/ckan-2.2_lang_ext
[12:27:24] <acorbi> after finished, the deployed CKAN instance shows the updated strings properly
[12:28:28] <acorbi> for a particular reason, the steps i described at the begining (copying with SCP) did not work
[12:37:54] <nigelb> when you do the compile_catalog, are you passing the right locacle.
[12:47:30] <acorbi> yeah, i tried that and without parameters, to compile all
[12:47:46] <acorbi> no error message was thrown and .mo files where generated correctly
[12:48:54] <acorbi> one question: CKAN (i gues pylons or other part of the system takes care of that) basically pulls those strings from the .mo dynamically everytime a site is requested?
[13:05:22] <wardi> acorbi: gettext does that, yes
[13:05:36] <wardi> but I'm not sure what you mean by 'site'?
[13:05:41] <acorbi> hey wardi, i mean page
[13:05:56] <acorbi> or i mean, basically dynamicalyy
[13:05:58] <acorbi> or i mean, basically dynamically
[13:06:04] <acorbi> on runtime
[13:06:10] <acorbi> no pre-renderer or something
[13:06:14] <wardi> (almost) everything is dynamic in python
[13:06:30] <acorbi> that's why i found strange that the change in the updates were not reflected
[13:06:57] <acorbi> if i just replace the .po and .mo files, it should work, even without runing compile_catalogue. its clear for me
[13:07:11] <wardi> and restart your processes
[13:07:42] <acorbi> restarting the VM where my test ckan instance is hosted should be enough, right? :-)
[13:08:14] <wardi> oh you're not seeing your strings at all
[13:08:30] <acorbi> i am not seeing them translated
[13:08:39] <acorbi> concretelly
[13:09:01] <acorbi> in release 2.2 the string dataset was not translated in khmer
[13:09:34] <wardi> what else might be missing. are those languages in the ini file?
[13:10:01] <acorbi> i uploaded the updated version of the khmer .po and .mo file with the string "dataset" translated
[13:10:46] <acorbi> and refreshed the page. still "dataset" appeared and not     
[13:11:14] <acorbi> those languages and in the ini file yes
[13:11:20] <acorbi> those languages are in the ini file yes
[13:11:33] <wardi> those glyphs are awesome. I want to learn khmer
[13:11:52] <acorbi> yeah, me too hehehe
[13:12:09] <wardi> something else then.. are the languages being loaded form the directory you expect? (do you have another ckan somewhere?)
[13:12:27] <acorbi> nope, that is the expected (default) folder
[13:12:30] <wardi> in the ini you can specify the directory for the i18n files
[13:12:46] <acorbi> but let me maybe do some more intensive analysis
[13:12:51] <wardi> can the web server process read the files you've created?
[13:13:11] <acorbi> i believe permissions are ok, but yeah, that would be something to check
[13:13:31] <acorbi> however, it is important to say, that SOME strings were translated. those belonging to the old .po file
[13:13:41] <acorbi> i thought about some caching issues as well
[13:13:50] <acorbi> but tried different browsers...
[13:13:59] <wardi> I might try breaking some translation in that directory and see if it's refleced on the site to be sure that it's the right place
[13:14:08] <acorbi> jup, that's a good test
[13:14:38] <wardi> because what you're describing seems a bit too strange
[13:14:54] <acorbi> i know...
[13:15:51] <acorbi> let me analyse it more in detail and i promise ill solve the mistery and share it with you
[13:17:12] <acorbi> btw, the project i am doing all this for is going to do a quite cool contribution for the CKAN community. the people i am working with have already translated released 2.2 to Khmer, Thai and almost Vietnamese
[13:17:34] <acorbi> and we are developing a Wordpress plugin to pull / push data from CKAN
[13:17:57] <acorbi> plus some ansible scripting for deployment of CKAN
[13:18:12] <acorbi> still some repos are hidden but stay tuned to this https://github.com/OpenDevelopmentMekong
[13:18:40] <wardi> sounds great. I suggest opening the repos as early as possible
[13:20:01] <wardi> it's a lot easier to get help that way :-)
[13:21:10] <acorbi> complete agree
[13:23:14] <acorbi> it will be a matter of days, trust me
[13:27:01] <rossjones> acorbi also any other changes to ckan_php, am sure noel would appreciate a PR :)
[13:29:54] <Zharktas> acorbi: we had a issue with virtualbox and apache which cached static files even if the files themselves changed
[13:30:19] <Zharktas> some old virtualbox optimization trick which can be disabled in webserver
[13:36:24] <acorbi> rossjones: sure! is planned
[13:36:57] <acorbi> zharktas: good to know, i'll keep it in mind
[13:39:57] <Zharktas> https://www.virtualbox.org/ticket/9069 3 year old bug already apparently
[13:42:07] <acorbi> Zharktas: Thanks! Took note of that
[13:42:45] <acorbi> my test machine is actually running on vagrant+vbox
[13:42:49] <acorbi> so that could be an issue
[13:43:25] <Zharktas> turning sendfile off in web server fixes that although its kind of a hack
[14:57:12] <seanh> When did sqlalchemy start printing this annoying "SAWarning: Unicode type received non-unicode bind param value"?
[14:57:51] <seanh> Tons of columns in ckanserviceprovider that could just be plain text have type UnicodeText instead
[14:58:36] <seanh> It puts lots of things like function and module names, logging levels, hardcoded strings, etc into these columns, triggering the warning
[14:58:59] <wardi> functions and module names can be unicode in python3 :-)
[14:59:48] <wardi> it's future-proofing
[15:01:18] <seanh> Right
[15:01:45] <seanh> But in python 2 you need to unicode() them, or sqlalchemy will print warnings all over the place
[15:06:30] <wardi> I'm leery of all the unicode(thing) calls we have in the code base
[15:06:49] <seanh> Yeah it's messy
[15:07:24] <wardi> I mean, without an encoding that call will fail on non-ascii
[15:07:49] <wardi> (unless the user has been sneaky and modified their site encoding, which makes it even worse)
[15:09:15] <seanh> Yep
[15:12:13] <wardi> ..but with an encoding it will fail if you pass unicode to it
[15:13:46] <wardi> how about a new fail_loudly_if_not_unicode function for new code and unicode_or_ascii for things that need backwards compatibility
[15:21:44] <wardi> assert_unicode might be a better name for the first one :-)
[15:24:42] <amercader> seanh, wardi: there were tons of "Unicode type received non-unicode bind param value" errors in ckan, until they were manually silenced
[15:24:45] <amercader> Unicode type received non-unicode bind param value
[15:24:51] <amercader> https://github.com/ckan/ckan/blob/master/ckan/config/environment.py#L224
[15:25:31] <wardi> :-(
[15:31:29] <wardi> I wonder if this is why we have binary data in the datastore :-/
[16:10:26] <seanh> Sigh, https://github.com/ckan/ckan-service-provider/commit/5c42ba15291ae308306ba95fa817f64d2defa474

2014-12-09
[09:57:08] <rossjones> amercader wardi going to merge https://github.com/ckan/ckan/pull/2034 today - how do we do backports? something I need to do or done elsewhere?
[10:05:36] <amercader> rossjones: I'll take care of the backport, just leave the "backport pending" label on it
[10:05:54] <rossjones> ok. failing tests for me atm, but probably my setup :(
[11:51:23] <george_s> hi all. Does anyone know if there's any rough, theoretical maximum for number of registed users in CKAN. Would it be in the 1000's ?
[11:53:17] <amercader> george_s: I don't think there is a max, I think datahub.io has more than 100k (most spammers)
[11:53:21] <amercader> rossjones: ^
[11:53:45] <rossjones> yes lots of impotent spammers on datahub.io
[11:53:51] <rossjones> want me to check how many?
[11:54:37] <rossjones> ~ 186k
[11:54:38] <amercader> according to the user page there are 9300 * 20
[11:54:40] <amercader> yeah
[11:54:43] <rossjones> :D
[11:54:59] <rossjones> I should apply my super-smart-heuristic and delete some.
[11:55:00] <amercader> at least we know that number of usres is not a blocker :)
[11:55:26] <george_s> whoa - okay that's a lot :)
[11:55:27] <rossjones> if email_host in ['hotmail.co.uk', 'hotmail.com', 'yahoo.co.uk', .....
[11:55:45] <rossjones> george_s most are inactive, or busy hammering nginx to get 403s
[11:56:24] <rossjones> we have 13.5k users on DGU.
[11:57:08] <rossjones> nearly call time - best make some coffee.
[12:00:46] <wardi> https://plus.google.com/hangouts/_/event/cb1vmkss426lkqicj94a3amvd1c?authuser=0&hl=en-GB
[12:01:58] <amercader> seanh ^
[12:38:36] <seanh> I'm having bad onnection issues, gonna drop out
[12:53:04] <george_s> good night from GMT+11.
[13:57:44] <rossjones> amercader fixed tests in https://github.com/ckan/ckan/pull/1318, and code looks fine, am I allowed to merge it or does someone else have to take a look (because I contributed)?
[13:58:46] <amercader> rossjones: your changes look great, go for it and merge
[13:59:04] <rossjones> done
[18:43:59] <rossjones> when did user_show change to return the full package list for that user?
[19:11:03] <rossjones> Any minute now I am going to go on a rampage and remove the c.pkg stuff from everything....
[19:57:09] <wardi> (git blame)++
[19:57:29] <rossjones> it's been there for quite a while.
[19:57:55] <rossjones> Am fixing it now. Also found a bug in groups bulk_process that was putting include_datasets in context (which is where I think it really should be) instead of data_dict.
[19:58:04] <rossjones> so that might be a bit faster now :)
[19:58:11] <wardi> if it makes a difference, returning a whole package shpuld be quick from solr
[19:58:30] <rossjones> package_show still calls package.get
[19:58:35] <rossjones> and *then* goes to solr.
[19:58:38] <rossjones> 50 times.
[19:59:12] <rossjones> almost as bad as the bug of mine morty found the other day with 100s of DB queries in a loop. this is why I dislike orms. false sense of flexibility.
[20:00:16] <rossjones> controllers/package.py - "# used by disqus plugin" *sobs*
[20:00:22] <rossjones> I should stop looking.

2014-12-08
[11:44:30] <rossjones> Is seanh on holiday atm or still about?
[11:44:47] <rossjones> Have a question about https://github.com/ckan/ckanext-eurovoc
[11:47:16] <seanh> rossjones: I'm back
[11:47:25] <rossjones> Yay!
[11:47:35] <rossjones> is that extension a WIP or stalled or just low-priority?
[11:47:57] <seanh> It's WIP
[11:48:27] <seanh> It's being done as part of the oppnadata.se project, which is currently on pause for a bit, will be resumed next year I think
[11:49:24] <rossjones> Ah okay. Cool.
[11:49:43] <rossjones> Am currently loading eurovoc into ckanext-taxonomy, and rdflib is not happy :(
[12:57:51] <wardi> rossjones: 'ckeanup' love that muscle memory (readme typo)
[13:25:17] <rossjones> wardi hahaha typical. I can't type serve either without stopping to think about it.
[13:26:38] <rossjones> No idea how I'm going to cleanly integrate the taxonomy term uris into our package schema yet, especially as eurovoc has 7k terms so showing a JS tree is a bit of a no-no.
[13:27:36] <rossjones> Probably going to cheat and assign them from the auto-theme-detection that morty is doing.
[13:35:30] <wardi> auto-theme-detection?
[15:26:43] <brook_> Anyone know where the code for the resource template tag is? Eg. what makes {% resource 'ckanext-textview/main' %} work?
[15:30:01] <Zharktas> https://github.com/ckan/ckan/blob/master/ckan/lib/jinja_extensions.py#L301 here
[15:47:26] <brook_> Zharktas: Thanks!
[15:58:04] <wardi> ugh. it that more resourceviews stuff scattered through the main code base
[15:58:55] <wardi> I just ran across a bunch of new commands in cli.py that are resourceviews-type-specific
[16:00:52] <wardi> oh, no that's a fanstatic_resources thing. even worse
[16:28:18] <gr8> what could be the reason when I get an 409-conflict-error while uploading files to datastore?
[16:36:14] <amercader> wardi: if you find resource views junk let me know, I'm trying to clean up as much as I can on #1852
[16:36:27] <amercader> next up is cli, which won't be nice
[16:43:30] <gr8> what could be the reason when I get an 409-conflict-error while uploading files to datastore? ==> HTTP is needed in site_url-config-setting...;-)
[16:59:50] <wardi> gr8: I've seen that come up a few times. we should probably be refusing to start if the site_url is invalid
[17:00:22] <rossjones> theres a PR for that.
[17:00:43] <rossjones> wardi https://github.com/ckan/ckan/pull/2016
[17:01:22] <rossjones> Is the issue actually that it must be a valid URL (not just that it exists) ?
[17:02:00] <gr8> the site_url was set; but the "http" was missing. therefore, it did not work
[17:05:32] <rossjones> I see. I should have done that at the same time really.
[17:09:52] <rossjones> gr8 could you add an issue for us and I'll see if I can get to it, it's the meeting tomorrow and I'm short of PRs this week.
[17:14:25] <travis-ci> ckan/ckan 1852-default-resource-views 0e5bab8 http://travis-ci.org/ckan/ckan/builds/43366175 amercader: The build was broken.
[17:15:29] <gr8> rossjones: okay; i will add an issue!
[17:57:17] <wardi> rossjones: right! added a comment

2014-12-07

2014-12-06

2014-12-05
[12:08:05] <rgrp> wardi: sounds good re master branch - folks should now have access to extensiosn spreadsheet ...

2014-12-04
[01:09:37] <nigelb> wardi: https://circleci.com/ we should look at this.
[01:09:56] <nigelb> they let you ssh into the enviornment to figure things out.
[01:31:23] <wardi> nigelb: i've hrard good things
[01:34:13] <wardi> *heard
[01:36:47] <wardi> shopify seems to love them (they're a big deal in my town)
[05:21:52] <nigelb> wardi: ah!
[09:13:20] <rossjones> nigelb are you back from holidays?
[10:22:58] <indimi> Hello everyone! We are running into issues when previewing PDF-Files. The error is following:  Could not proxy resource because a connection error occurred. HTTPConnectionPool(host='research.microsoft.com', port=80): Max retries exceeded with url: /pubs/167719/WhyFromNigeria.pdf (Caused by <class 'socket.gaierror'>: [Errno -3] Temporary failure in name resolution). For instance, CSV-files the preview does work. This error via upload and
[10:24:59] <rossjones> indimi the cause is in the error - Temporary failure in name resolution
[10:25:16] <rossjones> does research.microsoft.com resolve on your server?
[10:26:17] <indimi> ...but why do I get the same error, when the file is uploaded?
[10:28:14] <indimi> error when trying it with uploaded files: Could not proxy resource because a connection error occurred. HTTPConnectionPool(host='test.ckan.com', port=80): Max retries exceeded with url: /dataset/9a87b346-26b7-42ff-bdb0-445baf0c4756/resource/d420514b-d273-4dcc-a939-e3c587f8154d/download/euw2014datenbeschreibung.pdf (Caused by <class 'socket.gaierror'>: [Errno -3] Temporary failure in name resolution)
[10:28:25] <rossjones> can your server resolve the name test.ckan.com?
[10:28:42] <rossjones> I am guessing no.
[10:29:15] <rossjones> You should probably add test.ckan.com to your hosts file for 127.0.0.1
[10:30:26] <indimi> since it does work with CSV-files - probably yes (unfortunately, I have no direct access to the server).
[10:31:02] <rossjones> indimi the problem is definitely name resolution, so something somewhere is failing to look up the name.
[10:31:53] <indimi> so, it is out of the scope from CKAN?
[10:32:22] <rossjones> i think so, sorry.
[10:32:33] <indimi> thank you very much!
[10:38:07] <indimi> ...or could there be a relation to (wrong?) settings in the CKAN-config-file (site_url or something else)?
[15:36:45] <nigelb> rossjones: nope :)
[15:40:39] <wardi> nigelb: ah, didn't notice that circleci is free for OSS
[15:41:08] <wardi> that's even better
[15:42:39] <nigelb> that's why I linked it, they just changed that recently.
[15:44:37] <wardi> so, how do I get access to the ckan extensions google doc?
[15:59:05] <amercader> wardi: do you have a link for it?
[15:59:23] <wardi> would someone that's going to be on the call try inviting my voice number (trying to solve my dropping out issue here)
[15:59:43] <amercader> wardi: I can do that
[16:00:43] <wardi> doc is linked from https://github.com/ckan/extensions.ckan.org
[16:01:26] <wardi> https://plus.google.com/hangouts/_/event/cb1vmkss426lkqicj94a3amvd1c?authuser=0&hl=en-GB
[16:01:34] <wardi> ^ dev meeting
[16:03:50] <amercader> joet: ^
[16:38:58] <amercader> wardi: I don't have access to the extensions doc either, I have requested it to the owner (I guess rgrp)
[16:43:33] <wardi> amercader: I couldn't find an option to request edit access
[18:57:24] <wardi> rgrp: I removed the master branch from the extensions.ckan.org repo because it didn't seem to do anything
[18:58:06] <wardi> and not having it means one less thing to trip up people

2014-12-03
[20:15:51] <wardi> how do I add extensions to the google doc that generates extensions.ckan.org?
[20:16:21] <wardi> should we be pulling from pypi instead?
[21:44:57] <wardi> https://github.com/open-data/ckanext-repeating
[21:45:04] <wardi> https://github.com/open-data/ckanext-repeating

[11:45:45] <ntoll> hi... CKANerers
[11:46:58] <ntoll> I need some advice: what's the "best" or perhaps "blessed" way to implement a date picker in a form. I see several plugins that all seem to roll their own. Just wondering if there was an obvious thing to use/do (otherwise, I too will roll my own jQuery based date picker again AGAIN) ;-)
[11:47:03] <ntoll> ????
[11:49:41] <amercader> ntoll: I don't think there is a blessed way to implement it. I know that joet implemented one this week, so perhaps he can share how he did it
[11:49:50] <amercader> oh, he's not around now
[11:49:53] <ntoll> amercader, heh... ok
[11:50:03] <ntoll> amercader, I might just do it without a date picker
[11:50:25] <ntoll> insisting on YYYY-MM-DD in the input box is simple enough to do
[12:04:55] <amln> i can point to the code...
[12:05:31] <amln> ntoll: https://github.com/okfn/ckanext-barnet/commit/7be770c1b9444d29e19519fa5c652598c4a2a77c
[12:05:45] <ntoll> amln, yeah, found that ;-)
[12:05:53] <amln> https://github.com/okfn/ckanext-barnet/commit/56bdbde77f12286de4d1aec17ad9338a0dab0c9d too
[12:06:00] <ntoll> coolio
[12:06:02] <ntoll> thanks!
[12:06:28] <amln> the second commit needs a small fix, but meh.
[12:07:50] <amln> ntoll: there's also https://github.com/okfn/ckanext-tsbsatellites/commit/38713afe5d5b6da0414cb758048ca8019ae12dd5 which is deployed to http://data.satapps.org/dataset as "Date of Collection"
[12:09:29] <amln> ntoll> insisting on YYYY-MM-DD <-- MMMM might be a safer option
[12:09:44] <ntoll> amln, quite... KISS
[12:09:46] <ntoll> ;-)
[12:09:51] <amln> wouldn't life be easier if people consistently formatted dates
[12:10:21] <ntoll> I've already implemented a date validator for YYYY-MM-DD that spits out helpful suggestions
[12:11:09] <ntoll> also, I suspect typing the date is probably quicker than using a JS/jQuery widget thingamabob
[12:13:00] <amln> i think most users *like* using a date picker. at least, that's the feedback i had when i did some training with them ~6 weeks ago.
[13:04:12] <wardi> that remind me I should have a date field snippet in scheming
[13:05:33] <wardi> I'm not entirely sold on native date widgets, because some browsers insist on displaying dates in the wrong order
[13:06:55] <wardi> this is one we use http://wet-boew.github.io/wet-boew/demos/datepicker/datepicker-en.html
[15:07:26] <wardi> Anyone have WADL for the ckan api?
[15:21:29] <rossjones> wardi that might be useful.
[17:51:56] <amln> hum. do others feel "users" might be "objects" in https://github.com/ckan/ideas-and-roadmap/issues/67 ?
[17:52:07] <amln> (wondering whether to add there, or a new ticket)
[17:56:50] <wardi> amln: you want to moderate new users?
[18:00:05] <amln> wardi: potentially, without disabling sign-up.
[18:00:30] <amln> i think it would be useful in ZOMGS! MY SITE'S BEEN HAX)RED
[18:00:41] <amln> (no, a user has signed up and created a dataset)
[18:01:09] <amln> and the group-based options in http://docs.ckan.org/en/ckan-2.2/authorization.html aren't necessarily that useful
[18:01:32] <wardi> you can force users to be in orgs before they can create a dataset
[18:01:53] <amln> yeah, that's a work-around
[18:06:23] <wardi> or disallow sign ups but create a form that allows requesting access
[18:07:32] <amln> as a ckan workflow?
[18:08:31] <wardi> as a new controller (and maybe model) in a plugin
[18:08:59] <wardi> authorizing users feels different to e than an edit/create workflow
[18:13:44] <amln> hum. i'm not sure if it's worth ticketing.
[18:14:09] <amln> it kinda makes me think 'states' of users comes up again.
[18:14:47] <amln> (pending, active, suspended, deleted, purged)
[18:14:54] <wardi> that could work. when was that discussed before?
[18:15:18] <amln> was in general ckan? might have been under the glasgow project, though.
[18:15:39] <amln> (where user auth is against / pulled from Windows Azure Active Directory)
[18:16:19] <wardi> it's worth submitting that as an idea, sure
[18:16:21] <amln> but i think we've had some discussion in ckan terms under password management / resets.
[18:22:03] <amln> there we go https://github.com/ckan/ideas-and-roadmap/issues/112

2014-12-02
[09:53:55] <amercader> rossjones: master.ckan.org is back up
[09:54:23] <amercader> it wasn't you, it was crashing becasue who.ini still had openid stuff that has been removed
[09:54:46] <amercader> we need to document that in the changelog, I'll create an issue
[09:55:48] <rossjones> thx amercader
[09:55:53] <rossjones> glad to hear it wasn't me.
[09:56:06] <amercader> but the memeory leak appears to be there :(
[09:56:13] <rossjones> :(
[09:56:46] <rossjones> how long does it take to crash? is it a small leak or more of a flood?
[09:57:28] <amercader> rossjones: I dont' know yet, I haven't looked a t it. I just saw the master processes taking much of the ram on htop when I logged in
[10:26:19] <george_s> anyone know if theres a CKAN extension around that validates CSV resources?
[10:27:59] <george_s> Either that or something like CSVlint but with an API?
[10:52:46] <rossjones> george_s validates against a schema? Or just that the url exists? Or that the url exists and it is the format it claims to be?
[10:58:21] <george_s> hi ross... at the moment not looking for something to validate against a schema... just a test that a CSV is decently formatted.
[11:07:00] <rossjones> Loads of ppl have been asking for a csvlint extension, but csvlint itself is ruby so won't be straight-forward to integrate more tightly
[11:07:13] <rossjones> I don't know of much else.
[11:07:27] <rossjones> george_s if you're coming to the call, might be worth asking there too.
[11:09:05] <george_s> good idea - i'll be in the call.
[11:17:39] <george_s> I've been testing out running CKAN with Amazon's RDS postgresql database services and on the surface, I seem to be running everything alright inc. datastore and spatial search. On the surface, everything seems to work alright but would be intrested to know if anyone else has tried that and if there's any gotchas?
[11:52:02] <rossjones> george_s if we can't find a workable csv validation lib, I'd be up for working on one if you wanted to collaborate.
[11:52:08] <rossjones> perhaps using the csvlint schema
[11:53:28] <amln> there's https://github.com/okfn/is-it-csv/issues/1 in spec.
[11:54:01] <amln> i'm trying to remmeber if seanh's metadata tools extensions did something CSV-ey.
[11:54:44] <amln> http://seanh.cc/posts/datapackager/ is the blog post.
[11:58:16] <george_s> ross, it would be definitely be good to explore this further down the validation path. It would be good to see if seanh's tools have solved some of the problem
[11:58:49] <rossjones> I think it's more about validating the data, rather than validating it exists.   Sean's thing might be good, but I'm not sure datapackage metadata/validation is complete enough.  The push for csvlint in local gov isn't a technical one ;)
[12:00:17] <rossjones> Oh, has http://dataprotocols.org/json-table-schema/ been extended since I last looked at it?
[12:01:28] <george_s> Getting CSV validation for this would be a good start http://dataprotocols.org/tabular-data-package/#csv-files
[12:03:00] <rossjones> Think it uses http://dataprotocols.org/json-table-schema/ but not sure where code is, or if it exists.
[12:03:03] <rossjones> Are we having a call?
[12:03:10] <amercader> yes
[12:03:15] <amercader> woo
[12:03:26] <wardi> https://plus.google.com/hangouts/_/event/cb1vmkss426lkqicj94a3amvd1c?authuser=0&hl=en-GB
[12:04:15] <amercader> joet: ^
[12:49:55] <amercader> https://github.com/ckan/ckan/issues/1784
[12:55:04] <nigelb> rossjones: I'm glad amercader sorted you. I'm on vacation this week :)
[12:58:26] <rossjones> nigelb oh sorry - hope you're having a good time!
[13:01:04] <george_s> agh, closed the google hangout window before i copied that link... ross could I get that link from you again?
[13:01:25] <rossjones> https://github.com/theodi/csvlint.rb is the gem, https://github.com/theodi/csvlint is the website.
[13:01:42] <rossjones> I've just checked, they have "an alpha api with no docs" atm. so gem *might* be the best way short term
[13:02:10] <wardi> or just post to their web form :-P
[13:02:20] <rossjones> well, the api is pretty much that - https://github.com/theodi/csvlint/blob/master/features/api.feature
[13:02:28] <rossjones> describes what you should post to
[13:03:11] <george_s> thanks ross. I think the gem might be the way to go if there's no API docs.
[13:08:15] <nigelb> rossjones: no worries, I just mentioned in the context that my replies would be slow :)
[14:12:02] <rossjones> george_s I found more docs - https://github.com/theodi/csvlint/wiki/Webservice
[14:12:06] <rossjones> oh, he's gone
[14:42:55] <amln> hum. is it possible to add custom metadata to groups? Say I want to add a "publication scheme: yes/no" value.
[14:42:58] <amln> or not?
[14:43:17] <wardi> amln: it is
[14:43:27] <wardi> groups have extras like packages
[14:43:28] <amln> ah, marvellous ;)
[14:43:34] <amln> i was trying to think where to look
[14:43:51] <wardi> and an IGroupForm that almost works as well as IDatasetForm
[14:46:26] <amln> marvellous ;)
[14:46:28] <amln> thanks

2014-12-01
[12:38:30] <rossjones> fanstatic totally failing to work for me today, and dying silently :(
[12:41:31] <wardi> lets kill it while it sleeps
[12:49:08] <rossjones> I might just go and have a little cry in the corner instead.
[14:01:24] <wardi> or that
[17:31:04] <rossjones> I broke http://master.ckan.org :( Sorry.
[17:51:54] <rossjones> nigelb could you kick http://master.ckan.org please?

2014-11-30

2014-11-29

2014-11-28
[03:52:53] <nigelb> wardi: that was too late for me yesterday :)
[03:53:13] <nigelb> Side note, I'm going to be west of you next week. In Portland :)
[10:36:48] <nigelb> I hate to be the bearer of bad news, but it looks like ckan master may have a memory leak.
[12:02:59] <wardi> nigelb: portland is a great town
[12:04:36] <nigelb> :)
[12:04:41] <nigelb> I've been told :)
[12:09:10] <nigelb> wardi: Also, I think there's a memory leak in ckan master
[12:09:17] <nigelb> master.ckan.org has contantly been eating up memory.
[12:09:29] <nigelb> Which is pretty much bare ckan to begin with.
[12:09:49] <nigelb> I don't know *how* to file a useful issue about it.
[12:34:21] <wardi> meliae dump memory?
[12:35:42] <wardi> i think that's the thing i used before. you can group the object by type and see what ojects are leaking
[12:37:15] <nigelb> I'll pass it on.
[12:37:23] <nigelb> I'm finding it out with my sysadmin hat.

2014-11-27
[16:01:48] <wardi> going to have to try this with 3g again. someone got the meetup link?
[16:11:00] <wardi> dev meeting? https://plus.google.com/hangouts/_/event/cb1vmkss426lkqicj94a3amvd1c?authuser=0&hl=en-GB
[16:17:18] <wardi> i guess not
[16:24:12] <wardi> joet, rossjones, seanh, nigelb: is this just not a good time of day?
[16:27:43] <rossjones> Not a good day for me.
[16:27:59] <rossjones> Am on non-ckan work today and friday each wk
[16:28:13] <rossjones> I bet everyone forgot
[16:28:29] <rossjones> wardi this does not mean you get to assign all the issues to whoever you want though.
[16:28:40] <wardi> too late!
[16:28:56] <wardi> (kidding)
[16:46:49] <LauraJ> this must be the middle of the night for nigelb ...
[16:47:38] <wardi> LauraJ: he's been known to stay up past his bedtime
[16:47:53] <LauraJ> i know :)
[20:55:28] <travis-ci> ckan/ckan master a94558f http://travis-ci.org/ckan/ckan/builds/42343726 David Read: The build was broken.

2014-11-26
[00:12:10] <petronela> hellooo
[00:37:28] <petronela> ping
[01:46:57] <wardi> petronela: hello
[01:47:05] <petronela> hello
[01:47:26] <wardi> welcome to #ckan, we discuss ckan software development here
[01:48:27] <wardi> we might not know about specific datasets that may or may not be hosted on ckan instances out there
[01:49:30] <petronela> thank you, I wanted to know if there are updated online resources that I can use, especially considering what I need is something very "generic"
[01:50:43] <petronela> can you recommend me some trusted datasets?
[01:52:13] <petronela> not necessarily related to my request, but something I can use to make a better picture of what to look for, so I can refine my searches
[01:52:36] <petronela> for example, the keyword "dataset" is a good one
[01:54:57] <wardi> you're welcome to hang around, someone might have some ideas (more likely in the morning GMT time)
[01:56:33] <petronela> thanks
[01:56:49] <petronela> in the meantime I'm investigating the links provided here: https://www.google.ro/?#q=countries+dataset
[01:57:14] <petronela> interesting, but I'm still looking out for my best choice
[01:59:20] <petronela> well, this is interesting: http://peric.github.io/GetCountries/
[07:19:11] <rossjones> rgrp where has http://datasets.okfn.org gone?
[11:02:08] <Guest31146> I saw the CKAN-2.2.2-release-branch on github - is it already recommended to install this release?
[11:02:49] <Guest31146> ...or is CKAN-2.2.1 still better at the moment?
[11:05:48] <rgrp> rossjones: do you mean http://data.okfn.org/ ?
[11:06:08] <rgrp> there  never was a datasets.okfn.org ...
[11:06:33] <rgrp> petronela: i think you may want http://data.okfn.org/data/
[11:06:50] <rgrp> especially teh core stuff - see also http://data.okfn.org/roadmap/core-datasets
[11:07:18] <rgrp> petronela: see also http://data.okfn.org/data/core/country-codes ...
[11:07:32] <rgrp> (and more ...)
[12:53:11] <petronela> thanks, rgrp
[13:18:41] <rgrp> petronela: if you are interested in contributing see http://data.okfn.org/contribute plus the discussion forum http://discuss.okfn.org/category/open-knowledge-labs/data-packages-and-frictionless-data
[15:56:32] <davidmiller> Afternoon #ckan !
[15:56:47] <davidmiller> I'm looking for some documetation on CKAN's awesome advanced search features...
[15:56:51] <wardi> good morning
[15:56:57] <davidmiller> I am abjectly failing to find it in the CKAN docs.
[15:57:02] <davidmiller> I have found this: https://github.com/kata-csc/kata-packaging/blob/master/doc/search-help.txt
[15:57:11] <davidmiller> But was wondering if there was anything officially maintained?
[15:57:21] <davidmiller> wardi: Timezones are awesome.
[15:58:24] <wardi> davidmiller: that should be part of our docs, but isn't yet. we rely on solr for search, so anythin that solr supports should work (pretty much)
[15:58:48] <rossjones> rgrp I recall seeing it in a github repo's readme somewhere.
[15:59:15] <wardi> the parts that don't work might be the fault of our controller that used to support searching the db directly as well
[16:00:47] <davidmiller> wardi: Presumably you'd accept a patch containing the Search Guide I'm about to write?
[16:01:19] <wardi> davidmiller: absolutely. It should be linked from the package_search API docs too
[16:01:47] <davidmiller> Shure.
[16:03:16] <rossjones> rgrp looks like it was a thing once - https://lists.okfn.org/pipermail/okfn-labs/2013-February/000589.html - but not the same thing
[16:04:08] <wardi> there was someone asking on the list just today about searching for strings starting with a given value
[16:04:25] <wardi> I didn't even know about the foo* syntax
[16:08:14] <rossjones> wardi I think he wants substring matches for search, you can solr to do it, but it almost certainly won't be nice
[16:10:30] <wardi> so currently you have to specify the field for a prefix search (or use the combined content field for all of them)
[16:10:55] <wardi> arbitrary substring would mean walking the whole index, no?
[16:12:26] <rossjones> I think you can tell solr to return partial matches, but you end up with a huge index.
[16:14:29] <wardi> right
[16:15:10] <rossjones> http://www.wunderkraut.com/blog/apache-solr-configuring-partial-word-search-functionality/2012-12-12
[18:49:15] <slifty> Hey all, thought I'd show the first launched version of the site I was peppering this channel with questions about :)
[18:49:18] <slifty> http://ctdata.org
[18:58:53] <wardi> slifty: cool. what are the /visualization views built with?
[18:59:52] <slifty> a blend of custom code and http://www.highcharts.com/
[19:16:57] <rossjones> slifty that looks really nice.
[19:17:09] <slifty> Thanks rossjones!
[19:17:51] <rossjones> My only 'complaint' so far, is that when searching by topic the headers (i.e. Chronic Disease) look like links, but the links look like plain text ;)
[19:20:14] <rossjones> slifty do you have a github for issues in case I find any?
[19:21:45] <slifty> ross not yet, but soon
[19:21:50] <slifty> and just to be clear you *will* find them
[19:23:23] <rossjones> That's okay, you'll find plenty on all of my ckans :) Just thought it'd be useful to record them for you if I find any.  Not that Connecticut is close to me (so not useful in that sense).
[19:25:41] <rossjones> Also slifty, don't forget to fill in http://ckan.org/census/

2014-11-25
[16:16:12] <wardi> brook_: run setup.py develop in the ckan dir?
[16:16:43] <brook_> wardi: Yeah - in ckan and in the extension
[16:16:45] <wardi> brook_: or hack out the "plugin" that isn't from setup.py
[16:18:25] <wardi> (I don't like embedding html from users in my sites anyway)
[16:56:14] <brook_> The tests run on Travis (they're all broken, but they run). I'll build a new venv.
[18:44:46] <wardi> rossjones: I feel like we're being trolled on ideas#30
[18:45:18] <rossjones> Almost certainly :)
[18:45:44] <rossjones> And their anecdata is worse than mine.  All flask users are beginners...pfft
[18:45:55] <wardi> should I just delete those replies?
[18:46:22] <wardi> "and if you ignore flask pyramid is number 2!"
[18:48:25] <rossjones> Nah, just leave em up. Somebody might wanna have some fun.
[18:48:32] * rossjones looks around shiftily
[18:51:20] <rossjones> wardi Would be good at some point to see if there's a consensus at all about what we should consider to people can start playing with ideas and prototypes.  Any idea how to get that consensus?
[18:53:03] <rossjones> http://pyramid-cookbook.readthedocs.org/en/latest/logging/sqlalchemy_logger.html
[18:53:05] <rossjones> No. Just no.
[18:59:23] <wardi> you know, it would be much easier to update sites if our source code was in the db too </terribleideas>
[19:03:17] <rossjones> I think I might just ignore the trolling and go drink a beer ;)  ttfn
[19:05:39] <amln> let's just rewrite it in Go.
[19:05:53] * amln stops
[19:14:03] <joet> wardi 1.5 is a bigger number that 0.1, so pyramid wins
[19:34:53] <wardi> joet: can't argue with math
[19:39:22] <rossjones> amln that's a tempting idea :)
[19:39:30] * rossjones has beer and is happy
[19:39:53] <wardi> rossjones: I hear static linking is the future
[19:41:23] <rossjones> It's lovely. Built something for London in Go.  Installation was instantaneous and I've not heard from the server since :)
[19:41:35] <rossjones> As in, it hasn't complained, not that it disappeared off the net :)
[19:42:41] <rossjones> There's always Ruby
[19:43:36] <wardi> rossjones: how do you manage updating it when linked libraries have vulnerabilities?
[19:43:57] <rossjones> rebuild and redeploy < 5 seconds.
[19:44:29] <rossjones> buildtime really does make it feel like it is interpreted, except you get errors really early
[19:44:47] <rossjones> I think though seriously it might be too big a leap
[19:48:02] <rossjones> Maybe we should just stay with Pylons :(
[19:48:45] <wardi> a data transformation service in go would be nice
[19:50:49] <rossjones> like the jsonp.appengine thing?
[19:55:02] <wardi> just trying to think of a cpu bound thing that might work with ckan
[19:56:58] <rossjones> Think most of the benefit of Go is in a mix of the two, iobound and something that will benefit from concurrency
[23:49:54] <petronela> hello
[23:50:02] <petronela> anyone still here?
[23:51:35] <petronela> is there a good place to get a current (full) list of countries, population and the country capitals?
[23:51:52] <petronela> something in CSV would be great
[23:53:04] <petronela> Wikipedia is OK-ish but I wanted to build a basic table and getting the information from them requires a lot of text editing

[10:02:57] <nigelb> I finally figured out how to extract translation strings from an extension today.
[10:03:02] <nigelb> I think I'll be adding a page to the wiki.
[10:04:14] <nigelb> It took a bit of time reading way too much documentation :\
[10:32:56] <wardi> nigelb: cool!
[10:33:43] <wardi> merging translations would be great
[10:35:16] <nigelb> wardi: We've done the work before.
[10:35:27] <nigelb> wardi: merging is messy.
[10:35:33] <nigelb> there can only be one .mo file.
[10:37:25] <wardi> sorry, merging is mostly solved (just not nicely yet) but extracting extensions strings is way better than entering them manually
[10:38:34] <nigelb> wardi: yeah, it's not hard ot do, just not nicely, yeah.
[10:39:15] <nigelb> wardi: https://github.com/ckan/ckan/wiki/Translations-and-Extensions
[10:40:16] <nigelb> There's more.
[10:40:22] <nigelb> But I want to have lunch first.
[10:42:49] <wardi> a 'paster merge-translations' command that works for extensions following this directory pattern would be a little magical but not too bad
[10:44:05] <wardi> force the user to change their i18n directory first
[10:58:21] <nigelb> I hate magic.
[10:59:39] <nigelb> It's not very pythonic, to begin with to have magic.
[11:15:55] <nigelb> wardi: Is this how you said merging is solved? https://github.com/okfn/ckanext-mx/blob/master/bin/build-combined-ckan-mo.sh
[11:16:13] <nigelb> I'd like to add it to the documenation. So if there is a better way, let me know.
[11:46:11] <nigelb> I've emailed the dev list.
[11:46:23] <nigelb> I've just added a random folder structure that made sense to me.
[11:46:31] <nigelb> I could be completely wrong.
[12:02:18] <wardi> https://plus.google.com/hangouts/_/event/cb1vmkss426lkqicj94a3amvd1c?authuser=0&hl=en-GB
[12:08:47] <rossjones> https://github.com/ckan/ckan/pull/2088/files#diff-c6d9602cc96e58ae6c960307ca46eeb4L43
[12:53:47] <rossjones> Chrome crashed my mac :(
[12:53:57] <joet> oh yeah and the get and post arguments are seperated in flask controllers whereas they are combined in pylons
[12:54:00] <george_s> what's the schedule at the moment for 2.3 release?
[12:54:12] <rossjones> george_s December.
[12:54:15] <rossjones> 2014
[12:54:27] <joet> so we'd need to untangle alot of that in our code.
[12:55:04] <wardi> joet: just at the routing level
[12:55:51] <rossjones> Maybe that'd be a good thing to do anyway :)
[12:55:56] <george_s_> rossjones thanks.
[12:56:05] <joet> yeah i generally think it's better
[12:56:46] <joet> but i know in places our code will have just looked at request.params, I think seanh's blogpost a while back suggested seperating everything out in a managable way
[12:57:30] <wardi> yes. global state bad.
[13:08:06] <rossjones> removing use of c and g will be a nightmare no matter what :(
[13:09:23] <nigelb> agreed
[13:09:28] <nigelb> but the code will be so clean afterward!
[13:11:38] <nigelb> though, I suspect we might break extensions.
[13:17:02] <rossjones> oh wait, flask has a g for global context on that request.
[13:20:03] <rossjones> c = flask.g should do it ;)
[13:21:06] <nigelb> it should do that job
[13:21:11] <nigelb> but I really don't want to use c :)
[13:24:08] <wardi> rossjones: we make a ckan-emulate-pylons package that provides pylons.c that uses flask.g
[13:26:35] <rossjones> what about pylons.g? THat can just be a global read-only dict can't it?
[13:27:05] <joet> yeah but each framework is going to throw their own variables into it right?
[13:27:20] <joet> pylons probably sets up its own stuff in c
[13:27:26] <joet> that we use everywhere in our templates/elsewhere
[13:27:34] <joet> c.user?
[13:27:51] <joet> so just doing a blanket replacement i think will be painful
[13:27:51] <rossjones> joet flask.g is the equiv of pylons.c
[13:28:05] <rossjones> monkeypatch ftw!
[13:28:05] <joet> but they put their own objects in there is what i'm sayiing
[13:28:19] <rossjones> joet am sure we could add a level of indirection
[13:28:25] <wardi> it's a separate issue that will take longer to fix, in my mind the important thing is for end users extensions to keep working (ideally unmodified)
[13:28:33] <rossjones> flask.c.our_context = {}
[13:28:49] <rossjones> pylons.c = flask.g.out_context
[13:28:54] <joet> wardi, I don't think that one is going to be possible if the user extensions have their own controllers
[13:29:06] <joet> (unmodified that is)
[13:29:08] <rossjones> better we encourage everyone not to use c :)
[13:29:11] <joet> yes
[13:29:16] <rossjones> user should be on the request anyway I feel
[13:29:52] <wardi> joet: I don't know enough about pylons controllers, what's the thing that makes them hard to wrap?
[13:32:02] <wardi> I think we could start with the action api as a flask application, even in parallel with the current code base
[13:32:10] <joet> probably the annoying thing will be the different implementation of webob and werkzeug is what i'm worried about
[13:32:39] <joet> because we allow direct access to the request and response objects in plugins.toolkit
[13:33:07] <wardi> those could be faked or wrapped, no?
[13:33:45] <joet> you could wrap them but we'd end up with a pretty horrible layer inbetween i think
[13:33:49] <wardi> PylonsFlavouredRequestObjectWrapper
[13:35:45] <nigelb> wardi: I'm assuming this means there's a strong plan to move to Flask?
[13:37:57] <wardi> nigelb: no strong plans yet, just developers grumbling
[13:38:34] <rossjones> nigelb yes
[13:38:36] <rossjones> :P
[13:38:50] <wardi> hehe
[13:41:14] <rossjones> I'd also love to move some stuff out of the ckan directory, stuff like templates, public, tests, pastertemplates.
[13:41:50] <rossjones> think it'll be a lot less intimidating if there's just config, i18n, controllers, models, logic,
[13:42:05] <rossjones> but expect that'll great LOTS of stuff
[13:43:38] <rossjones> maybe we could cleanup the bin directory as well, it's chock full of one-off helper scripts that could just as well be elsewhere.
[13:44:18] <rossjones> alias paster='find / -type d ckan | xargs sudo rm -rf'
[13:44:33] <rossjones> *grumble grumble*
[13:44:53] <nigelb> I really w to get rid of stuff like paster load
[13:45:04] <nigelb> It's a useless abstractiion
[13:56:20] <nigelb> one more person trips over the num_followers and package_count issue on IGroupForm.
[13:56:28] <nigelb> Can't wait for 2.3 to be released.
[14:41:22] <brook_> I'm having a problem running tests for the extension I'm building. Getting an error "ImportError: No module named webpageview.plugin". Anyone encountered this before? http://pastebin.com/QTjWgzKu
[14:50:20] <rossjones> brook_ it *looks* like it's been told to load a plugin but the setup.py references it wrongly. I could be wrong (as usual).
[14:51:59] <rossjones> or there's a missing __init__
[14:53:37] <brook_> rossjones: this is one of those 'it was working a few weeks' ago', and now it isn't. I've checked out an older ckan, but still no joy.
[14:55:21] <rossjones> find . -name '\''*.pyc'\'' -delete   ?
[14:58:47] <brook_> nope :(
[14:59:47] <joet> brook_, what branch are you one?
[14:59:55] <brook_> master
[15:00:27] <joet> webpageview is one of the new plugins which is a forced plugin
[15:00:28] <joet> one sec
[15:00:33] <rossjones> ahh
[15:04:30] <joet> i can't find the issue atm
[15:05:05] <joet> adria would be able to answer this one quicker i can't remember hwo to get around it
[15:07:54] <brook_> joet: I've checked out ckan from around the time I was last working on this and still get the same issue.
[15:08:04] <joet> hmm

2014-11-24
[08:37:58] <rossjones> Can anyone remember where we were talking about cookies and API requests? wrt ckan-security mail
[09:21:59] <davidmiller> rossjones: Pub?
[09:38:36] <rossjones> davidmiller hah
[10:01:43] <amln> mishari: do you need sorting on transiflex?
[10:01:48] <amln> still
[10:02:11] <mishari> @amin hi! no thank you.. all's sorted.. the sprint completed successfully and Thai language is 100% :)
[10:02:50] <amln> Amazing!
[10:03:03] <amln> mishari: in my ignorance, is Thai right-to-left or left-to-right?
[11:27:15] <amln> rossjones: are things like https://twitter.com/LeedsDataMill/status/528169580699471872 manual, or automated?
[11:28:20] <amln> (why doesn't the twitter website show me what bloody created the tweet!)
[11:30:56] <rossjones> amln I have no idea.
[11:31:00] <rossjones> Think it's a human.
[11:31:00] <amln> :)
[11:31:52] <amln> rossjones: i couldn't see anything that looked like it might do it in https://github.com/LeedsDataMill/Ckan (on a two min look)
[11:37:58] <rossjones> It's on bitbucket atm.
[11:38:08] <rossjones> but you're right, there is no auto-tweeting code.
[11:44:47] <kuhgel> Hello, I have a question regarding openid: is openid-authentication still included/activated? - When yes - how is it possible to deactivtate it?
[12:11:25] <mishari> amin: same as left to right, same as english
[13:31:44] <rossjones> I'd like to fix the ckan json encoding so that it accepts generators so that you can give it large lists without using up lots of ram.  Is that a ckan issues item or an ideas-and-roadmap ticket?
[13:32:15] <wardi> rossjones: I support that, the last time I tried to make json encoding lazy it got rejected
[13:32:21] <rossjones> by ?
[13:32:34] <rossjones> If you've got a PR I'll merge it :)
[13:33:54] <rossjones> I'm thinking the api controller can just write the response, rather than returning a huge string which doesn't do anything (no templates to render it into). Paired with generators in the 'json' it should make quite a difference.
[13:34:07] <wardi> rossjones: mine didn't have generator support, it just allowed the json from solr's validated_data_dict to be passed straight into the response (instead of parsed and then serialized)
[13:34:14] <rossjones> Ah.
[13:35:01] <rossjones> I'd really like the last line of _finish in the api controller to look like ``` json.dump( response, json_obj, encoder=UsefulEncoderThatUnderstandsGenerators)
[13:35:28] <rossjones> writing to response should push the headers through as well.
[13:36:12] <wardi> https://github.com/ckan/ckan/pull/1105
[13:37:04] <rossjones> And no discussion on the ticket as to why it won't be merged :(
[13:38:21] <wardi> if we're talking about a lazy json encoder I think passing already-valid-json through could be part of that
[13:38:22] <amln> shove it on the agenda for the next ckan meeting?
[13:39:02] <rossjones> Will re-open.
[13:39:06] <wardi> generating json lazily without generating huge strings in memory is something that has to be supported by the framework and web server, no?
[13:39:29] <wardi> chunked encoding or some such
[13:39:31] <rossjones> ish.
[13:40:04] <rossjones> at the moment you've probably got - the original dict, the json buffers, the resulting string. the result string is passed all the way through to wsgi and then to apache.
[13:40:22] <rossjones> We may as well investigate writing directly to the response stream so that we're not holding it all in ram.
[13:40:51] <rossjones> think it'll possibly bypass the problem alice was having in her datastore api calls
[13:41:02] <wardi> we need to think about really large inputs too
[13:41:32] <rossjones> Yup.
[13:41:42] <wardi> hey, you know what's really good for streaming lots of json data? jsonlines
[13:42:04] <rossjones> ???
[13:42:19] <rossjones> http://jsonlines.org/?
[13:42:35] <wardi> yeah, my pet favourite format
[13:42:38] <rossjones> ah, that looks useful for continuous streams of discrete objects :)
[13:43:17] <rossjones> Also logged a bug this morning about the unnecessary get_package_type stuff in package controller - if someone's looking for an easy small win ;)
[13:43:30] <rossjones> https://github.com/ckan/ckan/issues/2080
[16:42:23] <ntoll> hi... is there documentation anywhere for exposing / describing SOLR related advanced search-fu to users who need it..?
[16:43:03] <ntoll> specifically, examples of say "X AND (NOT Y)"

2014-11-23
[11:35:52] <daonb> hi from TLV, I'm trying to add the hebrew translation files
[11:36:30] <daonb> so I first need to setup a dev env and the readme is no help
[11:40:48] <daonb> I'm running 'pip install -r requirments.txt' what's next?
[11:43:36] <daonb> found a Dockerfile. trying 'sudo docker build .'
[12:26:20] <wardi> daonb: try the installation docs on docs.ckan.org
[12:44:05] <daonb> wardi: I tried, couldn't find devleopers' docs
[13:25:23] <daonb> I've got docker container 'fig_container' running, but http://ckan.localdomain:8080/ is not there

2014-11-22
[00:43:47] <mishari> Hi! I'm organizing a sprint today to get ckan localized into Thai
[00:43:53] <mishari> it'll start in about 2 hours
[00:44:04] <mishari> but I don't have coordinator access in transifex
[00:44:16] <mishari> my username is misharim
[00:44:40] <mishari> could someone kindly add me as a coordinator please?
[01:05:11] <wardi> mishari: I would but I don't have a transifex login
[01:05:32] <wardi> amln ^?
[01:05:51] <mishari> wardi: ah, thanks, know how I can reach one of the people listed as the maintainers?
[01:06:11] <mishari> bboissin okfn oovrebo jwyg pudo dread amercader seanh johng
[01:06:31] <wardi> seanh ^
[01:09:57] <wardi> unfortunately it's 1am where most of them are
[01:10:48] <wardi> mishari: what does coordinator access do?
[01:10:50] <mishari> it is.. but hopefully someone is a night person
[01:11:03] <mishari> it allows me to give participants translator access

2014-11-21
[18:47:10] <travis-ci> ckan/ckan 2042-invalid-page-numbers acb3e7f http://travis-ci.org/ckan/ckan/builds/41742192 David Read: The build was broken.
[19:26:36] <bilthekid> whois

[04:29:04] <slifty> Greetings everyone!
[04:29:16] <slifty> QueuePool limit of size 5 overflow 10 reached, connection timed out, timeout 30 <-- that means someone wrote really crappy code that didn't close connections, right?
[04:29:19] <slifty> ;)
[05:59:29] <slifty> Hmmm -- I doubt anybody is up, but if you know where I can increase the pool size for sqlalchemy that would be super cool
[07:16:33] <rossjones> slifty I can recomment pgbouncer, used it a few times now, never let me down.
[07:16:40] <rossjones> s/recomment/recommend/
[07:16:48] <slifty> awesome :)
[07:16:49] <slifty> thanks!
[07:18:42] <slifty> regardless, if I'm getting queuepool limits from not too many users, that probably means there is connection management issues in my custom code I'm betting...
[07:18:51] * slifty adds two items to the to-do list
[07:19:20] <rossjones> My ini file (note default_pool_size) is at https://gist.github.com/rossjones/1e4253cd6e948100b94d
[07:19:38] <rossjones> should be able to apt-get install, copy the config, change the config, set you sqlalchemy.url to port 6432
[07:19:39] <slifty> oh nice ;)
[07:20:31] <rossjones> Yes, possible if you're doing funky stuff with sqlalchemy.
[07:20:57] <rossjones> on dgu postgres normally runs out of connections before sqlalchemy complains.
[13:06:24] <slifty> nuts, pgbouncer doesn't like being run as sudo, but it also doesn't seem to be allowed to bind to port 6432
[13:10:27] <wardi> that's odd. i thought only 0-1023 were priveleged
[13:10:42] <slifty> exactly :P
[13:11:36] <wardi> what's the error?
[13:12:06] <slifty> WARNING Cannot listen on unix:/var/run/postgresql/.s.PGSQL.6432: bind(): Permission denied
[13:12:19] <slifty> I imagine I'm doing something super dumb :-/
[13:12:33] <wardi> that's a unix socket
[13:13:26] <slifty> hrm
[13:14:17] <slifty> if it helps, I also get 2014-11-21 13:11:41.880 5633 FATAL @src/main.c:553 in function write_pidfile(): /var/run/postgresql/pgbouncer.pid: Permission denied [13]
[13:16:13] <slifty> as an aside, even if I can just increase my queuepool limit from 5 to 100 I think my problem would be largely solved
[13:16:31] <slifty> I just don't know where to do that -- the point is pgbouncer might be overkill if I can just increase the pool limit
[13:22:38] <slifty> (by the way, thanks for pointing out the socket :P  I'm running on not enough sleep)
[13:27:32] <seanh> rossjones: What exactly was the problem you were having with dependencies begin specified in install_requires, and packages refusing to run if the right dependency wasn't installed?
[13:28:12] <seanh> I can see that if a dependency fails to install when you install your package (e.g. package specifies a version that doesn't exist) then when you try to run something from the package you get DistributionNotFound
[13:28:55] <seanh> But if I install package A with dependency requests==2.4.3 and then package B with dep requests==2.4.2, both will install fine, I'll end up with requests 2.4.2, and both will run fine
[13:29:19] <seanh> Of course if A really doesn't work with requests 2.4.2 then I have a problem
[13:29:45] <seanh> But I don't see how moving the dependency specifications into a requirements.txt file makes any difference
[13:34:18] <seanh> I'm starting to wonder if there's ever any reason to use a requirements.txt file. It doesn't have any advantage over install_requires that I can pin down, just seems to add an extra step to your install instructions for no reason (and also mean people can't depend on your package as if it were a lib because its dependencies won't be installed automatically)
[13:37:04] <amln> slifty: what are the perms om the socket?
[13:37:23] <slifty> amln: I fixed it up once I realized it was a unix socket :)
[13:37:28] <amln> :)
[13:37:36] <slifty> it's running!  Now I'm at the next phase of the debug chain ;)
[13:37:43] <slifty> or rather, the setup chain
[13:53:34] <slifty> yay!!! it lives!!!
[13:53:52] <slifty> now to set this up on prod.
[14:03:28] <rossjones> seanh we have package1 have install_requires with requests==0.12 and package2 with install_requires of requests==2.4.3 (for instance).  python setup.py them both and ckan was complaining when we ran.
[14:03:46] <seanh> Hmm
[14:04:01] <seanh> Is that a CKAN thing? setuptools would not complain about that I don't think
[14:04:03] <rossjones> it was definitely requests, perhaps it was out qa and harvester, I can't remember.
[14:04:09] <rossjones> It's not a ckan thing.
[14:04:15] <seanh> It would just run it with requests 2.4.3
[14:04:32] <rossjones> and if you installed them in the other order?
[14:04:45] <rossjones> I can't replicate it atm, but it was definitely a thing ;)
[14:06:07] <rossjones> seanh an example of the error line is "pkg_resources.VersionConflict: (WebOb 1.2.3 (/Users/inflector/software/new-day/reddit/dev/lib/python2.7/site-packages), Requirement.parse('webob==1.0.8'))"
[14:06:27] <seanh> I made two minimal packages foo and bar, with dependencies requests==0.12 and requests==2.4.3 in setup.py. Make a new virtualenv, install foo, install bar, run foo, run bar, nothing complains
[14:07:22] <seanh> Hmm, maybe there's some corner or special case, or it no longer happens with current versions of setuptools
[14:07:55] <rossjones> maybe it's old setuptools?
[14:09:30] <seanh> The only reason for using a requirements.txt that I've found so far that seems to hold water is for a particular deployment or instance of an app. Data.gov.uk for example, you want a virtualenv with CKAN plus various extensions and other stuff installed. And you want to be able to reproduce that virtualenv in multiple places such as dev and prod with no differences between them. So produce it once then do pip
[14:09:32] <seanh> freeze > requirements.txt
[14:09:48] <rossjones> Yup.
[14:09:52] <seanh> But for any Python package that you actually distribute, such as CKAN, I don't get it
[14:10:18] <seanh> I can see why we might want to pin all direct and indirect deps in CKAN to make sure everyone gets the same env
[14:10:24] <seanh> But we can do that in setup.py
[14:10:57] <rossjones> but if it appears that there's a version of setup-tools/distribute which might cause an issue - perhaps it isn't workable?
[14:12:57] <seanh> For data.gov.uk, it is not itself a Python package that gets distributed or uploaded to pypi or anything, so it presumably doesn't have a setup.py file, so you use a requirements.txt
[14:13:15] <rossjones> sentry (which is my current go-to for how to do it right) use install_requires .... https://github.com/getsentry/sentry/blob/master/setup.py and https://github.com/getsentry/sentry-flowdock/blob/master/setup.py (
[14:13:42] <rossjones> seanh dgu is a ckan fork and an extremely large primary extension
[14:13:43] <seanh> It's an "environment" that you want to reproduce. Others have used the word "application" to describe this but that seems misleading to me
[14:14:08] <rossjones> seanh until someone can clarify for me whether ckan is an app or a framework, I'm not sure I'll know which is best.
[14:14:32] <seanh> (If I've written a Python app and now I want to publish it to pypi so others can install it easily I should use install_requires not a requirements.txt)
[14:15:02] <rossjones> I agree with that.
[14:15:08] <seanh> True, CKAN does sit a bit awkwardly between the two (but lots of things do that e.g. wordpress)
[14:15:34] <seanh> And neither an application nor a framework should come with a requirements.txt file, as far as I can see.
[14:16:44] <seanh> I'm wondering if requirements.txt was something invented for people deploying an "environment" like DGU, and it has ended up getting misunderstood and everyone using it to specify deps when distributing libaries and apps etc when they should be using install_requires
[14:17:17] <seanh> I blame the authors of pip probably, for not cleary documenting it anywhere that anyone seems to be able to find
[14:17:58] <seanh> Yeah what sentry is doing looks right to me
[14:18:22] <seanh> Also the use of "extras" in setup.py instead of additional requirements files
[14:18:37] <seanh> We could copy that and remove a step from our install instructions
[14:23:30] <rossjones> seanh you mean pip install ckan?
[14:24:02] <seanh> Yeah
[14:24:30] <seanh> Or for development, git clone ckan and then python setup.py develop, and no need to to the pip install -r step
[14:28:00] <rossjones> must be worth a try.
[14:28:23] <rossjones> be even nicer if virtualenv let you specify a pypi package to install
[14:28:30] <rossjones> virtualenv . --from ckan
[14:29:03] <rossjones> saying that I've switched to virtualenvwrapper and I'm never going back
[14:38:36] <seanh> I wonder if there's something about install_requires that means you can't actually use it to list all dependencies recursively with pinned versions like CKAN does in requirements.txt currently. As far as I know we could just move the contents of our requirements.txt into install_requires and it would work the same
[14:41:56] <seanh> A lot of people seem to make the distincation between install_requires and listing only direct deps with loose upper and lower version bounds, vs requirements.txt and listing all deps with exact numbers. But it's just not clear why you need to move to requirements.txt for that. Some people seem to claim that it's because install_requires dependencies are always checked at runtime, but in my testing that isn't
[14:41:58] <seanh> true (or is no longer true)
[14:57:30] <seanh> Bah, move CKAN's requirements.txt into setup.py, installing it crashes with "AttributeError: 'NoneType' object has no attribute 'get_script_header'" when it tries to install sqlalchemy-migrate
[14:57:44] <seanh> I guess setuptools sucks might be a good enough reason to stick with pip
[15:16:48] <rossjones> seanh sqlalchemy-migrate is eol anyway isn't it, aren't we supposed to be using alembic now or something?
[15:24:49] <amercader> rossjones: there is a fork from openstack that supports newer sqlalchemy
[15:25:06] <amercader> but happy to switch to alembic if it's nicer
[15:27:23] <rossjones> alembic is from sqlalchemy project isn't it.  Not sure I'd like to re-write all the migrations.
[15:41:56] <rossjones> bye d bye
[15:42:03] <rossjones> wrong window
[15:42:09] <rossjones> sigh
[16:19:18] <rossjones> amercader I have a fix for the paster issue, new PR or the old one?
[16:19:25] <amercader> new one please
[16:22:45] <rossjones> https://github.com/ckan/ckan/pull/2076
[16:23:17] <rossjones> Is today merge Friday?
[16:24:09] <rossjones> amercader do you reckon it is worth announcing a feature freeze at some point, or is there still a lot to do with resourceviews?
[16:55:17] <amercader> rossjones: sure, there  are a couple major things to merge though (#1752, #1852...)
[16:55:33] <amercader> generally I'd wait until 2.3 is branched to merge anything big
[16:57:08] <rossjones> 1752?
[16:59:00] <amercader> sorry, 1792
[17:02:07] <rossjones> ouch. scary prs.
[17:02:33] <amercader> yeah, we probably shouldn't let them grow this big and split them beform
[17:52:09] <amln> "data compendium" http://compendium.woodstockinst.org/
[18:28:46] <travis-ci> ckan/ckan 2042-invalid-page-numbers 737c4bd http://travis-ci.org/ckan/ckan/builds/41741558 David Read: The build was broken.

2014-11-20
[11:11:17] <seanh> This is weird, why is setup.py sdist for ckanserviceprovider building version 0.0.1dev-r0? The version num in setup.py is just 0.0.1. Grep finds no "dev-r0" anywhere. setup.py seems to be just doing that on its own
[11:12:29] <seanh> Ah, setup.cfg has tag_build=dev and tag_svn_revision=True. Where did that come from?
[14:30:28] <mih> Hi! Could anyone tell me when the temp-(subfolders) are created? - this isnt done via the db-init-statement, or?
[14:57:52] <wardi> mih: temp subfolders?
[14:58:34] <mih> sessions > container_file_lock
[14:58:37] <mih> e.g.
[16:00:13] <wardi> https://plus.google.com/hangouts/_/event/cb1vmkss426lkqicj94a3amvd1c?authuser=0&hl=en-GB
[16:24:53] <amercader> https://github.com/pulls?q=is%3Aopen+is%3Apr+user%3Ackan+sort%3Aupdated-desc+-repo%3Ackan%2Fckan+
[18:26:15] <rossjones> Amazed I didn't make the meeting AND didn't get any bugs assigned to me :)
[18:52:43] <wardi> rossjones: amercader was hogging them again
[19:00:42] <rossjones> wardi that's nice of him :)
[19:01:09] <rossjones> We should have an amercader amnesty where he can give up some of the bugs he doesn't really want but ended up taking because everyone was realllly quiet.
[19:02:47] <wardi> not a bad idea
[19:16:54] <rossjones> actually he's only got one more than you :)
[19:18:09] <rossjones> and Joet only one less than you. we definitely need to redistribute :)
[19:20:08] <wardi> most of mine are marked "CKAN 2.4"
[19:20:22] <rossjones> I might just start pinching bugs of ppl where the bug > 6m old.
[19:39:13] <amercader> wardi, rossjones: fear not, there are some 2.3 reviews coming, plenty for everyone
[19:40:51] <rossjones> Yay

2014-11-19
[21:08:13] <seanh> And it's still not perfect
[21:09:10] <seanh> I don't want to tell people to git clone and python setup.py install my extension. I want them to be able to just pip install it. But if they then have to do a pip install -r requirements.txt for it they will need the full path to wherever the requirements file has been installed to
[21:09:31] <seanh> And that depends on where their virtualenv is, so I can't give them a copy-pastable command in my install docs
[21:09:36] <seanh> So that sucks
[21:09:56] <rossjones> can you not trigger pip install as a build step in setup.py?
[21:10:05] <seanh> Also something like losser which is both a reusable library and a command-line app in itself, still does not fit into any of the categories!
[21:10:48] <seanh> Dunno ... But I think pip install not being triggered automatically is kind of the point
[21:10:49] <rossjones> probably why there are so many ways to package stuff in python.
[21:11:15] <rossjones> I guess I'm reasonably ambivalent - only ever bites me once during install and then I forget about it.
[21:11:23] <seanh> So it's still not perfect, but we have something, I might add a page about to the extension best practices
[21:11:26] <rossjones> and all dgu stuff is in a simple requirements.txt
[21:12:57] <seanh> I think for losser I would never use a requirements.txt - I really want the install for people using it as a command-line app to be just "pip install losser", quick and easy is one of the aims for things like that
[21:13:17] <rossjones> I agree, the less faff the better.
[21:13:31] <rossjones> I think it's the venv that throws people though.
[21:13:34] <seanh> Also even ckanapi-exporter, which totally could fit under the definition of an application which should have a full requirements.txt, I don't want to complicate the install
[21:13:34] <rossjones> perhaps.
[21:14:05] <seanh> So I guess for really simple apps like these, that have only a few simple dependencies anyway, it's install_requires
[21:15:09] <seanh> Well, sudo pip install, or pip install --user or whatever it is, you don't actually need to make a venv
[21:15:47] <seanh> Although pip installing into your home dir means you need whatever that bin dir is on your path, that confuses people as well
[21:17:07] <seanh> I think moving all deps not needed for production into extra files is a no-brainer though, requirements-tests.txt and requirements-docs.txt etc. Less deps need to be installed in production less problems
[21:18:51] <seanh> But it seems to me that using a requirements.txt for your production deps needs a good reason - it adds an extra step to the installo instructions, and if it contains pinned deps makes your thing less compatible with other things. So the default is minimal and loose install_requires, and only if you have a big app like ckan that really needs to ensure consistency between everyone's venvs then move to all deps
[21:18:53] <seanh> pinned in a requirements.txt
[21:19:15] <rossjones> This is why I like go so much. Copy the binary. Run the binary.
[21:19:40] <seanh> Yeah
[21:19:47] <rossjones> https://github.com/pyinstaller/pyinstaller/wiki/Features
[21:20:14] <seanh> It seems like if you put a lot of thought into the multiple different Python approaches and their pros and cons, then you can figure a good solution for any given case
[21:20:22] <seanh> But the problem is most people won't
[21:20:32] <wardi> rossjones: then find and patch all your binaries every time there's a vulnerability in libpng
[21:20:45] <seanh> And it's not really explained well anywhere central and obvious
[21:20:56] <rossjones> wardi installing a new binary is still easier than getting the requirements right at deploy time, rather than build time.
[21:21:21] <rossjones> seanh I think, and it's a guess, the python community is just avoiding talking about the packaging mess because, well ,because it's a mess.
[21:21:37] <rossjones> all packaging everywhere is a mess, even node.
[21:21:39] <rossjones> npm
[21:21:58] <seanh> Debian packaging is perfect
[21:22:06] <wardi> heheh
[21:24:02] <wardi> rossjones: java solves this by letting everyone bundle their dependencies (so you can have multiple vulnerable versions of limpng, yay!)
[21:24:11] <wardi> *libpng
[21:24:37] <rossjones> after you've downloaded the entire internet :)
[21:30:01] <rossjones> caffeine crash. nn.

[16:03:15] <seanh> I am not sure what this means for CKAN extensions meant to be installed into CKAN's virtualenv, though
[16:03:47] <rossjones> need to make sure they know what version of which libs is installed by core then I guess before they specify their own.
[16:04:04] <rossjones> and make sure they work with that (I'm looking at you LXML).
[16:04:05] <seanh> They should be requirements.txt as well I guess for the same reason: allow the person deploying them to edit the requirements for their specific case if they need to
[16:04:36] <rossjones> yeah.
[16:05:13] <amercader> sorry to interrupt, seanh , can you use ckanapi-exporter against a particular search?
[16:05:40] <amercader> ie, export only the datasets that match a query on package_search?
[16:36:50] <slifty> Hey all -- sorry for a dumb question, but when I restart my server I'm noticing it sometimes takes a long time for apache.wsgi to start actually becoming responsive (error logs are filled with "Script timed out before returning headers: apache.wsgi")
[16:37:15] <slifty> it's a bit unpredictable, and generally happens after I've updated my custom theme (even with simple content changes)
[16:37:25] <slifty> has anybody experienced something like this?
[16:41:40] <rossjones> slifty have you changed your apache.wsgi ?
[16:41:58] <rossjones> anything in ckan logs?
[16:42:00] <slifty> I have not -- it's just the standard one from the "install from source" / "production deploy" instructions
[16:42:36] <slifty> [Wed Nov 19 16:39:58.663365 2014] [core:error] [pid 1393:tid 140653862250240] [client 104.148.150.181:52079] Script timed out before returning headers: apache.wsgi, referer: http://54.148.35.136/
[16:44:25] <slifty> that's basically it :-/
[16:44:56] <slifty> is it possible that there is some type of data initialization that happens when a plugin has been rebuilt, and I just need to be patient?
[16:45:35] <rossjones> it'll be connecting to postgres and solr, but no real data pre-loading.  which extensions are you using?
[16:46:19] <slifty> stats text_preview recline_preview datastore  datapusher disqus pages custom_theme
[16:46:25] <slifty> (that last one is our own)
[16:46:37] <rossjones> presumably custom theme is just templates?
[16:46:42] <slifty> correct
[16:47:07] <rossjones> can we step back a bit, what is 'a long time' wrt startup?
[16:47:19] <slifty> it's been about 4 minutes
[16:47:24] <rossjones> Ahhhh
[16:47:36] <slifty> so if that's normal, I'm fine :)
[16:47:44] <slifty> I just want to be sure I'm not sitting around waiting for something broken!
[16:47:49] <wardi> that's not normal
[16:47:53] <rossjones> no, it's not instant (at least for me) but 4 minutes is a tad long
[16:48:27] <slifty> (I'm going to play the "disable plugin" triage game)
[16:48:30] <rossjones> check you can connect to db and solr, but sounds like it's hung somewhere. does it eventually become responsive.
[16:48:42] <slifty> unpredictibly, yes
[16:48:51] <slifty> and once it does, it works like a charm
[16:48:56] <rossjones> slifty you can short circuit the disable plugin game by removing all of them :)
[16:49:22] <rossjones> and this is from master or 2.2?
[16:49:33] <slifty> I believe 2.2, but I will confirm
[16:51:04] <slifty> disabling everything resulted in about 10s launch which feels about right
[16:51:15] <rossjones> yeah. try everything except your theme :)
[16:51:18] <slifty> (I'll go see if I can figure out the culprit plugin)
[16:51:58] <slifty> well, we all know it will wind up being the stupid theme :)
[16:52:06] <rossjones> :D
[16:52:11] <slifty> thank you for your help by the way
[16:52:27] <rossjones> No problem, submitted enough PRs today, don't want to get shouted at.
[16:52:30] <rossjones> Do you have lots of existing data?
[16:53:42] <slifty> we probably have around 20 datasets in the system
[16:53:56] <rossjones> ah okay.
[16:54:38] <slifty> (as an update, it restarted without the theme as well, will start exploring potential causes.)
[16:55:15] <slifty> bad news: restarting with the theme worked too.
[16:55:16] <slifty> so.
[16:55:36] <slifty> (I mean, good in that it works, bad as in now I still don't know why it ever didn't work)
[16:55:41] <rossjones> it's fixed! Ship it!
[16:56:07] <slifty> hahaha
[16:56:08] <rossjones> I hate hiesenbugs.
[16:56:12] <rossjones> and spelling.
[16:56:15] <slifty> hooray!  this channel is the best :D
[16:56:27] <slifty> anyway actually thank you -- next time this happens I'll do my plugin dance again
[16:56:49] <slifty> also possible that I just need to disable the script I added which counts the number of times I rebooted and only works on prime number reboots
[16:56:52] <rossjones> strace might be useful next time, find out if it's blocking trying to read a file or something
[16:57:03] <rossjones> hahaha
[16:57:24] <slifty> great tip!
[16:59:02] <amln> if in doubt, strace ;)
[16:59:13] <amln> or lsof ;)
[17:01:58] <rossjones> or gdb :)
[17:06:51] <rossjones> Anyone know if there's a workaround to https://github.com/ckan/ckan/issues/2029?
[17:08:18] <wardi> rossjones: amercader was going to try to catch and ignore the error from cli.py IIRC
[17:08:32] <rossjones> Ah ok, just someone on the list has bumped into it :(
[17:08:43] <wardi> yeah, we should point them at the issue
[17:08:47] <rossjones> will do
[17:08:51] <amercader> rossjones: we need something like "and command != db upgrade" here https://github.com/ckan/ckan/blob/d680a44bff3ef6fb865f3c41e9554a85222b00ac/ckan/lib/cli.py#L106
[17:09:34] <amercader> actually wardi is assigned to it :p
[17:09:51] <wardi> just 'cause I raised it
[17:10:16] <rossjones> I'll get the reporter to test out fix ;)
[17:13:17] <slifty> as an aside, since I'm now lurking in here, nice to meet everyone!
[17:13:32] <rossjones> hello slifty - nice to meet you :)
[17:13:35] <wardi> slifty: please, lurk away
[17:14:02] <slifty> I live in New York, background in civic tech mostly from the journo side of things but getting more involved in open data every day
[17:21:29] <rossjones> amercader I'll fix 2029 now, as long as we can agreed that cli.py is already junk and any short-cuts I might take to fix it can be removed from git blame.
[17:23:45] <rossjones> weren't we going to rewrite cli.py with LocalCKAN ?
[17:36:12] <rossjones> hmmm 2.1.3 docs missing on RTD
[17:36:18] <wardi> the package/read.rdf template was removed along with the legacy templates. should we have a new one as a jinja template?
[17:37:10] <amercader> wardi: wow, yes, we missed that
[17:37:11] <wardi> at least some people seem to be using the .rdf urls because we're getting some errors in our logs
[17:37:42] <rossjones> :( That's me.  Sorry.
[17:38:03] <amercader> rossjones: docs broken is this https://github.com/ckan/ckan/issues/1946
[17:38:07] <rossjones> If you create me a ticket I'll fix it :(
[17:38:14] <rossjones> rdf template, not the rtd :)
[17:38:40] <wardi> rossjones: sure
[17:38:53] <wardi> are there any others that should be recreated?
[17:39:49] <wardi> .n3?
[17:40:43] <amercader> n3 is broken, but I'd move it anyway (https://github.com/ckan/ckan/pull/348)
[17:45:10] <rossjones> it was always broken
[17:45:30] <rossjones> not getting site user during db upgrade appears to not run the upgrade :(
[17:46:26] <rossjones> oh, it's upgraded to 71, but it was very quiet.
[17:46:50] <wardi> yeah, I want noisy upgrades. with time stamps on each step executed
[17:47:24] <rossjones> there was no change to the output was there?
[17:47:40] <wardi> no, i think they've always been quiet
[17:47:56] <rossjones> ah, it's the init that's noisy.
[17:48:03] <rossjones> okay, I think I've fixed it then.
[17:48:13] <rossjones> Want the PR against 2.2.1 or master?
[17:48:25] <wardi> master first is the usual way
[17:48:29] <rossjones> ok
[17:48:48] <wardi> rossjones: man, you've been on a streak
[17:48:54] <rossjones> caffeine
[17:56:42] <rossjones> much too much caffeine.
[18:33:15] <adoyolo> any body here
[18:33:26] <adoyolo> i have few question
[18:34:16] <wardi> adoyolo: it's better to ask your actual question :-)
[18:35:27] <adoyolo> :) any body have any experience install latest version of ckan on windows server
[18:36:27] <wardi> adoyolo: windows server isn't currently supported, but if someone wanted to fix the compatibility issues, that would be nice
[18:37:03] <wardi> adoyolo: for development on windows virtualbox works nicely
[18:37:42] <adoyolo> ok i will try virtualbox
[18:37:54] <adoyolo> thanks
[20:16:32] <wardi> mmm. super_cookies
[20:26:07] <seanh> This is the best answer I found: https://pinboard.in/u:seanh/b:cf03e0696ccb
[21:03:17] <rossjones> seanh I guess that's a reasonable approach.  Easier for extension authors to change their install_requires based on what ckan has installed already
[21:05:27] <seanh> Well, extensions are a bit special
[21:05:53] <seanh> They are not "reusable components" (not meant to be used by other python packages as dependencies)
[21:06:09] <seanh> But they aren't really applications either (they don't get their own virtualenv)
[21:06:15] <seanh> Neither approach works well for them
[21:06:47] <seanh> What I think they should do is: use requirements.txt, but put only direct dependencies with loose bounds as you would normally do with install_requires
[21:07:18] <rossjones> Seems like a sensible fair approach, but I expect there are plenty of extensions out there that nobody has touched for a while that do it differently.
[21:07:31] <seanh> So you minimise the chance of version conflicts with other extensions, but if a conflict does occur a user can still install it and maybe by tweaking the requirements they can get it to work
[21:08:03] <seanh> Of course, and we've never had a defined best practice for this (either in the ckan or the python community) so people have done it all randomlu

[11:41:27] <seanh> Hmm: https://github.com/ckan/datapusher/blob/master/datapusher/main.py#L26
[11:44:29] <seanh> DataPusher isn't as bad as I'd feared. When Nick looked at it, it sounded like it was the greatest tangled mess ever seen. The code could certainly use refactoring, but it's only two small-ish source code files. The tests look quite worrying though...
[11:45:47] * seanh Runs the datapusher tests on master, 17 failures
[11:50:28] <amercader> seanh: debugging  a bug in ckan core has led me to this method on vdm (notice the comments) https://github.com/okfn/vdm/blob/master/vdm/sqlalchemy/base.py#L515
[11:50:45] <amercader> so yeah, it can always be worse :)
[11:52:50] <seanh> Yeah
[11:53:21] <seanh> csp and dp are relatively small, given say a month or two to work on it someone could sort them out completely
[11:53:37] <seanh> This is not super deeply embedded legacy code like some of the stuff you find deep in ckan
[11:53:43] <rossjones> amercader http://img1.wikia.nocookie.net/__cb20141002193111/warframe/images/5/58/Nukey_nuke_it_from_orbit_its_the_only_way_to_be_sure0.jpg
[11:54:32] <amercader> rossjones: yeah, your work removing moderated edits will prevent this issue on 2.3, I'm trying to find a sane way to backport it
[11:54:52] <seanh> I am probably going to have to start by spending a week fixing the datapusher tests though, it is beginning to look like
[13:34:31] <seanh> amercader: Shall I just merge my own datapusher pr (or do you want to merge it for me?) It's just adding some docstrings as I was going through the tests https://github.com/ckan/datapusher/pull/56
[13:35:01] <seanh> I've got the tests passing now, they aren't exactly how I would write them but they don't seem to be too bad either, gonna have a look what the coverage is
[13:36:26] <seanh> 86% apparently, not too bad: https://coveralls.io/r/ckan/datapusher
[13:43:24] <seanh> Does anyone know if it's possible to create a group or team or something on pypi? So I can add ckanserviceprovider and datapusher, but without people needing to have my pypi account password to update them
[13:43:34] <seanh> Or do we just need a "ckan" pypi account?
[13:45:57] <seanh> Ah, you can just go to one of your package pages and add people as "owners"
[13:47:30] <seanh> No way to create a team and centrally manage it though, looks like owners need to be manager per-package
[13:55:13] <amercader> seanh: happy for you to merge these on datapusher
[13:55:42] <amercader> and generally to push directly unless you want another pair of eyes
[14:00:57] <seanh> ok
[14:01:20] <seanh> Currently both csp and dp use a "stable" branch
[14:01:44] <seanh> I'm going to delete this, and change them to releases (pushed to pypi, and tagged on github) if no one minds
[14:11:48] <rossjones> seanh I've assigned you to a bug where you are already assigned to the matching PR - hope that's ok.
[14:14:19] <seanh> sure
[14:53:48] <amercader> seanh: please don't change that for now, the packaging uses the stable branches
[14:53:54] <amercader> or change the packagign
[14:58:45] <seanh> The thing is, the way it is done now doesn't work
[14:59:16] <seanh> Datapusher's requirements.txt specifies the (zip file of the) stable branch of ckanserviceprovider from github
[14:59:32] <seanh> And then the requirements-dev.txt specifies the zip file of the master branch
[14:59:49] <seanh> But requirements-dev also includes requirements.txt
[15:00:13] <seanh> And pip doesn't know that "master" is newer than "stable" so it doesn't replace the already-installed stable version
[15:00:37] <seanh> So the tests will fail on master unless you manually install it, that's why they're currently failing on travis
[15:01:24] <seanh> We need to start doing proper releases I think. Or maybe we can find some way to hack around this for now
[15:02:02] <amercader> seanh: happy to change it if the new way ensures that when packaging 2.0, 2.1, etc each ckan version gets the datapusher version that works with it
[15:04:07] <seanh> Presumably they all get the tip of the stable branch right now, the current master/stable branch scheme doesn't support multiple versions
[15:05:07] <amercader> yeah, but at least if master moves to some breaking changes the current ckan versions will work against stable
[15:05:19] <amercader> but you are right, it's a bit silly
[15:05:55] <amercader> let's just do proper release versions, and then modify the packaging to target the one that works against the ckan version
[15:06:12] <amercader> not sure how we will do that though
[15:06:20] <seanh> I don't know about the packaging
[15:06:37] <seanh> I can push the current tip of the master branch to pypi and tag it on git as version 0.0.1
[15:07:09] <seanh> Then if we change the packaging scripts to pip install version 0.0.1, they should get the same version as they were previously getting from the stable branch
[15:07:24] <seanh> Then the current master branch will become version 0.0.2
[15:07:46] <amercader> so "stable" will be 0.0.1 right?
[15:07:51] <seanh> Yeah
[15:08:09] <amercader> https://github.com/ckan/ckan-packaging/blob/master/package.yml#L64
[15:08:25] <amercader> sorry, https://github.com/ckan/ckan-packaging/blob/master/package.yml#L60
[15:08:38] <amercader> this is where we package a particular datapusher branch
[15:09:23] <amercader> I guess we can put some ifs to decide which datapusher version to use depending on the ckan version, but seems a bit fragile
[15:10:15] <seanh> https://github.com/ckan/ckan-packaging/blob/master/package.yml#L60
[15:10:24] <seanh> Yep
[15:11:07] <seanh> So that just gets the stable branch from git, so if I replace the stable branch with an 0.0.1 tag then just changing "stable" to "0.0.1" should do it
[15:11:15] <amercader> yes
[15:11:16] <seanh> Or we could change it to use pip install instead
[15:11:35] <amercader> seanh: then I guess we need to change the apache wsgi scripts
[15:12:00] <amercader> as they will point to different locations
[15:12:18] <seanh> But I'm not sure how to support different versions of datapusher for different versions of ckan.
[15:12:27] <seanh> Will they?
[15:14:48] <amercader> seanh: I guess that as long as you don't change the HTTP API it should be all righ?
[15:14:52] <amercader> *right
[15:14:57] <seanh> The normal way to do this would be to have datapusher==x.y.z in CKAN's requirements.txt, then all the packaging needs to do is install CKAN. But datapusher is an optional component. Maybe CKAN should have a requirements-datapusher.txt??
[15:15:17] <amercader> seanh: datapusher gets installed in a separate virutalenv
[15:16:44] <seanh> I don't think the location of that virtualenv is gonna change though
[15:17:04] <seanh> And I don't see datapusher's apache.wsgi anywhere in ckan-packaging, which is confusing
[15:22:35] <seanh> Did you know that datapusher only supports python 2.7?
[15:22:54] <seanh> That means the ckan package install is python 2.7 only as well, I guess
[15:23:06] <seanh> I guess it's ubuntu 12.04 only so
[15:26:26] <seanh> ckanserviceprovider has all its deps duplicated in setup.py's install_requires and then in requirements.txt, some of them are pinned to different versions in each :\
[15:27:24] <wardi> setup.py forces them on you, so trust that one I guess
[15:27:49] <seanh> Yeah, requirements.txt isn't used when you do pip install, afaik
[15:30:49] <wardi> amercader: (re vdm) wow
[15:30:57] <seanh> This isn't wonderfully clear bit I would read this as meaning that a project like ckanserviceprovider or datapusher shouldn't have a requirements.txt at all, only install_requires: https://packaging.python.org/en/latest/technical.html#install-requires-vs-requirements-files
[15:31:59] <seanh> (Also I notice that it says if you are trying to create a guaranteed-the-same-every-time virtualenv with a requirements.txt file like we are, you should use --no-deps: https://pip.pypa.io/en/latest/user_guide.html#repeatability
[15:34:50] <seanh> The requirements.txt of ckanserviceprovider has requests pinned to a version that doesn't work with datapusher, too
[15:40:29] <wardi> seanh: So the requirements.txt should be just the one in ckan (with all its specific pinned versions) I think that makes sense
[15:42:16] <seanh> Does ckanserviceprovider need a requirements.txt?
[15:43:00] <wardi> not according to the link you posted (and assuming csp would support different ckan releases)
[15:44:27] <seanh> Oh it's confusing
[15:44:42] <seanh> I'm not entirely clear on why people use requirements files at all to be honest
[15:44:59] <seanh> Even for CKAN it seems we could just put the stuff in setup.pu
[15:45:54] <wardi> for pinning specific versions requirements.txt is better (because our install order matters too)
[15:49:35] <amercader> This email (from 2011!) mentions why requirements.txt was favoured "in the olden days"
[15:49:36] <amercader> https://lists.okfn.org/pipermail/ckan-dev/2011-April/000466.html
[15:49:48] <amercader> yes, I have good memory
[15:52:16] <seanh> This guy https://caremad.io/2013/07/setup-vs-requirement/ seems to be saying that install_requires with the versions not pinned (but maybe upper and lower version limits specified, I say) is for libraries that exist for other things to depend on them (so ckanserviceprovider would come under that I think), whereas requirements.txt with all deps and sub-deps pinned is for applications that you deploy (so ckan and
[15:52:18] <seanh> datapusher both)
[15:53:16] <rossjones> think james was right, still true.  trying to get everything on dgu to decide on which version of requests to use was a nightmare.
[15:53:52] <seanh> That email is a little difficult to parse
[15:55:59] <seanh> rossjones: So what is he arguing for, exactly? That if you put deps in a requirements.txt file then they don't get installed automatically by pip install, freeing the person deploying the app to use their own modified requirements file instead if they need to?
[15:56:38] <rossjones> I think he is suggesting if your setup.py says requests==0.10 and my setup.py says requests==1.10, then it'll break because of the enforced dep check
[15:57:44] <seanh> Right
[15:57:56] <seanh> But if we both do that in requirements.txt, that'll break as well
[15:58:37] <rossjones> but it won't be enforced at runtime.
[15:58:52] <rossjones> it'll break because one of us is depending on specific behaviour, but ckan itself won't break.
[15:58:56] <seanh> Or at least, it'll end up with the version from whichever one you installed first (I think) and the other package will probably crash
[15:59:02] <rossjones> if we're both using setup.py ckan won't load
[15:59:13] <seanh> "Enforced at runtime"?
[16:00:17] <rossjones> when you try and run ckan, the pkg thing whose name escapes me throws an exception if one of your plugins has a setup.py pinned to a version and a different version is installed.
[16:01:08] <seanh> Huh, I didn't know that. You mean setuptools does this? (This is not some CKAN code throwing an exception? :)
[16:01:34] <rossjones> ah yeah, not ckan, setuptools (if that's what we're using).  python packaging confuses me, someone told me about wheels the other day!
[16:01:44] <seanh> It is a confusing mess
[16:01:47] <rossjones> try it. it's a horrible situation to try and get out of.
[16:02:24] <seanh> But I'm leaning towards "libraries" (code meant to be depended on and used by other code) should use install_requires and be as liberal as possible with the version number ranges
[16:02:43] <rossjones> right, major version ranges would be fine.
[16:02:53] <seanh> "Applications" (things intended to have their own virtualenv all to themselves) should use requirements.txt and pin all deps and sub-deps
[16:02:54] <rossjones> >1.0,<2.0

2014-11-18
[05:59:35] <slifty> Hello all!
[10:42:32] <amercader> seanh: what's the test that's causing all the trouble in CSP #23?
[10:50:02] <seanh> amercader: It's test_asynchronous_post_with_return_url() (in the pr it has been renamed to test_asynchronous_post_with_bad_result_url())
[10:50:52] <seanh> The problem is that csp run an async job, when it finishes it posts to the result url so we can wait for that to wait for it to finish, but in this case we are testing what happens *after* it tries posting to a broken result url
[10:51:00] <seanh> It goes and changes the error in the db
[10:51:29] <seanh> But it's doing that in a separate thread from the main test thread, so we don't have any good way for the test to wait until it's done
[10:51:52] <seanh> Hence adding a second callback url for test pruposes only. In fact for this one test only! But it's the only way i can think of
[10:52:10] <seanh> I think making the test callback url an optional config setting might work nicely
[10:52:26] <amercader> so how would the second callback work?
[10:52:39] <amercader> sorry, I should look into it more in depth
[10:55:34] <seanh> Basically once csp has done everything and wrote any result_url error to the db, then it would do a trivial requests.get() of the second callback if the config option is set
[10:55:37] <seanh> That's all
[10:56:03] <seanh> Tests will mock that second callback url with httpretty and wait for it to be called, before moving on to do the asserts
[10:56:30] <seanh> I think it's the least bad solution, so I'll give it a try
[10:56:40] <amercader> that doesn't sound too bad
[10:57:25] <amercader> so just be clear, are you saying that you will change result_url to be a list or create a new optional param
[10:57:26] <amercader> ?
[10:57:30] <amercader> seanh: ^
[10:57:49] <seanh> I'll create a new optional param, but in the config file not in the db
[10:58:04] <amercader> great
[11:34:08] <seanh> The ckan service provider tests used to take 6-8 mins on Travis, now 40s
[11:36:09] <amercader> !m seanh
[11:36:09] <[d__d]> You're doing good work, seanh!
[11:51:32] <amln> :)
[12:04:17] <wardi> https://plus.google.com/hangouts/_/event/cb1vmkss426lkqicj94a3amvd1c?authuser=0&hl=en-GB
[12:05:02] <amercader> seanh, joet ^
[14:52:35] <amercader> seanh: merged your CSP PR
[14:53:05] <seanh> Cheers!
[16:35:34] <seanh> amercader: Another one on the csp tests: https://github.com/ckan/ckan-service-provider/pull/24 This one is just some cleaning up
[16:42:20] <amercader> seanh: you've been busy :) All looks good, I'll merge when travis finishes
[16:43:18] <seanh> The only thing that needs to be done on the tests now, is breaking lots of them up into multiple smaller tests
[16:43:36] <amercader> I like this one: https://github.com/seanh/ckan-service-provider/commit/4e3d3101
[16:43:38] <amercader> http://i.imgur.com/NCXe15X.jpg
[16:44:36] <amercader> seanh: perhaps we can leave that for later?
[16:45:00] <seanh> We probably could
[16:46:56] <amercader> done
[16:54:05] <seanh> joet: What I don't get about this https://github.com/ckan/ckan-service-provider/pull/19/files is where is the new HttpError actually raised?
[16:54:30] <seanh> Is it only jobs defined in datapusher that raise it?
[17:39:11] <joet> seanh, pretty much, I don't mind moving it to the datapusher
[17:39:17] <joet> or whatever you think is best

2014-11-17
[11:46:22] <seanh> amercader: https://github.com/ckan/ckan-service-provider/pull/22 Needs review, that's blocking any more ckanserviceprovider or datapusher work now
[11:47:09] <amercader> seanh: will look at it straight away
[12:36:08] <amercader> seanh: merged, great stuff
[12:36:55] <seanh> amercader: cheers
[12:37:55] <seanh> I'll follow this afternoon with a little more refactoring that will need merged, I just want to remove all this time.sleep(0.2) stuff and maybe a couple more of the worst remaining crimes. Then we can get on with it
[12:38:23] <amercader> sounds good
[12:57:29] <wardi> seanh: I remember it took me ages to come up with a thing that would be reliable for simulating a ckan server in my ckanapi tests
[13:01:53] <wardi> have you seen test_remote and mock_ckan in ckanapi? since you're testing services it might be of some use
[13:07:45] <wardi> oh, nevermind I rember you saying you like to test against a real ckan instance
[13:55:38] <seanh> ckanserviceprovider actually has its own mock ckan app that it runs on a port before starting the tests
[13:55:51] <seanh> I don't like that much but it works so I've left it alone
[14:12:14] <joet> anyone happen to know why when we preview things through the resource proxy using recline_preview we force using http?
[14:12:23] <joet> https://github.com/ckan/ckan/blob/master/ckanext/reclineview/theme/public/recline_view.js#L184-L190
[14:17:08] <amercader> joet: this sounds very wrong
[14:45:22] <wardi> and why is such a function called "normalizeUrl"?
[15:39:53] <rossjones> There's no issue with using @toolkit.side_effect_free in an extension's logic functions is there?
[15:46:24] <rossjones> There is if you call your file logic.py :( Sigh. relative import suckage
[15:48:03] <rossjones> import ckan.plugins.toolkit as toolkit in my extension's logic.py is trying to call import logic.schema :(
[15:54:53] <seanh> This is annoying: You post a request to ckanserviceprovider asking it to run an asynchronous background job. When the job finishes it posts the result to a callback URL. If posting to the callback URL fails it overwrites the "error" field of the job in its db (which may have contained an actual error from the job" with "Could not post to result URL"
[15:55:15] <seanh> The problem is this overwriting happens after it has run the job and attempted to post the result, in a separate thread
[15:55:15] <rossjones> hehe
[15:55:20] <rossjones> sorry, shouldn't laugh
[15:55:40] <rossjones> I'm just glad you're looking at it and not me :)
[15:56:04] <seanh> So in tests you end up with a race condition with the test that is raising toward an assert for that "Could not post to result URL" error and ckanserviceprovider itself that is racing to place that error in the db
[15:56:57] <rossjones> seanh would it make sense to couple sending the reponse into another queue, could leave your original error intact and enable you to log it elsewhere?
[15:57:05] <rossjones> s/couple/decouple/
[15:57:31] <seanh> Well, yes, but I don't want to refactor it, right now I just want the tests passing deterministically without race conditions
[15:58:29] <seanh> I think this is almost the last race condition to be killed, but trying to think of a non-racing way to wait until csp's thread has placed that error in the db!
[15:59:02] <rossjones> ugh. threads.
[15:59:41] <seanh> The way I've been doing it so far is mocking the callback URL, redirecting posts to it to a function that sets a thread event. The main test body can then wait on that thread event
[15:59:55] <rossjones> top of my head I'd just say use .join() to wait, but I'm guessing it isn't that straightforward otherwise you'd have done it :)
[16:00:14] <seanh> But in this case the mock callback URL has to return a 404 (or whatever) and then *that* prompts csp's thread to go and put the error in the db
[16:00:24] <seanh> I don't have access to csp's thread
[16:00:54] <rossjones> sounds like a nightmare.
[16:01:00] <seanh> csp's whole async job thing is kicked off by posting a (simulated) http request to it, so this is more a "black box" test than a unit test
[16:01:59] <seanh> Typically it's not that hard to write functional tests for an asynchronous background jobs api like this one, because it posts to a callback URL when the job finishes so that's what you wait for
[16:02:17] <seanh> The problem is this one test is about what it does after it posts to that url, not before
[16:06:12] <rossjones> makes me wonder whether the dev meetings should also look at issues from extensions as well?
[16:06:18] <rossjones> maybe not all of them every week.
[16:10:39] <seanh> We do need to figure out how to handle officially-supported extensions, they get neglected
[16:12:43] <wardi> there's an issue on waffle.io for a combined-repo view. don't really like working from waffle, though
[16:13:29] <seanh> I can probably work around this by patching csp's function that updates a job in the db - listen for the "Could not post to result URL"
[16:14:06] <seanh> It's a bit ugly for a supposedly functional test to be tightly coupled to an implementation detail like that (and patching is just ugly) but I can't think of anything else
[16:18:00] <wardi> https://github.com/pulls?q=is%3Aopen+is%3Apr+user%3Ackan+sort%3Aupdated-desc
[16:18:20] <rossjones> neat
[16:18:40] <wardi> https://github.com/issues?user=ckan
[16:18:57] <wardi> we could try using those instead
[16:19:08] <rossjones> sounds like a very good plan.
[16:19:27] <rossjones> we might to exclude things like ideas-and-roadmap
[16:19:44] <wardi> well, we can skip things as we see fit
[16:20:13] <wardi> or move them to a different org :-)
[16:20:43] <rossjones> but which?!
[16:22:58] <wardi> rossjones: which org?
[16:23:51] <rossjones> yeah.
[16:23:59] <rossjones> being facetious.
[16:24:08] <wardi> ckan-stuff-devs-arent-very-interested-in
[16:24:26] <rossjones> :D I'm interested in my tickets there
[16:25:01] <wardi> yeah, I think it's worth keeping ideas in the queue
[16:25:28] <wardi> we don't have to assign them or anything
[16:36:41] <amln> one can filter against the creator tag.
[16:58:28] <seanh> I could add another optional param to ckanserviceprovider: the callback url that it should call after calling the first callback. It won't call the second callback until after it has called the first callback and received the result of that call (if the result was an error) after it has updated its db with that error
[16:58:45] <seanh> This option wouldn't be much use in production, it'd only be for the tests
[16:59:59] <rossjones> seanh as it's a minor refactor, why not allow it to support a list of callbacks? ;)
[18:00:06] <seanh> amercader: Another one that needs merged before we can start bug fixing: https://github.com/ckan/ckan-service-provider/pull/23
[18:00:14] <seanh> Waiting to see if the tests pass on Travis
[18:00:43] <seanh> I'm not so sure about this one: it requires a db migration (which I haven't written yet), would be nice to find a way of doing it without a migration
[18:47:44] <amercader> nosetests --reset-db --ckan --with-pylons=test-core-custom.ini --nologcapture ckan ckanext
[18:48:01] <amercader> Ran 1858 tests in 987.091s  FAILED (SKIP=13, errors=4, failures=14)
[18:48:11] <amercader> nosetests --reset-db --ckan --with-pylons=test-core-custom.ini --nologcapture --verbose ckan ckanext
[18:48:31] <amercader> Ran 409 tests in 293.957s   FAILED (errors=14)
[18:48:59] <amercader> Sometimes I despair at the old tests
[18:49:07] <amercader> I think I had enough for today
[18:50:01] <amercader> seanh: cool, will look at it tomorrow, although we may need to have a think about db migration
[22:27:40] <coolcat20151> hi all!
[22:28:13] <coolcat20151> can someone points me why ckan doesnt automagicly convert the data?
[22:28:22] <coolcat20151> (like from csv to json)
[22:29:03] <coolcat20151> (mostly i found was the dataproxy, but didnt understood why was this way)
[23:12:05] <coolcat20151> i think i have find some light, not sure - https://t.co/QrZ4HZmmzA
[23:37:50] <coolcat20151> thanks
[23:38:02] <coolcat20151> goog night all!

2014-11-16

2014-11-15

2014-11-14
[11:01:56] <nigelb> seanh: hey, is there something we were due to talk about today/yesterday?
[11:02:06] <nigelb> I just saw your ping on skype.
[14:17:12] <rgrp> someone is building a nice R client - https://github.com/sckott/ckanr

2014-11-13
[10:18:49] <seanh> http://pyvideo.org/video/2840/the-clean-architecture-in-python
[11:09:46] <brook> I'm trying to run CKAN in development over ssl using `ssl_pem = *` in the .ini file (after installing pyOpenSSL dependency). However, I'm getting an error, TypeError: buf must be a byte string, when trying to access the site. Has anyone encountered this before, or know of a way I can run a local dev version of ckan over ssl for testing?
[11:15:25] <amercader_> brook: works for me
[11:15:32] <amercader_> on chrome
[11:15:54] <amercader_> do you have the stacktrace?
[11:34:26] <brook> amercader_: yeah Chrome. Here's the stacktrace: http://pastie.org/pastes/9716428/text
[11:35:28] <amercader_> brook: interesting, I'm running it on python 2.7. could that be the issue?
[11:35:48] <brook> Could be, I'll try it.
[11:51:44] <brook> woot - 2.7 fixed it, thanks
[13:29:58] <seanh> Can anyone see what's wrong with this? https://github.com/seanh/apschedular_nosetests_example
[13:30:09] <seanh> Crash when nosetests are run: https://travis-ci.org/seanh/apschedular_nosetests_example/builds/40885229
[13:30:29] <seanh> I'm getting the same crash from ckanserviceprovider so I constructed a minimal example that shows it
[13:30:47] <seanh> In the tests, teardown stops the scheduler *before* deleting all the db tables
[13:31:02] <seanh> And then re-inits the db tables and scheduler in setup()
[13:31:38] <seanh> The traceback seemms to suggest that the scheduler was still running after its db table was destroyed, which I don't get
[15:12:43] <seanh> Finally got the ckanserviceprovider tests running, with resetting the flask app, database and scheduler between test methods so they don't depend on each other
[15:13:15] <seanh> That took a lot of refactoring, and debugging bad interactions between apscheduler and sqlite involving threads (I had to get the author of apscheduler to help me)
[15:13:24] <seanh> Now, just 11 tests failing...
[15:14:55] <seanh> Also it's taking 3 mins to run 27 tests for some reason
[16:03:45] <wardi> https://plus.google.com/hangouts/_/event/cb1vmkss426lkqicj94a3amvd1c?authuser=0&hl=en-GB
[16:04:18] <seanh> I'm up to my neck in ckanserviceprovider refactoring, gonna keep at it
[16:04:33] <wardi> boo
[16:27:51] <wardi> oh well
[16:28:53] <wardi> I will find a meeting room with better reception I can use at this time
[16:29:39] <wardi> my phone has 4 bars, but it must be lying to me
[17:05:56] <amercader> apologies for missing the dev meeting, had another appointment
[17:18:02] <wardi> amercader: don't worry, I found a pr to assign to you
[18:36:39] <seanh> I just got all the ckanserviceprovider tests passing
[18:36:56] <seanh> When you see the pull request, you'll know how I feel
[18:37:03] * seanh Is going out to buy beer now
[18:40:10] <seanh> https://gist.github.com/seanh/80c08ea68f65a070b8ff
[18:41:36] <seanh> (That's my attempt at the minimum changes *just to make the existing tests pass reliably*

2014-11-12
[14:16:06] <amercader> resource_dict['package_id']
[14:16:13] <amercader> what a time to be alive
[14:20:58] <wardi> amercader: glorious isn't it?
[14:22:25] <amercader> wardi: it can only get better from there
[14:25:37] <wardi> amercader: one day we might even have docs for package_update
[14:26:57] <amercader> "For further parameters see package_create()"
[14:27:16] <rossjones> should it have been package_id, or the package name and id in a dict, or something else?
[14:27:19] <wardi> right. that explains nothing
[14:27:38] <wardi> rossjones: it's perfect the way it is
[14:27:54] <rossjones> hard to tell if it's any faster though.
[14:28:07] <rossjones> probably a miniscule amount.
[14:28:38] <wardi> rossjones: faster is less important than the fact that's it's a value that's actually useful now
[14:30:19] <rossjones> I guess so.
[14:30:55] <rossjones> does it make it feasible now for resource_create to not have to call package_update as well, or do we still need to do that?
[14:31:02] <rossjones> presumably because of the solr hack
[14:31:23] <wardi> amercader: some of the paramaeters when excluded mean "don't change" some mean "reset to empty" a bunch are simply ignored regardless of what you pass. I would like to document all that stuff (and the fact that this might all depends on your plugins)
[15:11:15] <amln> davidmiller: NZ have done something for Excel <--> ckan, aiui.
[15:12:09] <amln> landcare registry, which i can't quickly find via https://github.com/Aaron-M
[15:12:44] <amln> (yeap, replying to tweets via IRC)
[15:20:40] <davidmiller> amln: If you had links or could point them my way that would be neat :)
[15:28:27] <amln> shall i shoot a mail to the pair of you?
[15:28:29] <amercader> davidmiller: not sure what you were asking for but this might be useful http://ckan.org/2014/11/09/export-datasets-from-ckan-to-excel/
[15:30:29] <amln> seanh: ^^ is very nice, thanks
[16:04:09] <davidmiller> amercader: My impression is that people who want things in excel because that's where they work...
[16:04:40] <davidmiller> ... don't want to run commandline scripts, do not want to "pip install" things :)
[16:05:06] <davidmiller> As awesome as that library is, I'm more interested in something that sits inside excel as an excel plugin
[16:06:58] <wardi> davidmiller: yes, that would be great. I was thinking about something like that last year to be able to hilight cells that cause validation errors on the ckan api side
[16:07:15] <amercader> davidmiller: then by all means write an excel plugin :0
[16:07:25] <amercader> s/:0/:)/g
[16:07:55] <wardi> I've heard of some thing that lets you use python in excel, but there must be some languages better than vb that work these days too
[16:08:51] <davidmiller> So, at this stage, I'm in fact-finding mode, trying to discover prior art *instead* of jumping into Just Write More Code.
[16:09:21] <davidmiller> I'm sure I've seen a spec for something like this, multiple people have started writing something like this, or claim to have seen similar...
[16:13:56] <amln> s/don't/can't/ (from your 16:04 line)
[16:14:12] <wardi> davidmiller: but writing more code is *fun*
[16:14:27] <amln> davidmiller: shall i put you and aaron in touch?
[16:16:45] <seanh> You can write a ckan plugin that adds an "export your datasets to excel" button to ckan, based on ckanapi-exporter. That's the idea
[16:17:07] <seanh> davidmiller: But what do you want though? Just CKAN -> Excel or Excel -> CKAN or both?
[16:28:21] <davidmiller> wardi: I guess that depends on what you think I'm doing when I'm not just producing code :)
[16:28:30] <davidmiller> amln: Please do :)
[16:29:27] <davidmiller> seanh: I'm responding to analyst/data scientist types who do work in Excel, reading some of their source data over an ODBC connection that hits a SQL database...
[16:30:41] <davidmiller> ...they also copy & paste/download many csv files to source other data. I'm responding to "Is there an easy way to pull in data from the CKAN Datastore you're so keen on, more or less like I do from this SQLServer database (via an excel plugin)"
[16:31:11] <davidmiller> Responding with "I'll investigate what's out there", not "Let me immediately write that" ;)
[16:34:44] <rossjones> davidmiller did you try power-bi and ckanext-odata?
[16:40:15] <davidmiller> not yet. Convincing people to add $40/user/mo would require business case, inclusion in budgets that are hard to alter at this stage, &tc.
[16:41:50] <davidmiller> rossjones: getting access to the Power BI Admin Center would take 6months. It's offputting :)
[16:42:34] * rossjones shrugs
[16:44:01] <davidmiller> rossjones: Shure - it's absolutely not your problem :)
[17:00:14] <rossjones> Nah, I just think if you gave them a quote about how long it would take to develop the excel half, they might think $40 was worth it.
[17:00:30] <rossjones> But, yes, 6 months later.
[17:46:10] <rossjones> davidmiller Apparently powerpivot also lets you import from odata into excel, and it claims to be free - http://www.powerpivotpro.com/what-is-powerpivot/
[17:48:11] <rossjones> also http://www.microsoft.com/en-in/download/details.aspx?id=39379 which may/may-not be the same thing.
[18:34:32] <wardi> davidmiller: can you install a postgresql odbc driver and give them read access to the datastore db?

2014-11-11
[12:01:32] <wardi> that time again?
[12:01:54] <seanh> Yep
[12:02:09] <wardi> https://plus.google.com/hangouts/_/event/cb1vmkss426lkqicj94a3amvd1c?authuser=0&hl=en-GB
[12:14:38] <wardi> https://travis-ci.org/ckan/ckan/jobs/40374006#L1648
[12:14:44] <wardi> george_s: ^
[12:41:45] <wardi> george_s: great notes, thank you
[12:44:42] <wardi> create 10K datasets with ckanapi and one line of bash: https://github.com/ckan/ckan/issues/2008#issuecomment-62447725
[12:45:43] <wardi> .. could have thrown in a -p to make it faster
[12:46:08] <seanh> wardi: I often want to generate large numbers of test datasets for testing or performance reasons
[12:46:40] <seanh> I could write a command that spits out randomised test datasets (with different numbers of resources and everything) onto stdout
[12:46:46] <seanh> Then pipe that to load datasets
[12:46:49] <seanh> Pretty cool
[12:47:12] <wardi> and -p 4 or so to make it faster
[12:47:52] <wardi> seanh: it's the sort of thing that would be worth blogging too
[12:50:08] <seanh> Yeah
[12:50:36] <seanh> All, this is the lossless json<->csv converter that wardi was talking about: https://github.com/wardi/jsonsquared
[12:50:56] <seanh> As opposed to ckanapi-exporter/losser which is *very* lossy
[12:51:06] <wardi> *planned* lossless json<->csv converter
[12:54:01] <seanh> The ckanapi-exporter blog post is a bit of a fail probably, it should explain the use-case and why you'd want it first (local council or whoever is using ckan to manage their stuff, but they aren't Python JSON hackers and now they want it in Excel in a certain format so they can produce a report
[17:53:49] <seanh> These ckan-service-provider tests are really a pain
[17:54:12] <seanh> I'm just trying to tease them apart: create a new test app with a fresh config and new in-memory sqlite db for each test
[17:54:42] <seanh> But ckanserviceprovuder itself is written in such a way that if you create a test app, then create another test app, it crashes
[17:55:14] <seanh> So you have to reuse the same app for every test, or refactor ckanserviceprovider
[19:38:24] <seanh> Wow, http://stackoverflow.com/questions/26859996/ckan-apikey-dataset-using-additional-methods

2014-11-10
[14:08:52] <seanh> That's one of the better examples
[14:09:09] <seanh> Most of them test several things at once with names like test_job() and no docstring
[14:09:53] <seanh> Trying to write a docstring ends up like "Test that creating a job with no ID automatically generates an ID ... And then test six other things about different ways of creating jobs succcessfully and unsuccessfully."""
[14:11:08] <seanh> rossjones: http://docs.ckan.org/en/latest/contributing/testing.html We need to apply these to CKAN-related extensions and services and api clients etc as well, not just core
[14:11:36] <seanh> If we're gonna create new standalone things from scratch, it'd be a real shame to throw away the opportunit to start clean and do it right, and instead create another ckan
[14:13:25] <shellac> rossjones: let me know if you want any advice about parsing SKOS.
[14:14:28] <rossjones> shellac thanks, was going to start with 'pip install rdflib' ;)
[14:14:58] <shellac> a very wise first step :-)
[14:16:55] <wardi> seanh: how do you feel about #2003, if it's ok I want to write the rest of the _patch methods in the same style
[14:18:01] <seanh> wardi: I'll try and review it soon
[14:18:13] <seanh> But at a glance it looks good to me, I think you can go ahead with the rest
[14:20:21] <wardi> seanh: thanks
[14:30:57] <seanh> There's a test method called test_logging() no docstring that: Posts a job request to ckan service provider, tries to login with the wrong password and asserts the response is 403, tries to login with the right password and asserts the response is 200, checks that the JSON body of the 200 OK login response contains a "logs" key with a single log message "Just a warning"
[14:31:31] <seanh> ?? I have no idea where that log message comes from or why, or what if anything it has to do with posting job requests and logging in successfully and unsuccessfully
[14:32:49] <seanh> Ah, the job request it posted is for a test job type that just logs "Just a warning". The logging in stuff is just to confuse people I guess
[14:40:59] <wardi> seanh: I have failed to reproduce these travis failures locally, do you remember working on the activities tests, any idea what this could be? https://travis-ci.org/ckan/ckan/jobs/40214348#L1648
[14:49:38] <seanh> That just looks like you've changed the behaviour of the activity streams and therefore tests are failing
[14:49:56] <seanh> Are these new versions of the queries returning the same results as the old ones?
[14:50:08] <wardi> they are on my machine :-/
[14:50:48] <wardi> would be great to have that docker testing environment for this kind of thing
[14:52:07] <wardi> and some simpler activity tests :-)
[14:53:36] <seanh> Oh, that's bizarre
[15:17:48] <amercader> lol, so I tried and see if you can get the config a test app like the ones we use on functional tests is using (ie the one we use on `self.app.get(..)`
[15:18:01] <amercader> turns out it's pretty straight forward:
[15:18:22] <amercader> self.app.app.app.apps[2].app.application.app.app.application.app.app.app.app.app.config
[15:22:44] <wardi> amercader: seems obvious in retrospect, eh?
[15:24:56] <amercader> wardi: yeah, the only thing that confused me a bit was the second random `application`
[15:25:29] <wardi> apps[2] is quite endearing
[15:30:52] <seanh> There are also lots of ordered tests that depend on stuff put into the db by other tests
[15:31:14] <amercader> seanh: I'm currently suffering these ones
[15:31:28] <seanh> But the worst crime of the ckan service provider tests is this: They pass on travis. Run them locally, one fails. Run again: all pass. Run again: three fail
[15:31:45] <amercader> c
[15:41:57] <seanh> amercader: Are you currently working on ckan-service-provider tests? I'm also editing them right now
[15:42:22] <amercader> seanh: no, mine are old core auth ones
[15:42:39] <amercader> I have enough with those
[15:52:11] <seanh> I think it's one test failing due to a race condition, it runs an asynchronous background task then does time.sleep(0.2) to wait for it to finish
[15:52:31] <seanh> Then two tests fail as a result of that one failing, because they depend on exactly what the other tests leave in the db
[15:52:48] <seanh> But sometimes the first test does pass but another race condition test fails instead
[15:53:01] <seanh> Anyway, it's bonkers
[16:10:57] <amercader> more esoteric test failures! https://github.com/ckan/ckan/blob/master/ckanext/resourceproxy/tests/test_proxy.py#L142
[16:11:12] <amercader> requests.get('http://foo.bar') returns a 200
[16:11:18] <amercader> because of this http://stackoverflow.com/questions/25662590/domain-foo-bar-points-127-0-53-53-why
[16:11:36] <wardi> hah
[16:11:48] <wardi> should have used example.com
[16:12:26] <rossjones> How does https://github.com/ckan/ckan/blob/master/ckanext/resourceproxy/tests/test_proxy.py#L147 work without actually calling the func?
[16:12:54] <rossjones> ah, nose calls it.
[16:12:56] <rossjones> weird.
[16:21:18] <seanh> Does adding docstrings to tests change the order that nose runs them in?
[16:22:02] <wardi> that's a frightening question
[16:23:06] <seanh> Just added docstrings to all the ckan service provider tests. That's all I changed. Now I have a different three tests (usually) failing
[16:23:23] <seanh> Remove docstrings: back to the original three intermittently failing tests
[16:24:34] <seanh> I'm not sure there's much I can do about this except go over all 20 tests and fix them, removing inter-test dependencies and race conditions
[16:26:52] <seanh> Yeah. That's the kind of question that if I went and asked it in #nose or #python everyone would jump on me with 'what the f*** are you ding??'
[17:24:00] <seanh> Just finished splitting up one test into 10 separate ones, could easily have been 15 or 20

[08:40:58] <brook> I'm uploading an image to the file store in the same way a group image is uploaded, but at a different path (filestore/storage/uploads/showcase/). The upload is fine, but the image won't display in a template, returning a 404. The file permissions look the same as for group images, but any image in my new directory isn't being served. Any ideas?
[09:08:58] <seanh> brook: You're doing uploader.Upload('showcase')?
[09:11:45] <brook> seanh: That's right. The showcase directory is created, and an image uploaded fine, but not displaying at the full url eg. http://localhost:5000/uploads/showcase/20141110080700.340669myimage.png
[09:12:02] <seanh> I'm not sure what's going on, would have to debug the file request. What serves the uploaded group files - does it go through StorageController?
[09:12:27] <seanh> I don't see anything "group" specific in the storage code at first glance
[09:13:15] <brook> No, I couldn't either. I was wondering if there was some group specific thing that added the directory so it can be served as static
[09:13:33] <seanh> Dunno
[09:13:46] <seanh> First thing I'd do is figure out how the directory with the group images is served
[09:14:46] <seanh> I'm guessing they aren't served static
[09:15:20] <seanh> There is an authorization check I think, if you're authorized to view this file (which could be what's giving you a 404, maybe)
[09:16:58] <brook> Okay - I'll root around the group stuff to see if I can figure out how their images are served.
[09:18:31] <brook> Also the old related served an image.
[09:26:23] <seanh> I dunno if the old related let you upload those images though
[09:26:56] <seanh> I'd try to figure out which controller method (if any) is serving those uploaded group files
[09:31:10] <seanh> What are the chances of us being able to upgrade repoze.who?
[09:31:32] <seanh> Installing 1.0.19 in a virtualenv breaks the vim plugin syntastic, but 2.2 doesn't
[09:32:33] <seanh> There are some backward-incompatible changes that sounds like they might break us though
[09:34:01] <brook> I'm looking at the OpenID stuff soon, which is relate to upgrading repoze
[09:34:25] <brook> Is that the imcompatibility your seeing, or something more?
[09:35:09] <brook> We also need to upgrade repoze to use httponly and secure cookies, I believe
[09:35:13] <rossjones> seanh old related just took a url.
[09:35:24] <seanh> It's this baffling thing http://stackoverflow.com/questions/26800656/python-syntax-checkers-pylint-prospector-crashing-with-keyerror-repoze-w
[09:35:59] <seanh> Pylint crashes when repoze.who 1.0.19 is installed, but only when pylint is run from inside vim! The traceback is not telling me much either
[09:37:24] <rossjones> seanh I take it that used to work for you
[09:37:35] <rossjones> it's not something new you're trying?
[09:38:16] <rossjones> https://github.com/jmcantrell/vim-virtualenv suggests that executing stuff from inside vim with ! won't use the virtualenv.
[09:40:31] <seanh> If you run vim in a shell and a virtualenv is activated in that shell before you start vim, vim uses the virtualenv
[09:40:39] <seanh> (Can verify by doing !which pylint)
[09:40:48] <seanh> That plugin is more for gvim I think
[09:41:17] <seanh> I just installed a newer repoze.who and the crash goes away. Then downgrade back to 1.0.19 and the crash does not come back
[09:41:33] <seanh> And the pkg_resources.py source code looks different as well
[09:42:18] <seanh> Syntastic did used to work for me, yes, though I can't remember if I was using pylint with it. It ought to work though
[09:44:01] <rossjones> sounds like 1.0.19 is flaky
[09:44:25] <rossjones> even though it's only crashing in vim, should make you suspicious that it'll generally be flaky
[09:44:53] <seanh> I can reproduce the error by destroying and recreating my virtualenv and install repoze.who==1.0.19 into it
[09:45:12] <seanh> But then upgrade repoze.who and the error goes away, downgrade it again and the error doesn't come back
[09:46:35] <rossjones> what's the changelog like between 1.0.19 and 2.x?
[09:47:02] <seanh> After you upgrade repoze.who, the source code of that pkg_resources.py file that is crashing is completely different
[09:47:10] <seanh> That file is not part of repoze.who!
[09:48:00] <seanh> It could be something to do with "Remove ez_setup.py and dependency on it in setup.py (support distribute)." in repoze.who 2.0.a1
[09:49:00] <rossjones> annoying i guess.
[09:49:07] <rossjones> does ckan break with 2.x?
[09:49:30] <seanh> I'm happy to work around this by doing the upgrade and downgrade thing
[09:49:40] <seanh> I'll give ckan a quick tests with the newer one though
[09:50:01] <rossjones> amercader had a page somewhere which showed which deps were out of date
[09:50:39] <seanh> I think I've seen a coveralls-like service for "are your deps up to date?" Getting CKAN to 100% might be challenging
[09:50:54] <amercader> rossjones, seanh: https://requires.io/github/ckan/ckan/requirements/?branch=master
[09:51:05] <amercader> good luck :)
[09:51:38] <rossjones> oh crap
[09:51:52] <amercader> rossjones, seanh: I reviewed and upgraded the most ominous a while ago but at some point there was stuff blocked by code
[09:51:59] <rossjones> love that it shows changelogs on that page.
[09:52:16] <amercader> ie pylons, babel
[09:52:46] <amercader> some of these could be easily updated though
[09:53:02] <rossjones> anyone know why Mako is still there?
[09:53:11] <rossjones> is it from pylons?
[09:53:53] <seanh> Oh dear we aren't doing very well at thatr
[09:53:56] <amercader> rossjones: yeah, is a requirement  of requirement, we only require these https://github.com/ckan/ckan/blob/master/requirements.in
[09:54:32] <amercader> seanh: it's mostly pylons and the lot, and the other blockers listed in ^
[10:02:47] <rossjones> Doesn't seem to be a lot in pylons itself to make it worth upgrading, expect for it's requirements I guess?
[10:08:14] <seanh> Oh man, but after installing CKAN's requirements then upgrading and downgrading repoze.who I get "cannot import UnicodeMultiDict" from the tests
[10:08:38] <seanh> webob
[10:10:16] <seanh> pip install -U -r requirements.txt gets it, just downgrading repoze doesn't downgrade other things that got upgraded by upgrading repoze
[12:35:20] <rossjones> wardi how do you handle multi-lingual tags/vocabs on .ca atm?
[13:03:05] <wardi> rossjones: terribly
[13:03:42] <wardi> rossjones: plan is to use a repeating choice field instead (can't extend tags so they're of no use)
[13:04:11] <wardi> the choices will be defined in a scheming schema so I can put as much extra detail there as I want
[13:05:11] <wardi> rossjones: and if I define them as a "preset" they can be shared between schemas
[13:05:49] <rossjones> I might be working on https://github.com/ckan/ideas-and-roadmap/issues/103 soon, and might suggest SKOS (which supports multiple languages for labels).
[13:06:01] <wardi> skos?
[13:06:12] <rossjones> RDF markup for defining controlled vocabs
[13:06:28] <rossjones> http://www.w3.org/2004/02/skos/
[13:06:53] <rossjones> hierarchical vocabs with multilingual labels I think is probably the key headline.
[13:06:56] <wardi> uh-oh. it has "simple" in the name
[13:07:05] <rossjones> yeah, never a good sign.
[13:07:12] <rossjones> but in this case it isn't terrible
[13:08:05] <wardi> that sounds like it could be a good source to generate a scheming preset for a field
[13:08:30] <rossjones> Could be.
[13:08:48] <wardi> scheming is intentionally ckan-specific so that no flexibility is sacrificed at the altar of Standards
[13:09:01] <rossjones> Heh, sounds like a good plan.
[13:09:31] <wardi> rossjones: thanks for the heads up though. I'm very interested to help
[13:09:46] <rossjones> although all the vocabs we're interested in are already in skos format. cofog etc.
[13:10:24] <wardi> I'll raise that with our clients. I'm sure they could start using it too if it has multilingual built-in
[13:10:26] <rossjones> I seem to be falling into the semweb trap today ....
[13:11:34] <wardi> what;s that?
[13:12:44] <rossjones> the semweb reality distortion field. If you use this stuff it'll magically make the web better.
[13:14:54] <wardi> yeah, no. in cases where some of it solves an actual problem someone has then maybe
[13:15:44] <wardi> I don't know why I have so much trouble reading these rdf examples.. I mean they're not xml at least, maybe it's all the prefix: stuff and the camelCase
[13:19:13] <rossjones> heh
[13:27:37] <wardi> is the @<lang> part of rdf or some other standard?
[13:31:03] <rossjones> xml:lang is part of the rdf repr of the data, TTL will use a different way
[13:32:35] <rossjones> it's actually in the xml namespace,, X:something just means the something tag in the X namespace, and normally the X is defined as a URL in a parent element
[13:33:18] <wardi> TTL?
[13:33:39] <rossjones> it's another serialisation
[13:33:50] <rossjones> http://www.w3.org/TeamSubmission/turtle/
[13:34:20] <rossjones> I prefer the xml :)
[13:35:46] <wardi> ok, TTL is the serialization in these examples that I'm having trouble reading
[13:48:07] <shellac> rossjones: now a recommendation <http://www.w3.org/TR/turtle/>
[13:48:10] <wardi> rossjones: make that two of us over here that are interested in multilingual heirarchical taxonomies
[13:51:09] <rossjones> I've added some notes on https://github.com/ckan/ideas-and-roadmap/issues/103, will speak to dread tomorrow - I think the plan is to discuss it at Thursday's meeting (which I can't make) because we've got a meeting tomorrow.
[13:57:47] <seanh> If your test method doesn't fit on one screen on a big external monitor, you're doing something wrong
[13:58:06] <rossjones> thanks shellac. Is using TTL the 'best practice' now?
[13:58:28] <rossjones> I still can't over why so many ways to write IRIs ...
[13:58:41] * wardi struggles to not read that as transistor transistor logic
[13:59:10] <shellac> people certainly prefer it to rdf/xml, which is infamously unreadable
[13:59:57] <rossjones> neither are particularly legible :)
[14:00:56] <shellac> rossjones: turtle comes from timbl's N3 (notation-3), which was supposed to be a 'scribblable' logic language
[14:01:23] <shellac> so it depends whether your brain works like timbl's :-)
[14:02:04] <rossjones> but n3 just has one way of specifying IRIs, no?
[14:02:07] <shellac> I think it's pretty simple: <me> a foaf:Person; ex:age 21; etc
[14:02:09] <rossjones> rather than 9
[14:02:52] <rossjones> More concerned about reading other people's TTL, might take a lot of decoding when in principle things like @base or BASE and @prefix or PREFIX are pointless.
[14:02:59] <shellac> turtle has two way to right them: prefixed (foo:bar) and full (<http://example.com/bar>, <bar>)
[14:03:18] <shellac> ah, I see.
[14:03:42] <rossjones> I think N3 is perfectly readable.
[14:04:03] <rossjones> but then the subject always seems to be long-hand.
[14:04:09] <shellac> well turtle is N3 (a proper subset iirc)
[14:05:01] <shellac> use a parser. seriously, life is too short, and python has perfectly good rdf parsers
[14:05:23] <rossjones> Actually I kinda like json-ld - closest to usable I've seen
[14:06:52] <shellac> json-ld can look nice, yes. otoh it achieves that to some degree using contexts, which are a bit like DTDs in xml
[14:07:10] * shellac stroke metaphorical grey beard
[14:07:13] <rossjones> I don't mind XML so much :)
[14:07:16] <seanh> The CKAN Service Provider tests are kind of amusing
[14:07:23] <seanh> They're pre new testing standards I guess
[14:07:28] <rossjones> seanh amusing haha or amusing wtf?
[14:07:55] <seanh> For example test_not_authorized_to_view_job(): Creates a job, tries to get the job status without proper auth, asserts expected 403 response
[14:07:56] <wardi> or just overly clever
[14:07:57] <seanh> Fair enough
[14:08:20] <seanh> THen there's four extra lines at the bottom that assert that the same request with the right auth gets a 200!
[14:08:43] <seanh> So that would be test_not_authorized_to_view_job_and_test_authorized_job(), then
[14:08:43] <rossjones> I haven't read the new testing standards yet :|

2014-11-09

2014-11-08

2014-11-07
[08:29:37] <rossjones> gnat_x is your ckan.ini site url set to https?
[09:37:00] <brook_> Is there a 'proper' way to get package extra values? Currently I'm doing things like this: pkg._extras['image_url'].value
[11:53:24] <seanh> repoze.who is breaking pylint and prospector in vim/syntastic :( http://stackoverflow.com/questions/26800656/python-syntax-checkers-pylint-prospector-crashing-with-keyerror-repoze-w (it wasn't doing this before)
[11:54:26] <seanh> brook_: Do you need to access extras on a package object? Shouldn't you be using package dicts that come from logic layer functions like package_show, package_search etc?
[11:57:55] <brook_> This is in a logic action (update). The package is retrieved with pkg = model.Package.get(name_or_id), and I need the image_url that I have in the extras.
[11:58:48] <seanh> You're editing package_update?
[11:58:58] <seanh> But anyway, I don't know if there is a Right Way
[11:59:12] <seanh> You shouldn't have to access a _private field
[11:59:31] <brook_> Yeah - I've got my own showcase_update.
[11:59:34] <seanh> Maybe the model.Package class needs a .extras property added?
[12:00:23] <seanh> showcase_update() can work by calling package_* logic functions and working only with the package dicts, probably
[12:10:44] <shellac> stab in the dark here: can anyone think of a reason why newly added _datasets_ would show up when added, but _relationships_ would not be indexed in solr at the same time?
[12:11:14] <shellac> (when I say 'show up' I mean searches would find them, so presumably they're indexed in solr)
[12:11:34] <shellac> a full reindex fixes it
[12:15:29] <wardi> brook_: as seanh says, i don't think using the model directly is normal
[13:08:17] <brook_> Yes - I'll see if I can rethink it. I seem to be duplicating a lot of package code (controllers and actions) so I can make sure an image gets uploaded.
[15:15:59] <wardi> brook_: can't you upload images as resources?
[15:17:19] <brook_> wardi: It's an image to represent the dataset object. Like each group can have an image
[15:17:56] <wardi> right. groups have a way to upload an image, datasets have ways to upload resources (which could be images)
[15:26:42] <brook_> I see - yes, I can perhaps do it that way. I suppose it seems heavy handed, but it does mean we will have a relatively straightforward way to allow several images in the future.

2014-11-06
[09:16:29] <george_s> Regarding https://github.com/ckan/ckan/issues/1905 Would someone be able to give me a little guidance on adding a test? One of my team was working on this a few weeks back but wasnt sure about the adding test part. Theres a comment from me at the bottom of the issue.
[14:59:59] <wardi> amercader: +1 on both your general questions in the pad
[15:00:37] <amercader> wardi: cool, the resource_create thing is specially worrying
[15:01:08] <wardi> and we can get rid of clear_auth_functions_cache()
[15:01:28] <wardi> (which is what I added to be able to test some permission changes)
[15:01:38] <amercader> ok
[16:04:00] <amercader> wardi, joet, seanh : minus points for being late
[16:04:11] <amercader> and potentially lots of reviews!
[16:04:35] <amercader> dev meeting starting now: https://plus.google.com/hangouts/_/event/cb1vmkss426lkqicj94a3amvd1c?authuser=1&hl=en-GB
[16:05:54] <wardi> wait what?
[16:06:36] <amercader> wardi: 16:00 UTC?
[16:07:24] <wardi> oh, worldclocktime is still on daylight
[16:10:04] <joets_> apologies my router just died
[16:23:29] <wardi> i migh be having bandwidth issues. would someone ask vincenzo to turn off video?
[16:37:28] <amercader> wardi: we assigned #2036 to you because canada
[16:38:11] <amercader> wardi: also the moderated edits one, but I'm happy to help with that one once 2.3 is out
[17:08:01] <gjlawran> NA Dev hangout URL?
[17:14:16] <gjlawran> Missed it due to DLS. URL in  open gov WG was for Oct 31 - which was DaylightSavingsTime - we are now off that adjustment . Reading the notes.
[18:25:48] <wardi> wow, ok so travis is running tests against the result of merging with the target, not on the commit itself
[18:30:07] <wardi> hopefully that explains why I can't reproduce this test failure
[18:33:09] <wardi> nope
[19:27:52] <wardi> this is the failure I just can't reproduce https://github.com/ckan/ckan/pull/2034 does this code fail for anyone else?
[19:42:32] <gnat_x> hi folks. two ckan admin side questions.
[19:42:54] <gnat_x> 1) we have set up a user, and changed her password. she can't log in with that pass.
[19:43:35] <gnat_x> i tried changing it again and logging in, and am presented with an error that the username doesn't exist (not true, copied it from the manage page), or password is wrong.
[19:43:48] <gnat_x> not sure how to work around that.
[19:44:50] <gnat_x> 2) we're using an nginx, varnish setup and i'm seeing a lot of redirect loops, i'm wondering if ckan looks at and/or respects the  X-Forwarded-Proto https header?
[19:56:19] <wardi> gnat_x: don't know that it does respect that header. almost all links should be relative though
[19:56:39] <gnat_x> yeah. only noticing this in form submissions.
[19:57:08] <gnat_x> and because i run request policy which makes me click through them.
[19:58:02] <wardi> redirects after form submissions are a fairly normal thing
[19:58:09] <gnat_x> *nod*
[19:58:37] <wardi> all the ckan forms I've used will redirect if there are no errors in the form
[19:59:41] <gnat_x> right, but i'm going from https://ckan.example.com/users/foo to http://ckan.example.com/users/foo.
[20:00:22] <gnat_x> not the hugest deal, just something i noticed and was curious about.
[20:00:42] <gnat_x> we have something of a non-standard setup, so it may not even be a ckan problem.
[20:00:47] <wardi> oh, right. redirects do need the full protocol and hostname
[20:01:16] <wardi> gnat_x: it's worth fixing if the right info is in that header

2014-11-05
[09:20:48] <amln> rossjones: yes, that's the one I was thinking of.
[11:55:54] <travis-ci> joetsoi/ckan deprecate-openid-tests 944ab87 http://travis-ci.org/joetsoi/ckan/builds/40049525 joetsoi: The build was broken.
[13:17:51] <brook> Is master.ckan.org the github master?
[13:19:08] <Zharktas> the footer contains the current commit id
[13:19:41] <brook> So it does - thanks
[14:17:37] <travis-ci> ckan/ckan master ab9242d http://travis-ci.org/ckan/ckan/builds/40061518 Brook Elgie: The build was broken.
[14:38:40] <seanh> if key in ("max-length"):
[14:39:10] <seanh> Is not actually looking for key in a length-1 iterable of strings, but treating the one string itself as an iterable
[14:39:30] <seanh> Found by pylint as "unnecessary parens"
[14:39:37] <seanh> This is why we should all be using syntastic
[14:39:49] <seanh> And also why you should use [] for inline iterables
[14:42:38] <wardi> if we care about performance (heh) we should be doing separate == comparisons instead os using in
[14:42:48] <wardi> *of
[14:43:40] <seanh> Really? I would have thought in was optimised
[14:43:50] * seanh Does not care about performance!
[14:56:48] <wardi> seanh: it does what you tell it to: create a temporary tuple or list, fill it with with each of the constant strings, try to call __contains__ (not found), call __iter__ to iterate over each element and compare each one, then throw it all away
[14:58:05] <wardi> the bytecode for a few == and or's is "compare with this constant string already in a table", and again for the next...
[14:59:14] <rgrp> #headsup - ckan community meeting starting in 2m
[14:59:24] <rgrp> gdoc here for details - https://docs.google.com/a/okfn.org/document/d/1j4yGUWUJY0UlcEn70-23CKg-nQzz4s0DdkA24OR-HS8/edit#
[15:00:22] <seanh> I've got a 59-character doc string. Including 6 quote chars (3 either side) plus 4 chars indentation it's 80 characters, too long by pep8
[15:00:31] <seanh> So the closing """ gets wrapped onto the next line
[15:00:35] <amln> rgrp: for the call, does one need to dial-in as well as using the web thing?
[15:00:41] <amln> or is there no one talking?
[15:01:02] <seanh> But then pep257 complains that "one-line docstring should not occupy two lines"
[15:01:06] <rgrp> amln: no-one talking yet - webex is booting for me
[15:01:09] <seanh> I don't thing there's any way out of this
[15:01:31] <amercader> rgrp, amln: should the webex thing work on linux?
[15:02:31] <amln> amercader: does it not?
[15:02:45] <amercader> "Java is not working."
[15:02:46] <amercader> sigh
[15:03:02] <amln> amercader: in my view, yes. And it should be the case (in my view) that we shouldn't need to make international calls.
[15:04:11] <amln> rgrp: can we switch to Hangout?
[15:06:26] <wardi> need to phone in
[15:07:24] <amln> wardi: don't suppose you know if there are international / local numbers?
[15:07:25] <rgrp> amln: god idea ...
[15:07:41] <amln> rgrp: on last count there were 12 people there
[15:07:47] <amercader> http://www.cisco.com/web/about/doing_business/conferencing/index.html This didn't work for me
[15:07:51] <amln> if we do over-the-air others can listen too.
[15:08:00] <amercader> with the conference id on the doc
[15:08:23] <amln> amercader: i copy/pasted the link which seemed to work.
[15:08:38] <amln> but no audio, because i've not yet worked out best way to dial-in
[15:09:42] <dread_> i've used skype to dial the freephone number and it works great
[15:10:06] <amln> dread_: ah, will try that!
[15:10:17] <amln> cheers
[15:20:12] <amln> https://github.com/ckan/extensions.ckan.org/issues/5 is the issue
[15:38:04] <shellac> Is their much advantage to writing a harvester over using a separate tool using the api to push data into ckan?
[15:38:47] <wardi> shellac: either is a good approach
[15:38:51] <amercader> shellac: depending on your use case. Harvesters are good for regular periodic updates
[15:38:57] <shellac> we have a harvester, and there are a number of moving parts to the entire setup. considering simple removing it.
[15:40:31] <shellac> by which I mean: gather consumer, fetch consumer, then periodic harvester job-all and run
[15:41:12] <shellac> Harvesters do have a controllable UI, of course
[15:42:39] <amercader> shellac: there's discussion about simplifying harvesters here: https://github.com/ckan/ideas-and-roadmap/issues/80
[15:42:51] <amercader> do share you feedback there if you want
[15:43:41] <shellac> amercader: thanks. nice to know it's not just me :-)
[16:15:37] <wardi> rgrp: Nice job. I think our community meetings are improving :-)

2014-11-04
[10:46:47] <seanh> Does anyone else tink the datapusher log is upside down?
[10:47:15] <seanh> In the DataStore tab, when "managing" a resource
[10:47:27] <seanh> The newest events are at the bottom of the page, instead of at the top
[10:50:23] <amercader> seanh: yeah, it should be the other way around
[10:50:45] <amercader> seems easy enough to change. we can ask johnmartin
[11:42:14] <rossjones> is the meeting on today at 12 or 12.30?
[11:51:50] <amercader> rossjones: 12
[11:52:15] <rossjones> ta.
[11:52:25] <nigelb> rossjones is attending a meeting? zomg.
[11:52:57] <rossjones> nigelb cheeky, I made one last week, or was it the week before?
[11:53:06] <rossjones> I am coming to make sure nothing gets assigned to me ;)
[11:54:53] <nigelb> haha
[12:03:40] <amercader> wardi, seanh, rossjones , joet: let's do this https://plus.google.com/hangouts/_/event/cb1vmkss426lkqicj94a3amvd1c?authuser=1&hl=en-GB
[12:19:27] <rgrp> #headsup the community call is tomorrow at 3pm ...
[12:19:43] <rgrp> wardi or others - great to get an update from tech team ...
[12:20:58] * amln is glad https://github.com/ckan/ckan/issues/2026#event-187978303 wasn't assigned to him
[12:26:23] <rgrp> ckan extension registy update is now live http://ckan.org/2014/11/04/ckan-extension-registry-share-and-find-ckan-extensions/
[12:27:18] <george_S> github: george-sattler
[12:27:46] <rossjones> Must be close to the record for quickest meeting?
[12:28:19] <wardi> rossjones: nah, joe chaired some that were <10mins
[12:28:30] <rossjones> speed triage
[12:29:23] <wardi> we should track the records though :-)
[12:29:52] <wardi> and meeting time/(issues+prs) raised
[15:43:08] <amercader> seanh: what is the preferred way of loading test plugins when writing tests? Should I register them on setup.py under 'ckan.test_plugins' and the p.load() them?
[15:51:17] <seanh> amercader: Not sure of any examples in core, but in extension tests I've been doing this: https://github.com/ckan/ckanext-deadoralive/blob/master/ckanext/deadoralive/tests/helpers.py#L130
[15:51:34] <seanh> This is for funtional tests using webtests though
[15:51:58] <seanh> Basically I add the plugin to the config before I make the test app
[15:52:23] <seanh> But if you're not using a test app i'm not sure
[15:55:28] <amercader> seanh: I need to actually register the plugin somewhere, so registering on 'ckan.test_plugins' + p.load worked for me
[15:55:31] <amercader> let's see how it goes
[15:55:48] <amercader> and these are not functional tests
[17:05:25] <seanh> Is it really bad to have a -- command line args as a flat?
[17:05:49] <seanh> e.g. foobar --deduplicate turns on deduplication (which is off by default)
[17:06:10] <seanh> Rather than having to type foobar --deduplicate true
[17:07:37] <rossjones> seanh I think it's fine, for instance now -v for verbose would be '--verbose true'
[17:07:44] <amln> i guess it depends on interpretation of unix philosophy.
[17:07:47] <rossjones> and optparser etc have options for setting a bool
[17:08:59] <amln> or perhaps POSIX (wider picture)
[17:09:02] <rossjones> see cat -t, cat -u etc
[17:09:40] <rossjones> amln I thought we were giving up on posix now the systemd guys said we should :P
[17:10:50] <seanh> Hmm, never mind, I thought argparse was refusing to let me do it but I was being stupid
[17:17:21] <amln> rossjones: heh.
[17:17:37] <amln> rossjones: did you see the idea of doing system stuff in SQL the other day?
[17:18:51] <amln> hum, can't find the thingy.
[19:07:13] <rossjones> amln from facebook - https://github.com/facebook/osquery
[19:07:42] <rossjones> someone posted a postgres foreign wrapper example on HN.  Not that I read HN, I just noticed it on the way past (ahem).
[23:29:16] <travis-ci> ckan/ckan 1414-remove-moderated-edits b985a53 http://travis-ci.org/ckan/ckan/builds/40004010 David Read: The build was broken.

2014-11-03
[15:10:29] <gr8> Hi! Is it possible through "paster sysadmin add ..." to attach the password (through an special parameter?), so that no user interaction is required (e.g. paster sysadmin add seanh -c=development.ini -p mypassword)?
[15:12:02] <amln> gr8: i saw this the other day; i looked at the code which documents more options than the docs.
[15:14:31] <amln> ckan/lib/cli.py
[15:14:49] <amln> can def add a user with a password.
[15:15:37] <amercader> gr8: not via "paster sysadmin add (it would be nice, so PR welcomed). You probably can do "paster user add test_user password=xxxx" and "paster sysadmin add test_user"
[15:16:52] <gr8> thank you!!!
[15:43:32] <wardi> wouldn't want to do that if you don't trust all the users on the box (because ps)

2014-11-02

2014-11-01

2014-10-31
[09:08:38] <seanh> Anyone remember what this duplicate key foo error from the db is? http://stackoverflow.com/questions/26634914/intermittent-ckan-database-backup-error
[09:09:52] <nigelb> It's the datastore I think
[09:10:23] <rossjones> why does db dump execute 'CREATE TABLE'?
[09:10:24] <nigelb> We ask people to remove extensions from their config file before backing up for this reason.
[09:10:34] <nigelb> because it loads the datastore plugin
[09:10:40] <rossjones> ah
[09:10:41] <nigelb> and datastore plugin does things.... non-ideally.
[09:11:09] <nigelb> why do we have a load and dump command when psql can do it better?
[09:14:16] <rossjones> nigelb I think wardi might have done a nicer dump/load thing, but I could be mis-remembering.
[09:14:58] <rossjones> but yeah pg_dump would work
[09:15:06] <rossjones> it's what I normally use :(
[09:15:10] <nigelb> same here
[10:04:00] <seanh> Where do we document this kind of thing though? I was thinking the wiki on our private github repo, for documenting internal commercial team stuff
[10:04:04] <seanh> Ooops
[10:11:32] <amln> rossjones: do i hear correctly that you have a CKAN extension for ODI certificates?
[10:13:04] <rossjones> amln It's the DGU one.
[10:13:30] <rossjones> Just polls the feed for certs on your domain and adds extras.  Still need to do you own templates though (because genshi).
[10:13:48] <rossjones> And it won't scale once ODI start harvesting, but dread and I are talking to them about their API.
[10:14:14] <rossjones> https://github.com/datagovuk/ckanext-certificates
[10:14:55] <rossjones> amln we're also working on the provenance issue (want the original urls certificate, not a harvested url's certificate). If that makes sense.
[10:19:20] <amln> ah, scaling :)
[10:19:48] <amln> trust certainly makes sense in the validation/cerification process.
[10:22:18] <rossjones> amln if you need this you might be able to persuade ODI to pull all the data from your instance rather than try to manually complete the certificates.
[10:22:34] <rossjones> They're using atom feeds atm
[11:07:03] <rossjones> amercader just saw your ckanext-dcat mail - nice one!
[11:07:54] <rossjones> does this mean we can remove the current rdf rendering in core?
[11:09:09] <amercader> rossjones: thanks
[11:09:25] <amercader> rossjones: not yet! current work is only rdf -> ckan
[11:09:44] <amercader> but we could easily follow the same principle the other way round
[11:10:24] <rossjones> that would be awesome.
[11:10:36] <rossjones> I submitted a suggested challenge to http://standards.data.gov.uk about standardising on DCAT with dread rather than this closed LGA inventory format.
[11:10:50] <rossjones> So this is a good start towards that :)
[11:11:20] <amercader> rossjones: sounds great!
[11:12:03] <rossjones> http://standards.data.gov.uk/challenge/data-catalogue-interoperability-standard
[11:14:34] <rossjones> Anybody who wanted to post a comment suggesting DCAT would definitely go on my free-beer list ;)
[11:19:09] <amercader> rossjones: will try and do
[11:46:01] <wardi> amercader: foaf:homepage has been associated with pkg.url in the default read template
[11:46:20] <wardi> is extra:publisher_url a better place for it?
[11:48:08] <amercader> wardi: that's what is used on the new dcat/ckan mapping. Our pkg.url is really dcat:landingPage
[11:48:34] <amercader> I think that the mappings on the read template need to be reviewed and changed
[11:49:19] <amercader> they have been there forever without somebody really checking if they make sense
[11:53:19] <wardi> amercader: ok, I'll have to fix it here too https://github.com/open-data/ckanext-scheming/blob/master/ckanext/scheming/ckan_dataset.json#L50-L54
[11:55:37] <wardi> I don't like the way the dcat usage notes are written. 'smushing' is a word that should not appear in a technical document
[11:57:32] <wardi> do they mean merging?  "..when different URIs are used" .. where?  "is an inverse functional property (IFP)" sounds important, but no link to more information...
[11:58:43] <wardi> amercader: I'm happy I'm not the one that went through that document :-)
[11:58:48] <amercader> wardi: unfortunately that is a constant on Linked Data specs in general, it is generally assumed that readers will be familiar with stuff like this
[12:00:46] <wardi> amercader: ok, so I read "when different URIs are used" and I want to ask "for what? by whom?" that's because I'm not familiar enough with the lingo
[12:02:07] <amercader> wardi: I have no idea what that means either, aren't URIs supposed to be unique?
[12:02:19] <wardi> ok. so it's not just me :-)
[15:28:28] <amercader> arghhh, the data preview internals is messed up, helpers to lib to controllers..., different logic for different ckan versions...
[15:28:56] <amercader> Sorting the resource views internals might be longer than expected

2014-10-30
[16:02:01] <amercader> sounds exciting
[16:02:33] <rossjones> hahahaha
[16:02:41] <rossjones> nerve wracking
[16:03:41] <wardi> will be there asap
[16:24:51] <rgrp> amercader: quick question based on something someone asked me - what's state (if any) of datastore geo support (e.g. turning on postgis and doing spatial queries) - i guess this is straight-up possible using sql querying and i know vitor was looking at something like this earlier
[16:25:36] <wardi> no audio from me?
[16:33:15] <amercader> rgrp: no geo support out of the box, you can use postgis + sql queries
[16:33:53] <amercader> rgrp: or like the natural history museum guys did, use the new extension points in the datastore to support spatial params and build your queries internally
[16:48:20] <seanh> Just downloaded the html5 spec to my ebook reader
[16:48:23] <seanh> Over 1000 pages
[16:48:38] <seanh> Nice bedtime / weekend reading
[16:49:09] <seanh> It is kind of funny how much w3c and whatwg are fighting, the whatwg spec contains a dig at the w3c spec in it's opening
[16:49:46] <dragon> wow
[18:07:17] <seanh> I'm suggesting that we forget about Ubuntu 14.04 for the CKAN 2.3 release. It's not that it can't be done, but that I think it is too time consuming to be worth while yet
[18:07:20] <seanh> https://github.com/ckan/ckan/pull/2020#issuecomment-61140714
[18:33:06] <mchelen1> i do love the docker version
[18:34:54] <mchelen1> is the idea to have a user-readable install guide for 14.04, as opposed to vagrant or similar?
[18:36:09] <mchelen1> i guess some method has to be workable for any deployment system
[18:38:38] <mchelen1> part of my thinking is that id like to help test the 14.04 install procedure, without having to manually iterate through the install guide
[18:40:34] <seanh> We have user-readable install and deployment guides, yes
[18:40:41] <seanh> Plus an Ubuntu package
[18:40:53] <seanh> We don't have any official Vagrant support
[18:41:27] <seanh> The docker thing is very experimental, there's lots of things you can't do with it, and no one has run the tests on a dockerised ckan afaik
[18:41:48] <seanh> Since Ubuntu 14.04 breaks a couple of things, and the docker version uses 14.04, I assume it's a bit broken
[18:41:53] <seanh> It probably mostly works though
[18:42:26] <seanh> Docker will probably be the future if we can get it all working really well
[18:42:57] <mchelen1> ah ok, yeah i think that is one good system to standardize on
[18:43:19] <seanh> mchelen1: We kind of need written install docs because people not using Ubuntu can follow them and adapt them to their own operating system
[18:43:22] <mchelen1> the docker config could even use 12.04 and still be run on 14.04 servers
[18:43:47] <seanh> However, if we had some sort of automated install with the code annotated, it might serve both purposes
[18:43:54] <mchelen1> seanh: yeah i can see the value in that, i'm wondering if there is any way to share / sync steps between automated and manual install methods
[18:44:09] <mchelen1> for example a heavily commented install script
[18:44:16] <seanh> Yep
[18:44:28] <mchelen1> so that its easy to run the whole thing for testing
[18:44:37] <mchelen1> without sacrificing user readability
[18:44:56] <mchelen1> maybe its easier just to manually sync an install guide & install script
[18:46:55] <mchelen1> as long as it results in some automated build that can be tested
[18:47:24] <mchelen1> vagrant is good for that but seems to be intended only for development instances
[18:47:41] <mchelen1> whereas something like docker or ansible could potentially be used in production as well
[18:50:17] <seanh> Something like this might work well: http://fitzgen.github.io/pocco/
[18:50:32] <seanh> (Though possibly not readthedocs compatible)
[18:51:07] <seanh> Yes, unifying dev and prod environments is one of the best promises of docker, imo
[18:52:01] <mchelen1> pocco looks interesting, its probably better than trying to make users read raw comment blocks in the code

[01:22:01] <wardi> rossjones: sure i'll jump back in
[10:33:54] <amercader> seanh: if you re finding problems with solr maybe that's another reason why we should move away from jetty to tomcat
[10:34:26] <amercader> I've been using it on the latest projects and had 0 problems with it, also the install requires less steps
[10:46:07] <seanh> amercader: Yeah, the jetty package is broken in Ubuntu 14.04. For the source install I've done a workaround in the docs
[10:56:07] <amercader> brook: FYI as part of getting rid of resourcegroups rossjones added a db migration script that added some changes to the revisions tables. The local db needs to be updated with `paster db upgrade` when this happens. That's why you got the test errors https://github.com/ckan/ckan/blob/master/ckan/migration/versions/074_remove_resource_groups.py
[10:58:27] <nigelb> 23
[10:58:31] <nigelb> gah
[10:58:50] <seanh> I think Travis is going to stay Ubuntu 12.04 - that seems to be a Travis-wide thing, there's no option (nor will we have any option when they do decide to upgrade it to 14.04)
[10:58:58] <seanh> I guess we can boot a VM inside Travis
[10:59:22] <nigelb> That doesn't sound ideal :/
[11:02:19] <brook> amercader: I suppose it's a good idea to run `paster db upgrade` everytime I pull from master, in case there's a migration there.
[11:05:03] <amercader> brook: is not very common tbh
[11:14:56] <rgrp> btw does someone from tech team want to update meeting times on http://ckan.org/about/technical-team/ (i understand thursday is now 4pm (?))
[11:15:00] <rgrp> i'm also happy to ...
[11:18:57] <rossjones> does anyone from the technical team actually have WP access?
[11:20:02] <amercader> I have, I can update it in a moment
[12:00:12] <nigelb> 9:30 pm. This is the meeting I'll sleep through, I guess :)
[12:16:29] * rossjones makes a mental note to assign stuff to nigelb
[12:17:21] <nigelb> Heh
[12:20:13] <brook> I'm writing a test that checks that a new dataset appears on the dataset search page by checking that the response for /dataset contains '1 dataset found'. However, the results of that page come from a solr search, and the results are being persisted between tests, so each time I run the test I have another dataset in the results: 2 datasets found, 3 datasets found etc. How do I get solr to reset between tests. My test class
[12:20:14] <brook> subclasses helpers.FunctionalTestBase.
[12:23:48] <wardi> brook: we should fix FunctionalTestBase so it resets solr at the same time it resets the db
[12:31:30] <amercader> brook: I the meantime you can do this on your teardown method: https://github.com/ckan/ckan/blob/master/ckan/new_tests/logic/action/test_get.py#L18
[12:31:44] <amercader> or setup
[12:31:49] <amercader> rather
[12:31:59] <brook> Ah - is that it, cool
[12:32:10] <brook> The magic words :D
[12:42:08] <nigelb> I have a feature request idea for CKAN that I want to talk about before I write a proposal for ideas
[12:42:30] <nigelb> a) A way to have a user login and then be forced reset their password.
[12:42:45] <nigelb> This is important if an admin reset a password and sent it over email.
[12:43:08] <nigelb> b) A way to declare that all the passwords on the site is compromised and everyone needs to reset their passwords.
[12:43:20] <nigelb> For (b) I wonder if setting it to a random string would be enough.
[12:43:36] <nigelb> Or empty string.
[12:43:39] <amln> nigelb: how do other platforms do this, I wonder.
[12:43:52] <amln> I think WP sets a flag in the user table, doesn't it?
[12:43:58] <nigelb> a) is usually a flag, yes.
[12:44:49] <seanh> nigelb: Sounds fairly easy to implement
[12:45:46] <nigelb> ok
[12:45:58] <nigelb> I'm going to propose on ideas and pick it up myself to actually implement.
[12:54:49] <wardi> brook: search.clear() would be better as part of that FunctionalTestBase, the you don't need your own setup()
[12:55:57] <wardi> nigelb: that or a password expiry date. some people that like passwords to expire
[12:56:13] <brook> wardi: Sure - I'll make an Issue/PR for it.
[12:56:40] <wardi> brook: not just fix it as part of the change you're working on?
[12:57:04] <wardi> I guess it's not related but it doesn't seem very controvertial to me
[12:57:27] <nigelb> wardi: I'll open the ticket and we can nail it down.
[12:58:24] <brook> wardi: My thing is an extension, not in core.
[12:58:39] <wardi> brook: ah, right
[12:59:30] <seanh> Ugh, our Apache config totally doesn't work on 14.04
[12:59:42] <seanh> And fixing it requires learning about Apache configuratio
[13:00:31] <nigelb> seanh: I can help
[13:00:37] <amercader> seanh: isnt' just a change in how the permissions are defined?
[13:00:41] <nigelb> Apache changed how it's configured
[13:00:48] <nigelb> There are migration guides on the Apache website
[13:04:24] <seanh> amercader: No, two of our apache config files seem to be totally invalid now
[13:04:29] <seanh> nigelb: Looking for the guide..
[13:04:58] <seanh> I don't know what that guy on github who says he got it working with one simple change is talking about, that does not work at all
[13:05:29] <nigelb> seanh: https://httpd.apache.org/docs/2.4/upgrading.html
[13:05:58] <seanh> Cheers
[13:10:09] <seanh> What time did we move the dev meeting to?
[13:18:52] <wardi> seanh: 16:00 UTC https://pad.okfn.org/p/ckan-meeting
[13:19:30] <amln> i think there's a ticket about password expiration, but it may not be.
[13:19:41] <amln> (was in the Glasgow pentest report)
[13:35:14] <seanh> Huh, why doesn't forwarding port 80->80 work in vagrant, but 80->8080 does?
[13:37:27] <wardi> is the 8080 on the host side? (if yes, you might need to be root)
[13:38:17] <seanh> If I forward to 8080 on the host side it works
[13:38:29] <seanh> But forwarding to 80 on the host doesn't
[13:41:51] <wardi> running as root?
[13:44:15] <seanh> Nothing's running as root, no
[14:02:19] <wardi> then you won't be able to listen on a low port number
[14:02:52] <Zharktas^> in linuxes you need to run as root to bind to ports less than 1024
[14:22:28] <seanh> Hm, I didn't know that
[14:22:35] <seanh> I thought apache run as www_data though?
[14:23:31] <seanh> I'm having a right hassle with httpretty. Some tests fail on Ubuntu 14.04 because of an httpretty bug
[14:24:09] <seanh> So upgrade the version of httpretty, now they pass on 14.04 but some other tests fail on Ubuntu 12.04 with Python 2.6 (apparently because of another httpretty bug)
[14:24:25] <seanh> So I installed it to a version half-way between the two, but another two tests fail!
[14:25:48] <wardi> seanh: apache and other services start as root to bind the ports they need then drop to another less privileged user
[14:27:42] <seanh> This is good to know
[14:50:15] <rossjones> that's a lot of httpretty bugs. maybe there's a better alternative?
[15:22:14] <seanh> Cool pypip.in readme badges: https://github.com/ckan/losser
[15:26:07] <amercader> 224 downloads per month and you uploaded it 8 days ago? :)
[15:28:49] <seanh> Not sure what's up with that, it is metadata from pypi apparently
[15:31:00] <seanh> I think it may be correct. Turns out pushing your stuff to pypi pays? ckanapi-exporter has over 200 as well
[15:33:00] <seanh> deadoralive has over 2000, but wardi's urwid has almost 20,000 in the last month
[15:34:07] <amercader> urwid looks really cool!
[15:35:23] <seanh> It is awesome, I wrote an app in it
[15:35:48] <seanh> What language do people prefer for the readmes - markdown or rst? Markdown is nicer, but rst is consistent with sphinx/rtd
[15:35:50] <wardi> amercader: ckanext-dcan storing lists as json strings is perfect
[15:35:57] <wardi> *dcat
[15:36:32] <wardi> amercader: thanks
[15:37:18] <wardi> ckanext-repeating is going to store lists of strings that way, and present/accept them as json lists at the api level
[15:37:33] <amercader> wardi: seemed like the most obvious choice given what our extras support
[15:37:51] <amercader> wardi: ok, so the value will be an actual list on the API?
[15:37:57] <wardi> yes
[15:38:31] <amercader> I wonder how this affects clients
[15:38:33] <wardi> planning the same for a "select multiple" type of field, but the values will be string tokens
[15:38:53] <amercader> eg people expecting extra.value to be a string
[15:39:02] <wardi> amercader: they will suffer
[15:39:26] <wardi> but returning json-encoded strings in json is pretty terrible
[15:39:58] <wardi> and this is for custom schemas only (not free-form extras)
[15:40:12] <wardi> so you already need custom code to handle them
[15:40:35] <amercader> ok, in the ckanext-dcat this is a generic mapping, so it uses normal free-form extras
[15:40:48] <amercader> you can tweak it afterwards with a custom schema I guess
[15:41:22] <wardi> yeah, it means if someone switches from this to a custom schema using -repeating it will "just work"
[15:41:44] <amercader> btw what's ckanext-repeating about?
[15:42:13] <wardi> it's repeating fields. like -fluent is for language text fields
[15:43:12] <wardi> like what Renato is asking for on -dev, and what I regularly hear from clients
[15:44:03] <amercader> wardi: do you mean storing multiple values in a field?
[15:45:35] <wardi> yes, like when people want multiple author names or multiple reference numbers
[15:46:00] <wardi> or a group of checkboxes
[15:46:59] <wardi> or a light-weight version of tag vocabularies
[15:48:00] <seanh> Ok, deployment docs are working on 14.04 except that for some reason I need to reboot the VM once at the end to make it work (restarting apache and nginx does not work)
[15:48:06] <seanh> No idea why, but I think that's good enough
[15:48:42] <wardi> seanh: tried stop/start instead of 'restart'.. some of those scripts have issues
[15:50:26] <seanh> Unfortunately to try that I would need to step through the instructions again :(
[16:01:33] <amercader> wardi, seanh, joet, rossjones : new time!
[16:01:44] <amercader> https://plus.google.com/hangouts/_/event/cb1vmkss426lkqicj94a3amvd1c?authuser=1&hl=en-GB
[16:01:53] <rossjones> Sorry, not for me right now. deploying supply chain stuffs.

2014-10-29
[10:11:46] <seanh> Morning all
[10:12:23] <seanh> I'm collecting issues related to CKAN 2.3 on Ubuntu 14.04 here: https://github.com/ckan/ckan/labels/14.04
[10:12:44] <seanh> The plan is to support 14.04 (source install and package install)
[10:30:46] <amln> seanh: is it worth looking at 15.04 too (release: April 2015)
[10:31:03] <amln> ?
[10:31:22] <amln> (can't see if that's an LTS or not)
[10:31:26] <amln> (quickly)
[10:34:14] <seanh> The next LTS should be 16.04
[12:24:31] <wardi> drat. today's meeting conflicts with a lunch date I've already rescheduled 3 times. I'll have to skip this one
[12:26:18] <wardi> wait, I'm really confused.. meeting is tomorrow..
[12:27:12] * wardi stops typing and goes to gt more coffee
[12:35:29] <rossjones> might need more than coffee.
[12:37:25] <wardi> more sleep?
[13:01:52] <wardi> coasterz: just talked to Wil (sylus on github) he's one of the main drupal guys that's been working on our open data portal. he suggestted opening an issue on https://github.com/wet-boew/wet-boew-drupal if you want to discuss the integration
[14:23:52] <seanh> My test for building the sphinx docs is failing
[14:24:01] <seanh> It only fails on Ubuntu 14.04, apparently
[14:24:14] <seanh> And only when running the tests, just buildind the docs on the command line works fine
[14:24:36] <seanh> Also if you run just that one test, it passes. Only fails when you run all the tests together
[14:25:00] <seanh> subprocess exit status 9 is the only info I have, there's no other output or message in the traceback
[14:28:14] <seanh> Hmm, could be a VM thing...
[14:30:51] <rossjones> Did you know environment.update_config is called twice? Is this JUST a paster thing or does it happen w/apache too?
[14:33:53] <rossjones> I'm a bit worried because it does rather a lot, sets up jinja, db connection, checks solr schema.
[14:34:54] <rossjones> if i put in a guard to make sure it's only loaded once, everything is fine (and startup is marginally faster)
[14:36:10] <seanh> Yeah, it seems to pass after increasing the VMs memory. Funny, I've never had this before, running CKAN on VMs with 512mb mem
[14:37:23] <seanh> rossjones: Sounds like it should be fixed, in any case
[14:38:36] <rossjones> Yes, I'll do that now.
[14:41:50] <rossjones> Sigh. Looks like it is "by design" to handle changes when plugins load (they can change the config settings).
[14:55:31] <travis-ci> ckan/ckan master dc164f2 http://travis-ci.org/ckan/ckan/builds/39384519 Ross Jones: The build was broken.
[14:57:38] <rossjones> that stupid datastore_active key error again.
[15:09:43] <wardi> oh, didn't that fix get merged?
[15:10:44] <rossjones> there was a fix?
[15:26:12] <seanh> Datastore and resource_proxy tests are failing on 14.04 with IncompleteRead from httplib, anyone seen this before?
[15:27:31] <seanh> Hm, could be solr
[15:29:27] <travis-ci> wardi/ckan 2003-package-patch-simple-version 5b007b6 http://travis-ci.org/wardi/ckan/builds/39389216 Ian Ward: The build was broken.
[15:35:37] <seanh> Yeah this seems to be a solr issue
[15:36:04] <seanh> Solr on my 14.04 vm is failing with NolassDefFoundError for a tomcat class
[15:36:30] <seanh> Why is it looking for tomcat? I installed solr-jetty
[15:38:11] <seanh> It sounds like solr-jetty is (still) broken in Ubuntu 14.04
[16:18:17] <rossjones> seanh has anyone ever discussed BDD tests for CKAN?
[16:26:44] <seanh> Not that I know of
[16:30:19] <rossjones> Might be more pleasant than replacing all the functional tests with more code.
[21:27:39] <rossjones> wardi if you had any thoughts on https://github.com/ckan/ideas-and-roadmap/issues/38 it'd be cool if we can iron out any issues ...

2014-10-28
[20:37:24] <gnat_x> wardi: thanks, that helped.

[10:02:37] <rossjones> one of my PRs failed on travis with pg 8.4 - ERROR: ckanext.datastore.tests.test_create.TestDatastoreCreate.test_create_basic
[10:02:37] <rossjones> - this looks to be a problem because datastore isn't enabled for 8.4.  It's not anything I've ever touched.  Is it known to be failing?
[10:02:52] <rossjones> https://travis-ci.org/ckan/ckan/jobs/39177131
[10:12:19] <wardi> i think i'm seeing the same on one of mine
[10:15:46] <rossjones> phew
[10:19:21] <rossjones> I'll take a look after travis has finished.
[10:36:29] <seanh> trickvi: amercader The thing about testing extensions on CKAN's Travis, one problem with it is if each extension has to go through the whole CKAN install
[10:36:33] <seanh> That will takes ages
[10:36:39] <seanh> We need to cache it somehow
[10:36:44] <rossjones> nosetests --ckan --reset-db --with-pylons=test-core.ini  ckanext.multilingual - ran 0 tests - sigh
[10:37:45] <seanh> rossjones: Does that dot notation work with nosetests?
[10:37:57] <trickvi> seanh: you mean have something like a dedicated ckan install to test the extensions against instead of installing everything from scratch?
[10:40:51] <rossjones> seanh sure, the only sane way to test you've fixed a fail rather than waiting 10 mins for all the tests to run :)
[10:42:38] <amercader> rossjones: --with-id + --failed are your friends
[10:42:42] <amercader> http://stackoverflow.com/questions/16202384/how-can-i-have-nose-re-run-only-tests-that-failed
[10:43:44] <rossjones> ooh good spot.
[10:44:09] <rossjones> my thing only works if the module is loadable, and appears to be a missing __init__ for multilingual tests.  I can't run them manually right now, and I don't know why.
[10:44:18] <rossjones> Maybe master is passing because it isn't running that test?
[10:45:45] <trickvi> stupid question but, is there a configuration which marks datasets as private when created (not automatically public)?
[10:46:52] <amercader> rossjones: it looks like tests are passing on travis on your branches?
[10:47:06] <rossjones> except, randomly, that one.
[10:47:37] <amercader> trickvi: I don't think so
[10:49:33] <rossjones> amercader I'm an idiot.
[10:49:55] <rossjones> I confused the deprecation warning in the travis log (which is multilingual) with the actual fail, which was in datastore.
[10:49:56] <rossjones> sigh.
[10:50:20] <rossjones> have renamed the ticket
[10:56:59] <seanh> rossjones: That never works for me, I have to use slashes not dots
[10:57:36] * rossjones shrugs
[10:57:38] <rossjones> wfm
[10:58:01] <rossjones> I wonder if nose loads them differently depending on how you specify the module.
[10:58:08] <rossjones> not enough to actually check
[10:58:12] <seanh> trickvi: Somehow we need to get Travis to only install CKAN once per commit, yes. Not once per commit per extension
[10:58:41] <amercader> seanh: I don't understand, wouldn't you pull ckan once and then all the extensions?
[10:59:41] <seanh> Well the idea was to run each extension as a separate "job" within Travis, so I don't know whether further jobs can use files installed by the first job. I haven't looked into how to do it tbh
[11:02:18] * wardi will be a couple minutes late
[11:02:34] <rossjones> wardi we're not on summer time any more.
[11:02:40] <rossjones> it\s only 11am atm
[11:05:18] <nigelb> wardi: It's that one glorious month of awesomeness :D
[11:05:25] <nigelb> that time of the year again ;)
[11:06:11] <rossjones> Any particular reason we don't just have the meetings at 4pm gmt instead?
[11:06:37] <wardi> rossjones: oh. thanks
[11:07:20] <nigelb> rossjones: you mean UTC?
[11:07:37] <nigelb> Most people are attending from UK. That's pretty much it, I guess.
[11:09:05] <rossjones> will add it to the agenda for the 12 o'clock meeting :)
[11:09:32] <wardi> 4pm is a little late for nigelb
[11:09:43] <nigelb> nah
[11:09:50] <wardi> no?
[11:10:07] <nigelb> wait, let me calculate
[11:10:29] <nigelb> oh yeah.
[11:10:31] <nigelb> 9:30 pm.
[11:10:32] <nigelb> late.
[11:10:43] <nigelb> I don't join very often these days though, so that's a data point.
[11:10:58] <nigelb> (I originally thought 4 pm my time)
[11:11:05] <rossjones> nigelb doesn't sleep anyway
[11:11:39] <nigelb> It's a clever rouse.
[11:17:34] <rgrp_> hey folks - also one idea - designating one of the tech team meetings a month as more significant and one that other folks could come to who are not doing day to day ...
[11:17:43] <rgrp_> i have had several requests for this sort of thing ...
[11:18:13] <rgrp_> the other question is whether we have a decision on moving one of the calls a week a to a later time e.g. 4pm :-) (is that what you are discussing now0
[11:18:40] <rossjones> rgrp_ yes.
[11:19:24] <nigelb> how would this other folk contribute at the meeting.
[11:19:31] <nigelb> Or rather, what would be the purpose of this?
[11:19:50] <amln> or would this other call be more of a community hangout?
[11:20:17] <amln> or is the plan to encourage others to pick up more of the "Good for Contribution" tickets?
[11:24:13] <nigelb> We usually spare one meeting for topics that need a bit of time to dicuss.
[11:25:09] <wardi> i'd be happy to designate on meeting a month for new contributors
[11:29:23] <rossjones> I know resources/time/energy probably don't exist, but I reckon remote pairing with people wanting to get started would be a huge benefit.  Would the one meeting a month be like a clinic?
[11:42:07] <wardi> rgrp_: is that what the requests you got are looking for?
[11:42:45] <wardi> we never really plan which meetings are more significant
[12:00:59] <wardi> https://plus.google.com/hangouts/_/event/cb1vmkss426lkqicj94a3amvd1c?authuser=0&hl=en-GB
[12:02:26] <amercader> seanh, joet ^
[12:03:11] <rgrp_> rossjones: i'd say the once a month was more about tech roadmap and esp for folks to join who can't come regularly and can get a sense of where things are going, where are priorities, how they can get involved ...
[12:03:38] <amercader> rossjones: ^
[12:03:43] <amercader> (meeting)
[12:03:46] <rgrp_> e.g. imagine your tech lead of a gov data portal project - you aren't going to come 2x a week to dsicuss pull requests but you may come once a month to hear what's up - and that can inform what you do and how you contribute
[12:04:19] <rgrp_> btw - what's the pad location again?
[12:04:30] <wardi> https://pad.okfn.org/p/ckan-meeting
[12:05:06] <rossjones> the call is very quiet
[12:07:57] <wardi> sounds good here
[12:29:15] <travis-ci> ckan/ckan master e909360 http://travis-ci.org/ckan/ckan/builds/39255813 amercader: The build was broken.
[13:38:57] <nigelb> amercader: can I remove the 2.3 tag from the SSL documentation bug?
[13:39:12] <nigelb> I think I'll aim to get it into the wiki this week and bring it up for discussion on thursday.
[13:40:38] <nigelb> It's a little tricky since I can't cover all use-cases. And I'm not sure it's production ready yet.
[14:57:22] <seanh> Another reason to get those extensions tests running on Travis: https://github.com/ckan/ckan/issues/1997
[14:57:36] <seanh> We can move all the example extensions into their own repos
[14:58:16] <seanh> This will improve things as for example the locations of example extension files will be the same as if you were really writing them as external extensions
[14:58:40] <seanh> Currently they are slightly different b/c they are actually core extensions, this is manually papered over in the docs
[14:59:08] <seanh> And also it should mean we can work around this problem of core example extensions overriding external ones with the same name
[14:59:30] <seanh> (The example extensions needn't be installed as part of a normal CKAN dev install)
[15:19:28] <coasterz> wardi: Would you happen to have a list of the remaining PR's from the open-data fork, I have my demo's running ckan/master but need to outline the remaining differences
[15:20:57] <rossjones> seanh do you have a feeling for how much work it is to move the example plugins to a new repo?  Worth a ticket?
[15:28:17] <wardi> coasterz: everything important is in master already. I'm planning to submit one more to allow sysadmins to set package ids, but that's just clean-up
[15:39:35] <coasterz> wardi: wonderful, thank you. Feeling like I only have a few items remain, Authentication, and deployment plan.
[15:47:27] <coasterz> Anyone have documented deployments using ckan/drupal they are especially proud of, eg. SolrCloud or nginx, any problems with scaling or fanning out services etc
[15:47:53] <coasterz> Just looking to see what some other deployments look like under the hood
[16:09:09] <wardi> coasterz: data.gc.ca is apache serving ckan under /data and the rest served by drupal. all our drupal stuff should be public too, I'll have to ask those guys when I'm in again tomorrow
[16:10:10] <wardi> this is part of it https://github.com/wet-boew/wet-boew-drupal
[16:26:01] <brook_> Anyone know what the 'ckan' cookie does?
[16:31:09] <wardi> seanh was fighting with the cookie code a few months back
[17:37:42] <gnat_x> hi folks, i'm working on a piece of javascript that is essentially a search box for a list of terms. the field is Term, but i can't figure out the right way to pass {"Term" : "value"} through the datastore api.
[17:38:34] <gnat_x> i've tried "Term = value" or just passing the "value" which works, but searches the full record instead of the term.
[17:40:32] <wardi> gnat_x: post your request as a json blob

2014-10-27
[20:32:55] <wardi> a normal, healthy gestation period
[20:33:14] <rossjones> whoever ends up reviewing is going to have fun :)

[11:29:48] <rossjones> seanh just checking deadoralive setup, looks good.
[11:29:54] <rossjones> where good == easy
[12:00:03] <seanh> rossjones: Great! I'm going to be looking into how to set it up with monitoring soon
[12:00:26] <seanh> As in you want the logs stored somewhere so you can see what it's been doing, but you also want an email if it crashes or fails to run
[12:00:51] <seanh> Unfortunately I think for most services getting a setup quite as simple as deadoralive won't be possible
[12:01:23] <seanh> It gets away with it because it doesn't support on-demand tasks, as soon as you add those you need a persistent database I think
[12:02:09] <wardi> or a long polling api call
[12:04:33] <seanh> How would a long polling api call work?
[12:12:09] <wardi> we have an api on the ckan side that just sits and doesn't respond until there is something new to check
[12:12:43] <wardi> deadoralive connects when it's ready for more work and waits on the other end
[12:13:13] <wardi> it the connection times out or gets dropped it just connects again
[12:13:50] <wardi> as long as at least one deadoralive process is running links would get checked immediately
[12:14:54] <wardi> one problem is that wsgi isn't very good at long polling (a thread or process gets tied up)
[12:31:34] <seanh> Interesting
[12:32:08] <seanh> Sounds like that would avoid the need for an actual web app on the deadoralive side that has an api and can receive requests not just make them
[12:32:22] <seanh> But I'm not sure it avoids the need for a db on the deadoralive side
[12:32:58] <seanh> The problem is we don't want it to check the same link too frequently, or check links for the same site too often, and we don't necessarily want to trust the client sites
[12:33:18] <seanh> So it sort of seems like it needs to keep a record of which URLs it has checked and when
[12:36:22] <wardi> wait, who don't we trust?
[12:36:43] <seanh> The CKAN sites
[12:37:01] <seanh> I do want it to be possible to run the service against untrusted client sites
[12:37:22] <wardi> why?
[12:37:58] <seanh> Because: Don't bother installing your own link checker, just subscribe to our service and let us run it for you
[12:38:39] <wardi> sounds like a hard problem
[12:40:14] <wardi> your deadoralive script is so easy to set up, why not encourage sites to run their own?
[14:53:54] <amln> https://github.com/mxabierto/ckanops looks (from the README) interesting.
[16:51:38] <rossjones> 2.3 tests failing for me, and also a really weird error 'Usage of the 'related attribute set' operation is not currently supported within the execution stage of the flush process'
[16:54:13] <rossjones> gah solr.
[17:00:27] <wardi> what's a related attribute set?
[17:01:50] * rossjones shrugs
[17:02:02] <rossjones> sqlalchemy warning
[17:02:08] <rossjones> on a clean install of ckan from master
[17:11:25] <wardi> sounds like we're sqlalchemying wrong
[17:13:15] <wardi> speaking of, what's up with that monster activity query on ckan-dev
[17:13:47] <wardi> and why do activities even have revisions
[17:35:45] <rossjones> is it missing some indices?
[17:36:02] <rossjones> Have just managed to mangle a tiny PR by rebasing. Starting over ;(
[17:39:47] <wardi> git reflog should have your old commits, no?
[17:44:37] <rossjones> wardi it should, but for 10 lines that probably needed tidying up anyway :)
[17:45:02] <rossjones> do we ever delete branches when they're merged?
[17:45:23] <wardi> never. we keep branches forever (it seems)
[17:45:33] <amln> and end up with lots of docs hits.
[17:45:36] <rossjones> :( Since bitbucket days I bet.
[17:45:49] <wardi> I don't think that's a policy though
[17:45:52] <rossjones> Does anyone have the courage to push :branch ?
[17:46:10] <wardi> amln: the docs hits are a rtd config problem aren't they?
[17:49:00] <rossjones> Just merged master into 1407 and only 3 conflicts. I am amaze.
[17:49:22] <amln> wardi: in part rtd, because, IIRC, it looks at the repo.
[17:49:54] <amln> the URIs it pulls in/creates docs for correllate to branches
[17:50:53] <wardi> amln: only for the ones we tell it to, there's an admin screen with a bunch of checkboxes for the versions to build on my rtd projects
[17:51:24] <amln> wardi: ah, i may be mistaken then.
[17:51:41] <amln> on cause.
[17:56:42] <wardi> rossjones: google leads me to lots of sketchy shell scripts that clean up github branches
[17:57:02] <wardi> guess we could try it on a fork first
[18:28:59] <rossjones> wardi I guess so.  I assume that doing that doesn't really have any downsides, if we delete PRs after they're merged (and released).
[18:41:41] <wardi> the prs would be the only record of what branches work was done on, wouldn't want to delete those
[18:51:22] <rossjones> my branch to remove resource_groups is getting through 1600 tests now ... might even get close to done tonight. ...
[18:53:47] <rossjones> wardi the revision_id in activity isn't an actual revision. haven't checked with seanh but I am guessing it is the revision of the object it's referencing.
[18:58:49] <wardi> rossjones: ok, that makes more sense. :-)
[18:59:59] <rossjones> looking at that query at ckan-dev..... makes me want to go and hide in the corner.
[19:00:54] <wardi> I've been innoculated by spending a fair bit of time with slow ckan queries
[19:01:21] <rossjones> :D
[19:01:40] <rossjones> model/activity.py has a few funcs with unions in.
[19:02:19] <wardi> who are we to say which rows can be joined
[19:02:38] <rossjones> _activities_from_everything_followed_by_user_query triggers a union in _activites_from_users_followed_by_user_query followed by two more of its own :)
[19:04:02] <wardi> _activities_from_everything_everywhere_at_any_time_you_know_just_in_case_someone_needs_it
[19:04:08] <rossjones> :D
[19:08:50] <rossjones> wardi I would have thought an index on the timestamp might speed up the slow sort, do you reckon he'd give it a try?
[19:09:22] <rossjones> although more worrying is that it happens on every request for them.
[19:09:38] <wardi> yes. that
[19:10:25] <rossjones> if 1407 passes, I am going to find something else to delete.
[19:12:38] <wardi> can it be moderated edits?
[19:13:08] <rossjones> ooh. good call.
[19:13:18] <rossjones> Is there a ticket for that?
[19:14:54] <rossjones> https://github.com/ckan/ckan/issues/1414
[19:16:32] <wardi> yeah, that's the one
[19:19:11] <rossjones> I'm not clear whether dread wants to just remove current and use latest timestamp, or remove all those queries that search the revision table (like package_list) instead of just using the package model itself.
[19:19:35] <rossjones> presumably they're actually the same thing.  If you're not using current=True to query stuff, you may as well use the actual Package model.
[19:28:58] <wardi> yes, and the same for every other revisioned table
[19:29:42] <rossjones> one day. one day we won't have to use solr to get acceptable performance on what should just be a table read with a couple of joins :)
[19:29:50] <rossjones> fsvo acceptable :)
[19:29:57] <wardi> just imagine
[19:30:21] <rossjones> travis showing errors on 1407 :(
[19:30:36] <rossjones> this makes me sad
[19:30:58] <rossjones> ahhh. does it test the datastore as well?
[19:31:16] <rossjones> knew I forgot something.
[19:36:56] <rossjones> one occurence. should be quick.
[20:30:03] <rossjones> 1407 passing all the tests!!
[20:30:14] <rossjones> only took me 9 months

2014-10-26

2014-10-25
[11:36:28] <rgrp> hey folks - doing more work on http://extensions.ckan.org/ ...
[13:57:54] <wardi> rgrp: what do you think about indexing the plugin names?
[14:21:17] <rgrp> wardi: not sure what you mean by that - but please open an issue ...
[14:21:46] <rgrp> #ann http://extensions.okfn.org/ is operational (beta i'd say) - 98 extensions, 17 featured and rudimentary search

2014-10-24
[09:40:56] <gr8_> what do I have to set in order to use wildcard-search? - when I try to search for the dataset "testdataset" with the quey-string "test" no search results are returned. How it is possible to fix that?
[09:42:43] <rossjones> You need to change your solrconfig.xml
[09:42:54] <rossjones> I mean schema.
[09:43:08] <rossjones> gr8_ here you go http://www.wunderkraut.com/blog/apache-solr-configuring-partial-word-search-functionality/2012-12-12
[09:43:55] <rossjones> Note the bit that says "Note the ten-fold increase in indexing time for the artist name, and a five-fold increase in disk space. Remember that this is just one field!"
[09:44:23] <gr8_> thank you very much!
[09:47:05] <rossjones> You're likely to get some very strange results though, would be interested to hear the end result ...
[12:45:49] <amercader> rossjones: did you meet boris? :) http://www.telegraph.co.uk/technology/internet/11182059/Boris-Johnson-launches-second-London-Datastore.html
[13:12:35] <rossjones> amercader unfortunately not :(
[13:13:16] <rossjones> Wish I had. Would like to meet him, just for entertainment value.
[13:25:42] <davidmiller> Can anyone point me at a good article that answers the question "Why does my data need a license" ?
[13:31:36] <rossjones> davidmiller you mean a licence?
[13:33:40] <davidmiller> rossjones: What do you think I mean instead ? :)
[13:34:18] * davidmiller "What license is this data released under"
[13:34:38] <davidmiller> Publisher: It doesn't matter. You have the data. What else do you want from me? Blood?
[13:35:03] * davidmiller You should read this document about licensing data _______________.
[13:35:53] <amercader> davidmiller: do you mean licence?
[13:36:40] <rossjones> amercader I think he does.
[13:36:45] <amercader> hah
[13:37:00] <amercader> davidmiller: sorry, 3rd item in here, and the linked blog post http://opendatacommons.org/faq/
[13:37:48] <amercader> 5th is probably more relevant
[13:40:02] <davidmiller> amercader: ta !
[13:45:24] * amln has met boris a few times
[21:03:51] <travis-ci> wardi/ckan 1995-rename-authz 4ea9b09 http://travis-ci.org/wardi/ckan/builds/38965176 Ian Ward: The build was broken.

2014-10-23
[19:08:17] <travis-ci> wardi/ckan 1795-scheming-support 5f8488e http://travis-ci.org/wardi/ckan/builds/38851408 Ian Ward: The build was broken.
[23:13:09] <travis-ci> joetsoi/ckan solrpy-is-dead-long-live-pysolr 90c4853 http://travis-ci.org/joetsoi/ckan/builds/38876472 joetsoi: The build has errored.

[08:38:50] <rossjones> Yay, one more CKAN in the world .... London's live.
[08:50:09] <amercader> rossjones: congrats, it looks great! http://data.london.gov.uk
[08:50:38] <rossjones> thx amercader. still a few bits to polish off.
[08:50:48] <rossjones> like my breakage of ckanext-spatial ;)
[08:51:31] <rossjones> we're indexing actual data files with it, but I need to move it over to a new solr core.
[08:51:47] <rossjones> and then see if I can persuade you to accept some PRs
[08:58:16] <seanh> Is there a good way to add a single license to CKAN, on top of the default set?
[08:58:40] <seanh> It looks like the code either reads all licenses from a licenses.json file, or it uses the default ones which are hardcoded in Python
[08:58:52] <seanh> No way to say "Use the default ones plus this"
[08:59:29] <seanh> The default license titles are internationalized as well, which you can't do with custom license titles in a JSON file
[09:00:14] <seanh> It looks like I have to copy all the default licenses into a lienses.json file (losing the i18n) and then add the one custom one that I want
[09:03:50] <amln> seanh: we see this every so often -- wondering if (in the absence of updating that json file at source) we write something that stores custom licenses and merges those with the json upstream on a semi-regular basis?
[09:04:03] <amln> so ultimately t here becomes a local license file.
[09:04:16] <amln> but say, people can add something via /ckan-admin.
[09:04:23] * amln over-engineers again.
[09:04:56] <rossjones> amln there's a ticket to move the config to the DB.
[09:05:02] <rossjones> Just add it to that :)
[09:05:34] <seanh> Moving it to the db / admin interface sounds good
[09:05:46] <seanh> With an API for adding licenses etc as well
[09:06:03] <rossjones> Then you only need the postgres URL in env somewhere - or just use the default pg env vars.
[09:06:07] <seanh> rossjones: amln What I would also like to do is change the default list of licenses to be just one open license
[09:06:37] <seanh> It's not good open data practice to pick a different license out of a list of 12 every time you create a new dataset
[09:06:47] <rossjones> PGHOST/PGPORT etc.
[09:07:20] <seanh> rossjones: Ah, licenses is not part of the Pylons config though
[09:07:29] <rossjones> No, but maybe it should be in the DB somewhere?
[09:07:33] <seanh> This is a separate issue from moving the config settings to the db
[09:07:38] <rossjones> So that it can be managed
[09:07:42] <seanh> Yes it should be
[09:07:46] <rossjones> through the same /config thing
[09:08:08] <rossjones> would be nice if CKAN rarely had to use the disk at all
[09:08:14] <rossjones> certainly not reading json files :)
[11:09:47] <wardi> rossjones: really nice
[11:13:29] <wardi> the london site I mean
[11:19:16] <wardi> seanh: we add translations to our licenses file
[11:20:07] <wardi> why not include the translations in the original file?
[11:25:47] <seanh> wardi: Does ckan/model/license.py support that?
[11:28:23] <rossjones> wardi ta, we do all of our theming via Wordpress rather than CKAN.  Tends to be a bit easier :)
[11:32:16] <amercader> wardi, rossjones, joet, seanh ,etc https://plus.google.com/hangouts/_/event/cb1vmkss426lkqicj94a3amvd1c?authuser=0&hl=en-GB
[11:45:19] <nigelb> rossjones: congrats :)
[12:10:05] <joet> http://www.codetriage.com/#python1308141717165161327
[12:17:58] <wardi> seanh: you can add anything you want to the json
[12:45:29] <seanh> wardi: amercader By the way does anyone know about this tags question? (Will tags that have only been used on showcase items show up on dataset pages and vice versa)
[12:48:42] <amercader> seanh: no, because you are filtering by dataset type (eg fq = ' +dataset_type:dataset') so the facets returned only apply to these results
[12:49:20] <seanh> Awesome, I wasn't sure if it was that smart or not
[12:50:03] <seanh> I guess they may show up as tag autocomplete suggestions though, but we can probably get round that by writing our own autocomplete suggestions source
[13:17:22] <harrywood> I'm going to be doing some work with CKAN for the future cities catapult
[13:17:30] <harrywood> not sure the details yet. Just investigating it a bit
[13:17:56] <harrywood> CKAN doesn't seem to be all that good a listing APIs
[13:18:56] <rossjones> harrywood have you seen http://docs.ckan.org/en/latest/api/index.html or do you mean there are no docs in the ckan install itself?
[13:19:26] <harrywood> sorry. what I mean is  if you want to add a "dataset" which is an API
[13:19:48] <harrywood> I can trick it into showing an API call with the preview feature, by isting a particular URL as a "resource" of JSON type
[13:19:57] <harrywood> but it feels like it's not quite designed for doing it that way
[13:20:10] <harrywood> Any good examples of people listing APIs anywhere?
[13:20:50] <rossjones> Ah I see. It used to have API as an option, but I think it was just the URL.
[13:21:39] <rossjones> datahub.io allows you to specify a link as being to an API, but I don't think it is treated differently.  It *could* be though.
[13:21:39] <harrywood> I see a few examples like this: http://data.gov.uk/dataset/directgov-syndication-api  where they're not giving a URL
[13:22:16] <rossjones> It sounds more like you might need the new Showcase stuff (in dev).
[13:22:58] <harrywood> ooh
[13:25:02] <harrywood> here's an example where it actually works with the preview: http://datahub.io/dataset/finnish-parliament-votings-api
[13:25:54] <rossjones> that's just treating it as a url to load into the view.  if you choose link it'll probably do the same.
[13:34:30] <harrywood> ah.. was just about to report that :-) https://github.com/okfn/ckanext-datahub/issues/53
[13:35:01] <rossjones> harrywood yeah some idiot updated it badly.
[13:50:53] <rossjones> should point out, that was me.
[13:58:56] <wardi> harrywood: I think the api type in the dropdown was removed because it was being treated the same as a link. this seems like it's caused some confusion though, should we just put it back?
[13:59:46] <harrywood> I'd be interested in seeing it
[13:59:56] <harrywood> Maybe I can enable it on my own deployment somehow
[14:03:26] <rossjones> harrywood how would you have it behave differently than a plain link?
[14:03:39] <rossjones> perhaps it's better to point people at the API docs instead?
[14:04:31] <harrywood> Well yeah a clear way of pointing people at the API docs is one simple solution
[14:04:53] <harrywood> but this approach seems close to what I'm after: http://datahub.io/dataset/finnish-parliament-votings-api
[14:05:07] <harrywood> It's just  a bit weird
[14:05:44] <harrywood> I guess other nice to have features, would be a special separate field for linking documentation
[14:06:06] <harrywood> and the ability to templatize the URL somehow, so that you can play around with different input params in the preview
[14:06:27] <harrywood> of course it's debatable whether any of that belongs in CKAN
[14:07:06] <harrywood> gotta go. But that's the kind of thing I'm pondering
[14:11:55] <wardi> harrywood: that's all customizable with plugins and templates
[14:12:35] <harrywood> oh right. Going to have to do some reading on that

2014-10-22
[09:21:50] <rossjones> nigelb do you do server monitoring?
[09:25:04] <nigelb> rossjones: yep
[09:25:15] <rossjones> could you add datahub.io?
[09:25:21] <nigelb> datahub.io just had a blip, if that's what you're going to ask me about :)
[09:25:30] <nigelb> we already monitor it.
[09:25:37] <rossjones> As long as someone else is monitoring, that's great.
[09:25:43] <nigelb> do you want to be notified though?
[09:26:29] <rossjones> no, it's alright, pingdom already tells me
[09:26:42] <nigelb> cheers :)
[16:05:02] <coasterz> Hi all, I am working on setting up a quick pilot of ckan, I have been asked to look into the open-data/ckan fork. Does a doc exist that outlines the changes/differences between this and the upstream ?
[16:18:23] <wardi> coasterz: Hi, are you working on the alberta site?
[16:19:39] <wardi> if so I was writing you an email to answer your questions but my windows box decided it was time to update software.
[16:20:23] <wardi> the main differences are trivial at this point, everthing important has been merged into ckan master or 2.2
[16:39:25] <coasterz> wardi: yes I am, Just getting started really
[16:43:51] <wardi> coasterz: I replied to David and Chad on that email, looks like I forgot to cc you and mark
[16:44:58] <wardi> coasterz: how many people are working on the pilot?
[16:45:16] <coasterz> wardi: Thank you, they will pass the info to me shortly im sure.
[16:46:50] <coasterz> A few of us are, I am not yet sure on who has what role. I am handling deployment and and analyzing for integration needs.
[16:48:47] <coasterz> tbh, I just got pulled in to work on this, so I am really just getting up to speed atm.
[16:52:02] <wardi> great. well, I'm happy to help in any way I can. We're building our newest sites off ckan master with a couple of the pending prs merged and plan to move the existing site over to the latest code in a few months time
[17:03:05] <coasterz> wardi: Thank you, that is great news. I will review your email and get back with any further questions I have.
[17:05:01] <coasterz> I did an install last night using the canada-2.1 branch, I will update that tonight.
[17:06:19] <wardi> coasterz: yeah, just use master or the latest 2.2 release if that's what you will be deploying
[17:06:53] <wardi> (master is better because you can help us more that way :-)
[17:08:17] <coasterz> Done deal ;)
[17:08:53] <coasterz> oh, and mysql from what I have read is not in the forecast ?
[17:10:04] <wardi> no
[20:12:03] <seanh> CKAN API exporter: https://github.com/ckan/ckanapi-exporter
[20:12:36] <seanh> Needs writing up, but this will let you export all the dataset metadata from any CKAN site to CSV very easily, either on the command-line or in Python
[20:13:30] <seanh> And you can filter and transform the data, including things like recursing into sub-dicts and sub-lists like resources and extras, matching regex patterns against dictionary keys to find things
[20:14:58] <seanh> Not sure how useful it'll really turn out to be. How many people want to export their datasets to CSV, but only want these fields and not these ones, want this field renamed, want the values for this fields aribtrarily transformed somehow, and columns pulled out of resources and extras even when extras have been named inconsistently?

2014-10-21
[22:53:50] <mchelen> ?
[23:49:39] <wardi> seanh: must..maintain..composure
[23:52:39] <mchelen> oh they think ckan somehow contains all data
[23:53:44] <wardi> or it's an api for all the data
[23:53:55] <wardi> that *would* be cool, but we're not there yet

[08:55:18] <amercader> Looks like we have a new CKAN on the block: https://github.com/KSP-CKAN/CKAN
[09:01:27] <seanh> Wow, https://github.com/haya14busa/incsearch.vim
[09:12:18] <rossjones> amln *another* one?
[09:12:40] <rossjones> amln sorry, meant amercader, tab-complete fail.
[09:13:43] <amercader> rossjones: that one sounds more fun tbh
[09:13:52] <rossjones> :D
[09:18:44] <rossjones> More screenshots on the list.  FFS.
[09:33:04] <amln> grumpy_rossjones: are you doing today's dev meeting?
[09:33:18] <amln> i'm thinking stripping out multipart mails.
[09:33:34] <amln> the welcome message / listinfo says copy/paste terminal output.
[09:33:44] <amln> i want to float the idea / get consensus.
[09:35:33] <joet> you should try ksp if you have some time rossjones, has a demo, works on linux etc, (stopping before i go offtopic :p)
[09:37:43] <nigelb> I like how they have a spec and everything
[09:38:18] <nigelb> which sounds EXACTLY like us :P
[09:39:21] <grumpy_rossjones> :D
[09:39:43] <grumpy_rossjones> amln doubt I'll make the call, am still procaffeinating before getting stuck into go-live (thursday).
[09:40:38] <grumpy_rossjones> Anyone going to add a ticket to https://github.com/KSP-CKAN/CKAN/issues about the name?
[09:41:17] <amln> grumpy_rossjones: is that london?
[09:41:35] <grumpy_rossjones> No it's a game thing, for the Kerbal Space Program
[09:45:34] <seanh> grumpy_rossjones: (Add a ticket about the name) - You mean to warn them? That it's such a terrible name and they will end up stuck with it? :)
[09:46:44] <nigelb> It'd be nice to add, "If you're looking for the Metadata Catalog software, that's not this"
[09:47:07] <nigelb> seanh: I've sent a pull req your way to update documenation :)
[09:49:08] <grumpy_rossjones> seanh exactly :)
[09:51:31] <grumpy_rossjones> seanh I think I prefer datahub as a name, but I guess we're stuck with CKAN. Am sure there'll be lots of non-technical reasons it can't be changed from the SG.
[09:51:37] * grumpy_rossjones rollseyes
[09:52:10] <amercader> khan is a cooler name
[09:52:27] <blissmen> Good day guys I have an issue yet again I did a fresh install of my UbUNTU12.04 and Downloaded the source of ckan. Upon folloing the steps presented to me the folder src does not get created when I run python ckan/setup.py install I need help please
[10:12:26] <joet> blissmen, use pip install -e 'git+https://github.com/ckan/ckan.git@ckan-2.2.1#egg=ckan'
[10:12:58] <joet> follow the steps in the install docs exactly and that pip install will download the source code and run setup.py for you.
[10:13:26] <joet> http://docs.ckan.org/en/latest/maintaining/installing/install-from-source.html
[10:42:27] * wardi will join meeting at 12:30
[10:44:34] <amln> is kick-off today at 12 or 12:30?
[10:44:52] <amln> assign all the PRs to wardi in absentia :)
[11:06:44] <wardi> 12:00 is normal for tuesdays. i'm just going to be late today
[11:08:22] <amercader> ups
[11:08:26] <amercader> joining now
[11:08:48] <amercader> joet, seanh: https://plus.google.com/hangouts/_/event/cb1vmkss426lkqicj94a3amvd1c?authuser=0&hl=en-GB
[11:24:09] <amln> i think https://github.com/FuhuXia/ckan/commit/45b495785109c8c65e7586c519928fc8b826a897 checks for VALID end-of-uri-junk, not invalid.
[11:24:22] <amln> on a quick skim.
[11:24:32] * amln invokes zewinski, though.
[13:41:47] <seanh> db clean is hanging for me again, on master and on 2.2
[13:41:55] <seanh> Which is weird, it used to work on 2.2
[13:51:56] <seanh> Hmm, weird, it was solr, froze and caused everything ckan did to freeze, had to force restart the vm with solr on it
[14:40:33] <sharp> hi. has anybody here familiar with the ckanext-dgu extension?
[14:40:47] <sharp> *is anyone
[14:52:01] <grumpy_rossjones> sharp a little.
[15:10:49] <sharp> grumpy_rossjones: we really like the published/unpublished feature of dgu, but we're finding installing only that feature from the dgu code to be difficult
[15:11:54] <grumpy_rossjones> it's just an extra on the package ;)
[15:12:03] <grumpy_rossjones> and then adding it as a facet.
[15:12:06] <grumpy_rossjones> sharp
[15:13:06] <sharp> what do you mean by adding as a facet?
[15:13:28] <grumpy_rossjones> In the config file, you can add the newly added extra to the list of facets so that it shows up as a filter on /dataset
[15:14:37] <grumpy_rossjones> If you're not worried about filtering by published/unpublished, you just need to add some stuff to your templates to mimic the functionality
[15:15:42] <sharp> i think the two things we wanted were to filter by published/unpublished, and have it so folks can add comments about why it would be a good idea to publish a dataset
[15:16:29] <sharp> is adding an extra the same thing as adding a tag vocabulary?
[15:19:16] <grumpy_rossjones> Ah okay, there's a bit more involved there.
[15:19:29] <grumpy_rossjones> The commenting for example has the whole moderation queue behind it.
[15:20:15] <grumpy_rossjones> It's part of the NII (National Information Infrastructure) work.
[15:22:18] <grumpy_rossjones> sharp adding an extra is more like adding another key-value pair to the package metadata.
[15:24:32] <sharp> grumpy_rossjones: so where is that found, in setup.py?
[15:26:59] <sharp> grumpy_rossjones: do you think this would be simpler to build out as my own plugin, based off of example_idatasetform, since there is so much in ckanext-dgu?
[15:27:55] <grumpy_rossjones> Yes, if that's the only feature you want.  Using ckanext-dgu currently requires you to use their CKAN as well.  You'd be much better to do it based on mainline CKAN (2.2.x right now).
[15:29:33] <sharp> ok. makes sense. i think i'll hack away at getting my own plug in up and running, then
[15:30:02] <sharp> grumpy_rossjones: thanks for your help! much appriciated!
[15:30:39] <sharp> i'm still figuring out how CKAN works, obviously
[15:31:25] <grumpy_rossjones> It'll be fine, it's not that hard :) well. not really.
[15:32:18] <amercader> [d__d]: help
[15:32:18] <[d__d]> Available plugins: logger, ping, last_seen, help, bangmotivate (https://botbot.me/freenode/ckan/help/)
[15:32:36] <amercader> !m grumpy_rossjones
[15:32:36] <[d__d]> You're doing good work, grumpy_rossjones!
[15:32:51] <grumpy_rossjones> hahaha
[15:32:59] <grumpy_rossjones> I'm still grumpy though.
[15:33:03] <grumpy_rossjones> And getting grumpier.
[15:33:12] <amercader> it's been a while since we had funny bots on the channel
[15:33:20] <amercader> the old ones used to dance!
[15:34:09] <grumpy_rossjones> amercader can't we get it back?
[15:34:27] <amercader> I don't remember how they were even called!
[15:34:31] <amercader> okfnbot?
[15:36:13] <grumpy_rossjones> amercader something like that :(
[17:08:33] <wardi> amercader is on a rampage
[17:09:40] <amercader> wardi: I've done about a third of them, will carry on tomorrow otherwise I might bulk close the whole lot :)
[17:10:47] <amercader> hopefully we will end up with a few 2.3, some 2.4 and some Good for Contribution
[18:48:43] <mchelen> just found the ckan docker images, very nice!
[21:52:14] <seanh> https://github.com/ckan/ckan/issues/1986#issuecomment-59986113

2014-10-20

[08:55:52] <amln> coasterz: we've not any need to do RH packaging for a while.
[09:16:13] <rgrp> amln: but where are the existing RPM packages that were done (and/or packaging work) - could you add links to that issue ...
[09:16:59] <rgrp> #ann extension registry (very first pass) up and running http://extensions.ckan.org/
[09:17:37] <rgrp> code here https://github.com/ckan/extensions.ckan.org
[09:17:49] <rgrp> overview issue here https://github.com/ckan/extensions.ckan.org/issues/4
[09:23:17] <amln> rgrp: i think they're so old, it's not worth mentioning them.
[09:35:09] <nigelb> I had done some work on RH packagaing.
[09:35:15] <nigelb> Let me see if it still exists.
[09:36:01] <nigelb> rgrp: https://github.com/ckan/ckan-packaging/tree/rpm-packaging
[09:36:09] <nigelb> I did this last year I think, so it could use an update
[09:36:17] <nigelb> back then it worked (I think)
[09:36:48] <nigelb> it uses fpm that we already use for deb packaging, gets the right deps and paths for the config file and changes the script to run the right commands.
[09:40:50] <amercader> rgrp: data.gov is deployed via rpm as well https://github.com/GSA/ckanext-geodatagov/tree/master/deployment
[09:46:36] <leomark> In creating datasets I want the title should be required. It must show an error "missing value".
[14:22:40] <seanh> Anyone know if there's a reason why CKAN's package extras are lists of dicts?
[14:22:51] <seanh> You can't have two extras with the same key
[14:23:04] <seanh> some_package["extras"] should be a dict, not a list of dicts
[14:23:39] <seanh> as in {"key_1": "value_1", "key_2": "value_2"}
[14:35:42] <wardi> seanh: you also shouldn't have extras with the same names as fields in the packages, so they actually should just be additional keys at the package level, no
[14:35:45] <wardi> ?
[14:36:43] <seanh> Well, yeah, but you *can* have extras with the same names as top-level fields though
[14:37:12] <seanh> I'm trying to write a thing for exporting datasets from CKAN (e.g. to JSON, CSV)
[14:37:32] <wardi> seanh: not on master IIUC
[14:37:48] <seanh> Where you can say things like "get these fields, but not these ones", "get this field, but instead of the field name use 'Foo'"
[14:38:03] <seanh> get this field but apply this transform to the value (e.g. limit to 255 chars)
[14:38:20] <seanh> Or get a list of all extras whose name matches ^update.*
[14:38:37] <seanh> Or get the one field or extra whose name matches that, crash if there are more
[14:38:39] <seanh> etc etc
[14:38:43] <wardi> but to your original question I agree, it's silly that extras have ids and revision is being leaked out of package_show
[14:38:56] <seanh> Taking the list of dicts from package_search as a starting point
[14:39:26] <seanh> So we have scalar fields, fields that are lists of dicts (resources, groups) and fields that are dicts (tracking_summary, what extras should be)
[14:40:21] <wardi> seanh: there is a general principle that you shouldn't store values as keys in JSON, and free-form keys really are values
[14:41:26] <seanh> right
[14:41:36] <wardi> if you don't already know what keys to expect, you're probably better storing a list of dicts with keys and values as values
[14:41:55] <wardi> but it's silly that our extras come with ids and dates and revisions
[14:42:08] <seanh> It's just that if extras are done the way they are, I don' think there's any generic way to handle that (you have to have CKAN-specific knowledge that this is how extras work)
[14:42:54] <wardi> seanh: and resource extras don't behave this way, they're just keys that appear next to the official ones
[14:42:56] <seanh> So I have to say "search for '^update.*' in extras, and it has to know that it should loop over the extras and match that pattern against each key, and if it matches return the value
[14:43:42] <seanh> Exactly. For the normal scalar package fields, resources, and e.g. tracking_summary, you can do it with just knowledge of basic Python types
[14:44:03] <seanh> Treat a scalar with function X, a sub-dict with function Y, and a sub-list-of-dicts with function Z
[14:44:08] <seanh> But then you hit extras
[14:44:26] <wardi> seanh: oh, by the way.. with my fluent extension values will now sometimes be {lang:text} dicts
[14:44:48] <wardi> and I'm planning a repeating extension that will make values lists
[14:45:29] <seanh> I was trying to come up with some way of letting the user specify a pattern like for example: ["^resources$", "^format$"]
[14:45:57] <seanh> So that would find the "resources" key in the dataset, then the "format" key in each resource, and return a list of formats (optionally deduplicated)
[14:46:59] <seanh> Or say a pattern like ["^extras$", "^update.*"] with a case_sensitive: false option, that would find extras named "update", "Update", "Upddate Frequency" etc
[14:48:08] <seanh> The problem (aside from extras needing special treatment) is the first pattern in the pattern list: If you want to support the truly general case, it may match more than of the package's top-level fields
[14:48:26] <seanh> That's fine you just collect each of the matching field values and return a list
[14:48:33] <seanh> If the matching values are all scalars
[14:48:47] <seanh> But if you get a matching scalar and a matching list of dicts field
[14:48:48] <seanh> blah
[14:50:40] <seanh> You could say that it's an error if any pattern in the pattern list except for the last pattern has more than one match, I guess
[14:57:12] <seanh> Yeah I think it can work if you only allow the final pattern in the list to have multiple matches, and (one CKAN-specific thing) if you turn the extras list into a dict before processing
[14:57:55] <seanh> It can handle keys whose values are a scalar, a dict or a list of dicts (no other possibilities in CKAN afaik), and just do it recursively
[15:01:51] <wardi> seanh: how about a dict of lists?
[15:02:41] <seanh> I suppose it could recurse
[15:03:01] <seanh> The problem is the result it's gonna end up returning is gonna end up being nested
[15:03:12] <wardi> if the repeating and fluent validators are combined you could have {"en": ["red", "umber"], "fr": ["rouge"]}
[15:04:06] <seanh> Well, I can make it error on these cases for now and they can be added later
[15:04:14] <seanh> The ultimate aim of this is to export to CSV
[15:04:38] <seanh> So if you find the "title" field, or a single extra field or something, you just put the scalar value in to the CSV
[15:05:13] <seanh> If you find the formats of all the resources (handling a list of dicts)  then you put them into a comma-separated string within the CSV column (quoted)
[15:05:41] <seanh> If you end up finding nested stuff I'd need to figure out how to handle and export that, too
[15:06:03] <wardi> seanh: I've started working on a general solution to the json<->csv problem, but it still might be nice to have some ckan-specific intelligence: https://github.com/wardi/jsonsquared
[15:07:50] <seanh> Cool, I'll take a look at this
[15:07:59] <wardi> the intelligence I was thinking was more along the lines of "throw out all the fields ckan generates and doesn't let you update" before exporting
[15:08:43] <seanh> Hmm, no, mine is not for editing, it's just for exporting, clients are probably going to ask for those fields in the export
[15:09:39] <seanh> Does jsonsquared also do JSON->CSV though?
[15:09:50] <seanh> Ah yes
[15:10:52] <wardi> well, it doesn't do anything because there's no code yet :-)
[15:11:44] <wardi> so far it has just been a puzzle for me to handle all the edge cases as nicely as I can
[15:35:35] <seanh> If we had a generic "JSON filter and transform" library (export JSON to JSON, CSV, etc) then we could probably wrap that in a CKAN API client that does the CKAN-specific stuff
[15:35:59] <seanh> e.g. fetching the JSON from CKAN's API in the first place, and transforming CKAN's extras into a dict for easier processing
[15:36:52] <seanh> I think in my case I'm quite happy with a lossy export (I don't need to support edit and re-import), so for results like nested lists I can just flatten and optionally deduplicate them
[15:39:49] <wardi> sure, that sounds simple and useful
[15:40:18] <wardi> someone is going to ask how to re-import that data though :-)
[15:42:25] <seanh> But they also ask for things like "just the first 255 characters" and for "format" to be a simple top-level column/field (no keeping track of which format came from which resource), so...
[15:43:11] <wardi> then they'll say "just detect if what has changed" :-)
[15:53:38] <ScraperDragon> seanh: Not sure it's a solution to your problem, but are you aware of jq?
[15:54:32] <seanh> Yeah, jq is not quite what I'm looking for, from what I can tell
[15:57:24] <ScraperDragon> I also wrote a really dumb "take JSON list, render x["cat"][3]["dog"] as a column called cat_3_dog" parser, but that probably doesn't help either.
[16:01:27] <seanh> That's probably not much dumber than what I'm going to write
[16:02:09] <seanh> This is the first time I've written anything recursive for a while
[16:05:57] <ScraperDragon> https://github.com/scraperdragon/json2csv if you care (or should that be dare - bear in mind I haven't looked at it in two years)

2014-10-19


2014-10-18
[16:33:33] <coasterz> is anyone aware of an attempt to package ckan for redhat and derivitives ?
[16:41:22] <rgrp> coasterz: not sure there is a redhat package active - see https://github.com/ckan/ideas-and-roadmap/issues/12 (and leave a comment on what you find)
[16:41:58] <rgrp> coasterz: i do know that there have been several significant deployments on RHEL which included producing RPMs ...
[17:01:03] <coasterz> rgrp: excellent, I will certainly share what I come up with. I am just doing some quick investigation as I may be doing a quick deploy this week.
[17:02:02] <coasterz> I see openshift is in the cards as well, that could be a future path I will certainly be mentioning to this group.

2014-10-17
[08:39:54] <reederz> Hi. How can you get your CKAN site listed here ckan.org/instances/ ?
[08:40:38] <reederz> We've released one in August http://datahub.virk.dk/data/search
[08:46:15] <brook> Good stuff! Here's a link to the CKAN census form: http://ckan.org/census/. There's an option there for inclusion on the instances page.
[08:48:12] <reederz> brook: thanks!
[09:06:06] <amln> or you can make an issue + PR against https://github.com/ckan/ckan-instances/issues.
[09:06:46] <amln> but the census is really useful to fill out, too
[11:34:06] <rgrp> hey folks is there a dedicated issue for the v2.3 release somewhere that people will be able to track (or is is a milestone?)
[11:34:24] <rgrp> aha - my bad just found it https://github.com/ckan/ckan/milestones/CKAN%202.3
[14:02:14] <amln> do others find it annoying that people attach images, not copy/pastes of terminal/xterm stuff on ckan-dev? (i realize hardly representative of all (441) ckan-dev members)
[14:02:22] <amln> or images in .sig files?

2014-10-16
[12:52:30] <amln> seanh: you have a login on ckan.org ;)
[12:56:59] <davidmiller> If I had a login, the first thing I would do would be to fix the typo of "ausers can search on all dataset" s/ausers/users/ ...
[13:06:23] <amln> davidmiller: which page?
[13:10:34] <amln> http://ckan.org/features-1/search-and-discovery/ -- fixed.
[13:58:15] <davidmiller> amln:
[13:58:24] <davidmiller> amln: Awesomes :)
[13:58:45] <davidmiller> BTW - it's also on /features/
[14:28:15] <amln> davidmiller: not any more
[14:33:06] <davidmiller> amln: If you're sure !
[14:33:19] <davidmiller> Meanwhile - http://ckan.org/features-1/community/ talks about the "To do extension"
[14:33:32] <davidmiller> I'm failing to google for it  :(
[14:33:55] <amln> if only there were one place (not sixteen) for extensions to be listed.
[14:37:28] <davidmiller> amln: Shure. This one's not listed on the wiki or the spreadsheet, and I had previously been told that no such thing existed though :)
[14:37:33] <davidmiller> Which is why I was interested !

[04:17:01] <leomark> Hi guys, just a quick question.. in ckan production deployment what is the default directory or themeplate it use?
[05:27:53] <leomark> hi can anyone help me with this?. I want to change the design in my production template the same as the design of my development template localhost:5000
[08:12:34] <blissmen> Good Day guys I downloaded The Zip file of the Ckan Source how do I use proceed from there given That I dont wannt redownload upon Installation ?
[08:14:15] <davidmiller> blissmen: Have you tried the instructions on this page: http://docs.ckan.org/en/latest/maintaining/installing/index.html ?
[08:14:37] <davidmiller> Maybe you want the source-specific instructions? http://docs.ckan.org/en/latest/maintaining/installing/install-from-source.html
[08:17:38] <blissmen> my problem is my Connection is too slow such that each time I execute this Instruction <<pip install -e 'git+https://github.com/ckan/ckan.git@ckan-2.2.1#egg=ckan'>> it Breaks along the line. So is there a way to go around it like downloading the Zip with IDM andd proceeding?
[08:21:17] <davidmiller> blissmen: That problem will return further down those instructions :(
[08:21:49] <davidmiller> Do you understand what the command you're executing is doing ?
[08:22:31] <blissmen> yes I fink it instyalls the ckan into your virtual env
[08:22:44] <blissmen> directly from Github
[08:24:34] <davidmiller> sure - so if you manage to download the repo as a zip file, you can also install CKAN into your virtualenv
[08:24:50] <davidmiller> python ckan/setup.py install might be a start.
[08:26:54] <blissmen> well I tried that but It gave me alot of syntax errors
[08:39:53] <davidmiller> blissmen: You might like to put the errors in a pastebin and share the link...
[08:40:20] <davidmiller> Installing to a box with a decent internet connection might be a better shout though ;)
[10:26:45] <blissmen> I get this error when I try to install ckan http://stackoverflow.com/questions/26401864/ckan-offline-install-from-zip-file-using-python-ckan-setup-py-install
[10:28:43] <Zharktas> wrong python version ?
[10:30:22] <rossjones> Also windows.
[10:30:55] <Zharktas> yeah that too
[10:36:20] <blissmen> hmmm when you say windows you mean I cannot use cykan on windows 8 or what? as for the python versiion which is recommneded cuz mine is 3.x
[10:38:03] <davidmiller> Honestly, the docs page could be more explicit.
[10:38:09] <davidmiller> blissmen: 2.7.
[10:38:24] <davidmiller> blissmen: I would strongly advise you to not install on windows.
[10:39:20] <seanh> If wanting to install CKAN on Windows, use an Ubuntu virtual machine
[10:39:47] <davidmiller> https://github.com/ckan/ckan/wiki/How-to-Install-CKAN-1.8-on-Windows
[10:40:12] <nigelb> ckan still doesn't work on windows, I believe.
[10:40:28] <nigelb> there's a fanstatic bug we never got around to fixing
[10:40:43] <davidmiller> nigelb: Where can I upvote it?
[10:40:53] <blissmen> well i used a back track virtual machine only for it to give me a "module not found hybridmethod not defined" kind of error
[10:41:01] <nigelb> davidmiller: It's not about upvoting, it's about doing work.
[10:41:16] <nigelb> None of us actually use windows, I think.
[10:41:28] <davidmiller> nigelb: Shure. Was not srs.
[10:42:39] <nigelb> davidmiller: If you can spend a bit of time tweaking it, we'd happily accept your pull request :)
[10:44:19] <davidmiller> nigelb: What if my pull request changes the docs to say "CKAN does not run on windows, do not attempt this, do not pass go, do not collect 2,000" ?
[10:44:48] <blissmen> ahhahahah #David miller
[10:48:06] <nigelb> davidmiller: I'm conflicted on whether to punch you or give you a hug :P
[10:49:06] <davidmiller> nigelb: I get that a lot. You're welcome.
[10:50:11] <nigelb> davidmiller: You get the punches or the hugs? Or both?
[10:52:14] <amln> i still don't know why people use cygwin etc. it's way quicker to download/install virtualbox and debian base.
[10:52:30] <amln> and provides a real env, not some god-awful emulation.
[10:53:02] <amln> davidmiller: it needs to have a nice box around it ;)
[10:53:11] <amln> (your proposed PR)
[10:56:17] <blissmen> So I take it that v2.2 does not work on windows?
[11:12:01] <blissmen> nobody seems to wanna put a cap on my question
[11:12:15] <nigelb> blissmen: No, it does not.
[11:13:03] <blissmen> Okay imma download v1.8 could you give me a link to it?
[11:14:19] <rossjones> blissmen would advise against it. you won't get *any* support for 1.8
[11:14:54] <rossjones> blissmen is there a reason what linux isn't a good solution for you?
[11:15:49] <blissmen> okay so what do I do cuz my  ununtu 10.04 gives me an error link libssl.so1.0.0.0 not found when i issue ckan db init and my backtrack tells me about hybridmethod not found
[11:19:41] <rossjones> 12.04 might be better but ...
[11:19:42] <rossjones> sudo apt-get install python-dev postgresql libpq-dev python-pip python-virtualenv git-core solr-jetty openjdk-6-jdk
[11:19:46] <rossjones> from - http://docs.ckan.org/en/latest/maintaining/installing/install-from-source.html
[11:21:07] <blissmen> well I did hat already and for v 12.04 aint got the distro and my connection is pretty poor using 2G
[11:22:42] <seanh> blissmen, You need to get Ubuntu 12.04, I don't think you will be able to get CKAN working otherwise
[11:23:52] <blissmen> wow well so I guess more work need to be done huh
[11:31:00] <wardi> https://plus.google.com/hangouts/_/event/cb1vmkss426lkqicj94a3amvd1c?authuser=0&hl=en-GB
[11:31:16] <amln> blissmen: i think i saw that it was suggested to maybe use a more connected machine; tools like mosh make it trivial to keep connexions open.
[11:32:51] <amercader> seanh, joet, anyone : dev meeting
[11:33:00] <joet> \o/
[11:38:09] <davidmiller> Is http://ckan.org/features/ in github anywhere?
[11:41:40] <noirbizarre> Hi
[11:44:56] <seanh> davidmiller, Don't think so, it's WordPress unfortunately
[11:46:43] <rossjones> apparently it is going to stay wordpress as well as the SG are not comfortable with jekyll
[11:51:46] <seanh> Yep
[11:52:00] <seanh> So pages like /features will never get updated
[11:53:19] <seanh> General problems with the site (navigation, duplication, CSS bug..) also
[11:53:44] <seanh> Who's ever going to go in and fix the WordPress theme? (Who even knows where it is / has access?) Anyway, blah
[12:04:12] * amln has requested access to see what's going on / who has logins.
[12:20:16] <rgrp> hey folks - can i suggest we boot github.com/ckan/ckan.org for tracking issues with the website ...
[12:28:47] <amln> rgrp: we have https://github.com/orgs/ckan/teams/ckan-website/repositories
[12:34:38] <nigelb> seanh: if you need to have a login, you need only ask. If you want to push a theme upgrade, that's a bit more complicated, but doable.

2014-10-15

[01:02:18] <gjlawran> Does anyone have any interesting examples of use of the API from a  DataStore deployment that they can share?
[01:03:07] <gjlawran> I am hoping to see if some of our agencies will use it to power some of their own dashboards.
[04:15:09] <leomark> I edit and convert ckan bootstrap to foundation zurb in development 127.0.0.0:5000 but when I try to deploy it in production it uses it's default design. Where can I find the templates directory that production is using?
[09:56:54] <rgrp> gjlawran: I have some nice API examples for DataStore. There's also this DataStore Explorer app http://dev.rufuspollock.org/ckan-explorer/?resource=f95dcf96-eb04-4aa0-ae4b-a45f71a9e52f
[10:13:11] <hetrz> Hello
[10:14:14] <hetrz> Good Day I am a developer and I am having problems installing ckan, i posted on the mailing list and its been a week now with no response. I need help please
[10:18:15] <hetrz> upon setting up solr with a jetty container. i get errors when i try to acces http://localhost:8983/solr/ the error is posted on http://stackoverflow.com/questions/26379858/ckan-solr-jetty
[10:18:39] <travis-ci> ckan/ckan release-v2.0.5 b5c9335 http://travis-ci.org/ckan/ckan/builds/38027593 amercader: The build was broken.
[10:29:05] <amercader> hetrz: I added an answer to your SO question in case it helps
[10:32:57] <hetrz> Thanks for the sugestion amercader I just tried that but it gives thesame error. as for my system its Ubuntu 10.04
[11:14:30] <foo_2134sfd> How potential security issues should be reported?
[11:15:39] <amercader> foo_2134sfd: security@ckan.org
[11:15:51] <foo_2134sfd> Thanks.
[12:12:09] <amercader> hi everybody, patch releases for CKAN 2.0.x, 2.1.x and 2.2.x are now available. You should update to get the latest fixes, and please let us know if you find any issue
[12:12:16] <amercader> more info here: https://lists.okfn.org/pipermail/ckan-announce/2014-October/000010.html
[12:12:55] <rgrp> amercader: would you be able to drop that into a blog post on ckan.org? that would be awesome
[12:13:52] <amercader> rgrp: sure, I need to leave now, will do it in a couple of hours
[12:46:42] <hertz> Please having this error when I issue "sudo ckan db init" on my UBUNTU10.04 distro  "/usr/lib/ckan/default/bin/python: error while loading shared libraries: libssl.so.1.0.0: cannot open shared object file: No such file or directory"
[13:11:54] <blissnme> Help with this error "/usr/lib/ckan/default/bin/python: error while loading shared libraries: libssl.so.1.0.0: cannot open shared object file: No such file or directory" after issuing "ckan db init" on UBUNTU 10.04 after a package install
[13:17:09] <morty> blissnme: I don't think the package works with any distro except Ubuntu 12.04 64-bit
[13:17:26] <morty> blissnme: http://docs.ckan.org/en/latest/maintaining/installing/install-from-package.html
[13:20:45] <blissnme> what makes the distro 12.04 unique
[13:29:27] <morty> blissnme: that it's the one they have packaged for. Packaging takes effort and doing it for every distro would take resource away from other things.
[14:38:14] <gnat_x> wardi: you were correct yesterday. the datapusher wasn't configured correctly.
[14:45:15] <wardi> gnat_x: working ok now?
[14:47:30] <gnat_x> wardi: yup.
[14:48:15] <wardi> great :-)
[15:41:46] <amln> win 21
[15:41:55] <amln> pesky slashes ;)

2014-10-14
[09:10:39] <brook> Anyone have an idea how to get the template name used to render a page when using webtest?
[09:11:57] <seanh> brook, I don't think you can
[09:12:21] <seanh> If you run it manually in paster serve you can turn on the debug footer and see the template names
[09:13:33] <brook> Bummer. I tried to turn on debugging for the test, but can't get hold of the CKAN_DEBUG_INFO, which is what the debug footer uses.
[09:17:34] <seanh> Why do you need to get access to the templates in a test?
[09:18:23] <seanh> What is CKAN_DEBUG_INFO, an HTTP header?
[09:18:26] <joet> brook are you running your tests in an ext? At a complete guess you need to make sure that legacy templatse are turned off
[09:28:17] <brook> I wanted to test that the template I think is rendering is the one (or one of the ones) being used.
[09:28:41] <brook> joet - yes, it's in an extension.
[09:30:23] <brook> seanh - CKAN_DEBUG_INFO is on the request.environ object that's passed in the context of templates when debug=true (I believe)
[09:30:39] <brook> Accessed in the debug template like this: request.environ['CKAN_DEBUG_INFO']
[09:30:47] <seanh> You could look for a string from the template in the response, but I think joe is right if you turn legacy templates off you may be able to get that debug info
[09:31:04] <brook> How do I turn those off?
[09:31:11] <seanh> Hmm, not sure if requeasts.environ stuff is gonna be available via webtest though
[09:31:45] <seanh> Here's an example: https://github.com/ckan/ckanext-datapackager/blob/master/ckanext/datapackager/tests/helpers.py#L17
[09:32:07] <brook> Cool - thanks
[09:32:39] <joet> in your test.ini you can also try setting "ckan.legacy_tempaltes = no"
[09:33:46] <brook> really 'no' (not false)?
[09:33:51] <joet> yeah
[09:33:52] <joet> i know
[09:34:18] <joet> could probably do false as well
[09:34:23] <amercader> I think you can put false as well, we use an asbool thing
[09:34:33] <amercader> you can try NEIN
[09:34:40] <brook> :)
[09:35:01] <seanh> no thanks
[09:35:37] <amercader> I'd rather not
[10:01:34] <amercader> joet, seanh, wardi: can any of you have a quick look to review this tiny PR? https://github.com/ckan/ckan/pull/1978
[10:01:36] <amercader> thanks
[10:59:00] * wardi will be a couple minutes late
[11:04:25] <amercader> joet, seanh , rossjones, others: https://plus.google.com/hangouts/_/event/cb1vmkss426lkqicj94a3amvd1c?authuser=0&hl=en-GB
[12:20:16] <seanh> brook, We really need to figure out what we're going to call individual "showcase items", we don't have a good name for them
[12:20:46] <brook> I've been calling them 'showings' in code. Not great.
[12:23:04] <brook> Or individually, each item is a Show & Tell item, with the Showcase being a curated collection of such items; either site-wide or with a dataset.
[12:24:45] <seanh> How about "Show Offs" :)
[12:27:24] <seanh> brook, Do you have access to this google doc? It's private with no edits and no comments, let's make it public and editable
[12:27:46] <brook> Ah - sorry - I'll open it up
[12:27:51] <seanh> cheers
[12:28:42] <brook> https://docs.google.com/document/d/19M9LUvEIRbsoxNH0fodolbzQy_7rSUkGUh2S63zbT5M/edit?usp=sharing
[12:37:32] <amln> "wonderment"
[12:47:20] <seanh> brook, What are you thinking about the categories (app, article, etc)? I think maybe more free-form tags might be better
[12:47:47] <seanh> Not really sure though
[12:48:55] <brook> Agreed - I was thinking tags are better. Perhaps with a predefined list of suggested tags, while still allowing freeform. Not sure if there's a widget for that?
[12:49:15] <seanh> We have a tag autocomplete widget yeah
[12:49:18] <seanh> select2.js
[12:50:24] <seanh> The problem with tags is then you end up with tags that are not just types of data re-use, e.g. you get "climate", "traffic", etc.  Maybe that's okay though
[12:51:17] <seanh> There's also the problem of user-created tags getting messy. But maybe on the page where we show a list of tags to filter by, we only show the featured (by a sysadmin) tags and the ones that have more than N datasets, should hide mosf of the mess
[12:51:29] <seanh> (But show all of an item's tags on the item's own page)
[13:18:07] <wardi> maybe call each item a "case", "use case" or "use"
[20:45:25] <gnat_x> hi folks. so i'm experimenting with a new install of ckan, and trying to use the datastore API.
[20:45:36] <gnat_x> i'm having issues.
[20:48:29] <gnat_x> https://paste.debian.net/126246/
[20:49:42] <gnat_x> the basic issue, as illustrated by that paste above, is that i can get a result for a resource using resource_show, but nothing from datastore_search.
[20:49:56] <gnat_x> datastore is telling me the id doesn't exist.
[20:52:38] <gnat_x> i keep going in loops looking for documentation. the closest thing i found was an unaswered mailing list post.
[20:52:57] <gnat_x> so any pointers at what to look at are greatly appreciated.
[21:06:54] <wardi> gnat_x: did you call datastore_create for the resource?
[21:15:14] <wardi> gnat_x: or maybe you want to enable the datapusher to do that for you?
[21:16:37] <gnat_x> wardi: yes, probably the second one.
[21:21:48] <gnat_x> i'll have to read more about that tomorrow.
[21:22:07] <gnat_x> my brain is fried on this, and it is quitting time.
[21:22:33] <gnat_x> thanks for the help! i'm really excited about digging in to ckan and helping out (once i get my own head around it first)

2014-10-13
[13:08:30] <seanh> brook_, Another thought: Maybe this is a good topic for the CKAN dev meeting tomorrow?
[13:08:36] <seanh> Get everyone's opinions
[13:09:03] <seanh> If you can share a short and simple spec of what you want from the feature, we can probably have quite a useful conversation with everyone about how best to implement it
[13:28:48] <seanh> What's the Right Way to fix this kind of error? I'm doing " ... ".format(...) and one of the variables I'm passing into the .format() is a unicode string with non-ascii characters in it
[13:29:39] <seanh> I don't want to try to encode the string at this point. For one thing i don't know what encoding to use. The string is gonna be passed to the logging module, or rendered by jinja, etc. It seems to me that those modules need to do the encoding
[13:30:00] <seanh> So the solution seems to be add a u:  u" ... ".format(...)
[13:30:23] <seanh> I've seen some people say you should put u in front of all literal strings in Python 2 code but I think that's horrible
[13:30:42] <seanh> Still, it seems really bad that missing a u on a string literal can make a unicode crash
[13:31:10] <seanh> It's a tiny mistake to make, unicode crashes are really bad (500 Server Error) and often not caught until you hit some unicode in production
[13:34:08] <rossjones> seanh just python2 showning it's age. not the same in py3.
[13:34:18] <rossjones> But yes, probably better to u'' *everything*
[13:35:45] <seanh> Yeah, Python 3 does seem to have it right here
[13:37:00] <rossjones> There's sys.setdefaultencoding but I expect that'll just break *everything*
[13:38:10] <rossjones> If you want to know how much pain you could try - export PYTHONIOENCODING=utf8
[13:43:48] <Ira_> Oh I totally still have the shevski alias
[13:53:05] <amln> good :)
[13:56:22] <Ira_> also, anyone here working on a ckans which has not yet been listed on ckan.org/instances? THEN add yourself to ckan.org/census!
[14:06:28] <seanh> This is weird, in a test if I make a dataset and pass some non-ascii characters for the maintainer field it's crashing with a unicode error in dictization
[14:06:49] <seanh> But testing manually, non-ascii chars in the maintainer seem to work fine in both the web ui and api
[14:08:15] <amercader> seanh: some magic in the controllers?
[14:08:45] <seanh> Ah
[14:08:47] <seanh> Oops
[14:09:03] <seanh> Missing u on the string in my tests that had the non-ascii chars in it!
[14:09:05] <seanh> Jesus
[14:10:19] <seanh> It might actually be useful to have a lint rule for "you are using a byte string" in Python 2
[14:20:09] <rossjones> seanh now you know why I keep raising Py3 ;)
[14:20:32] <rossjones> It's 2014, any language that doesn't default to utf-8 needs putting out of its misery
[14:23:47] <rossjones> Also >500 occurrences of str() in the code.  Mostly tests though
[14:46:15] <joet> argh
[15:05:23] <seanh> logging.info(" ... {} ... ".format(unicode_string)) crashes, but you can do logging.info(" ... {} ... ", unicode_string) and it works
[15:06:03] <seanh> What's confusing me though is that one script I have is doing "... {} ...".format(unicode_string) and it's *not* crashing when the string contains non-ascii chars
[15:06:16] <amercader> seanh: or  logging.info(" ... %s ... " % unicode_string)
[15:06:20] <amercader> :)
[16:05:47] <seanh> wardi, Do you think this is a bug in requests? https://github.com/ckan/ckanapi/issues/29
[16:18:54] <rossjones> seanh are you sure it isn't a  application/x-www-form-urlencoded - multipart/form-data problem
[16:19:27] <rossjones> that it works with no file suggests that www-form-urlencoded is fine but there's a problem with the mimeparts?
[16:20:05] <rossjones> you know the content-type is different for POST with/without a file?
[16:23:14] <seanh> The problem isn't exactly with/without a file
[16:23:37] <seanh> The combination of a file plus a unicode resource name with non-ascii chars crashes
[16:24:16] <seanh> This seems like a python thing (requests shouldn't be raising unicode errors), but i haven't had time to actually debug it down to the requests level yet
[16:25:03] <rossjones> does ckanapi do any encoding?
[16:27:45] <rossjones> http://stackoverflow.com/questions/20591599/why-arent-post-names-with-unicode-sent-correctly-when-using-multipart-form-data seems like it might be related?
[17:33:34] <leomark> I got this error in apache2 "client denied by server configuration: /etc/ckan/datapusher.wsgiclient denied by server configuration: /etc/ckan/datapusher.wsgi" anyone can help me with this?

2014-10-12

2014-10-11

2014-10-10
[11:16:04] <amln> am I reading http://docs.ckan.org/en/latest/extensions/adding-custom-fields.html correctly -- (1) if custom metadata is just added, it ends up in one `blob`, but separated; (2) if a custome extension is added, then these can be queried individaully (i.e, they become a separate field/record)
[11:24:18] <nigelb> amln: what do you mean by "ends up"
[11:24:23] <nigelb> do mean how it's stored in the db?
[11:24:42] <amln> nigelb: yeap.
[11:25:10] <nigelb> they're all separate rows in a key, value table.
[11:25:27] <nigelb> the difference is how it's shows in the API (and maybe indexed in solr)
[11:25:31] <amln> the more direct question is, if i want to discover metadata pairs of things that might be dates, is this easy? (as well as understanding more how this works)
[11:25:32] <nigelb> *shown
[11:26:22] <nigelb> You'd be queries all the items under a certain column in a table. Does that help?
[11:26:26] <nigelb> *querying
[11:26:29] <nigelb> Sigh. I need coffee.
[11:26:35] <amln> that does, yeap/
[11:26:46] <amln> relates to https://github.com/okfn/ckanext-barnet/issues/15 (which I'm trying to refine)
[11:27:24] <nigelb> Ew, yeah.
[11:27:28] <nigelb> that's going to be fun to solve.
[11:27:41] <amln> I think it will be easier, actually.
[11:27:54] <amln> but more on that later.
[14:11:53] <brook> If I make a group with a custom type attribute (not an 'organization'), should I expect that not to be in the returned list when calling the group_list action?
[15:00:44] <leomark> anyone can help me with this. everytime I try to execute this command "paster db init -c /etc/ckan/default/development.ini" it gives me an error "urllib2.HTTPError: HTTP Error 504: Gateway Time-out" my web server is using a proxy settings.
[15:02:48] <wardi> leomark: do you have the correct http_proxy environment variables set? (does wget work for downloading things?)
[15:03:19] <leomark> wardi: yah.. wget and pip works ok..
[15:04:43] <wardi> leomark: gist or paste the full traceback somewhere?
[17:22:48] <rgrp> #headsup I've added the technical team call details to http://ckan.org/about/technical-team/
[17:26:40] <wardi> rgrp: we've been doing the thursday calls at 12:30 for a few weeks at my request
[17:29:56] <rgrp> wardi: cool - though even later on one day would be nice for people not as early risers as you :-)
[17:47:36] <amln> can haz commit access on ckan/ckan-instances?
[17:49:48] <amln> "interestingly" GH is quite interesting in this regard. It knows I've forked a repo, but yet, GH pages still tries to update/create the CNAME from my repo.
[17:50:02] <wardi> yeah..
[17:50:24] <amln> y'd think it might be clever enough to work that out
[17:50:41] <amln> half tempted to file a report on gh-pages or where-ever.
[17:50:45] <wardi> what team should this belong to
[17:50:58] * amln doesn't knwo what teams we have for ckan/
[17:51:24] <wardi> ok, added ckan-website
[17:51:26] <amln> suggest a new team.
[17:51:58] <amln> i was going to separate instances from website, although it maybe the case that website DOES end up as a wordpress thing
[17:52:16] <wardi> amln: they're at least related
[18:02:14] <amln> wardi: cheers.

2014-10-09
[11:31:31] <wardi> https://plus.google.com/hangouts/_/event/cb1vmkss426lkqicj94a3amvd1c?authuser=0&hl=en-GB
[14:25:56] <wardi> anyone know how Member.capacity and .state are used?
[14:28:51] <wardi> looks like state is for logical deletion of membership
[14:29:11] <wardi> amercader ^?
[14:43:58] <joet> from what i remember capcity is whether they are an org admin/editor
[14:44:11] <joet> at least for users
[14:45:37] <wardi> joet: I'm thinking of (ab)using it for the showcase vs. show-and-tell property brook mentioned
[14:46:27] <wardi> might be tricky though. It's the dataset owner that gets to change the setting, but someone with permission to edit the group that gets to create/remove the membership

2014-10-08
[14:22:33] <brook> Cool if we talk about the Related Items (Showcases) extension during tomorrows dev call?
[14:29:29] <joet> add it to the pad!
[14:29:42] <brook> Will do!

2014-10-07
[04:04:21] <leomark> how can I delete css link in ckan fanstatic url?
[04:04:37] <leomark> anyone?. Im just new with this :(
[04:29:50] <Zharktas> leomark: you have to remove the resource, main.css can be remove by overriding block styles
[04:33:24] <leomark> @Zharktas thanks for the answer. Im just fixing this error and I don't know how. The css link I want to remove is "<link rel="stylesheet" type="text/css" href="/fanstatic/css/:version:2014-09-29T08:48:35.91/foundation.css" />".
[05:15:33] <Zharktas> leomark: you have to find where foundation.css is imported, something like {% resource "foundation.css" %}, it's not in default ckan
[05:21:19] <leomark> Zharktas: Thank you very much.. :)
[09:10:29] <joet> I keep on coming across useful vim plugins only to discover that I've got them installed and never used them.
[09:13:21] <rossjones> joet install https://github.com/spf13/spf13-vim and then you'll have ALL the plugins ;)
[09:14:50] <joet> excellent, now I can be sure to never use any of them!
[09:45:11] <shellac> trying to get plugin tests working. having abandoned sqlite I now get:
[09:45:12] <shellac> AttributeError: 'SessionMaker' object has no attribute '_object_cache'
[09:45:37] <shellac> does this look familiar?
[09:52:04] <shellac> doh -- ignore that. the failure message 99.9% noise
[10:28:13] <mishari> hi, I'm getting an SOLR returned an error running query: Error: \'Method Not Allowed\
[10:28:17] <mishari> error
[10:28:34] <mishari> does anyone know where the problem may lie?
[10:29:55] <rossjones> mishari solr ;) What's your solr_url?  Can you curl it?
[10:30:06] <rossjones> solr_url from your ckan ini file
[10:31:36] <mishari> yep I can curl it
[10:32:00] <mishari> oh wait
[10:32:27] <mishari> solr_url is pointing to http://127.0.0.1:12345/solrckan/schema
[10:32:40] <mishari> is this incorrect?
[10:37:40] <rossjones> doubt it.
[10:38:21] <rossjones> mishari normally on 8983, also path is normally /solr/core-name
[10:39:40] <rossjones> we automate our solr core creation so I have 'http://127.0.0.1:8983/solr/9230e08d-bc82-4277-8a23-c1b8c1e28aa0' but would need to check the docs to see what default ckan one is.
[10:40:32] <rossjones> ah http://docs.ckan.org/en/latest/maintaining/configuration.html?highlight=solr_url
[10:40:37] <rossjones> suggests should be /solr
[10:46:12] <mishari> changing it now, but where is the core defined?
[10:46:29] <rossjones> depends on your solr version and setup
[10:47:03] <rossjones> It's a while since I did a standard ckan-solr install, the docs have more though - http://docs.ckan.org/en/latest/maintaining/solr-multicore.html?highlight=solr_url
[10:47:42] <mishari> ok thanks
[10:50:40] <mishari> I'm using context fragments which apparently does the same thing :-| https://cwiki.apache.org/confluence/display/solr/Running+Solr+on+Tomcat
[10:51:04] <mishari> yes, sorry, I completely forgot that I'm using tomcat rather than jetty
[10:52:10] <mishari> oh and it works
[10:52:20] <mishari> thank you :D
[11:02:44] <wardi> https://plus.google.com/hangouts/_/event/cb1vmkss426lkqicj94a3amvd1c?authuser=0&hl=en-GB
[11:03:23] <rossjones> tuesday, already?
[11:04:13] <amercader> joet: ^
[11:04:30] <joet> sorry robs was grabbing me
[13:46:19] <wardi> didn't bring it up at the meeting, but for scheming and "select many"-type fields I've decided to not use tag vocabularies
[13:47:42] <wardi> I'm thinking of returning and accepting a list of tokens for the "selected" items and having the vocbulary only specified as part of the schema. there's already an api to dump the schemas used on a site
[13:48:09] <amercader> :w
[13:48:32] <amercader> sorry, that was meant to vim
[13:49:03] <wardi> "ckan log" E212: Can't open file for writing
[13:49:18] <amercader> wardi: so you will have a list of accepted values on your json field definition?
[13:49:51] <wardi> amercader: yes, a list of the values and the labels used when displaying those values (in one or more language)
[13:51:02] <amercader> wardi: that sounds good, I'm working on more complex cases where fields must belong to big vocabularies and labels can be multilingual, etc
[13:51:07] <wardi> and the values returned/accepted would be json lists of strings, so there are no issues with escaping special characters
[13:51:14] <amercader> I guess you can always use a custom validator to accommodate custom logic
[13:52:08] <wardi> amercader: you don't want to use tokens/unilingual values and look up the translations only on display?
[13:53:03] <amercader> yes, for validation is not that relevant, you can use helpers for displaying / indexing
[13:53:19] <wardi> amercader: right, this is syntactic sugar for "I want a bunch of checkboxes with these values stored as one field" more complicated things can alwasy be implemented as custom validators+form snippets
[13:53:30] <amercader> sure
[13:53:47] <amercader> sounds great, lots of sugar on cknaext-scheming
[13:55:05] <wardi> might be giving developers using our api a hard time. now our fields won't be just a bunch of strings, some will be dicts (fluent multilingual) and some lists (select-multiple)
[17:01:08] <travis-ci> [travis-ci] ckan/ckan master 40623db http://travis-ci.org/ckan/ckan/builds/37305708 joetsoi: The build was broken.

2014-10-06
[10:50:37] <brook> hi - am I right in thinking python code for ckan must be Python 2.6 compatible. ie, no python 2.7 constructs?
[10:51:02] <seanh> brook, yep
[10:52:03] <brook> thanks :(
[11:31:21] <wardi> brook: yeah, it can be a drag. not a huge problem though, which feature are you missing?
[11:32:32] <brook> Using assert_raises as in a with context, and using multiple with contexts. I'm setting myself up a 2.6 venv now.
[11:33:03] <brook> ls
[11:33:06] <brook> opps!
[11:44:08] <wardi> unittest2?
[11:44:38] <wardi> oh, i get it
[12:01:24] <seanh> brook, oh yeah that's a shame that you can't do the with assert raises thing
[12:01:37] <seanh> Just have to use plain old assert_raises() function
[12:02:26] <brook> yeah - no problem. Sorted it now. I wasn't actually using multiple with contexts in the end. That was for a test I didn't end up commiting.
[12:06:52] <seanh> I want to drop Python 2,6, personally
[12:12:34] <wardi> seanh: why's that?
[12:13:13] <joet> seanh, I'd be against it if it meant we didn't support installs onto ubuntu LTS or RHEL 5/6
[12:13:34] <joet> haven't checked what versions they support in a while
[12:15:05] <amercader> seanh: dev meeting item! It basically boiled down to support RHEL 6 which shipped with python 2.6 (same case for postgres 8.4). I think RHEL 7 comes with python 2.7 but I not very familiar with these distros
[12:15:25] <amln> joet: http://packages.ubuntu.com/search?keywords=python
[12:16:05] <joet> rhel is 2.6
[12:26:24] <wardi> seanh: I mean, has 2.6 caused you actual problems other than occasional travis failures?
[12:26:49] <joet> ok, I care less now that it's in rhel7
[12:27:02] <seanh> wardi, so we can use 2.7-only features, and because writing 2.7 & 3.4-compatible code is easier than 2.6, 2.7 & 3.4
[12:27:18] <seanh> I understand if lots of users are on some OS that ships with 2.6 though
[12:27:49] <joet> we've got the deployment census somewhere right?
[12:28:19] <joet> also if we can cut the 2.6/postgres8.4 tests out of travis, they'll be twice as quick! :p
[12:28:21] <seanh> But as soon as the latest Ubuntu LTS and RHEL have 2.7 we can drop 2.6, imo
[12:28:43] <wardi> source compatible 2.6, 2.7 and 3.4 is about the same as source compatible 2.7 and 3.4
[12:29:48] <seanh> There are a handful of neat new things in 2.7 though that we can't use currently
[12:30:17] <wardi> maybe I've just been maintaining old code for too long :-)
[12:31:55] <wardi> which features? dict comprehensions? ordereddict?
[12:32:21] <wardi> set literals?
[12:34:31] <joet> https://docs.python.org/2/library/unittest.html#assert-methods any of those I've wanted
[12:34:43] <brook> Multiple context managers in a single with :P
[12:34:57] <wardi> joet: import unittest2
[12:34:58] <joet> loads of useful asserts in 2.7
[12:40:00] <wardi> https://github.com/ckan/ckanapi/blob/master/ckanapi/tests/test_call.py#L2-L5
[12:43:15] <joet> oh cool, never knew about unittest2
[12:46:16] <wardi> for ckan we're using nose, so it doesn't really matter
[14:41:53] <joet> eugh, calling call_action('group_action') in the tests you end up using the default_group_schema instead of default_group_schema
[14:42:17] <joet> I mean default_update_group_schema or default_group_update_schema, or whatever
[14:42:26] <joet> schema_schema
[14:48:38] <wardi> is this one of the "some action before stuck a schema value in the context so we're going to use it for everythin" issues?
[14:51:16] <joet> it's the form_to_db_schema stuff
[14:52:01] <joet> if we have 'api' in the context, it'll check between updates and creates
[14:52:03] <joet> otherwise it won't
[14:52:16] <joet> https://github.com/ckan/ckan/blob/master/ckan/lib/plugins.py#L367-L373
[14:52:51] <wardi> ugh. that's nasty
[14:53:31] <joet> yeah i want to change it so it just checks for the update/create type, but i'm afraid of whatever side-effects
[14:54:06] <joet> but i'm thinking of just specifying the schema in my test for now.
[14:58:29] <wardi> https://github.com/ckan/ckan/blob/master/ckan/lib/plugins.py#L363-L365 really makes me uneasy though, esp. with context['schema'] = ... code scattered in our logic functions
[14:59:05] <wardi> if anyone forgets to throw away context between actions calls, bam, dead
[15:00:47] <joet> yeah, been bitten by that one before
[15:02:32] <amercader> wardi, joet : I guess IGroupForm needs to be updated to follow what IDatasetForm does
[15:03:15] <wardi> amercader: it does
[15:03:56] <wardi> I was planning to tackle that with the scheming-support branch, but I figured it was better to get datasets working first
[16:09:23] <brook> If I've installed from git master, do I have to install the datapusher separately? How do I get it started?
[16:20:21] <joet> http://docs.ckan.org/projects/datapusher/en/latest/
[16:20:40] <joet> datapusher is it's own flask app if i recall
[16:22:09] <brook> Ah okay - thanks

2014-10-05
[18:37:48] <travis-ci> [travis-ci] clementmouchet/ckan master 0050c08 http://travis-ci.org/clementmouchet/ckan/builds/37119725 Clement: The build was broken.
[18:48:18] <travis-ci> [travis-ci] clementmouchet/ckan master 943f16f http://travis-ci.org/clementmouchet/ckan/builds/37120482 Clement: The build was broken.

2014-10-04
[09:40:37] <pjf1> Oh my! This isn't the Comprehensive Kerbal Archive Network! :)
[09:40:50] <pjf1> Apologies all, wrong channel. :) Have a wonderful day! :)

2014-10-03
[09:47:22] <amercader> you guys have a weird fetish for 100% coverage
[09:48:19] <amercader> but maybe healthy competition among extensions is the way to get there :) I'll try an aim for that for the dcat rdf stuff I'm working on
[09:58:10] <seanh> 100% coverage? No en
[09:58:15] <seanh> Not enough
[09:58:24] <seanh> I want every possible param tested!
[10:09:48] <wardi> coverage doesn't do jinja templates, and doesn't tell you if all paths were taken
[10:10:36] <seanh> Exactly
[10:11:01] <seanh> There is a version of coverage with some template support, but iirc it was just for genshi
[10:13:33] <seanh> 100% coverage is "necessary but not sufficient", but it's handy because it can be measured. Not that I really think you should test *everything*, here's what the new-style coding standards for core said about it: http://docs.ckan.org/en/latest/contributing/testing.html#how-detailed-should-tests-be
[10:55:46] <seanh> amercader, what do you think about a standalone ckanext-eurovoc? Seems like it might be useful for other sites
[10:58:42] <amercader> seanh: I don't know, what features can you make generic?
[11:00:08] <seanh> Just an idatasetform that adds eurovoc category as a custom dataset field, plus the templates to go with it
[11:00:28] <seanh> Would not be compatible with other idatasetform plugins, I guess
[11:00:58] <seanh> It could provide a modify_schema(schema) function to call though, so other IDatasetForm plugins could call that to add the eurovoc field
[11:01:18] <seanh> And I guess the faceting as well
[11:02:19] <wardi> scheming+inheritance
[11:03:11] <wardi> i mean if scheming had schema inheritance
[11:04:48] * amln likes the idea of inheritance schemeing ;)
[11:05:09] <amercader> seanh: is it worth having a custom dataset schema field just for that? I guess it would be nice to make which field holds the eurovoc identifiers (like the extra "theme" from the harvester) and make the plugin work from there. If someone does not use a custom schema it seems overkill to make them implement one just for some facets
[11:05:29] <amercader> *to make configurable
[11:07:12] <seanh> Wait, we need datasets to have "eurovoc top-level category" as a field, don't we?
[11:07:59] <seanh> You're saying just use a "free extra" for it?
[11:08:43] <amercader> I'm saying both are options, free extras are automatically indexed as well
[11:09:25] <seanh> Aren't custom top-level fields (convert_to_extras) automatically indexed?
[11:10:05] <amercader> yes
[11:10:42] <amercader> both are, so I'm just saying that a top level field is not a requirement for having it indexed
[11:11:15] <seanh> Right
[11:12:00] <seanh> Why does the ckanext template in ckan contain a templated egg-info dir? Isn't egg-info generated by setup.py?
[11:12:39] <seanh> I see, it just has an empty
[11:12:42] <amercader> seanh: given the time you have I'd say do it in a separate module on the project extension for now and we can excise it when it's finished and we see how it turn out. Like blog and dcat
[11:12:44] <seanh> .gitignore file in it
[11:19:49] <amercader> wardi: can you merge https://github.com/ckan/ckan/pull/1682 when you have the chance, if busy I can do it (needed for 2.2.1
[11:36:38] <wardi> amercader: sure, i think i tried to yesterday
[11:37:03] <wardi> but got it confused with another pr
[11:44:15] <wardi> amercader: I'm going to push a small change to 1682
[11:46:41] <wardi> amercader: so now should someone else review it? :-)
[14:05:31] <travis-ci> [travis-ci] ckan/ckan release-v2.0.5 5da4518 http://travis-ci.org/ckan/ckan/builds/36969020 amercader: The build was broken.
[14:15:11] <travis-ci> [travis-ci] ckan/ckan release-v2.2.1 435c728 http://travis-ci.org/ckan/ckan/builds/36969054 Ian Ward: The build was broken.
[15:00:15] <amercader> tests fixed on all three release branches! (and master of course). Today was a long day...
[15:00:50] <amercader> poor Travis has worked hard
[15:16:39] <amln> amercader: i think you probably have too.
[16:59:59] <rgrp_> amercader: well done!
[17:33:39] <seanh__> https://github.com/ckan/ckan/pull/1956
[17:39:41] <wardi> seanh__: ooh
[17:46:11] <seanh__> This is gonna save a lot of time fiddling to get travis and coveralls working and writing readmes
[17:46:34] <seanh__> Also it gives us a place to iterate, when someone finds a better way to do something with extensions they can add it to the template
[17:46:35] <wardi> why put the egg directory there?
[17:46:46] <seanh__> paster crashes otherwise
[17:46:51] <wardi> wat
[17:46:54] <seanh__> there's nothing in it though
[17:47:02] <seanh__> Yeah paster create crashes, go figure
[17:59:39] <seanh__> Ok, weekend
[18:36:16] <amln> good idea, that.

2014-10-02
[18:18:21] <amln> does telnet connect?
[18:19:23] <seanh> no
[18:21:04] <amln> oh, solr's bound to loopback; do your vms have addresses?
[18:21:16] <amln> RFC 1918 ones.
[18:21:50] <amln> config solr to listen on the 'real' address, even with the port forwarding, isn't it?
[18:22:09] <amln> this is vagrant/virtualbox, right?
[18:22:39] <seanh> Yeah
[18:22:50] <seanh> The vm does not have its own ip address
[18:22:54] <seanh> I could set that up though
[18:23:14] <amln> iirc, even with port forwarding, lo is still lo;
[18:23:35] <seanh> Ah
[18:23:47] <seanh> It has to be 0.0.0.0 not 127.0.0.1
[18:23:52] <seanh> Gets me every time
[18:23:58] <amln> :)
[18:50:43] <seanh> Cool, CKAN running in a local venv with postgres and solr running in vagrant vms, this is how I'm gonna try doing development now, sick of sshing into a vm all the time
[18:51:31] <seanh> Having things like postgres and solr in VMs means you can have a VM of whatever version of Ubuntu you need to get the right version of postgres/solr, but use whatever os you want for your host os
[18:51:52] <seanh> Also no cluttering up the host os with every database and search service ever running all the time
[18:52:21] <seanh> Now I can run my editor locally on the host machine instead of sshing in and running vim in a terminal all the time
[18:54:09] <seanh> The only problem with this is if a Python project has a non-Python dependency that has to be apt-get installed or compiled from source and that isn't a service like postgres or solr that you can run inside a vm and expose. There's still potential for individual dev projects to break out from python venvs
[19:50:03] <amln> i was looking at https://github.com/Russell91/sshrc the other day
[19:50:59] <amln> i don't like the approach of tar()'ing, but I never really have (why bundle only to unbundle; just scp/rsync/nc)
[19:52:29] <wardi> amln: "tar | ssh tar" is faster than scp
[19:56:00] <wardi> .. unless they've fixed scp. I think it's because tar pipelines better
[20:50:42] <amln> wardi: i found scp to be faster last time i bothered checking.
[20:51:13] <amln> CBA'd these days
[20:51:31] <wardi> amln: I found scp really slow with lots of small files
[20:51:52] <amln> interesting.
[20:52:26] <wardi> like it was waiting for each one to finish separately
[20:53:28] <amln> sounds plausible. i'm rather tired to test out. time to go offline :)
[21:06:50] <wardi> seanh: I hear you like coverage https://coveralls.io/r/open-data/ckanext-scheming
[22:21:36] <seanh_> wardi, awesome. I may be using -scheming for a project soon, so I am very glad to see this!
[22:21:48] <seanh_> We should work on getting these running on CKAN's Travis

[08:47:08] <seanh> Anyone got any thoughts on this? I have a CKAN extension and a CKAN API client
[08:47:25] <seanh> They're two different components - different git repos, different pypi projects
[08:47:45] <seanh> Each has its own tests but I also have some integration tests that import and test both together
[08:48:41] <seanh> I guess the integration tests should be able to run fine if I just put them in say the extension's git repo, they can import the api client, I'll have to add the api client's pypi project to the extension's dev-requirements.txt
[08:50:40] <seanh> It's gonna get weird if you git clone and python setup.py develop both projects in the same venv though, and then when you pip install -r dev-requirements.txt it's gonna try and pip install something you already python setup.py develop'd (or vice-versa). Feels a bit clashy
[09:12:41] <amercader> joet: that diagram is on a random google doc, which is even worse :)
[09:13:08] <amercader> I guess the best home for hime would be somewher in the docs
[09:49:37] <amln> amercader: joet have both of you seen https://github.com/ckan/ideas-and-roadmap/issues/67 : was wondering if you had thoughts on that from Glasgow's pending states etc.
[09:53:34] <amercader> amln: is conceptually related, but on glasgow's case it wouldn't make much sense to create the datasets as pending, as in theory they could have been modified on the platform, so it made more sense to request the metadata again and create from scratch
[09:58:33] <amln> fair enough.
[09:59:01] <amln> i couldn't quite remember if we added a states 'table'.
[10:21:24] <amln> is there a plan to discuss https://github.com/ckan/ideas-and-roadmap/issues/86 today?
[10:22:14] * amln expands his window to see the bazillion characters long /topic
[10:42:02] <amercader> amln: it will probably come up, but feel free to add it to the agenda
[10:42:13] * amln has another call :(
[10:54:43] <seanh> Is the dev meeting at half past today?
[10:56:53] <amercader> seanh: I think so, worked better for wardi
[11:03:11] <rossjones> I can't do Thursday calls :( But will try and be on the pad.
[11:05:07] <wardi> yes please
[11:09:50] <amercader> I recently found out about git rerere and it's pretty handy, specially when merging the same stuff across different branches
[11:10:04] <amercader> it might be the git command with the silliest name though
[11:31:35] <wardi> https://plus.google.com/hangouts/_/event/cb1vmkss426lkqicj94a3amvd1c?authuser=0&hl=en-GB
[11:32:40] <amercader> seanh: dev meeting?
[11:33:34] <amercader> brook_: if you want to join ^
[12:00:56] <wardi> http://ckan.org/about/members/
[12:05:41] <amln> has the meeting finished?
[12:05:46] <wardi> yes, just
[12:05:48] <amln> (the hangout has no-one in it)
[12:05:55] <amln> no prob.
[12:06:44] <joet> oh wait i forgot we started at 12:30 there
[12:14:43] <wardi> joet: short meetings are good
[13:34:16] <trickvi> I'm trying to add some extra fields to a resource I'm creating, which worked wonderfully until I introduced a schema for other fields, is it not possible to mix a schema and other fields? The documentation is not very helpful
[13:35:52] <trickvi> the hacky way around it would be not to use create_package_schema()
[13:36:40] <trickvi> but I don't like that since we do provide the create/update_package_schema()
[13:38:40] <wardi> trickvi: you can add resource fields to your schema too, but once you have a schema you can't have free-form extras on current stable releases, I believe
[13:39:13] <wardi> amercader has fixed/is working on a fix for the next release
[13:40:16] <trickvi> wardi: yeah, that's the thing I've noticed... no free-form extras when I have a schema
[13:41:23] <amercader> trickvi: custom fields in a schema + arbitrary extras was merged to master and 2.2.1 (https://github.com/ckan/ckan/pull/1894)
[13:41:42] <amercader> trickvi: but I'm not entirely sure that you need this for extras in resources
[13:43:04] <wardi> amercader: hmm. arbitrary extras seems like a new feature. does that mean we can't limit arbitrary extras anymore?
[13:43:30] <wardi> I like being able to control the fields that can be added
[13:44:04] <amercader> wardi: I guess you can always do schema['extras'] = [ignore]
[13:46:41] <wardi> I'll need to play with that. I'm thinking of adding "allow_dataset_extras" and "allow_resource_extras" T/F settings to scheming
[13:50:54] <trickvi> amercader: so is the "ignore" you're referencing there similar to ignore_missing which is an undocumented validator or is it a "home-made" validator?
[13:51:24] <amercader> trickvi: it's a core validator, like ignore_missing
[13:51:56] <trickvi> ah... ok that helps me get rid of funny looking validators in my code :)
[16:45:26] <banders> Hi all.  I'm trying to get started as a ckan contributor, starting by setting up my development environment.  Anyone able to answer a few general questions about cloning the repository and then installing the application?
[16:46:44] <amln> banders: have you seen http://docs.ckan.org/en/latest/maintaining/installing/index.html ?
[16:47:31] <banders> amln, yes I started there.
[16:49:12] <banders> I will want to install from source, so I followed that link but am unsure about step 2b.
[16:51:48] <banders> is it possible to install from source by a) fork ckan into my own github, b) clone to my local computer, c) install that cloned copy (i.e. instead of pip install -e ...)?
[16:54:28] <amercader> banders: you should follow exactly the same instructions but pointing to your fork instead of the default one
[16:54:29] <wardi> banders: sure, that works fine (I prefer setup.py develop)
[16:57:35] <banders> wardi, amercader: thanks.  sounds like I can do it either way.
[16:59:37] <banders> wardi: after setup.py develop, I presume I still must run pip install -r requirements.txt?
[17:02:02] <wardi> banders: yes
[17:02:30] <wardi> banders: and dev-requirements.txt
[17:03:06] <banders> wardi: thanks.  appreciate it.
[18:16:57] <seanh> Why can't I access a solr instance running in a vm from my host machine?
[18:17:22] <amln> firewalling?
[18:17:29] <seanh> It's running on 127.0.0.1:8983 in the vm, accessible from within the vm, vagrant port forward 8983:8983 is setup..
[18:17:38] <amln> promiscuity?

2014-10-01
[22:26:35] <banders> Hello.  Thinking of making my first contribution to ckan by tackling this issue: https://github.com/ckan/ckan/pull/422
[22:27:27] <banders> Can anyone advise on the basic steps to get started as a ckan contributor?
[22:43:00] <banders> One specific question: Some work on the issue has already been done in an existing branch (422-fanstatic-windows-compat).  Do I need to create a new branch for my additional contribution, or use the existing branch?

[12:14:06] <nigelb> /wc/query rossjones
[12:14:09] <nigelb> bah
[12:47:04] <seanh> Trying to figure out how I can connect /foobar so that it calls an action function provided by an extension
[12:47:14] <seanh> My need to just write my own controller and forward it
[12:55:41] <rossjones> seanh I've had cases like that where the controller is pretty generic. Have only spent 10 seconds thinking about it, but maybe there's a case for a controller that just forwards to logic layer + auth check?
[12:58:50] <seanh> rossjones: Yeah
[12:59:23] <seanh> A controller provided by a plugin can just call toolkit.get_action(), so auth and validation is taken care of
[12:59:49] <seanh> Not sure exactly what the API controller does outside of get_action(). Dumping the result to JSON string for one
[13:03:02] <rossjones> provides success/fail methods I think.
[13:03:04] <rossjones> Not much else.
[13:03:47] <rossjones> seanh have you had a look at the API they implemented for data.gouv.fr? https://www.data.gouv.fr/en/apidoc/
[13:03:53] <rossjones> has a nice swagger.io interface :)
[13:12:39] <seanh> rossjones: meh
[13:12:44] <seanh> We could do with nicer API docs though
[13:15:59] <wardi> rossjones: what are they using for their portal?
[13:18:10] <wardi> oh. looks like https://github.com/etalab/udata
[13:27:37] <rossjones> yeah :(
[13:28:06] <rossjones> They're really focussed on a different way of thinking I think, at least they're very keen on social aspect.  And they've lost a LOT of functionality.
[13:28:30] <wardi> their models are close to ckan though
[13:28:55] <rossjones> Right - can everyone who is interested in having 2.3 sometime in the next decade - PLEASE go and add your vote to  https://trello.com/c/73bqsYJL/23-release-v2-3-current-release-resource-views-etc so that the steering group will pay attention?
[13:29:13] <rossjones> If you don't see the vote button, you may need to request access at https://trello.com/c/HGLxTlF0/26-want-to-vote-just-remember-to-login
[13:29:22] <rossjones> ***end of public service announcement ***
[13:29:39] <wardi> * votes are non-binding, better yet sponsor the assocaition and push there :-)
[13:31:02] <rossjones> steering group are as yet unconvinced a 2.3 release is a high priority.
[13:31:06] <rossjones> even if they had the resources.
[13:31:16] <rossjones> c.f. ckan-global-users ML
[13:31:56] <wardi> right, and they are represented by people with enough developers to carry their own forks anyway
[13:32:38] <rossjones> unfortunately
[13:32:57] <rossjones> we need to make forks unnecessary
[13:33:49] <wardi> I think forks are fine. even very low risk if they just have things that are already on/slated to be merged with master
[13:34:11] <rossjones> github forks different from actual forks though.
[13:34:24] <rossjones> dgu was v.close to the point of no returns.
[13:34:32] <rossjones> now is just stock with a few extra features.
[13:34:55] <wardi> that's good news
[13:35:03] <rossjones> it is.
[13:35:08] <rossjones> afk for a bit
[13:56:45] <joet> amercader was it you who had the code overview diagram?
[13:57:33] <amercader_> joet: I have something like that, let me see
[13:58:02] <amercader_> joet: https://github.com/ckan/ckan/pull/1745#issuecomment-46151684
[13:58:10] <amercader_> best I can offer you
[13:58:55] <joet> that's great amercader thanks
[14:00:45] <wardi> hmm. what do you call a plugin that is always loaded?
[14:01:22] <amercader_> wardi: is this a joke?
[14:01:25] <amercader_> :)
[14:02:06] <wardi> amercader_: I would call them "not a plugin". ckan calls them "system_plugins" :-(
[14:02:14] <joet> wardi i remember kindly mentioning these before
[14:02:46] <wardi> and imageview is one and is failing in a test, for a reason I'm not interested in
[14:03:29] <amercader_> wardi: this makes automatically preview an image with the new resource views
[14:03:46] <wardi> no, it makes my tests fail for no reason
[14:16:49] <wardi> ok, that might have been a red herring, but seriously.. why is image_view a required plugin?
[14:25:05] <wardi> hmm. why is my context['user'] == 'Unknown IP Address'
[14:25:20] <amercader_> wardi: ok, one at a time :)
[14:26:26] <wardi> ok, I'll be quiet until I unravel this a little further
[14:26:33] <amercader_> the first one is because when someone uploads a picture, they expect it to show up on the resource page. This is dealt via resource views plugins. The way this is enabled by default will hopefully change (#1852)
[14:28:42] <amercader_> the second one has been going on since the dawn of times, I think it basically means that you are not logged in (I think). Relevant code is on lib/base.py
[14:30:15] <wardi> but a string stating the client connected from an unknown IP address is a strange thing to put in a variable that normally contains usernames
[14:30:38] <wardi> do real IP addresses (and hostnames?) get put there too?
[14:31:17] <amercader_> I don't know, at looked at this a long time ago
[14:31:28] <wardi> any string that matches a user name will cause that user to be logged in
[14:52:27] <amln> davidmiller: ping?
[14:52:41] <amln> Harrison, about 18:30?
[15:21:49] <wardi> a little more info: if I use the Dataset factory to create a dataset with jpg resources, the image_view plugin causes an auth failure
[15:32:00] <davidmiller> amln: pong !
[15:51:44] <joet> amercader, is that diagram you created saved somewhere apart from on a random pull request?
[15:52:05] <joet> i used to  to try to explain the code layout to brook, but it might be useful for him to be able to find it somewhere
[16:04:44] <amln> davidmiller: does that idea appeal to you?
[16:07:51] <davidmiller> amln: the Harrison idea ?
[16:08:59] <amln> yeap
[16:09:43] <davidmiller> As in The Harrison - Bar, Kitchen & Hotel, 28 Harrison St, London WC1H 8JF, United Kingdom ?
[16:10:54] <amln> davidmiller: indeedy.
[16:31:52] <amln> might be there a bit earlier, we're at C4C.
[17:30:45] * wardi reads business plan
[17:30:48] <wardi> we're part way there on "best of breed tools", "most up to date versions of python".. well
[17:37:37] <wardi> would be great things to get fixed though
[19:59:40] <rossjones> davidmiller I notice you haven't voted at https://trello.com/c/73bqsYJL/23-release-v2-3-current-release-resource-views-etc

2014-09-30
[10:47:42] <rossjones> dumb question: I want to purge all the deleted datasets.  paster dataset purge requires an argument.  How do I find all the deleted datasets?
[10:47:47] <rossjones> from paster
[10:50:05] <amercader> rossjones: I don't think you can, but adding support for paster dataset purge all seems easy :)
[10:50:25] <rossjones> amercader Yup.  Any thoughts on doing it from WUI?
[10:51:05] <amercader> rossjones: there is a WUI for doing it but the implemetation on the controllers is so bad that it will crash if you have loads of datasets
[10:51:25] <amercader> http://localhost:5000/ckan-admin/trash I thkn
[10:51:50] <amercader> having proper purge actions would be very good
[10:51:56] <rossjones> Totally forgot about both that AND the ckan-admin thing...
[10:53:02] <rossjones> that page is totally borked.
[10:53:19] <rossjones> doesn't recognise me as logged in, one button active, the other disabled.
[10:53:22] <rossjones> Will file a ticket.
[10:53:53] <amercader> rossjones: I think it's fixed on master
[10:54:02] <rossjones> ah cool
[10:56:09] <amercader> rossjones: http://master.ckan.org/ckan-admin/trash I can make you sysadmin to check the page if you want
[10:56:28] <rossjones> um. No ta.
[10:56:39] <rossjones> Thanks for the offer though.  Will try out master soon though
[10:56:46] <amercader> cool
[10:57:01] <amercader> I guess it could also be backported if needed
[10:57:25] <rossjones> Is meeting on today? Might try and make it for a change :)
[10:57:39] <amercader> rossjones: in 3 minutes!
[10:57:47] <rossjones> Eeek.
[10:57:52] <rossjones> Any details?
[10:58:04] <amercader> https://pad.okfn.org/p/ckan-meeting
[10:58:10] <amercader> https://plus.google.com/hangouts/_/event/cb1vmkss426lkqicj94a3amvd1c?authuser=0&hl=en-GB
[10:58:25] <rossjones> will be there in 3 mins.
[10:58:28] <rossjones> 2, whatever.
[10:58:46] <amercader> rossjones: no rush, we'll be there
[11:01:38] <amercader> wardi, seanh, joet, nigelb, anyone else interested ^
[11:07:13] <amercader> http://catalog.data.gov/dataset
[11:58:14] <amercader> davidmiller: http://ckan.org/about/steering-group/
[11:58:25] <amercader> you might fins some answers here ^
[11:58:29] <amercader> *find
[13:21:29] <davidmiller> amercader: ace - thanks !
[14:13:38] <amercader> wardi: can I ask you about camel humps?
[14:21:50] <wardi> amercader: sure
[14:22:28] <amercader> wardi: does ckanext-scheming transparently handles convert_to_extras for you or I'm missing something here?
[14:22:29] <amercader> https://github.com/open-data/ckanext-scheming/blob/master/ckanext/scheming/camel_photos.json#L24
[14:22:45] <wardi> amercader: it does
[14:22:54] <wardi> it's even documented in the readme
[14:23:36] <nigelb> I'll definitely join the next one.
[14:23:40] <amercader> cool, I imagined
[14:23:43] <nigelb> I've just been putting out fires for the last 2 days.
[14:23:44] <nigelb> sigh.
[14:23:48] <nigelb> another 11-hour work day.
[14:24:27] <wardi> I did that for three reasons: it makes the validators lists shorter, it means users don't have to care about the difference between extras and normal fields (much) and it means I can come up with a convert_to_combined_extras converter later that people can configure to use or not
[14:26:05] <rossjones> Can't we just move it into core as an alternative supported way of managing schema? Looks nicer.
[14:26:10] <amercader> wardi: sounds great, I have also thought something along those lines for core, making irrelevant for users where fields get stored
[14:26:34] <rossjones> and gradually fade out the python method.
[14:27:47] <wardi> rossjones: developing it as an extension means it could support multiple ckan versions while still adding features (>2.3)
[14:28:25] <rossjones> Oh, it works with 2.2?
[14:28:38] <wardi> no, and not with master yet either
[14:28:49] <rossjones> un less you have that specific branch of master.
[14:29:24] <wardi> in the future when we're releasing new versions every couple months it *will* be nice to not be tied to the ckan version ;-)
[14:29:54] <rossjones> One day.
[14:30:42] <amercader> wardi: I've had pretty good results with spatial and harvest making them support 2.0 through master, although maybe they don't tap into so much core stuff as scheming
[14:31:34] <wardi> amercader: I don't think the changes to core are that invasive, and they could be useful for anyone customizing forms in their extensions
[14:32:21] <amercader> sure, I meant that it should be relatively easy to support 2.3+ on scheming
[14:32:36] <amercader> once your PR gets merged
[14:33:13] <wardi> that's my hope too. this extension is about optimizing the time I spend responsing to schema change requests from my client :-)
[14:34:06] <wardi> and make it easier to have multiple dataset types for differently shaped things
[14:37:53] <wardi> I probably need to integrate search facet stuff at some point soon
[14:47:54] <wardi> I'm just starting to get functional tests working on travis with ckanext-scheming, for some reason the imageview plugin is getting loaded when I run my tests..
[14:48:25] <amercader> wardi: we have dynamic fields on Solr for this (you can index on any arbitray field and facet by it) so souns like should be easy
[17:37:54] <rgrp> hi folks - just a heads up that if i get some spare time i will try and work on getting up and extension.ckan.org site ...

2014-09-29
[12:25:01] <rossjones> When I call package_show via the API, some of the fields in my custom schema are not being shown.  Is that because I ignore_missing instead of ignore_empty?
[12:27:46] <wardi> rossjones: I use ignore_missing on the show schema of all my extras
[12:28:17] <wardi> (for resource extras too)
[12:28:42] <rossjones> Maybe my custom validator is doing something weird
[12:31:13] <wardi> have you seen https://github.com/ckan/ckan/blob/master/doc/extensions/adding-custom-fields.rst#custom-validators
[12:31:28] <wardi> seems our sphinx builds aren't up to date
[12:32:08] <wardi> I always have to look up which validator type expects me to return the new value etc. so I wrote that
[12:35:01] <rossjones> wardi you mean have I RTFM? ;)
[12:36:07] <rossjones> I have.
[12:36:18] <wardi> rossjones: heh, no I'm just saying I always forget how those work
[12:37:32] <wardi> also be suspicious of the caches validated_data_dict in solr. updating your show schema won't affect what package_show returns if it's there
[12:47:42] <rossjones> Turned out if was overzealous use of validators in show schema.
[13:37:32] <SkramX> how does one export a CKAN datastore resource as an OKFN data package?
[15:45:33] <davidmiller> Several months ago I heard rumours of a CKAN point release... Is that still a thing?
[15:45:52] <davidmiller> I notice "Release schedule" was deleted from the agenda for last friday's community meeting :)
[15:51:07] <rossjones> davidmiller don't worry, my item was deleted as well :(
[15:51:37] <rossjones> wardi it would be nice to be able to not use solr as a database.
[15:51:52] <rossjones> s/able/need/
[17:11:29] <rgrp> rossjones: you should come to the meeting ;-)
[17:11:35] <rgrp> davidmiller: and ditto ...
[17:11:51] <rgrp> davidmiller: i removed release schedule because of time - it was clear we were going to have our hands full with the other items ...
[17:12:10] <rgrp> This was also a general community meeting not a technical team meeting (which I'd imagine would be the better place to discuss the release schedule)
[17:12:47] <rgrp> Hearing what people thought about the roadmap was the priority ...
[17:13:10] <rgrp> acorbi: if you are still around - in answer to your qustion from yesterdfay you need the #411 branch i think which has sql only support ...
[17:13:18] <rgrp> (and which i keep maintaining ;-) ...)
[17:15:45] <rossjones> was the trello updated to reflect the discussion?
[17:16:29] <rossjones> More votes for Showcases than 2.3 is a bit depressing :(
[17:45:26] <davidmiller> rgrp: I should come to the meeting where my question wasn't discussed ? ;)
[17:45:50] <rgrp> davidmiller: if you want the question discussed come to the meeting - it was on the agenda when the meeting started ...
[17:46:16] <rgrp> after discussion of who was present, what people wanted to talk about etc
[17:46:45] <rgrp> davidmiller: however my bigger point is that that the general community meeting is probably not the best place - teh tech team meeting 2x a week would probably be better
[17:47:08] <rgrp> rossjones: i think the point re 2.3 was that it wasn't a feature (but the release of a feature ...)
[17:47:36] <davidmiller> rgrp: OK sure, when is the next meeting, can I put things on the agenda, can I put this on it now ? :)
[17:47:52] <rgrp> davidmiller: the next tech team meeting is tomorrow i think ...
[17:48:02] <rgrp> every tuesday and thursday at 12 - why not go along :-)
[17:48:19] <davidmiller> rgrp: I don't have any details of where, when et cetera.
[17:48:55] <rgrp> i think they are posted to the channel before the meeting ...
[17:49:00] <rgrp> i think the pad is here https://pad.okfn.org/p/ckan-meeting
[17:49:33] <rgrp> davidmiller: i would also guess that whilst asking for things is def welcome offers to help make them happen are even more so :-)
[17:51:35] <davidmiller> rgrp:  At the moment all I'm asking is "What's the current plan"
[17:51:45] <rgrp> davidmiller: for the 2.3 release?
[17:52:17] <davidmiller> Yes ! And before, and after!
[17:58:57] <rgrp> right well that's the roadmap chat we are having right now plus the resourcing question of what people contribute ...

2014-09-28
[16:02:30] <acorbi> Hi everyone. Anybody knows if its possible to initialize a CKAN instance that does NOT use Solr for search? I have tried setting ckan.simple_search to true but still tries to connect to the Solr server. The context of my question is that i am integrating the tests of a ckan plguin i am delveloping with TravisCI and i would like the provisioning of the Travis virtual instance to be as lightweight as possible

2014-09-27
[06:14:19] <leomark> I have a question in ckan.. Im changing the default template to foundation zurb. I got some error in my production. It says 'module' object has no attribute 'css/foundation.css'.. how can I fix this?..

2014-09-26
[08:54:15] <amercader> wardi: I don't know what you are talking about but sounds like a terrible idea
[13:49:03] <wardi> amercader: it's the thing you get when you type h.somethingthatisntahelper
[13:49:19] <wardi> it's a function that returns an empty string..
[14:00:15] <seanh> Hmm, I've got the package read page 500ing on 2.2 and master
[14:00:36] <seanh> It works fine with requirements.txt, but then once you install dev-requirements.txt it breaks
[14:05:34] <seanh> Something in dev-requirements.txt is upgrading Jinja to 2.7, which breaks CKAN
[14:05:55] <seanh> The file hasn't changed in a year though
[14:53:38] <Jeanne> Hi all, getting ready for the CKAN Community and Communications Meeting.
[14:54:15] <Jeanne> Start at by going to the URL below and then click on the "Join" button
[14:54:27] <Jeanne> Start the WebEx at: https://pwgsc-nh.webex.com/mw0307l/mywebex/default.do?service=1&siteurl=pwgsc-nh&nomenu=true&main_url=%2Fmc0806l%2Fe.do%3Fsiteurl%3Dpwgsc-nh%26AT%3DMI%26EventID%3D281133022%26UID%3D512970252%26Host%3Dba2a8bb80a0424055757%26FrameSet%3D2%26MTID%3Dmf3f4bd188bee2d5c8cf0d8df3a5c70ae
[15:00:55] <rgrp> Jeanne: do you know what the meeting p/w is - i'm trying to join on my phone ...
[15:04:13] <Jeanne> Try calling in on 1-613-960-7514 and then use 447 848 6
[15:05:39] <rgrp> i'm in now ..
[15:06:21] <Jeanne> Great!
[15:07:38] <wardi> taking a look at dataone.org
[15:09:41] <Jeanne> Taking role now:  *Jeanne Holm (GSA / Data.gov) *Rufus Pollock (Open Knowledge) *Ashley Casovan (Gov of Canada) *Ian Ward (acting CKAN Tech Lead, data.gc.ca at Statistics Canada) *Stephen Richard (USGIN, NGDS, AZGS) *Rich Signell (USGS, US-IOOS) *Deirdre Lee (Insight Center for Data Analytics, NUI Galway, Ireland) *Peter Schweitzer (USGS)
[15:09:57] <Jeanne> https://trello.com/b/kvgOZLMs/ckan-association-roadmap-consultation (Roadmap)
[15:11:05] <Jeanne> Hi Andrew!
[15:23:36] <Jeanne> Andrew Hoppin:  Used CKAN to connect with Drupal, using Recline, that aligns with CKAN APIs and open data standards.  Looking at DKAN Project that simplified the effort for people who want to publish open data in a standards compliant open practice.
[15:27:08] <Jeanne> Would it be okay to record the remainder of this meeting so we can have more thorough notes?
[15:33:12] <deirdrelee> q+
[15:36:21] <ahoppin> Links for followup in re: those DKAN questions: https://github.com/nucivic/dkan http://docs.getdkan.com  https://github.com/NuCivic/visualization_entity
[15:40:40] <wardi> easier custom schemas for ckan http://github.com/open-data/ckanext-scheming

2014-09-25
[08:59:03] <nickshanks> Is there anyone here responsible for ckan.net ?
[09:00:48] <nickshanks> well, if someone swings by, the links from http://lod-cloud.net/state/#terms do not work because the whole ckan.net domain is returning 403 errors
[09:01:27] <nickshanks> and the woman on the switchboard at the Open Knowledge Foundation has no idea what I'm talking about :)
[09:08:14] <nigelb> nickshanks: ah, interesting. ckan.net is supposed to point to datahub.io
[09:08:31] <nigelb> but then that doesn't help much either.
[09:08:32] <nickshanks> ie.ckan.net works, www.ckan.net doesn't
[09:08:56] <nigelb> datahub returns empty results.
[09:10:46] <nickshanks> I am about to integrate dbpedia extracts into our website at roh.org.uk and will over the next few months be releasing an LOD set and SPARQL endpoint for all of our public data. I wanted to see what the 5 other LOD sets that integrated with DBpedia were
[10:44:43] <wardi> nigelb, amercader, seanh, joet: 12:30 again ok?
[10:45:15] <joet> good for me
[11:32:07] <amercader> wardi, joet, nigelb : are we doing this? ^
[11:32:45] <wardi> https://plus.google.com/hangouts/_/event/cb1vmkss426lkqicj94a3amvd1c?authuser=0&hl=en-GB
[12:29:47] <nickshanks> heh, I just googled "querying elasticsearch" and got this: http://okfnlabs.org/blog/2013/07/01/elasticsearch-query-tutorial.html
[12:30:39] <nickshanks> Rufus Pollock is the guy I asked for when I called the number in Cambridge, and the switchboard girl didn't know of (he is listed on the whois data for ckan.net)
[17:22:22] <wardi> is null_function a good idea?
[17:22:49] <wardi> I just wasted a bunch of time chasing the wrong issue because of it
[18:55:57] <SkramX_> im getting "Error - <type 'exceptions.AttributeError'>: 'NoneType' object has no attribute 'info'" when going to resource preview page. how should i be debugging this more?

2014-09-24
[16:04:36] <wardi> seanh: check out @inlineDeferred if you use twisted, that lets you write your thing as though it's blocking code, then you can just start up 20 or however many you want to do in parallel that take a url from a deque and try it in a normal looking loop
[16:34:05] <seanh> amercader: Apparently you can get all results from solr by passing &rows=2147483647 (the maximum possible int value) :)
[16:34:33] <seanh> I would try this in CKAN but just loading enough datasets to be more than whatever the limit solr currently returns by default will probably take forever
[16:35:28] <amercader> I'm not sure how I feel about this
[16:35:39] <amercader> I think we should hardlimit it
[16:37:46] <seanh> Maybe we do, haven't looked
[16:38:16] <seanh> But honestly, I haven't tried it but I would guess that even on a CKAN site with hundreds of thousands of datasets, Solr ought to have no trouble returning all of them
[16:38:30] <seanh> The metadata itself isn't gonna take up much space in terms of megabytes
[16:38:44] <seanh> And it's not exactly a complex search query: just give me every document
[16:39:09] <seanh> If you could come up with some more complex search that matched hundreds of thousands of documents, maybe you could make solr overwork, dunno
[16:46:37] <bl4ckb1rd> Hi, i have a problem that dont understand, i DROP DATABASE default and datastore, delete all files upload, y clean solr cache and index, but when i tried to upload again a package still say package already exist :P and the url /dataset say i have the same count datasets before i delete ALL! :P
[16:46:38] <bl4ckb1rd> Please i need help! haaa
[16:48:26] <bl4ckb1rd> with paginate http://d.bl4ckb1rd.net/zKtzA.png but empty list
[16:49:53] <amercader> bl4ckb1rd: this happens when the db is cleared but not the solr index
[16:50:20] <amercader> you need to do: paster search-index clear
[16:52:05] <bl4ckb1rd> amercader: Thanks!!! kwon return to normality :P
[16:53:44] <bl4ckb1rd> *now
[20:10:10] <seanh> wardi: rossjones Was just listening to something about how they handled background processes in old versions of FogBugz and StackOverflow (not sure if they still work this way)
[20:11:05] <seanh> They had a "heartbeat page" at stackoverflow.com/heartbeat which, when hit, would check a list of background tasks and do one of them, then return either a + (if there were more tasks on the list) or a - if the list was done in its http response
[20:11:20] <wardi> that's nasty :-)
[20:11:46] <seanh> Then they have a really trivial "tickler process" running as a cron job or whatever that just hits that url, and if it gets a + back hits it again right away, if it gets a - waits a while then hits it
[20:12:04] <seanh> I'm not sure if timeouts might become an issue
[20:12:39] <seanh> But the cool thing is that everything is a web page / an http request and response, so the model is consistent, rather than background jobs being different from everything else
[20:13:01] <seanh> Also if the public or a bot discovers the page, it can hit it and kick off background tasks and this doesn't harm the system at all!
[20:13:45] <seanh> In SO they didn't have the tickler, they actually just relied on normal requests coming in from users to trigger async background processes, if no one was using the site the janitorial stuff would never get done!
[20:13:54] <seanh> Yeah it is pretty ghetto but I also kind of like it

[14:32:07] <seanh> They are in the toolkit
[14:32:35] <seanh> Urgh
[14:32:50] <seanh> Is this gonna be another methods vs functions thing?
[14:32:52] <wardi> hmm. so I've used @side_effect_free and that seemed to work
[14:33:10] <seanh> I have @toolkit.auth_allow_anonymous_access on my plugin's auth funciton
[14:33:34] <seanh> But when new_authz does my_auth_func.auth_allow_anonymouse_access it gets AttributeError
[14:33:37] <wardi> oh, I might not be calling these anon. need more tests
[14:34:17] <wardi> seanh: yeah. I think we need to quietly wrap methods or change the way we're testing those attributes
[14:36:14] <seanh> wardi: Oh no wait, it seems that decorator goes on the auth function not the action
[14:44:18] <amercader> seanh: the @auth_allow_anonymous_access decorators attach properties to the function I'm afraid, so I don't think they will work on methods
[14:47:28] <amercader> morty: do you know if DGU supports "Local government open data schemas" in some way? (ie harvesting or producing them)
[14:52:31] <amercader> ok, I found https://github.com/datagovuk/ckanext-dgu-local
[14:53:00] <rossjones> amercader has an LA asked you for it?
[14:53:06] <rossjones> Wish they'd just gone with DCAT :(
[14:53:50] <amercader> rossjones: I couldn't belive it when I learn about these schemas today
[14:53:57] <amercader> yet another catalog/dataset serialization
[14:54:03] <rossjones> All happened because datashare didn't have a way to share datasets..
[14:54:12] <amercader> what is datashare
[14:54:13] <amercader> ?
[14:54:17] <rossjones> redbridge datashare
[14:54:29] <rossjones> http://data.redbridge.gov.uk/
[14:55:04] <rossjones> LGA started process in order to make it easy to get data ONTO dgu. No mention of CKAN-CKAN harvesting, just this new format.
[14:55:31] <rossjones> with their imposed model of how DGU should model package/resource  (by having package/resource/renditions)
[14:55:45] <rossjones> Managed to talk Leeds out of using it.
[14:55:51] <amercader> renditions was when they lost me
[14:56:01] <wardi> what's a rendition?
[14:56:04] <rossjones> want same data in csv, excel and pdf. You know, just in case.
[14:56:19] <rossjones> Lost interest when they refused to access pdf isn't data.
[14:56:49] <rossjones> If they'd agreed to use DCAT (as mentioned in first meeting) ckanext-dcat would be funded and done now (this was last Nov).
[14:57:35] <rossjones> Would suggest harvesting should be read-only, don't try and generate one of the XML files.  morty must be nearly finished with it now.
[14:57:46] <rossjones> And we're *probably* going to do one for datapress.
[14:58:22] <amercader> I can see how ckan to ckan is too specific, but not basing something like this on dcat is hard to understand
[14:58:28] <amercader> rossjones: that's great news
[14:58:46] <rossjones> I am deeply ashamed that I was too naive to see what was going on when I helped with it :(
[15:00:06] <amercader> rossjones: is almost impossible to fight this kind of thing
[15:00:24] <amercader> rossjones: on other news, I'm working on an rdf based dcat harvester
[15:00:34] <rossjones> ooh.
[15:00:36] <amercader> ie, no more fixed serializations
[15:00:41] <rossjones> maybe we should just xsl it into dcat?
[15:01:25] <amercader> rossjones: you mean for generating it?
[15:01:43] <rossjones> i mean harvesting ... requests.get piped into xsl transform, use dcat harvester :)
[15:02:02] <amercader> rossjones: mmm, no :)
[15:02:50] <amercader> I'm quite please with how it's turning out. I've done some tests with different rdf/xml and turtle examples and the ckan datasets created looked quite nice
[15:03:11] <rossjones> cool.
[15:03:26] <amercader> the trouble is with ambiguous fields like spatial/ frequency/format, etc
[15:03:41] <rossjones> and the 50 I just added to GLA for gemini ;)
[15:03:50] <rossjones> s/50/15/
[15:03:52] <rossjones> ish
[15:04:27] <amercader> I'm basing it on the European DCAT-AP for now, but with some form of profiles that you can apply to modify the resulting dataset / parse 15 inspire fields etc
[15:05:17] <rossjones> would be nice if it was ckan default as well?
[15:05:21] <rossjones> instead of ckan-ckan
[15:05:44] <amercader> rossjones: what do you mean?
[15:05:46] <rossjones> less code to maintain etc etc
[15:06:22] <rossjones> amercader I mean, if ckan generated dcat, and a dcat harvester was available, why bother with the ckan->ckan harvester (except for old sites)?
[15:06:58] <wardi> does dcat cover anything anyone could ever want?
[15:07:43] <amercader> ckan to ckan is currently the only harvester that guarantees that you will get *all* dataset metadata from another ckan site
[15:08:01] <rossjones> amercader does it not cause issues with different schema?
[15:08:09] <rossjones> wrt validation perhaps.
[15:08:21] <rossjones> I harvest a dataset, it *has* to be read-only?
[15:08:32] <amercader> it always requests unvalidated (ie default schema) data
[15:08:39] <amercader> *metadata
[15:08:41] <rossjones> And ignores the rest?
[15:08:57] <rossjones> or missing fields.
[15:09:01] <rossjones> got it.
[15:09:03] <amercader> the unvalidated has all the fields, just probably stored as extras
[15:09:25] <wardi> stores everything as normal extras, does that work for resources too?
[15:09:37] <amercader> wardi: yes
[15:10:00] <wardi> sounds sensible :-)
[15:11:08] <amercader> I think that the ideal scenario would be that the default ckan schema followed as closely as possible dcat, allowing for extra fields as well, so effectively harvesting ckan to ckan would be dcat to dcat
[15:11:29] <amercader> but this is for api v4
[15:15:24] <seanh> wardi: rossjones By the way I discovered I think the best thing to use for a CKAN microservice like the link checker: Flask for the JSON API, and APScheduler for doing the asynchronous and periodic stuff
[15:15:43] <rossjones> APScheduler is the thing datapusher uses?
[15:16:34] <seanh> APScheduler is just a Python lib that lets you say: call this function asynchronously and when it's finished call this callback function with the result. And it can call them periodically as well. It needs no setup, no non-Python dependencies, you don't need to run a worker process or anything. Just install the Flask app and it goes
[15:16:43] <seanh> Yeah, ckan-service-provider uses it
[15:17:37] <rossjones> seanh so it's entirely possible that there's nothing 'wrong' with ckan-service-provider? And that maybe just separating it somehow (wrt config/setup/whatever) might be enough?
[15:17:38] <seanh> I actually think ckan-service-provider has the right approach with Flask + APScheduler, but it's just a lot heavier than I think we need for a microservice (it has login and logout, checking status of tasks, history of tasks, deleting tasks, it has a database..)
[15:18:09] <rossjones> My only problem, is that we're talking about which technology again, not 'what does the interface look like because I use Ruby'.
[15:18:14] * rossjones doesn't use Ruby.
[15:18:28] <seanh> I don't think there's anything wrong with ckan-service-provider (it even has good test coverage) except that it does a lot more than I need
[15:18:34] <rossjones> how ckan-service-provider work is just a detail really
[15:19:16] <seanh> Well, I already know what I want the interface to be, but I've been looking for what I can use to implement such an interface with minimal setup and maintenance from the user, which is Flask and APScheduler I think
[15:19:43] <rossjones> seanh so the endpoints can be like a reference implementation you mean?
[15:19:59] <seanh> datapusher on the other hand I don't know how good the test coverage is, and nick said the code was very complicated, but I thought the ckan-service-provider code was fine
[15:20:11] <rossjones> Use these endpoints, behave like this, you can have a workable scala service provide functionality to ckan.
[15:20:22] <seanh> No it's the other way rounf
[15:20:23] <seanh> round
[15:21:08] <seanh> I am writing a link checker micro service with Flask and APScheduler. It'll have a documented non-CKAN-specific API, and if your site implements that API then it can check the links on your site for you
[15:21:25] <seanh> And the ckanext-deadoralive plugin that goes with it implements that API for CKAN
[15:21:58] <rossjones> what does it implement for calling back to ckan? or is that logic encapsulated in the microservice.
[15:22:06] <rossjones> hang on, will check the code.
[15:22:15] <seanh> If we then wanted to implement a different microservice to do something else for CKAN, we could follow the same approach, and maybe some of the code would even be reusable, but I haven't thought about what parts of the code could be abstracted out into a reusable lib yet
[15:22:51] <seanh> rossjones: It says "your CKAN (or other site) must implement this API" and one of the things in that API is a function that it uses to post back the link checker results
[15:22:55] <seanh> Docs are lacking still
[15:23:26] <seanh> By "a function" I mean a URL that it POSTs to
[15:24:59] <rossjones> right, gotcha.
[15:25:11] <seanh> Anyway, I looked at a lot of stuff. There are queues like celery and RQ (which looks really nice by the way) and lots of others, but they all seem to require running a worker process under supervisord which is an extra step I didn't want
[15:25:46] <seanh> Then there are asynchronous web frameworks like Twisted and Tornado, but they seem to be for doing something completely different and I don't understand that suggestion tbh
[15:26:02] <seanh> Finally landed on APScheduler, then discovered ckan-service-provider was using it as well
[15:27:19] <seanh> Even with APScheduler you have to jump through some hoops in your code to make it call a given function asynchronously just once and call a callback with the result, it's mostly designed around the calling a function periodically use-case
[15:27:37] <rossjones> does it persist the job somewhere?
[15:27:43] <seanh> I think it's quite shocking that Python doesn't have a simple call_asynchronously(my_function, my_callback)
[15:27:53] <rossjones> seanh it does.
[15:28:09] <rossjones> https://docs.python.org/2/library/multiprocessing.html
[15:28:34] <seanh> By default the jobs are in memory, so restart the web server and they're gone. But it can persist them in a db if you want. I'm not sure if it keeps a record of finished jobs and their results (but I don't want that)
[15:28:50] <seanh> The multiprocessing module does not do that afaik
[15:29:37] <seanh> It's a lot more low level, unless I missed it there's no simple high level "call this function in another process and when it's done call this callback function in my process"
[15:29:43] <rossjones> you can kick off a process that'll call your function in the same module.
[15:29:59] <rossjones> The first example at that url looks pretty much like that.
[15:30:41] <rossjones> you can also pre-launch them and give them a queue to read jobs from and/or write to.
[15:30:50] <rossjones> You could just provide the callback as a param
[15:32:57] <seanh> Ah yeah, it looks like you can indeed do it
[15:33:36] <seanh> multiprocessing.Pool.apply_async() I think
[15:34:30] <seanh> Anyway, APScheduler will handle doing it periodically for you, so in this case you'd still want that lib. It's good to know about apply_async() though that's probably all I'd want for a lot of problems
[15:35:57] <rossjones> stuff has to be pickleable but other than that it's pretty neat.
[15:38:02] <seanh> What if you wanted to have a function running in an async process, sending the result back by calling a callback, but you also wanted to be able to say "cancel the function if it's currently running and start it again with these params", i.e. making sure there's only ever one of them? APScheduler does this kind of high level stuff for you. multiprocessing looks a little low-level to me
[15:38:44] <rossjones> tbh I'd use a language with a better concurrency model ;)
[15:40:12] <DragonDave> I should try writing a scraper in Go at some point :D
[15:41:12] <seanh> rossjones: Yeah. Any favorites?
[15:42:09] <seanh> I was listening to Douglas Crockford a while ago talking about wanting to make all io asynchronous-only in JavaScript
[15:45:42] <rossjones> DragonDave it's not as hard as you;d think
[15:46:00] <rossjones> seanh go. am looking at elixir atm since davidmiller suggested I take a look.
[15:46:06] <rossjones> But atm, go.
[15:46:39] <rossjones> I wrote a thing in an afternoon for creating new solr cores remotely, not heard a peep from it for a couple of months.
[15:47:19] <seanh> Never taken a look at Go actually
[15:48:39] <rossjones> seanh always worth a look, am sure there'll be *something* you don't like (everyone has something) but overall it's nice.
[15:49:41] <wardi> argh! multiprocessing! pickle...
[15:50:30] <wardi> seanh: python3 has async stuff
[15:50:58] <rossjones> that's just lipstick.
[15:51:07] <seanh> wardi: You mean asyncio?
[15:51:28] <wardi> luscious inviting lipstick
[15:52:10] <seanh> I might give the pep a read at some point
[15:52:13] <wardi> seanh: the thing with tornado/twisted is they aren't web frameworks, they're event loops
[15:53:22] <rossjones> still using a single core etc.
[15:53:31] <wardi> they can do http things that call python code so you can use them like web frameworks, but fundamentally they are things that let you say "do this when some (timeout | io) happens"
[15:53:49] <seanh> I know but they don't seem to be what I want. What I want is: my web app receives an HTTP request, it responds immediately with 200 OK but it also adds an async function to a queue, when that function finishes it calls a callback URL. As far as I can tell that's not what Tornado and Twisted are about
[15:54:46] <seanh> I don't need my web app to do multiple things at once concurrently (the web server can handle that), I just need a queue with periodic support
[15:55:02] <wardi> you can absolutely do that. your queue could be a python list
[15:55:54] <wardi> in the case of link checking it makes perfect sense because it's always waiting on IO and the one process/core thing isn't a limitation
[15:57:53] <seanh> That's true, the way I check the links at the moment is one after the other in a single thread and process, so it's blocking all the time (I don't care that much about speed though but it certainly could be a lot faster)
[15:59:29] <seanh> I guess it takes a bit of time with Tornado or Twisted to find out how to do exactly what I want though, it doesn't seem to be the main thing that they do. What I wanted was a really simple async queue and scheduler lib, where the thing that I want is its main use case

[09:49:49] <seanh> amercader: This adds a Sphinx error that causes my sphinx build test to fail: https://github.com/ckan/ckan/commit/a3c5e57f6af934fd917bd4a8e32d449236f1862f#diff-2d22e37aeb699a369fd10c004d3f93ffR21
[09:50:12] <seanh> For some reason it doesn't seem to cause an error with the version of Sphinx we have on master, but if we upgrade Sphinx it does
[09:50:27] <amercader> *sigh
[09:50:38] <amercader> what does the error say?
[09:51:01] <seanh> I've fixed it
[09:51:12] <seanh> You can't put a seealso all on one line like that
[09:52:04] <seanh> This is also a Sphinx error (joet this time): https://github.com/ckan/ckan/commit/7d1ac48ffba1bffdca709ad21c127f991d40f7e3#diff-3c7eb53cb233200ff0379a5b94ca5001R17
[09:52:20] <seanh> The text under the seealso is indented wrong and does not have an empty line before it
[09:52:30] <seanh> Sphinx / rst is a little unforgiving
[09:52:32] <amercader> but we couldn't know! :)
[09:52:49] <amercader> did this break the whole build?
[09:52:57] <seanh> I think this will fix them https://github.com/ckan/ckan/commit/5b74dc1c6a9fd4db7456db525c4e85e7ef982037
[09:53:11] <amercader> harsh
[09:53:16] <seanh> Well I'm gonna merge the Sphinx upgrade and the fix together in one branch so it won't be broken on master
[09:53:30] <amercader> cool
[09:53:44] <seanh> But if Sphinx had already been upgraded on master, that would have been a failing test on Travis yeaj
[09:54:31] <seanh> All the .. something:: blocks in Sphinx, leave an empty line after the .. something:: then indent the contents three characters so they line up with the first letter of the something, that seems to be the safe way
[09:55:09] <seanh> Well hopefully it passes on Travis now
[09:56:36] <seanh> Our Sphinx build on RTD has been failing for ages (weeks or months I think) because RTD stopped working with the old version of Sphinx we were using
[12:25:14] <davidmiller> Afternoon CKANers !
[12:25:20] <davidmiller> I have a "Bug or Feature or n00b" question for you.
[12:25:25] <davidmiller> I have a private dataset.
[12:25:29] <davidmiller> I have permissions to see that dataset.
[12:25:33] <davidmiller> I search for that dataset from /dataset?q=nameofmyprivatedataset .
[12:25:37] <davidmiller> I don't see my private dataset.
[12:25:40] <davidmiller> Is this a bug?
[12:25:44] <davidmiller> Is this a feature?
[12:25:55] <davidmiller> Is this configurable / I've not read the docs/understood privacy?
[12:26:48] <Zharktas> private datasets are not visible in search
[12:27:05] <davidmiller> Zharktas: That' the behaviour I'm observing :)
[12:27:11] <davidmiller> Zharktas: Is that by design?
[12:27:16] <davidmiller> If so, how come?
[12:27:53] <Zharktas> at least they aren't in our ckan, but i do not know the reasoning behind it
[12:29:09] <Zharktas> i think i saw some comment about complicating things with solr and that sort of thing
[12:29:14] <Zharktas> but don't remember where
[12:30:21] <wardi> Zharktas: yes, you should be able to see it from the organization, though
[12:31:55] <davidmiller> wardi: That's true !
[12:32:08] <davidmiller> wardi: But why is it that they don't show up in the main dataset search?
[12:32:20] <davidmiller> As a user, I totally expect them to.
[12:32:36] <wardi> constructing the query is nontrivial IIRC
[12:33:52] <davidmiller> wardi: That's entirely plausible :)
[12:34:42] <davidmiller> Technical details aside for a second, from a product/user perspective, I'd suggest that the "Right" behaviour would be to show private datasets that the user has permission to access from the main search - would you agree?
[12:34:51] <Zharktas> our client also wanted them to appear in search but when we looked in to it, it looked very complicated to implement without affecting query performance
[12:36:13] <wardi> davidmiller: I'd agree with that, as long as they clearly get marked as private
[12:36:54] <wardi> there is likely some clever solr thing we could be using to make it work and still be fast
[12:39:04] <davidmiller> so... this https://github.com/ckan/ckan/issues/1718 would be the relevant bug?
[12:42:15] <amercader> wardi, davidmiller, Zharktas: the logic for constructing the query required for getting the private datasets was complicated. It could be revisited if needed
[12:42:43] <amercader> davidmiller: resource search goes through a different route (db search) so there are probab;ly unrelated
[12:42:47] <wardi> davidmiller: that's related but not quite the same
[12:44:21] <amercader> for the general search you basically need: give me all public datasets and those privates which belong to these organizations I have read permissions on
[12:44:53] <amercader> it probably sounds easier than it would be
[12:44:53] <Zharktas> our client was happy with private datasets being in organization page iwth sorting them to the top, so we ended up not needing the implement it properly
[12:45:53] <davidmiller> amercader: that is the behaviour that our users expected to see :)
[12:46:18] <davidmiller> So, I have an instance with many, if not to say mostly private datasets.
[12:46:45] <davidmiller> There are also many organizations.
[12:47:02] <davidmiller> Which makes "Know what organization publishes the thing you're after" problematical.
[12:50:12] <davidmiller> I imagine this requires a non trivial patch and a subsequent release to fix ?
[12:51:01] <davidmiller> And there is going to be a maximum perfomance degradation threshgold for accepted patches? ;)
[12:51:25] <amercader> davidmiller: to get it on core yes, but you can most likely implement the whole logic in `before_search` in the meantime
[12:51:40] <amercader> on your extension I mean
[12:52:07] <amercader> I don't think it will have a huge performance hit
[12:52:59] <davidmiller> amercader: I had not internalised `before_search` :)
[12:53:51] <davidmiller> That looks like an excellent place to start - thanks!
[12:53:56] <amercader> davidmiller: it basically allows to change all parameters that are send to Solr, so you can play with the filters (fq) to allow privates + belonging to org x,y.,z
[12:54:52] <amercader> davidmiller: eg https://github.com/ckan/ckanext-spatial/blob/master/ckanext/spatial/plugin.py#L209
[12:56:00] <davidmiller> amercader: Awesome sauce.
[12:57:04] <amercader> davidmiller: you will also need something like this to get the orgs a user belongs to
[12:57:05] <amercader> https://github.com/ckan/ckan/blob/master/ckan/lib/helpers.py#L1441-L1443
[12:58:42] <seanh> I actually think it's better from the user's point of view not to show private datasets in the search
[12:59:12] <seanh> Private datasets only showing on the organization's page and never on group pages or in the global search etc makes it clearer what is private and who can see what
[12:59:47] <seanh> (Maybe private and public datasets should even be on their own tab on the organization's page - i.e. never mix private and public datasets together in the same list)
[13:00:00] <seanh> I suppose you can make arguments either way though
[13:00:58] <davidmiller> seanh: The users I talk to don't care about the semantics, they just want to access the data :)
[13:01:18] <davidmiller> seanh: && they are used to google being a magic search box ;)
[13:02:03] <seanh> But if we had a special tab for private datasets on the organization's page, that would give us somewhere to put some help text explaining that only members of this organization can see these datasets. I suppose the same help text could go as a tooltip on the "private" badge whenever the dataset is returned, and as a text next to the public/private field when creating/editing a dataset
[13:02:22] <amercader> seanh: I guess the key is the UI, to convey that the datasets are actually private and won't be there when you log out
[13:02:58] <seanh> Realistically we're all just randomly speculating about what users want and understand from CKAN, some actual user testing of some kind would be really useful I think
[13:03:45] <davidmiller> seanh: Realistically we're doing some - that's where this came from in the frist place :)
[13:03:51] <amercader> seanh: well davidmiller is providing some of this
[13:04:12] <amercader> another issue is whether if we trust him or not :p
[13:05:30] <davidmiller> amercader: :)
[13:05:55] <davidmiller> amercader: I can probably send you the formal user testing report once we have it
[13:44:53] <rgrp> what's github behaviour here - does general search turn up  your private repos?
[14:13:46] <rossjones> rgrp yes.
[14:13:58] <rossjones> if you have perms to see it.
[14:14:28] <rossjones> Not if you don't.
[14:16:21] <wardi> on github you probably won't be a member of hundreds of orgs. in ckan when you're an admin you might be
[14:16:40] <wardi> special case just the admin accounts?
[14:20:06] <davidmiller> wardi: not sure I follow either which way you're suggesting special casing admin accounts or why you would want to in the first place !
[14:21:47] <wardi> davidmiller: giant "OR" queries can't use indexes well so might be slow
[14:22:06] <rossjones> wardi I'm a member of 13 ... ;)
[14:23:01] <rossjones> davidmiller are you trying to get private datasets into the results (depending on the user)?
[14:25:05] <davidmiller> rossjones: I believe that the Right Thing To Do is for search results to cover all datasets that the currently logged in user has access to.
[14:25:19] <davidmiller> I have no comment on the performance implications of that.
[14:25:43] <rossjones> I agree.
[14:26:12] <wardi> as amercader says, it's an easy thing to try with a plugin to see if there is a performance issue or not
[14:27:01] <rossjones> Suspect the majority case is only people with access to more than a dozen orgs are admins, which can be special-cased.
[14:28:10] <seanh> I'm liking the new auth and validation decorators for action functions
[14:28:13] <davidmiller> wardi: I would not be surprised if a plugin to do just that appeared in the coming few weeks :)
[14:28:22] <wardi> davidmiller: awesome!
[14:28:44] <wardi> seanh: are those new?
[14:29:13] <seanh> I don't think understanding who can and can't see a private dataset is semantics that users don't care about btw, which is not to say that they necessarily do need to be hidden from the search page for users to understand it though
[14:29:45] <seanh> wardi: Well at least @auth_allow_anonymous_access and @validate are new-ish
[14:30:27] <wardi> oh. are these only in core (not in plugins.toolkit?)
[14:30:56] <seanh> Hmm, having said that allowing anon access to an extension api is not seeming to work

2014-09-23
[10:10:38] <rossjones> not sure what I'm doing wrong in trying to have a resource extra be a list :(
[10:14:46] <amercader> rossjones: you probably need to dump it as json and load it back when retrieving it?
[10:15:15] <rossjones> ah. good point.
[10:15:18] <rossjones> thanks amercader
[10:15:27] <rossjones> thought it might magically work ;)
[10:22:57] <seanh> wardi: What do you think about adding a web UI to ckanext-scheming, so that non-technical users can define and modify schemas?
[10:23:43] <seanh> Also, we may need to define "sub fields" where you have e.g. a "contact details" field with a "primary contact person" sub field which in turn has name, email and tel num sub fields
[10:24:18] <seanh> We also may need to handle "array" style fields, where you can have 0 or more contact poeople and the user can click on (+) and (-) buttons to add and delete them when editing a dataset
[10:24:36] <seanh> I think ckanext-scheming might be a good starting point for at least some of this
[10:25:42] <amercader> seanh: this sounds great
[10:26:08] <amercader> the subfields and arrays would be incredible useful for mapping dcat stuff (publishers, contact points, etc)
[10:26:32] <seanh> I'm just trying to spec it out for now, see basically how we might go about doing it and roughly how long it might take. We might potentially get some time to do it which would be fun
[10:26:56] <seanh> Yeah I saw that in dcat as well, and I do think dcat has that right (e.g. a dataset can have one or more authors etc)
[10:27:17] <amercader> and the UI would be a big win, although trying to not make it incredibly convoluted to support a million of options would be a challenge
[10:27:52] <seanh> That would be a big selling point feature, right? Define your own schemas with our simple web interface
[10:28:08] <amercader> seanh: absolutely, the dcat schema has been given much more thought that the ckan one. I think v4 api shoudl be mostly based on it
[10:29:14] <seanh> Yeah I thought dcat mostly had the schema right as well, when I read it. I don't like all the semantic web and foaf and owl ontology and so on but the fields themselves seemed good
[10:32:27] <amercader> seanh: I'm worrying about this stuff so you don't have to :) https://github.com/okfn/ckanext-sweden/blob/1-dcat-harvesting/ckanext/sweden/dcat/parsers.py#L63
[10:33:15] <amercader> I'll circulate this round when it's more stable and tested so people can chip in, would be good to have a good mapping dcat <-> ckan
[10:34:22] <seanh> Yeah
[10:34:50] <seanh> It'd be good to just have "CKAN is DCAT by default" one day, but I guess that'd be quite a breaking change
[10:38:27] <rossjones> amercader would you expect <input name="res_field[]"> <input name="res_field[]"> to work in CKAN?  Just gives me a unicode -> "Array".
[10:39:56] <rossjones> ignore me, it's out integration :(
[10:40:06] <rossjones> our
[10:46:57] <seanh> Hmm, need to get that scheming-support branch merged
[10:55:16] <amercader> seanh: I think that's me, feel free to jump in if you need it soon
[10:56:26] <seanh> It seems like adding a web UI for editing ckanext-scheming schemas would be fairly easy. We'd need to support storing schemas in the db instead of in JSON files, and then it's just a case of adding a UI for creating / deleting / editing them. It would take a long time I think but seems totally doable
[10:59:10] <seanh> amercader: If I do end up working on this I'll get it merged
[11:00:44] <amln> good lord. meeting info in /topic :P
[11:01:06] <amln> (even if i do need to expand my window)
[11:01:15] <seanh> The logging is cool
[11:02:04] <amln> irssi, screen, grep works for me (old dogs, new tricks)
[11:04:20] <amercader> seanh, wardi, joet, nigelb : https://plus.google.com/hangouts/_/event/cb1vmkss426lkqicj94a3amvd1c?authuser=0&hl=en-GB
[11:20:12] <amln> thanks hangout!
[12:11:51] <wardi> amercader: sorry, in traffic and couldn't attend
[13:38:42] <davidmiller> Is there an oauth endpoint plugin for CKAN ?
[13:38:53] <davidmiller> So I can e.g. log in with CKAN to $My_Cool_app ...
[13:51:26] <rgrp> davidmiller: no - but we'd love to have one
[13:51:30] <rgrp> not afaik

2014-09-22
[09:13:41] <mih> Hi, could anyone tell me when ckan 2.3 is going to be released?
[09:28:13] <amln> mih: I'm hoping before February.
[09:28:40] <amln> we're looking at 2.2.1 sooner, though.
[09:28:56] <mih> okay thanks!
[15:30:22] <travis-ci> [travis-ci] ckan/ckan 1768-organization-list ad06e52 http://travis-ci.org/ckan/ckan/builds/35945480 David Read: The build was broken.
[16:44:03] <travis-ci> [travis-ci] ckan/ckan 1768-organization-list b1a3c63 http://travis-ci.org/ckan/ckan/builds/35952494 David Read: The build was broken.

2014-09-21

2014-09-20

2014-09-19
[12:55:36] <wardi> thankfully it wasn't as close as it was for us in 1995.

2014-09-18
[17:16:01] <seanh> The action functions are generally not that useful for these reports, they're just gonna be too slow, you'd have to call too many of them to build up your data structure
[17:17:19] <seanh> You can get it from the db but querying that directly from an extension is bad and it also gets quite complicated because of CKAN's complex db structure, and ckan changes are likely to break your report, also you may construct slow db queries
[17:18:19] <seanh> But solr, it seems that pretty much if you can find a way to get want you want via solr queries then it's gonna be really fast and probably stable across ckan releases, and it's pretty flexible too. Custom schema stuff will be queryable as well. It's pretty good!
[17:24:03] <seanh> I guess I could use an IDatasetForm plugin here
[17:24:32] <seanh> So that when dictizing a resource, query my broken links table and add broken True or False to the resource dict
[17:28:45] <wardi> amercader2++
[17:29:03] <wardi> that looks like more than 10 minutes of work
[17:55:35] <seanh> So one thing is that whether a resource is broken or not isn't stored in the db or solr, it's computed at run time. It depends on config settings that say how many times in a row and for how long a link has to be done before it's marked as broken
[17:56:07] <seanh> So I should be able to change my config file, restart ckan, reload a page, and see a broken resource change to neutral or vice versa
[17:57:01] <seanh> There's a teeny python function that takes a dict representing a resource's link checker results: when it was checked and what the results were etc and takes those config settings and returns broken or not
[17:57:30] <seanh> It's pure Python and stdlib stuff: accessing a dict, comparing to None, int comparison, getting the time now, datetime comparison
[17:58:13] <seanh> So if a site has hundreds of thousands of resources, how long would it take to run such a Python function hundreds of thousands of times?
[17:58:25] <seanh> I'll try it next week, I'm betting/hoping that it's really fast

[09:19:25] <seanh> Hey - suggesting we move or cancel the dev meeting today. We have a compulsory meeting at Open Knowledge at the same time, so none of us will be able to make it
[09:19:47] <seanh> rossjones: wardi ^
[09:23:20] <seanh> Suggest we push it back by 3 hours
[09:45:41] <wardi> fine for me
[09:52:16] <rgrp> rossjones: does voting work for you on https://trello.com/b/kvgOZLMs/ckan-association-roadmap-consultation - just responded to your comment?
[09:52:24] <rgrp> wardi: are you able to vote on trello?
[09:54:33] <rossjones> rgrp I can
[09:54:36] <rossjones> and have
[09:54:46] <rgrp> excellent
[09:57:13] <seanh> wardi: Thanks, sorry for the late notice, we had to reschedule a meeting at the last second, out of our hands
[11:36:49] <wardi> rgrp: it seems that trello's voting resembles a "like" button. I feel like we need something more like "when should we work on this [ ] ASAP, [ ] soon, [ ] meh"
[11:41:37] <wardi> it works well enough for now, though
[13:59:37] <wardi> seanh: now?
[13:59:54] <seanh> I can do now
[14:00:10] <wardi> where's that link
[14:00:22] <seanh> amercader: joet nigelb
[14:02:10] <wardi> would someone post the hangout url?
[14:02:22] <amercader> https://plus.google.com/hangouts/_/event/cb1vmkss426lkqicj94a3amvd1c?authuser=0&hl=en-GB
[16:17:25] <amln> "Lots of glowing reviews for CKAN from the pen test team :-)"
[16:17:37] <amln> <3
[16:17:42] <amln> Yes, C-KAN.
[16:18:45] <wardi> amln: oh?
[16:33:25] <seanh> One of our clients has done a pen test of the site we made for them
[16:34:11] <seanh> I've got broken link reports showing on resource and dataset pages!
[16:34:35] <seanh> Now I just need to add the broken links by organization and by maintainer report pages, and then there's just polishing to do
[16:35:12] <seanh> I ended up adding status and reason to the reports as suggested, and I put "it has been down 75 times in a row since 1970" into the reports like DGU do
[16:35:23] <seanh> And also when it was last checked
[16:35:53] <seanh> We don't consider something broken until its been broken at least n times in a row over at least m hours though (but in that case we won't positively mark it as working either)
[16:37:19] <amercader> seanh, wardi: https://github.com/ckan/ckan/pull/1936
[16:37:34] <seanh> So now I need to figure out how to get a list of all organizations and their datasets and resources efficiently. It's probably going to be a direct db query
[16:37:35] <amercader> I think I need a shower after dealing with the stats plugin
[16:37:46] <amercader> but at least I think I've plugged the main leaks
[16:38:39] <seanh> I still think you should have deleted it, but I'm an extremist
[16:39:17] <amercader> seanh: this is for backporting, we can discuss delete it or mothball it on 2.3
[16:40:42] <amercader> seanh: If I need all orgs quickly I sometimes get them from the search, querying all datasets, faceting by org and rows = 0
[16:40:55] <seanh> Hmm, good tip
[16:40:59] <amercader> you only get the ids and the ones with datasets though
[16:41:04] <amercader> but maybe that's enough
[16:41:09] <amercader> it's really fast
[16:41:27] <seanh> That would give me all datasets by org I guess?
[16:41:27] <seanh> I would still need all the resource IDs for each dataset
[16:42:27] <seanh> There could be a way to cheat here: each time I save a new resource link check result, I could update fields (stored in additional custom db tables) counting the numbers of broken links for the resource's dataset and its org
[16:42:27] <amercader> what I suggested will only give you all orgs
[16:42:34] <seanh> But that's duplicating info though
[16:43:09] <amercader> how does the current qa extension does it?
[16:43:42] <seanh> Actually that wouldn't work for orgs, when datasets move between orgs
[16:43:51] <seanh> qa has massive sqlalchemy queries
[16:45:18] <amln> wardi: yeap, we had a site tested by a well-known company
[16:46:12] <seanh> Actually I think dgu's version of qa has been cleaned up a little, it still queries the db directly a bit but I don't see such massive queries with loads of joins
[16:46:18] <seanh> https://github.com/datagovuk/ckanext-qa/blob/2.0/ckanext/qa/reports.py
[16:46:58] <seanh> The okfn version, on the other hand: https://github.com/ckan/ckanext-qa/blob/master/ckanext/qa/reports.py#L159
[16:47:24] <seanh> Anyway, I guess I'll have to poke around for a while to see what's the best way. This is a task for Monday
[16:49:47] <seanh> amercader: We do have all the necessary info in solr, don't we? (resources, datasets and organizations)
[16:49:54] <seanh> I wonder if a complex solr query can do it
[16:50:03] <seanh> Or a solr query then some postprocessing in python
[16:50:18] <amercader> seanh: what do you need again?
[16:50:56] <seanh> I need a list of all orgs on the site (orgs with no datasets can be omitted), and for each org I need a list of its datasets, and for each dataset a list of its resources
[16:51:07] <seanh> Don't need full dicts for anything, just names or IDs will do
[16:51:32] <seanh> Though being able to have a few fields (name, title, logo) would be handy
[16:52:19] <amercader> seanh: but do you need it all in one go?
[16:52:40] <amercader> or can you do 3 separate queries
[16:53:07] <seanh> Well, in the end I need to show all that info on one page, so at some point I need to have it all in one big python list yeah. But if I have to do multiple searches or queries to get it that's fine
[16:53:43] <amercader> that's an insane list for a big site
[16:54:02] <seanh> Yeah
[16:54:16] <amln> i was having a play with current_package_list_with_resources the other day
[16:54:18] <seanh> I guess always including all the orgs is reasonable? No site should have thousands of orgs
[16:54:32] <seanh> But within each org I could cut it down to the first 100 or even the first 10 datasets
[16:54:51] <amercader> well, you can get the orgs with the facet trick I told you, and then it's just a matter of fq=owner_org:xxx
[16:54:56] <seanh> But I would still need the total number of datasets with broken resources and/or the total number of resources with broken links for each org, see
[16:55:54] <seanh> And each dataset in the search result will include a list of that dataset's resources, right?
[16:56:19] <seanh> Yeah it seems to
[16:57:39] <seanh> This is pretty good, so I can do one search to get all the orgs and then one search per org to get all its datasets and resources
[16:58:11] <seanh> Then all I need to do is compare resource IDs against my db table of broken resources to add up the numbers per dataset and per org
[16:58:31] <seanh> So it may be doable without touching the core model
[16:59:53] <amercader> seanh: you could store a field in the index for those datasets with broken links and then get them via search
[17:00:04] <amercader> but it might be difficult to keep up to date
[17:00:10] <seanh> amercader: To get the list of orgs I can just call organization_list though, that seems to be fast. So do I even need a solr trick for that?
[17:01:01] <seanh> Yeah, when it comes to building the report it would be better to have broken or not against the resource dict, but I think I want to avoid doing that because everywhere else it makes it worse
[17:02:44] <seanh> Ah, damn, organization_list returns names but the solr search for all datasets of an org needs an id!
[17:07:12] <seanh> We do have the package's organization's full dict in solr though, so if I can figure out the syntax for querying against a sub filed I should be able to do it
[17:08:15] <amercader2> seanh: I think you can do fq=organization:name in solr
[17:11:17] <seanh> amercader2: Yeah that seems to work actually :)
[17:11:22] <seanh> Not sure I get why what works
[17:11:37] <seanh> But I think this gives me exactly what I need and fastr
[17:13:54] <amercader2> yeah
[17:14:00] <amercader2> solr ftw
[17:14:32] <seanh> So for building all sorts of reports, I think solr is probabky better than the db
[17:15:15] <seanh> datasets with broken links by organization, datasets with broken links by maintainer, etc. There are lots of reports you might want (not just broken links stuff)

2014-09-17
[13:30:19] <wardi> you don't need to test the api controller, ckan already does that
[13:30:38] <wardi> oh, right, your service is calling back
[13:30:40] <seanh> The thing that's using RemoteCKAN is the link checker API client / cron job itself. I want it to be possible to run that on a different machine from where CKAN is installed, in production
[13:31:14] <seanh> Yeah, it's always the link checker service calling CKAN and never the other wau ro
[13:31:19] <seanh> way round (yet)
[13:32:48] <wardi> was thinking further about the general problem. and how I suggested auth could be handled by calling back to the ckanapi. Maybe that call back should happen only immediately before a job is going to be executed, that way the requestor has a chance to cancel by just saying 'yeah, not interested'
[13:33:05] <seanh> Seems good
[13:33:40] <seanh> I think you'd only need the auth for ad-hoc requests, ie. when the user clicks a button to tell ckan to ask a link checker to check these links now
[13:34:06] <seanh> So the link checker should do it asap anyway, but I guess it may have a queue if it's getting a lot of requests
[13:34:36] <wardi> or if the requester got restarted and no longer cares everything "just works" and jobs that will be ignored get cancelled first
[13:34:48] <seanh> Actually, is it really necessary to have cancelling jobs as a feature? That might just be an unnecessary complication on both ends
[13:35:11] <wardi> I'm saying it's not a new feature, it's just something we get free if we delay the call back
[13:36:06] <wardi> say we have a long running task that transforms data after it's uploaded and someone is repeatedly uploading new data
[13:36:35] <wardi> if the intermediate updates get dropped the jobs will complete faster
[13:36:44] <seanh> Ah right
[13:36:50] <seanh> Yeah that seems good then
[13:38:06] <seanh> The main question I'm still asking myself about a web service, is what's an easy way to implement it that's gonna minimize setup and maintenance for the user, given that it needs async and periodic tasks?
[13:38:07] <wardi> this is for when we have services that accept requests, of course
[13:39:09] <seanh> I'm still on flask and celery, but I wish there was something simpler, after all the need to setup celery for ckanext-qa was one of the big motivations for replacing it with an http microservice in the first place, it's no good if the microservice itself ends up being just as difficult to setup
[13:41:02] <seanh> Right now with a cron job, it's really easy to setup on both ends, but how to turn it into a web service without losing that?
[13:42:00] <wardi> twisted or tornado :-)
[13:43:59] <wardi> 1 process that listens on a socket, forks and monitors workers, schedules events, logs errors
[13:45:02] <seanh> Right
[13:45:41] <seanh> So twisted and tornado have async and periodic as features of the web framework itself, without any extra setup?
[13:45:51] <seanh> In that case they're the answer I think
[13:50:35] <wardi> yeah, and they aren't just web
[13:51:49] <seanh> I've never used either, but it'd be fun to learn
[14:32:38] <redShadow> seanh if you're interested, I'm testing my ckan client against a running instance of ckan, created on-the-fly via test fixtures.. https://github.com/opendatatrentino/ckan-api-client/
[14:33:56] <seanh> redShadow: How does your API client send requests to CKAN, does it use the requests lib?
[14:35:20] <redShadow> seanh: yep
[14:35:34] <seanh> This is how I ended up doing my integration tests: https://github.com/seanh/ckanext-deadoralive/blob/master/integration_tests.py
[14:35:36] <redShadow> everybody uses requests nowdays :P
[14:35:51] <seanh> redShadow: And how do your tests run CKAN, paster serve?
[14:36:16] <redShadow> seanh: yes IIRC, in a multiprocess
[14:36:18] <redShadow> let me check
[14:36:50] <seanh> To be fiar, the whole mock a url with httpretty, forward it to a webtest app, then translate the response back to httpretty, is only ~20 lines of code, it's not too bad
[14:37:14] <wardi> seanh: mocking is probably better anyway
[14:37:28] <redShadow> seanh: no, subprocess: more isolation == safer
[14:37:35] <wardi> I would test each side separately
[14:38:27] <redShadow> seanh: wardi: the problem is, I found too many unexpected / strange behaviors in ckan, so I decided the most reliable way was not mocking anything
[14:38:31] <seanh> I do mostly test them separately but I need at least some integration tests. The protocol between the two is still in flux and I need to be able to change it. Also my simple integration tests found two bugs that my unit tests of both sides didn't :)
[14:39:11] <wardi> oh, that's good
[14:39:21] <seanh> Hmm, redShadow so if it works for you with subprocess then it may have been paster that was my problem. Or httpretty
[14:40:06] <redShadow> yeah, IMHO integration test is really important, especially with software that is not 100% well-behaved..
[14:41:16] <redShadow> seanh: a broken pipe is caused by a generic SIGPIPE received by the application, and might not indicate an error.. you should check why you're getting that
[14:41:39] <seanh> I really doubt it's worth the trouble
[14:41:47] <wardi> paster serve has those errors when clients drop the connection
[14:42:32] <redShadow> usually a SIGPIPE is sent when the application getting the input from python closes the file stdin descriptor
[14:42:41] <redShadow> *stdin file descriptor
[14:43:17] <redShadow> I guess it's the same for sockets getting closed on the client side before the response was fully sent
[14:43:26] <seanh> And in this case the thing receiving the input is the requests lib
[14:43:37] <redShadow> (eg. if you do a get(..., stream=True) and then don't read the body..)
[14:43:59] <seanh> And apparently it randomly closes the file descriptor for different requests, intermittently, but only when my tests are running it and never when the app is run manually
[14:44:18] <redShadow> -> maybe even with HEADs, if they fallback on an interrupted GET..
[14:44:22] <seanh> That is not likely to be easy to get to the bottom of or to fix imo
[14:44:34] <wardi> seanh: did you check if urllib2.urlopen is any different?
[14:44:46] <seanh> No I didn't get round to checking that
[14:45:09] <seanh> I guess we can rule out paster as the problem, since it works fine when running manually
[14:45:22] <seanh> And we can rule out ckanapi and requests for the same reason
[14:45:42] <seanh> I wonder if httpretty is messing with things when it shouldn't
[14:47:22] <seanh> I was using httpretty in the tests to mock some URLs (not the 127.0.0.1:5000 URLs that CKAN was running on)
[14:47:33] <wardi> paster might not work normally when run in the background in travis. There might be something funny about the tty that it provides
[14:47:45] <seanh> I suppose I could have easily ruled that out by commenting it out, but I've completely changed the code now
[14:49:26] <wardi> could use some other wsgi thing to run ckan
[14:49:56] <seanh> Hmm, now I seem to have a problem, my integration test fails on Python 2.6 with "bad status line" but passes on 2.7!
[14:50:57] <seanh> All it's doing when it fails is factories.Resource() though, nothing to do with my request forwarding stuff
[15:01:56] * seanh Removes Python 2.6 support
[15:06:17] <wardi> :-(
[15:15:37] <amln> `/win 19
[16:40:25] <seanh> Anyone know why rebuild_db() is giving me a "cannot delete <table defined in my extension> because it does not exist" error from sqlalchemy?
[16:40:43] <seanh> Be nice if it wouldn't try to delete tables that don't exist yet
[16:43:13] <seanh> The funny thing is I put a line that creates the db table immediately before the reset_db(), and it still complains that it can't delete the table because it doesn't exist :/
[16:47:44] <seanh> Ah wait, no doing that does fix it
[16:55:59] <poguez_> Hey guys, here Noe
[16:56:55] <poguez_> I'm currently working in an extension to provide widgets to embed dataset
[16:57:01] * wardi waves
[16:57:32] <poguez_> I want to display the image of the organization
[16:58:03] <poguez_> but i think it is not correctly formated in the results dictionary of package_show?id=
[16:58:35] <poguez_> i think that the dictionary i get back dooesn't go through this formatting
[16:58:36] <poguez_> https://github.com/ckan/ckan/blob/b0ca98a14fce1d4f7f9578723cd9cd3150da5335/ckan/lib/dictization/model_dictize.py#L429-438
[17:00:15] <poguez_> https://github.com/ckan/ckan/blob/b0ca98a14fce1d4f7f9578723cd9cd3150da5335/ckan/lib/dictization/model_dictize.py#L249-259
[17:01:50] <joet> seanh we can probably change it have sqlalchemy execute a drop table if exists instead
[17:03:16] <poguez_> https://github.com/CodeandoMexico/ckanext-widgets/issues/13
[17:05:04] <seanh> joet: Would be safer
[17:05:15] <wardi> poguez_: that's odd. please report the issue on github.com/ckan/ckan
[17:05:52] <poguez_> sure wardi!
[17:10:18] <poguez_> now that i'm thinking about this
[17:10:29] <poguez_> that's why the organizations image is not correctly
[17:10:39] <poguez_> displayed in the dataset view
[17:11:01] <poguez_> http://catalogo.datos.gob.mx/dataset/poblacion-derechohabiente-adscrita-pda-en-el-imss
[17:11:24] <poguez_> http://datamx.io/dataset/los-municipios-de-sonora
[17:11:35] <poguez_> eventhought the image exist
[17:13:02] <poguez_> even though*
[17:19:48] <poguez_> https://github.com/ckan/ckan/issues/1934

[07:36:50] <seanh> wardi: Well the code is meant to work remotely as well so it's RemoteCKAN. I'm guessing ckanapi is just getting and posting to URLs using requests though? So I doubt this is ckanapi's fault
[07:37:19] <seanh> I can take a look at what it does though, maybe if I increase the timeout
[07:47:10] <rgrp> rossjones: hmmm ok - it used to be that anyone could vote but now only board members ...
[07:47:16] <rgrp> we'll have to add people to vote :-(
[07:47:28] <rgrp> wardi: anyone can vote ...
[07:49:09] <rgrp> wardi: i mean the intention is that anyone can vote ...
[07:49:32] <rgrp> rossjones: i've added you as member and made you an admin so you can add others ...
[07:49:51] <rgrp> i thought it used to be that for public boards anyone could vote but that seems to have changed
[08:07:39] <rossjones> rgrp cool. thanks.
[08:08:19] <rgrp> rossjones: will reply to your (good) quesiton on list but to echo wardi this was discussed at technical team meeting a few weeks ago and also included thoughts from SG members
[08:08:47] <rgrp> as I said not final and stuff can get proposed but aim as already to have a long-list of top priority items
[08:09:29] <rossjones> Would be good if non-technical users could add some, although I guess a lot may not make sense.  Also added wrong rossjones, I have too many accounts :(
[08:09:47] <rossjones> Added a comment to the want-to-vote ticket
[08:10:26] <rossjones> And presumably people can add anything they want here that may not be in the other repo?
[08:31:55] <rossjones> rgrp - https://twitter.com/datagouvfr/status/512154773748199424 - didn't manage to disuade them?
[08:52:36] <rossjones> thanks rgrp, trello down for maintenance now ... typical.
[08:54:23] <seanh> nigelb: What's the status of ckanext-searchhistory? Finished? Production ready?
[09:06:14] <nigelb> seanh: yep, in production on satellites
[09:06:23] <nigelb> it doesn't do much by itself other than provide the api.
[09:06:43] <nigelb> You need to do the frontend work in your plugin.
[09:26:46] <seanh> This morning the errors that I'm getting have changed (for no apparent reason). I'm getting a lot of CKANAPIError: ['http://127.0.0.1:5000/api/action/ckanext_deadoralive_get_resources_to_check', 200, u'']. (On different API actions each time I run the test - sometimes core ones). Sometime there'll be a "broken pipe" over in the CKAN terminal, sometimes not. Sometimes there is no error and it runs fine! So I think there's a race somewhere
[09:45:33] <seanh> The problem seems to originate here: https://github.com/ckan/ckanapi/blob/master/ckanapi/remoteckan.py#L85
[09:45:54] <seanh> remoteckan.py does a simple requests.post() and returns the status_code and text from the response
[09:46:01] <seanh> Usually the text is the JSON test from CKAN
[09:46:09] <seanh> But sometimes it's an empty string
[09:46:39] <seanh> And like I said the empty string seems to strike randomly on any CKAN API call, or sometimes or None of them and the test completes fine
[09:46:55] <seanh> I don't think it's a timeout issue either - sounds like requests default timeout is forever
[09:47:09] <seanh> It appears to be a problem with requests and/or paster
[09:48:40] <amln> seanh: are you using local ckan? just thinking sentry's on demo.ckan; might be some info in there.
[09:50:17] <seanh> The weird thing is that it seems to work just fine when code outside of my tests uses ckanapi in exactly the same way
[09:50:45] <seanh> Right now I'm running CKAN with paster serve and running a ckanapi script against it that creates hundreds of random resources one after the other - no problem at all
[09:50:58] <wardi> seanh: has the server not started yet?
[09:51:38] <seanh> Server is definitely started - i'm starting it in a terminal and giving it plenty of time (also sometimes the first few api calls succeed and then a later one randomly fails)
[09:51:46] <seanh> I wonder if there's something in test.ini? ...
[09:52:12] <wardi> check out the remoteckan tests, i had to do a lot of work to avoid this kind of thing even with my fake ckan used for testing
[09:52:35] <wardi> hmm
[09:53:20] <wardi> an empty string like that means the server just closed the connection
[09:54:05] <wardi> might be good to have a separate exception for that
[09:59:52] <seanh> What do you mean it just closed the connection? Requests is still returning a response with status_code 200
[10:00:06] <seanh> It seems to me like CKAN sent back an HTTP 200 response with no body
[10:00:29] <seanh> But this is sometimes happening with actions like user_create that definitely do have a body, so it's weird
[10:04:15] <rossjones> Is it just me, or is it confusing that IDomainObjectModification gets sent 'changed' when you delete a dataset, instead of 'deleted'?
[10:06:16] <rossjones> Do I *really* need to go to the DB again and see if the state field has changed? :*(
[10:11:36] <rossjones> And I can't go to the DB again because of sqlalchemy sessions which just returns me the new cached object.  Need to create a new DB session.  Time for a long walk ....
[10:11:39] <seanh> It's because it's just marked as deleted, not actually deleted from the db?
[10:11:50] <rossjones> seanh sure.
[10:12:02] <rossjones> but how do you tell it has been deleted.
[10:12:07] <rossjones> sorry, 'deleted'
[10:12:22] <seanh> Depending on exactly what you're trying to do, you might find it easier to hook into the activity streams
[10:12:33] <seanh> You could also look into wtf the activity
[10:12:33] <rossjones> Can't see how IDomainObjectModification can get the old value to compare.
[10:12:46] <seanh> streams session extension does, to detect deleted packages
[10:12:48] <rossjones> seanh I want to know when someone deletes a dataset so I can notify specific users.
[10:13:01] <seanh> There are deleted dataset activities
[10:13:32] <rossjones> Can I hook into those to do some random task?
[10:13:34] <seanh> You could poll for them. I don't think there's any "call my plugin's function when a certain type of activity happens" hook or plugin interface, but you could add one easily
[10:14:17] <seanh> I believe activity_create will (eventually) get called with a deleted package activity, so in that logic function you could make it call a plugin function
[10:14:39] <seanh> This would be a CKAN core change, or you could do it by using IActions to override activity_create
[10:15:09] <seanh> The activities stuff that listens to sqlalchemy to detect different kinds of changes is complicated code, but it's heavily tested, so leaning on it might be a good idea
[10:15:20] <morty> rossjones: doesn't the second arg tell you it's been deleted?
[10:15:44] <rossjones> morty no, it says changed (because the state field changing to 'deleted' is the deletion).
[10:16:17] <rossjones> domain_object.DomainObjectOperation.deleted is only for real DB deletions, not soft deletes.
[10:16:24] <morty> rossjones: Oh, OK. Not deleted from DB, just CKAN
[10:17:03] <morty> rossjones: did you see my modification that's just been merged?
[10:17:25] <morty> rossjones: you could listen for changed after commit and if the object is soft deleted you can assume it's just been deleted?
[10:17:52] <rossjones> morty got a linky?
[10:18:22] <morty> rossjones: https://github.com/ckan/ckan/pull/1855
[10:19:20] <rossjones> morty I can't wait for 2.3 :( We don't maintain our own fork/branch. We're just using vanilla ckan.
[10:20:24] <joet> haha, brilliant. wardi I was about to reply to that guy about not using python string formatting and passing it as raw sql query, then I looked through the history and we do the same
[10:21:07] <morty> rossjones: just use HEAD, like Django in the 0.9X days
[10:21:56] <seanh> morty: That's exactly what the core activity streams code does: https://github.com/ckan/ckan/blob/master/ckan/model/package.py#L543
[10:22:20] <seanh> (If it gets a "changed" package and the package's state is "deleted" it reads that as a "deleted" package0
[10:24:33] <seanh> So if I integration test my CKAN extension just manually it works fine - I can link check 200 links, some uploaded files some bad URLs. Run the same code from a nose test and I get all this intermittent empty responses and broken pipes nonsense
[10:24:59] <seanh> I think it might be time to walk away from this one, and try my other plan of using httpretty to forward requests to a test app.
[10:25:11] <morty> rossjones: you might not need to use the new hook, it was a special case where the operation was kicking off a celery job which was getting the object from the DB before it had been committed.
[10:25:27] <seanh> This just smells of something going wrong inside Python's networking code, requests, httpretty or paster or (worse) some interaction between them
[10:25:47] <morty> rossjones: and we didn't want to pass the information directly to Celery
[10:32:54] <travis-ci> [travis-ci] ckan/ckan 1804-config-file-tool ee578e4 http://travis-ci.org/ckan/ckan/builds/35521578 David Read: The build was broken.
[12:15:27] <rossjones> morty implemented packagecontroller delete method now.
[12:47:55] <amercader> seanh, trickvi: see my email to ckan-dev regarding the resource plugin interfaces. I think it might affect the datapackager
[13:11:12] <seanh> So what I'm doing for my integration tests is:
[13:11:24] <seanh> Test code calls my CKAN API client
[13:11:37] <seanh> The client really posts to a real URL, using the requests lib
[13:11:57] <seanh> I've mocked that URL using HTTPretty, so the post winds up in a function in my test code
[13:12:41] <seanh> I take the post's URL, headers, body etc and translate them into params that are compatible with webtest, make a method call on a webtest test app of CKAN and get a webtest response object back
[13:13:09] <seanh> I then translate the attributes of that response object into an HTTP response that's compatible with httpretty and requests and return it
[13:13:36] <seanh> So my API client code that I'm testing gets a requests lib response object back, and has no idea that it went via httpretty and webtest!
[13:13:42] <seanh> Amazingly this seems to be working
[13:14:08] <ScraperDragon> :D
[13:15:18] <seanh> amercader: DataPackager isn't using any resource plugin interface, if that's what you mean
[13:15:45] <seanh> It overrides the resource controller and replaces the whole resource preview and editing parts of the controller and templates
[13:15:58] <amercader> seanh: the link to the source code on my email seems to suggest otherwise
[13:16:42] <seanh> Ah
[13:16:53] <amercader> ok I saw trickvi's answer, it does use a custom interface on  a separate branch
[13:16:55] <amercader> boo
[13:16:59] <seanh> Did we add a new "after a resource file is uploaded" hook to CKAN?
[13:17:14] <amercader> it's not in master
[13:17:33] <amercader> we can pick it from the datapackager branch
[13:17:38] <seanh> Yeah, believe me we were working flatout on datapackager on the last day of development, and had to fight to keep our last few weeks of dev time, we did not have time to write CKAN core pull requests and get them merged
[13:18:09] <amercader> seanh: totally understand
[13:18:23] <seanh> There's a ton of improvements and fixes that could be merged into core in the datapackager, if there was time
[13:18:51] <amercader> seanh: we can look for this time
[13:19:19] <amercader> it would make sense to make datapackaer target master/2.3
[13:19:55] <seanh> Sure
[13:21:02] <seanh> I question how useful datapackagers features actually are (how actually wants or needs a web app for creating tabular data packages?) so not sure if we do want to spend time bringing those features to CKAN
[13:21:33] <seanh> But there are lots of things on that branch and in ckanext-datapackager that are just fixing or working around broken things in CKAN, those could be merged in if we had the time for sure
[13:23:24] <wardi> seanh: you can replace https://github.com/ckan/ckanapi/blob/master/ckanapi/remoteckan.py#L85 with a call to urllib2.urlopen if you want to see if requests is the problem
[13:24:05] <wardi> (that's what older ckanapi versions had)
[13:29:45] <seanh> wardi: I just got my test to pass by using my crazy httpretty and webtest thing!  But if I have some extra time later I can see if that works
[13:30:01] <wardi> but I still don't understand why you can't use LocalCKAN

2014-09-16
[11:01:11] <wardi> https://plus.google.com/hangouts/_/event/cb1vmkss426lkqicj94a3amvd1c?authuser=0&hl=en-GB
[11:04:04] <wardi> seanh: ^
[11:04:26] <amercader> nigelb , vitorbaptista ^
[11:10:59] <nigelb> on another call :(
[12:59:25] <acorbi> Hi everybody. one quick question: im an using the action api to upload a geojson file as resource to a dataset. AS i read from the docs, the upload attribute of the call has to be set to the path to the local url. But then there is also the url parameter which is mandatory. By doing this, i can add the resource to the dataset but does not appear as uploaded but linked.
[13:19:20] <seanh> Anyone know how I can integration test my deadoralive api client with my ckanext-deadoralive extension?
[13:19:43] <seanh> Basically the extension adds 3 API actions that the API client uses
[13:20:17] <seanh> The client takes the base URL of a CKAN site and an API key as config, and it uses requests to post to the URLs and expects the right results back
[13:20:57] <seanh> I need to somehow hook it up in my tests so that when requests posts to those URLs, that's actually gonna go through the extension's routing definitions and call the extension's action functions
[13:31:49] <seanh> I guess I can use httpretty to mock the URLs? That lets you define a function in your test code that gets called whenever requests (or anything else) requests the mocked URL. Then in that function, I can pass the request on to the same URL but on a CKAN webtests test app
[13:36:51] <wardi> seanh: why not actually run ckan and install your plugin?
[13:37:25] <seanh> Is that gonna work on Travis?
[13:37:31] <seanh> It should work locally, yeah
[13:37:37] <seanh> It's a start
[13:38:04] <wardi> acorbi: i think it's either-or. use the upload or the url not both
[13:55:06] <wardi> seanh: https://github.com/open-data/ckanext-scheming/pull/1/files
[13:55:34] <wardi> I can probably trim the .ini further
[13:59:59] <seanh> wardi: Sorry, is that actually running CKAN on Travis, so an extension is making requests to URLs that go to a CKAN instance?
[14:00:22] <seanh> I know extensions that just need to import CKAN or whatever can run on Travis..
[14:01:09] <wardi> that's running ckan on travis with my extension installed
[14:02:42] <seanh> I don't see where it runs CKAN?
[14:03:41] <wardi> oh, right, there's no runserver in there.
[14:08:26] <wardi> A "paster serve ckanext/scheming/tests/test.ini >/dev/null 2>&1 &" at the end of the install should work, no?
[14:12:31] <seanh> Dunno, but I could try it
[15:29:35] <acorbi> Hi everybody. one quick question: im an using the action api to upload a geojson file as resource to a dataset. AS i read from the docs, the upload attribute of the call has to be set to the path to the local url. But then there is also the url parameter which is mandatory. By doing this, i can add the resource to the dataset but does not appear as uploaded but linked.
[15:31:08] <acorbi> (using the action API)
[15:40:41] <acorbi> Ok, i solved it
[15:41:09] <acorbi> needed to use the requests library as specified in the docs. I was trying to achieve it with the action api
[16:19:51] <seanh> Arg, getting "broke pipe" from CKAN / Python when running my API client against it in integration tests
[16:24:04] <seanh> It seems to happen on a different line of code each time I run the tests too, some sort of race condition
[16:25:58] <seanh> Maybe time to call it a day
[16:35:03] <wardi> does your client disconnect before receiving all the data?
[16:43:56] <seanh> It's using ckanapi :)
[16:44:26] <seanh> I might go back to trying my httpretty and test app approach to get around this
[16:45:46] <seanh> If I keep running the tests, it gets a broken pipe on a different api call each time, sometimes the first few work. So this seems complicated and may have something to do with paster
[16:57:32] <wardi> seanh: hmm. if it's local why not use LocalCKAN?
[16:57:52] <wardi> but if ckanapi is causing broken pipe errors on the server that would be nice to fix
[17:31:57] <rgrp> hi all - about to push the roadmap post to general ckan list
[17:32:04] <rgrp> there is a trello board here https://trello.com/b/kvgOZLMs/ckan-association-roadmap-consultation
[17:32:35] <rgrp> i've done my best to add usernames i could find - ping me (or wardi or amercader who are admins) if you'd like to be added
[17:38:46] <wardi> rgrp: did you find a way to make contributing to the board by anyone possible? I thought that was the big problem with using trello for ideas/roadmap before
[17:39:11] <rgrp> wardi: the point here is *not* to have new items suggested but commenting and voting on the long-list ...
[17:39:17] <wardi> oh, so voting works for anyone
[17:39:27] <rgrp> *exactly* ...
[17:39:36] <rgrp> anyone who is logged in can vote (which is a feature not a bug ...)
[18:25:46] <rossjones> rgrp voting doesn't work.
[18:26:19] <rossjones> rgrp i.e. I logged in to the new roadmap, no way to vote.
[18:26:25] <rossjones> is it for association members only?
[18:56:12] <wardi> rossjones: I thought the point was for everyone to vote
[18:58:22] <wardi> the steering group may be informed by the results, but IIUC it's not binding in any way
[19:04:05] <wardi> rossjones: the technical team was invited to add items to this list at the Aug 26th and 28th meetings

2014-09-15
[09:56:22] <davidmiller> rgrp: Yeah, turns out I'm building the exact same thing :0
[09:57:17] <davidmiller> My wip was this: http://davidmiller.github.io/omg-sql/
[11:14:35] <rgrp> davidmiller: patches welcome ;-)
[11:14:59] <rgrp> there's a lot one could od ...
[12:11:38] <wardi> if you both thought to build it, must be a good idea
[13:28:47] <rossjones> find a bug, go to report it, find joet has fixed it 2 hours ago :)
[13:30:34] <joet> rossjones,  think I did the same thing last week where wardi/dread had already fixed it in master
[13:30:42] <wardi> rossjones: better than spend hours finding a bug, reporting it, fixing it, then find out kindly had fixed it on a long-running branch months ago that was slated to be merged first :-)
[13:31:26] <rossjones> wardi if the branch was months old it probably was unmergable no?
[13:31:44] <wardi> no, it was a big planned feature
[13:31:47] <rossjones> ah ok.
[13:31:59] <rossjones> joet will it be backported? or do you only do that for critical bugs?
[13:32:17] <joet> which bug is this?
[13:32:41] <rossjones> the add member with non-existent user. lose all context for the page (group_dict etc).
[13:32:53] <wardi> rossjones: it was one of those "oh, I must be working on ckan" bugs too
[13:32:55] <rossjones> https://github.com/joetsoi/ckan/commit/603fed041acd30fc3697e80f7ae3f4bae390be13
[13:33:02] <rossjones> wardi hehehe
[13:33:39] <joet> oh right no idea yet, need to make the pr for that one
[13:33:41] <rossjones> hopefully after our launch this month I can submit all my monkey patches as proper PRs
[13:34:43] <joet> i'm sort of in the middle of removing any references to pylons c object in that one
[13:37:55] <joet> considering going full seanh on it and isolating all the moving parts etc
[13:38:28] <wardi> :-)
[13:38:32] <rossjones> hehehe
[13:39:23] <joet> but i suspect that single commit would be more acceptable to backport which is why i pushed it first
[15:47:22] <seanh> Why am I getting import ckanext.deadoralive.plugin as plugin AttributeError: 'module' object has no attribute 'plugin'?, ckanext/deadoralive/plugin.py is right there
[15:54:05] <rossjones> __init__.py?
[15:54:50] <seanh> I have them
[16:00:35] <seanh> Oh, circular import?
[16:15:53] <seanh> Yep it was a cirular import, tricky
[16:17:39] <seanh> Hmm, is it me or can you not pass CKAN config params to action functions implemented by extensions?
[16:18:12] <seanh> You're supposed to implement IConfigurable, CKAN calls your plugin class's configure() method and pass you the config object, you can save your custom settings against your plugin class
[16:18:15] <wardi> seanh: you can store things in your plugins and iterate over the plugins to find them
[16:18:24] <seanh> Eww
[16:18:35] <seanh> I can read pylons.config directly as well
[16:18:38] <wardi> or hack it like I do in scheming, store the instance as a class variable
[16:18:38] <seanh> Which is worse?
[16:19:08] <wardi> then MyPluginClass.instance.config_stuff ...
[16:19:23] <seanh> I can't do that from my action function or I get a circular import
[16:19:34] <seanh> If I moved all my action functions into plugin.py it would work
[16:19:52] <wardi> I didn't want to read the config again because my setup requires some parsing (time)
[16:20:05] <wardi> seanh: what, with globals?
[16:20:30] <wardi> you could also define your action functions as methods on your plugin
[16:20:49] <wardi> then you have self.whatever
[16:21:28] <wardi> it makes the function signature look different for documentation purposes, but that's not such a big deal
[16:21:34] <seanh> ckanext.deadoralive.plugin.py imports ckanext.deadoralive.logic.action.get.py so it can return the action functions in get_actions(). But that means get.py can't import plugin.py, and there doesn't seem to be any way for plugin.py to pass config settings into get.py
[16:21:47] <seanh> Actions as methods on plugin class doesn't work
[16:21:59] <wardi> seanh: why not?
[16:22:04] <seanh> AttributeError: 'instancemethod' object has no attribute 'auth_audit_exempt'
[16:22:22] <wardi> oh, because our code is crazy
[16:22:27] <seanh> Something in CKAN's get_action()
[16:22:40] <seanh> Another unexpected consequence of that cleverness, looks like
[16:22:48] <wardi> I use the side_effect_free decorator, I think it might take care of that
[16:23:03] <seanh> I think I'm just gonna write a config.py in my extension that reads config settings from pylons.config on command
[16:24:33] <seanh> Or I do the class attribute thing and move my action functions into plugin.py
[16:24:40] <seanh> Maybe I'll just do that actually
[16:34:59] <seanh> wardi: Wouldn't a module-level global be simpler than a class attribute?
[16:35:34] <wardi> seanh: in my case I had three plugins, so it was easier to do class variables
[16:36:25] <wardi> you can get around import cycles by havig a config module where you stick the configuration settings
[16:42:20] <seanh> As in the plugin's configure() method would assign values to attributes on the config module?
[16:42:38] <seanh> Yeah I guess that'd work and let me split things up into separate files
[16:56:58] <wardi> seanh: looks like the auth_audit_exempt AttributeError was fixed in 2.2..
[16:57:14] <seanh> Well it's broken again in master then!
[16:58:09] <wardi> seanh: traceback?
[17:00:20] <seanh> wardi: https://github.com/ckan/ckan/issues/1930
[17:02:03] <wardi> seanh: oh. that's an interesting python inconsistency
[17:02:32] <wardi> if you use @side_effect_free or another decorator that returns a normal function it would work fine
[17:07:37] <seanh> Ah

2014-09-14

2014-09-13
[00:04:26] <eeeschwartz> IIRC POSTing to the resource_create API does not create a datastore entry, perhaps this is what the creator did?
[00:08:32] <eeeschwartz> Here's how I've been using the API to create a resource and enable it in the datastore fwiw: https://gist.github.com/eeeschwartz/353eacdf6cb3199c14ad
[00:19:25] <SkramX> I uploaded the file using the web UI and on my ckan instance it auto-inserts to the datastore from the file
[01:01:35] <wardi> eeeschwartz: yikes. that sleep is necessary?
[13:21:34] <rgrp> davidmiller: btw if you are using ckan.js for sql querying and like you may be interested in http://dev.rufuspollock.org/ckan-explorer/ plus its source code https://github.com/rgrp/ckan-explorer

2014-09-12
[23:53:58] <eeeschwartz> SkramX:
[23:54:16] <eeeschwartz> SkramX: http://datahub.io/api/util/status - it does appear to have datastore enabled

[10:13:11] <amln> !seen dread
[10:16:30] <rossjones> amln if you're after dread, I suggest taking a look at the stats plugin.
[11:30:37] <wardi> anyone here remember CEPs? why were they abandoned?
[11:32:24] <rossjones> wardi think they were actually called CREPs
[11:32:48] <rossjones> they were, if I recall correctly, just stored in trac as issues.
[11:32:55] <rossjones> Here you go - http://trac.ckan.org/ticket/1127.html
[11:33:36] <rossjones> Oh, my bad - https://github.com/okfn/ckan-old/tree/master/doc/cep
[11:37:30] <rossjones> wardi not sure it will add more than the ideas-and-roadmap repo tbh, other than fleshing out the ideas in a single document.  May as well use the Wiki at https://github.com/ckan/ideas-and-roadmap/
[11:38:46] <seanh> Isn't this exactly what ideas-and-roadmap issues are for? Yeah
[11:38:59] <seanh> Maybe what we need is a new Trello board? Or a new google doc about it
[11:41:01] <wardi> yeah, this seems like something we could do with wiki pages if the comments on an idea go too long
[11:41:50] <seanh> We were doing specs as wiki pages for a while
[11:42:03] <seanh> (There's a few on the wiki, some of them were actually developed!)
[11:42:10] <wardi> i don't see tons of people clamouring to make deep core changes as a big problem atm
[11:45:39] <seanh> At one point I wanted to have a specs dir in the ckan git repo, containing text files with specs for features. Then you'd sbumit one as a pull request and people could comment on it, and you could see on the pr page how the spec and then the implementation developed as the conversation went on
[11:45:48] <seanh> People didn't like specs being in git though
[11:46:18] <seanh> I'm surprised to realise how hard it is to produce reports such as "number of resources with broken links, grouped by organisation"
[11:46:36] <seanh> ckanext-qa does it with some massive sqlalchemy queries: https://github.com/ckan/ckanext-qa/blob/master/ckanext/qa/reports.py#L164
[11:46:43] <seanh> That doesn't even look like it should work
[11:47:48] <seanh> Trying to figure out how an extension can produce a report like that in a "good" way that isn't likely to break on future CKAN versions, isn't tied to closely to details of CKAN's database model
[12:02:18] <rossjones> seanh I think the problem is that you probably shouldn't ever use an ORM to generate reports, you use use SQL directly - problem being that CKAN doesn't cleanly lend itself to that atm because of the join/member/revision madness.
[12:09:05] <seanh> Why not use an orm? Doing a complicated query in sqlalchemy seems equivalent to doing one in raw sql to me
[12:10:12] <seanh> I just think ckan's database structure is really complicated and untrustworthy. And we also have things like private datasets that we want to omit from reports - but what defines a private dataset? I wouldn't want an extension providing its own answer to that based on the db
[12:10:27] <rossjones> you have to be very aware of exactly where joins/unions etc are happening.
[12:10:42] <seanh> So I think extensions should be built on top of the CKAN API because that's the part that's (supposed to be) stable
[12:10:56] <rossjones> I think some of them should just be in core.
[12:11:08] <seanh> The problem is, there's probably no API actions that can provide that answer, or they might be very slow
[12:12:03] <seanh> Yeah. If I can get just the minimum info I need from CKAN core efficiently somehow, then I can do the combining/grouping/counting things in memory in Python
[12:12:44] <seanh> If I could get say a list of all the public resources and the dataset id and organization id for each, for example. Something like that.
[12:13:57] <seanh> Given that core probably doesn't have a fast way to get that, I think the best thing an extension can do is add its own action function to get it, so it does access CKAN's model but as little as possible, and then build its reports on top of that in Python. You could then try to get your action function into core maybe, but even if you can't at least it's minimal
[12:19:36] <seanh> Yeah just having a carefully constructed sql query in core would work as well I guess - as long as it had tests. You could put such a query in your extension with tests as well I guess, next best thing
[12:21:09] <wardi> link checking would be nice as a core feature. Most sites would want it
[12:37:56] <seanh> What about link checkers and private resources?
[12:39:49] <rossjones> Maybe a DGU like 'Check this link' button when you add it?
[12:40:28] <rossjones> Was trying to persuade dread to not allow adding a resource until the link is verified as alive - doesn't help long term but might stop people adding broken links straight away
[12:42:03] <seanh> I have code that gets all the resource IDs of a CKAN site (from the db directly - CKAN has no resource_list())
[12:42:13] <seanh> Currently it'll return IDs of private resources as well
[12:42:31] <rossjones> seanh that's okay though isn't it? it isn't leaking data anywhere.
[12:42:41] <rossjones> s/data/information/
[12:42:53] <seanh> Well, it's leaking the IDs of private resources to link checker processes, that's all
[12:43:18] <seanh> The link checkers will fail when they try to resource_show() it, unless they're running with an API key that has access to the resource
[12:43:29] <seanh> Which I don't think they should be
[12:43:54] <seanh> It's okay I guess, filtering out the private resources in the first place would be better but might be hard to do
[12:44:18] <seanh> I can imagine use-cases for being able to see link reports in private datasets as well, but it complicates the implementation
[18:16:12] <rossjones> Nice feedback on that ticket seanh - I'm *still* reading through it :)
[18:50:18] <seanh> rossjones: Thanks, yeah it got a bit out of hand, I have more thoughts on the whole concept as well but I'll hold back for now!
[21:05:19] <SkramX> does datahub.io have datastore enabled?
[21:08:33] <SkramX> ** how do i enable the data API for a CSV on there.
[21:58:42] <SkramX> (http://datahub.io/dataset/510k-clearance-data)

2014-09-11
[15:52:33] <seanh> I think I might just do: When creating a new link check result in the db, also delete any results older than 1 week (configurable)
[15:53:03] <seanh> This way I don't need foreign keys or delete cascading, I know the db table can never get too big

[07:39:09] <JuL> hey there, I have a simple, stupid question probably, but I can't seem to find my way around just reading the doc
[07:44:35] <JuL> I am a sysadmin, not so familiar with CKAN. I have to put in production a stack that is using, among other things CKAN. I have installed it on the new server (a Debian), edited the dev conf, copied the postgres DB and stuff under /var/lib/ckan/ . On the new CKAN I can see some 'Organizations' for instance but I can't see any datasets.
[07:46:20] <JuL> Reading on the doc I found some ways to export DS to CSV or JSON (the rdf-export doesn't work on the dev server I'm picking the stuff from), but I can't find nowhere a "simple" way to just import them
[07:46:37] <JuL> have I missed something?
[08:00:06] <JuL> in short: is there a way to copy datasets from a CKAN instance to another?
[08:35:42] * JuL nevermind...
[09:47:31] <wardi> JuL: the ckanapi cli can copy datasets, as can the harvester
[10:06:06] <seanh> rossjones: Been thinking about this microservice thing some more
[10:06:57] <seanh> As far as I can think, the only thing that a microservice gives us that an api script running as a cron doesn't, is we can put a button for admins in the CKAN web interface for "run this QA/Harvest job again now"
[10:07:36] <seanh> So it should ultimately be a web service not a cron job, but I think that's quite a lot more work just go get the last 10% of the benefit
[10:08:50] <seanh> For my dead link checker, I'm gonna write it as a cron job first, I think that will be very instructive for how the web service should be designed. As long as the cron communicates with CKAN only via the API and can be run from a different machine from the one CKAN is installed on (so not a paster command), then the code can probably be wrapped in a web service later
[10:09:04] <rossjones> I think the benefit comes for data.gov and data.gov.uk where they have 10s of 000s of datasets to process. They can scale out their services in a way that cron jobs wouldn't really work.
[10:09:17] <rossjones> That sounds like a sensible approach
[10:09:36] <seanh> I can have 10 cron jobs on 10 servers each checking 1/10th of the datasets
[10:09:49] <rossjones> but then you have to distribute the work :)
[10:10:09] <rossjones> which 10% does machine D get?
[10:10:17] <seanh> I guess if you want to automate evenly balancing the work across N servers
[10:10:26] <seanh> Machine D gets the fourth 10%!
[10:10:57] <rossjones> There's either a lot of configuration or a lot of calculated consensus in that statement :)
[10:11:07] <rossjones> s/calculated/automated/
[10:11:07] <seanh> But you would actually need two web services then: One to distribute the work, and the other load-balanced one to actually do the work.
[10:11:25] <rossjones> it can just round-robin as list of services.
[10:11:32] <rossjones> Don't forget, unreliability is a key feature.
[10:11:35] <rossjones> No way, that's not right.
[10:11:45] <rossjones> But it sort of is.
[10:12:01] <rossjones> I reckon you're right for now, the smallest possible thing that can work.
[10:12:20] <rossjones> As long as everyones knows the SPTTCW won't work for everyone.
[10:13:20] <seanh> Load-balancing the work is gonna make it a lot harder I think
[10:13:49] <seanh> But yeah, let's see where this goes. To be honest, at Open Knowledge we don't really have the massive scale problem. We want simple and reliable
[10:14:22] <rossjones> For people with bigger more complicated systems, and lots of data, that's fine. For everyone just wanting a little-ish instance to use simpler=less-config=better
[10:15:51] <seanh> What I want to avoid is a system where CKAN posts to the link checker whenever a new resource is created or updated saying "check this link for me"
[10:16:18] <seanh> I think that will be unreliable, there's no way to comprehensively make sure that every link is being checked every 24 hours or whatever
[10:17:12] <seanh> Instead I want the link checker to contact the CKAN API to get a list of all the resource IDs in the site (and do its own logic to decide which ones to check and which ones are already checked). This is more failure resistant, will not "miss out" any resources (or if it does, it'll get 'em next time)
[10:17:28] <rossjones> had the problem with scraperwiki, schedule was based on when you saved so there tended to be really heavy loads at peak times.
[10:17:49] <rossjones> I guess that's a different thing from the link-checking service then.
[10:17:56] <seanh> So for load balancing, I think each link checker instance would have to contact the CKAN API and say "I am link checker N, give me my resource IDs". You could have a CKAN extension providing an API endpoint for that, and doing the load-balancing logic
[10:18:15] <rossjones> "I am link checker N of M"
[10:18:38] <seanh> Yeah
[10:19:07] <seanh> Well, either the link checker needs to know how many link checkers there are, or CKAN needs to
[10:21:16] <seanh> I wonder if you could do something where no one has been configured to know how many link checkers there are, but each checker has a UUID. So it says to CKAN "I'm link checker <UUID>, give me my resource IDs". At first CKAN gives all its resource IDs to the first link checker, but then as it hears from more link checkers it adapts and starts distributing them. This could get rather complicated though it's easiest if you just configure CKAN to know
[10:21:16] <seanh> how many there are
[10:23:04] <rossjones> seanh or just have each link checker ask for 50 resources with the oldest last-checked time?
[10:23:24] <seanh> Could do
[10:24:07] <seanh> So far I'm planning to put the "check this resource URL if it has not been checked in the last N hours" logic into the link checker service not into CKAN, but I don't see a big problem with moving that into the CKAN extension at some point
[10:24:32] <seanh> I think you were right to say that the service should just do the actual asynchronous task and otherwise be as dumb as possible, so makes sense
[10:37:44] <seanh> Do you think we want to rate-limit the link checkers? So they will not send more than N requests per second to the same site, and not more than M requests per second in total
[10:37:49] <wardi> you can check a million links in minutes with a single process twisted script
[10:38:04] <seanh> You can't do across multiple checker instances global rate limiting though
[10:38:16] <wardi> waiting is easy
[10:39:32] <seanh> I think what I will write first is just a single process single thread no concurrency API client designed to be run as a cron. But I'll make it completely stateless, so that way the code can be wrapped in a twisted thing later, or in something that distributes instances across many servers
[10:40:57] <seanh> What I'm thinking is just: Send a request to <CKAN site>'s API to <N> resources to check, loop over them checking each one and posting the results to the CKAN API. On the CKAN side there'll be an extension to provide those two calls: get then next N links to check, and receive the result of a check
[10:48:24] <wardi> i'm saying distributing link checking is silly. make non-blocking requests instead
[10:54:59] <seanh> You're saying distributing it across multiple servers is silly?
[10:55:06] <wardi> twisted, tornado, grequests etc. make that easy
[10:55:23] <seanh> Yeah it does seem over the top, you could just do multiprocessing
[10:55:31] <wardi> yeah, unless you care that it's accessiblr from different servers
[10:56:02] <wardi> then you need a process per connection, which just sits there waiting
[10:56:06] <seanh> Yeah, but I think as far the architecture goes, we should try to design it so that it *could* be distributed across servers if you wanted
[10:56:51] <wardi> nah. worry about distributed when you have a problem that distributing solves
[11:01:02] <seanh> You're probably right, but I'll at least try to keep the link checker code stateless so that it can be multiprocessed as much as you want simply
[11:05:53] <wardi> can we meet at 12:30 again?
[11:09:07] <seanh> Yep
[11:13:44] <amln> seanh: just on the checking thing, it might be worth seeing what joet and amercader think on that, as they've been pulling stuff from the MS ChangeLog to feed ckan.
[11:14:07] <amln> there might be something re-usable.
[11:14:10] <joet> lol
[11:14:25] <amln> joet: wiked.
[11:31:17] <wardi> https://plus.google.com/hangouts/_/event/cb1vmkss426lkqicj94a3amvd1c?authuser=0&hl=en-GB
[11:33:49] <wardi> nigelb, amercader, .. ^
[11:34:18] <wardi> vitorbaptista ^
[11:38:49] <joet> amercader, https://github.com/ckan/ckan/blob/master/ckan/logic/action/get.py#L946-L948
[12:06:45] <seanh> It's actually fairly complicated to implement the logic for deciding which N resources should be checked next
[12:07:03] <seanh> First find any resources that have never been checked before, and sort them oldest-resource-first
[12:07:30] <seanh> If there's less than N of those, then get resources that have not been checked in the last X hours, and sort them most-recently-checked last
[12:07:47] <wardi> that should be done by the thing calling the async link checker
[12:07:55] <seanh> If you still need more, then get resources that have a pending check (result not received yet) from more than Y hours ago
[12:08:32] <seanh> I'm putting this logic in a CKAN extension. The idea is that the link checker process calls the CKAN API and says "Give me up to N resources to check"
[12:14:59] <seanh> I'm going to have to actually write some intelligent sqlalchemy queries though - haven't done that for a while
[12:16:17] <seanh> I might actually just pull all the rows from the tables and filter them in Python for now. That'll pass my unit tests, can be replaced by faster db queries later
[12:25:45] <rgrp> #ann create a Data API for (Tabular) Data Packages in seconds using dpm plus CKAN and its DataStore http://okfnlabs.org/blog/2014/09/11/data-api-for-data-packages-with-dpm-and-ckan.html
[12:26:00] <rgrp> for the lazy there's a nice animated gif - http://assets.okfnlabs.org/p/dpm/img/dpm-ckan.gif
[12:26:14] <rgrp> this is also a way to get data into CKAN and its datastore pretty fast ...
[12:26:23] <rgrp> by next step after proper data packages is just to have something that does ...
[12:26:53] <rgrp> ckan-upload-data csv-file with auto-guessing of types, some prompts on metadata etc
[12:30:36] <wardi> seanh: I guess having the service ask ckan for things to do means all the connections just go in one direction. makes it harder to fire off something immediately in response to a user request though
[12:31:47] <seanh> Yeah, You won't be able to fir anything off immediately in response to a user request when the service is a cron job. But when the service becomes a web service we can add "check the resource IDs now" requests in as well
[12:32:54] <seanh> But the default operation will remain each instance of the service asks CKAN every N hours for M resources to check, one-off special requests from users are a special case I think
[13:00:14] <seanh> Is it really so bad for extensions to have their own db tables with foreign keys against the core tables? I've got this table of resource link check results. If a resource is deleted, I want its results to be cascade deleted as well, otherwise there's junk left in the db.
[13:00:39] <seanh> The coding standards say not to do it. I'm guessing migrations might be the reason? But I doubt the resource ID column is gonna get changed ever
[13:08:18] <wardi> can you force all deletes to cascade?
[13:09:33] <wardi> if not, just don't bother with the fk and clean out old records with a separate command
[13:14:24] <seanh> I think forcing all deletes to cascade is exactly what SQL's ON_DELETE_CASCADE does?
[13:14:42] <seanh> I can see if being a problem if a migration changed the id column of the resource table
[13:15:07] <seanh> I could add a paster command to clean it out I suppose but that seems crappy
[13:41:03] <joet> I suggested delete cascade a while back when talking about harvest objects, david (r) seemed to suggest that it's not reliable enough
[13:42:05] <seanh> Postgresql's on delete cascade is not reliable enough? I doubt that
[13:42:52] <joet> yeah that's exactly what I thought, but david used to work as a database guy, so I didn't press further.
[13:43:18] <joet> but hey he's not here now, let's change everything!
[13:44:14] <amercader> seanh, joet: I seem to remember that what was not reliable was sqlalchemy, but I might be completely wrong
[14:27:19] <rparra> hi all, does anyone know a way to limit the use of the CKAN harvester interface to admin users? currently, as I see it, any logged in user can create or edit harvest sources, run a reharvest operation, etc
[14:34:29] <wardi> package controller resource_read madness...
[14:38:52] <wardi> there was a bug about mixing different package and resource ids recently, wasn't there?
[14:40:07] <wardi> ah, 1707
[15:22:46] <rparra> found the settings I needed to change in the .ini file, thanks!

2014-09-10
[18:52:48] <rossjones> At the moment we're dependent on looking for specific columns (like LSOA codes and stuff), but eventually when we have our sparkly non-existent-yet ETL we'll locate lat/lng with postcodes, etc.
[18:53:20] <rossjones> I guess that's what happens when the customer puts the GIS guy in charge of the data portal :)
[18:53:34] <wardi> sounds related to the other indexing vitorbaptista is adding to datastore
[18:53:41] <rossjones> oh?
[18:53:55] <rossjones> I should turn up to a meeting one day, I might hear about more interesting stuff.
[18:54:36] <wardi> IIRC he's working on full text search in datastore columns, but it seems like we need a way to create just the right index typr for each column
[18:54:44] <rossjones> ah right.
[18:55:24] <rossjones> sounds like a bit of a nightmare ;)
[18:55:42] <wardi> of course, no-one wants to have to declare what columns are what type, ckan can just be magical, right?
[18:56:27] <rossjones> heh yeah.
[18:57:08] <rossjones> An intermediary step showing cols and guessed types (with option for choosing another) wouldn't be too hard, but I guess users don't want to spend that much time.
[18:57:15] <rossjones> maybe I'm wrong
[18:57:19] <wardi> rossjones: you must have people that want to autodetect post codes, polygons etc
[18:58:01] <rossjones> the thing I did for leeds let you choose an existing csv, shows the columns, makes you choose which contains the geo information
[18:58:20] <rossjones> Mostly it was just Easting/Northing -> Lat/Lng.
[18:58:21] <wardi> building these indexes is another one of these things we need a queue for
[18:59:19] <rossjones> might just have to add a queue. but the setup time/complexity of a ckan already seems too high :(
[18:59:33] <rossjones> at least for ppl just wanting one instance.
[18:59:56] <wardi> rossjones: is your thing extensible to other sorts of labelling? ("this contains text I'd like searchable", "I'd like a facet here" etc..)
[19:00:05] <rossjones> Nah.
[19:00:11] <rossjones> It's much simpler.
[19:00:42] <rossjones> I haven't had time to think about it in any depth beyond something very simple.  Once we've got a couple more customers we'll probably do the ETL thing.
[19:00:58] <wardi> what's the ETL thing?
[19:01:16] <rossjones> cleaning, transforming, indexing incoming data.
[19:01:31] <rossjones> it's just a ticket with 3 letters in buried in our backlog atm though.
[19:02:10] <rossjones> starting to have more fun with the stuff around ckan, rather than in ckan now :)
[19:02:24] <wardi> rossjones: have you looked at dat for the transform part?
[19:02:36] <rossjones> A little, not recently.
[19:03:47] <rossjones> thought it was just about streaming data around, from postgres to a url, or a url to an API, stuff like that.
[19:03:53] <rossjones> Maybe I misunderstood.
[19:04:24] <wardi> oh. maybe it is
[19:05:01] <rossjones> I think it's the culmination of a long-standing couchdb obsession ;) Hope he doesn't shout at me for saying that :P
[19:06:21] <rossjones> The bubbles thing on the okfnlabs blog looked VERY interesting though
[19:06:38] <rossjones> http://okfnlabs.org/blog/2014/09/01/bubbles-python-etl.html
[19:08:58] <wardi> I like things built with python iterators :-)
[19:09:05] <amln> cat. pigeons. https://github.com/ckan/ideas-and-roadmap/issues/82#issuecomment-55166656 .
[19:10:03] <rossjones> AWESOME!
[19:11:31] * rossjones goes to make a coffee and some popcorn.
[19:13:27] * amln goes to eat duck/have an evening
[19:16:23] * wardi waits for the "WEB SCALE!" comment to be added

[14:48:04] <rossjones> I'm not sure there is, lots of messaging with an 'unreliable option' but nothing so simple.
[14:49:14] <seanh> You know another way I could do this is a script that uses the CKAN API. Loop over all the resources of all the datasets checking the resource URLs and maintaining a sqlite database of the results. Run it hourly from cron.
[14:49:29] <wardi> Let's get on it. Unreliablility-as-a-service(UaaS) is the next big thing, I'm sure :-)
[14:49:37] <rossjones> seanh you need to make sure it'll finish within the hour.
[14:49:39] <seanh> It can mark resources as broken using a resource extra, then a CKAN theme just needs to pick that up in the templates
[14:49:52] <seanh> Yeah, you need a way to say "start it again unless it's still running"
[14:50:11] <rossjones> wardi I like the idea of deliberately not caring about reliability, if you ask for status with your token and it 404s, you can just try again :)
[14:50:19] <rossjones> seanh use flock in the crontab
[14:50:22] <seanh> But do I really need a whole asynchronous web framework for that?
[14:51:28] <ScraperDragon> seanh: run-one / run-this-one?
[14:51:54] <rossjones> seanh no
[14:52:07] <rossjones> flock /var/lock/mytask.lck -n paster whatever
[14:52:35] <rossjones> -c even
[14:55:59] <seanh> Well that would certainly be a lot quicker to implement. It doesn't even have to be a paster command (you could run the cron job on a different server from your ckan site)
[14:56:25] <rossjones> will it work with dgu's 15k datasets and 40k resources?
[14:56:31] <seanh> I guess the point of going to all the trouble to do it as a web service is that you can then offer it as a service to CKANs and other clients all over the world
[14:56:38] <rossjones> actually, most'll 404 so no problem :P
[14:56:38] <seanh> rossjones: Why not?
[14:56:54] <seanh> It'll just go over them one by one, in a single thread!
[14:57:37] <seanh> It could use activity streams API to find just the new or updated ones as well
[14:58:36] <seanh> To do it as a web service you'd have to handle registration and authentication as well
[15:04:05] <rossjones> seanh perhaps.
[15:04:21] <seanh> Is Tornado really what we'd want here? The docs says it's for "applications that require a long-lived connection to each user" but we don't need that. We want a synchronous API that returns immediately, but that kicks off an asynchronous task and posts to a callback URL when the task finishes
[15:05:08] <rossjones> seanh you can just hand off to multiprocessing (or subprocess if you're weird) and return.
[15:05:24] <seanh> Right, but I can do that from Flask, or any web framework, right?
[15:05:30] <rossjones> I guess so.
[15:06:16] <joet> also depending on what task you're doing, you might want your task to be sent off to another server instead of done by your webserver
[15:06:18] <seanh> Unless I'm confused there's nothing special about Tornado as far as handing off to multiprocessing goes, unless you just happen to like Tornado
[15:09:32] <rossjones> tornado runs with a event loop I think, as opposed to the multiple workers/threads approach
[15:12:39] <wardi> tornado is nice if you want long polling or websockets
[15:12:59] <wardi> which make having a JS web client easier
[15:14:44] <seanh> Googling, some people seem to be saying that multiprocessing and flask or multiprocessing and web apps don't really mix well. I dunno
[15:15:22] <seanh> It does seem quite simple to just use Celery for this though! Only drawback is you have to run a celery worker process on the server, so it adds some setup
[15:16:51] <rossjones> seanh I wonder if switching to supervisor (for gunicorn, celery worker + services) might work? might *possibly* make installation easier.
[15:17:29] <seanh> Sure
[15:18:15] <seanh> Definitely use supervisor to run celery. I hadn't thought about how to run the flask web app yet but it could be supervisor and gunicorn I guess
[15:22:50] <seanh> Ok, so I think the most obvious way to implement a standalone "QA service" is a simple flask web app with a json api and celery
[15:23:19] <seanh> It's all just really well documented and mainstream and should "just work"
[15:24:31] <wardi> yeah
[15:26:18] <rossjones> and a drop-in config for supervisor/upstart/systemd ?
[15:27:42] <seanh> I think the API would be: A CKAN extension POSTs a resource URL and callback URL to the Flask app (my use case is for checking for broken links only), the app responds with 200 OK and a JSON body with a task ID in it. When it finishes the task the Flask app POSTs to the CKAN extension's callback URL with a JSON body with the task ID and result. That's it
[15:27:46] <seanh> Yes to drop-in config
[15:28:22] <seanh> You don't need to be able to do a "tell me the current status of my task" request, you just wait for the callback and if it never comes then you start a new task
[15:29:04] <seanh> I would add one of those root URLs that returns the API docs, then you can hit that just to see if the service is alive if you want, and it gives us something to put at /
[15:29:22] <rossjones> you just described how the celery/task-status stuff works I think :)
[15:29:28] <rossjones> with celery instead of http
[15:30:02] <rossjones> swagger? https://helloreverb.com/developers/swagger ?
[15:30:13] <seanh> You mean the task_statuses API in CKAN?
[15:31:05] <rossjones> yes, i think that is what it is supposed to be doing (although it contains actual results instead of just info on the task)
[15:31:30] <seanh> IIRC that doesn't do anything. You can post to task_status_update and it'll creste or update a row in the task_status db table, and there's also task_status_delete, but it doesn't do anything. ckanext-qa for example will do task_status_update and then on the next line it kicks off a celery task itself
[15:39:01] <seanh> Hmm, actually maybe I do want a slightly bigger API than that: I want to be able to query the history of link checker results for a given URL. A list of objects with URL that was checked, datetime and result
[15:43:13] <rossjones> seanh i reckon that's not the APIs job, it should do one thing and do that well, CKAN can query itself to find task info.
[15:43:36] <seanh> Then I'd have to implement the history-keeping in the CKAN extension side of it
[15:44:01] <seanh> It seems like that history might be useful to other users of the service though?
[15:44:46] <seanh> But it does complicate the implementation of the link checker service: There has to be a URL you can get to get the list of past check results for a given resource URL. Which means we need to assign unique IDs to the URLs I guess
[15:46:28] <rossjones> it's getting very complicated now :)
[15:46:50] <rossjones> any minute now one of us is going to say revisions.
[15:46:55] <seanh> The service could generate a unique ID each time it's asked to check a given URL for the first time, and return that to the client. Or it could require the client to provide a unique ID when it requests the task in the first place
[15:47:17] <rossjones> a hash of the url seems sensible to give back to the client.
[15:47:23] <rossjones> I guess you could keep a history for that has.
[15:47:24] <rossjones> h
[15:48:41] <seanh> Actually I think when the client asks the service to check a URL, it can optionally post a client-generated unique ID and then it can use that later to retrieve historical results?
[15:49:31] <seanh> That's more flexible - leave it up to the client to decide which requests get which IDs
[15:49:31] <rossjones> seanh https://www.websequencediagrams.com/ often helps (me at least) work out what I mean
[15:50:34] <seanh> But an even simpler solution might a given client can get the history of checks requested by the client (clients can be identified by their API key maybe)
[15:52:07] <seanh> Hmm, I think just optional client-generated IDs and ability to request a history of results with the given ID is simplest
[15:54:03] <seanh> The thing is the CKAN extension is gonna want to cache that history of results locally anyway. It wants to say at CKAN page request time "Make this resource broken if it has at least 3 failed checks over at least 3 days". So I think you're right, implement that in the CKAN extension and keep the service simple
[15:54:25] <seanh> The actual asynchronous part here is checking whether the link is down, and that's all the service needs to do
[15:55:56] <seanh> We're gonna need a cron job or something running on the CKAN side sending out "check this link" requests to the service for each link once a day or something too ... Which is making me wonder why not just implement the whole thing in cron again
[15:56:39] <travis-ci> [travis-ci] ckan/ckan release-v2.2.1 95ea888 http://travis-ci.org/ckan/ckan/builds/34922943 amercader: The build was broken.
[15:58:39] <seanh> We could use Celery periodic tasks for this
[15:59:28] <amln> At over-the-air a few years back, one of the talks was "don't mock 1970s tech" (cron featured in this)
[15:59:43] <amln> dan knell also did a talk on how reliable /dev/null is :P
[16:05:49] <seanh> It certainly might make a good sense to implement this as a cron job and a CKAN extension to display the results saved by the cron job at first. Get that working, then think about how a web service version of it would have to work. I guess the cron job would have to be a paster command so it can get access to CKAN's db to save results to
[16:08:58] <seanh> I'm now worrying about how even if we get the link checker service automatically checking a link every day for us and posting results to our callback URL, how do we make sure that it really has a periodic task going for every resource in CKAN, and we haven't missed any?
[16:09:10] <seanh> In a cron job, you can easily put in a double-check for that
[16:14:17] <seanh> Actually I'm gonna make the cron job use its own sqlite db and be a standalone CLI not a paster command. That way you can run it on a different server from where CKAN is installed, or even run it once-off from your dev laptop etc. It'll be much nicer than using paster and CKAN's db as well. It can just do all its CKAN communication over the CKAN API
[16:14:35] <seanh> ckanclient should help a lot here
[16:15:25] <seanh> ckanapi I mean
[16:53:05] <seanh> wardi: I'm not that impressed with docopt. If I put "ckan-link-checker -h | --help" in my docstring it crashes with docopt.DocoptLanguageError: unmatched '('. If I remove that line it works. There are no ('s anywhere in my docstring. Shrug.
[16:53:56] <seanh> I think I prefer the imperative style. Yes you have to learn some lib and lots of functions you need to call to add different kinds of options etc. But it's sort of more direct, you're not dealing with a "parser puzzle"
[16:55:09] <seanh> It'd be awesome if it worked. How you just have your usage string as your module docstring, and then two lines of docopt code to turn that into your working CLI.
[17:19:36] <wardi> seanh: huh. I didn't run into that
[17:20:12] <wardi> guess you need () with |
[17:25:10] <seanh> No I get the same error either way :(
[17:25:51] * seanh Actually quite likes argparse anyway
[17:28:04] <wardi> https://github.com/ckan/ckanapi/blob/master/ckanapi/cli/main.py#L1-L14
[17:28:32] <wardi> this is pretty hairy and still works, are you sure you don;t have a dangling paren somewhere? :-)
[17:46:06] <seanh> Seriously no parens! Vim confirms it
[18:05:16] <wardi> indentation off or something? broken docopt version?
[18:19:09] <wardi> back into the depths of lib.navl.dictizations_functions._validate
[18:38:15] <wardi> dang. looking in the wrong place. resource_show doesn't apply validation :-(
[18:39:43] <rossjones> you brought it on yourself, you should have just pretended it doesn't exist like a sensible person would :)
[18:40:04] <wardi> rossjones: pretended which doesn't exist?
[18:40:19] <rossjones> schema validation/dictization stuff.
[18:40:52] <rossjones> is your schema customisation stuff released yet?/
[18:41:17] <wardi> rossjones: https://github.com/open-data/ckanext-scheming/
[18:42:36] <wardi> Ok, I'm going to reimplement resource_show with package_show
[18:43:26] <rossjones> totally irrelevant stylistic point, any reason validators isn't a list?
[18:43:44] <wardi> rossjones: just more typing
[18:43:54] <rossjones> fair enough
[18:43:59] <wardi> and I have to parse it anyway for things like 'if_empty_same_as'
[18:44:39] <wardi> so now I have a mini-language.. whee!
[18:44:47] <rossjones> hehe
[18:45:04] <rossjones> do you use this in production?
[18:45:25] <wardi> not yet, but in a month or so we will be
[18:46:01] <rossjones> Just waiting for #1795?
[18:46:26] <wardi> and now a fix for resource_show (but that's more related to -fluent)
[18:46:39] <rossjones> fluent?
[18:46:58] <wardi> https://github.com/open-data/ckanext-fluent/
[18:47:20] <rossjones> maybe i should just trawl through https://github.com/open-data :)
[18:47:34] <wardi> those are the two exciting ones atm
[18:49:16] <rossjones> I'm busy multilating ckanext-spatial and wondering how I'll get the changes past amercader :(
[18:50:15] <wardi> mutilate carefully?
[18:50:45] <rossjones> I guess so :)
[18:51:01] <wardi> rossjones: what sort of changes?
[18:51:28] <rossjones> indexing rows in tabular data so you can find the data in the files with a bounding box, that sort of thing.
[18:51:44] <rossjones> and then extending to polygons.
[18:51:59] <wardi> ooh. cool.

[08:34:33] <seanh> I'll get a fix for this latest issue after coffee this morning, and I'm also going to put in a pull request to remove the stats plugin until we fix it
[11:58:25] <SkramX> does datahub.io count downloads of datasets?
[12:26:12] <rossjones> SkramX probably at google analytics or somewhere
[13:23:18] <acorbi> Hi everyone, one question regarding the converters. I am willing to use the function ckan.logic.converters.convert_group_name_or_id_to_id (which takes the name of the group and the context as parameters) within a script residing in a extension. But, how do i reference the contxt? any clues?
[13:27:05] <wardi> acorbi: you might be better off just calling group_show yourself
[13:28:23] <acorbi> ok, good alternative, thanks wardi. btw i was trying things out and actually is possible to call the converter through the action api, like this: api.action.convert_group_name_or_id_to_id
[13:37:41] <wardi> acorbi: !
[13:40:22] <acorbi> ok, no it is not possible. I was wrong
[13:43:54] <wardi> phew. that would have been strange
[13:58:02] <seanh> rossjones: DGU's ckanext-qa doesn't use its own database table, it still uses task_statuses
[13:58:21] <rossjones> hmm. that's not good. thought it had changed.
[13:58:40] <seanh> In fact if this git command is telling me what I think it's telling me, all the commits from DGU's ckanext-qa have already been pulled into the core ckanext-qa
[13:59:04] <rossjones> which branch?
[13:59:05] <rossjones> 2.0
[13:59:25] * wardi always resorts to gitk
[13:59:28] <rossjones> https://github.com/datagovuk/ckanext-qa/commits/2.0
[13:59:34] <rossjones> In particular - https://github.com/datagovuk/ckanext-qa/commit/0e322af5ff6e530078801101186712064f7da64d
[13:59:50] <rossjones> I think dread has cleaned it up somewhat since then.
[14:00:26] <seanh> Argh, so both repos have a load of branches as well?
[14:00:43] <seanh> Different sets of branches on each fork
[14:00:53] <rossjones> :D
[14:01:08] <rossjones> dgu tends to import master and then use a branch as it's master.
[14:01:18] <rossjones> might have changed since I left, morty will know.
[14:01:49] <seanh> morty: Which branch of datagovuk/ckanext-qa is the canonical branch?
[14:02:03] <rossjones> I'll check on staging ...
[14:02:29] <rossjones> Branch: 2.0
[14:03:02] <seanh> This is a real mess. OKF has its absurd branching policy with master, release-*, service and stable branches, no idea what's going on there. And DGU has a fork with also a load of branches. Which code do I work off!
[14:03:24] <seanh> I feel like taking all the branches of all the forks and just merging them all!
[14:04:17] <rossjones> hahaha
[14:04:30] <seanh> So DGU's master branch is just the OKFN master branch at the time DGU forked it? DGU have done all their work on this 2.0 branch?
[14:04:34] <rossjones> I doubt okfn/ckanext-qa has changed that much has it?
[14:04:57] <seanh> Yeah there are dozens or hundreds of commits different between these branches
[14:05:14] * rossjones shrugs
[14:05:36] <rossjones> They're both wrong anyway .... https://github.com/ckan/ideas-and-roadmap/issues/65
[14:07:36] <rossjones> seanh don't forget any dgu templates will be genshi too.
[14:07:43] <seanh> OKFN master 272 commits vs DGU master 224 commits. So if the theory that DGU hasn't touched master is right, OKFN has done 48 commits since DGU forked. Then DGU's 2.0 has 353 commits. So the divergence is 48:129 commits. But that's not considering other branches like OKFN's stable branch..
[14:08:35] <seanh> rossjones: Don't tempt me, it would be a lot more fun to throw away both these ckanext-qa messes and just write some code from scratch!
[14:08:41] <rossjones> seanh do it!
[14:08:49] <rossjones> And fix the archiver dep at the same time :)
[14:09:54] <rossjones> does anything else use task_status?
[14:11:37] <seanh> rossjones: What you're suggesting in that issue is just how datapusher works: it's a standalone web app (built on flask) that provides a simple JSON API for kicking off asynchronous tasks and for checking their statuses
[14:12:05] <rossjones> seanh in theory or practice?
[14:12:14] <seanh> DataPusher is built on ckan-service-provider which is meant to be a framework for building these standalone "CKAN services"
[14:12:21] <rossjones> ugh
[14:12:22] <seanh> DataPusher actually works like that, in practice
[14:12:55] <rossjones> on datapress we do the same with our new datapreview service (jsonpdataproxy replacement) and it works well, but I guess all the requests are synchronous.
[14:12:57] <seanh> nickstenn has looked into ckan-service-provider and datapusher though, and I recall him saying it was a tangled mess that was just reimplementing celery for no reason
[14:13:21] <rossjones> yeah, i can imagine.
[14:14:03] <seanh> I see no reason why ckanext-qa shouldn't be a simple standalone web app for doing async tasks offering a JSON API built on Flask though. It doesn't have to reinvent celery (it can just use celery). If the ckan-service-provider code is bad it doesn't have to use that
[14:15:06] <seanh> I'm all for things that don't need to be CKAN plugins not being CKAN plugins, and just communicating with CKAN via APIs
[14:15:46] <seanh> And I like the idea of not having to sort this ckanext-qa forking and branching mess out, I had nothing to do with making it :)
[14:17:04] <wardi> git merge -s ours <all the branches>
[14:17:36] <wardi> monster octopus merge!
[14:17:49] <rossjones> seanh it depends on how critical you think the QA tasks are.
[14:18:07] <rossjones> If you're not *really* bothered if it missed the occassional one, then a queue isn't necessary
[14:18:21] <rossjones> Will system still run if a few requests get dropped? Am guessing so.
[14:18:29] <seanh> Yeah
[14:18:48] <rossjones> For my push service I used tornado and multiprocess to have a set number of workers.
[14:19:23] <rossjones> on the basis that the world will not end if one of the jobs ends up getting queued in memory and lost in a crash.
[14:19:27] * wardi implemented one of those too
[14:20:03] <wardi> multiprocess didn't play well with paster though, so I used subprocess
[14:20:16] <seanh> The service needs some way of doing longer-running asynchronous tasks anyway. When someone posts to it saying "please QA that resource" it has to respond immediately with OK then post to a callback URL when the task has finished, it can't be synchronous
[14:20:39] <seanh> So what I want is the simplest possible way of doing that
[14:22:27] <seanh> I think flask will be the smallest and simplest way of doing the "simple web app with a json api" part
[14:22:44] <seanh> So I wonder what people use with flask for async then..
[14:23:43] <wardi> seanh: could be a tornado or asyncio or twisted thing
[14:23:57] <rossjones> seanh my working solution is at https://bitbucket.org/leedsdatamill/ckanext-push/src/bfd63c12d48827b8524fd9466b67b88367940f18/ckanext/push/server.py?at=master
[14:24:09] <rossjones> Advance warning - it isn't finished, and it might make your eyes bleed
[14:24:25] <rossjones> https://bitbucket.org/leedsdatamill/ckanext-push/src/bfd63c12d48827b8524fd9466b67b88367940f18/ckanext/push/server.py?at=master#cl-45 is the bit where the hard work is done
[14:25:43] <seanh> So you're using Tornado instead of Flask? I guess a web framework that does async out of the box is more direct
[14:26:03] <rossjones> yeah, I sitll don't like it. Have just closed the repo coz I noticed an APIKEY and I don't know if it is real :(
[14:26:09] <rossjones> Now I have lots of fun cleaning history
[14:26:17] <rossjones> Might just move it to ghub without history .. sigh
[14:26:56] <rossjones> But yeah, tornado and a multiprocessing.pool.ThreadPool
[14:31:22] <seanh> Apparently Bottle is also an option: http://bottlepy.org/docs/dev/async.html
[14:32:24] <rossjones> concurrency + python == :(
[14:32:44] <wardi> rossjones: how so?
[14:32:59] <rossjones> GIL.
[14:33:07] <rossjones> Lock who interpreter to context switch.
[14:33:11] <rossjones> Multiprocess is fine I guess.
[14:33:14] <wardi> I think a simple unreliable async service that can be queried with tokens would be great
[14:33:16] <rossjones> Threads suck
[14:33:33] <rossjones> Which is why I went with workers and allocating the work out to them.
[14:33:43] <wardi> multiprocess is terrible. I actually prefer subprocess and pipes.. but I might be weird
[14:33:56] <rossjones> yes, you are.
[14:33:57] <rossjones> ;)
[14:34:14] <wardi> multiprocess is too magical
[14:34:51] <wardi> it tries to be a better threading, which is like how svn tries to be a better cvs..
[14:36:37] <wardi> what about making a standard interface and some libraries that help people build these unreliable webhook-token-based services?
[14:37:22] <wardi> then make it so the harvester/control panel of some sort can be used with any of them
[14:37:47] <rossjones> I think nick'd argue that's celery
[14:37:58] <wardi> so if your async service just makes web requests it doesn't need multiprocess or threads at all
[14:38:23] <seanh> Bah, the bottle way seems odd, I'll look at Tornado
[14:38:54] <wardi> it could also be implemented in any language..
[14:39:11] <rossjones> Yes. This is true. That'd be more fun.
[14:40:01] <rossjones> *cough*Go*cough*
[14:40:13] <wardi> rossjones: celery is a real queue with all the reliability and management that entails. I'm talking about things that might just be single processes running all in-memory
[14:40:27] <wardi> go would be awesome for generating previews and such
[14:41:03] <rossjones> my thoughts exactly
[14:41:20] <rossjones> we use it for our solr-agent (creating/managing multiple cores on remote solr server).
[14:41:29] <rossjones> Wrote it in an afternoon, has been running for weeks.
[14:42:14] <wardi> the trouble (and strength?) is it leaves it up to the client to retry if they care that something actually gets done
[14:43:51] <wardi> rossjones: so, it's your ideas#65 but as an api standard (and maybe examples/libraries to help implementing servers)
[14:46:46] <rossjones> wardi http://imgs.xkcd.com/comics/standards.png
[14:47:40] <wardi> hey if there's soething that already does this we could adopt it instead

2014-09-09

[11:01:28] <seanh> Anyone up for a dev meeting then? Ah - did we agree to do it 30 mins later?
[11:02:06] <wardi> that was for thursday, 7 is still good for tues
[11:02:23] <seanh> I don't know how to make a google hangout :)
[11:02:35] <wardi> there's a permanent one, just a sec
[11:03:06] <wardi> https://plus.google.com/hangouts/_/event/cb1vmkss426lkqicj94a3amvd1c?authuser=0&hl=en-GB
[11:04:16] <wardi> s/7/noon
[11:12:06] <joet> we're stuck in anothing meeting atm wardi
[12:20:38] <rparra> hello all, does anyone know exactly where can I find the 'undo' button in a dataset history page? I mean the page you see at ckanurl/dataset/history/dataset-name
[12:20:54] <rparra> I am currently logged in as sysadmin and only see a compare button
[13:15:33] <wardi> rparra: I don't think there is an undo button. Seems like something we should have, though
[13:15:59] <wardi> likely since the revisions page was hidden it dropped off the list of priorities
[13:17:06] <wardi> rparra: the revision page needs some work, it's pretty hard to understand I find
[13:17:11] <wardi> (also)
[13:20:54] <acorbi> wardi: hi, may i ask you a brief question about the action API v3?
[13:21:29] <wardi> acorbi: don't ask to ask, just ask :-)
[13:23:18] <acorbi> wardi: yeah, thanks! So, the question is: In order to use the action api from a system outside the CKAN server. I just have to make a POST request to the wished adress with the appropiate JSON dictionary for the parameters right?
[13:23:39] <acorbi> the urls to call are always behind /api/3/action/
[13:24:24] <wardi> acorbi: GET is fine for read-only things too, and you can post json or form/multipart for flat things
[13:25:04] <acorbi> ok, and how does this differ from the REST API?
[13:25:44] <wardi> rest has more complicated urls and different methods, action is all flat and post-only
[13:26:34] <wardi> rest might be more familiar but it's further from the "bare metal" of what ckan does
[13:33:48] <acorbi> allright. Then i have been using the action API indeed. I am currently researching about this issue i am having. If you remember, when i call the action API from my local machine i get Server Error 409 : Conflict
[13:34:15] <acorbi> i think it has to do with passing the Authentication header since it does not happen on calls which do not require it
[13:49:32] <wardi> I don't think it should ever return a 409..
[13:49:50] <wardi> oh. wait..
[13:50:36] <wardi> right, so are you passing the right api key?
[13:52:20] <wardi> acorbi: https://github.com/ckan/ckanapi/blob/master/ckanapi/common.py#L67-L68 it seems I chose to pass it both as 'X-CKAN-API-Key' and 'Authorization' for some reason
[13:53:02] <wardi> IIRC one worked for the development server and one when I was using apache
[14:04:58] <acorbi> wardi: using X-CKAN-API-Key header does not help, actually now i am trying a call to /api/3/action/package_search which does not require Aithorization and it is happening as well
[14:06:05] <acorbi> as ong as i have discovered sofar it looks like some apache/server/proxy config thing
[14:06:57] <wardi> you can't try direcly (without the proxy)?
[14:07:21] <acorbi> still need some research. i am going to test a bit more and i'll let you know
[14:08:18] <acorbi> something interesting is that the very same call to /api/3/action/package_search works on a separate script
[14:08:32] <acorbi> in that one, that is the very first call i do with urllib2
[14:10:02] <acorbi> contrary to the script which is giving problems in which i am doing 2 calls before it
[14:10:20] <wardi> acorbi: is there a reason you aren't using ckanapi?
[14:11:21] <acorbi> i guess no. can you point me to some docs about ckanapi?
[14:11:55] <wardi> https://github.com/ckan/ckanapi
[14:12:13] <acorbi> thanks
[14:12:47] <acorbi> ok, the reason is that i didn't know about it
[14:12:52] <acorbi> i'll try it
[14:24:14] <rparra> wardi sorry i've been afk. so there's currently no way to undo changes from ckan? it would certainly be a nice feature
[14:25:35] <wardi> rparra: that's right, and while it's possible for that controller to get old versions of the datasets the API doesn't expose a way to do it, so you can't even undo from from the API
[14:31:51] <seanh> What do people think about task_status_update() being used to both create and update task statuses, and not having a task_status_create()?
[14:31:51] <wardi> seanh: thanks for responding to #1915, I know I was supposed to do that
[14:32:26] <seanh> Personally I'd rather have an _update() that only updates existing objects and fails if the object doesn't exist
[14:32:42] <seanh> And a _create() that only creates new objects and fails if the object already exists
[14:32:53] <wardi> seanh: that sounds like what we do other places
[14:33:05] <seanh> It just makes the user code clearer: You know when its intending to create something and when it's intending to update
[14:33:12] <seanh> And that's what we do everywhere else, yeah
[14:34:26] <seanh> I think the update-or-create-if-not-exists may be modelled after celery
[14:35:44] <seanh> It looks like celery lets you update a task and specify a task ID, and I'm guessing that if a task with that ID doesn't exist yet then one will be created, but this way you avoid creating many instances of the same task if your code that "updates" the task runs many times while the task is still queued or running
[15:12:29] <rgrp> just ran into some interesting behaviour with datahub datastore. i uploaded via API and got either authorization error or bad query ...
[15:12:38] <rgrp> but if i edited the dataset and saved (no real changes) all was fine ...
[15:12:49] <rgrp> weird ...
[15:15:42] <rgrp> btw - pretty much have command line support in dpm for pushing data packages to ckan instances including pushing data to the datastore ...
[16:41:59] <seanh> Anyone know why ckanext-qa uses CKAN core's task statuses stuff / is that really necessary?
[16:42:40] <seanh> What I'm trying to do is: Publicly mark this resource link as broken is ckanext-qa has checked it at least X times over a period of at least Y days
[16:43:16] <seanh> To implement that logic I need ckanext-qa to record a history of all the resource qa checks it has done and their results, not just save the most recent one (as it does currently)
[16:44:17] <seanh> Currently it saves a row in CKAN's task_status table with entity_id=<resource_id>, task_type="qa" and key="openness_score" (if the openness score is 0 it means the link is broken)
[16:44:48] <seanh> CKAN's task status model has a db-level unique constraint on (entity_id, task_type, key)
[16:45:14] <seanh> So you can't save more than one openness score for the same resource, even if they differ on some other column (e.g. a datetime column)
[16:46:14] <seanh> What I'm thinking is just have ckanext-qa use its own database table where it can keep multiple openness scores for each resource, sorted by date, then I can do my logic on top of that
[16:46:27] <seanh> So I'll change ckanext-qa to not use task statuses anymore
[16:46:56] <seanh> I don't think this'll break anything - I'm not aware of anything in CKAN core or in another extension that's depending on ckanext-qa's task statuses
[16:51:58] <seanh> It's actually a bit weird how -qa uses task statuses
[16:52:23] <seanh> Task statuses are an undocumented feature in CKAN anyway, so we can only guess at how they're meant to be used
[16:52:36] <rossjones> seanh have you seen dread's fork?
[16:52:41] <seanh> But ckanext-qa seems to use them more like task results and task statuses
[16:53:22] <rossjones> task status *really* shouldn't be used to store the results of processing, it ends up getting queried to find the value when it's probably better suited in a separate table (which is what the DGU fork does)
[16:53:35] <seanh> It's not using the task_status table to record the state of a celery task (i.e. queued, running, finished, failed..). Rather when a celery task completes it saves the result as a series of "task statuses"
[16:53:46] <rossjones> That's what I mean
[16:53:54] <seanh> Ah, I didn't realise that the DGU fork has changed this part of it
[16:53:57] <rossjones> At best I think task_status should show you a history of submitted, processing, done (optionally with errors).
[16:54:04] <rossjones> DGU fork has it's own tables for storing this info
[16:54:27] <seanh> The DGU fork has no Jinja templates though, I'd need to do a bunch of work to figure out what's different between the core and DGU versions and merge them, it's very unfortunate
[16:54:50] <seanh> rossjones: Right
[16:55:12] <rossjones> It is, but I think it's hard for them ot justify the time now to move the templates over.
[16:55:20] <rossjones> unless morty has the time :)
[16:55:48] <seanh> They two have probably diverged in other ways besides templates now though
[16:57:29] <rossjones> I think that's probably true
[16:58:09] <rossjones> A lot of the divergence was not having time to wait for next release of ckan, and/or not thinking some changes would make it back into core.
[16:58:12] <rossjones> But anyway.
[16:58:23] <rossjones> Could just add jinja template to their fork.
[16:58:52] <rossjones> I don't recall there being a lot of templates involved.  Or you could wait until we deploy it on datapress and I'll push the templates back :)
[17:01:00] <seanh> I guess I'll look into it tomorrow
[17:01:17] <seanh> Maybe it won't be too much work to get them merged
[17:01:59] <seanh> I'll have to start by comparing them file-by-file or comparing the commits
[17:02:16] <seanh> Abusing task statuses like this is horrible though

2014-09-08

[11:13:01] <wardi> rgrp: \o/
[13:28:50] <rgrp> wardi: :-)
[13:30:05] <wardi> rgrp: it's quite the job getting all this set up, I'm sure
[13:30:18] <rgrp> wardi: it is ...
[13:32:22] <wardi> rgrp: is there a date for the first meeting?
[13:57:04] <rgrp> wardi: first meeting of steering group - and do you mean open meeting of just a meeting?
[13:57:32] <rgrp> i believe Jeanne holm is planning to schedule a community meeting on 21st ...
[14:12:50] <wardi> rgrp: I meant the meeting where the ideas document would be reviewed.
[14:13:57] <rgrp> wardi: you mean ideas/roadmap one ...
[14:14:15] <rgrp> yes - i've put some notes at the top of the doc with thoughts based on feedback from Tech Team and Steering Group ...
[14:14:24] <rgrp> i think idea will be a first round using e.g. user voice ...
[14:14:52] <wardi> oh, right. I see that now
[14:38:12] <acorbi> Hello everyone. I am writing a python script which calls the package_search action of the REST API
[14:38:31] <acorbi> I am getting constantly 409 Conflict Errors when i make the call
[14:39:43] <acorbi> the CKAN instance i am making the calls to was installed from package on a vagrant box running ubuntu 64bits
[14:41:53] <acorbi> does anyone have a clue what the problem is? I have been researching and apparently is some issue with the webserver and , as i noticed, it only happens with certain API calls (those which involve pushing some data, as in this case, the query term)
[15:18:47] <tryggvib> I'm trying to write a test for IResourceController's before_show but not having much experience with the testing framework I'm having a hard time triggering the before_show call and getting help instead of digging through the code would be helpful
[15:19:26] <tryggvib> I thought it would be triggered with helpers.call_action('package_show', name_or_id=package['id'])  # package is my factories created package
[15:19:48] <tryggvib> but by the looks of it, that doesn't trigger it
[15:20:04] <wardi> acorbi: do you get a more helpful error from the v3 package_search api?
[15:20:49] <acorbi> wardi: hi
[15:21:02] <tryggvib> is there a proper way to trigger IResourceController's before_show (which is triggered in the package_show of ckan.logic.actions.get)
[15:22:01] <acorbi> The error log outputed in the console is not so decriptive
[15:22:02] <acorbi> result = func(*args)   File "/usr/local/Cellar/python/2.7.8_1/Frameworks/Python.framework/Versions/2.7/lib/python2.7/urllib2.py", line 531, in http_error_default     raise HTTPError(req.get_full_url(), code, msg, hdrs, fp) urllib2.HTTPError: HTTP Error 409: Conflict
[15:22:40] <wardi> tryggvib: I wonder if using the cached result prevents that method from being called
[15:23:22] <wardi> acorbi: I'm not familiar with the rest api, can you try the v3 action api?
[15:23:29] <tryggvib> wardi: hmmm /me looks
[15:24:40] <wardi> no, I read that wrong. package_show should call every resource controller's before_show method
[15:24:47] <acorbi> wardi: is not the same?
[15:25:01] <acorbi> (rest api vs action api)?
[15:26:04] <wardi> acorbi: no, they are not the same. the action api is a thin wrapper around the action layer. the rest api does a lot more work to process the data going in and out
[15:26:34] <acorbi> ok, thanks for that. I'll study it a bit more. keep you posted.
[15:27:53] <tryggvib> wardi: I got it :)
[15:27:56] <wardi> tryggvib: your plugin might not be getting loaded properly. see some of the tests in ckanext/... for examples of loading plugins for tests
[15:27:57] <tryggvib> it was me being stupid
[15:28:32] <tryggvib> when creating the resource I used factories.Resource(user=user, package=package)
[15:28:53] <tryggvib> it should have been factories.Resource(user=user, package_id=package['id'])
[15:28:56] <tryggvib> now it all works
[15:29:04] <tryggvib> it was testing against nothing :)
[15:29:47] <tryggvib> things like this usually boil down to me being stupid :)
[15:34:06] <tryggvib> except that calling resource_delete also calls package_show... hrmmmm
[15:34:10] * tryggvib investigates
[15:34:31] <wardi> tryggvib: most things call package_show :-)
[15:35:21] <tryggvib> wardi: so it seems
[15:35:32] <tryggvib> goodbye isolated tests :)
[15:36:04] <wardi> unload your plugin after your tests?
[15:38:25] <tryggvib> wardi: I'm updating this: https://github.com/ckan/ckan/pull/1875 where before_delete and before_create and whatnot are added to the IResourceController so I wanted to be sure that one wouldn't interfere with another, I think that's impossible now
[15:39:05] <tryggvib> so I'll just update the documentation accordingly with a "watch out because package_show is called for many of these"
[16:08:20] <amln> can anyone remember, where, on docs.ckan.org, the "supported on IE..." thingy is?
[16:09:00] <amln> ah, coding standards.
[17:19:30] <joet> so anyone messed with custom group/org schemas recently?
[17:20:54] <wardi> joet: not in a little while, why?
[17:21:16] <wardi> I should try making a "default ckan" org schema with scheming now that I have one for dataset that works
[17:21:21] <joet> https://github.com/ckan/ckan/blob/master/ckan/logic/action/get.py#L1154-L1162
[17:21:28] <joet> if you provide your own schema
[17:21:36] <joet> then num_followers will get wiped out
[17:21:44] <joet> unless you've added it to your custom schema
[17:21:49] <joet> as it's not in defualt_group_schema
[17:22:28] <wardi> I think I ran into that, and it was causing a failure elsewhere
[17:22:51] <joet> I thought it was an oversight, but I thought it might be a weird ckan thing that I am doing wrong
[17:24:13] <joet> when I find the time, I'll have to go have a look where num_followers is added and if it should be added to the default_group_schema
[17:25:31] <wardi> joet: so, you have a plugin that returns None from db_to_form_schema_options?
[17:26:53] <joet> no, I took the default_group_schema and inserted a few fields
[17:27:09] <wardi> https://github.com/open-data/ckanext-scheming/blob/master/ckanext/scheming/plugins.py#L87-L89
[17:27:14] <joet> but because it doesn't have num_followers in it, when it runs the validation it adds it to the junk
[17:27:29] <wardi> ^ I had to add this but never figured out why it made things "work" for me
[17:28:01] <joet> yeah we really need to get rid of these  things, makes it horrible for plugin writers
[17:28:40] <wardi> it looks like it should do the exact same thing if that method returns None, though
[17:30:43] <joet> I'll have a go and see what happens
[17:33:05] <wardi> joet: you need to use default_show_group_schema
[17:34:06] <joet> wardi, I don't think that exists
[17:34:28] <joet> there's only default_group_schema
[17:34:36] <wardi> joet: ckan version?
[17:34:42] <joet> 2.2.1
[17:36:08] <joet> ah wardi you're right
[17:36:09] <wardi> https://github.com/ckan/ckan/pull/1627
[17:36:10] <joet> it's in master
[17:36:20] <joet> lol
[17:36:23] <joet> i merged that
[17:36:24] <wardi> backport?
[17:36:34] <wardi> itI can't remember
[17:36:48] <wardi> it's ok, I can't remember what I had for breakfast
[17:37:02] <joet> I'm not so fussed, I can just put it into my custom schema for now
[17:38:03] <wardi> so I guess I can remove my scheming hack now. that's good to know :-)
[17:38:16] <joet> other pet peeve, default_show_group_schema, and the actions are group_show
[17:39:09] <wardi> oh, we could fix that, I was just following default_show_package...
[17:39:29] <joet> yeah I do the same thing when I add schemas
[17:39:57] <joet> just to someone new, switching between verb_noun and noun_verb for no reason whatsoever is confusing
[17:40:41] <wardi> confusing for people that aren't new too

2014-09-07

2014-09-06

2014-09-05
[11:28:41] <amln> have any others encountered issues with IE8 downloading files?
[11:28:51] <amln> (from CKAN)
[11:50:53] <maxious> amln: most common problem is with zip files http://stackoverflow.com/a/6706165/684978
[12:05:18] <seanh> Guys, what is going on with these tests?
[12:06:02] <seanh> test_group_list_extras_returned(), test_group_list_groups_returned(), test_group_show(), all no docstrings. What are these tests supposed to be testing?
[12:06:12] <seanh> Please read the guidelines
[13:11:21] <SkramX_> quickie question - where to change the placeholder image on CKAN homepage?
[13:13:21] <SkramX_> nvm - thank goodness for github code search
[13:13:59] <ScraperDragon> :D
[13:16:08] <SkramX_> whats the rationale for not letting that be changed in the online system like the text right above it?
[13:25:21] <wardi> SkramX: good question. want to submit a pr to change that?
[13:25:56] <SkramX> not right this second but i will certainly create an issue in CKAN and add it to my list
[13:26:04] <SkramX> *Github
[13:27:12] <travis-ci> [travis-ci] ckan/ckan 1902-private-datasets-in-groups ee9199c http://travis-ci.org/ckan/ckan/builds/34492350 Sean Hammond: The build was broken.
[14:40:05] <acorbi> Hi everyone! Can somebody give me a hand with the Javascript sandbox client?
[14:40:25] <acorbi> I am willing to use it to call the API but there is no documentation on the reference: http://docs.ckan.org/en/latest/theming/javascript-sandbox.html
[14:40:43] <acorbi> somewhere i can find some documentation on how to make the calls to the API through it?
[14:51:23] <SkramX> acorbi: the code has some examples in it at https://github.com/ckan/ckan/blob/3dde3be6ac33670101cef539fd3d554307798102/ckan/public/base/javascript/sandbox.js
[14:51:26] <SkramX> what are you trying to do?
[14:51:56] <acorbi> hi skramX
[14:52:17] <SkramX> im no expert in the JS API, just trying to help
[14:52:39] <acorbi> thanks for your reply, i am trying to tweak the behaviour of the package_basic_fields.html snippet through a javascript module
[14:53:41] <acorbi> what i need to do is to implement it so that only Admins of a certain organisation are allowed to change the visibility of the dataset
[14:55:08] <acorbi> and i am trying to do it on the javascript side and not on the jinja templating side
[14:57:39] <acorbi> ok, i think rather that the link you provided, this search on the github repo is more useful (thanks anyway) https://github.com/ckan/ckan/search?utf8=%E2%9C%93&q=sandbox.client
[14:58:08] <acorbi> maybe you can answer me another question i have....
[14:58:50] <SkramX> sorry - got distracted
[14:58:57] <acorbi> how can i reference the context (variable c) in the javascript side? I would need to have access to the current logged user from the javascript module i am writing...
[14:59:13] <acorbi> no worries :-)
[14:59:17] <SkramX> not sure and have to run to a meeting but this is the right place to ask the experts
[14:59:29] <SkramX> i need to figure out how to use the JS sandbox API too
[14:59:41] <SkramX> for now, id look at  the code since there arent any docs
[14:59:53] <acorbi> ok, i'll be busy with this for the next hours, so hopefully somebody can give me a hand
[14:59:57] <acorbi> thanks SkramX
[15:00:12] <SkramX> as well as the spec; take a look at https://github.com/ckan/ckan/search?utf8=%E2%9C%93&q=this.sandbox
[15:24:58] <acorbi> Anyone knows how can i do to access the context information (logged user) from a javascript module?
[15:29:34] <wardi> acorbi: you could modify your templates to expose that information to JS
[15:34:05] <acorbi> hi wardi
[15:34:18] <acorbi> you mean, passing it through a data-module-variable ?
[15:34:49] <acorbi> so the module has it on this.options
[15:36:10] <wardi> acorbi: I wasn thinkign just a 'var user = "{{ c.user }}";' or similar in the base template
[15:37:59] <acorbi> you mean including that variable declaration on a <script> tag in the base template? then it would be accesible by the module i created on the custom theme?
[15:38:21] <acorbi> i am going to try that
[15:38:56] <acorbi> i am currently taking the user id from my module like this: this.options.user_id = $('.account').attr('data-me');
[15:39:22] <acorbi> (scrapping it from the html of the header part where the user name is being shown
[16:28:37] <seanh> I didn't know this, but it seems that CKAN core uses the sqlalchemy message transport for celery, which is marked experimental and unstable and several issues open in the celery docs
[16:28:41] <seanh> I think it doesn sup
[16:28:52] <seanh> support using rabbitmq or whatever instead, in the CKAN config file
[16:30:32] <rossjones> seanh I think using the DB as a queue is definitely a no-no. I've only ever seen it set up with rabbit though
[16:30:43] <wardi> acorbi: emitting data attributes on a tag is another good way to pass data to JS
[17:29:27] <seanh> Task statuses in CKAN are odd: there's no task_status_create() only _update()
[17:29:38] <seanh> Calling update with no id param creates a new one
[17:29:56] <seanh> Calling it with an id param updates an existing one or raises NotFound if none exists with that id
[17:32:40] <seanh> I'm not entirely sure what the task statuses are there for either, but I'm guessing they exist so that we can build things like showing the users list of completed, failed and in-progress tasks, and that code can be independent of the thing actually handling async tasks (celery, service_provider)

2014-09-04
[15:44:39] <seanh> If your site has a lot of linked-to rather than uploaded resource files and you want to avoid broken links, you should cache them all yourself. Either get them into the datastore, or download them with ckanext-archiver.
[15:47:14] <joet> yeah the best you could really do is store the last successful fetch and the date of the failed fetch
[15:47:22] <joet> (if a it has failed)
[15:48:44] <rparra> Hello guys, what would you suggest to do to make all harvested datasets private by default? I thought about adding a custom tag in the harvest source config and then checking for it. However, the entity parameter of the create/edit method of my custom PackageController does not include tags. Any ideas?
[15:52:41] <joet> rparra, which harvetser are you using? the ckan harvester?
[15:53:14] <rparra> yes, ckanext-harvest
[15:54:20] <joet> rparra I meant are you harvesting from another ckan website
[15:54:43] <rparra> oh, sorry. Yes, I'm harvesting from another CKAN website
[15:55:02] <seanh> Is it even really useful for users to see "this link appeared to be broken when our link checker last checked it N hours ago"? The user wants to know if it's working *right now*, which they can find out by clicking on it
[15:55:30] <seanh> I can see why a report listing all the broken links (as ckanext-qa already does) can be useful to administrators, e.g. so they can contact the people responsible
[15:57:15] <joet> true
[15:58:21] <joet> rparra, ideally the ckan harvester would let you do this easily, as it is, if you want to do it whilst harvesting, I'd do something create my own harvester that subclasses the current ckan harvester and overrides the section where package_create
[15:58:57] <joet> but updating the ckan harvester to make this task easier has been on our bucketlist for a while
[16:01:00] <rparra> joet, I see. So a PackageController really has no way of knowing the currently created/updated package comes from a harvester job, am I right?
[16:04:09] <joet> hum, you probably could do something, but it'd probably be my preference to do it whilst harvesting.
[16:06:14] <joet> Not that I'm recommending this, but if I recall, the harvest_object/harvest_source id are stored as extras
[16:06:29] <joet> (in the package_dict)
[16:06:40] <joet> so you could do something like checking for that
[16:13:45] <rparra> joet, I think you are right. But if I'm correct, pkg_dict is only available to a PackageController in the after_create/after_update methods. The create/update methods receive only a Package (something like this: http://chopapp.com/#pyawajhj )
[16:14:16] <rparra> I know it's not the most elegant solution, but would there be a way of getting tags/extras from a Package?
[16:21:43] <rparra> joet, if I were to go the other way around (subclassing CKANHarvester) would you recommend forking ckanext-harvest?
[16:22:01] <joet> not sure about the package controller
[16:22:11] <joet> but you wouldn't need to fork
[16:22:25] <joet> you just need to have your harvester in your extension
[16:23:17] <joet> ckanext-spatial for example has a bunch of custom harvesters
[16:25:57] <joet> oh rparra you get the package object
[16:26:00] <joet> right... well
[16:26:33] <joet> you could probably fetch the related HarvestObject. But I would really be so against this.
[16:29:17] <joet> HarvestObject basically has a foreign key to Package. But we plan to remove this in the future, so your code will break in a future version of ckan.
[17:26:55] <wardi> yey npm
[17:33:03] * wardi wants a docker image to run travis tests against :-(
[17:35:42] <wardi> anyone know how to fix: npm ERR! peerinvalid The package phantomjs does not satisfy its siblings' peerDependencies requirements!
[17:36:33] <wardi> Peer mocha-phantomjs@3.5.0 wants phantomjs@~1.9.1

[09:03:25] <acorbi> Hello everyone. I am creating an extension for theming CKAN's base template. I would need to have a function that gives me the role of the logged-in user. I have taken a look at the helper functions but did not find it.
[09:06:14] <acorbi> Can i find the details of the logged-in user in some context such as pylons.c.user
[09:06:15] <acorbi> ??
[09:44:59] <rossjones> acorbi yes (username) or User object in c.userobj (or c.user_obj, can't remember)
[09:56:04] <acorbi> Thanks rossjones
[11:01:06] * wardi will be late
[11:06:38] <joet> http://bit.ly/ckandevmeeting
[11:06:46] <joet> http://pad.okfn.org/p/ckan-meeting
[11:06:57] <joet> come one, come all.
[11:10:11] <joet> nigelb, seanh Vitor?
[11:10:41] <nigelb> joet: I'm in the middle of napping :)
[11:11:33] <joet> want to join in 30 mins?
[11:11:52] <wardi> that time is better for me on thursdays
[11:12:08] <seanh> Oh, forgot
[11:12:53] <joet> wardi is off for 20-30mins we can shift it later
[11:31:50] <wardi> so shall we do this thing?
[11:32:18] <joet> seanh,
[11:32:29] <joet> sorry was at the door
[11:33:18] <joet> nigelb, that's enough napping
[11:34:04] <nigelb> joet: fine
[14:07:23] <davidmiller> I'm being asked questions about how CKAN scales in terms of server architecture as usage grows
[14:07:32] <davidmiller> So far my googling has returned no information about how people are deploying - does such a document exist?
[14:08:42] <amln> davidmiller: there's the 2mil datasets thingy.
[14:09:01] <amln> or were you thinking more of "for n-k users, use ..." etc.
[14:09:05] <seanh> By usage do you mean adding datasets? Or just people browsing the site?
[14:11:27] <amln> https://github.com/ckan/ckan/pull/1783 was my attempt.
[14:12:01] <amln> but i don't know of a contributed doc for people's reqs.
[14:12:58] <amln> s/reqs/specs/
[14:13:38] <davidmiller> I want the two or three examples of n datasets, x hits/hour from seanh's comment on that issue :)
[14:14:01] <davidmiller> Or e.g. what are those numbers for DGU, Datahub.io, publicdata.eu
[14:14:17] <seanh> Once you get to hundreds of thousands of datasets you'll start having problems
[14:14:38] <wardi> well, you don't have problems when viewing
[14:15:09] <davidmiller> My use case is v. unlikely to get beyond 1K datasets in the forseable.
[14:15:27] <seanh> In terms of number of users visiting the site it can be scaled indefinitely I think by load balancing, caching, etc. I don't have figures like you will need X linodes to serve Y hits per second though. Also scaling postgres and solr may not be as simple...
[14:16:07] <wardi> davidmiller: how many extra fields and tags? how often will the datasets be updated?
[14:16:56] <davidmiller> 10-20 extra fields, updated monthly-quarterly
[14:17:16] <davidmiller> wardi: Do extra fields cause issues ? That's interesting to know ! :)
[14:18:04] <wardi> davidmiller: actually they don't really even on this internal site with hundreds of extras in each dataset
[14:18:41] <wardi> we had to tweak some code around tags for our use, but those fixes might already be upstream
[14:19:06] <wardi> I should have just asked how often you'll be updating the datasets
[14:19:24] <davidmiller> wardi: understood :)
[14:22:03] <wardi> davidmiller: and if you're not updating all your datasets every few minutes you're not going to have any problems
[14:22:41] <amln> davidmiller: have you seen https://github.com/ckan/ckan/wiki/Performance-Testing-Protocol-for-CKAN too?
[14:23:56] <davidmiller> amln: I have now !
[14:25:08] <davidmiller> wardi: I suspect it will be fine. I'm mostly trying to guestimate a number for a line in the budget.
[14:26:47] <seanh> Why does ckanext-qa depend on ckanext-archiver?
[14:27:07] <seanh> Archiver is for going over all the resources on the site and downloading all their resource files to the CKAN server (apparently)
[14:27:20] <seanh> Whereas qa is for checking for broken resource links
[14:42:42] <nigelb> seanh: it uses archiver to do the downloading.
[14:43:08] <nigelb> I believe for the same reason datastorer depends on it for some stuff, but when I wrote the paster command, I wrote my own code to do the downloading.
[14:43:14] <seanh> Ok, what's missing from the -qa docs? I need to register the qa.update task type with celery somehow
[14:43:45] <seanh> Ah, I had to restart celery
[14:45:03] <seanh> Do we still follow this for setting up celery in production? http://docs.ckan.org/en/latest/maintaining/background-tasks.html
[14:45:46] <seanh> That's what I'm gonna try anyway I guess
[14:46:24] <wardi> do you have any more info on the "celery segfault" issues in the past?
[14:49:29] <wardi> seanh: ^
[14:52:04] <seanh> Nope
[14:52:50] <seanh> Back when service provider and datapusher were first developed, the message I got was simply celery is bad (it keeps going down, even using supervisor isn't helping) so we need to do our own thing
[14:52:55] <seanh> But I don't have any specifics
[14:53:18] <seanh> I'm about to deploy celery with supervisor, but only on a staging site that's not doing much
[15:12:40] <seanh> I do share nickstenn 's doubts about it to be honest - surely supervisor is old, proven and actively developed software? Unlike our own hacky thing
[15:13:00] <seanh> (and celery etc)
[15:13:17] <seanh> But I dunno, I haven't had to look after them in production
[15:24:06] <joet> there's also things like python rq, writing your own thing always seems like a bad sign.
[15:25:25] <seanh> Am I right in thinking that (even after setting up celery and supervisor) you still need to setup a cron job to run ckanext-qa's paster command??
[15:25:32] <nigelb> plus a queue has certain features.
[15:25:34] <seanh> Otherwise it won't do anything, from what I can tell
[15:25:36] <nigelb> retries
[15:25:36] <nigelb> etc
[15:25:58] <nigelb> seanh: what does the celery command do?
[15:26:25] <nigelb> the paster command might trigger running somthing that'll use the queue
[15:26:50] <seanh> The paster command puts tasks on the celery queue that do the work
[15:27:41] <seanh> But that does beg the question why doesn't the paster  command just do the work itself? I guess you get proper queueing from celery
[15:27:59] <nigelb> yeah
[15:28:09] <nigelb> also, that means the paster command doesn't run forever
[15:28:17] <nigelb> if you run it again, it still goes into the queue
[15:28:21] <nigelb> not run at the same time.
[15:28:34] <seanh> Hmm, ok so -qa will show you resources with broken links but won't remove them for you (or give you a convenient button to remove them or anything), that's something we'll have to add
[15:29:01] <seanh> nigelb: Yeah, but you can end up with a massive ever-growing queue presumably
[15:29:26] <nigelb> there should surely be a way to deal with it.
[15:29:27] <seanh> If the task takes one hour to complete, and I have a cron job creating new tasks every minute, the celery queue will just grow and grow
[15:29:50] <seanh> I guess so, I don't know much about celery
[15:29:52] <nigelb> as opposed to running the one hour task 30 times?
[15:30:11] <seanh> I know but neither seems good really
[15:30:14] <joet> what is this task taking an hour to complete?
[15:30:29] <joet> is it a -qa reporting broken links thing?
[15:30:37] <seanh> Going over every resource on the site and trying to download them all
[15:30:41] <joet> oh
[15:30:46] <seanh> For a big site I could see that potentially taking a lot of time, yeah
[15:30:49] <joet> well
[15:31:02] <joet> it should probably queue each dataset as a single job instead of all resources
[15:31:17] <nigelb> seanh: I recommmend replacing the download algorithm with what I did on datastorer?
[15:31:25] <nigelb> perhaps
[15:31:28] <seanh> What you want is to say: Every hour, check if the qa task is still working, if it has crashed or has finished start a new qa task otherwise do nothin
[15:31:29] <nigelb> that doesn't download all of them.
[15:31:44] <joet> how does david read handle this in ckanext-reports? he has a command as well?
[15:36:14] <seanh> Dunno
[15:36:26] <joet> doesn't look like they've set up any queuing stuff either yet. it's in a TODO
[15:36:39] <joet> so i assume they must just have a nightly cronjob that runs their equivalent command
[15:36:43] <nigelb> this one is slow only by the downloads
[15:36:54] <nigelb> I recommend reducing the downloads by doing HEAD requests and other things.
[15:36:57] <seanh> For Sweden, we need resources with dead links automatically removed and we need to send emails to people when their links die
[15:37:09] <nigelb> downloading all the files doesn't sound like a good idea.
[15:37:27] <seanh> Both seem problematic to me. I can imagine something going wrong that makes the extension see all resources as dead, then it deletes everything
[15:37:53] <seanh> Or say you harvested 10,000 datasets from one site. That site goes down for an hour. All its datasets get deleted from your site.
[15:38:47] <nigelb> we don't actually *delete* anything, do we?
[15:38:49] <nigelb> we have states.
[15:39:27] <seanh> And the emailing - it's supposed to get the email address of the responsible person from the dataset metadata and email them with "your resource link is down". I guess we'll need to support batching ("Your 1000 resource links are down" instead of 1000 separate emails. And also not emailing the same guy repeatedly about the same resources. I still think it's likely to piss people off
[15:39:50] <seanh> I don't think batch-undeleting is particularly well supported in the UI though
[15:40:42] <seanh> Basically I don't think deleting resources whose links are broken is a good idea at all. Maybe mark them as broken somehow on the site, and have a report of broken links (like -qa already does)
[15:43:13] <seanh> Actually what's also been suggested is making a dataset private when any of its resource links are detected as broken. But that might private the dataset's other resources which might be fine. And also, it's just possibly large numbers of datasets "disappearing" from your site from your user's point of view

2014-09-03
[10:16:58] <rossjones> Any news on the status of 2.3 and/or suggested release dates?
[12:01:47] <joet> Just confirming, does not passing the list of users to org/group_update removes all the users?
[12:01:59] <joet> because I think it does remove them all, i haven't double checked
[12:08:05] <wardi> yup
[12:14:11] <joet> i
[12:14:12] <joet> wut
[12:14:47] <joet> can we remove that? There's already all those bulk update actions
[12:15:26] <joet> and if anyone is using that as a way to manage users they should just stop
[12:15:51] <joet> i don't even care if it's a breaking change, we probably have more people working around it than actually using it
[12:17:51] <joet> user_role_bulk_update should also batch things instead of one at a time in a for loop calling user_role_update
[12:19:42] <wardi> ckanapi load orgsnizations has a workaround
[12:20:02] <joet> user_role_update also has a commit_and_remove in there, which feels wrong
[12:20:04] <wardi> but it's a hack
[12:25:45] <joet> ok cheers maybe I will see if i can use it
[13:10:42] <joets> i ended up copying your hack wardi, because just doing a org_show, updating the dict and passing that to update gave me dictization errors.
[13:10:57] <joets> oh ckan, you are so dreamy and wonderful to use sometimes
[13:22:19] <amln> rossjones: ideally before Xmas (subject to confirmation etc.)
[13:30:41] <rossjones> amln 2014?
[13:31:12] <rossjones> I know, would be quicker if I finished my PRs/helped out.
[13:31:28] <amln> rossjones: busted ;)
[13:31:29] <rossjones> Just my standard reaction to someone giving a time of year :|
[13:32:05] <rossjones> What do you reckon would need to happen to get a more frequent release schedule?
[13:37:23] <amln> funding :o)
[13:37:41] <rossjones> amln Yeah, I guess so.
[14:28:09] <davidmiller> rossjones: November is the last date I heard.
[14:29:16] <wardi> some key devs are pretty busy on other work, though
[14:29:20] <davidmiller> I also heard that after that it ceases to be a feature-based release schedule && is every 3months from a stable master with whatever has happened over the preceeding 3m.
[14:30:32] <wardi> davidmiller: if someone's sole dev job was "release manager" we could do that
[14:36:03] <davidmiller> wardi: I don't believe that 4X release/year is a f/t job ;)
[14:36:46] <davidmiller> Just repeating what I heard. It's entirely possible I was misinformed or that things have changed!
[14:37:26] <wardi> ok, I might be exaggerating
[14:39:45] <wardi> but I do know that releases are hard, and the amount of time the person doing them now has is heavily contested
[14:45:52] <davidmiller> Shure. I imagine other people are capable though :)  It's an institutional-structural issue which is news to nobody!
[17:12:18] <andreipe> Hi guys! I cannot manage to set the datastore so that the readonlyuser can read the tables that the write user (ckan_default) creates in database datastore_default. Do you have any clues what am I doing wrong? Here is the pastebin http://pastebin.com/psDifhwd
[19:02:09] <amln> andreipe: the -O flag in line 8 and the user in line 2 don't match
[19:02:19] <amln> you've also not passed the UTF-8 line.
[19:02:37] <amln> http://docs.ckan.org/en/latest/maintaining/datastore.html is the up-to date doc.
[19:04:04] <amln> (or did you previously create that user?)
[19:05:20] * amln is a little tired, but on a quick look, that's what i noticed
[20:17:53] <andreipe> <amln> it's basically a broken install that I'm trying to fix. Some users/databases already exist. Thank you for your input.... I will look at it but not now.
[20:37:45] <andreipe> aml I don't think line 8 is wrong, ckan_default is the owner of datastore_default, it can create tables in datastore_default. readonlyuser is the problem. readonlyuser should be able to read the tables created by ckan_default in db  datastore_default

2014-09-02
[00:48:13] <eeeschwartz> Is it possible to submit a multipart form to datastore_upsert with a file containing the records?
[00:49:06] <eeeschwartz> atm I've only been able to url-encode the records like so:
[00:49:20] <eeeschwartz> curl -v $CKAN_INSTANCE/datastore_upsert -d '{"resource_id": "'$RESOURCE_ID'", "force":"true", "records":'"`cat records.json`"' }'
[01:24:28] <eeeschwartz> big picture, I'm looking for the best way to bulk upsert hundreds or thousands of records at a time
[01:42:34] <wardi> eeeschwartz: probably batching them with calls to datastore_upsert
[01:45:02] <wardi> this is what the datapusher does iiuc
[02:00:50] <eeeschwartz> @wardi - would you mind giving a pseudo-code example of uploading a file so that datapusher upserts its contents?
[02:44:19] <eeeschwartz> I've experimented with uploading a file via resource_update, which datapusher inserts into the datastore but it seems to replace the dataset entirely rather than upserting it
[09:40:53] <azymuth> Ok, well I'll take that to mean its not trivial to get this information.
[10:00:21] <acorbi> Hi everyone
[10:01:45] <acorbi> I am experiencing an issue with the Multilingual Extension on CKAN 2.2 (installed from package). when i add the multilingual_group to the ckan.plugins in the config file, the homepage breaks with ERRO 500 An internal server error occurred
[10:01:57] <acorbi> anyone knows a fix for this?
[10:02:34] <wardi> eeeschwartz: sorry, i meant it batches the rows inserted
[10:04:18] <wardi> azymuth: it's easy from a plugin; if it's fixed it would be easy everywhere
[10:05:09] <azymuth> Sure, that much I understand.
[10:06:21] <azymuth> But it seems to defeat the purpose of an API somewhat if you have to write a plugin to extract data that already exists within an application.
[10:06:30] <wardi> and the fix is probably 5 lines :-)
[10:06:44] <wardi> i agree
[10:07:03] <azymuth> Not complaining, just sayin'
[10:09:05] <wardi> azymuth: do you have any interest in writing that pull request?
[10:13:06] <azymuth> In principle yeah.
[10:13:54] <azymuth> Might be useful as an exercise, we will ll be looking at customising the api down the road, and this might be an opportunity to dig in.
[11:00:27] <wardi> azymuth: I'd be happy to review it. You can take a look at how the package controller uses those parameters
[11:01:26] <wardi> https://plus.google.com/hangouts/_/event/cb1vmkss426lkqicj94a3amvd1c?authuser=0&hl=en-GB
[11:04:33] <azymuth> I had a quick look yesterday, see now what you mean about the context.
[11:04:38] <azymuth> Is that hangout for me?
[11:05:09] <wardi> azymuth: it's the dev meeting, you're welcome to attend if you want to hear people get assigned bugs and pull requests :-)
[11:05:19] <azymuth> Hah, I'll pass thanks :)
[11:05:24] <wardi> there's open discussion at the end too
[11:06:30] <wardi> nigelb: ^
[11:06:39] <wardi> vitorbaptista: ^
[11:07:16] <azymuth> Not quite ready to contribute just yet, but with how things are going might turn up for one before long.
[11:08:25] <nigelb> oh right.
[11:08:44] <nigelb> actually, I'll pass. deep in the middle of debugging something else.
[11:10:33] <wardi> nigelb: it's done
[11:10:44] <nigelb> wardi: record fast
[11:11:01] <wardi> about 2 minutes after we stopped waiting
[11:27:17] <nigelb> wardi: do you have time to look at a revert of the facets today?
[11:32:48] <joet> nigelb, I think he may of run off for now
[11:33:32] <nigelb> looks like
[13:31:34] <wardi> nigelb: link?
[13:56:15] <nigelb> wardi: haven't done it yet! I'll get it done before I sign off :)
[14:01:35] <wardi> ok
[15:56:17] <zr2d2> When I run 'drush ckan-export -nid=191', I get an error that the URL is in use, how do i find the package that uses that URL?
[15:59:11] <wardi> zr2d2: I think that means the package 'name' field conflicts, do a package_show with id=<name>
[16:02:45] <zr2d2> wardi: 'paster --plugin=ckan dataset show medicare-medicaid-incentive' gives me 'Could not find dataset matching reference: 'medicare-medicaid-incentive''
[16:21:56] <seanh> Oh man: IOError: [Errno 37] No locks available from fcntl.flock(), when trying to run a new test that I'm writing
[16:22:26] <seanh> From googling, I think it might be because I'm working on an NFS shared volume in order to share files between my VM and the host
[16:45:27] <zr2d2> when running 'drush ckan_update
[16:45:31] <zr2d2> ', I get the error Another importer process is already running. How do I find the importer process already running?
[16:45:48] <zr2d2> or is that a drupal problem?
[16:48:39] <seanh> Yeah, unsharing the source code folder makes my test-case pass. Oh dear
[18:24:26] <zr2d2> i have a package i can show on the command line with paster, but when i go to the ckan_url, in redirects me to a nonexistant package
[18:25:26] <zr2d2> is there somewhere where redirects are defined? Some routing layer
[18:31:19] <zr2d2> any ideas on why a request for one package would be redirected to another package?
[18:32:16] <wardi> zr2d2: I've never seen that, it must be in the package controller somewhere
[18:57:06] <zr2d2> wardi: do you know what kind of hooh i would be looking for?
[18:57:12] <zr2d2> *hook

2014-09-01
[13:04:41] <azymuth> I've got a question about accessing a resources individual revisions via the API - is anyone around?
[13:07:32] <dragondave> Generally, ask, and people will probably pipe up
[13:14:09] <azymuth> K, I'm trying to extract information on a given resources revisions, i.e. - what the updated file URL is (if any), and any other fields changed on the resource, or all the attributes for the resource relating to that revision.
[13:15:44] <azymuth> having issues figuring out how to get this out of the API.
[13:23:12] <eeeschwartz> Mind posting the request you make to update the resource?
[13:25:45] <azymuth> All updates go through the front end by users in this case, I'm just trying to access the historical edits to individual resources.
[13:26:24] <azymuth> Does that make sense?
[13:27:19] <azymuth> For illustration:
[13:27:44] <azymuth> Consider the following: http://data.glasgow.gov.uk/api/3/action/package_show?id=bicycle-shops
[13:27:44] <azymuth> http://data.glasgow.gov.uk/api/3/action/package_activity_list?id=bicycle-shops
[13:28:07] <azymuth> http://data.glasgow.gov.uk/dataset/activity/bicycle-shops
[13:28:22] <azymuth> You can get a list of resources from the first link
[13:28:51] <azymuth> A list of activity on that package from the second.
[13:28:57] <azymuth> And the third appears to be aware of the resources and what was updated.
[13:30:13] <azymuth> But those resources ID's are not included in the activity list for some reason or another.
[13:31:36] <azymuth> If I'm looking to traverse an individual resources revision history, the necessary information is eluding me here.
[13:40:35] <eeeschwartz> I want to say that updates to resources are "update in place" meaning that the data is not versioned (though the update is logged as seen in the activity stream)
[13:40:52] <eeeschwartz> though I'm new to CKAN so I'd defer to others :)
[14:05:51] <azymuth> That seems to be the case as far as the API is concerned
[14:06:08] <azymuth> But the data is definitely there, and the versioned files are also definitely stored - I've checked.
[14:06:50] <azymuth> But it appears that this kind of information is only accessible at the database level, and not accommodated at the logic / api level.
[14:07:10] <azymuth> If someone could confirm that I'll give up.
[16:03:09] <rossjones> I am making changes to Recline. Does anyone own a shotgun?
[16:13:54] <amln> rossjones: i have four blunderbussen
[16:15:11] <rossjones> Great, I'll meet you round the back. Bring plenty ammo.
[16:31:07] <amln> ammo? you can throw anything down them.
[22:19:00] <wardi> azymuth: revions aren't available by the api, but that should be fixed. It is possible to get old revisions of complete packages from the web interface
[22:20:24] <wardi> the package_show API takes a revision_id or revision_date, but only when passed by the "context", which is something you can only do from within ckan or from a plugin.. but that's silly. those should be part of the data_dict that any user can pass
[22:21:12] <wardi> azymuth: I would love to see a pull request that moves the revision_id and revision_date parameters to package_show's data_dict

2014-08-31
[01:54:06] <zr2d2> when trying to run pastor on a ckan 2.0 install, i get a  No module named fanstatic error, even though i'm running as www-data
[01:57:47] <zr2d2> but when i run pip freeze, i see fantastic installed

2014-08-30
[01:29:08] <eeeschwartz> hi all, I'm running into a problem uploading a file with the FileStore api using the example from the documentation
[01:29:17] <eeeschwartz> `curl -H'Authorization: your-api-key' 'http://yourhost/api/action/resource_update' --form upload=@newfiletoupload --form id=resourceid`
[01:29:37] <eeeschwartz> returns: "Bad request - JSON Error: Error decoding JSON data. Error: JSONDecodeError('Expecting value: line 1 column 2 (char 1)',)..."
[01:31:23] <eeeschwartz> I'd love any thoughts!
[01:32:00] <eeeschwartz> (the response error code is 400 Bad Request)
[01:43:45] <wardi> eeeschwartz: ckan version
[01:44:02] <wardi> ?
[01:48:14] <eeeschwartz> 2.2
[01:48:50] <eeeschwartz> using civicdata.com
[01:49:15] <eeeschwartz> rather www.civicdata.com
[02:33:19] <eeeschwartz> I'm not sure the resource_update endpoint supports update via file as shown in the documentation http://docs.ckan.org/en/latest/maintaining/filestore.html#filestore-api
[02:33:27] <eeeschwartz> but for posterity here is a list of CRUD operations that have worked for me https://gist.github.com/mheadd/a9bb37a51972cbff8ae0
[17:56:21] <zr2d2> Hi, when trying to export a drupal node into a ckan package, i get a name conflict, saying the url already exists
[17:56:59] <zr2d2> i previously deletel the associated package, and am trying to recreate it
[17:57:09] <zr2d2> *deleted
[17:59:22] <zr2d2> if i deleted the node through the API, wouldn't the URL not exist?
[18:38:15] <zr2d2> i think that means that drupal must still have the node object for the package
[18:38:54] <zr2d2> how might i remove that? ddrush ckan-rescan
[18:38:56] <zr2d2> ?
[19:08:11] <SkramX> could anyone point me in the right direction for the datastore code that decides the type of column?
[19:13:31] <zr2d2> when i call_package delete, I get a success: true action:null back, why is that?
[19:13:40] <SkramX> nvm: https://github.com/ckan/datapusher/blob/6175c69e9ab7013272949e6e604fc45d21fce853/datapusher/jobs.py#L282
[19:15:00] <zr2d2> In other words, i get a success message, but the package still exists
[19:15:34] <Vilsepi> zr2d2: deleting a package does not actually get rid of it completely. Its state is merely set to "deleted" but the owner can still see it
[19:15:41] <Vilsepi> see https://github.com/ngds/ckanext-ngds/issues/466
[19:18:37] <Vilsepi> you probably could also update the package instead of recreating, and set its state back to active
[19:19:56] <Vilsepi> in any case, I have made an issue regarding the API https://github.com/ckan/ckan/issues/1572
[19:31:23] <zr2d2> Vilsepi: ah, I had a drupal node that had multiple packages associated with it, so i tried deleteing the package so that it would get recreated
[19:32:27] <zr2d2> Vilsepi: thanks
[19:48:21] <zr2d2> when I try to run the ckan_update drush command, I get "Another importer process is already running.". how do i find this other importer process. no running processies jumped out at me as being drupal related

2014-08-29
[13:57:37] <seanh> I looked at the pages dev branch with the blog on it
[13:57:55] <seanh> Imho it cannot be finished and used for the project I'm working on
[13:58:17] <seanh> For Sweden, we just need a simple blog, but one that has tests and works with 2.2 and can be maintained going forward
[13:59:35] <amercader> seanh: what's missing on the pages one apart from tests and docs?
[14:03:25] <seanh> Besides 0 tests or docs : The one dev branch also has half-a-dozen other major new features implemented on it (uploading files to blog posts, GUI editor for blog posts, embedding resource views in blog posts) (all also no docs and no tests). Doesn't work with CKAN 2.2 (because it depends on resource views). Status of the code on the branch (ready for merge or not?) is unknown. And the code is badly factored imho (pages and posts mixed together in a
[14:03:26] <seanh> complicated way)
[14:04:37] <seanh> What we need for our project is just a simple blog, we don't need static pages, uploading images to blog posts, GUI editor or resource views integration. But we do need it to work with 2.2 and to be simple and have good tests
[14:10:52] <amercader> seanh: perhaps the one in pages is not presentable now but as you say it has much more features and imo is the one that eventually should end up being the "blog" extension in CKAN. Doesn't it make more sense to spend the available time cleaning it up, making it work woth 2.2 and refactor if necessary? Otherwise we will end up with two blog extensions, one well featured but not quite finished and the other limited but well test
[14:10:52] <amercader> ed.
[14:13:00] <seanh> The problem is I think it would take a lot of time and effort for someone who hasn't worked on that branch to get the pages blog finished, and then make the resource views stuff optional so it works with 2.2 as well
[14:13:35] <seanh> Tests for the whole ckanext-pages would need to be written from scratch
[14:14:29] <seanh> But also just the fact that there are a number of different features implemented on the one branch, we don't know who finished each of them is, and we don't have any docs or tests as a guide ... makes it hard for someone to pick up that branch
[14:15:11] <amercader> I agree is not ideal, but should we just throw away all the work put into it?
[14:15:53] <seanh> I don't like the way the code is designed (mixing pages and posts into one model) either
[14:16:41] <seanh> My thought was just: Let's leave the pages blog stuff for its original authors to finish off when they get back to it, right now it'll be quicker and easier for me to write a simple one from scratch, and produce a better result in the short term
[18:41:25] <zr2d2> hi, I have multple ckan packages that have been created from the same drupal node. is there a way to remove these duplicate packages?
[18:56:50] <zr2d2> Can I delete specific CKAN packages? I have multiple ckan packages related to the same node
[18:57:29] <wardi> zr2d2: /api/action/package_delete?id=...
[18:58:47] <zr2d2> I'll have to authenticate through the API, i can do that, right?
[18:59:20] <wardi> zr2d2: sure, get your api key and pass it as a header
[19:14:00] <zr2d2> makes sense, will have to reach out and get the aprpriate credentials for that

[00:49:40] <bjb> I'm looking at dev-requirements.txt in ckan master, and it references git+https://github.com/okfn/ckanclient@a315a72eef74dda4831acd022ef84a1246803c73#egg=ckanclient-dev
[02:47:44] <wardi> bjb: do you know that it's not required? i assumed some harvester tests or something needed it
[02:54:07] <nigelb> wardi: why are you still awake! aaaah.
[05:02:32] <bjb> But is redirected to https://github.com/okfn/ckanclient-deprecated and that references DEPRECATED - please see https://github.com/ckan/ckanapi
[05:02:48] <bjb> Sorry wardi, I got distracted in the middle of this question
[05:03:22] <bjb> should I change dev-requirements.txt, and if so, is there are particular version that should be referenced?
[05:03:36] <bjb> a315a72eef74 doesn't seem to exist in ckanapi
[05:03:58] <bjb> Or should it just be dropped from dev-requirements?
[05:06:27] <bjb> I guess I could just try to run the tests without it and see what happens ... maybe Saturday
[06:08:38] <wardi> nigelb: that wasn't late... this is late
[06:09:58] <wardi> bjb: yeah, i noticed but just never tried
[11:25:47] <acorbi> Hi everyone. I am currently having an issue with the multilingual plugin. When i add 'mulitlingual_group' on the list of plugins under ckan-plugins in the config file, the homepage breaks showing ERROR 500 "Server Error An internal server error occurred" . It dissapears if i remove 'multilingual_group' from the list of plugins
[11:26:06] <acorbi> looking at the logs i found this [Fri Aug 29 10:44:56 2014] [error] [client 127.0.0.1]   {% for resource in h.dict_list_reduce(package.resources, 'format') %} [Fri Aug 29 10:44:56 2014] [error] [client 127.0.0.1] File '/usr/lib/ckan/default/src/ckan/ckan/lib/helpers.py', line 765 in dict_list_reduce
[11:27:20] <acorbi> this is described here: http://demo.geo-solutions.it/share/JRC/deliverables/documentation/online/install/install_ckan_otherext.html#multilingual-extension
[11:27:36] <acorbi> but i haven't found the origin of the issue
[11:27:42] <acorbi> any clues?
[11:28:41] <acorbi> Sorry, the relevant piece of log is this:
[11:28:42] <acorbi> [Fri Aug 29 10:44:56 2014] [error] [client 127.0.0.1]   {% for resource in h.dict_list_reduce(package.resources, 'format') %} [Fri Aug 29 10:44:56 2014] [error] [client 127.0.0.1] File '/usr/lib/ckan/default/src/ckan/ckan/lib/helpers.py', line 765 in dict_list_reduce [Fri Aug 29 10:44:56 2014] [error] [client 127.0.0.1]   value = item.get(key) [Fri Aug 29 10:44:56 2014] [error] [client 127.0.0.1] AttributeError: 'int' object has no attr
[11:37:21] <rossjones> yes
[11:37:26] <rossjones> wrong window, sorry
[13:24:14] <amercader> seanh: can we please, please not do this? https://github.com/ckan/ckanext-blog
[13:24:45] <amercader> there is a blog implemented in ckanext-pages why reimplement it separately?
[13:28:03] <amercader> seanh_: or is it just separating existing pages and blog functionality  in a separate extension?

2014-08-28
[16:51:39] <seanh> The pages extension seems to have decided that wrapping your source code lines to 80 chars doesn't apply anymore
[16:54:31] <wardi> fun. I have a bug report that on one computer a user can't finish creating a dataset
[16:56:46] <seanh> I'm supposed to be finishing off the blog feature of the pages plugin, and then figuring out a way to get the pages tests run against new CKAN versions on Travis. Well, I guess I'll start by writing some tests for it then..
[16:57:36] <seanh> What do people think about CKAN core's Travis build also installing some officially supported extensions and running their tests? At least for something like the pages extension for example, it shouldn't bring in any extra dependencies and its tests should run very fast
[16:59:43] <wardi> seanh: what if the extension tests break separately from ckan?
[17:00:23] <seanh> Yeah, well then I guess someone broke an officially supported extension and it really needs to be fixed?
[17:00:46] <seanh> I mean, right now, I could push to one of our officially supported extensions and break it and probably no one would notice
[17:01:07] <wardi> seanh: I mean if someone breaks the extension then no ckan build will pass
[17:01:15] <seanh> Yeah I know
[17:01:16] <amln> wardi: on the unable to finish creating a dataset bug report, more often than not, there seems to be transient networking issues, IME recently, for same reports.
[17:01:34] <amln> problems between workstation and ckan.
[17:01:49] <amln> but iirc, your ckan -> workstations are on the same network?
[17:03:13] <seanh> I see breaking an officially supported extension as on the same level as breaking the core master branch, so I think I might be okay with the core tests failing. I guess it would mean everyone's dev branches would be failing as well though which is a bother
[17:03:34] <wardi> amln: yeah, same network; consistently fails just from this one computer (browser, most likely)
[17:04:14] <wardi> seanh: but you won't see a failure when you push a broken commit to the extension if the tests only run when ckan is built
[17:04:36] <seanh> Hmm, yeah
[17:05:12] <seanh> What I want is some way of ensuring that if a core change breaks an extension, the core team knows about it and will fix it like we do with the core tests now
[17:06:23] <wardi> have the tests in the extension, but also run those tests from ckan's travis target but against some stable release of each extension.
[17:07:31] <seanh> Yeah, that might work
[17:08:34] <seanh> I would say the stable branch of the extension should be master though, and extension features should be developed on feature branches just like core features are
[17:09:08] <wardi> hmm. I guess we can enforce that
[17:09:22] <wardi> would be nice to have the extension tests as a separate travis target
[17:09:22] <seanh> So when developing on an extension, you see that the extension's own tests pass on your feature branch before you merge it into master, so in theory you should not break the CKAN core tests
[17:09:45] <seanh> Not sure what Travis targets are, you mean like our current Python 2.6
[17:09:52] <seanh> and 2.7 jobs?
[17:10:25] <wardi> yeah, jobs
[17:10:37] <seanh> Yeah that seems like a good idea
[17:10:45] <wardi> that way when something fails you can see at a glance that it wasn't the core tests
[17:11:26] <wardi> it takes a while to scroll through all the noise in the core tests
[17:12:23] <seanh> Just looking at the  blog branch of the pages extension, I'm immediately thinking that separate pages and blog plugins would be nicer
[17:13:26] <seanh> It is sharing code in a typical horrible CKAN way, so now we have a "Page" object that has certain fields in its schema, and then it also has a page_type field and then, only if it's a blog post, it has a publish_date field but it also has an order field that is only used if it's a page ... etc.
[17:13:42] <seanh> Overloading the same tables, objects and methods for multiple purposes and just making a muddle
[17:14:28] <seanh> It's like groups and organizations in core, or tags and tag vocabularies, free extras and custom fields
[17:19:02] <wardi> hmm. is there not much that's actually shared?
[17:19:29] <seanh> I doubt there is much to be gained honestly
[17:20:00] <seanh> A simple blog or pages plugin would be really very simple, there's not much code in the first place so not that much de-duplication to be gained
[17:20:47] <wardi> is anyone likely to start adding a page and then decide "hey, this should be a blog entry" or the opposite?
[17:21:10] <seanh> Maybe when you start getting really fancy with the editor, then there starts to be more shareable code
[17:21:33] <seanh> I don't think we should support that use-case
[17:22:25] <seanh> Even if we did want to share code - just implement the two things, identify the duplication, and move it into shared helper functions. Do we really need to use the same db table and model class, schema etc for both pages and posts? That.s just messy
[17:23:32] <wardi> shouldn't the primary keys be different?
[17:23:59] <wardi> one is a date and/or slug and the other is a full path
[17:24:14] <seanh> In the db? They just use integer pids
[17:24:38] <seanh> But yeah you'd want different types of URLs
[17:25:15] <seanh> There's also loads of getting a list of pages objects and then filtering out the pages, or filtering out the posts, or neither ... Everything has been complicated
[17:25:35] <wardi> that does seem silly
[17:26:29] <seanh> I think the blog branch also adds in a GUI editor and the ability to upload image files to pages/posts and other stuff on the same branch as well
[17:27:36] <seanh> All with no tests or docs ... I'm starting to think leave that branch to its original authors to finish off, right now we want a simple blog plugin so writing one from scratch will be quicker and produce a much simpler result ... I'll look into the branch a bit more though
[17:34:49] <seanh> And you can inject CKAN resource views into pages/posts looks like
[17:40:45] <seanh> Which means it won't work with 2.2 I think
[17:41:08] <seanh> The GUI editor and uploading files to pages is quite a nice feature though. You can set blog posts to be published in the future as well
[17:48:26] <wardi> seanh: is there a reason we're not rebuilding rtd docs on every commit?
[17:48:43] <seanh> Aren't we?
[17:48:51] <wardi> (I was looking for my recent IValidators stuff)
[17:48:57] <seanh> Hmm
[17:49:19] <wardi> we can. I can add the webhook to the github repo
[17:49:39] <seanh> Yeah, I thought it was already there
[17:49:55] <wardi> ok, I'll do that
[17:50:40] <seanh> Last docs build was 6 hours ago..
[17:51:10] <seanh> The build is failing on RTD
[17:51:33] <wardi> ah, that's not good
[17:52:37] <seanh> Sphinx is printing a usage message
[17:52:42] <seanh> https://readthedocs.org/builds/ckan/1637519/
[17:55:23] <seanh> Been doing it for over a week, this kinda looks like an RTD problem though
[17:59:08] <seanh> Over 3 weeks, sorry, I don't see the problem though, can look more tomorrow

[10:52:01] <nigelb> https://plus.google.com/hangouts/_/event/cb1vmkss426lkqicj94a3amvd1c?authuser=0&hl=en-GB
[10:52:09] <nigelb> https://pad.okfn.org/p/ckan-meeting
[11:01:11] <seanh> Can't make it today sorry - another meeting
[11:26:47] <nigelb> wardi: considering we're not committing time, can I add "switch to Flask" as an item? ;)
[11:27:10] <wardi> nigelb: yes!
[11:27:21] <wardi> but.. that's pretty long term
[11:27:28] <nigelb> :)
[11:32:33] <wardi> python3!
[11:38:23] <joet> move off pylons!
[11:41:07] <joet> wardi, i was too scared to add that to the list
[11:41:12] <wardi> :-)
[11:41:39] <wardi> if it;s not there, people might think we don't think it's important
[11:42:59] <nigelb> wardi: to be fair, moving to pyramid might be a better goal
[11:43:07] <nigelb> pylons and pyramid are similar enough
[11:43:20] <wardi> nigelb: I'd be happy with that
[11:48:31] <nigelb> also reducing the amount of facepalm we do.
[11:49:43] <rossjones> nigelb does pyramid have a large community?
[11:50:00] <rossjones> I think that it might be an important aspect of the choice too.
[11:50:21] <nigelb> rossjones: In that case, I'd say django is a better choice :)
[11:50:31] * rossjones shrugs
[11:51:02] <wardi> django's even less likely to happen, too many changes
[11:53:38] <amercader> I'm probably oversimplifying things, but would move to flask/pyramid be that much of a pain? I guess it's the controllers that need to be rejigged but the rest of stuff (logic, model, templates) is pretty separate and compatible with both
[11:53:48] <amercader> maybe the main problem is paster
[11:54:56] <joet> amercader, all the template helpers are intertwined with pylons
[11:55:21] <amercader> joet: you mean url_for and stuff like that?
[11:55:25] <joet> many of  the templates use the c object other pylons specific stuff, especially in group controller
[11:55:42] <joet> lots of them use the pylons request/response objects
[11:55:56] <joet> yeah
[11:55:58] <amercader> joet: but that's bad anyway, and replacing them is tedious but not complicated
[11:56:18] <amercader> url_for and others have wrappers already, which e coudl refactor
[11:56:45] <joet> yeah, I don't mean they're not compatible, but there's lots of code there that needs to be refactored
[11:56:45] <nigelb> I think a good first step is removing all the blockers like usage of c in templates
[11:56:57] <nigelb> I'll also point out that most frameworks have a c anyway.
[11:57:24] <joet> that doesn't mean they behave in the sameway and the code slips right in
[11:57:48] <nigelb> indeed
[11:57:52] <amercader> not with that attitude
[11:57:55] <nigelb> lol
[11:57:56] <amercader> :)
[11:58:12] <nigelb> my worry is extensions.
[11:58:14] <joet> (i already tried to get flask working along side pylons during okfestival, it worked, but i had to remove alot of stuff)
[11:58:22] <nigelb> flask routing is different from pylons
[11:58:37] <joet> nigelb, we'd basically have to call it ckan3 and say it is going to break all your toys
[11:58:49] <nigelb> joet: probably yes :)
[11:58:53] <nigelb> we take templates and run with it.
[12:02:07] <wardi> templates, action layer, models.. some of the plugin interfaces?
[12:03:02] <rossjones> Problem is most extensions load core ckan libs directly, I know tobes tried to fix that, but not sure it is a solved problem.
[12:03:28] <rossjones> Have a feeling a refactor to another platform will never happen.  Lots of work, and doubt it would happen unfunded.
[12:04:09] <nigelb> I don't think it's a very attractive things to seek funding for too.
[12:04:16] <nigelb> unless we start a kickstarter
[12:04:28] <nigelb> but then we're not selling to public, we're selling to governments.
[12:04:40] <rossjones> Who you'd have thought would have money.
[12:04:56] <amercader> woohoo! we have logs! https://botbot.me/freenode/ckan/
[12:05:58] * TOPIC: The open source platform for open data: datahub.io & ckan.org | Meeting info and notes: https://github.com/ckan/ckan/wiki/Dev-Meeting-Notes | This channel is logged https://botbot.me/freenode/ckan/
[12:06:18] <maxious_> they would definately prefer django for the security eyes looking at it
[12:06:27] <amercader> nigelb: maybe we shorten the dev meeting notes link
[12:06:43] <amercader> the topic is getting too long :)
[12:06:44] <rossjones> maxious_ would then just be shipping a django app (and other related django apps).
[12:06:53] <rossjones> but maybe that's a good thing
[12:07:39] <wardi> django would be a complete rewrite
[12:07:50] <nigelb> jinja and django templates are not the same :(
[12:08:02] <rossjones> nigelb can use jinja with django
[12:08:23] <wardi> neither is sqlalchemy and django orm
[12:08:24] <rossjones> wardi yeah, lose most of the benefit if you use sqlalchemy with django (admin etc)
[12:09:02] <wardi> and the name dkan is already taken
[12:09:13] <rgrp> my 2c - and we have a nice github issue for this where i think this being discussed - is that a gradual migration to flask is quite possible but django would be very hard ...
[12:09:22] <nigelb> wardi: djkan :)
[12:09:23] <joet> not a fan of the admin, since i last checked which was 1.4
[12:09:45] <rgrp> github issue https://github.com/ckan/ideas-and-roadmap/issues/30
[12:09:49] <wardi> rails has a good admin :-D
[12:09:56] <nigelb> hey now
[12:10:07] <rgrp> joet: could you link to your fork / work on flask alongside in that issue ...
[12:10:54] <joet> i'll have to dig it up, it's in some stash somewhere on my system
[12:11:26] <rgrp> joet: getting that up as a branch in your repo (if it were v cheap to do) would be useful
[12:13:36] <nigelb> rossjones: I have volunteered to manage your resource groups branch.
[12:13:45] <nigelb> you can pay me in scotches later ;)
[12:14:51] <rossjones> nigelb no problem. Don't think it will be hard, just dull.
[12:15:17] <rossjones> And potentially breaking for anyone who does use resourcegroups.
[12:15:53] <rgrp> rossjones: is there *anyone* who uses resourcegroups? I doubt it ...
[12:16:27] <rossjones> Not as resource groups, but they may be created manually. I think DGU does it.
[12:16:37] <rossjones> I mean not for UI purposes.
[12:17:18] <rossjones> I long ago gave up any hope that there was any area of CKAN that somebody, somewhere wasn't using :( It's why I think a proper platform would be better, would stop reinvention.
[12:19:04] <rgrp> rossjones: right but we have to take some things out - and resourcegroups is agreed ...
[12:19:52] <rgrp> btw i've tried to start summarizign pros/cons at top of https://github.com/ckan/ideas-and-roadmap/issues/30 ( rossjones hope you don't mind me hijacking the description but thought we needed a bit of an up to date summary - please dive in and amend)
[12:22:07] <rossjones> When you say summarizing you mean you edited?
[12:22:49] <rossjones> :)
[12:23:11] <rgrp> rossjones: i mean - the original entry (which i've kept) is more about the general architecture ...
[12:23:18] <rossjones> I'm going to edit as you've attributed some comments about django that I don't agree with :)
[12:23:26] <rgrp> based on your rename of the issue i've tried to add some stuff re the frameworks question specifically
[12:23:32] <rgrp> rossjones: go for it ;-)
[12:23:52] <rgrp> i imagine others are much more knowledgeable here - and more specific the better
[12:24:56] <rossjones> The bigger problem is how will it get funded? Does the CKAN Assoc have a timescale for when it will exist?
[12:25:14] <rgrp> ckan assoc exists already ...
[12:25:41] <rgrp> as discussed at the tech team call tuesday one of first items right now would be to get a better "roadmap" of what is wanted ...
[12:28:23] <rossjones> Perhaps I am too cynical, will look forward to the minutes of the first meeting ;)
[12:29:02] <rgrp> rossjones: here's the roadmap doc https://docs.google.com/a/okfn.org/document/d/1B3NXewTdgCa1uwK6n0f9dHSKTJyzh27NTmzSmLzVEFk/edit?usp=drive_web
[12:37:08] <rossjones> rgrp are there any notes on the general set up of the assoc? hiring tech lead, or what/how stuff is funded?
[12:37:36] <rgrp> there are all the docs online e.g. http://ckan.org/about/association/
[12:38:08] <rossjones> but of the roadmap above, is any of that funded?
[12:38:12] <rgrp> and the steering group is booting up and i think will draft a business plan - we hope to be able to announce some further info stuff soon (it's always a bit slow getting sign-off from gov on these things)
[12:38:38] <rgrp> rossjones: that roadmap is the wishlist at present - not the funding commitments - but it is a partly a pre-requisite without a set of clear asks we can't do stuff
[12:39:10] <rossjones> understood.
[12:52:42] <seanh> I was reading the Pyramid docs last week and I thought it looked really nice actually. I like Flask as well, though
[13:36:48] <wardi> pyramid's community might be smaller, but it makes up for that with rabid enthusiasm at conferences

2014-08-27

2014-08-26

[09:55:51] <seanh> Didn't we have a simple blog plugin for CKAN somewhere? I thought ckanext-pages included it, but apparently not
[10:21:55] <rgrp> btw is there a tech team meeting today?
[10:54:57] <nigelb> https://github.com/ckan/ckan/wiki/Dev-Meeting-Notes
[10:55:05] <nigelb> https://plus.google.com/hangouts/_/event/cb1vmkss426lkqicj94a3amvd1c?authuser=0&hl=en-GB
[10:55:15] <nigelb> https://pad.okfn.org/p/ckan-meeting
[11:23:54] <rgrp> nigelb: i'm getting delayed ...
[11:24:30] <nigelb> rgrp: we're jsut about closing up.
[11:24:37] <nigelb> rgrp: how much time do you need?
[11:24:41] <rgrp> just joined
[11:24:48] <nigelb> awesome :)
[11:42:54] <nigelb> this is the pull request that I'm stuck on, for context - https://github.com/ckan/ckan/pull/1707
[12:16:01] <seanh> amercader: The load and unload of example_idatasetform in your test_conversions.py seems to make the multilingual tests fail, not sure why yet
[12:19:06] <amercader> seanh: I've got that sometimes, but not always. the follower failures happen when running all tests thougt
[12:19:11] <amercader> though
[12:19:43] <amercader> I can sse how the multilingual one could fail becasue of the plugin loading but the others?
[12:20:17] <amercader> and there are loads of follower tests that pass on the same class!
[12:25:38] <seanh> Don't know about the follower tests
[12:26:14] <seanh> But if I run test_conversions.py and test_multilingual_plugin.py together in one nosetests  command then the two multilingual tests fail reliably
[12:26:29] <seanh> If I comment out the load example_idatasetform in test_conversions, then they pass
[12:26:45] <seanh> My guess is that unloading idatasetform plugins doesn't actually unload them
[12:26:57] <seanh> Something is registered somewhere in CKAN and stays registered
[12:27:44] <amercader> :(
[12:28:28] <amercader> seanh: what nose command are you using?
[12:28:39] <amercader> to try the same one
[12:30:35] <seanh> nosetests --ckan --with-pylons=test-core.ini --reset-db ckan/new_tests/logic/test_conversion.py  ckanext/multilingual/tests/test_multilingua
[12:30:35] <seanh> l_plugin.py
[12:31:10] <seanh> Debugging package_show I think should work but it's kind of a pita to break at package_show just the one time it's called that you care about any not all the others
[12:33:38] <seanh> But just grepping the  code, it does look like lib/plugins.py registers idatasetform plugins once and never unregisters them
[12:37:01] <seanh> No wait, it's not IDatasetForm (altough IDatasetForm unloading does look potentially dodgy). it's add_template_directory()
[12:37:16] <seanh> example_idatasetform overrides templates, and this is not undone when you unload it
[12:37:38] <seanh> If you comment out the add_template_directory() these multilingual tests will pass again
[12:38:23] <seanh> That's not easy to fix properly, iirc CKAN does not keep track of which plugin each custom template directory comes from
[12:38:28] <seanh> So it cannot unload them
[12:38:54] <seanh> I specced out a replacement for this when I thought I was going to do a theme-changer plugin for CKAN-X but I never got to implement it in the end
[12:39:22] <seanh> amercader: So why are you using example_idatasetform in your tests?
[12:39:51] <seanh> I wonder if you can use a different plugin, one that achieves the same thing without adding the custom templates. Or make adding the templates optional in example idatasetform
[12:40:21] <amercader> seanh: because it has a convert_to_extras field, and I didn't want to add a whoel new plugin just for that
[12:41:06] <amercader> seanh: can we use a plugin on a test without having to register it on setup.py?
[12:41:50] <seanh> That depends on what part of CKAN you're testing :(
[12:42:23] <seanh> I would add a whole new plugin if I was you, I think it's bad to overload example_idatasetform and make it be used for many different things
[12:42:47] <seanh> Or, you may be able to mock whatever particular part of CKAN you're testing to make it think a test plugin is loaded?
[12:43:40] <amercader> seanh: actually I could just pass a custom schema directly
[12:43:43] <seanh> Your tests seem to be calling lookup_package_plugin() to get a schema - that's the schema from idatasetform?
[12:43:54] <amercader> yeah, which is overkill
[12:43:59] <seanh> Can't you just put your own test schema in your test, and pass that to validate()?
[12:44:07] <amercader> yup ^
[12:44:08] <seanh> Yep :)
[12:44:34] <seanh> And remember - loading and unloading plugins in CKAN is totally untrustworthy
[12:44:46] <amercader> I hope that solves the followers tests too, via some weird ckan voodoo :)
[12:45:26] <seanh> THere's never any reason to unload a plugin except in the tests, unloading is completely different for each plugin interface and can be broken for one of them, and if no test happens to run into it no one will know
[12:45:53] <seanh> I'm running the tests now, my bet is it does solve the followers
[12:58:38] <seanh> amercader: Looks like that does fix them all :) I'll leave it to you to change test_conversions.py then
[12:58:50] <amercader> seanh: already pushed
[12:59:04] <amercader> let's see how travis behaves
[13:27:26] <amercader> wtf, the output of resource_show does not include a package_id?
[13:28:12] <seanh> Nope :)
[13:29:02] <amercader> ( 
[13:29:45] <wardi> amercader: if we finished removing resource groups it would
[13:30:00] <seanh> amercader: If this is the first time you've come across that, I sugges you take the rest of the afternoon off and go for a walk in a park :)
[13:30:49] <amercader> wardi: ok, so on the meantime I guess we can just add it on resource_dictize or whatever?
[13:31:08] <seanh> Lol, https://github.com/Softhouse/ckanext-opendata/blob/master/ckanext/opendata/plugins_toolkit.py
[13:31:28] <amercader> brilliant
[13:31:56] <wardi> seanh: I already fixed that
[13:32:55] <wardi> amercader: no, it's a nice incentive to remove resourcegroups :-(
[13:36:43] <amercader> rossjones: have you made progress with ^? Travis says it's almost there
[13:37:46] <wardi> seanh: https://github.com/wardi/ckan/commit/08a1fb34e
[13:38:54] <seanh> wardi: But you didn't go the whole way and actually just make it a module containing wrapper functions for the original functions?
[13:39:21] <wardi> that change lets you import all the toolkit names in the normal way
[13:39:23] <seanh> But yeah, if it'll stop pylint from complaining "this doesn't exist" whenever you use any toolkit function, that's good!
[13:44:35] <rossjones> amercader nope, really swamped on getting datapress done, and it hasn't come up as a priority (i.e. other things exist which are worse).
[13:46:21] <amercader> rossjones: sure, if you leave a status comment on the PR maybe someone else can pick up where you left?
[13:46:42] <rossjones> Good plan.
[13:48:31] <rossjones> done
[13:55:13] <mattle> Hi! I'm trying to export the users, orgs and datasets from a CKAN instance to re-import to another instance, and I'm wondering about exporting the users for reimport since I can't get the password hashes through the API or paster as a sysadmin. I can (and currently do) just pull the entire user table from the database, but that seems like there should be a cleaner way for me to do it.
[13:55:45] <mattle> it looks like a similar issue was mentioned by wardi a few months ago already: https://github.com/ckan/ideas-and-roadmap/issues/54
[14:06:02] <wardi> mattle: iirc the API needs to be updated to allow sensitive information when a sysadmin does user_show, i.e. add options like include_password_hash=True
[14:09:29] <mattle> That's what I figured. Let me see if I can set aside a bit of time to do it (might not be possible until after Sept 5th)
[14:11:23] <wardi> currently there are values like that but they are passed in the context dict (bad) instead of the data_dict (good!)
[14:12:11] <wardi> also I don't know if user_create lets you set a password hash directly
[14:13:07] <mattle> that should be relatively straightforward to add, and probably a good feature to have
[14:13:18] <amercader> seanh: getting rid of example_idatasetform fixed all tests on the convert_to_extras thing, thanks for having a look
[15:39:43] <wardi> seanh: ckanext-opendata srsly?
[15:43:53] <seanh> Not my fault
[15:44:13] <seanh> I'm gonna ask them about renamin it
[15:46:14] <seanh> Wow, I've got a crasher in dict_list_reduce()
[16:29:39] <seanh> Did we recently discuss a way to get around Pylons TypeError: No object (name: request) has been registered for this thread errors when calling action functions from paster commands?
[16:30:03] <seanh> I've got one, wondering if I need to rewrite my paster command as an action function and call it from paster post
[16:31:49] <wardi> which action function?
[16:32:32] <seanh> group_show
[16:33:33] <seanh> Actually it's not group_show's fault though, it's the multilingual plugin that kicks in when you call group_show and tries to access pylons.request.environ['CKAN_LANG']
[16:33:45] <seanh> So I can just turn it off then run my paster command
[16:41:54] <seanh> https://github.com/ckan/ckan/pull/1898
[16:42:42] <wardi> yeah, I haven't run into that problem yet. maybe we can fix the multilingual plugin
[16:43:39] <wardi> oh, you just did :-)
[16:43:51] <seanh> What we should really do, is wrap things like pylons.request, then we would only need to fix this error in one place
[16:44:36] <wardi> yeah. that would also help towards getting rid of pylons
[16:45:48] <wardi> I think I wrote a similar workaround in the datastore

2014-08-25
[01:02:55] <bjb> Ok, so I put a log statement in ckan/ckan/controllers/group.py in index, and I see it, but I don't see the log statement in group_create (from the tutorial) when I visit the group page
[01:05:36] <bjb> Hmm, maybe that has something to do with logging in the extension instead of core.
[01:12:32] <bjb> I'm not sure the plugin class __init__ is even being called, unless I didn't make logging work for the extension properly
[01:19:29] <bjb> So I added some code that would create a different file in each of group_create, ExampleIAuthFunctionsPlugin.__init__ and ExampleIAuthFunctionsPlugin.get_auth_functions and none of them got created
[01:20:19] <bjb> example_iauthfunctions is definitely in development.ini ckan.plugins assignment ...
[01:20:23] <bjb> hmm
[02:21:40] <bjb> Ok, so I made another trivial extension (based on IRoutes) and I can see logging from it.
[02:22:19] <bjb> So I'm not sure why I cannot see logging from the tutorial extension ExampleIAuthFunctionsPlugin
[02:23:26] <nigelb> bjb: I know why.
[02:23:46] <nigelb> in our zeal to make plugins testable, we've unfortunately, did something silly.
[02:24:11] <nigelb> there is a core extension (which is there for testing) with the same name.
[02:24:21] <nigelb> so if you can give you plugin a different name in setup.py
[02:24:44] <nigelb> and call it by that different name in development.ini, you should see it work.
[02:40:43] <bjb> nigelb: great!  I will try later ... getting late here.
[02:40:48] <bjb> thanks for pointer
[14:56:51] <bjb> nigelb, yes renaming the class worked - the extension executes now
[14:56:55] <bjb> thanks again
[14:59:12] <acorbi> Hello Everyone. Somebody here coordinating CKAN's translations on Transifex?
[15:00:43] <wardi> acorbi: Transifex is used for stable releases, github for master (IIUC)
[15:03:09] <wardi> vitorbaptista: ^ do you know who's taking care of transifex?
[15:03:25] <acorbi> hi wardi. i see, i am looking for somebody with rights on transifex to approve requests for new languages.
[15:03:38] <acorbi> i know amercader is sometimes here, he answered me already some questions regarding localisation
[15:05:01] <wardi> yeah, he knows for sure
[15:05:33] <acorbi> i have written him an email already, but also wanted to ask here around
[15:49:07] <rgrp> acorbi: i can get this approved - we do need a new transifer master i think ...
[15:49:16] <rgrp> acorbi: can you point me to what you want approved
[15:51:29] <rgrp> wardi: i've also added transifex coordinator to list of roles here https://docs.google.com/a/okfn.org/document/d/1vAxwTAVCEW0WMzD2UOOrIGDAKKYCOnQCQzPOYUj_4YI/edit#
[15:52:06] <rgrp> wardi: if you have an account on transifex i can make you a ckan admin too
[15:53:08] <rgrp> acorbi: i will set up langs for you now ...
[15:55:57] <acorbi> Great, thanks guys
[15:56:05] <acorbi> my Transifex username is acorbi
[15:56:39] <acorbi> i requested support for Lao and Thai
[15:57:27] <rgrp> done
[15:57:32] <acorbi> Also, if possible,i would like to become a coordinator of the Thai, Burmese, Vietnamese, Khmer and Lao groups in order to be able to manage the translations.
[15:57:34] <rgrp> i will add you to the other translations as a manager now
[15:57:47] <acorbi> I am currently working as a freelance consultant and developer for a non-profit-organisation which is planning to setup a CKAN instance for the Mekong region. Part of the project involves translating CKAN's UI in the languages specified above.
[16:00:19] <rgrp> acorbi: no problem - delighted to have your contribution!
[16:01:28] <acorbi> Thanks a lot rgrp, much appreciated!
[16:02:58] <rgrp> ok - you are a coordinator on all of those so you should be able to approve people etc
[16:03:07] <acorbi> great
[17:04:39] <nigelb> bjb: cheers, glad you got it working
[17:10:36] <wardi> rgrp: thanks, I don't know how to transifex, though, so I'd probably just break something :-)

2014-08-24
[02:54:41] <bjb> I'm following the instructions on https://github.com/ckan/ckan/wiki/How-to-install-CKAN-2.0-on-CentOS-6.3-%28new%29 and I see a small inconsistency - what's the preferred way of reporting it?
[02:55:09] <bjb> In step 4 it says "create production.ini" but then it says "and now edit your development.ini"
[03:09:59] <bjb> And the url isn't quite right - now they call it solr-9.9.9.tgz instead of apache-solr-9.9.9.tgz
[03:11:01] <bjb> although I suppose if I was sticking to solr 1.4.1 as it says in the instructions I wouldn't have to change
[15:21:37] <bjb> Well I gave up on those instructions and reverted to http://docs.ckan.org/en/ckan-2.2/install-from-source.html
[15:22:15] <bjb> hopefully those semanage commands won't be a problem
[15:22:28] <bjb> I know nothing about selinux stuff
[15:50:57] <wardi> bjb: submit a pull request. all the docs are in the docs dir
[16:20:15] <bjb> k thanks
[16:20:22] <bjb> I'll look for wiki pages in the docs dir
[16:23:18] <bjb> I'm running into a networking issue ... argh
[16:25:16] <bjb> when I ssh to the vm, I get there.  When I try to visit with http, I get no route to host
[16:25:25] <bjb> I can ping it
[16:25:47] <bjb> why?  why me?!?   <misery>
[16:26:46] <bjb> wait, it's a new error in the browser ... cannot connect.  At least it's not no route ...
[16:46:19] <bjb> maybe it's an selinux thing : -(
[16:47:20] <bjb> maybe one day I'll actually get to do ckan stuff : -(
[18:09:37] <rgrp> bjb: is this for the deploy - for testing / dev you could deploy on your own local machine or e.g. a digitalocean mafchine ...
[18:54:49] <bjb> I gave up on the CentOS install, did a source install on ubuntu, am trying the extension tutorial.
[18:55:21] <bjb> I have got to the point where I have created an extension on iauthfunctions that does nothing, but installs ok
[18:55:45] <bjb> I now created a non-sysadmin user and looked at the groups page.  The "add group" button is not there.
[18:56:29] <bjb> But later in the tutorial, after you implement the extension, you are supposed to see the button "disappear" for non-sysadmin users.
[18:56:41] <bjb> But the button is already not there ... now what?
[18:57:05] <bjb> I guess I will try to continue but it will be hard to tell if I did it right
[18:59:34] <bjb> also, (note to self) I'm doing this with v2.2, should look at latest to see what it says
[19:08:49] <bjb> So, I implemented the ExampleIAuthFunctionsPlugin with what it says in the extension tutorial, and the add group button is still not there
[19:09:20] <bjb> So I changed the group_create function to return 'success' : True in its return dict and the add group button is still not there
[19:09:27] <bjb> Not sure if it should have appeared ...
[19:10:36] <bjb> I guess I need to learn about logging/tracing, to see if this things is actually getting called

2014-08-23

2014-08-22
[13:05:07] <mythodia> Hello to everybody. I have a question, is there a way to have a "joomla" style installation of ckan?
[13:27:43] <amln> mythodia: what do you mean? one-button-click like places such as MediaTemple offer?
[13:28:33] <amln> or more something like integrating ckan alongside joomla! ? the second case, there are drupals and wordpresses running in parallel.
[13:31:32] <mythodia> I am new so I am trying to find more information. From what I've read it's better to have a standalone deployment but as you said an one-button-click
[13:41:38] <amln> the one-button-click doesn't exist. yet. https://github.com/ckan/ideas-and-roadmap/ is open for suggestions, though.
[13:42:59] <amln> the thread that starts at https://lists.okfn.org/pipermail/ckan-dev/2014-February/006918.html may be useful, though.
[13:46:24] <mythodia> Thanks
[14:48:05] <MarcioP> Hi there fellows! Im from Macei, a city in eastern Brazil, and we are on our way from the 1.7.2 CKAN to a new 2.2 instalation, from zero! We've been doing fine by now until we has some problems loading admin-ckan/trash for erasing databases, and also, I tested the datapusher and its not working although it was setup in the way of the oficial instalation manual.. as its said its automatic
[14:48:05] <MarcioP> instalation from 2.2+ just added datepusher to ckan.plugins.. but when i try pushing to it.. it fails. So, when i try to access localhost:8080 which is supposed to be datapusher port on apache, i got nothing, and my httpd.conf doenst show a vhost for datapusher, also ports.conf, none! there is nothing on my apache for datapusher.. was not the instalation automatic or I still have to setup apache
[14:48:05] <MarcioP> for datepusher? Hope not to have asked too much.. would appreciate if anyone have their time to share. Cheers and keep up the excelent work!
[15:41:34] <rgrp_> MarcioP: people can probably help but note that datapusher not essential - so wonder if you get it working w/o datapusher and then we come back to it (?)
[16:30:33] <MarcioP> so i take out datapusher and then try everything again? ok.. one sec.
[16:30:52] <MarcioP> I think already did that but will double check =) thanks for the suggestion, rgrp
[16:30:55] <MarcioP> :]
[19:08:47] <opendatadev> I'm having problems authenticating with CKAN. I'm following the instructions in http://docs.ckan.org/en/ckan-2.2/api.html#authentication-and-api-keys, but both options for the authentication header get me a "result" of false
[19:09:07] <opendatadev> I've tested with both ruby and httpie
[19:10:00] <opendatadev> Anybody here?
[19:16:29] <opendatadev> Mighty quiet
[19:48:34] <wardi> opendatadev: anything between you and ckan? a proxy?
[19:48:48] <wardi> something that might be removing the header?
[19:57:02] <opendatadev> Nope
[19:57:29] <opendatadev> No proxies, and I can pass headers just fine to other APIs

2014-08-21
[10:58:32] <amercader_> nigelb, wardi: sorry, can't make dev meeting today
[10:59:18] <wardi> https://plus.google.com/hangouts/_/event/cb1vmkss426lkqicj94a3amvd1c?authuser=0&hl=en-GB
[11:00:15] <nigelb> neither can I :(
[13:37:23] <joet> anyone ever overriden the default UserController to insert their own schema with user_new/edit_schema before?
[13:43:26] <joet> there is no IUserController interface, so for my own custom user schema, do I really need to subclass the controller and recreate all the user mappings to my controller?
[13:43:44] <joet> all to change the name_validator so that it accepts the '@' symbol?
[13:45:47] <amercader_> joet: that's sounds horrible :(
[13:46:05] <amercader_> joet: maybe we can just override user_create/update and deal with it there?
[13:46:25] <joet> amercader_, that was the plan, and people creating users on the frontend will just have to deal with it
[13:51:12] <seanh__> I'm getting this when trying to run the tests on master:
[13:51:15] <seanh__> SearchIndexError: Solr returned an error: 400 ERROR: [8b87bcba16f5e484719d7fcfc2cfd780] multiple values encountered for non multiValued field res_extras_alt_url: [, ] - <html>
[13:51:42] <amercader_> seanh__: Solr schema has changed, you need to point to the latest schema.xml
[13:51:49] <seanh__> Ah, cheers
[13:52:14] <amercader_> seanh__: or the other way aorund, you are ppointing to the new schema from an older ckan
[13:53:32] <seanh__> This is because symlinking to the solr schema doesn't work for me, so I copy it
[14:00:05] <nigelb> It doesn't work for me either.
[14:00:11] <nigelb> so I'm glad I'm not the only one.
[14:13:08] <amercader_> I might have written my longest issue description ever https://github.com/ckan/ckan/pull/1894
[14:13:37] <amercader_> but it's dictization/validation, so I really wanted to give a good context :)
[14:15:04] <travis-ci> [travis-ci] ckan/ckan master 925ba6e http://travis-ci.org/ckan/ckan/builds/33173977 Sean Hammond: The build was broken.
[14:26:30] <joet> amercader, wow.
[14:27:57] <amercader_> it looks worse than it is
[14:31:13] <seanh__> It's actually a documented  fact that "free extras" can't be used at the same time as convert_to_extras
[14:31:22] <seanh__> If you've fixed that, great!
[14:31:51] <amercader_> funny how we turn bugs into facts :)
[14:32:14] <seanh__> Yeah
[14:32:44] <seanh__> It's kind of hard to write docs if you try to fix *every* bug you find, some of them I simply documented!
[14:33:26] <amercader_> absolutely
[14:38:00] <seanh__> This is one of the least helpful errors: The input field __junk was not expected
[14:38:08] <seanh__> Obviously, I did not post a field called __junk
[14:40:00] <joet> yeah anything not in the schema gets dumped into junk at somepoint
[14:40:51] <amercader_> I think [__junk]: [ignore] should work if you don't want to bother debugging it
[14:41:21] <seanh__> I should fix it properly, it's a failing teat
[14:41:23] <seanh__> test
[14:41:48] <seanh__> Ouch, run the whole test suite: 1 fail. Run that one test: pass. Run just that test method's class: 2 fails.
[14:49:47] <amercader_> seanh__: is this the docs that you were mentioning? I want to remove the "don't use free extras" bit
[14:49:48] <amercader_> http://docs.ckan.org/en/latest/extensions/adding-custom-fields.html#updating-templates
[14:50:07] <wardi> hmm. solr symlinking is fine here
[14:51:12] <wardi> amercader_: how *can* we support freeform extras and convert_to_extras?
[14:51:44] <wardi> if a user knows the name of the field can't they bypass validation on that field by passing it freeform?
[14:52:08] <wardi> we would need to namespace the freeform ones somehow
[14:58:38] <amercader_> wardi: you are probably right
[14:59:16] <amercader_> gah, I though I had tamed validation :(
[15:00:06] <wardi> the solution I was thinking was introducing convert_to_combined_extras that stores the schema fields in a json blob separate from the freeform extras
[15:00:36] <wardi> ideally in a new real column in package
[15:01:19] <wardi> better for performance too (for custom schemas, not freeform)
[15:02:25] <amercader_> wardi: this sounds a bit complex to me, what about checking if the extras key is defined in the schema and failing if so?
[15:02:57] <wardi> that's a good, simple solution
[15:03:13] <amercader_> so you can't have {'quality': 2, {'extras: [{'quality': 'wrong'}]}
[15:04:08] <wardi> hmm. extras aren't that pretty
[15:04:39] <amercader_> sorry, {'quality': 2, {'extras: [{''key': quality', 'value': 'wrong'}]}
[15:05:11] <wardi> don't they also have 'revision' and 'id' or something
[15:05:31] <wardi> sorry, picking on pet peeves of mine, not relevant
[15:05:41] <amercader_> on _show, but these is the only thing needed when creating/updating them
[15:06:50] <amercader_> so it would be another validator in here https://github.com/ckan/ckan/blob/master/ckan/logic/schema.py#L376
[15:07:27] <amercader_> not sure about the name though, key_not_in_schema ?
[15:07:43] <wardi> but validators aren't passed the schema
[15:07:55] <wardi> I think it needs to be in _validate
[15:08:14] <wardi> which is kind of terrible
[15:15:04] <amercader_> wardi: what about adding the schema to the context on _validate for the validators to use? (and popping it immediately afterwards)
[15:15:16] <wardi> noooo
[15:15:20] <amercader_> lol
[15:15:41] <amercader_> come on, just a little more abusing ...
[15:17:34] <rgrp> please can i get admin on https://github.com/ckan/ckan.github.io - this is so i can merge extension work etc
[15:17:41] <wardi> something somewhere is already inserting schemas into the context and we'll just break it
[15:20:21] <wardi> if we didn't have ignore_missing in front of the extra schema fields we could check from the convert_to_extras validator
[15:21:07] <wardi> or add a no_conflicting_freeform_extras in front of ignore_missing
[15:23:38] <amercader_> rgrp: should work now
[15:23:43] <rgrp> thanks
[15:26:54] <amercader_> wardi: actually we can just check on convert_to_extras if an item with the same key already been added to the data ('extras', n, 'key'): xx
[15:27:16] <amercader_> *has been added
[15:28:28] <seanh__> amercader_: Those are the docs, yes, sounds good
[15:28:40] <seanh__> Also example_idatasetform does the removing free extras bit
[15:29:17] <amercader_> seanh__: cool, I'll remove those if we get around the same keys problem ^
[15:29:24] <wardi> amercader_: not in the presence of ignore_missing
[15:29:38] <wardi> that stops processing any further validators
[15:32:51] <amercader_> wardi: ok, what about a validator on __before, like the existing duplicate_extras_key
[15:33:31] <wardi> amercader_: that could work, except that we don't have the schema
[15:34:15] <wardi> context = dict(context, schema_keys=list(schema)) might be the only option
[15:36:49] <amercader_> wardi: where would you add this?
[15:38:37] <wardi> in _validate, as you said (but not passing the whole schema and not modifying the context in place
[15:40:08] <amercader_> ( in my defence I was suggesting something like this before, not adding the whole schema to the context)
[15:41:01] <wardi> oh? I'm not very good at reading..
[15:41:53] <amercader_> no, it came out as the old context['schema'] = ..., but in my mind it was something more limited
[15:41:57] <wardi> I just know that if we pass the schema someone will figure out that modifying the schema from a validator "works" and start doing that :-)
[15:42:42] <amercader_> ok, shall I try this then?
[15:43:48] <wardi> I think it makes the most sense.
[15:44:25] <wardi> we might be able to hack it by peeking at the errors dict keys or something, but that's not any better
[15:44:25] <amercader_> cool
[15:45:24] <wardi> freeform extras with custom fields will be great
[15:46:20] <wardi> having them all together also lets you promote/demote fields between freeform and custom field as your schema evolves
[18:32:41] <seanh> wardi: New section in the API guide?
[18:33:52] <wardi> seanh: I was thinking it would be most useful in the package_show/_create/_update docs
[18:33:59] <wardi> unfortunately those are all separate
[18:34:24] <wardi> it feels like the grouping of actions is wrong
[18:37:01] <wardi> maybe this is about how our object model is missing from the docs, so a new section might make sense
[21:02:47] <seanh> wardi: You could decide to change how the action functions are ordered in the docs

2014-08-20
[08:40:30] <amln> seanh__: are your dotfiles not in a repo?
[08:41:12] <amln> (for vim configs etc)
[09:39:53] <seanh__> amln: They are actually, and I use this thing called mr to keep track of them all https://github.com/seanh/mr
[09:40:47] <amln> seanh__: that looks useful :)
[09:41:07] <seanh__> There are other annoyances about using VMs though and the whole thing is just a bother really ... I may switch back to just installing *everything* on my laptop and making it into a behemoth running multiple versions of every service and have half of debians apt packages installed on it
[09:42:01] <seanh__> For Vim I'm thinking of trying Python Mode though https://github.com/klen/python-mode as YouCompleteMe and Syntastic are disappointing me these days
[09:44:07] <amln> (I use something like http://code-worrier.com/blog/git-branch-in-bash-prompt/)
[09:44:50] <seanh__> Ah, I am using fish shell which has git prompt stuff built in
[10:29:35] <kalxas> hi Hami
[13:25:55] <nigelb> this is a really good talk http://www.heavybit.com/library/video/2014-07-08-jade-wang
[17:44:33] * wardi bookmarks
[19:49:52] <wardi> naming is hard. in ckanext-scheming I've called the to-db converters/validators list just "validators" but I need to add some to-form converters now..
[19:50:35] <wardi> "to_form_converters" doesn't look related to "validators" at all :-/
[19:51:52] <wardi> to_(form|db)_validators_and_converters seems way too long
[19:52:31] <wardi> input_munge, output_munge :-)
[20:04:48] * wardi goes with "output_validators" even though it's not doing any validation

2014-08-19
[20:44:05] <bjb> seanh__: there is can-o-pg, good for multiple instances of a DB on a machine (one per project, say) - also it's easy to run multiple versions of postgres on a machine, just install them.  On Debian (probably also ubuntu) they even automatically get assigned different port numbers.  Then you just have to configure your project to use the different port numbers
[20:45:45] <bjb> https://github.com/bjb/can-o-pg
[20:45:53] <bjb> I adapted mcr's can-o-pg to make it less railsesque.
[20:46:16] <bjb> There is also https://github.com/mcr/can-o-mysql
[20:47:47] <bjb> It will allow you to use the same executables for a given version of the DB, have per-project db instances.
[20:48:02] <bjb> and per-project associated config files
[20:48:47] <ssimpkin> Wondering if anyone knows of a good ckan portal example where they're using the geospatial extension?

[08:10:57] <seanh__> There seems to be a problem with tag vocabulary fields and webtest :/ My tag vocabs are working fine, but when I load my form in a webtest, instead of the vocab's tags the options for the field are (None, None, None, ...), and webtest won't let you submit the form with the field set to a value that it doesn't think is one of the options
[08:11:10] <seanh__> No idea why this should work in a browser but not in webtest, though
[08:11:16] <nigelb> js?
[08:11:21] <seanh__> Nope
[08:12:00] <seanh__> Putting the <option>s in the <select> is just a simple jinja for loop, it calls a helper function to get the list of tags from the vocab, then loops over them and renders an option for each
[08:12:15] <seanh__> I can debug the helper function: it gets called once when the test runs and returns the correct list
[08:12:38] <seanh__> I often wish I could drop into pdb in side a jinja template
[08:20:38] <seanh__> AH, that's weird, the HTML was invalid!
[08:20:54] <seanh__> <option>s with no value attribute
[08:21:02] <seanh__> It was working fine in Firefox though
[08:21:46] <seanh__> It must fall back to the text inside the tag, if the attr is missing, but webtest doesn't
[08:49:31] <amercader> seanh__: we really should avoid these project specific branches in the main repo: release-v2.2.1-ckanext-sgdata
[08:49:50] <seanh__> Not sure what else I can do though?
[08:50:02] <amercader> fork it
[08:50:36] <seanh__> I guess I could do, what's the difference though?
[08:50:45] <amercader> or get it merged into 2.2.1, if it's there where it should end up
[08:51:11] <seanh__> There is a pr for this change into master
[08:52:46] <seanh__> But the problem is you come across a CKAN core bug that's critical for your client project that needs to be delivered this week ... Bug cannot be worked around in an extension but has to be fixed in core. So you have to deploy a branch (or fork) of core
[08:53:03] <amercader> the main repo is just ckan code, I'm sure lots of devs building ckan sites need changes at some point into releases branches. They will fork the repo and keep their changes there unitl hopefully they can use the main repo
[08:53:10] <amercader> okf services should not vbe different
[08:53:30] <seanh__> We had a bunch of these for datapackager as well. The real killer is that there won't be any more time for the project (or for core) after you deliver the project, so the bug fixes don't end up getting contributed back to core either!
[08:54:09] <amercader> otherwise we tie projects to the main repo, and end up with branches in core like the ones for data.gov or ecportal
[08:56:57] <amercader> I guess in this case it looks like it will be a short lived one, but if for some reason this could not go into 2.2.1 we will end up with this weird branch in no man's land
[08:59:18] <seanh__> No, it'll be longed-lived. It's one small fix that is hopefully gonna get into master, but we'll probably never get any time to work on this particular client project again so it'll be running off its custom branch forever
[08:59:27] <seanh__> Next time, I'll fork the repo instead
[09:00:12] <seanh__> We will end up with a weird branch (or a weird fork) yes, I don't see any way around that though. We can fork and branch instead of branching to keep the main repo tody though
[09:00:27] <amercader> seanh__: then, I strongly suggest that we either get the fix in 2.2.1 (my preference) and you point to this, or you fork it
[09:01:19] <nigelb> just amke sure you don't fork to ckan/ckan.
[09:01:20] <nigelb> erm
[09:01:22] <nigelb> okfn/ckan
[09:01:26] <nigelb> that'll screw up redirects.
[09:02:00] <amercader> seanh__: what is missing for getting it merged? will it break something?
[09:02:08] <amercader> backwards compatible I mean
[09:03:26] <seanh__> Some tests are failing
[09:03:31] <seanh__> They look simple to fix
[09:03:42] <seanh__> I'm hoping to have some core time on Friday
[09:04:40] <seanh__> Well, it changes vocabulary_show() to that the tags in the vocab dict don't contain all the packages anymore, so that's not strictly backwards-compatible (but I doubt much is depending on that)
[09:06:23] <seanh__> Also wardi had some issues with it but those looked simple to fix
[09:06:47] <seanh__> Realistically I could finish it and we get it merged next week at the earliest
[09:11:38] <seanh__> nigelb: We may need a naming convention, okfn/ckanext-sgdata and okfn/ckanext-sgdata-fork or something
[09:13:50] <amln> okfn/ckanfork-sgdata ?
[09:14:08] <nigelb> we could just do okfn/ckanfork
[09:14:15] <amercader> okfn/ckan-sgdata seems good enough to me
[09:14:16] <nigelb> and do all our custom branches inside it
[09:14:19] <amln> and multiple branches?
[09:15:02] <seanh__> It might actually be tidier to just have the okfn/ckanext-sgdata repo and keep some patch files in it?
[09:15:16] <seanh__> I like ckanfork-sgdata or ckan-sgdata though
[09:15:18] <amercader> seanh__: yes
[09:15:39] <amln> in my mind, core changes aren't an extension.
[10:05:18] <AlexCorbi> Hello everyone, is anyone familiar with extending the localisation of an existing language in CKAN? On the documentation it is stated that in order to add a new language, the following repo should be cloned: hg clone http://bitbucket.org/bboissin/ckan-i18n/ But looking at CKAN's source code on github i saw that there are many more languages under: hg clone http://bitbucket.org/bboissin/ckan-i18n/ including some of the ones i am willi
[10:06:02] <AlexCorbi> Sorry, the second link should be https://github.com/ckan/ckan/tree/master/ckan/i18n
[10:06:40] <amercader> AlexCorbi: what docs are you using?
[10:06:45] <AlexCorbi> The question is whether is a good practice to clone the i18n folder on the master repo of CKAN or the one mentioned in the documentation.
[10:06:59] <AlexCorbi> hi, http://docs.ckan.org/en/latest/contributing/i18n.html
[10:08:03] <amercader> AlexCorbi: ups, this docs need urgent updating, CKAN moved to git and github a long time ago
[10:08:25] <amercader> AlexCorbi: what version of CKAN do you want to translate? master or a released one?
[10:09:10] <AlexCorbi> released 2.2
[10:09:48] <amercader> AlexCorbi: then you should update the translations on Transifex https://www.transifex.com/projects/p/ckan/
[10:10:02] <amercader> We will pull the updated translations before releasing 2.2.1
[10:11:24] <AlexCorbi> Allright, thanks for the link!
[10:50:22] <nigelb> I'll miss meeting today
[10:50:24] <nigelb> need to step out
[10:50:33] <nigelb> (sorry, too many chroes landed up today that can't be moved :( )
[11:00:38] <amln> joet: can you mention the CZ thing, please. I'm not going to make today, either
[11:01:17] <wardi> https://plus.google.com/hangouts/_/event/cb1vmkss426lkqicj94a3amvd1c?authuser=0&hl=en-GB
[16:31:05] <seanh__> It's actually kind of a pain running CKAN (and vim and everything) inside a vm
[16:31:31] <seanh__> I'm wondering about a different strategy: Run CKAN locally (in a virtualenv) but run postgres and solr in a vm and expose them
[16:31:41] <seanh__> Should work for Python web apps generally
[16:31:58] <seanh__> Then you can just run your editor and tools and everything locally
[16:32:56] <seanh__> (The main reason I'm running everything in a VM at the moment is to keep my host system clean - I don't want to install postgres and solr on it, then have to install mysql on it for another project, then a different version of postgres for another..)
[16:34:31] <seanh__> The annoying thing about running everything in a VM (and having a different VM for each project) is that I use vim, lots of vim plugins, and lots of command-line tools for working, then I need to install and configure them all inside the VM and replicate all that across VMs
[16:34:59] <joets> seanh__, that is pretty much what I do
[16:35:13] <seanh__> joets: You run just postgres and solr in a vm?
[16:35:25] <joets> I run postgres and solr inside a container
[16:35:36] <seanh__> Yep, same thing I guess
[16:36:09] <seanh__> Actually, do the docker postgres and solr containers in core expose postgres and solr to the host machine? That might be the easiest solution
[16:36:13] <joets> 990% of the time I'm just using the dev server at the moment
[16:36:23] <joets> *90%
[16:36:30] <seanh__> The dev server?
[16:36:38] <joets> as in the paster dev server
[16:36:48] <seanh__> Yeah, me too
[16:36:55] <joets> sometimes I will do a whole vm thing to make sure apache is working/whatever
[16:37:04] <seanh__> That you can just run on your host in a virtualenv no problem
[16:37:47] <seanh__> Yeah, I guess you could share your hosts CKAN source dir with a VM with apache and nginx on it, for when you want to test something in apache
[16:38:35] <joets> you can actuallly run vim over scp so you can have a vm and use your 'local' vim to edit on the vm, but that is too many mental hurdles for me to bother
[16:38:52] <seanh__> This local venvs plus VMs for external services approach should work with web apps generally I think, as long as whatever non-python libs they depend on can be exposed on a port
[16:39:31] <seanh__> I suppose you do have to apt-get install a bunch of non-python libs for CKAN as well, and then other projects would require others ones, which installs a whole load of stuff on your host and possible version conflicts between projects as well
[16:40:22] <seanh__> joets: I have vim plugins that need access to the python binary inside CKAN's virtualenv: the YouCompleteMe and Syntastic plugins. If the venv is in a vm and vim is outside of the vm, getting those to work is tricky
[16:40:49] <joets> I find that doesn't crop up as much, you're more likely to run into different virtualenvs having different things in the requirements.txt
[16:41:49] <joets> I vaguely justify in my head just running stuff locally with solr/postgres in a vm as me testing to make sure things work on fedora/redhat
[16:42:51] <joets> but mainly it'll take some effort to change my work flow now.
[16:50:23] <seanh__> I think if I could figure out a way to run vim and my other tools outside of the VM that the app is installed in (e.g. locally, or in another VM) then I'd be good. I'd just install apps: their virtualenv, apt packages and services completely in VMs, but just have one copy of my dev tools and not have to install them in each VM
[16:50:46] <seanh__> Mostly I just need a way to educate vim about a virtualenv inside a vm
[16:51:08] <seanh__> If you activate the virtualenv in a shell and then run vim, it works (not sure about gvim)
[16:51:37] <seanh__> Can I run a local shell, and activate a virtualenv that's in a VM? It might work I suppose if you just have the venv in a shared folder
[16:52:56] <seanh__> But I think some of the files in the venv are going to be links to files elsewhere on the vm's filesystem, and those links won't work if you try to use that venv locally
[16:56:30] <joets> yeah I think there are some hardcoded links for virtualenvs
[16:58:16] <joets> http://virtualenv.readthedocs.org/en/latest/virtualenv.html?highlight=relocatable#making-environments-relocatable sharing the virtualenv would probably have issues
[16:59:19] <seanh__> Yep
[16:59:33] <seanh__> I think I'm stuck with installing all my dev tools inside each VM

2014-08-18
[14:21:34] <joet> seanh, ever had any success mocking out action functions called by get_action?

2014-08-17
[14:07:51] <rgrp> could someone with access make me an admin on https://github.com/ckan/ckan.github.io

2014-08-16
[15:27:23] <SkramX> rgrp_: around for a quick recline question?
[15:27:32] <rgrp_> SkramX: yes i am ...
[15:27:54] <SkramX> where does one set the # of records to show per page?
[15:28:06] <rgrp_> SkramX: btw could you link me to your site again - i wanted to show someone the other day ...
[15:28:09] <SkramX> even more specifically for the multiview demo
[15:28:21] <SkramX> which one? http://louisvilleairmap.com ?
[15:28:59] <rgrp_> SkramX: do you mean setting no of records for the table to show?
[15:29:04] <SkramX> yeah
[15:29:10] <SkramX> http://bit.ly/1t7Hi6x for sample query using data vis "wizard"
[15:30:04] <rgrp_> SkramX: could you add that to https://github.com/ckan/ideas-and-roadmap/issues/73
[15:30:12] <rgrp_> ok - and ansewring your question ...
[15:30:24] <SkramX> will so
[15:30:26] <SkramX> *do
[15:31:05] <rgrp_> SkramX: basically that comes I believe from the queryState object
[15:31:50] <rgrp_> SkramX: in particular the size option IIRC https://github.com/okfn/recline/blob/master/src/model.js#L480
[15:33:16] <SkramX> rgrp_: hm.. okay. im trying to limit the multiview demo to 5 so i can test the pagination since so much s*** is changing from the bootstrap3 upgrade
[15:34:03] <rgrp_> SkramX: btw do push the bootstrap3 stuff in a branch if you want at some point and i can take a look
[15:34:18] <rgrp_> anyway to anser your question just set size on queryState to 5 and that should work
[15:34:27] <rgrp_> that's what i do when developing and testing the multiview
[15:34:45] <SkramX> it is - see commits so far to https://github.com/okfn/recline/issues/427
[15:36:22] <SkramX> added to https://github.com/ckan/ideas-and-roadmap/issues/73 - is that OK?
[15:36:24] <SkramX> and let me try that now
[15:41:54] <SkramX> rgrp_: where in https://github.com/okfn/recline/blob/master/src/model.js#L480 would I put the sizE?
[15:42:57] <SkramX> inside block at line 30, i though
[15:43:08] <SkramX> ** wrong link - https://github.com/marks/recline/blob/upgrade-bootstrap-to-3.2.0/demos/multiview/app.js
[15:46:21] <rgrp_> 2s
[15:46:50] <SkramX> np
[15:52:48] <rgrp_> you want to add a line 55 after createExplorer that does
[15:52:54] <rgrp_> dataset.query({size: 5 });
[15:57:00] <SkramX> rgrp_: (y) thx
[15:57:54] <SkramX> am I going to get a bunch of pushback if I leave that limit to 5 on the multiview demo?
[16:02:00] <rgrp_> SkramX: generally i leave the whole view showing ...
[16:02:09] <rgrp_> sorry whole dataset showing ...
[16:02:12] <SkramX> yeah - ill leave it
[16:02:19] <rgrp_> not the end of the world if you keep it in your version for the moment
[16:03:03] <SkramX> ok
[16:03:20] <SkramX> trying to help and not make more work for the community :)

2014-08-15
[09:07:22] <amln> http://lanyrd.com/2015/pycon/ : in Montral. Wondering if it's worth submitting a CKAN talk?
[09:08:19] <amercader> wardi is the one closer to it :) ^
[09:08:49] <amln> nice alignment there, amercader :)
[11:19:21] <wardi> amercader: anyone have a slide deck i could work from?
[11:33:38] <amercader> wardi: sure, let me dig for some
[11:34:05] <amercader> oh wait, this is Google Docs, it might be a while :)
[11:46:41] <amln> for a company built on indexing...
[11:57:09] <wardi> how about "how we CKAN migrated from pylons to flask in only 7 months" :-)
[11:58:04] <amercader> wardi: +1 ".. and never looked back"
[12:39:53] <nigelb> Ypi wp
[12:39:59] <nigelb> You won't believe what happened next
[12:40:05] <nigelb> (tip: EVERYTHING BROKE)
[14:27:01] <amln> is there an extension for "request a dataset" in CKAN, or am i getting wishes confused with what's out there?
[14:27:20] <amln> I'm looking at https://github.com/ckan/ckan/wiki/List-of-extensions because that's one I can find, and I hate duplication.
[14:35:53] <SkramX> amln: the google doc lists ckanext-feedback but the link is broken
[14:36:51] <SkramX> ah - it is in https://github.com/maulikkamdar/Data.gov.ie-CKAN-extensions
[14:37:41] <SkramX> I have updated the google doc
[14:42:00] <amln> SkramX: interesting. TBH, I'd prefer to have that stored in a database -- I thought there was one for that
[14:46:56] <SkramX> just did some more searching and didnt find one (but im not extension expert)
[14:47:34] <SkramX> I would make a dataset with the correct fields and then use the APIs to insert a row when someone submitted a form.
[14:48:04] <amln> SkramX: no problems. thanks for looking.
[14:48:31] <amln> i'd thought there was one with d.g.u, but couldn't see anything
[14:48:48] <amln> d.g.u as in data.gov.uk
[14:51:46] <nigelb> amln: they use a drupal form, I think?
[14:51:58] <nigelb> The implementations I've seen did not use CKAN for the data request form.

2014-08-14
[16:58:23] <nigelb> like you can't change your own password with api
[16:58:37] <nigelb> less likely to get owned then.
[16:58:58] <joet> yeah, that's why i say it's difficult to find time when the scenario we're trying avoid is "imagine your server has been owned, now they have your api keys"
[16:59:21] <joet> but if i'm missing something then yeah by all means
[16:59:31] <nigelb> and recommending SSL is also something we could do
[16:59:32] <wardi> I'd like it that having a copy of an old backup didn't mean you had complete control of a site
[17:00:23] <nigelb> I understand your point :)
[17:00:32] <nigelb> sometimes you have to export a site locally to debug something
[17:00:41] <nigelb> and if you're not careful, that's a huge attack vector
[17:01:49] <nigelb> wardi: Would this be easy to do - Multiple API keys?
[17:02:08] <nigelb> Perhaps that will open up the possibility to have read-only keys and stuff.
[17:03:01] <joet> perhaps we could even have user_extras :p
[17:03:32] <joet> and I want a pony
[17:03:46] <nigelb> joet: I don't say that anymore.
[17:03:56] <nigelb> after my friend actually gifted her daughter a pony for christmas
[17:04:22] <nigelb> (a real live one and she rides it already)
[17:04:39] <nigelb> wardi: do you have a roadmap issue?
[17:04:52] <nigelb> I'd love to write this down into something we can implement in the future :)
[17:06:06] <wardi> multiple keys for the same user is probably not that hard. different permission levels for each would be harder 'cause it would break the assumption that you could get the permission from the username
[17:06:17] <nigelb> indeed
[17:06:27] <wardi> haven't created an ideas issue for it, no
[17:06:51] <nigelb> if you do get around to it before me, tag me on it. I'd love to add more thoughts
[17:07:36] <wardi> being able to *not* have an api key would be nice
[17:15:31] <nigelb> wardi: hrm, and instead?
[17:15:42] <nigelb> Oh like, by default no API key and you only create it when needed?
[17:15:58] <nigelb> have you used crowdcrafting.org? I like how API keys are dealt with there.
[17:16:06] <nigelb> you get zero API keys to start with.
[17:16:12] <wardi> yeah
[17:16:14] <nigelb> And create named ones if you need them.
[17:16:21] <wardi> that makes more sense to me
[17:16:25] <nigelb> which you can revoke or generate
[17:16:44] <nigelb> perhaps that's what we should do which is best in terms of time and effort.
[18:49:13] <travis-ci> [travis-ci] wardi/ckan 1841-ivalidators-iconverters adb2ba6 http://travis-ci.org/wardi/ckan/builds/32567743 Ian Ward: The build was broken.
[19:02:11] <travis-ci> [travis-ci] wardi/ckan 1841-ivalidators-iconverters e6d2c46 http://travis-ci.org/wardi/ckan/builds/32568423 Ian Ward: The build was broken.

[09:12:49] <seanh__> I'm actually getting a traceback that says an exception is thrown from a line that cannot be throwing an exception
[09:13:19] <seanh__> The last line in the traceback is: error_dict = _custom_validation(data_dict)
[09:13:24] <seanh__> Raises ValidationError
[09:14:21] <seanh__> _custom_validation() is a function defined in the same file, but there's no line in the traceback that shows where the exception was raised in custom_validation() (and it doesn't raise any or call anything that raises any, anyway)
[09:14:30] <seanh__> Seems like a messed up traceback, which is weird
[10:09:34] <wardi> we do have code that 'cleans up' our tracebacks
[10:10:19] <wardi> can you set a breakpoint and step until you hit the exception?
[10:26:05] <seanh__> Too late
[10:26:16] <seanh__> I never got to the bottom of it, it has gone away now!
[10:26:51] <seanh__> I think by various schema tweaks and renaming one field to zzz_ I may have got it working in both the API and the web UI now ... fingers crossed
[10:27:09] <seanh__> I never got to the bottom of exactly what was going wrong though, which never feels good
[10:42:53] <wardi> you had some four-parameter validators validating across fields?
[11:02:27] <wardi> https://plus.google.com/hangouts/_/event/cb1vmkss426lkqicj94a3amvd1c?authuser=0&hl=en-GB
[11:25:40] <nigelb> wardi: dev meeeting over?
[11:26:22] <joet> nigelb, yes
[11:26:32] <joet> we gave you all the issues
[11:27:01] <nigelb> that's easy
[11:27:25] <nigelb> I'll have them done in an hour and I'll assign all the reviews to you.
[11:28:57] <joet> lol
[13:17:02] <seanh__> Argh, so zzz_adminstrative_source is fixed
[13:17:42] <seanh__> But now when you do a resource update via the web UI (and therefore indirectly do a package_update) at some point package_show returns a package dict with the custom field category just missing from it
[13:17:53] <seanh__> All the other custom fields are there
[13:18:32] <seanh__> It wasn't doing this before either (even after I renamed zzz_administrative_source it worked for a while without crashing, no idea what changed now)
[13:18:52] <seanh__> category is now the first custom field though, alphanumerically
[13:20:04] <amercader> seanh__: I'm finding something similar, some of my custom fields (converted to extras) are being dropped
[13:20:20] <amercader> during validation
[13:21:33] <seanh__> Yep
[13:21:52] <amercader> seanh__: just out of curiosity, are using the harvest extension?
[13:21:58] <seanh__> no
[13:23:37] <amercader> ok, in my case it seems like it is the culprit, as it is adding extras by default besides the ones on the form and these seem to mess up with the other fields. Maybe something similar is happening on your side
[13:27:11] <seanh__> Hmm, I don't *think* we have any free extras getting in
[13:53:02] <seanh__> The bug just went away on its own: Insert breakpoints to debug, bug doesn't appear, remove breakpoints, bug is still gone. This almost makes me more annoyed with it
[13:53:27] <seanh__> I'm getting massive page load time on various pagges involving package create and update though: minutes
[14:19:47] <wardi> seanh__: on the plus side that kind of slowness is easy to profile
[14:21:23] <seanh__> Yeah I should profile it if I have time
[14:21:41] <seanh__> Maybe it's CKAN's fault, but I kind of suspect a mistake in our extension for this one
[14:22:08] <wardi> seanh__: if it's taking a minute you just press ^C and look at the traceback :-)
[14:22:23] <wardi> chances are you're stopping in the slow part
[14:23:50] <seanh__> tag_dictize :)
[14:25:01] <seanh__> We have a few convert_to_tags and tag vocab fields. Only a handful but looks like this may be enough to make page loads very slow
[14:26:28] <seanh__> Yeah, vocabulary_dictize and tag_dictize, looks like
[14:27:55] <wardi> iirc the vocabulary one does a tag_show on *every* tag, which does a package_show on up to 1000 datasets *per tag*
[14:28:32] <seanh__> And we have 3500 datasets imported now
[14:28:35] <wardi> I think we just hacked out the package_show thing that tag_show does
[14:28:58] <seanh__> Which probably explains why I started noticing slowness recently, not when I first implemented those fields
[14:29:05] <wardi> a better fix might be a parameter that says "thanks, I don't need any packages"
[14:29:39] <wardi> and/or not calling tag_show on every tag in the vocab
[14:30:50] <wardi> my pr to just remove the package_show calls from tag_show was rejected (sensibly)
[14:31:57] <seanh__> Hopefully we can get some core time for someone to do a whole review of this use-case
[14:32:07] <seanh__> Clients wanting custom schemas with lots of custom fields is common
[14:32:20] <seanh__> And there seem to be a lot of problems with validation, page-load times
[14:32:45] <wardi> and using a tag vocabulary is suggested in the docs as the right way to do select-multiple
[14:33:07] <seanh__> Yep
[14:35:54] <SkramX> has anyone ever seen an extension or thought about making one that lets people have a threaded discussion about a dataset? Might make more sense to just add Disqus code to the bottom of dataset/resource pages.. just curious
[14:37:58] <seanh__> There's a disqus extension
[14:38:18] <SkramX> d'oh - somehow it didnt come up in my searches but now I see it
[14:38:23] <seanh__> I think there's been some interesting in making one that stores the comments in CKAN instead of using disqus, but no progress afaik
[14:38:57] <SkramX> k
[15:02:09] <seanh__> wardi: It doesn't look like tag_dictize dictize's any packages though
[15:02:18] <seanh__> It gets them from the search index
[15:03:22] <wardi> it used to. I think nigel fixed that. it still converts gobs of json into python dicts though
[15:06:12] <seanh__> wardi: It does seem to be the culprit
[15:06:36] <seanh__> If I comment out all the package search stuff in tag dictize, then the page loads are perfectly good
[15:07:01] <seanh__> And it doesn't seem to break anything
[15:08:34] <wardi> so, add a include_datasets=False parameter to tag_show?
[15:08:39] <seanh__> Yeah
[15:08:51] <seanh__> We don't even use the package info in the tag dicts though
[15:09:04] <seanh__> I assume it's for the tag pages, and we don't use those pages in core anymore
[15:09:52] <wardi> group_ and organization_show alreaady have an optional include_datastes parameter
[15:44:26] <joet> hum the api controller doesn't actually catch the ActionError class
[15:49:01] <joet> it only catches NotFound/NotAuthorized/ValidationError/SearchIndexError/DataError, but if i'm writing my own action in an extension, then i'd want to throw errors which aren't in that list
[15:49:25] <joet> the api should catch ActionErrors and display whatever error message it has instead of just plain 500ing
[16:36:08] <wardi> nigelb: we could start storing the api keys hashed instead of plaintext if we only show they user their api key at the time of generation
[16:45:39] <nigelb> wardi: that doesn't sound like a good idea.
[16:45:45] <nigelb> Unless we do things like multiple api keys
[16:46:05] <nigelb> you generate a key, name it, and copy it off. You can't see it again.
[16:46:25] <nigelb> you can have multiple keys and delete them whenever.
[16:48:44] <joet> nigelb, you already wrote the regenerate api key function, so I don't think it's bad, and no one has the time to write multiple api keys so it'll basically never happen
[16:50:40] <nigelb> joet: if you only have one api key, not being able to ever see it is bad UX.
[16:50:49] <joet> i think it's not worth the trade of dev time to even write the hashed api key
[16:50:57] <nigelb> wardi: I would recommend fixing the password reset key issue first
[16:51:15] <joet> we're writing for the instance of "if my server gets owned, i have to regenerate all the api keys"
[16:51:35] <joet> at least that was in the original ticket
[16:51:45] <nigelb> we generate it when user is created instead of when password change is requested and it's never expired
[16:51:51] <joet> and i don't think it's worth what little dev time we have to fix this.
[16:52:08] <joet> beause if your database gets compromised, well, you're starting from scratch again anyway
[16:52:27] <joet> and you'll be changing your users passwords and cycling api keys even if they _are_ encrypted
[16:52:40] <nigelb> true.
[16:52:50] <nigelb> the password reset key has a bigger vector though.
[16:52:55] <joet> yeah
[16:53:02] <nigelb> that needs more immediate fixing.
[16:53:46] <joet> yeah, i don't think any of the core devs have time for the apikey, but good for contribution! :p
[16:54:31] <wardi> joet: we just started hashing our passwords properly, but we have a plaintext password right next to it for all users
[16:55:11] <wardi> seeing someone trying to inject sql into my site again made me think of this
[16:55:16] <joet> yeah but what instances of attack are talking about here?
[16:55:37] <joet> it's unlikely people will brute force apikeys as they are random strings
[16:55:40] <wardi> access to a backup
[16:55:40] <joet> long random strings
[16:56:03] <nigelb> I think the right way to deal with this is clean up how API keys are functioning
[16:56:06] <nigelb> rather than hasing
[16:56:19] <nigelb> *hashing/encrpting
[16:57:03] <wardi> ideal would be to have multiple api keys each with possibly different limited access
[16:57:25] <nigelb> yep
[16:57:28] <joet> +1, but it's about finding time
[16:57:36] <nigelb> Also, +1 to joet
[16:58:06] <wardi> it would need a pretty big auth overhaul
[16:58:10] <nigelb> We could do small things

2014-08-13
[12:11:04] <seanh__> No idea why those datasets and not others (when they were created, they did have values for zzz_administrative_source)
[12:11:51] <seanh__> amln: There's no point in making tickets like that
[12:41:51] <wardi> flattening isn't a terrible idea. it just needs docs
[12:42:28] <wardi> flattened structures can be iterated over more easily
[12:54:50] <seanh__> I don't get that. You have as your schema dictionary, and for each key in the dict a list of validation functions to apply to it. So for each key, call each function passing it in the key's value
[12:54:57] <seanh__> Why the flattening?
[12:56:10] <seanh__> I've still got package_show sometimes returning Missing or None for my adminstrative_source field, even though it has a value, driving me crazy
[12:56:13] <joet> nested schemas i assume
[12:58:54] <seanh__> But a nested schema just says: The value for this key should be a list of dicts, iterate over them and validate each dict using this nested schema
[12:59:06] <seanh__> Maybe it makes sense when you actually try to write it
[13:00:48] <amln> seanh__: i was just thinking of capturing it somewhere...
[13:02:06] <seanh__> The problem we have right now is not enough time to fix all the problems with CKAN. If we ticket them all, we'll have 3000 tickets and the problem we'll have is no time to sort through the tickets (never mind try to fix them). We've done it before..
[13:04:16] <amln> Gotcha.
[13:33:57] <rossjones> seanh__ I think creating 3000 tickets is bad, but it's probably necessary.
[13:36:20] <seanh__> I don't think it'll achieve anything
[13:37:39] <seanh__> No one is gonna fix a bug for you, just because you ticket it. And having thousands of tickets just means you don't know which of those tickets are still valid or relevant or any kind of priority, or were even good tickets in the first place, etc. Just to sort through them and find ones worth working on takes more time than it's worth
[13:45:43] <seanh__> Alright, so if I rename my field back to administrative_source like it was called at first, then I can import 3500 datasets via the API ok. But creating datasets in the web UI crashes. If I rename the feild to zzz_ then web UI works but API fails (sometimes)
[13:45:52] <seanh__> I'm gonna have to go in there
[14:19:49] * tryggvib is very afraid of having done something wrong after seeing that a schema extension ala IDatasetForm is not needed to add extra data to resources
[14:39:49] <seanh__> In IDatasetForm returning ('dataset',) from the package_types() method is enough to have your custom schema be used by the web interface, but it won't be used by the API!
[14:40:06] <seanh__> You have to return True from the fallback() method to make the API use your schema, it seems
[14:40:47] <seanh__> Now that my API import is actually using my schema creating each dataset takes much longer, it's gonna take two hours to import 3500 datasets (I hope I don't have to re-run this lots of times before I get it right..)
[14:41:11] <seanh__> Apparently adding a bunch of convert_to_tags() and convert_to_extras() fields makes creating a dataset take two seconds
[14:41:25] <seanh__> Oh and it's increasing, 2.5 seconds now
[14:41:29] <seanh__> :(
[14:42:47] * seanh__ Goes to performance tips for large imports wiki
[14:50:00] <seanh__> Ok I'm getting <1s per dataset after turning off solr indexing and activity streams ... Hopefully that doesn't increase too much as more datasets get added, I probably don't need to bother with the more difficult stuff the wiki lists
[14:50:59] <seanh__> We have a few tags on each dataset, and also a bunch of custom convert_to_tags() tag vocabulary fields, apparently tags are a big source of slowness (the wiki says)
[15:08:35] <wardi> seanh__: one of the big culprits was tag_show collecting a bunch of packages we don't care about. not sure if that's still a problem
[15:09:04] <wardi> where a bunch was ~= 1000
[15:09:31] <wardi> we stopped using real tags for free-form tags and store them in a plain extra instead
[15:09:56] <seanh__> My import seems to be going along happily creating each dataset in <1s, I think things in core are maybe a lot better on 2.2.1 than they were on 2.0
[15:10:48] <wardi> seanh__: it scaled pretty well with parallel imports too
[15:11:07] <wardi> ckanapi load datasets -p is your friend :-)
[15:12:23] <seanh__> Oh wow, I hadn't even seen that
[15:12:33] <seanh__> I've almost done it the stupid way now though
[15:31:51] <seanh__> Interesting: https://github.com/pocoo/metaflask
[19:41:05] <SkramX__> hi everyone.. i sort of peaced out from here for a few weeks. anyone an expert on the new resource views?
[20:03:34] <SkramX__> vitorbaptista: ping me when youre around? i

[08:33:55] <simonlebo> hi there
[08:34:24] <simonlebo> I was wondering if someone could clarify a real simple thing about extensions
[08:34:34] <nigelb> ask away
[08:34:36] <simonlebo> (I am 1 day old to ckan)
[08:35:01] <simonlebo> Ok so I got a client who has these requirements to create fancy graphs through the backend
[08:35:16] <simonlebo> and I can see basically that I could propose a custom extension
[08:36:17] <simonlebo> or a totally custom app that interacts with the api. I d need a db in that app to store the customization of the graphs. I am correct? I guess I am wondering what is the extension vs app biggest tradeoff
[08:36:36] <nigelb> yeah, that's really "simple" :P
[08:36:49] <nigelb> you can still talk to the db from an extension, sure.
[08:37:10] <nigelb> the advantage with not using an extension is that you are not limited by ckan.
[08:37:43] <nigelb> and the disadvantage is that now you have two different things which may need to handle authentication differently.
[08:38:01] <simonlebo> yeah. Is the api limited to the datasets?
[08:38:07] <nigelb> nope
[08:38:10] <nigelb> API is very rich.
[08:38:23] <nigelb> ckan has a layer called logic layer with action functions.
[08:38:31] <nigelb> the controllers themselves use the logic layer
[08:38:54] <nigelb> which means almost everything done in UI can be done via API.
[08:39:05] <simonlebo> excellent
[08:39:14] <nigelb> It comes down to personal preference.
[08:39:28] <nigelb> I can't say overwhelming positives or negatives either way.
[08:39:58] <nigelb> we try not to break the API (v2 and v1 are *still* around)
[08:40:54] <simonlebo> Ok.
[08:42:13] <simonlebo> And If I was to offer him 3d party tool for doing fancy graph. The ones I saw need csv data. I could not find anything mentioning querying datasets in csv in the doc.
[08:43:23] <nigelb> take a look at the datastore
[08:43:43] <nigelb> wait, you want to do fancy graphs for the list of datasets?
[08:43:46] <nigelb> or their contents?
[08:44:20] <simonlebo> list of datasets
[08:45:27] <nigelb> if you were doing an extension, you'd want to create a custom controller, do an action function call and conver to csv on the fly.
[08:46:09] <nigelb> If that sounds like greek and latin, ask on the mailing list and I can hunt down some example code and documentation :)
[08:46:25] <simonlebo> haha
[08:46:32] <simonlebo> thanks
[08:47:02] <nigelb> I'm guessing you're looking at d3?
[08:47:15] <simonlebo> mmm I d like to avoid it if possible
[08:47:26] <simonlebo> something higher level would be better imo
[08:47:53] <simonlebo> I am looking at what vitor did on basiccharts
[08:48:59] <simonlebo> But really I would prefer not to do the graph side of things, I am a python guy. I d like a 3d party solution like https://infoactive.co/ that works with ckan
[10:17:30] <nickstenn> i love the email to ckan-dev in which a husband tells his wife that she's left her phone in the car
[10:17:40] <nickstenn> and cc's ckan-dev for good measure
[10:20:25] <seanh__> We will get right on it
[10:22:53] <seanh__> (He's obviously heard of the legendary helpfulness of the ckan-dev team.)
[10:26:44] <nigelb> nickstenn: really? which one?
[10:27:28] <nigelb> Oh. I see it now :)
[10:32:04] <seanh__> Anyone ever seen this before? https://github.com/okfn/ckanext-sgdata/issues/11
[10:32:46] <seanh__> sqlalchemy seems to be crashing when trying to read the system_info table
[10:33:03] <nigelb> weird.
[10:33:08] <seanh__> This just "started happening" (for no known reason) on a site that was working fine. Restarting supervisor got rid of it
[10:33:16] <nigelb> staging or production?
[10:34:11] <seanh__> Prod
[10:34:51] <nigelb> Hrm.
[10:34:58] <nigelb> I've been seeing it somewhere else
[10:35:05] <nigelb> let me look through my email.
[10:35:29] <nigelb> seanh__: yeah, I've been seeing it on demo.ckan.org
[10:35:38] <seanh__> Interesting
[10:36:12] <seanh__> So it affects at least 2.2 and 2.2.1, and both gunicorn and apache
[10:36:22] <nigelb> I think it might be something to do with postgres.
[10:36:25] <seanh__> Do you know when it started on demo?
[10:36:53] <nigelb> let me check sentry
[10:36:59] <nigelb> yay for setting up sentry on there.
[10:38:24] <nigelb> there are 297 instances of it on demo
[10:38:29] <nigelb> let me try to pin down a date.
[10:39:07] <seanh__> Oh dear, for us it seemed to 500 every page load until we restarted supervisor, we haven't been restarting apache on demo 297 times have we?
[10:40:09] <nigelb> seanh__: august 4th
[10:41:22] <seanh__> That's about when you setup the sgdata sites on gunicorn
[10:41:27] <seanh__> Coincidence?
[10:42:16] <rgrp> seanh__ and amln: re the forums - the idea is that this would replace other sthigns to some extent - a really good forum would help us centralize various things (e.g. stop using stackoverflow for tech questions, also move day-to-day tech queries off ckan-dev etc)
[10:42:21] <nigelb> I'm wondering if there's a new postgres bug fix.
[10:42:55] <seanh__> Is there a problem with SO?
[10:43:12] <nigelb> Honestly, that'll just lead to http://xkcd.com/927/
[10:44:02] <rgrp> seanh__: its a slightly odd place for essentially your product forum ...
[10:44:45] <rgrp> but good points about whether this is duplicate - perhaps I should send to list and we can have discussion with proper pros and cons rather than discussing here
[10:45:02] <seanh__> Well, we have two mailing lists, a wiki and github issues and then SO, so I'm not sure we're using SO as our main place for project contact/discussion
[10:45:05] <seanh__> Sure
[10:45:14] <nigelb> seanh__: http://changelogs.ubuntu.com/changelogs/pool/main/p/postgresql-9.1/postgresql-9.1_9.1.14-0ubuntu0.12.04/changelog
[10:45:23] <nigelb> last update to postgres was end of july
[10:45:29] <nigelb> so I wouldn't be surprised if it's fallback from that.
[10:45:56] <seanh__> Hmm, ok
[10:46:39] <seanh__> We'll have to keep an eye on  this, we can't have our prod site randomly starting to 500 every page until someone restarts the webserver, once we've handed it over to the client
[10:46:55] <nigelb> seanh__: Let me talk to adam about sentry for new sites.
[10:47:27] <nigelb> that'll help us catch errors like this and track it better.
[10:51:23] <nigelb> rgrp: I'm curious, why do we want to move day-to-day tech queries off ckan-dev?
[10:51:33] <nigelb> It's not like the list is high-volume.
[11:02:10] <nigelb> seanh__: if you want to look at the demo failures, login to sentry. My creds should be in the services group
[11:27:13] <seanh__> I have a custom field (using convert_to/from_extras()) called "administrative source", at some point when validating the dataset going into/coming out of the db the field is getting removed from the package dict
[11:27:28] <seanh__> But other custom fields done in exactly the same way are fine
[11:27:50] <seanh__> Is this some weirdness to do with extra fields with names starting with a certain letter or something?
[11:28:39] <seanh__> package_show() is stripping the field, looks like, even though it has convert_from_extras() in the schema, and other convert_from_extras() fields are fine
[11:29:36] <nigelb> wardi: ran into those I think.
[11:29:41] <nigelb> he would know.
[11:30:22] <seanh__> There was this https://github.com/ckan/ckan/issues/621 but it's fixed
[11:30:59] <nigelb> Heh "Yes, I think I need a drink"
[11:35:43] <seanh__> This kind of CKAN behaviour is not what you need with a deadline looming
[11:36:03] <seanh__> I may just try renaming my administrative_source field to zzz_administrative_source
[11:37:53] <joets> seanh__ might be worth checking what's coming in and out of solr
[11:39:51] <seanh__> Dear lord, renaming the field to zzz_administrative_source fixes it
[11:40:14] <seanh__> It's something to do with the horrors of validate() and all that, and the alphanumeric order in which it does things
[11:40:21] <seanh__> I am not going in there again, if I can help it
[11:41:14] <nigelb> seanh__: aw man.
[11:41:18] <nigelb> that is not good :(
[11:41:25] <nigelb> Can you file it?
[11:42:09] <seanh__> This is not the first bug we've had along the lines of "If you have a custom dataset field with a first letter that comes before X in the alphabet, and another custom field whose first letter comes after Y, then something crashes"
[11:42:22] <seanh__> The crash will be nowhere near the code that's actually causing the problem
[11:42:28] <nigelb> maybe it should be an ordered list instead of a dict :\
[11:42:33] <seanh__> validate() is one of the worst pieces of programming I've seen
[11:43:21] <seanh__> It completely munges all the data into "flattened" tuples, does its thing, and then unflattens them, which makes it impossible to understand what is going on in there
[11:43:27] <nigelb> get_action was leading that list.
[11:43:32] <nigelb> we then fixed that, thankfully.
[11:43:49] <seanh__> get_action is not even in the same league as validate
[11:43:57] <nigelb> Oh god.
[11:44:05] <seanh__> validate is a black box. Of pain.
[11:44:15] <nigelb> ow
[11:54:15] <seanh__> Still, https://bugs.launchpad.net/ubuntu/+source/cupsys/+bug/255161/comments/28
[11:57:29] <nigelb> holy fuck
[12:08:48] <amln> nigelb: in principle, i'm in favor of sentry being used more widely.
[12:09:40] <amln> seanh__: is validate() mess ticketed?
[12:10:44] <seanh__> Even after renaming my field to zzz_administrative_source and seemingly fixing the problem (I can create datasets in the web UI without it crashing) when trying to import 3500 datasets using the API on some of them I'm still getting data dicts with Missing objects for zzz_administrative_source from package_show

2014-08-12
[10:55:17] <nigelb> https://plus.google.com/hangouts/_/event/cb1vmkss426lkqicj94a3amvd1c?authuser=0&hl=en-GB
[10:56:01] <nigelb> https://pad.okfn.org/p/ckan-meeting
[11:01:19] <nigelb> wardi: there's a pull request of mine about the facets where we created a regression.
[11:01:30] <nigelb> do you want me to dig it up?
[11:03:43] <joet> skype auto making me loud
[11:04:08] <nigelb> kill skype?
[11:33:45] <wardi> nigelb: yes, please
[11:35:26] <nigelb> https://github.com/ckan/ckan/pull/1612
[11:38:03] <nigelb> wardi: ^
[11:44:44] <joet> https://github.com/ckan/ckan/blob/1f46559611bc2d0ed81f9ead97600c6a3c9d352e/ckan/logic/action/get.py#L600
[11:45:09] <joet> is it just me, or if you are a sysadmin and you call organization_list_for_user, you will always get back _all_ organzations?
[11:46:04] <wardi> joet: is that wrong?
[11:46:12] <joet> oh no, it makes sense
[11:46:26] <joet> i wanted to specify a user and get back that orgs they have permissions on
[11:46:42] <joet> like providing user_id in the data_dict of the user I wanted to inspect
[11:47:07] <amercader> wardi: forgot to remind you of this on the meeting https://github.com/ckan/ckan/issues/1709#issuecomment-49178597
[11:47:08] <wardi> seems like something an api called organization_list_for_user *would* do :-)
[11:47:46] <wardi> amercader: I did get the email from github from your ping :-) thanks
[11:47:54] <amercader> cool
[11:47:54] <joet> yeah, it's organization_list_for_current_user atm. oh well, i'll just find something else
[11:48:25] <amercader> joet: that's a terrible action name
[11:48:27] <wardi> joet: why not add an optional parameter
[11:49:10] <joet> amercader, i don't intend to rename it, it's just it wasn't doing what I expected from the name
[11:49:25] <amercader> joet: sure, I was meaning the current name!
[11:50:14] <joet> wardi, might give that a try, might take a look around to see where this is used
[11:50:19] <joet> amercader, oh sorry, misread!
[11:53:48] <joet> it's used here https://github.com/ckan/ckan/blob/bdb78bc48aba1fc262adcee5bf879c69889932d7/ckan/lib/helpers.py#L1440
[11:54:28] <joet> we're abusing the context again, it seems like user was intended to be a parameter,
[11:54:35] <wardi> ok, but you could have an optional user parameter in data_dict
[11:55:09] <wardi> when missing it defaults to context['user']
[11:55:14] <joet> yeah i agree, that's basically how it is used anyway
[11:55:30] <wardi> is organization membership (ability to edit?) a private thing?
[11:55:35] <joet> as in, organization_available should be change to not specify it in a context
[11:55:44] <wardi> yeah
[11:56:08] <wardi> but it's sensible for the action to return *your* orgs if you call it with no parameter
[11:56:13] <joet> yeah
[11:58:24] <joet> when you call member_list, it seems to show you who's a member/admin/editor
[11:58:29] <joet> (as a nonlogged in user)
[11:58:44] <wardi> so I guess not
[11:58:55] <joet> ok i'll go ahead and add the parameter
[13:27:27] <seanh__> Arg, how to prevent Missing objects from appearing in datasets?
[13:27:56] <seanh__> ignore_missing and ignore_empty in my package_show_schema don't seem to do it, maybe they're causing it actually
[13:29:23] <seanh__> I just want an empty string or None, or the key to be missing from the dict entirely, something JSON serializable
[13:29:32] <seanh__> May have to write my own converter..
[13:48:32] <nigelb> None is not JSN serializeable if that helps.
[13:50:02] <rossjones> nigelb does it not convert to null?
[13:50:16] <rossjones> nigelb maybe it's worth changing the json encoder to handle datetime->isoformat and None->null ?
[13:50:19] <nigelb> I remember getting errors in the past, I could be wrong.
[13:50:32] <nigelb> (not with ckan, but json converter in general)
[13:50:56] <rossjones> nigelb I end up patching the json.encode() calls on each ckan I work on to handle datetimes better :)
[13:52:00] <nigelb> rossjones: maybe we should just fix it in core.
[13:53:46] <rossjones> nigelb the fixed dgu one is at https://github.com/datagovuk/ckan/blob/release-v2.2-dgu/ckan/lib/json.py
[13:54:26] <rossjones> not overly keen on converting the strings to datetimes mind, but from datetime->string is fine
[13:58:40] <nigelb> I don't even know how this bit of ckan works.
[14:11:03] <wardi> nigelb: eh? None is null in json
[16:02:10] <rgrp> btw just a flag of another group who seem to be using ckan https://github.com/CENDARI/ckanext-dariahshibboleth
[16:05:21] <rgrp> hi folks - i was thinking of proposing to the general list the idea of creating ckan forum (forums.ckan.org) perhaps using discourse or similar ...
[16:05:45] <rgrp> this would cover both general matters but i guess also the kind of problem requests that currently go to stackoverflow (some def some dev stuff)
[16:05:59] <rgrp> what do people think - are people happy for me to suggest on list for discussion?
[16:15:15] <amln> i'd say it's yet another channel, that takes up time to deal with.
[16:29:31] <seanh__> We probably have too many channels already, and we keep moving them around. Just fragments the potential audience who are going to answer questions?

2014-08-11
[18:49:23] <andrei> I tried several variations of the command with --reload /etc/ckan/default/production.ini :) it does not work
[18:51:32] <andrei> paster is not runing on my machine from what I can see, Apache is listening on 8080 and nginx forwards 80 to 8080 but paster's 5000 port is free, is this ok?
[18:52:08] <seanh__> paster --plugin=ckan
[18:53:32] <andrei> aha, it lists a lot of commands and datastore is one of them
[18:53:46] <rossjones> paster serve /etc/ckan/default/production.ini
[18:53:51] <rossjones> There is no -c for paster serve
[18:54:17] <rossjones> actually, ignore me, I'm just confusing things.
[18:54:22] <andrei> :)
[18:54:22] * rossjones goes back to his code
[18:55:39] <andrei> paster --plugin=ckan datastore set-permissions SQL_SUPER_USER
[18:55:39] <andrei> AssertionError: Config filename '/usr/lib/ckan/default/development.ini' does not exist.
[18:56:07] <rossjones> NOW you need the -c path-to-.ini
[18:56:17] <andrei> ok
[18:57:04] <seanh__> The order is important: paster --plugin=ckan datastore -c ... set-permissions ...
[18:57:25] <andrei> paster --plugin=ckan datastore -c /etc/ckan/default/production.ini set-permissions SQL_SUPER_USER
[18:57:43] <andrei> paster --plugin=ckan datastore -c /etc/ckan/default/production.ini set-permissions SQL_SUPER_USER
[18:57:47] <rossjones> always put -c path at the end
[18:58:05] <rossjones> paster --plugin=ckan datastore set-permissions SQL_SUPER_USER -c /etc/ckan/default/production.ini
[18:58:06] <andrei> sorry.... 2014-08-11 21:57:01,260 WARNI [ckanext.datastore.plugin] Omitting permission checks because you are running paster commands.
[18:58:06] <andrei> An error occured: sudo: unknown user: SQL_SUPER_USER
[18:58:06] <andrei> sudo: unable to initialize policy plugin
[18:58:09] <seanh__> Are you supposed to replace SQL_SUPER_USER with something else?
[18:58:50] <andrei> ok
[18:59:11] <seanh__> I think you replace it with postgres
[19:00:16] <andrei> paster --plugin=ckan datastore set-permissions postgres -c /etc/ckan/default/production.ini
[19:00:31] <seanh__> That looks right to me
[19:00:36] <andrei> 2014-08-11 21:59:59,873 WARNI [ckanext.datastore.plugin] Omitting permission checks because you are running paster commands.
[19:00:36] <andrei> An error occured: psql: fe_sendauth: no password supplied
[19:00:54] <seanh__> I don't know why someone has replaced postgres with SQL_SUPER_USER in the docs, not that helpful
[19:01:55] <seanh__> Is your database on a different server from CKAN?
[19:02:35] <seanh__> Maybe tru this http://docs.ckan.org/en/ckan-2.2/datastore.html#option-2-command-line-tool
[19:02:35] <andrei> no
[19:02:57] <seanh__> Hmm, then I don't know what that error is about
[19:03:20] <andrei> I think it's the way the user authenticates to pg
[19:03:35] <seanh__> What version of CKAN?
[19:05:04] <seanh__> Yeah maybe the paster command isn't compatible with the way you have postgres setup. Try the 3rd option: http://docs.ckan.org/en/ckan-2.2/datastore.html#option-3-sql-script
[19:05:55] <seanh__> andrei: But if you installed CKAN using the package install, then datastore should already be setup for you
[19:07:15] <seanh__> Are you really using CKAN 2.0?
[19:07:20] <andrei> it's 2.0.something....
[19:07:29] <andrei> if you want I can check the exact version
[19:07:33] <seanh__> Yeah
[19:09:14] <seanh__> Try this to see if you already have datastore setup: http://docs.ckan.org/en/ckan-2.0.4/datastore-setup.html#test-the-set-up
[19:10:05] <andrei> hmmm.... strange.... the sql file seems to have some files inside
[19:10:06] <andrei> http://pastebin.com/af2shTBL
[19:10:10] <andrei> some variables inside
[19:10:24] <seanh__> Yes
[19:10:25] <andrei> "{ckandb}"
[19:10:30] <andrei> where does it get them?
[19:10:39] <seanh__> But you should really test to see if you already have datastore setup
[19:11:22] <seanh__> You're supposed to edit the script and fill in the correct values
[19:13:32] <andrei> I get an ugly error when I want to see a resource
[19:13:47] <andrei> my datastore is not set up
[19:14:28] <andrei> on production I get "success": false when I hit it with curl, but onmy machine I get 500
[19:16:38] <andrei> I broke it :) http://pastebin.com/zSuhrwjQ
[19:16:47] <andrei> I'll replace the variables in the sql file
[19:19:13] <andrei> which one is the "{datastoredb}" ? from ckan.datastore.write_url = postgresql://writeuser:123456@localhost/datastore and ckan.datastore.read_url = postgresql://readonlyuser:123456@localhost/datastore? is it writeuser?
[19:19:42] <andrei> ohh it's datastore
[19:26:09] <andrei> I ran it again and the seanh sql seemed to work but I still get error 500
[19:32:51] <andrei> the _table_metadata does not seem to be populated
[19:33:38] <andrei> it has only 2 rows and my sql breaks when it searches SELECT 1 FROM "_table_metadata" WHERE name = 'f0b8cb1b-3f93-4faf-bcde-07c1b730e0c1'; and it gets 0 results on db datastore
[19:34:08] <andrei> I feel I'm getting close here :P
[19:50:13] <andrei> <seanh__> can you please check this out? ^ I think I'm pretty close to fixing this issue
[22:59:33] <andrei> thank you <seanh__>, <rossjones> and <wardi> :D :D it works now. I can't wait to see it in "production". I use now the datastore and not the dataproxy
[23:06:14] <travis-ci> [travis-ci] ckan/ckan 1792-filterable-resource-views 5d96bc5 http://travis-ci.org/ckan/ckan/builds/32280216 Vitor Baptista: The build was broken.

[10:36:23] <tryggvib> I'm moving tests over to new_tests, but I don't fully understand how interfaces are tested
[10:36:35] <tryggvib> the docs say this: "The tests for the code that calls the plugin interface methods should test that the methods are called correctly."
[10:36:41] <tryggvib> but I don't see that being done
[10:37:21] <tryggvib> there's even an example about "ckan.logic.action.get.package_show()" which I can't see in the tests
[10:37:42] <tryggvib> anybody willing to help me on this so I won't spend ages trying to figure this thing out
[10:52:20] <seanh__> tryggvib: Yeah, I'm not sure that any new-style tests for plugin interfaces have actually been written
[10:53:50] <seanh__> I think this is probably worth discussing in the dev meeting tomorrow
[10:54:13] <seanh__> I know that wardi is currently working on new plugin interface stuff and thinking about how to test it as well
[10:54:19] <tryggvib> ok
[10:54:33] <tryggvib> I'll just create the example plugin and create tests for that
[10:54:40] <tryggvib> would that be enough
[10:54:44] <tryggvib> or should I wait?
[10:54:48] <seanh__> I think how to write the tests that the plugin interfaces get called, and even whether that is really what we want to do, is still an open question
[10:55:03] <seanh__> In my opinion an example plugin with tests would be enough, I'd be happy to merge that
[10:55:17] <tryggvib> alright I'll do that
[10:55:29] <tryggvib> how elaborate should the example plugin be?
[10:55:38] <tryggvib> I was just thinking about the mock plugin I did for the old test
[10:55:54] <seanh__> I would say it should be as minimal as possible to sufficiently test the interface
[10:55:59] <tryggvib> yes :)
[10:56:03] <tryggvib> thanks seanh__
[10:56:46] <seanh__> You might find the ckanext-datapackager or ckanext-oauth2waad tests useful, for getting CKAN to load your plugin and test it
[10:57:14] <tryggvib> thanks, will look into it
[11:39:48] <rossjones> why is adding to the resource schema so hard? :( Today is total fail.
[11:50:50] <tryggvib> rossjones: is addingto the resource schema hard?
[11:50:57] <tryggvib> oh noes!
[11:51:01] <tryggvib> that's next on my list
[11:51:39] <rossjones> Problem is with editing a resource in draft mode, it limits the fields it returns so your new fields don't get filled in.
[11:51:42] <rossjones> I *think*.
[11:52:26] <rossjones> https://github.com/ckan/ckan/blob/master/ckan/controllers/package.py#L588-L595
[11:53:48] <rossjones> I fixed it in out patches because the redirects are all fixed (and wrong) for our new workflow :(
[11:54:01] <rossjones> fixed as in unchangeable.
[12:40:55] <wardi> rossjones: that's weird. I wonder why it hasn't caused a problem for us
[12:41:49] <rossjones> wardi do you allow editing of resources whilst creating the dataset? Maybe not many people change resource metadata during draft.
[12:42:02] <rossjones> Unfortunately it's sort of key to our new workflow.
[12:42:31] <wardi> don't you edit resources when you create every new dataset?
[12:43:12] <rossjones> wardi I *think* so, the controller's a bit confusing.
[12:43:23] <rossjones> Wish it had its own.
[12:43:27] <wardi> "a bit" is an understatement
[12:44:03] <wardi> I might be breaking things because my two-stage dataset stuff tried to simplify it somewhat
[12:44:52] <rossjones> I might just go and sit in the corner and have a little cry. It'll all make more sense when I come back.
[12:45:14] <wardi> https://github.com/ckan/ckan/blob/master/ckan/controllers/package.py#L618
[12:45:23] <wardi> I love "temporary code"
[12:48:23] <rossjones> it'll be there forever.
[12:48:50] <wardi> seanh__: if you're looking for some place to start with functional-core-imperative-shell rewrites, I nominate the package controller
[12:49:55] <wardi> rossjones: that docstring makes no sense. where's the code that allows styling the form?
[12:51:04] <rossjones> It's this bit that is a pain - https://github.com/ckan/ckan/blob/master/ckan/controllers/package.py#L685-L704
[12:51:14] <rossjones> well, this morning.
[12:51:23] <rossjones> am sure it'll be a different bit this afternoon.
[13:25:49] <wardi> rossjones: what do you think about https://github.com/ckan/ideas-and-roadmap/issues/45
[13:26:46] <wardi> you're probably working on one of the most advanced ckan workflows around, do you think your requirements could be met by this kind of thing?
[13:27:01] <rossjones> heh my response to that is illegible months later, wonder what I meant.
[13:28:10] <rossjones> It's very similar to the old idea of "moderated-edits", but I'm not sure how far that ever got. Certainly don't think it's in use anywhere, and hopefully has been removed from code.  Is markw still about? He used to have strong opinions on that as I recall.
[13:29:34] <rossjones> wardi definitely +1 on scheduled publishing, the other stuff feels like it'd be a lot like a PR :)
[13:29:49] <rossjones> Maybe like a patch of the json rendering?
[13:50:33] <wardi> who was working on removing moderated edits
[13:51:20] <wardi> this is different because it's more of a patch workflow. "here's the change I'd like to make" and it could get applied or not
[13:52:09] <rossjones> I prefer that idea than relying on revisions :)
[13:52:13] <wardi> as opposed to "I am updating the private but globally shared working version of this dataset"
[13:52:35] <rossjones> https://github.com/ckan/ckan/issues/1414
[13:54:35] <wardi> I wonder if david still has time. That's blocking the removal of (or making-optional) revisions
[13:55:08] <wardi> I'll add a comment so I remember to discuss it tomorrow
[15:50:13] <tryggvib> rossjones: did you make any progress on extending the resource schema?
[15:55:51] <rossjones> tryggvib yes, but I am not sure it is right. joet told me a while back not to use the default_resource_schema, use the appropriate package schema and schema['resources'].extend({ ... })
[15:57:48] <tryggvib> ok
[15:57:53] <tryggvib> I'll have a go at it
[15:58:33] <joet> I don't remember what the problem was with default_resource_schema, but using the package schema basically sidestepped the issue
[16:07:04] <rossjones> tryggvib also don't think you need the convert_to_extras converter in the validation list either.
[16:50:12] <tryggvib> rossjones: ah ok
[17:44:32] <seanh__> ckanapi's LocalCKAN is crashing with some weird sqlalchemy error, when trying to get the site user on ckan release-v2.2.1
[17:46:57] <seanh__> Also on 2.2 and master
[17:48:40] <seanh__> sqlalchemy.exc.UnboundExecutionError: Could not locate a bind configured on mapper Mapper|User|user, SQL expression or this Session
[17:53:28] <wardi> seanh__: hmm
[17:54:59] <wardi> seanh__: full traceback? file a bug maybe?
[17:56:40] <seanh__> wardi: https://github.com/ckan/ckanapi/issues/24
[17:58:33] <wardi> seanh__: LocalCKAN needs to be run from a paster command
[17:58:53] <wardi> it looks like you're using it from a normal script
[17:59:33] <seanh__> Ah, I didn't realise that
[18:00:01] <wardi> no, it's a good bug report. I'll comment there
[18:00:05] <wardi> it
[18:00:11] <wardi> 's an easy thing to miss
[18:01:07] <seanh__> Ok, and I'll write a paster command to wrap my script tomorrow, thanks
[18:05:37] <andrei> hi guys, I'm a volunteer trying to fix the Romanian data portal preview feature. I think I need to install the datastore plugin but I have some troubles with it.
[18:06:20] <andrei> when I run "paster datastore set-permissions SQL_SUPER_USER" I get this error http://pastebin.com/4KNRzGUu
[18:13:20] <andrei> and this is my production.ini file http://pastebin.com/JEU7Vje3
[18:14:29] <andrei> do you guys have any clue what I'm doing wrong? thank you
[18:23:44] <wardi> andrei: activate the virtualenv with ckan installed?
[18:29:16] <andrei> I did not install this instance and I think it was not installed with virtualenv. this is the tutorial they used http://docs.ckan.org/en/ckan-2.0/install-from-package.html
[18:30:34] <andrei> virtualenv is not even installed on the system. should I install it anyway? from what I can figure out, it uses the system python
[18:33:23] <wardi> andrei: try ". /usr/lib/ckan/default/bin/activate"
[18:37:10] <andrei> <wardi> thank you, I am in virtualenv now. I ran "cd /usr/lib/ckan/default/ && source bin/activate"
[18:37:27] <andrei> (default)datagovro@date:/usr/lib/ckan/default$
[18:37:33] <andrei> but I get the same error
[18:39:56] <wardi> andrei: try with "paster -c /path/to/production.ini ..."?
[18:44:35] <andrei> paster: error: no such option: -c
[18:46:27] <wardi> what does "which paster" say?
[18:48:14] <andrei> /usr/lib/ckan/default/bin/paster

2014-08-10

2014-08-09

2014-08-08
[09:50:12] <ntoll> ping seanh__
[10:26:43] <seanh__> ntoll: What are you pinging me for?
[10:27:47] <ntoll> seanh__, your MS AD OAuth plugin
[10:27:51] <ntoll> but I'm just in a meeting
[10:28:04] <ntoll> ckanext.oauth2waad
[10:28:19] <ntoll> trying to map settings in Azure to the settings in the .ini file
[10:28:21] <ntoll> for example
[10:28:34] <ntoll> ckanext.oauth2waad.resource <- what should go here..?
[10:29:32] <seanh__> ntoll: That's the name of the "resource" that you want to use the oauth2 access token to access
[10:29:39] <ntoll> when I try to use the plugin I get: https://gist.github.com/ntoll/5c94e963490628257152
[10:30:13] <ntoll> where resource is localhost:5000 in my dev case right..?
[10:31:01] <ntoll> more accurately https://localhost:5000/
[10:33:04] <seanh__> ntoll: No. It's if your CKAN site (via another plugin) is going to be using the oauth2 access token to make requests on behalf of the user to *another* siter
[10:33:50] <ntoll> that's not a use case we're interested in
[10:34:05] <ntoll> so if I just set it as blank "it should just work" (tm)..? ;-)
[10:34:20] <seanh__> Maybe you can leave resource blank then? Or enter a fake value? I'm not sure, depends on whether the MS server will accept that
[10:34:30] <seanh__> Possibly
[10:34:32] <ntoll> tbh, I think it's aweseom that this plugin exists... svaing us a lot of time
[10:34:54] <seanh__> You may have to fix ckanext-oauth2waad to allow the resource setting to be missing, and ignore it / not send it to MS
[10:35:01] <seanh__> ntoll: Great!
[10:35:12] <seanh__> You are using MS Windows Azure OAuth 2.0 then?
[10:38:09] <ntoll> yup
[10:38:20] <ntoll> hands tied on this one so we're beingf forced to use it
[10:38:32] <ntoll> and yes ^^^ modify the plugin
[10:38:58] <seanh__> ntoll: Pull requests welcome! But ping me if you make one so I don't miss it
[10:39:07] <ntoll> will do
[10:43:09] <ntoll> ok... so resource is a required field
[10:43:23] <ntoll> and I can't just put nonsense but valid URL there
[10:43:48] <ntoll> the problem I get is: AADSTS90027: The client '909caff2-f9f3-4597-856f-8b140e0ebb9f' and resource 'https://localhost:5000/' identify the same application.
[10:44:05] <ntoll> so the UUID is, of course, our client_id
[10:44:18] <ntoll> the resource is https://localhost:5000/
[10:44:34] <ntoll> which is my local dev instance of CKAN
[10:52:53] <seanh__> The resource shouldn't be your dev instance
[10:53:52] <seanh__> WHen we use it for example, we're using the MS OAuth 2.0 server to log people in, and then another plugin that's running on our CKAN is using the access token from the auth server to make API requests to a different MS server ("the resource") on behalf of the user
[10:54:29] <seanh__> From what you're saying, it sounds like MS Windows Azure OAuth 2.0 doesn't work when you don't have one of these "resources" to give it?
[10:54:38] <seanh__> In that case you need to speak to MS, I guess
[10:57:25] <ntoll> right
[10:57:31] <ntoll> that's what I was thinking
[10:57:59] <ntoll> it's some sort of MS configuration problem (and we apparently have "resource" from the M$ end of things to investigate and advise)
[10:59:00] <ntoll> seanh__, so it's not mentioned in the docs for the plugin that you need a second plugin to use. It sounds like you merely need the single plugin and you'll be able to log in via AD.
[11:03:10] <seanh__> Yes, you can use just the single plugin to login
[11:03:34] <seanh__> And when you're logged-in, the plugin puts your access token in the session
[11:03:40] <ntoll> in which case, we're in a catch 22 - what resource to specify (since AD appears to need one)
[11:03:48] <davidmiller> ntoll: I think resource is optional in the API.
[11:03:55] <davidmiller> http://msdn.microsoft.com/en-us/library/azure/dn645542.aspx
[11:03:55] <seanh__> Other plugins that are running can take that token from the session and use it to access "the resource"
[11:04:13] <ntoll> davidmiller, right...
[11:04:15] * ntoll looks
[11:04:18] <ntoll> (again) ;-)
[11:04:20] <seanh__> The problem is I didn't consider the use-case where you really only want to login and don't even have a resource (and apparently neither did MS)
[11:05:05] <seanh__> ntoll: It could be that ckanext-oauth2waad is always sending a resource string to the OAuth 2.0 server, even if your resource setting is empty in your config? That might be what you need to fix
[11:05:27] <ntoll> seanh__, I'll look into it
[11:06:23] <ntoll> seanh__, in the _get_user_details_from_waad function the data sent to the endpoint always contains a resource. I've modified it so it doesn't send a resource and get a different error (i.e. resource is mandatory)
[11:06:51] <seanh__> Ok, so if the MS server claims that resource is mandatory that seems to be a bug with the MS server
[11:07:11] <ntoll> right... or misconfiguration on our part
[11:07:34] <davidmiller> Or the use case ntoll has requires a different grant_type
[11:07:57] <seanh__> Could be yeah
[11:08:58] <ntoll> authorization_code appears to be the right one tho... AFAICT
[11:09:58] <ntoll> davidmiller, and you're right, resource appears to be optional
[11:10:00] <ntoll> :-/
[11:26:00] <seanh__> Heads up: requests has been upgraded: https://github.com/ckan/ckan/pull/1819
[11:26:10] <seanh__> Devs will need to re-run pip install -r requirements.txt
[14:39:42] <vitorbaptista> seanh__: Yeah, it's another way of dependency injection that's available in dynamic languages as Ruby or Python. It doesn't make the dependencies explicit, as the way you've done does, but it isolates the code for eg "get me the db connection" in a single place that can be shared anywhere
[14:40:27] <vitorbaptista> Then in the tests you could mock that out simply by opening the class and overloading the method (in Ruby, not sure how that would work in Python), or simply use the mock library
[14:41:28] <vitorbaptista> It's just that sending all dependencies as you've done gets cumbersome fast, and Python provides better ways of injecting the dependencies other than by the parameters
[14:42:07] <vitorbaptista> So the params could be left just for the data the method needs
[15:44:00] <travis-ci> [travis-ci] ckan/ckan 1792-filterable-resource-views 0c7c62a http://travis-ci.org/ckan/ckan/builds/32021661 Vitor Baptista: The build was broken.
[17:09:27] <seanh__> vitorbaptista: I don't see what that has to do with dynamic languages though - you can override methods in Java as well
[17:10:17] <seanh__> I can see the advantage of keeping the param list clean, and also if getting foo is non-trivial and many functions in your code depend on foo, then they can all call the same _get_foo() function. Which also makes it easier to replace foo with something else one day
[17:11:17] <seanh__> On the other hand, at least from the point of view of the tests it's much simpler to pass in a (possibly mock) dependency as a param than to patch or override a function or method (or to us "mixins" or "metaprogramming" or any of the other words he uses)
[17:12:15] <seanh__> That's what I find slightly weird about that post - he seems to be talking about "dependency injection" and "DI frameworks" and saying they are complicated compared to simple mixins and metaprogramming, but dependency injection just seems to mean passing in dependencies as params which is actually much simpler!
[17:12:40] <seanh__> Still, the _get_dependency() function approach does seem to have advantages, I'd love to see some examples in CKAN
[17:13:41] <seanh__> Patching a _get_foo() function in your tests means that your tests are tightly coupled to an implementation detail of the method under test though - the fact that it calls _get_foo(). That's bad
[17:18:51] <seanh__> Putting the dependency as a param clutters up your function's parameter list, but it makes the dependency an explicit part of the functions public signature not an internal implementation detail, which I like for decoupling functions (and test functions) from each other
[17:20:02] <seanh__> And if getting foo is non-trivial, then I guess you can have a _get_foo() helper shell function and each shell function that has to pass in foo to a core function can just do core_function(_get_foo()) ... So I think I'm still leaning more towards parameters for this, but a good example could convince me
[20:41:53] <vitorbaptista> seanh__: It's been a long time since I programmed in Java, but I didn't remember that it had open classes. For example, given that there's an object user of class User, I can't go and change one of its methods at run time, can I?
[20:44:28] <vitorbaptista> About the weirdness of the post, I guess what he meant is that he doesn't feel the need to use a DI framework on Ruby, because there are other DI methods native to the language itself (and not on Java)
[20:45:13] <vitorbaptista> You could use passing parameters as a method to do DI in both languages, and both would be the same. But usually (from what I read, as I said, it's been a long time since I developed in Java), people prefer using DI frameworks
[20:47:20] <vitorbaptista> Probably because it's less cumbersome than passing all dependencies over the param list
[20:48:41] <vitorbaptista> Anyway, as everything, we have to balance things out. Not explictly passing the dependencies has its advantages and disadvantages (the dependencies aren't obvious from the param list)
[20:51:02] <vitorbaptista> On the other hand, if we don't do that, we would have to couple our tests to the implementation
[20:53:36] <vitorbaptista> Depending on the test and on what _get_foo() is, we could lessen this issue. For example, if _get_foo() is actually getting the DB to save, and we want to avoid hitting the DB, we could replace that to a mock _get_foo() that saves in memory or something like that. Depending on how we do it, it could be as simple as "load_mock_db()" and be done with it. This way, we still couple to an implementation detail, but
[20:53:38] <vitorbaptista> that code is isolated in a separate method and not repeated on every test
[20:57:48] <vitorbaptista> This is all too abstract, though. If I have any examples, I'll send you. In the mean time, it's great to think about this stuff :)

2014-08-07
[09:58:30] <tryggvib_> I've been looking into the resource uploader for datastore, trying to make sense of how it works, i.e. these lines: https://github.com/ckan/ckan/blob/master/ckan/lib/uploader.py#L190-L225
[09:59:16] <tryggvib_> and after trying to figure out how something could get "cleared" and uploaded at the same time I played around with this
[10:00:10] <tryggvib_> turns out cleared is only set when you remove the filename in the form (via javascript and a hidden field called clear_upload)
[10:00:39] <tryggvib_> but as soon as you upload another file clear_upload is reset to nothing
[10:01:02] <tryggvib_> so a file can't be cleared and another uploaded at the same time (leaving the old one on disk)
[10:01:57] <tryggvib_> and since you always have to link or upload to a resource (form won't validate if not) the only case I can see ever to use this clear thing is someone's uploaded a file and then changes that to a link
[10:02:07] <tryggvib_> is that the expected behaviour?
[10:02:11] <tryggvib_> and if so, why?
[10:04:30] <joet> seems like an oversight, might be best to ask nigelb
[10:06:14] <nigelb> tryggvib_: which bit are you asking is expected?
[10:06:25] <nigelb> the fact that you can't have two versions of the same file on the server?
[10:06:32] <nigelb> That bit is expected.
[10:08:07] <tryggvib_> nigelb: well, all of it. Not deleting uploaded files when you upload another file to replace it in that resource and that it is deleted only when one changes an uploaded file to a link
[10:08:35] <tryggvib_> I would have thought we'd want to remove old files always
[10:08:44] <tryggvib_> so I guess joet is right about the oversight
[10:10:30] <tryggvib_> I'll file a bug
[10:10:50] <nigelb> tryggvib_: the old file is not deleted because it's overwritten.
[10:11:02] <nigelb> when you upload a newfile, the old file will be overwritten with the new file.
[10:11:31] <nigelb> when you add a link is when it needs to be manually deleted, that's why the clear function is called only then.
[10:16:09] <tryggvib_> nigelb: hmmm
[10:17:36] * tryggvib_ investigates
[10:18:57] <tryggvib_> yes, you're right
[10:19:09] <tryggvib_> nigelb: I got mixed up in filepath and filename
[10:19:25] <nigelb> tryggvib_: I know this because when I did the review, I asked the *exact* question :D
[10:20:10] <tryggvib_> I think this is a very fragile way of doing things
[10:20:52] <nigelb> tryggvib_: If you think it needs to be done differently, let's discuss in a bug?
[10:21:08] <tryggvib_> no I just needed to understand
[10:21:19] <nigelb> I couldn't see any problems with it, but i'm open to the idea of there being a better way.
[10:24:27] <tryggvib_> nigelb: no I think we're fine
[10:24:38] <tryggvib_> I'm doing some updates here so I'll just add comments
[10:24:48] <tryggvib_> that should help others who come after us
[10:25:01] <nigelb> Oh good, cheers :)
[10:58:23] <wardi> soon: https://plus.google.com/hangouts/_/event/cb1vmkss426lkqicj94a3amvd1c?authuser=0&hl=en-GB
[11:02:34] <joet> come one come all
[11:10:05] <nigelb> http://docs.gunicorn.org/en/latest/design.html
[18:22:56] <travis-ci> [travis-ci] wardi/ckan 1841-ivalidators-iconverters 683c7ff http://travis-ci.org/wardi/ckan/builds/31939887 Ian Ward: The build has errored.
[19:00:26] <seanh__> vitorbaptista: What I understood from that article, it's basically saying that instead of passing in a dependency foo as a parameter, you write a _get_foo() function and have you worker function call it to get the dependency?
[19:01:17] <seanh__> Or if it happens to be a class, then it's a _get_foo() method, potentially provided via a mixin
[19:23:04] <travis-ci> [travis-ci] wardi/ckan 1841-ivalidators-iconverters 514b056 http://travis-ci.org/wardi/ckan/builds/31944591 Ian Ward: The build was broken.
[20:06:47] <wardi> tag_string_convert converts and validates :-/
[20:07:28] <wardi> while I'm documenting I guess I'll say validators are allowed to convert but converters shouldn't validate (even though it doesn't really matter)
[20:08:11] <wardi> the distinction is growing even more tenuous for me
[20:09:58] <wardi> so I'll document all the validator and converter types accepted in validators.py and just link to that doc from converters.py
[20:10:02] <wardi> seanh__: ^

2014-08-06
[17:48:44] <vitorbaptista> seanh: I agree with passing to the methods just what they need (instead of passing a "data_dict" that can have anything), but I'm a bit more skeptical with the advantages of injecting the dependencies that way in Python
[17:48:50] <vitorbaptista> (by passing the methods it needs through the parameters)
[17:50:59] <vitorbaptista> I'd rather mock them out during tests if needed, or maybe use mixins as exemplified in http://fabiokung.com/2010/05/06/ruby-and-dependency-injection-in-a-dynamic-world/ (this is for Ruby, but you can consider that a ruby module used in this way is equivalent to a python mixin)
[17:58:14] <vitorbaptista> I like the way you avoided going through the controller (by creating a separate _login) method. It reminds me of the "fat model, skinny controller" mantra that we could do a lot more. I feel that, as we usually pass over the models as dicts, we don't use methods in the models as much as we should
[18:04:48] <wardi> vitorbaptista: "data_dict" is usually "all the values the caller passed" which kind of makes sense. "context" is the thing that can have anything
[18:27:31] <vitorbaptista> wardi: The context is worse, but even for the data_dict, I think we overuse it. An extreme example is the "follow_group" action, which takes a context and data_dict (as every action), but only needs an id on the data_dict. So the group controller simply does "data_dict = {'id': id}", and pass it through
[18:28:14] <vitorbaptista> My problem with that approach is that it relies too much on comments. It says that it only uses data_dict['id'], but I can't be sure that no one else is passing something else on the data_dict and we forgot to update the comment
[18:28:41] <vitorbaptista> There are places where this pattern is useful, but not all
[18:29:35] <vitorbaptista> And we prefered to keep the action methods consistent (just accepting context and data_dict) instead of using whatever makes most sense in each case
[19:15:59] <wardi> action functions all having the same signature is fine (and desirable!), but I think the (context, data_dict) pattern leaks to the functions called by those action functions, which isn't fine

[12:55:51] <seanh> I'm trying to implement first-level category and second-level category custom dataset fields
[12:56:08] <seanh> Both fields are dropdown lists with a set of possible values
[12:56:25] <seanh> But the possible values for the second category depend on the selected value for the first
[12:56:54] <seanh> I'd love to store these as tag vocabs and get the API for managing the available values, but they don't support the hierarchical aspect
[12:57:39] <seanh> I think what I might do is have one top-level category vocab, then generate a vocab for each tag in the top-level vocab
[12:57:54] <seanh> Where the vocabs would have the same names as the tags
[12:58:21] <seanh> Then given a selected tag from the top-level vocab, you can find the matching vocab to get the second-level options
[13:14:17] <joet> the code/templates for organizations/groups really seem to need some loving.
[13:18:49] <joet> the templates are still calling parts of api2, it uses c everywhere and the parameters for member_delete are a bit of a mess stuff like, you can specify user_id or username in delete, but only username in member_create.
[13:19:33] <joet> and there's no schemas for that stuff, you have to end up having to read several functions to figure out what it wants
[13:31:40] <seanh> Tags in CKAN only have names, not titles, and the names are used in some URLs so they can only contain certain characters
[13:32:17] <seanh> So if you're using tag vocabs to implement a custom field that's a dropdown <select>, the <option>s for the <select> can't contains commas or colons or anything
[13:32:51] <seanh> It's nice that you get an API for managing the options for the field without changing the code, but not worth the cost of having to explain to the client that I had to remove all the commas from their strings
[13:33:18] <seanh> I think I'll just roll my own based on hard-coded options
[13:33:49] <seanh> Adding a title field to tags would be a nice good-for-contribution issue I think
[13:48:53] <seanh> The more experience I get with CKAN, the more often I seem to be making decisions like this: Instead of building on [some CKAN feature] I'm just going to roll my own thing
[14:10:04] <amln> seanh: i would imagine others are in the same boat, too
[14:21:10] <seanh> facepalm
[14:21:53] <seanh> Why am I trying to implement separate first-level and second-level category fields and have the options for the second one changing when the selected option for the first one changes?
[14:22:00] <nigelb> the tags having names and titles complicates creating them.
[14:22:19] <seanh> All I need is a single <select> with <optgroups> and <options>: http://www.w3schools.com/tags/tryit.asp?filename=tryhtml_optgroup
[14:22:39] <seanh> The choice of a second-level category implies a chosen first-level category
[14:22:54] <seanh> nigelb: Not really, title would be an optional field, by default same as name
[14:23:22] <seanh> I can see why tags had names only when they were first implemented though, tag vocabs didn't exist back then
[14:23:28] <nigelb> well, right now, you create tags as you type.
[14:23:39] <nigelb> but if you change to have title, you'll need to mess with the ux.
[14:23:57] <seanh> No you'd leave the UX the same and set title to the same as name
[14:24:17] <nigelb> and then for things where you want to have extra chars create it elsewhere?
[14:24:30] <seanh> But then people who're creating vocab tags via the api could specify different names and titles and use whatever characters they want in the titles
[14:24:32] <seanh> Yeah
[14:24:39] <seanh> This is only useful for vocab tags
[14:25:00] <nigelb> that actually sounds like a good idea.
[14:25:11] <nigelb> now that we have john back....
[14:25:39] <seanh> This is a backend feature really though
[14:25:53] <nigelb> yup
[14:26:05] <nigelb> but, the frontend will need to play nice with tags with commas
[14:26:16] <nigelb> if I remember correctly, the code there is a bit fragile.
[14:28:41] <seanh> I think we'd want to make sure that you can only create vocab tags with commas etc in them, not free tags
[14:28:56] <seanh> The frontend always works with free tags only, I think
[14:29:28] <seanh> To be honest, vocab tags should not be built on top of the same model and API as free tags at all, they're two different things
[15:02:02] <joet> seanh, got round to skimming that testing document you wrote, I think that's the style we'll have to write things if we ever want to switch all the controller code off of pylons
[15:03:01] <wardi> that will help, good point
[15:03:17] <joet> we should probably do a similar thing to many of the template helpers which are rely on things like c or pylons.request
[15:03:38] <wardi> could even run multi-framework for a while with some duplicate shell code
[15:04:27] <joet> wardi i did a quick attempt at that one night at the okfestival, i managed to get the about page to just about render
[15:04:42] <wardi> sweet
[15:04:55] <joet> but it involved jamming things like "h" into the template context
[15:08:11] <seanh> It's really easy to program like that and write tests as well, once you get the hang of it
[15:08:33] <seanh> I'm still programming "normally" and then refactoring it to work like that when I come to write tests/if there's time
[15:08:53] <seanh> But making it a habit to write like that in the first place is probably a good idea
[15:29:59] <seanh> Tactical Tech are hiring a Django and Drupal web dev. How are they going to find a good Python developer who will also go anywhere near Drupal?
[15:31:12] <seanh> Essential skills: Demonstrable experience building complex sites in Django. Experience in working with Drupal or willingness to learn and work with Drupal. "Willingness to learn and work with Drupal", heh
[15:37:07] <amln> work with: maybe. learn: dear god, not the code.
[15:37:18] <amln> (drupal has some things right, in defence)

2014-08-05
[09:47:05] <IvanErmilov> Hi everyone! What is the estimate Postgres DB size for a CKAN portal with 4k-5k datasets? (Without datastore enabled)
[09:49:58] <maxious> 400MB maybe? 3500 is 187MB for me
[09:55:20] <IvanErmilov> Maxious, thanks a lot for the answer!
[10:55:13] <nigelb> I'll be missing dev meeting today. upgrading wordpress.
[11:00:51] <wardi> https://plus.google.com/hangouts/_/event/cb1vmkss426lkqicj94a3amvd1c?authuser=0&hl=en-GB
[12:56:40] <joet> anyone ever run into problems with there being no registered beaker session when writing tests?
[13:01:11] <joet> i've side stepped it by mocking out the helpers.flash_success function in the test, but it feels a bit ugly
[14:42:05] <razz0_> demo.ckan.org gives Internal Server Error when adding dataset
[15:09:37] <vitorbaptista> Does someone knows how we update the different CSS styles we ship on CKAN by default? Like green, fuschia, etc... I was expecting I would find a green.less which just overloaded the color variables, but couldn't find it
[15:15:42] <joet> ah one test fails and causes the rest to fail with DetachedInstanceErrors, classic ckan.
[15:51:28] <seanh_> joet: Have you seen this? http://seanh.cc/posts/functional-core-imperative-shell/ If you design your code so that it's decoupled from CKAN, you can test it without touching things like Beaker or SQLAlchemy. Or if you're testing existing code and can't refactor it, that post might help you with how to mock them out as well (although that gets ugly fast)
[15:52:20] <joet> thanks seanh_ , I'll have to give it a look.
[16:54:56] <seanh_> Anyone know a quick way to get the name of the user who last updated a particular dataset in CKAN?
[16:55:13] <seanh_> I'm guessing that querying the activity streams is going to be simplest
[17:17:24] <seanh_> Ok this is weird, activity streams don't seem to be working for me locally
[17:17:45] <seanh_> When I create or update a dataset, nothing goes into its activity stream and its activity stream page is empty
[17:17:55] <seanh_> And I do have activity streams enabled in my config
[17:19:06] <wardi> seanh_: using the site useR?
[17:19:20] <seanh_> No. updating as a logged-in user
[17:19:46] <wardi> that's odd
[17:19:47] <seanh_> Sadly package activities work through a sqlalchemy session extension weirdness instead of in the logic, so not so easy to debug
[17:19:58] <seanh_> I can.t imagine what this is going to turn out to be
[17:25:27] <seanh_> activity_create isn't getting called...
[17:28:56] <seanh_> Ok, so when I update a package the only changed object that's coming through CKAN's activity streams session extension is a revision object, so CKAN doesn't record any updated package (there should be a Package object coming from there)
[17:29:03] <seanh_> Wtf? There are tests for this
[17:29:24] <seanh_> Also this is happening on 2.2, not just on master
[17:29:41] <seanh_> I would test on demo.ckan.org but it's 500ing on creating datasets right now
[17:31:03] <seanh_> Activity streams are working fine on master.ckan.org
[17:43:08] <seanh_> Ok, this is happening on release-v2.2 with a freshly created config file and a freshly cleaned and initialized db: No activity streams for packages
[17:43:22] <seanh_> Something is breaking the sqlalchemy session extension
[17:43:54] <seanh_> This is on an Ubuntu 12.04 VM as well, same versions of postgresql and sqlalchemy as ever
[17:58:51] <seanh_> I have no idea what this is
[17:59:57] <seanh_> It seems to be my VM only, our 2.2.1 staging site is fine. Destroyed and recreated my virtualenv, rebooted the vm, recreated the config file, clean and reinitialized the db, problem is still there
[18:00:26] <seanh_> Running the tests on my vm now, but I'm completely out of ideas
[18:24:58] <seanh_> GOd those tests take a long time to run. But all the tests passed and then when I ran CKAN in paster again afterward, without changing anything else, the activity streams are working again
[18:25:17] <seanh_> That cost me an hour... But mostly, what the hell happened??

2014-08-04
[06:25:17] <travis-ci> [travis-ci] ckan/ckan 1682-bulk-process 5e64fa9 http://travis-ci.org/ckan/ckan/builds/31589092 nigelb: The build was broken.

2014-08-03

2014-08-02
[06:00:38] <nigelb> seanh_: switch to awesome. It gets out of your way.
[09:23:50] <seanh_> nigelb: I've never really given awesome a proper shot. I got a bit sick of i3 - very user friendly for a tiling wm, great docs ands lots of features, but I found it too complicated and the end result is lots of windows opening in annoying strange sizes and shapes
[09:24:02] <seanh_> For now I've switched back to dwm which is very simple
[09:24:50] <seanh_> Not a huge fan of changing config settings by modifying a C header file and then closing all my apps, logging out and recompiling. It discourages you from distracting yourself by fiddling with WM settings I guess
[09:25:11] <seanh_> A non-tiling one that I've always like is openbox
[09:26:42] <seanh_> You do tend to invite weird problems by changing away from one of the mainstream WMs. Right now in dwm for example, sound is coming out of my speakers instead of my USB headset no matter what I do
[09:29:57] <nigelb> Heh.
[09:30:01] <nigelb> awesome's config is lua
[09:30:18] <nigelb> seanh_: The more simpler wm that I've liked is xfce.
[09:30:22] <nigelb> mostly like the old gnome
[09:30:26] <nigelb> and stays out of your way.
[09:31:21] <seanh_> It's certainly a just works like people expect it no surprises one. I was never a huge fan for some reason, always just felt like a cheap version of classic gnome to me.
[09:31:51] <seanh_> Also there was a time when xubuntu actually used much more memory and cpu than ubuntu did, probably long gone now though
[09:32:16] <nigelb> oh yeah.
[09:32:30] <nigelb> I liked xfce. awesome just boots up faster and is more lightweight for what I need.
[09:33:26] <nigelb> (at that time my computer was 6-years-old and very slow with anything but awesome.
[09:33:47] <nigelb> Later realized it was the fault of and old version of btrfs.
[09:34:51] <seanh_> One thing about tiling WMs though: I think it's hard to make them look pretty. No one who develops them cares of course. But the mainstream overlapping WMs (OS X, Unity, Gnome 3) are quite attractive looking, and I think that depends a lot on window decorations and just that overlapping windows is nicer looking.
[09:35:24] <seanh_> Even if you set Apple's design team on it, I'm not sure they could make a tiling WM look nice, except by redesigning the UIs of all the apps to look nice with tiling I guess
[09:35:54] <nigelb> Yeah, tiling WMs and the word "pretty" don't go together.
[09:36:13] <nigelb> I still haven't figured out how to close skype profiles if I open one up.
[09:47:41] <seanh_> If someone makea a gorgeous-looking tiling window manager, they'll take over the world. It's going to be the next big thing!
[09:57:36] <seanh_> But how are you going to use transparency in a tiling wm? There's nothing behind anything else! Fatal flaw. We'll have to introduce some transparent menus and notifications
[10:01:59] <seanh_> Ew, if you change dwm's window layout mode on one desktop, it changes it for all of them at once ... This may be a problem

2014-08-01
[16:02:47] <seanh_> God, ubuntu unity is breaking every five seconds for me, not responding to mouse clicks or scrollwheels
[16:02:54] <seanh_> Anyone else having this?
[16:03:06] <seanh_> I'm gonna have to change window managers just to get some work done

[08:24:40] <rossjones> seanh_ mostly in templates, and serving the files from nginx.
[08:32:23] <seanh_> I've just used template-overriding to insert the tags, and fetching the files from jquery's cdn so far
[08:33:07] <rossjones> When the workaround is dramatically less effort than the 'standard' approach, I think there's probably something very wrong.
[08:34:12] <seanh_> Yep. I'm not sure how much fanstatic itself is to blame, and how much it's the way it's been integrated into CKAN
[08:34:42] <seanh_> But it was all done to reduce page-load times I believe, seems to have added a lot of difficulty in the process
[08:35:31] <seanh_> I wouldn't mind a more indirect process for serving static files so much if it were properly documented and it worked, but I spent half a day failing to get one js lib to work that took two minutes to do without fanstatic
[08:41:48] <nigelb> If we can fix it in a way that static files are served by the webserver and wsgi, I'll be *very* happy :)
[08:41:53] <rossjones> I think a few are unhappy with serving content through wsgi as well, I think removing it will be a complete nightmare though
[08:41:56] <nigelb> *webserver and *not*
[08:46:31] <nickstenn> rossjones, nigelb, seanh_: there's just no reason at all that assets should be served through wsgi. the "page load times" argument is solved by almost everyone else by precompiling assets
[08:47:52] <seanh_> Right, the whole point of bringing in fanstatic (as I recall) was that it could minify and bundle CS and JSS files, and also track dependencies so we could easily have each page load all the files it needs and only those files. If we could get the same benefits in a less invasive way that would be great
[08:48:08] <nickstenn> serving file content is also not a fabulous idea, although I imagine there are authorisation issues, in which case it would probably be a case of setting up X-Accel-Redirect and friends (http://wiki.nginx.org/X-accel)
[08:48:11] <seanh_> Fanstatic also supports running compilers for less or whatever though I'm not even sure we use those features
[08:48:41] <nickstenn> seanh_: absolutely, but those should all run out of band and create files on disk that can be served by a conventional webserver
[08:48:56] <nickstenn> this is how rails does it, how django does it, and how basically every sane asset pipeline anywhere does it
[08:49:12] <rossjones> nickstenn problem now is how to fix it, if people are writing extensions that make use of it :(
[08:49:28] <nickstenn> s/how django does it/how many django extensions do it/
[08:49:48] <nickstenn> rossjones: presumably you could keep one single fanstatic tag for extensions, and deprecate it?
[08:50:27] <rossjones> I guess so, but deprecating doesn't really mean anything in ckan, or rather it just means "we don't use this anymore".
[08:50:34] <rossjones> Doesn't mean it'll ever get removed.
[08:50:41] <nickstenn> ARGH
[08:50:44] <rossjones> Or that ppl will stop using it (see Genshi)
[08:50:59] <nickstenn> WELL LET'S FIX THAT THEN
[08:51:10] <nickstenn> (frustration not directed at you)
[08:51:18] <rossjones> It's my one biggest concern about moving to gunicorn is wasting workers on fileserving.
[08:51:43] <nickstenn> rossjones: I don't think it'll be any more of an issue than with apache with an evented worker
[08:51:58] <nickstenn> with sync workers it would be a very bad idea, yes
[08:52:10] <rossjones> nickstenn probably right.
[08:52:39] <rossjones> There should be a list from core team "Things I would remove, break, refactor if I had time".  I guess that's the idea of http://github.com/ckan/ideas-and-roadmap/
[08:53:00] <nickstenn> rossjones: so there's no systematic deprecation tagging and warning setup in CKAN at the moment?
[08:53:12] <rossjones> I think some things give warnings.
[08:54:19] <rossjones> DGU still uses Genshi, so I suspect they'll have a LOT of work to remove that, for no immediate gain (for them). Apart from jinja being faster and cleaner.
[08:55:44] <nickstenn> at some point, someone decided that the trade-off between up-front effort removing genshi and efficiency gains from removing it were worthwhile
[08:55:49] <nigelb> nickstenn: the biggest argument for fanstatic right now is extensions
[08:56:01] <nigelb> it deals with getting the static files from extensions and doing the right thing.
[08:56:03] <nickstenn> either a) that is still true or b) it is not
[08:56:12] <nigelb> the minimization and other stuff can be easily fixed.
[08:56:27] <nickstenn> we can't expect to get anywhere by having an existential crisis halfway through about whether the DGU team will ever upgrade
[08:56:55] <nickstenn> if they need to write a CKAN extension to support their legacy templates, then let them
[08:56:57] <nigelb> I see your comment about django extensions
[08:56:58] * nigelb looks
[08:57:04] <nickstenn> nigelb: have a look at foundation
[08:57:19] <nickstenn> nigelb: http://django-compressor.readthedocs.org/
[08:58:03] <nickstenn> anyway, the core team's responsibility is to improve CKAN as a product
[08:58:39] <nickstenn> there is a place for concerns around upgrade path and backwards compatibility, but if those concerns are sucking most of the forwards momentum out of product development, they need to be relaxed
[08:59:00] <nickstenn> </rant>
[09:00:45] <nigelb> django things are great for django.
[09:00:54] <nigelb> I'm looking for something that works outside of django as well.
[09:01:06] <rossjones> good rant
[09:01:57] <rossjones> nigelb There are other non-python, non-integrated solutions to the problem.
[09:02:21] <nigelb> http://webassets.readthedocs.org/en/latest/generic/index.html
[09:02:26] <nigelb> seems like a good place to start
[09:18:09] <seanh_> nickstenn: rossjones There is actually a proper deprecation policy, there's an @deprecated decorator that prints out a warning, and the release notes for every release have a deprecations section, there's something in the contrib guide about it
[09:19:08] <seanh_> We have generally been very conservative about not breaking things for clients, true. I think it's partially a backlash against the 1.* days when every CKAN release broke very site and extension in all sorts of ways.
[09:19:37] <nigelb> I'm okay with breaking things if we write a proper upgrade guide and warn the list in advance.
[09:20:10] <seanh_> Things like having a stabler API for extensions with a deprecation policy (and that includes things like plugin interfaces, template helper functions .. not just the actual API) have been good I think (also for our own sanity, we maintain a bunch of CKAN extensions)
[09:20:29] <seanh_> But I'm generally ok with breaking things in order to remove total crap from CKAN, Genshi would be an example
[09:22:01] <nickstenn> seanh_: Right, but it's important to remember that a responsible change policy is one that has strict guidelines about *when* you can change things in a way that breaks other people's code (i.e. only on major versions). It's important that we don't take that to some kind of bizarre extreme that says it's *never* ok to break others' code.
[09:26:11] <seanh_> Only on major versions - this is clearly documented
[09:27:07] <seanh_> There's still a case-by-case discussion to be had on specific things like we want to remove Fanstatic or Genshi, there's still a trade-off between simplifying/improving CKAN versus breakage that has to be an ongoing discussion
[09:27:16] <seanh_> I'm more on the pro breakage side
[09:27:30] <nickstenn> yay :)
[09:32:25] <seanh_> More specifically, there are certain things in CKAN that are "good", that have been designed and implemented fairly well and are well-documented, and I wouldn't want to break those without good reason. The API, plugin interfaces and toolkit, template helper functions, etc etc. Basically anything that' s well documented on docs.ckan.org
[09:33:07] <seanh_> Other things in CKAN suck, including Fanstatic (the docs on how to use CKAN's Fanstatic integration are not very good), Genshi is essentially a hidden feature, the templates and their blocks are very complex and not documented ...
[09:34:03] <nigelb> *cough* revisions
[09:34:04] <seanh_> Technically extensions and themes may be relying on these things, but they're things that were just hacked in to CKAN because we needed them at the time without a lot of thought. I'd break them in order to get them to something good that's actually documented and designed to be built on.
[09:55:19] <rossjones> so things to go are fanstatic, genshi, revision, resource_groups, using solr as a database ... anything else?
[09:56:26] <nigelb> datapusher
[09:56:44] <nigelb> (I'm... not a fan of how it's done)
[10:00:22] <rossjones> ah the queuey thing.
[10:02:02] <amln> there are only 89 email addresses on ckan-announce
[10:03:20] <rossjones> amln how many on ckan-dev?
[10:03:57] <nigelb> ckan-announce is for people who don't want the noise on ckan-dev
[10:04:03] <nigelb> I'm not sad about that few.
[10:10:14] <amln> rossjones: 413 on ckan-dev
[10:10:34] <amln> you'd think you might want to filter annoucements
[10:11:01] <amln> don't most people sieve/procmail announce lists differently?
[10:11:20] <amln> (or whatever the gmail equiv is)
[10:38:03] <amln> is anyone aware of ckan instances with two frontends?
[10:39:50] <amercader> why can people post to ckan-announce? I though only the core team could do it
[10:40:43] <amercader> oh, and I'm and admin and need to approve my own post? mmm
[10:43:51] <amln> amercader: people could post. i changed it so everyone is held.
[10:44:08] <amln> remember, if i spoof your from:/sender: line in a list mail, i can post as you.
[10:44:18] <amln> and it will just get through.
[10:44:49] <amln> MM3 has some improvements in this area.
[10:45:03] <amercader> amln: but it will need to be approved anyway right?
[10:45:12] <amln> now, yes ;)
[10:45:35] <amln> also saves the issue of sending an offlist reply to the list
[10:46:11] <amln> s/saves/sometimes protects from/
[10:57:22] <seanh_> rossjones: I imagine there's a few more things like that to go as well :)
[10:57:33] <seanh_> But yes
[10:57:54] <seanh_> I'm not sure about using solr as a database - isn't that done because it's so much faster?
[11:00:55] <maxious> speaking of ckan contracts with specific technology requirements, I fixed some stuff in ckanext-drupal7 https://github.com/okfn/ckanext-drupal7/pull/1
[11:02:12] <rossjones> seanh_ yes, don't get me wrong, I am grateful it got us all past the perf hump, but maybe it'd be unnecessary if the db model was simpler.
[11:02:39] <rossjones> maxious is someone *making* you use Drupal? That's not nice :(
[11:04:03] <maxious> at least it's not wordpress :P
[11:33:20] <amercader> maxious: that's great! tbh you are probably the current world expert in ckanext-drupal7, do you want us to give you admin rights so you can mantain it? I fear that otherwise your PR will get ignored
[11:35:26] <maxious> amercader: that would be great :)
[11:41:38] <amercader> maxious: can you check I didn't mess up? I also moved the repo to the ckan org btw
[11:41:39] <amercader> https://github.com/ckan/ckanext-drupal7
[11:42:11] <amercader> redirects should be in place
[11:42:42] <maxious> looks good
[11:43:15] <amercader> maxious: awesome, thanks for helping take care of it
[11:44:43] <maxious> no problem, should get a chance to do some more work on it soon.
[12:49:06] <wardi> ooh that sounds interesting
[12:58:14] <wardi> fanstatic is a nightmare, fanstatic_resources.py is a horror-show
[13:01:23] * amln stills reads fanstatic as fantastic
[13:02:23] <wardi> nigelb: fanstatic does the wrong thing. all static file paths are merged with the root application paths
[13:05:43] <seanh_> maxious: I didn't even know ckanext-drupal existed! Great to see someone maintaining it, ckan-drupal integration is something we get asked for a lot (e.g. when delivering ckan trainings). Also ckan-wordpress integration. It's also the whole reason why dkan exists as far as I can tell, but instead of just integrating ckan and drupal they're reimplementing ckan in drupal
[13:25:40] <wardi> rossjones: yes, i've used the ideas repo for this sort of thing, along with the 'technical debt' (brown) tag
[13:28:08] <rossjones> good choice of colour :)

2014-07-31
[12:40:45] <nickstenn> $CKAN_HOME is the virtualenv
[12:40:53] <nickstenn> so gunicorn is installed into the virtualenv
[12:41:06] <amercader> ok, sorry, I though it was the ckan source
[13:17:01] <seanh_> There probably isn't any good reason why we use apache and nginx, but for what it's worth I once heard an explanation of it that had something to do with nginx being multithreaded and apache being multiprocess (or was it the other way round) and the two things complementing each other nicely in some specific way that I can't recall ... Don't ask me to explain or defend that though
[13:17:25] <nickstenn> seanh_: I won't ask you to explain or defend that, but it sounds like a whole lot of bullshit to me.
[13:18:12] <seanh_> Quite possibly. I'm *really* curious to know what the reason was now but I fear we may never know. Anyway if people want to change it I'm not objecting
[13:18:42] <nickstenn> seanh_: I think the numbers in the spreadsheet speak for themselves -- mod_wsgi is not a good wsgi application server
[13:19:34] <rossjones> +1 on removing apache entirely from the stack.  One less thing for people to configure as you can come up with a reasonable gunicorn setup that doesn't need much changing
[13:20:10] <nickstenn> rossjones: it would be good to have your views recorded on the pull request :)
[13:34:19] <rossjones> done
[13:34:39] <rossjones> gunicorn isn't the fastest, but it's very predictable.
[13:37:11] <amln> rossjones: the most recent tender i can think of with a technical reqs doc was GLA's datastore. that was largely to avoid deployment of obsolete / (approaching) End of Life software, though
[13:45:41] <rossjones> amln Tom and I won that contract, and I don't recall mention of Apache ;)
[13:47:29] <amercader> rossjones: I think amln meant that there was a tech requirements doc, not that it required apache
[13:48:01] <amercader> :w
[14:00:54] <rossjones> Ah, didn't see it :)
[14:54:50] <amln> rossjones: wot amercader said.
[15:01:27] <rossjones> Meh, documentation.
[15:03:08] <rossjones> Switching to gunicorn will reduce some level of pain, but won't stop those who like apache can still use it - just not the default setup.
[15:25:01] <joet> that's why the instructions should still be there
[15:37:39] <rossjones> joet maybe as an appendix or something.
[16:36:44] * seanh_ Still trying to get one line of jqueryui code to execute in ckan
[16:37:25] <seanh_> I've got fanstatic loading my js module now, and the jqueryui and jquery files it depends on
[16:37:37] <seanh_> But it's just not executing my module's initialize()
[16:43:47] <rossjones> seanh_ I feel your pain.  I just don't bother anymore and keep JS and CSS separate
[16:47:28] <seanh_> rossjones: So how are you inserting your css and js into your ckan pages? Just overriding the head and foot templates?
[16:49:01] <seanh_> I just can't get it to work. I can see the jqueryui js files being loaded in the dev tools now, and it's executing my module, but jqueryui's functions just aren't there
[16:59:03] <seanh_> Hmm, getting it working without fanstatic didn't even take 5 minutes :(
[17:00:17] <seanh_> I think I'm done with using fanstatic in CKAN extensions, ever. I'm just putting <link> and <script> tags in templates
[17:04:59] <seanh_> The only problem with using the styles and scripts blocks from base.html is that it seems you can only override them from base.html, not from other templates. So whatever scripts and styles you add will be added to every page not just where you need them
[17:05:13] <seanh_> There's probably some way around that with a jinja if statement or something
[17:05:40] <seanh_> But I'd rather load jqueryui unnecessarily on every page than pull my hair out at fanstatic for daus

[09:22:24] <seanh_> nigelb: Problem seems to be just that jquery ui is in vendor, but isn't included in ckan pages by default, so I need to figure out how to include it, presumably using fanstatic, I'm looking at this fanstatic resource config file at the moment
[09:23:07] <nigelb> seanh_: I've pinged you the code on skype.
[09:38:31] <seanh_> nigelb: Hmm, I'm not sure that ckan actually includes the jquery ui widgets, now that I look at it.
[09:39:18] <seanh_> I see jquery.ui.core.js and mouse.js, widget.js, sortable.js, but I think there should be separate js files for all the different widgets
[09:40:03] <seanh_> So have to put them in my extension I guess
[09:40:11] <nigelb> seanh_: this is why I used a different bundle on my extension
[09:40:15] <nigelb> (now I remember!)
[09:40:20] <seanh_> Yeah
[09:40:52] <seanh_> When I get this working, I may add an "Including JavaScript libraries with Fanstatic" page, fanstatic really adds a lot of complexity
[09:41:11] <nigelb> seanh_: I'll addd that in this case, you can pretty much copy what I did :)
[09:41:18] <nigelb> I solved the same problem.
[09:42:37] <seanh_> But you seem to have included your own jquery.js and jqueryui.js?
[09:44:21] <seanh_> I think jquery is in all ckan pages by default anyway, and you should be able to just include the jquery.ui.datepicker.js from jquery ui (for example) and tell fanstatic that it depends on the jquery-ui.js from ckan core, but I don't know exactly how to tell fanstatic that
[09:44:37] <seanh_> It might be easier for an extension to just include its own complete jquery ui, I suppose
[09:55:47] <nigelb> seanh_: version differences
[09:56:10] <nigelb> the ckan core jquery version was too old for the version of jquery ui I wanted.
[09:56:17] <seanh_> Right
[09:58:12] <seanh_> Doesn't including your own jquery clash with the jquery that ckan puts into every page though?
[09:58:48] <nigelb> Didn't seem to on that page at least.
[09:59:02] <seanh_> Heh
[09:59:05] <nigelb> :)
[09:59:11] <nigelb> There's a way to work around that.
[09:59:41] <seanh_> I wonder if it overrides the one CKAN is using? Or maybe jquery UI's jquery is namespaced? I guess jquery's api is pretty stable, so you would probably get away with overriding it
[10:00:03] <nigelb> jquery doesn't usually break backward compatibility
[10:00:08] <nigelb> we should think about upgrading anyway.
[10:03:53] <seanh_> Most of what the fanstatic docs say doesn't really apply to ckan, we need our own docs for how we use it
[10:11:02] <seanh_> The main difference seems to be that if you're writing a CKAN extension you're not going to be calling fanstatic via Python (which is what the fanstatic docs document), you're just overriding CKAN's templates so you have to do all the fanstatic stuff via the {% resource %} tag, toolkit.add_resource(), and the resources.config file. I can't find these resource.config files in the fanstatic docs at all
[10:11:11] <seanh_> Are they a CKAN thing?
[10:18:41] <nigelb> seanh_: nope
[10:18:44] <nigelb> they're a fanstatic thing.
[10:18:54] <seanh_> No, I think they are a CKAN thing: https://github.com/ckan/ckan/blob/master/ckan/lib/fanstatic_resources.py#L119
[10:18:58] * seanh_ recoils in horrot
[10:19:05] <seanh_> horror
[10:19:35] <seanh_> There's no concept of a resource.config file in Fanstatic, is there? I couldn't find anything about it
[10:20:12] <nigelb> oh god
[10:20:18] <nigelb> I thought they were a fanstatic thing
[10:20:32] <seanh_> In Fanstatic you use Python code to create Library, Resource and Group objects, and they have attributes for specifying all the dependencies, minification etc etc etc
[10:20:54] <nigelb> Right, we "simplified" it.
[10:21:00] <nigelb> this is where I'm scared about us.
[10:21:00] <seanh_> It looks like we have invented a (very lightly documented) way of specifying the whole lot in a config file instead
[10:21:16] <nigelb> we "simplify" things. but that makes them sometimes hard to upgrade.
[10:21:22] <seanh_> Just have the plugin's plugin.py file call fanstatic
[10:22:00] <seanh_> Well, we build things into CKAN in such a way that all sorts of parts of CKAN and extensions are tightly coupled to them
[10:22:02] <seanh_> e.g. solr
[10:22:06] <seanh_> or fanstatic
[10:23:02] <seanh_> Decoupling CKAN from Pylons so we can move to a modern and supported web framework is a challenge, but how about decoupling CKAN from Fanstatic at this point? Basically impossible without breaking all frontend things I'd guess
[10:23:46] <seanh_> I mean, CKAN's toolkit.add_resource(), {% resource %} and resource.config file don't decouple CKAN extensions from Fanstatic in any way that I can see, they're just an alternative way of exposing Fanstatic to plugins
[10:24:10] <seanh_> Which makes me wonder what the point of them is
[10:24:41] <seanh_> Unless you wanted to develop themes without having to write any Python code ... But honestly, just make them write a little bit of Python to define their libraries
[10:25:15] <seanh_> Anyway, I'm glad I got to the bottom of this and learned one more thing about CKAN. I always assumed resource.config was a Fanstatic thing as well. nigelb - you're documenting this, right? ;)
[10:29:06] <seanh_> I'm gonna miss the dev meeting today..
[10:41:51] <nigelb> seanh_: Yeay, file it. I'll pick it up :)
[10:42:10] <nigelb> seanh_: I like the idea of decoupling from fanstatic.
[10:42:23] <nigelb> I want a way to serve css/js without the python app.
[11:01:22] <nigelb> meeting!
[11:03:57] <joet> http://bit.ly/ckandevmeeting
[11:05:06] <nigelb> joet: lots of background noise for me, so I may not talk
[11:11:23] <amercader> http://demo.ckan.org/dataset/test111113333@d61aad2f-6614-49c1-90af-6bacdec764c7
[11:22:15] <nigelb> ^ that is a hidden feature!
[11:22:17] <nigelb> :)
[11:22:44] <amercader> nigelb: hidden and old, I don't know how reliable is
[11:22:51] <amln> hidden? it's there in the source code
[11:22:56] <nigelb> hahahahahahah
[11:23:02] <amln> (RTFSC is *not* a suitable answer, these days)
[11:23:11] <nigelb> ckan source code is not very readable. even for me.
[12:19:07] <nickstenn> wardi, rossjones, amercader: any thoughts on https://github.com/ckan/ckan/pull/1861?
[12:24:59] <amercader> nickstenn: I'm swamped in client work now but I'll try to add my thoughts later today.
[12:25:35] <amercader> they basically are: nice, but we'll need to keep supporting apache even if we don't use it on the source or package installs as it's what lots of orgs want
[12:26:02] <nickstenn> amercader: really?
[12:26:13] <nickstenn> i find this really weird
[12:26:44] <nickstenn> if a client said they wanted CKAN to use sqlobject and not sqlalchemy, would you care?
[12:27:08] <nickstenn> s/care/pay any attention/
[12:28:12] <wardi> nickstenn: the spreadsheet has some interesting numbers
[12:28:47] <wardi> it's surprising to me that apache has such an impact
[12:29:13] <amercader> I don't think these two things are comparable but anyway, all I'm saying is that on my experience IT departments are more comfortable with what they know about (eg apache and not something that sounds like unicorns)
[12:29:30] <wardi> it does seem silly to recomment nginx and apache, certainly
[12:29:32] <amercader> Note that I'm not saying we shouldn't use gunicorn by default, only to keepo docs for apache
[12:29:47] <nickstenn> amercader: sure, but we already use nginx as a web server, not apache
[12:30:01] <nickstenn> we're effectively abusing apache and using it as an application server
[12:30:42] <nickstenn> by which i mean we're not really using much of apache that people know and love
[12:30:56] <amercader> many deployments serve companion drupals, wordpress etc. In this scenario it might make  sense to serve them under apache
[12:30:56] <nickstenn> we're using it as a piece of code that can run mod_wsgi
[12:31:06] <nickstenn> amercader: absolutely
[12:31:11] <nickstenn> and they can do whatever they want
[12:31:22] <nickstenn> I've seen CKAN instances deployed under Tomcat
[12:31:26] <nickstenn> doesn't mean we need to support
[12:31:29] <nickstenn> *support it
[12:31:33] <nickstenn> (or recommend it)
[12:32:35] <amercader> nickstenn: only for historical reasons, ie to support all existing ckan instances I think we need to document how to run it under apache (which baiscally is adding the contents of 2 conf files to the docs)
[12:33:38] <nickstenn> amercader: sure, agreed
[12:33:40] <wardi> it would make sense to have instructons for (nginx|apache)+gunicorn
[12:33:50] <nickstenn> wardi: +1
[12:33:55] <amercader> exactly
[12:34:14] <nickstenn> amercader: although I will say that given our resources, "support[ing] all existing ckan instances" is probably not something we should be attempting to do
[12:34:39] <nickstenn> or, to be more precise, there is an efficiency-thoroughness tradeoff to be made here
[12:34:49] <amercader> "support[ing] all existing ckan instances" means that users can go to docs.ckan.org and know how to configure ckan under apache
[12:34:53] <amercader> nothing else
[12:35:04] <nickstenn> ok, in which case I'm not disagreeing with you
[12:35:05] <nickstenn> :)
[12:35:36] <nickstenn> honestly, I just want to get rid of an install recommendation which includes both nginx and apache
[12:35:44] <nickstenn> it's just... embarrassing
[12:36:24] <nickstenn> if I didn't know the history behind that recommendation, I think I'd conclude that we didn't know what we were doing or how web technology was supposed to work...
[12:36:34] <amercader> we should use uwsgi though
[12:36:37] <amercader> :p
[12:37:18] <wardi> nickstenn: those conclusions might be fair :-)
[12:37:51] <nickstenn> amercader: PRs welcome, right? ;)
[12:38:12] <amercader> just kidding
[12:38:28] <amercader> nickstenn: looking at your PR how do you tell gunicorn about ckan?
[12:38:37] <amercader> what's unix:/var/run/gunicorn-ckan.sock
[12:38:56] <nickstenn> first question: https://github.com/nickstenning/ckan/blob/d7d0aa15dd30cfbc7cea3567bd1ed9001a3f8673/contrib/docker/svc/ckan/run#L14
[12:39:11] <nickstenn> second question: a unix domain socket on which gunicorn accepts connections
[12:39:16] <nickstenn> it's how nginx talks to gunicorn
[12:39:21] <amercader> got you
[12:39:48] <nickstenn> it could equally be a tcp socket, but unix sockets have no TCP overhead and there's no risk of exposing a port accidentally to the outside world
[12:40:12] <wardi> and you can pass fds over them
[12:40:18] <amercader> nickstenn: but where is "$CKAN_HOME"/bin/gunicorn
[12:40:21] <amercader> ?

2014-07-30
[09:57:32] <davidmiller> Morning CKAN!
[09:58:25] <davidmiller> Can anyone tell me *why* usernames are restricted to /[a-z0-9_\-]*$/ ?
[10:01:04] <amercader> davidmiller: to make them url friendly I guess. You get the /user/user_name page
[10:06:06] <davidmiller> amercader: That's what I figured.
[10:07:23] <amln> davidmiller: do you have a user case where variance would be useful?
[10:08:43] <davidmiller> I have a user case for wanting /[a-zA-Z0-9_\-.]*$/
[10:09:24] <davidmiller> I'm wondering e.g. : Are there places that lowercase the name before doing a database lookup?
[10:11:29] <davidmiller> Related: The error message for attempting to register with an invalid name is fairly terrible :(
[10:12:19] <davidmiller> "Name: Url must be..." is confusing to me at lest :)
[10:16:08] <amercader> davidmiller: it's horrible indeed
[10:19:52] <davidmiller> amercader: Were you around for https://github.com/ckan/ckan/commit/6a277ecef155fcf171b7adff2396faae17dea206#diff-8525268a0dc8fbd61bf4f7c4cda26389L96 ?
[10:20:45] <davidmiller> I can't figure out how to discover "What is the user need that was driving this commit" ...
[10:23:50] <amercader> davidmiller: I was around but I can't remember any logic behind this, probably because it hasn't any
[10:24:01] <amercader> I'll be happy to merge a PR changing this
[10:25:16] <davidmiller> amercader: Awesome sauce :)
[10:26:31] <davidmiller> Is there a scheduled date for the next CKAN release?
[10:26:39] <davidmiller> Does it have a feature freeze date set as well ?
[10:29:32] <amercader> Not yet I'm afraid. The main thing that needs to be finished/stabilized is resource views (#1851). Once this is finished I think we can start freezing and branching off. As for when the work on views will be finished depends on resources (time/money/hands)
[10:31:43] <davidmiller> Ah -  so release schedule is feature based rather than calendar based ?
[10:33:21] <amercader> davidmiller: right now yes. Hopefully when the CKAN Association is up and running it can pool resources to fund this kind of core work and we can make more regular releases
[10:39:30] <davidmiller> I see.
[10:39:43] <davidmiller> Is anyone funding the resource views stuff?
[10:40:02] <davidmiller> (It's v. cool - I totally want the featureset :)
[10:43:11] <amercader> I don;t thin the remaining of the work is completely funded, but I'm not the best person to ask. That would be shevski
[11:13:44] <davidmiller> amercader: Could we sneak it into the patch release for 2.2?
[11:24:58] <amercader> davidmiller: resource views or the user name error?
[11:25:52] <amercader> resource views obviously not, and the user name error I'm afraid that can't got either as it changes an existing translated string. This will break existing translations
[11:28:26] <rossjones> davidmiller you could maintain a monkey_patches.py like me :)
[11:28:59] <amercader> rossjones, davidmiller or on this case just update the local translation file
[11:29:26] <rossjones> ah just the message, not the validator
[15:36:31] <Alex______> Hi everyone. I am using CKAN for the first time and have some problem that i would like to analyse through the logs. I cannot find any reference to a logfile and looking at my CKAN's config file , the log handler is set to console... can you give me any clue on how i could manage the logs the best? Thanks in advance
[16:45:32] <denisz> Alex______ are you running the dev server (paster serve) to run CKAN or apache/nginx? If you're using paster, most of the logging you need will be output to standard out. If you're using apache, the ckan logs should be in something like /var/log/apache2/ckan
[16:49:02] <Alex______> hi Denisz. I am running on apache/nginx. Thanks for the help, i found thm!

2014-07-29
[16:25:25] <amercader> gd
[16:26:47] <rossjones> Ooh. Views.
[16:26:57] <rossjones> The View view button is a bit, erm, yeah.
[16:27:25] <seanh_> I'm doing a custom schema for a client now, I'm just gonna remove the "You can use markdown here"
[16:29:37] <amln> +1 about normal people and how they do things.
[16:30:39] <amln> rossjones: if you're implementing one of the WYSIWYG editors, i'd be interested to see it as an extension
[16:32:01] <rossjones> amln in theory it should only be a new entry in templates/macros/form.html - not sure it warrants a full-on extension :(
[16:32:13] <seanh_> I can sort of understand the reasoning behind the 3-stage: Let them get to uploading their files quicker, without hitting them with *every* dataset field first. But it confuses things and adds a lot of complexity (e.g. draft datasets)
[16:33:58] <amln> ah yes, with those things, it makes sense (imo) to checkout a tag/commit as a submodule -- makes upgrading the JS a lot easier.
[16:34:20] <amln> i'm too much of a spaz to type WYSIWYG.
[16:34:30] <rossjones> Tend not to use the core JS the way it's built - I'm not a big fan on fanstatic.
[16:34:35] <rossjones> :(
[16:40:07] <seanh_> The not_missing and not_empty validators don't do what I expected: They change the value of my field to "None", whether I type something into it or not! Intuitive

[10:54:03] <nigelb> https://pad.okfn.org/p/ckan-meeting
[10:54:12] <nigelb> https://plus.google.com/hangouts/_/event/cb1vmkss426lkqicj94a3amvd1c?authuser=0&hl=en-GB
[11:02:59] <nigelb> amercader: meeting?
[11:25:07] <nigelb> https://github.com/ckan/datapusher/pulls
[11:53:18] <amercader> nigelb, seanh_ , joet: really sorry, I couldn't make the dev meeting, had a very badly timed baby situation
[11:53:26] <amercader> let me know if I was needed for anything
[11:53:27] <nigelb> no worries
[11:53:30] <nigelb> we didn't do much
[11:53:38] <nigelb> there were not many new issues or pull requests?
[11:53:51] <amercader> everyone is n holiday I guess
[11:55:30] <nigelb> amercader: sean was going to review your requests pull req, might want to talk to him in case you have concerns
[11:55:50] <amercader> cool
[11:55:51] <nigelb> other than that, the big thing was potentially merging in changes from dgu for ckanext-archiver/qa/googleanalytics.
[11:56:04] <amercader> that would be awesome
[11:56:27] <nigelb> that's what we thought as well.
[12:00:25] <amercader> joet: can you prioritize https://github.com/ckan/ckan/pull/1436 when you have a moment? should be really straight-forward
[12:00:45] <amercader> joet: also see comment on https://github.com/ckan/ckan/pull/1701
[12:01:29] <joet> amercader, sure thing
[12:17:38] <rossjones> eek just got an exception from datastore_delete - DROP TABLE "99d2a476-d86d-44c8-8782-38dbfa3c924f" and it showed me the code that is used for deleting. I'm not 100% using .format() for sql statements is wise.
[12:18:55] <dragondave> rossjones: pretty sure there isn't a way of substituting table names in SQL safely. :(
[12:19:19] <dragondave> You can only hope that users can never touch that string...
[12:20:14] <dragondave> (specifically, whilst INSERT INTO table VALUES (?, ?, ?) works, INSERT INTO ? VALUES (1, 2, 3) doesn't)
[12:21:28] <rossjones> dragondave it comes out of the data_dict  - https://github.com/ckan/ckan/blob/master/ckanext/datastore/db.py#L1104
[12:23:47] <joet> that's called by datastore_delete, which runs it through  a schema that checks whether the resource actually exists. I do agree though it makes me queezy, but dragondave is correct
[12:24:28] <rossjones> it obv didn't go through schema for me :(
[12:24:45] <rossjones> I wonder if it is because of a previous failure
[12:24:56] <dragondave> rossjones: race condition?
[12:25:35] * rossjones shrugs
[12:25:37] <rossjones> doubt it.
[12:25:41] <dragondave> "DROP TABLE IF EXISTS" might prevent the error, but still doesn't help vs. evil users.
[12:26:05] <rossjones> I don't really want to spend a lot of time looking. I might just turn it off for a bit.
[12:51:33] <joet> as we have the sqlalchemy engine, we could probably do something along the lines of sqlalchemy.Table(resouce_id, autoload=True).drop()
[13:28:13] <travis-ci> [travis-ci] ckan/ckan master 06e3e97 http://travis-ci.org/ckan/ckan/builds/31136942 joetsoi: The build has errored.
[13:33:34] <subway_> hello guys. just wondering, does the DataStore API require authentication for actions that modify the underlying data?
[13:35:22] <subway_> well i suppose yes, in the logic/actions.py, p.toolkit.check_access('datastore_create', context, data_dict) is present
[13:35:35] <subway_> but it kinda shocked me when the datastore API page didnt explictly say it. heh
[13:36:12] <amercader> subway_: yes, you need to be logged in (or provide an API key) for a user that can edit the parent dataset(or a sysadmin)
[13:36:28] <subway_> awesome. thanks!
[15:29:46] <seanh_> Anyone know where the form-generating stuff for ckan templates is defined? form.input(), form.markdown() etc in Jinja templates
[15:34:07] <seanh_> Ah, templates/macros/form.html, looks like
[15:34:25] <rossjones> seanh_ templates/macros/form.html
[15:34:26] <rossjones> ah
[15:34:31] <rossjones> beat me to it.
[15:37:43] <seanh_> cheers
[15:38:56] <seanh_> Hmm, actually they're not that useful
[15:39:08] <seanh_> The markdown one doesn't let you change the help text, for example
[15:41:20] <rossjones> we may well be replacing that with a wysiwyg editor instead :( Nobody gets markdown.
[15:41:44] <rossjones> In fact nobody knows what a Resource is either :(
[15:42:04] <rossjones> where nobody is a member of the set of normal people.
[15:58:03] <amln> from what i remember the two decent JS WYSIWYG editors let one use html/markdown as well.
[15:58:19] <amln> by two decent, I can't remember which they are,
[15:58:23] <rossjones> ah
[15:58:24] <rossjones> :(
[15:58:28] <rossjones> Will find out I guess :)
[15:59:02] <amln> i can look at a repo...
[16:00:28] <amln> CKEditor was what I used in $LASTPROJECT (http://ckeditor.com/)
[16:03:22] <seanh_> rossjones: Yeah markdown is geeky, and "resource" has always been a terrible name, what wrong with "file"?
[16:04:11] <rossjones> seanh_ yeah, makes more sense.
[16:04:17] <rossjones> ckeditor looks nice
[16:10:33] <amln> rossjones: it doesn't suck too much
[16:12:00] <rossjones> that's all we can hope for :)
[16:18:54] <seanh_> If your target group for CKAN is "data geeks" who're downloading CSV files and hacking on them with Python scripts, then markdown makes sense
[16:19:14] <rossjones> data geeks will be downloading, they won't be publishing.
[16:19:18] <seanh_> If it's government employees uploading excel files as easily as possible, markdown probably doesn't make sense
[16:19:24] <rossjones> most people who publish are not data geeks.
[16:19:26] <seanh_> Yeah
[16:19:48] <seanh_> I guess they are data geeks on the DataHub, which is where the markdown came from probably
[16:19:50] <rossjones> or even techies.
[16:20:03] <seanh_> But you're probably right for most ckan sites though
[16:20:09] <rossjones> Youd be surprised how even the 3 stage create can confuse them.
[16:20:37] <rossjones> Or maybe not :)
[16:21:07] <seanh_> The three-stage *is* confusing though, quite poor design in my opinion
[16:21:50] <rossjones> Think we're going to rework all of it. not least because GLA have added about 20 more items to the schema 8|
[16:21:50] <seanh_> It's a two level data model (dataset contains one or more resources) but a three-stage process. First stage: create the dataset, second stage: create one or more resources, third stage: add some more fields to the dataset?
[16:22:09] <rossjones> I think it is the switch from metadata-data-metadata that catches them out.
[16:22:28] <seanh_> That's just wrong and it's not clear to people which object they're editing at  each stage. Basically the third stage should be chopped off imho (which we did for the datapackager)
[16:22:39] <rossjones> Maybe title+desc+file uploads and then a second stage with metadata.
[16:23:00] <amercader> rossjones, seanh_ : current master (ie 2.3) has a 2 stage process: metadata + data
[16:23:05] <seanh_> rossjones: wardi has a two-stage dataset creation PR for core in progress, I think
[16:23:10] <amercader> check it on master.ckan.org
[16:23:10] <rossjones> Then we can just have "Save", "Save draft", "Cancel"
[16:23:20] <seanh_> amercader: Oh really? Great
[16:23:22] <rossjones> oooh
[16:23:59] <seanh_> The CSS is broken though
[16:24:19] <amercader> yeah, someone must forgot to rebuild it
[16:24:41] <seanh_> Ah, ok
[16:24:50] <seanh_> That's great though, big improvement imo

2014-07-28
[19:14:01] <travis-ci> [travis-ci] ckan/ckan release-v2.2.1 ebd7a05 http://travis-ci.org/ckan/ckan/builds/31071000 amercader: The build was broken.

[05:27:24] <travis-ci> [travis-ci] ckan/ckan master 5efd71f http://travis-ci.org/ckan/ckan/builds/31011988 Nigel Babu: The build was broken.
[10:05:28] <nigelb> seanh_: Heh, so your patch bit-rotted a bit (my fault)
[10:05:38] <nigelb> so the tests failed because of a new sphinx warning :P
[10:05:43] <nigelb> and I had to go fix it :)
[10:05:52] <seanh_> Heh heh
[10:07:11] <seanh_> amercader: An incorrect indentation in a docstring, how could you possibly have missed that when reviewing resource views? ;)
[10:07:57] <amercader> oh dear, let's revert the whole thing
[10:12:18] <nigelb> heh
[10:35:40] <nigelb> wtf ckan
[10:35:50] <nigelb> I have spatial installed why can't you see the templates
[11:03:55] <seanh_> One thing I find confusing about docker is that after using it for a while, I end up with tons of docker images, containers and filesystems lying around, and have no idea what's what
[11:04:30] <seanh_> Every time you build a Dockerfile (whether the build succeeds or not) it leaves a load of intermediate images lying around (unless you explicitly tell it to tidy them up)
[11:04:49] <seanh_> And every time you run a docker image, it seems to make a new container and filesystem(s)
[11:05:10] <seanh_> I guess as long as you name and tag the images and containers that you actually care about, then it's ok
[11:09:21] <seanh_> But every time I go away from Docker for a couple of weeks and then come back to it, I have no idea where I was at
[11:09:47] <seanh_> The same thing happens with vagrant actually, except for the one main vagrant ckan vm that I use every day
[11:46:48] <nigelb> seanh_: one of the reasons I don't use docker locally.
[11:46:59] <nigelb> I have an ssd and dont' have a lot of space.
[12:23:00] <joet> i'm still using libvirt-sandbox, which allows you to just contanerize a service on it's own, but they're doing less work on it now, because docker is so popular.
[12:27:22] <seanh_> nickstenn: Each time I run a maintenance command in my ckan docker container using that long docker run command from the docs, it creates a new docker container and leaves it behind
[12:27:26] <seanh_> docker ps -a shows all the container
[12:27:45] <seanh_> And docker ps shows that all those containers are connected to my running postgresql and solr containers
[12:28:25] <seanh_> Is this the right way to do this? It seems you should be able to run an ad-hoc command in a running container without creating a new container and leaving it behind every time
[12:28:38] <seanh_> After a while the output of docker ps is going to be completely unreadable
[12:32:53] <nickstenn> seanh_: that's exactly right -- you can remove the old images with docker rm
[12:33:04] <nickstenn> and no, there is no way to run commands in a running container
[12:33:07] <nickstenn> by design
[12:34:31] <nickstenn> seanh_: I have two shell aliases I use quite a lot
[12:34:46] <seanh_> But if a run a command (in a new container) that modifies the filesystem, the already-running container will see that change to its filesystem as well?
[12:34:51] <nickstenn> no
[12:34:59] <seanh_> Errr..
[12:35:07] <nickstenn> that's what data volumes are for
[12:35:26] <nickstenn> this is not a bug, this is a feature
[12:35:30] <nickstenn> container != vms
[12:36:28] <seanh_> Yes, but exactly what a container is (or how you work with them) is really confusing. VMs work well because they fit the same mental model that people are used to from using their computers
[12:36:57] <nickstenn> seanh_: https://gist.github.com/nickstenning/53cb1b40ce9309245561
[12:37:32] <nickstenn> seanh_: you can argue that containers work well because they provide a very clear boundary between configuration and state
[12:37:37] <seanh_> I've fixed a bug in the CKAN run file. I could rebuild the image every time to get a container running my new run file, but that takes ages. I need to figure out how to simply modify a file on my container's filesystem. Maybe the easiest way is to share the run file's directory with the host
[12:37:57] <nickstenn> argh, no
[12:38:30] <nickstenn> docker build for a change to the run file will take about 20s
[12:38:40] <nickstenn> (assuming you've already run the build once)
[12:38:55] <seanh_> So re-running docker build _is_ the right thing to do?
[12:38:56] <nickstenn> configuration in a container is immutable, by design
[12:39:22] <nickstenn> to fix a bug in the image, you rebuild the image, yes
[12:39:38] <seanh_> So by default docker run runs CKAN inside nginx and apache. What happens if CKAN modifies something on the container's filesystem then?
[12:40:12] <nickstenn> if it modifies something in a data volume, that can be exported outside of the container, or mounted into the container from the host
[12:40:41] <nickstenn> if it modifies something that is not in a data volume, then that will be lost when the container terminates
[12:41:12] <nickstenn> but that's a good thing as well as a bad thing. it means you have to make explicit statements about where system state is stored
[12:41:15] <seanh_> But what I'm getting it is that if a process running in a container modifies something in the container's filesystem .. Then the container simply sees that change to its filesystem, just like an OS running in a VM or on metal would?
[12:41:23] <nickstenn> yes, of course
[12:41:38] <seanh_> Will the changes be lost if you run docker stop?
[12:41:42] <nickstenn> no
[12:42:09] <seanh_> So what "terminates" a container? rm?
[12:42:13] <nickstenn> but they won't be present if you start a new container based off the image
[12:42:31] <nickstenn> docker rm will destroy the container and its associated state, yes
[12:42:48] <seanh_> Right, starting a new container based off the starting image I understand (that's just like booting a new vagrant box from a base image)
[12:43:03] <nickstenn> what's the example here?
[12:43:21] <seanh_> Just that I wanted to modify the run file in my container (without rebuilding the image)
[12:43:33] <nickstenn> why?
[12:43:45] <nickstenn> specifically why without rebuilding the image.
[12:43:55] <nickstenn> if it's a bug in the image, then you want to fix the bug in the image, right?
[12:44:01] <seanh_> I don't understand why, if CKAN running in the container can modify the container's filesystem in such a way that the container sees that change, why I can't use docker run to run some other command to also modify a file
[12:44:17] <nickstenn> because docker run starts a new container
[12:44:23] <nickstenn> it doesn't know anything about the other container
[12:44:34] <seanh_> Because I thought building would take ages. At this point, I don't want to do it anymore but I just want to understand why I couldn't do it
[12:45:11] <nickstenn> the only way to share state between containers is for the state to be fully external (i.e. a database) or you use explicit data volumes (docker run -v) and the --volumes-from option to docker run.
[12:45:32] <seanh_> So what about paster commands? If any of them rely on modifying the filesystem to work, then we can't use them in docker?
[12:46:35] <nickstenn> if a running container needs to detect changes to its own filesystem created by a paster command run in another container, then that won't work unless the filesystem is shared (by a data volume)
[12:46:46] <seanh_> So it seems that docker run creates and starts a container running CKAN, and then there's no way to run any other command in that container (doing docker run again creates a new container)
[12:46:46] <nickstenn> are there paster commands that operate like this?
[12:46:57] <nickstenn> seanh_: that's exactly correct, yes
[12:47:04] <nickstenn> and again, it's by design
[12:47:07] <seanh_> I don't know if there are paster commands like that, hopefully not
[12:47:27] <nickstenn> if I can run arbitrary commands in a container that modify its filesystem at runtime, then I can make changes which are not part of the image
[12:47:57] <nickstenn> this (imo) is a Bad Thing, because then the configuration of the container depends on a) the image and b) whatever commands I've run, probably undocumented, since I started the container
[12:48:09] <seanh_> The whole thing is very counter-intuitive when you're used to metal and VMs ... I suppose it comes to make sense eventually, but I wonder what this means for docker in the long run, if someone can make something with a more intuitive interface it might pick up support quicker
[12:48:42] <nickstenn> I don't think docker has too many problems with adoption right now :)
[12:49:15] <seanh_> It seems to me very natural to think: Ok, now I have CKAN running in a "virtual machine" (docker container), now I want to modify a file inside the container (thinking in terms of VMs, but I think everyone will approach it in that wau)
[12:49:59] <nickstenn> Right, understood. I agree that it's counterintuitive, but the reason it's counterintuitive is the *same* reason as it's a great model for shipping software.
[12:50:20] <nickstenn> If you allow people to break the encapsulation of the container image, then a container is no longer a black box.
[12:50:30] <seanh_> But anyway ... So using data volumes you can get the VM-like behavior that I want for modifying the filesystem, although you wouldn't want to do that too much it sounds like
[12:50:41] <nickstenn> And the fact it's a black box is what makes containerisation so powerful.
[12:51:02] <nickstenn> Let me dig out a couple of useful blog posts...
[12:51:41] <seanh_> Ooh, and if you rebuild an image with the same name/tag the old image is still there but the name/tag has been removed from it
[12:52:09] <nickstenn> Yes -- a (repository, tag) tuple can only point at one image
[12:52:19] <seanh_> And you may still have (possibly running) containers using the old image as well
[12:52:54] <seanh_> Basically everything like docker looks superficially like vagrant but then turns out to be confusingly completely different!
[12:54:07] <seanh_> I think I'm going to be making use of those shell aliases a lot as well
[12:54:47] <nickstenn> Maybe, yes. But it's also about five orders of magnitude faster to boot a container than a VM, and it provides a true separation between image configuration and application state, which VMs do not (inherently) do
[12:55:07] <nickstenn> Here's a good post on why modifying files in the container isn't (usually) what you want to do:
[12:55:07] <nickstenn> http://jpetazzo.github.io/2014/06/23/docker-ssh-considered-evil/
[12:56:26] <nickstenn> and here's some nice tools to break the rules for the purposes of debugging: http://jpetazzo.github.io/2014/03/23/lxc-attach-nsinit-nsenter-docker-0-9/
[12:56:54] <seanh_> Thanks
[12:57:52] <seanh_> I'll read them later. Right now I'm getting "./run: 66: ./run: Syntax error: Unterminated quoted string" in my docker logs, the run file only has 65 lines and there's no obvious unterminated string anywhere ... Shell scripts :(
[12:58:04] <seanh_> But I know how to edit the script and test the changes now
[12:58:38] <nickstenn> seanh_: you might want to check out the somewhat simpler script in the ckanexpress repo...
[12:58:50] <nickstenn> I was going to PR moving the setup stuff to a separate script anyway
[12:58:55] <nickstenn> (as in the ckanexpress repo)
[12:59:13] <seanh_> Ok
[13:02:33] <seanh_> Maybe I'll forget about getting the existing docker script to use my new environment variables then ... Just add a couple of functional tests and get it merged
[13:03:28] <seanh_> I'm in favor of writing shell scripts in Python by the way. Shell scripts are fine if we can keep them really simple, but they're just sitting there waiting for someone to come along and make them more complicated, and then they're unreadable, unmaintainable, hard to debug
[13:11:47] <seanh_> nickstenn: If you can get that PR to move the setup stuff from ckanexpress then I can review and merge it
[13:12:01] <nickstenn> seanh_: I'll try and get to that next today
[13:12:05] <nickstenn> it shouldn't take long
[13:13:27] <seanh_> Cheers
[14:31:33] <nickstenn> seanh_: sorry I'm being slow -- just looking at that PR now
[14:37:13] <nickstenn> seanh_: https://github.com/ckan/ckan/pull/1860
[15:47:17] <seanh_> nickstenn: I'll take a look at that now
[16:06:38] <seanh_> Our tests are taking 30mins to run on Travis now? :(

2014-07-27

2014-07-26

2014-07-25
[08:50:34] <seanh> Morning all (back again after two weeks of conferences)
[08:51:41] <amercader> hi seanh, how was europython?
[08:53:07] <seanh> SkramX: The way for a non-technical person to edit data in the datastore is for them to edit a spreadsheet file on their computer, and then upload it to CKAN. As long as you have the DataPusher installed and working, the contents of their spreadsheet will get pushed into the datastore each time they upload it. There's no web interface for editing data in the datastore directly (yet)
[08:53:17] <seanh> amercader: It was pretty good, I got a lot of t shirts
[08:58:11] <nigelb> ha
[08:58:20] <nigelb> I actually haven't bought a T-shirt in ages because of conferences.
[08:58:21] <seanh> I mean, I got like 10 t shirts
[08:58:26] <nigelb> wow.
[08:58:27] <seanh> and as many pens
[08:58:29] <nigelb> good haul :D
[08:58:36] <seanh> and a stuffed moose
[08:58:43] <nigelb> Elastic Search Moose?
[08:58:47] <seanh> Yeah
[08:58:50] <nigelb> It's very cute, I got one of those too :)
[08:59:03] <seanh> And a stone drinks coaster from RedHat
[08:59:37] <nigelb> If anyone has some time to context switch to datapusher, please review https://github.com/ckan/datapusher/pull/41
[08:59:43] <seanh> Pair of earphones from google. Bascially this is the most important thing about the conference for me
[08:59:54] <nigelb> A bit of code reorg and some major docs reorg.
[09:00:20] <nigelb> seanh: I have a bookmarks folder of talks to watch.
[09:00:23] <nigelb> so. many. good. talks.
[09:00:39] <seanh> Yeah there's a few that I missed that I have to go back to as well
[09:01:37] <seanh> amercader: So for Glasgow, ckanext-oauth2waad creates the user with the fake email address, and then ckanext-glasgow needs to intercept that and get the real email address and other details from the Identity Services API
[09:01:57] <seanh> This means I need to wrap the user_create action, which I don't think works in 2.2
[09:02:41] <seanh> I could just throw the Identity Services stuff into ckanext-oauth2waad. Or ckanext-oauth2waad could provide its own "edit the user details before the user is created" plugin interface
[09:02:41] <amercader> seanh: it works on 2.2.1, use this branch for now until the package gets updated
[09:02:52] <seanh> Ah, okay
[09:03:20] <amercader> incidentally, me and joe got bitten by the same issue while working on glasgow as well
[10:02:37] <reederz> How do I go about creating custom 404 page? Is there a plugin interface for that?
[11:16:40] <azymuth> Anyone kicking around?
[18:05:48] <SkramX> amercader: thanks for the response about 10 hours ago

2014-07-24
[22:21:42] <SkramX> anyone? :)

[07:03:06] <nigelb> ugh, I hate datapusher documentation.
[07:03:10] <nigelb> It's basically shit.
[09:58:56] <nigelb> Does anyone want to quickly review https://github.com/ckan/ckan-service-provider/pull/17
[09:59:01] <nigelb> (pinning version to 2.1.2)
[10:02:45] <amercader> nigelb: looks good
[10:07:26] <nigelb> amercader: thanks
[10:09:08] <nigelb> amercader: pushed to both master and stable.
[10:29:38] <amercader> nigelb, joet: I won't be able to make the dev meeting today, sorry
[10:30:03] <amercader> hopefully I don't get much stuff assigned for it :)
[10:30:49] <nigelb> heh
[10:30:52] <nigelb> okay :)
[10:30:55] <nigelb> https://github.com/ckan/datapusher/pull/41/files
[10:31:09] <nigelb> this is the cleanup I did this morning for datapusher if anyone's interested in reviewing.
[10:31:22] <nigelb> Lots of documentation and a change (revert) to wsgi.py.
[10:39:11] <wardi> woo resourceviews
[10:40:59] <amln> is it worth putting the pad/meeting link + times in /topic here?
[10:45:54] <joet> maybe yeah, no one wants to listen to us assign pull requests, but they might want to be there when we discuss their pull request or general question. So we could say add stuff to the pad and we can invite people in at the right time.
[10:46:55] <wardi> or link https://github.com/ckan/ckan/wiki/Dev-Meeting-Notes which has all the info
[10:47:48] <joet> that is probably best
[10:55:25] * TOPIC: The open source platform for open data: datahub.io & ckan.org | Meeting info and notes: https://github.com/ckan/ckan/wiki/Dev-Meeting-Notes
[10:55:29] <nigelb> there you go
[11:01:28] <nigelb> wardi: are you joining?
[11:01:30] <joet> https://pad.okfn.org/p/ckan-meeting
[11:02:11] <joet> i thought he said he would be away, yet he likes #ckan so much he is still on irc
[11:03:08] <amln> no david reed?
[11:03:13] <shellac> could somebody explain what 'harvester run' does? I think we've had issues with it interrupting in-progress harvests.
[11:04:50] <shellac> as far as I can tell it's asychronous, which makes it hard to guarantee safe use.
[11:15:30] <nigelb> if I had a time machine, sure ;)
[11:15:39] <nigelb> shellac: give us a bit, we're in the dev meeting.
[11:15:52] <shellac> np
[11:19:48] <nickstenn> hi all -- let's say I'd been asked to install the spatial extension for someone, and I'd followed all the instructions
[11:19:54] <nickstenn> how would I go about testing that it works?
[11:23:08] <rossjones> nigelb apart from tests, you end up with a map in the sidebar at /dataset
[11:23:15] <rossjones> oops I meant nickstenn
[11:23:54] <nigelb> that was confusing :)
[11:24:00] <rossjones> I am.
[11:24:10] <nickstenn> rossjones: hmm. thank you. no map. I wonder what I've done wrong...
[11:24:19] <rossjones> added both plugins?
[11:24:46] <nickstenn> spatial_metadata and spatial_query? yes
[11:25:10] <nigelb> do you have a custom theme?
[11:25:13] <nickstenn> nope
[11:25:22] <rossjones> I thought the map was in the ckanext-spatial templates?
[11:25:37] <amercader> nickstenn: you will only get the map if you add the snippet to your templates
[11:25:47] <nigelb> aha
[11:25:53] <nickstenn> right, ok.
[11:26:07] <amercader> nickstenn: I'm on the move now, can send details later
[11:26:14] <nickstenn> so is there any other easy way I can test anything about this extension without having to futz with templates?
[11:26:28] <amercader> basically you could ping package_search with the bbox params
[11:26:40] <nickstenn> amercader: cheers -- I'll check that out
[11:27:04] <amercader> nickstenn: http://docs.ckan.org/projects/ckanext-spatial/en/latest/spatial-search.html
[11:28:01] <amercader> shellac: if you send an email to the dev list  I can tell you how "harvester run" works, should not affect running harvestings
[11:28:13] <shellac> ok, will do. thanks
[11:28:13] <amercader> sorry I can' t hang around now
[11:44:52] <wardi> nigelb: no, i'm not here :-)
[11:45:05] <nigelb> wardi: yes, I can see that :P
[17:45:38] <SkramX> anyone know of a ckan plugin that lets a user do pretty basic CRUD operations on a datastore-backed db? looking to let a non-technical person input data. maybe it'll be better to set up syncing between a google spreadsheet but figured I'd ask first
[17:50:27] <SkramX> Hmmm... http://ckan.org/features-1/publish/ says "You can add and edit data in CKAN in many ways, including: \n Directly via the web interface"

2014-07-23
[04:04:42] <Sherry> Hi, I am new to Ckan. I was wondering is it possible to replace the default graph tool (data visualizer) module with another one? are there any better alternatives? if not then how can i cutomize the current module?
[09:23:15] <amercader_> rossjones: you are right
[09:36:29] <nigelb> I'm still not sure if the automatic login from http auth is a good idea.
[09:53:12] <rossjones> amercader_ great.
[09:53:23] <rossjones> nigelb what worries you about it?
[10:19:30] <realitygaps> the datastorer update command creates a lot of files in /tmp . Is that the only place they are stored? Or can they be wiped regularly without affecting the datastore?
[10:19:40] <realitygaps> were are running   datastorer update
[10:41:50] <joet> realitygaps, yeah you should be ok to delete them
[10:42:26] <realitygaps> joet: ok thx :) will try
[10:42:33] <joet> if you want to be extra safe you could probably have a cronjob that only deletes files older than a day or so
[10:42:48] <joet> you probably don't want to be deleting files whilst the datastore is running
[10:43:14] <joet> *datastorer
[10:47:07] <realitygaps> yep, will make a script that checks that
[11:37:27] <rossjones> You want tmpreaper probably
[11:51:21] <amln> +1 on tmpreaper.
[12:20:47] <realitygaps> thx, will definitely take a look at that
[19:57:30] <SkramX> if i was using the 1251 branch, now that it is in master, what should i do to move over to master?

2014-07-22
[11:05:00] <amercader_> joet, vitorbaptista : dev meeting?
[11:05:34] <joet> yes
[11:07:24] <joet> looks like wardi is away
[11:07:37] <amercader_> joet: are you on the call
[11:07:56] <joet> link? or is it on skype
[11:08:06] <joet> amercader, ^
[11:08:16] <amercader_> joet: https://plus.google.com/hangouts/_/event/cb1vmkss426lkqicj94a3amvd1c?authuser=0&hl=en-GB
[15:22:41] <shellac> Does anyone have pointers to an explanation of how harvesters work?
[15:23:15] <shellac> I'm not clear what does what, although I can run the commands at https://github.com/ckan/ckanext-harvest#running-the-harvest-jobs
[15:24:12] <shellac> in particular is it possible to interrupt a harvest by running 'run'? or is it entirely safe
[15:28:21] <rossjones> shellac it should be safe. it puts jobs on to a queue for the different stages of processing.
[15:30:55] <shellac> where are the jobs run? as part of the gather_consumer or fetch_consumer processes?
[15:32:18] <rossjones> I can't remember which is which, but one fetches the higher level info (list of datasets) from somewhere, and the other creates job queued jobs for individual datasets.
[15:32:26] <rossjones> The last processes those individual datasets.
[15:33:30] <shellac> thanks rossjones
[15:33:32] <rossjones> So for instance, the first could be a folder containing a list of Gemini documents, and then the next would be a new job for each document.
[15:34:41] <rossjones> There's also an alternative harvester at https://github.com/opendatatrentino/opendata-harvester which I haven't tried yet.
[15:44:58] <rossjones> amercader am i right in thinking that the csw support in ckanext-spatial only serves datasets that were harvested from elsewhere, or am I reading it wrong?

2014-07-21
[08:55:22] <travis-ci> [travis-ci] ckan/ckan 1792-filterable-resource-views 94c2abf http://travis-ci.org/ckan/ckan/builds/30437868 Vitor Baptista: The build was broken.

2014-07-20

2014-07-19
[23:24:19] <ehlovader> Good evening
[23:24:48] <ehlovader> I would like to learn more about what capabilities ckan might offer for an intranet system. Where would you suggest I look first?
[23:25:25] <ehlovader> I see it is mostly data centric, but it appears it could also store posts, and meta related info about a dataset as well as files in general.
[23:25:38] <ehlovader> am I mistaken about this? is it only data?
[23:32:35] <ehlovader> I actually am very interested in the data storing and harvesting abilities of this.
[23:53:42] <dragondave> It definately stores metadata ,eg. http://data.gov.uk/data/openspending-report/publisher-foreign-and-commonwealth-office.html
[23:54:34] <dragondave> Although that's quite a customised ckan instance, thinking about it

2014-07-18
[09:59:29] <davidmiller> Morning folks!
[09:59:43] <davidmiller> Is anyone doing analytics (e.g. Google) on API usage?
[10:41:08] <nigelb> davidmiller: don't think so.
[10:41:36] <nigelb> the folks who might do anything would be wardi or david read.
[10:48:42] <amln> david read was speaking a bit about analytics earlier in the week, but I don't think I caught anything on API
[10:49:59] <rossjones> Suspect nobody has done api analytics because it is harder (i.e. you can't rely on the browser to make the GA call for you)
[10:50:13] <rossjones> davidmiller are you volunteering if not?
[11:01:08] <davidmiller> rossjones: Well I have a concrete needs-driven requirement...
[11:01:52] <davidmiller> I'll ping David Reed though - good shout :)
[11:16:28] <nigelb> rossjones: I found a spectacular bug this morning.
[11:16:54] <nigelb> http basic auth logs you into ckan if that users exists, thanks to repoze.who.
[11:18:14] <rossjones> nigelb is that leftover from using basic-auth for API calls?
[11:18:38] <nigelb> Not exactly sure, to be honest. I'm going to file it to investigate when I have more head-space.
[11:18:46] <nigelb> Though, it is very likely.
[14:02:30] <nigelb> rossjones: where would I look for the left-over from using basic-auth for api calls?
[14:45:24] <rossjones> nigelb probably the [plugin:basicauth] section of repoze.who
[14:45:37] <nigelb> okay
[14:47:09] <nigelb> I've been reading repoze.who documentation all day.
[14:47:11] <nigelb> so much fun.
[14:47:12] <nigelb> not.
[14:48:47] <rossjones> :D
[15:14:26] <nigelb> I've done the basic stuff I think.
[15:14:38] <nigelb> Time for more detailed layer of figuring out wtf is going on.
[15:20:55] <ross_statcan> When we set up Solr for our CKAN instance, we just used the default Solr query parser. Now our client says they want search to be 'like Google' and instructed us to use a logical AND between all search terms. I'm not a Solr expert, but I believe this means using a different query parser. I'm wondering if anyone else altered or fine-tined their instance of Solr or are most people just using the default?
[15:21:57] <nigelb> we've installed solr 4 for a few times.
[15:22:02] <nigelb> that's about it, I think.
[15:22:13] <nigelb> amercader would know better, he's on a plane at the moment, I think.
[15:25:02] <rossjones> ross_statcan https://github.com/ckan/ckan/blob/master/ckan/config/solr/schema.xml#L146 suggests it is defaulting to AND
[15:27:59] <ross_statcan> Thanks @nigelb ! I can put this question out on the mailing list too, but was curious if this had been done.
[15:28:14] <rossjones> hmm, defaultOperator I think applies to fields not keywords
[15:29:34] <ross_statcan> I did some basic testing, and I <think> the default results suggest Solr is using OR on the search terms
[15:29:48] <ross_statcan> I agree it is ANDing the fields by default
[15:30:37] <rossjones> ross_statcan go to your solrconfig.xml, find the requestHandler section.  Inside the default you want
[15:30:38] <rossjones> <str name="mm">1/str>
[15:31:21] <rossjones> http://wiki.apache.org/solr/DisMaxQParserPlugin#mm_.28Minimum_.27Should.27_Match.29
[15:31:33] <rossjones> Looks old though, and mentions q.op=AND but not sure where you would set that
[15:32:46] <ross_statcan> Are you using Solr 4+. We're on 3.5, and I think I need to change the parser to a dismax parser
[15:33:08] <ross_statcan> to change the mm setting
[15:33:28] <rossjones> I've about 4 versions of solr installed on this mac :(
[15:35:51] <ross_statcan> No problem! I'm sure with enough changes to solrconfig it can be made to work. My more basic concern is: I wonder if this a a good idea. I have a feeling that this won't give the best search experience
[15:39:54] <rossjones> it'll narrow down the results instead of widening them, so maybe it might.
[15:43:39] <ross_statcan> That's true, but it I don't think any of the major Open data sites have changed their Solr search behaviour so I wonder if the CKAN community had experience with this
[15:45:31] <ross_statcan> If it hasn't been looked at before, there are a *lot* of settings and fine-tuning available in Solr, so it might be worth a little investigation (on my part)
[15:54:54] <rossjones> It was asked for on data.gov.uk, but didn't get done.
[15:59:58] <ross_statcan> OK, thanks a lot for your responses rossjones. I think data.gov is using the default as well. I will share whatever I find on the mailing list.

2014-07-17
[10:32:33] <travis-ci> [travis-ci] morty/ckan after-commit-test 9349f12 http://travis-ci.org/morty/ckan/builds/30156950 Tom Mortimer-Jones: The build was broken.
[11:24:25] <travis-ci> [travis-ci] ckan/ckan 1530-use-passlib d496321 http://travis-ci.org/ckan/ckan/builds/30160862 joetsoi: The build was broken.

2014-07-16

[05:54:38] <Guest94434> How'dy all. Is there a dataset/csv for the list of ckan instance at http://ckan.org/instances/# ?
[05:56:06] <Guest94434> I'd just like a plain text list of all the good ckan enpoints like https://data.qld.gov.au/api/3/action/ etc
[08:03:16] <Guest94434> ckan sucks
[08:04:05] <amln> Guest94434: could you explain more?
[08:05:05] <Guest94434> software in general is very sucky therefore ckan sucks
[08:05:41] <Zharktas^> that really is very constructive criticism
[08:05:58] <Guest94434> thank you
[08:08:44] <amln> http://www.chiark.greenend.org.uk/~sgtatham/bugs.html has some guidance on how to report a bug, so we might be able to consider features to make it less sucky (although I don't think CKAN particularly sucks; it's got excellent documentation, a lot of users, trust of national governments, cities, and a very committed dev-team)
[08:11:30] <Guest94434> the national governments are just bludging off free open source labor
[08:12:00] <Guest94434> they are like most of us, just wanting an easy way to keep up appearances
[08:14:43] <Guest94434> you could say the same thing about nasty pharmaceuticals/drugs supplied by big pharma (excellent docs, lots of users, trust of govt, cities)
[08:15:13] <Guest94434> doesn't mean they don't suck and make a lot of people sick
[08:25:15] <amln> aww, our guest disappeared as I was going to engage
[10:03:56] <rossjones> amln wouldn't waste your time with trolls
[10:11:30] <amln> rossjones: sometimes it's interesting to see if they are clueless, or venting.
[10:11:53] <amln> but "Guestxxxxx" is hardly encouraging. F-.
[10:12:38] <shellac> I've been purging some packages, and it seems to leave relationships containing nulls hanging around (i.e. the purged id is removed)
[10:12:48] <rossjones> amln Was guessing stuck in his mom's basement, hadn't seen sunlight for a few years :)
[10:13:21] <rossjones> shellac I am guess it is fear cascading deletes :(
[10:13:29] <rossjones> I am guess? I am guessing.
[10:14:00] <shellac> we're on ckan 2.1, so perhaps it's been fixed
[10:14:04] <rossjones> Does it leave resourcegroups, and therefore resources in place?
[10:14:27] <shellac> oh lord, I hope not.
[10:14:36] <rossjones> they might just be state='deleted'
[10:14:42] <shellac> not obviously, at least
[10:14:46] <rossjones> I haven't looked at the purge stuff v.recently
[10:15:19] <rossjones> Might also be worth checking the member table. Fairly sure it'll have deleted revisions though.
[10:18:25] <rossjones> shellac https://github.com/ckan/ckan/blob/master/ckan/model/domain_object.py#L81 and a comment .... # this actually should auto occur due to cascade relationships but ....
[10:19:31] <rossjones> https://github.com/ckan/ckan/blob/master/ckan/model/package.py#L585 explains a little more too.
[10:20:55] * shellac pulls trigger and removes broken relationships and relationship versions
[10:21:28] <shellac> we're getting 500s, because of the unexpected nulls (as you might expect)
[10:21:53] <shellac> ah well, I know this area of ckan a little better now
[10:23:57] <shellac> I think wardi warned me not many people used package relationships.
[10:26:53] <rossjones> shellac I've never heard of anyone. I've heard of people wanting it, but there's no UI for it so it doesn't get used.
[10:36:50] <shellac> rossjones: now working properly, thanks. http://data.bris.ac.uk/data/dataset/13kidnrls4jnl1m806eyfd8h6z
[10:37:20] <shellac> (the full horror of our packaged)
[10:42:54] <rossjones> shellac nice. have you got a ui for it or code with api?
[10:44:15] <shellac> we harvest from our published datasets (e.g. http://data.bris.ac.uk/datasets/13kidnrls4jnl1m806eyfd8h6z/), and build the packages and relationships programatically
[10:44:30] <rossjones> ah.
[10:44:35] <shellac> (http://data.bris.ac.uk/datasets/13kidnrls4jnl1m806eyfd8h6z/.info.rdf is the metadata bundle)
[10:49:11] <rossjones> v.cool.  what are the repo: urls?
[10:50:16] <shellac> oh, something I need to fix. repository relative urls, so mentally remove them
[10:50:58] <shellac> or s|repo:|http://data.bris.ac.uk/datasets/|
[10:53:49] <travis-ci> [travis-ci] ckan/ckan 1838-fts-on-specific-columns 9072a94 http://travis-ci.org/ckan/ckan/builds/30057188 Vitor Baptista: The build was broken.

2014-07-15

[08:02:41] <Vilsepi> is the delay adjustable for how long it takes until suggestions pop up when typing to a tag field? right now it seems to take forever and people actually miss that it would suggest old tags if they would wait
[08:54:19] <rossjones> Vilsepi I think the autocomplete is just slow.
[08:54:38] <rossjones> or do you mean reduce the number of characters typed before it starts showing options?
[08:55:25] <Vilsepi> rossjones: I meant the time delay
[08:55:48] <rossjones> From what I recall it is just vslow.
[10:50:42] <wardi> Vilsepi: we probably don't have the right indexes on the tags table, and I suspect you have lots of tags
[10:51:15] <wardi> vitorbaptista was working on a related problem with autocomplete and the datastore. maybe we can use his fix for tags too
[10:51:57] <Vilsepi> wardi: yes we have relatively many tags, we parse them from open skos vocabs
[10:53:22] <wardi> might be nice to use solr for the tag completions. it has stemming and other nice features
[11:02:33] <wardi> https://plus.google.com/hangouts/_/event/cb1vmkss426lkqicj94a3amvd1c?authuser=0&hl=en-GB
[11:02:49] <Vilsepi> rossjones: actually my colleague realized that the culprit is a delay set in the autocomplete.js https://github.com/ckan/ckan/blob/master/ckan/public/base/javascript/modules/autocomplete.js#L27
[11:02:50] <wardi> ^ we doing this or is everyone busy at ckancon?
[11:09:21] <rossjones> Vilsepi oh wow, sorry, I sent you in the wrong direction. that's bad.
[11:32:30] <Vilsepi> rossjones: not sure what you mean, but no problem anyways, we got rid of the delay :)
[13:07:00] <nigelb> wardi: the tags thing is because we do a db query instead of solr search, I think.
[13:09:05] <nigelb> I wanted to fix that when I was doing the groups thing.
[13:09:09] <nigelb> totally missed.
[13:09:11] * nigelb files bug
[13:24:49] <shellac> Is there a paster command that corresponds to http://docs.ckan.org/en/latest/sysadmin-guide.html#permanently-deleting-datasets
[13:24:53] <shellac> ?
[13:25:48] <shellac> the web request when I click the button eventually times out

2014-07-14
[13:36:25] <shellac> silly question: where are relationships stored? I see 'child_of' in solr, but are they stored elsewhere
[13:37:29] <wardi> shellac: PackageRelationship
[13:37:39] * nigelb waves to wardi
[13:37:51] <shellac> wardi: in solr, or rdb?
[14:03:59] <shellac> wardi: scratch that, found it.
[14:20:24] <rossjones> amercader if I am setting an extent in ckanext-spatial for the map filter, and I am looking at Mogadishu instead of UK - which schoolboy error have I made?
[14:28:55] <rossjones> hmmm pebkac ... nevermind.
[14:35:32] <amercader> lol pebkac, had to google it but worth it
[14:35:41] <amercader> I guess it was lat/lon vs lon/lat
[14:36:25] * wardi waves back at nigelb
[14:36:41] <rossjones> :)
[14:36:45] <wardi> is the dev meeting still on for tomorrow? I
[14:37:06] <wardi> 'll be away for a bit after that
[15:17:07] <nigelb> amercader: I left my phone there I think.
[15:17:22] <nigelb> amercader: can you bring it back to the hotel for me, please?
[15:17:25] <amercader> nigelb: where?
[15:17:29] <amercader> plugged?
[15:17:58] <nigelb> amercader: not sure
[15:18:02] <amercader> nigelb: got it, I'll keep it for you
[15:18:07] <nigelb> awesome, thanks :)
[15:20:55] <rossjones> amercader time for some comedy tweets on nigelb's phone?
[15:21:50] <amercader> rossjones: mmm, no pattern lock ... :)
[15:38:39] <nigelb> there's a lock for twitter :)
[15:40:39] <rossjones> :(
[16:42:39] <nigelb> 2

2014-07-13

2014-07-12

2014-07-11

2014-07-10

[00:20:46] <SkramX> anyone know where to get a listing of schools in South America? any/all levels of schooling and any information I can get my hands on would be great
[10:59:42] <wardi_> https://plus.google.com/hangouts/_/event/cb1vmkss426lkqicj94a3amvd1c?authuser=0&hl=en-GB
[11:06:25] <joet> https://github.com/ckan/ckan/pull/1792
[11:56:33] <reederz> Hey guys, I'm struggling with internationalization of a ckan extension. My extension is called ckanext-eod and I have all the translations under ckanext/eod/i18n. I'm working on danish translation so the compiled tranlations go into ckanext/eod/i18n/da_DK/LC_MESSAGES/ckanext-eod.mo file. Unfortunately, none of my translations materialize on the front-end. Any ideas what I should do?
[11:57:36] <reederz> I have set the default locale in the ckan configuration file. Do I also have to add my translation directory to it somehow?
[13:32:10] <seanh> Oopsm completely forgot about the dev meeting
[13:50:30] <reederz> if anyone's interested, I solved my extension translation problem with https://github.com/opendatatrentino/ckan-custom-translations.git
[13:57:56] <wardi_> reederz: very interested
[13:58:54] <wardi_> how can we make this part of core and zero-effort for users?
[14:21:07] <reederz> wardi: the translation part? I guess it depends on what do you mean by "users"
[14:21:19] <reederz> sysadmins?
[14:23:01] <reederz> wardi_
[14:44:14] <wardi_> reederz: yes, sorry, I meant sysadmind
[14:44:51] <wardi_> I'd like the "I want ckan with 5 extensions and all their languages" to be as simple as enabling the language and plugins in the ini file
[14:48:00] <reederz> wardi_: My suggestion would be to follow a similar workflow as in ckan-custom-translations tool. On every apache restart, CKAN could aggregate *.po files from different extensions + ckan and then compile them into 1 big *.mo file
[14:48:58] <reederz> but I have really little experience with i18n in general, so take my advice with a grain of salt
[14:49:03] <wardi_> reederz: yes. with paster serve it's easy to do something on start, we just provide a script to run before starting apache
[14:50:02] <reederz> wardi_: do you imagine it being a part of core or a custom extension?
[14:50:19] <wardi_> I want this in core. it should "just work"
[14:51:50] <reederz> I would be up for the task but only starting in August
[14:52:28] <wardi_> Maybe we can add a thing to the start of the wsgi script (as long as it's cheap enough to check when there's nothing to do, and other processes block when one is running the update
[14:52:43] <wardi_> reederz: cool!
[15:22:26] <reederz> wardi_: I'll talk to my manager and ask if I can get time for this in one of the upcoming iterations - will get back to you soon
[15:24:24] <vitorbaptista> reederz: That would be great! It's one of those outstanding issues with CKAN that everyone has but no one had the time to fix it properly.
[16:33:17] <mattle> http://www.clickhole.com/blogpost/ive-got-cryptic-message-anyone-who-thinks-gays-sho-472
[16:41:53] <mattle> whoops, that's embarrassing, sorry about the linkspam

2014-07-09
[14:51:31] <shellac> wardi_: thanks for your help yesterday. package_search did the trick, once I found the child_of property
[14:57:21] <wardi_> shellac: glad to help. is ckan fast enough for what you're doing now?
[14:58:49] <shellac> it still needs the caching, I think, but generating the largest tree is sub-second now, rather than ~12 seconds
[14:59:43] <shellac> which is quite a difference :-)
[14:59:43] <wardi_> :-)
[20:01:01] <travis-ci> [travis-ci] wardi/ckan 1795-scheming-support 390ba8c http://travis-ci.org/wardi/ckan/builds/29537023 Ian Ward: The build was broken.

2014-07-08
[14:13:48] <wardi> shellac: sounds like you're building something cool, though :-)
[14:14:08] <nigelb> wardi: I have a feeling I'll be run over with complaints at the ckancon session :)
[14:14:38] <wardi> I regret that I won't be there to complain too :-)
[14:14:53] <shellac> I'm taking this over from someone else, so in day 2 of fiddling with ckan properly :-_)
[14:15:17] <shellac> wardi: you can see it here http://data.bris.ac.uk/data/
[14:15:48] <shellac> we'll announce it properly soon-ish, I think
[14:16:25] <shellac> If you're wondering 'hey, how nasty can a dataset get?' see http://data.bris.ac.uk/data/dataset/13kidnrls4jnl1m806eyfd8h6z
[14:17:23] <wardi> shellac: impressive
[14:17:31] <seanh> nigelb: What do I have to install to get paster shell?
[14:18:21] <wardi> shellac: might be nice to trim the common prefixes in that nested list
[14:18:26] <nigelb> seanh: nothing, I think.
[14:18:40] <shellac> wardi: yep, just done that on dev. bit less fearsome then
[14:19:42] <amercader> shellac: paster --plugin=pylons shell
[14:19:51] <amercader> on your ckan folder
[14:20:07] <shellac> amercader: thanks, I shall tinker.
[14:20:08] <amercader> or paster --plugin=pylons shell -c /path/to/ini/file
[14:22:05] <amercader> shellac: it would be great to have some feedback about the current status of package relations. As wardi said they are not widely used
[14:23:11] <wardi> I think they do have some tests, at least
[14:25:14] <shellac> amercader: will do. we might be more abusers than users of this feature :-/
[14:25:27] <amercader> shellac: CKAN is meant to be abused!
[14:26:09] <shellac> the issue -- as you can see -- is that the datasets are kind of chunky and a flattened list of resources was horrendous
[14:26:48] <shellac> (though this one is unusually unpleasant)
[14:26:55] <wardi> shellac: your solution seems good. by splitting them all the results should show in the search page individually
[14:28:41] <shellac> what phil -- the guy who did this work -- added was a top-level property. searches are limited to that by default, which also helps
[14:28:46] <shellac> e.g. http://data.bris.ac.uk/data/dataset?q=fats&level=top
[14:29:45] <wardi> so you can get either search behaviour, that's nice
[15:13:12] <shellac> Exploring a performance issue using the console (thanks for that) leads me to the following:
[15:13:42] <shellac> is it possible to fetch a limited number of properties for a package?
[15:14:10] <shellac> we're using: p.toolkit.get_action('package_show')(...id...)
[15:15:05] <shellac> but we really only need a name for display, maybe a couple of other properties
[15:20:01] <wardi> shellac: package_show pulls all the data straight from solr, so it's no faster to only get a couple fields really
[15:20:20] <wardi> but if you're finding that slow, maybe it's not hitting solr for some reason?
[15:21:04] <shellac> well it may not be very slow, but we hit it an awful lot.
[15:22:23] <wardi> shellac: can you make fewer queries to solr if you do it yourself?
[15:22:52] <shellac> is there a direct way?
[15:22:59] * shellac very new to ckan
[15:23:12] <wardi> getting all the packages in one solr query would be best. package_search would be the action for that
[15:23:22] <shellac> (for example I assumed this was postgres, not solr)
[15:24:32] <shellac> wardi: will have a look. I think that might halve the number of queries, assuming we can search by parent package
[15:25:04] <shellac> scratch that -- much far more than halve

[08:20:21] <seanh> I think sometimes virtualbox/vagrant just can't handle commands that take a long time to run
[08:20:58] <seanh> For example docker build in a vagrant vm never finishes, and although vagrant status reports that the vm is still up you can't ssh into it, have to reset it
[08:21:46] <seanh> The same thing happened when I tried to use vagrant bootstrapping so you could have a Vagrantfile that lets you just do vagrant up and get a CKAN dev environment, while installing all the packages the VM stops responding
[08:22:03] <nigelb> seanh: I have found that the best place to play with docker is on a digital ocean machine
[08:22:35] <nigelb> your local hardware is great, but you'll end up downloading things that take up bandwidth unnecssarily.
[08:22:51] <nigelb> Personally, I'm limited by space. I have an SSD. Not wasting space on VMs locally :)
[08:23:17] <seanh> I'm doing fine running it locally, just a bit annoying because postgres and solr are setup in my vm and I don't want to install them locally, but docker only works locally, so I have to switch between local and vm whenever I want to test something with docker
[08:23:28] <seanh> The sooner we can actually use docker itself for dev, the better
[08:23:51] <seanh> I have unlimited bandwidth and 50mb/s, not worried about that :)
[08:25:22] <nigelb> ha
[08:25:38] <seanh> I used to do CKAN dev in tmux on a Linode, it was quite cool that your dev environment and work-in-progress was always still there how you left it, even if you turn your laptop off or whatever. I kind of want to run gvim locally though not do everything in a terminal
[08:26:20] <nigelb> yeah.
[08:26:30] <nigelb> plus, harddisk failure / local issues aren't a big deal.
[08:26:43] <nigelb> because, you almost always have your environment safe.
[08:27:45] <seanh> I have F1, F2 and F3 bound to focus the firefox, gvim and terminal windows, this is very fast and good for RSI. With tmux you get F1 for firefox and F2 for terminal and then you have to change "tabs" within tmux to get to vim or your shell ... It's the little details!
[08:28:14] <seanh> I suppose I could use one terminal to run vim on a linode and a second terminal window to run a shell on the same linode
[08:30:26] <seanh> nigelb: Also, what do you do when you want to copy-paste some text from vim (running in tmux, running in a vm, in a terminal window) into e.g. IRC or Gist? If the text is more than one line long so that you can't just select it with the mouse. There is no solution to this afaik! Which is insance
[08:30:31] <seanh> insane
[08:31:49] <seanh> Heh, you could run your IRC client in tmux on the same VM, that would work!
[08:33:27] <seanh> I am kind of hoping that docker will give us the same separation between your dev environment and the actual host OS on your laptop, while getting us away from virtual machines (either local or remote ones)
[08:35:54] <nigelb> There's a vim plugin to push to gist.
[08:36:09] <nigelb> But I rarely have the need to copy and paste out of vim.
[08:37:08] <nigelb> seanh: sudo ckan datastore set-permissions doesn't actually output any sql
[08:37:38] <seanh> Is it supposed to?
[08:38:52] <nigelb> according to the docs, yes
[08:39:00] <nigelb> If you cant use the psql command in this way, you can simply copy and paste the output of:
[08:39:07] <nigelb> sudo ckan datastore set-permissions
[08:39:56] <seanh> Are you on a release branch? A change to this was merged in master recentl
[08:40:46] <nigelb> yeah, I'm on release.
[08:40:52] <seanh> Yeah it looks like that was changed, without a versionchanged block in the docs :(
[08:40:58] <nigelb> yeah :(
[08:46:05] <seanh> I wonder if we should go back to showing the latest release version of the docs by default, but then the docs would be missing the last 5 months of changes
[08:47:29] <seanh> But things are more stable now, I feel like there's less stuff like adding a whole new theming tutorial that would apply to already-released versions of CKAN happening, and it's mostly adding or changing features where the new docs don't apply to previous releases
[08:48:07] <seanh> Doesn't exactly encourage people to contribute to the docs though - send us a pull request, and if we merge it then it should appear in the docs in half a year's time
[08:57:56] <nigelb> I think we just missed this one.
[08:58:11] <nigelb> we should fix the docs to point out that for newer versions, it's different.
[08:59:31] <davidmiller> Maybe decrease time between realeases...
[09:00:35] <seanh> Believe me, we would love to
[09:01:30] <nigelb> I think people who deploy the software might not like it.
[09:01:48] <nigelb> because it might take them time to get appoval/review before they deploy.
[09:02:57] <seanh> That's not a question of how soon does the next release come out though, more a question of for how long is your release supported with patch releases (and can you jump several releases at once when you're finally ready to upgrade)
[09:05:03] <seanh> What do you think about commented-out config settings in the default config file template?
[09:05:14] <seanh> My feeling is they don't belong there, should be deleted from it
[09:05:44] <davidmiller> seanh: Shurely it depends what the comment says? ;)
[09:06:34] <seanh> Well, I'm busy templating the config file so that the make-config command accepts arguments for all the config settings, so you can change the default values that your config file is initially generated with
[09:06:55] <seanh> This is useful for scripts that automatically deploy CKAN, e.g. on Travis CI or for Docker
[09:07:56] <seanh> Trying to avoid people having to write shell scripts to hack the config file with sed and regular expressions
[09:08:05] <amercader> seanh: I would leave stuff like the storage path, which is something quite a lot of users will use. Other things like the feeds stuff I'd remove
[09:08:08] <seanh> Commented-out settings in the file don't really fit into this approach
[09:08:35] <nigelb> I will point out that solr is commented out.
[09:08:43] <nigelb> Don't remove it!
[09:09:06] <seanh> What happens if we just have "ckan.storage_path = " in the config file, not commented out? That would make it easy for the template to place a value there if make-config is given a value for the setting
[09:09:25] <nigelb> check the code for how that test is done.
[09:09:30] <seanh> The solr URL being commented out by default is a bit ridiculous
[09:09:32] <nigelb> whether it exists vs whether it has a value.
[09:09:56] <seanh> I've just uncommented the solr url
[09:09:57] <nigelb> unrelated question: How do I clean up revisions?
[09:10:10] <nigelb> do we have a single query to delete all the older revisions for resources?
[09:12:01] <seanh> The storage_path is actually commented-out, and with the wrong value
[11:03:11] <seanh> Dev meeting today anyone?
[11:03:18] <wardi> yeah
[11:04:00] <wardi> https://plus.google.com/hangouts/_/event/cb1vmkss426lkqicj94a3amvd1c?authuser=0&hl=en-GB
[11:06:04] <amercader> nigelb: can you make it? ^
[11:06:54] <nigelb> yep!
[11:07:00] <nigelb> sorry, stepped out to get meds at a bad time!
[11:29:01] <nigelb> #1833 is weeeeeird
[11:39:25] <travis-ci> [travis-ci] ckan/ckan support-env-vars-in-make-config 3126c71 http://travis-ci.org/ckan/ckan/builds/29403916 Sean Hammond: The build was broken.
[11:44:13] <nigelb> I've submitted a talk asking for people's biggest annoyance with ckan.
[11:44:21] <nigelb> perhaps it'll help us priorize issues.
[13:49:16] <shellac> does ckan have the equivalent of rails console? I'm trying to work out why our instance is slow, and poking around interactively would help
[14:08:01] <nigelb> shellac: not *really*
[14:08:05] <nigelb> but there is paster shell
[14:08:16] <nigelb> It's a paster thing rather than a ckan thing.
[14:08:27] <nigelb> If your instance is slow, it's either db or solr
[14:08:41] <wardi> or dictize
[14:09:36] <wardi> shellac: there are lots of actions that are so slow on our site that we limit or disable them. which things are you finding slow?
[14:10:21] <shellac> due to the size and structure of our data deposits we use multiple packages in a hierarchy
[14:10:51] <shellac> so we hit 'package_relationships_list' (?) rather hard. but then we cache the result
[14:12:21] <shellac> once cached all is well. but building the tree seems a bit slow
[14:13:19] <wardi> shellac: that's likely. there's no UI for package relationships so I expect not many people use them

2014-07-07
[18:01:48] <seanh> nickstenn: I think the problem with using Docker to run the tests on Travis might be slowness. docker build takes a very long time, apt-get installs a lot of packages
[18:02:46] <nickstenn> seanh: doesn't it install exactly as many packages as the current shell script?
[18:03:12] <seanh> It doesn't look like it, the apt-get install command is very different in any case
[18:03:33] <seanh> Is the docker container the same as the VM Travis gives us?
[18:04:07] <nickstenn> it's not identical, but I can't imagine it's terribly different
[18:04:13] <wardi> can we have an image with everything already apt-get-installed hosted somewhere that travis can download reliably from?
[18:04:35] <wardi> even better if the pip dependencies are there too
[18:04:42] <nickstenn> wardi: absolutely
[18:04:53] <wardi> then it should be much faster to run tests
[18:05:45] <seanh> Looks like the Travis VM comes with a lot of stuff pre-installed. wardi That sounds like a good idea
[18:06:09] <nickstenn> tbh, that could just be the ckan image, couldn't it?
[18:06:41] <seanh> I guess we can host our own Ubuntu base image in the docker registry, ckan/travis or something
[18:07:01] <nickstenn> and we could then explicitly re-run "pip install ..." to account for the case where requirements.txt has been updated and travis is running before the docker autobuilder has completed
[18:07:16] <nickstenn> seanh: why does it need its own special image?
[18:07:19] <seanh> The CKAN image? But we need to actually do the docker build on Travis, don't we?
[18:07:35] <nickstenn> do we?
[18:07:57] <seanh> If we want Travis to test changes to the Dockerfile, yes
[18:08:12] <nickstenn> well that's at odds with what wardi just suggested
[18:08:19] <nickstenn> and I also don't think it's necessary
[18:08:34] <nickstenn> the docker hub already automatically builds on pushes to master
[18:08:58] <nickstenn> yes it's not all beautifully hooked up so that the docker build has to have finished before travis kicks off
[18:09:22] <nickstenn> but the only thing I can see breaking is when you actually update binary deps (i.e. those you have to apt-get install)
[18:09:27] * wardi bets we'll still end up with fewer surious errors
[18:09:36] <seanh> I was thinking our own base image with everything we need apt-get updated and installed, then run our Dockerfile on top of that, so it only has to actually install CKAN
[18:09:46] <wardi> *spurious
[18:10:53] <seanh> My vagrant VM actually seems to have died, while it was trying to run docker build
[18:12:26] <seanh> I don't think we want to use an image with the pip dependencies pre-installed either, the requirements files are part of what we're testing as well
[18:13:03] <seanh> Although I understand that it kind of sucks that Travis has to download and install them all every time
[18:13:16] <wardi> seanh: it hugely sucks
[18:13:36] <wardi> seanh: and it seems to fail frequently
[18:14:49] <seanh> But breaking the pip requirements files  sucks too, and is all too easy to do
[18:15:03] <nickstenn> seanh: it's perfectly possible to do both
[18:15:24] <wardi> nickstenn had a good suggestion to run them anyway to just get updates
[18:15:36] <nickstenn> all it requires is about 5 lines of shell script to uninstall things that have been removed
[18:15:40] <nickstenn> and then just rerun pip install
[18:15:49] <nickstenn> if the versions have been updated, we get new versions
[18:15:55] <nickstenn> if not, then we get a speed boost
[18:16:59] <seanh> I'm dubious about that. Starting with a virtualenv with a load of stuff in it and then removing and installing stuff is different from starting with a pristeen virtualenv and then installing stuff. I'm not 100% that it'll always give the same results.
[18:17:04] <wardi> this image is also the perfect thing to develop on. "everything ckan needs except ckan"
[18:17:49] <seanh> If we have good requirements practices, always pinning to exact versions and always listing all direct and indirect deps, I think the risk is reduced, but that's hard to enforce
[18:18:45] <wardi> hash our requirements file and only use a base image named with that hash :-)
[18:20:06] <seanh> We've had some wicked issues in the past with people ending up with different virtualenvs in different places because of dependencies of dependencies, version conflicts, different starting points
[18:20:19] <seanh> Still maybe there's a compromise possible
[18:20:25] <seanh> Anyway gotta run for now

2014-07-06

2014-07-05

2014-07-04
[16:45:44] <rainbowalice> Hello :-)
[16:46:14] * wardi waves
[16:46:22] <rainbowalice> Where should I send a security report for ckan?
[16:46:47] <wardi> rainbowalice: security@ckan.org
[16:47:04] <rainbowalice> thanks! Couldn't find that on ckan.org, maybe I missed it!
[16:47:18] <wardi> rainbowalice: we probably forgot to publicise it
[16:58:32] <rainbowalice> \q

2014-07-03
[11:02:09] <morty> Is there a meeting today?
[11:02:36] <nigelb> yes
[11:02:44] <nigelb> I have to step away now though
[11:02:55] <nigelb> wardi, joet, seanh, amercader - meeting!
[11:03:38] <wardi> https://plus.google.com/hangouts/_/event/cb1vmkss426lkqicj94a3amvd1c?authuser=0&hl=en-GB
[11:05:21] <seanh> nigelb: wardi I can't make it today
[12:04:06] <wardi> seanh: no worries. i still found a pr for you to review
[12:04:16] <wardi> you're welcome
[13:34:03] <amercader> seanh: 2 questions about activity streams
[13:34:19] <amercader> 1. is there such a thing as a "global" activity stream where sysadmins can see all activities emitted
[13:34:43] <amercader> 2. is there a provided mechanism for deleting old activities?
[13:52:41] <seanh> amercader: There's no way to delete activities
[13:53:39] <seanh> I don't think there's any global activity stream either, although this would be easy to add, just an action function that pulls every row from the activity table, dictizes and returns them all (you'd want limiting and pagination though)
[13:54:04] <seanh> Do you really need to use activity streams for this EC audit thing? That seems like complicating it to me
[13:54:54] <amercader> seanh: yeah, I'm trying to have a look at the options
[14:24:43] <wardi> sure there's a global activity stream
[14:25:34] <wardi> oh, I'm thinking package_activity_list
[14:26:16] <amercader> wardi: that's hardly global :)
[14:26:37] <amercader> I meant across all datasets, orgs, etc
[14:26:44] <amercader> like the /revision page
[14:27:13] <wardi> amercader: tunnel vision. I only care about package changes at the moment
[14:32:27] <wardi> amercader: is nickstenn's +1 on the passlib pr good enough, or would you still like to review?
[15:03:26] <seanh> There was a proposal (long ago) to replace the /revision page with a global activity stream page actually
[15:03:39] <nigelb> to be honest
[15:03:44] * wardi supports that idea
[15:03:45] <nigelb> please don't.
[15:03:50] <nigelb> they are for different things.
[15:04:03] <nigelb> Or rather, that's how I look at them.
[15:04:12] <wardi> nigelb: if we put the actual changes in the activities then they aren't
[15:04:22] <seanh> There is also a proposal to merge the remaining revisions features into the activities..
[15:04:30] <nigelb> wardi: well, sometimes we want to turn off updates from a certain user.
[15:04:37] <nigelb> But I still want a way to know if that happened.
[15:04:59] <wardi> ok, why can't we filter activities?
[15:05:33] <nigelb> hmm.
[15:05:55] <nigelb> I can't think of any reason except we'd need to think of the UX carefully.
[15:08:00] <wardi> vdm needs to go away. in my mind the best thing to replace it would be before/after json dumps (or a reversible json-patch) of objects in the activity records
[15:10:54] <nigelb> wardi: Oh, I don't mean we need VDM.
[15:11:07] <nigelb> I was trying to say activity is different from changing the package object.
[15:11:39] <wardi> hmm. aren't our revisions heavily tied to vdm?
[15:12:35] <nigelb> they are, unfortunately.
[15:12:52] <nigelb> Again, I'm happy with destroying the implementations of revisions.
[15:13:08] <wardi> ok, so you're saying activites and revisions are conceptually different?
[15:13:32] <nigelb> I'm trying to say that, yes.
[15:14:02] <nigelb> "nigel was added as an admin" is part of activity stream
[15:14:08] <nigelb> but I don't see it being part of revisions.
[15:14:25] <wardi> hmm. but that changes an object in the db
[15:14:50] <nigelb> Hrm.
[15:14:57] <nigelb> maybe my idea is skewed.
[15:15:10] <nigelb> I will admit to not having thought this out properly.
[15:18:54] <wardi> we might not want to serialize the revision info for some activities: "wardi forgot and reset his password. again."
[15:19:20] <nigelb> I don't see this information being relevant for the user model.
[15:19:39] <nigelb> groups, packages, and orgs are what we need to get right.
[15:19:48] <nigelb> and that's where it'll be relevant.
[15:20:04] <wardi> what about group and org members?
[15:20:32] <nigelb> well, you made a good case above for it being part of the object.
[15:20:45] <nigelb> activities of group members relevant to the group/org.
[15:28:06] <nigelb> wardi: I think it comes down to UX.
[15:28:24] <nigelb> How can we do this merge of revisions and activity streams and not have it be dreadful.
[15:42:15] <wardi> it's a challenge
[15:43:06] <nigelb> Thinking like a developer, I would say, like git history, but non-devs are going to find that confusing.
[15:43:17] <nigelb> especially when "hey, I reverted this, why is it stil there!"
[15:44:40] <wardi> there's some of my ramblings in https://github.com/ckan/ideas-and-roadmap/issues/41
[15:45:10] <wardi> and https://github.com/ckan/ideas-and-roadmap/issues/45
[15:49:31] <nigelb> added a comment about my concern with UI.
[16:03:04] <amercader> wardi: re 1658 (passlib) if nick and you are happy, I'm happy. I'll add some minor comments
[16:05:45] <wardi> amercader: cool, you can assign it back to me and I'll follow up and merge
[16:06:15] <amercader> done

2014-07-02
[11:10:15] <amercader> seanh: did you mention recently that flash messages were getting lost when we redirect to the login page after a NotAuhtorized is raised?
[11:10:40] <seanh> All flash messages in CKAN have been getting lost for a year or two
[11:10:53] <seanh> I pushed a fix, not sure it it's in master yet
[11:11:59] <seanh> Oh wait, I remember actually someone else had already fixed it on master recently
[11:12:18] <amercader> seanh: you mean this? https://github.com/ckan/ckan/pull/1744
[11:12:52] <seanh> Yeah
[11:13:04] <amercader> that didn't fix it for me
[11:13:26] <amercader> they disappear from the session somehow
[11:14:06] <amercader> ok thanks, I'll keep looking, it was just to check if you had another fix
[11:14:17] <seanh> Hmm, is this when no one is logged in?
[11:14:37] <amercader> yeah, and trying to access a sysadmin only page
[11:15:21] <seanh> When I tried to add a (non-flash) item to the session, it seemed to be getting cleared on every page load when no one is logged in
[11:15:52] <amercader> I'll try with a normal user logged in
[11:16:02] <seanh> If the next response from CKAN is a redirect, then by the time do another request to follow the redirect the session has been cleared, flash messages with it?
[11:17:01] <amercader> might be something like that, it also doesn't work with a logged in user (flash message lost)
[11:17:29] <amercader> it's confusing because you get redirected to the login page but nowhere tells you "You were not auhtorized to do X"
[11:17:51] <seanh> Yeah
[11:17:58] <seanh> I suspect something is emptying out the session
[11:18:26] <amercader> so the session is per-page only?
[11:18:53] <seanh> I didn't look into it deeply, but it seemed that when no one is logged-in the session is per-request
[11:19:00] <seanh> My session item was disappearing, anyway
[12:57:40] <seanh> Anyone know why `git tag -l` would output nothing on Traivs?
[12:58:36] <seanh> We have this code as part of the Sphinx build: https://github.com/ckan/ckan/blob/add-sphinx-test/doc/conf.py#L163
[12:58:56] <seanh> The assert on line 169 is failing on Travis, and printing an empty list
[16:45:46] <seanh> Hmm, trying to figure out a better way to generate config files for automatic tools like Docker and Travis
[16:46:12] <seanh> I've made paster make-config read environment variables, which is fine for the dev/prod config file
[16:46:32] <seanh> But for the tests config file, I would need to get it to optionally choose a different template as well
[16:46:42] <seanh> Don't see how to get paster make-config to do that
[16:47:01] <seanh> We could add our own simple paster command, but it would have to be called something other than make-config
[16:47:35] <seanh> paster create-config-file?
[16:50:56] <wardi> if we're adding new things should we add them to the ckan command instead of as paster commands?
[16:51:27] <nigelb> paster is usually extendable.
[16:51:33] <nigelb> are we sure we can extend thta command?
[16:52:22] <seanh> The ckan command currently only exists in the package install, needs some work to bring it into core and make it work for source and docker installs
[16:52:33] <seanh> Maybe I should just do that now though
[16:53:00] <wardi> nigelb: but paster is one of those things tying us to python2
[16:53:02] <seanh> I don't see how to make paster make-config choose one template or another based on a command-line option
[16:53:26] <nigelb> wardi: is there a way to use pylons that does not involve paster?
[16:53:27] <seanh> We could certainly do it if we added our own paster create-config-file command and just removed paster make-config from all the docs
[16:53:45] <wardi> nigelb: pylons is one of those things too :-)
[16:53:50] <nigelb> Heh
[16:54:20] <nigelb> I'll also point out that jinja2 only has experimental python 3 support. Though, it will be more mature by the time we're ready (if ever) to switch.
[16:54:46] <wardi> it's easy to make a command that wraps calls to paster (and that thing should be the ckan command) then that is a step towards replacing those old unmaintained things underneath
[16:55:44] <nigelb> the ckan command makes assumptions on where you install ckan
[16:55:45] <wardi> and if we're writing something completely new that doesn't even need to run ckan (like a thing that generates config files) why not develop it in the ckan command?
[16:55:54] <nigelb> we need to fix that, I think.
[16:56:00] <seanh> Alright, maybe I'll drop this for now and have a go at a ckan command when I have a couple of days
[16:56:32] <seanh> wardi: What are your thoughts about how a ckan command should work? Add them to this issue if you want: https://github.com/ckan/ckan/pull/1828
[16:56:57] <wardi> seanh: please feel free to ignore my suggestions if they slow you down. we can improve things later too
[16:59:29] <wardi> I think the ckan command should be installed as a console_script from setup.py so it can always find where ckan is installed
[16:59:54] <wardi> and then the right one will be available if you have a bunch of ckans in virtualenvs
[17:02:24] <seanh> And we'll just use argparse?
[17:02:50] * wardi likes docopt
[17:03:50] <seanh> In the docker container CKAN is installed inside a virtualenv, so I guess the ckan command wouldn't be on the path unless the virtualenv was activated. We can just hack the path and prepend it though, or set it as docker's ENTRY_POINT or whatever
[17:04:29] <wardi> is there a reason we're using a virtualenv with docker?
[17:05:41] <seanh> To protect CKAN from the system packages, and for consistency with the source and package installs
[17:06:45] <seanh> We always create our empty virtualenv with site packages disabled and install exactly what we need into it. If we installed without a virtualenv, instead of a blank slate we'd be starting with whatever python packages Ubuntu has installed. Would we get the same result?
[17:07:13] <seanh> I guess another reason is it gives us separation if we want to change or upgrade the container's OS for some reason
[17:07:37] <seanh> So docopt is better than argparse?
[17:08:18] <wardi> docopt is awesome. argparse is a slightly improved optparse
[17:08:55] <wardi> it might be harder to delegate from a docopt program to an argparse one, though
[17:09:33] <wardi> so I'm thinking of breaking IDatasetForm a little more
[17:10:04] <wardi> I want a resource_form method
[17:12:16] <seanh> Would we need to delegate? There's not that many paster commands, it'd be tempting to just re-implement them all. Maybe for paster serve we'd have to call the original paster command
[17:12:40] <wardi> seanh: I'm cool with that
[17:13:26] <wardi> at a minimum we'd need to describe all the subcommands in the ckan command as well as in the paster-run code
[17:20:20] <seanh> It looks like we'd need all the CKAN commands that are currently implemented in CKAN itself
[17:20:41] <seanh> Plus paster serve and a paster make-config replacement
[17:20:42] <wardi> you wouldn't just pass their arguments and options through?
[17:20:46] <seanh> I think that's all?
[17:21:51] <seanh> I think I'd move all the commands in cli.py to be just functions in a lib somewhere, and re-implement their UIs
[17:22:09] <seanh> For paster serve, we should probably just pass-through
[17:23:33] <seanh> I dunno, that might take a while, maybe a simple wrapper for paster that just makes it easier to call and that lets us add new non-paster commands would be better
[20:14:18] <wardi> scheming dataset and resource forms are working \o/

2014-07-01

[00:11:59] <wardi> evening
[00:15:27] <nigelb> May have gotten up a little too early :)
[00:15:50] <wardi> you're excited about docker aren't you
[00:16:26] <nigelb> no comment :P
[00:17:44] <wardi> today (yesterday) was awesome. docker and two-stage dataset create got merged
[00:18:17] <nigelb> two-stage dataset too? hurrah!
[00:18:43] <wardi> oh yeah
[00:19:36] <wardi> I might have been too gentle on PackageController, it's likely there's more that can be simplified now
[00:20:00] <wardi> vitorbaptista mentioned fixing the state.startswith('draft') stuff
[00:22:44] <nigelb> I haven't looked at my bug list
[00:22:47] <nigelb> I've been backporting
[00:24:04] <wardi> the solr-cruft one is merged to master now
[00:34:32] <nigelb> oh good
[00:34:41] <nigelb> seems like a productive monday in ckan land
[07:05:24] <seanh> Did rparra ever figure out about the email notifications translations?
[07:05:41] <seanh> I'm sure I remember thinking about that at the time, but can't remember what I did about it
[07:06:06] <seanh> I suspect it uses whatever the site's default language is, since users in CKAN don't have any language setting in their user prefs
[08:51:55] * NOTICE: [freenode-info] if you're at a conference and other people are having trouble connecting, please mention it to staff: http://freenode.net/faq.shtml#gettinghelp
[09:42:39] <amercader> Can somebody quickly test something on IE for me?
[09:45:25] <amercader> less than 2 minutes or your money back *guaranteed*
[09:45:52] <joet> amercader, I can probably do so
[09:46:23] <amercader> joet: awesome
[09:46:24] <amercader> https://gist.github.com/amercader/dba4396c22e604b0ce8e
[09:46:32] <amercader> joet: ^
[09:46:46] <joet> can you paste on skype?
[09:51:42] <joet> ok amercader it seems to work fine on IE 11
[09:51:54] <joet> if you give me 10 minutes I have a machine downstairs which is still running windows xp
[09:52:23] <amercader> joet: there's no rush at all, if you can test it at some point that would be great
[10:58:39] <nigelb> dev meeting in 2 minutes
[10:58:48] <nigelb> http://pad.okfn.org/p/ckan-meeting
[10:59:04] <nigelb> https://plus.google.com/hangouts/_/event/cb1vmkss426lkqicj94a3amvd1c?authuser=0&hl=en-GB
[11:03:04] <joet_> nigelb, you're not in the meeting?
[11:40:21] <amercader> https://github.com/okfn/ckanext-queue
[12:24:51] <nigelb> joet_: took 5 minutes to get a connection stable enough for hangouts :P
[12:25:06] <joet_> lol
[14:23:21] <rossjones> I think 'following' is broken. Whilst you can follow an organisation via the API, if JS isn't working then master.ckan.org/group/follow/4e768617-0f1b-48ed-a092-6e516d525c56 fails :(
[14:26:26] <rossjones> https://github.com/ckan/ckan/issues/1821
[15:05:41] <rossjones> nigelb am I allowed to tag issues Good for contribution by myself or does it have to be through a team meeting?
[15:58:01] <rossjones> What's the email address for security disclosures?
[15:59:24] <rossjones> amercader?
[16:00:03] <amercader> rossjones: security@ckan.org
[16:00:14] <rossjones> Ta.
[16:36:38] <seanh> rossjones: pretty sure you can just go ahead and tag them
[16:42:19] <rossjones> :D
[16:43:12] <rossjones> Should have an easy tag too for when the fix is in the ticket ;)
[16:46:28] <nigelb> rossjones: you can do it
[18:26:22] <seanh> nickstenn: Have you started working on copying your config file jinja stuff from ckanexpress to core? If not maybe hold off on it, I think we should wrap it in a new paster command that the package and source installs can use as well, and simply stop using paster make-config

2014-06-30
[16:27:25] <wardi> anyone know what groups__0__id is abouve?
[16:27:30] <wardi> *about?
[16:28:44] <rossjones> something to do with the form?
[16:29:52] <wardi> it's a hidden value buried in the middle of the package form that gets set when there's a 'group' parameter passed to PackageController.new()
[16:31:23] <wardi> which I guess happens when you're viewing a group and you create a new package from there
[16:35:19] <wardi> I'm trying to rationalize this with my scheming extension.. where should this special field go? it being mixed in with the organization form field doesn't really help
[16:36:01] <rossjones> does it pass owner_org when it is an organization or still using group__0__id?
[16:39:12] <wardi> rossjones: the org seems to get passed as the group parameter
[16:40:28] <wardi> oh, I don't see a place to create datasets in the group pages, just the org pages
[16:40:53] <wardi> so 'group' and 'groups__0__id' is always an org id, I guess
[16:47:35] <rossjones> 1.x-ism I think.
[16:48:53] <wardi> so maybe there used to be a way to create a package from a group page
[16:51:02] <rparra> vitorbaptista_ hello, I know it's been a while but: did you ever figure out what was causing this error: https://lists.okfn.org/pipermail/ckan-dev/2013-November/006184.html
[16:51:28] <rparra> I seem to be having the same issue.
[16:57:17] <wardi> https://github.com/ckan/ckan/blob/master/ckan/templates/package/snippets/package_basic_fields.html#L62-L64
[16:57:57] <wardi> ^ I'm confused, how does this work and where does it get closed?
[16:58:39] <wardi> nevermind found it
[17:01:36] <vitorbaptista_> rparra: To be honest, I don't remember :/ I think I was able to solve it, but I'm not sure how
[17:02:01] <vitorbaptista_> rparra: If you're facing this on master, please create an issue
[17:03:45] <rparra> I'm on 2.2. I set up an hourly cronjob and just received the updates
[17:04:24] <rparra> So it seems to affect only the paster command. It's rather odd, but not that critical, at least
[17:05:36] <rparra> Perhaps something similar happened to you :) Thanks anyway
[17:06:26] <rossjones> rparra I'm guessing, but doesn't it require some form of auth?
[17:06:36] <vitorbaptista_> Sorry I couldn't be more helpful. I hate when I rely too much on my memory and end up forgetting stuff :/
[17:06:58] <rossjones> or does the post command automatically add it?
[17:07:44] <rparra> vitorbaptista_ no problem, happens to all of us.
[17:08:41] <rparra> rossjones I actually just copied the command from the cronjob defined here: http://docs.ckan.org/en/943-writing-extensions-tutorial/email-notifications.html#email-notifications
[17:09:35] <rparra> I am not sure about how it works but I just assumed that, since it is a local command, it somehow bypasses auth automagically
[17:10:47] <wardi> yes, but there's some sneaky code that replaces all the actions with wrappers that check if the function calls the auth method
[17:12:19] <vitorbaptista_> wardi: ... and there was a bug a few weeks ago where that code was raising exceptions when methods called with paster didn't call the auth functions. Might be related
[17:47:50] <rparra> can the strings at ckan/templates/activity_streams/activity_stream_email_notifications.text be translated? if they can be, how is the email language determined?
[18:06:39] <wardi> nope, they're in the database and mixed with text from datasets (i.e. terrible)
[18:08:56] <wardi> rparra: oh, sorry, I wasn thinking about the activity description text
[18:18:34] <rparra> wardi: the file I referenced seems to be i18n ready. I just wonder how the language is selected. I guess I'll try it out
[19:00:02] <rossjones> rparra if it makes you feel any better, my ckan is not sending notifications now either :(
[19:27:20] <travis-ci> [travis-ci] ckan/ckan 1764-solr-rubbish cdf8dfd http://travis-ci.org/ckan/ckan/builds/28804587 Ian Ward: The build was broken.
[19:28:46] <wardi> oh. I hope docker can fix our "solr didn't feel like starting on travis this time" issues
[19:31:04] <travis-ci> [travis-ci] ckan/ckan 1764-solr-rubbish cdf8dfd http://travis-ci.org/ckan/ckan/builds/28804587 Ian Ward: The build has errored.
[19:32:50] <wardi> it should fix our pip install errors...
[19:54:02] <travis-ci> [travis-ci] ckan/ckan 1764-solr-rubbish cdf8dfd http://travis-ci.org/ckan/ckan/builds/28804587 Ian Ward: The build was broken.
[20:15:59] <wardi> woohoo! fouth time's a charm
[23:59:19] <nigelb> morning

[09:53:10] <nigelb> seanh: I think I'm ready to merge the docker pull request in.
[09:53:19] <nigelb> It's not perfect, but we can shape it later.
[09:53:53] <seanh> nigelb: Alright with me, I got stuck on it not working cause of my docker version, will try again later. I think I will have lots of PRs against it but that's fine
[09:54:36] <nigelb> yeah
[09:54:49] <nigelb> I want the docker version mentioned.
[09:54:59] <nigelb> That's a stumbling block.
[09:55:04] <nigelb> Otherwise, it looks okay.
[09:57:09] <nigelb> Anyone fancy clicking the merge button on https://github.com/ckan/datapusher/pull/36
[11:02:32] <ntoll> hi
[11:02:41] <ntoll> email setup
[11:03:13] <seanh> nigelb: Why is that showing 5 commits?
[11:03:41] <nigelb> seanh: that's weird.
[11:03:47] <nigelb> Let me create a new pull request quickly.
[11:04:00] <ntoll> I'm able to connect to my SMTP server "manually". When I try to do so via CKAN (via a paster command for send_email_notification) I get errors. I've checked the credentials *several times* in my .ini file - they're correct. But I see the following error in the stack trace that's produced:
[11:04:06] <ntoll> Error - <type 'exceptions.Exception'>: Action function send_email_notifications did not call its auth function
[11:04:26] <ntoll> which, while I understand what it means in English, I have no idea wtf it means in a CKAN context
[11:04:42] <nigelb> I think that's a known CKAN bug. Let me check if we have a fix.
[11:05:13] <ntoll> aha: https://github.com/ckan/ckan/pull/1767
[11:05:18] <ntoll> right
[11:05:27] <nigelb> yup
[11:05:37] <nigelb> we'll be release ckan 2.2.1 soon
[11:05:42] <nigelb> and it should have the fix.
[11:05:46] <nigelb> (it doesn't yet)
[11:06:02] <ntoll> so I guess I need to wget the endpoint and avoid paster..?
[11:06:28] <ntoll> in which case, your instructions for how to set up the cron job for pushing emails are wrong/broken (just saying)
[11:07:21] <nigelb> agreed.
[11:07:25] <nigelb> Oh
[11:07:36] <ntoll> your instructions make use of paster
[11:07:37] <nigelb> ntoll: You mean, even after fixing the actual issue?
[11:07:46] <nigelb> Right, that's because we missed this bug.
[11:07:49] <ntoll> quite
[11:07:54] <ntoll> just saying :-)
[11:08:05] <nigelb> The true fix is backporting this fix into 2.2.1
[11:08:13] <nigelb> I'll even try to do it today.
[11:08:15] <ntoll> right
[11:08:29] <ntoll> but in the meantime I'll just have to wget/curl/whatever
[11:08:42] <nigelb> cheers
[11:08:48] <ntoll> np
[11:08:49] <ntoll> thanks
[11:10:08] <nigelb> seanh: https://github.com/ckan/datapusher/pull/38
[11:11:41] <seanh> nigelb: So does simply removing the OKF theme submodule make it use the default theme? Don't you have to change something in the sphinx conf file?
[11:12:21] <seanh> The files changed diff seems wrong on github
[11:13:42] <nigelb> seanh: apparently I can't get this right :)
[11:13:46] <nigelb> sigh :)
[11:32:50] <nigelb> seanh: I think I got this one right https://github.com/ckan/datapusher/pull/39
[11:32:52] <nigelb> :)
[11:38:17] <seanh> Merged
[11:42:41] <nigelb> thanks
[12:55:06] <seanh> Experimental Docker support for CKAN has been merged into master now: https://github.com/ckan/ckan/pull/1755
[12:55:40] <seanh> Issues have the Docker label https://github.com/ckan/ckan/issues?labels=Docker
[12:55:44] <seanh> Contributions welcome!
[12:58:09] <wardi> hopefully our whole meeting tomorrow won't be consumed by docker issues :-) I want to talk about json-patch and the package_patch api
[12:59:18] <rgrp> seanh: w00t!
[13:02:08] <seanh> I don't think the issues need much discussion, I just hope we have time to work on them, there's a fair bit to be done before the docker install can actually be used in either development or production
[13:03:04] <seanh> It's already the best/quickest/easiest/most-cross-platform way to install CKAN if you just want to try out CKAN, if you don't need the DataStore/DataPusher, but that's all it is at the moment
[13:06:19] <seanh> It does make zero-to-running-CKAN-on-port-80 into a one-liner (if you run the three commands together onto one copy-pastable line!) which is quite cool
[13:06:34] <wardi> indeed
[13:06:37] <seanh> Well, you need to install Docker first I guess, so not quite
[13:28:02] <seanh> nickstenn: Why does the Dockerfile install build-essential in the docker container? Is that needed to install/run CKAN?
[13:36:05] <nickstenn> seanh: it *was* needed to compile some of the stuff in requirements.txt
[13:36:32] <nickstenn> I wouldn't be willing to guarantee that it's still needed
[13:36:43] <wardi> psycopg2 possibly
[13:37:10] <nickstenn> wardi: ah, certainly psycopg2. does lxml end up installed?
[13:37:29] <wardi> it should be possible to use the packaged psycopg2
[13:37:33] <seanh> I guess that's one advantage of the package install: You build the package on a build server, then you only need the stuff to run CKAN on the production server
[13:38:06] <nickstenn> seanh: we can do that in the docker image too if we want just by removing those packages after build
[13:38:41] <seanh> So how can I get an interactive shell, in the docker container? Trying to docker run anything seems to give no such file or directory
[13:38:47] <nickstenn> its important to realise, though, that the main reason to be worried about having compilers on a server is at least partially mitigated by the fact that CKAN runs in its own container
[13:39:29] <seanh> Surely that just changes "my server has been compromised" to "my container has been compromised" which is basically the same thing
[13:39:30] <nickstenn> seanh: http://docs.ckan.org/en/latest/maintaining/installing/install-using-docker.html#running-maintenance-commands
[13:39:41] <nickstenn> seanh: it's not "basically the same thing"
[13:39:59] <nickstenn> your container doesn't have access to most of what's on your server
[13:41:19] <seanh> If all you're running on your server though is one CKAN site in a docker container, it's amounts to about the same thing doesn't it?
[13:41:38] <seanh> Anything else running on the same server has a level of protection, I understand
[13:43:13] <nickstenn> seanh: still not true
[13:43:24] <nickstenn> I can't see the sshd running on your server from within the container
[13:43:39] <nickstenn> i can't see /etc/shadow on your server from the container
[13:44:33] <nickstenn> I'm not saying containerisation saves you from all security worries (it *certainly* doesn't) but it's very likely to be better than not having it
[13:45:04] <seanh> Sure
[13:45:35] <nickstenn> if the question is "should we have build tools in the container" the answer is definitely "no"
[13:45:53] <nickstenn> but is it the end of the world? no
[13:46:39] <nickstenn> nigelb: did you get a chance to add the autobuilder to the docker hub?
[13:50:29] <seanh> Where does $DB_ENV_POSTGRESQL_DB come from? Are those the env vars created by the --link db:db?
[13:51:11] <nickstenn> seanh: correct
[13:58:35] <nigelb> nickstenn: no, I can do that now.
[14:01:53] <nigelb> nickstenn: done.
[14:03:23] <seanh> Uhoh, did github finally remove the ability to turn issues into pull requests? It's not working for me
[14:03:56] <wardi> seanh: I got an error but it still worked last time
[14:04:27] <wardi> people using duplicate and order-sensitive keys in json objects makes me sad
[14:04:29] <nigelb> They were going to remove it.
[14:04:43] <nigelb> I didn't even know json objects could be order sensitive.
[14:04:50] <nigelb> I thought of them like python dicts.
[14:05:41] <wardi> yup, in javascript they don't work either, but the json spec doesn't explicitly disallow it in json, so there are libraries that use it
[14:05:59] * nigelb facepalms
[14:06:24] <wardi> I want to be able to say "that
[14:06:45] <wardi> 's not json"
[14:13:47] <wardi> I want to use json-patch for the request to have only certain fields returned from our _show and _search apis
[14:14:37] <nickstenn> nigelb: \o/ (ty)
[14:26:02] <nickstenn> and ckan/tmp is now gone
[14:38:20] <wardi> denisz: rgrp was bugging me about letting #1679 sit, if you're wondering about the comment-storm
[14:45:58] <wardi> (I mean "bugging" in the nicest way, I had let it sit too long)

2014-06-29

2014-06-28

2014-06-27
[11:44:17] <mih> Hi! Could anyone tell me if CKAN version 1.8 is still provided with security updates (hotfixes)?
[12:24:45] <ntoll__> hi, what are valid values (and syntax) for ckan.email_notifications_since setting in the foo.ini file..?
[12:49:22] <seanh> ntoll__: http://docs.ckan.org/en/latest/maintaining/configuration.html#ckan-email-notifications-since
[12:49:56] <ntoll__> seanh, that should be linked from the maintainers docs... Google didn't return ^^^^
[12:50:13] <seanh> It is in the maintainers docs, dunno about google though
[12:50:17] <ntoll__> seanh, in the end I just looked at the source for string_to_timedelta ;-)
[12:50:41] <ntoll__> seanh, right... but not linked from the email notifications section I mean
[12:50:42] <seanh> Always the most reliable method anyway :)
[12:51:01] <seanh> Ah yes, that would be worth fixing in the docs, it should be cross-reffed
[12:51:11] <ntoll__> seanh, +1 :-)

2014-06-26
[21:19:08] <aj_> just one quick question
[21:20:30] <aj_> i was using ckanapi
[21:20:34] <aj_> and was trying to upload a file
[21:20:45] <aj_> but i keep getting ValidationError
[21:20:52] <aj_> which says there is a value missing in the url
[21:20:56] <aj_> and the url i am using is
[21:21:07] <aj_> http://localhost:5000/
[21:21:10] <aj_> just this much
[21:48:43] <wardi> ... we probably should fix that

[08:22:46] <travis-ci> [travis-ci] ckan/ckan release-v2.2.1 18eaeea http://travis-ci.org/ckan/ckan/builds/28478525 David Read: The build was broken.
[08:50:03] <nigelb> ah dang.
[10:57:51] <wardi> http://pad.okfn.org/p/ckan-meeting
[11:00:39] <wardi> https://plus.google.com/hangouts/_/event/cb1vmkss426lkqicj94a3amvd1c?authuser=0&hl=en-GB
[11:03:31] <wardi> nigelb: ^
[11:04:34] <wardi> vitorbaptista_: ^
[11:37:42] <joet> https://docs.python.org/3/library/unittest.mock.html#where-to-patch
[13:08:54] <davidmiller> rgrp: is https://github.com/ckan/extensions.ckan.org/blob/master/data/extensions-gh.csv the best current bet for a comprehensive listing of extensions?
[13:09:11] <rgrp> yes - just trying to make a proper site ...
[13:09:13] <rgrp> but yes ...
[13:09:17] <rgrp> want to keep adding to it ...
[13:09:26] <rossjones> Need to mark status for them, comments for example is WIP
[13:09:41] <rgrp> rossjones: i know - there is also a gdoc version which is editable ...
[13:09:45] <rossjones> and some may no longer run with recent versions
[13:10:07] <rgrp> davidmiller: see https://github.com/ckan/ideas-and-roadmap/issues/22
[13:10:09] <rossjones> where?
[13:10:26] <rossjones> inventory-template is php, and extremely DGU specific
[13:11:12] <rgrp> here's the gdoc editable version ... https://docs.google.com/a/okfn.org/spreadsheets/d/1izCpljO6Et7zLUKcUlB4BzsMZTurENp56Iqi9kXOtgs/edit
[13:11:27] <rgrp> rossjones: if you could add to that please do - plus new columns ...
[13:11:34] <rgrp> actually think we probably want to run off that ...
[13:13:58] <rgrp> rossjones / davidmiller if you wanted to help out there are some issues now here https://github.com/ckan/extensions.ckan.org/issues :-)
[13:20:22] <davidmiller> rgrp: The Google Doc already meets the criteria from your two user stories perfectly.
[13:20:47] * davidmiller <3 Less Code In The World.
[13:20:55] <rgrp> davidmiller: it does need to be kept up to date ...
[13:21:12] <rgrp> plus i don't think it is very findable - i don't think a google spreadsheet is great medium term esp for discoverability ...
[13:21:25] <rgrp> so i do think we probably want extnsions.ckan.org and super easy to implement (probably 1h)
[13:21:45] <rgrp> davidmiller: plus we do need to regularly trawl for new extensions ...
[13:22:07] <rgrp> but sure - this isn't bad and maybe extensions.ckan.org could just link to a gdoc to start with - that's a good home page pr ;-)
[13:24:27] <davidmiller> rgrp: Moar seriously, there are other places e.g. https://bitbucket.org/repo/all/relevance?name=ckanext
[15:49:41] <wardi> woo! I have ckanext-scheming with a really simple dataset schema actually sort of working
[15:50:02] <amln> wardi: :o)
[15:50:21] * amln hopes ckanext-plotting will follow, shortly
[15:51:02] <wardi> that is what -basiccharts should be renamed to
[15:52:29] <wardi> I wonder what ckanext-conniving could be
[15:53:06] <nigelb> wardi: I think we could rename searchhistory to that.
[15:53:14] <nigelb> considering it does tracking of what you're looking for ;-)
[15:53:45] <nigelb> I briefly considered calling it ckanext-nsa. "It only stores metadata about your searches!"
[15:55:33] <wardi> the harvester could be ckanext-colluding
[16:12:57] <amln> wardi: not to rehash a discussion, but I can't rename repos on GH/ckan
[16:48:50] <wardi> amln: oh, I wasn't serious about any of those :-)
[16:49:33] <wardi> amln: any of the core developers can rename things if you need
[16:50:13] <amln> i was being sarcastic ;)
[16:50:43] <wardi> good, good
[21:19:01] <aj_> hi guys

2014-06-25
[04:07:34] <subway_sandwich> hello folks.   i'm working with CKAN 2.2. whenever a data resource (XLS) is uploaded to the filestore, it is automatically pushed to the datastore. however, during the conversion of each column, the data type is guessed incorrectly. for instance, decimal numbers are converted to integers, thus removing all of the digits after the decimal point (.). the documentation says i could specify the field for each column, but that is o
[04:08:06] <subway_sandwich> is there any workaround to this problem? i really need to use the datastore.. so it must be pushed :(
[14:59:31] <travis-ci> [travis-ci] ckan/ckan master ffdd089 http://travis-ci.org/ckan/ckan/builds/28413457 amercader: The build was broken.
[15:19:48] <nickstenn> joet: don't suppose you've had a chance to look at https://github.com/ckan/ckan/pull/1786, have you?
[15:20:49] <joet> no i haven't though if dread is happy with it i've no objections with merging
[15:28:51] <joet> nickstenn, ^
[15:29:09] <nickstenn> cool, cheers :)

2014-06-24
[14:33:04] <seanh> If I set domain='' (param to Pylons set_cookie() method) then in Firefox it shows up as host localhost. I guess that's the default in the spec/browser. CKAN's session cookie is the same and it gets sent in the next request, but mine doesn't :(
[14:36:31] <seanh> Still no luk
[14:36:35] <nickstenn> seanh: but does that actually send a cookie without a domain?
[14:36:48] <seanh> nickstenn: Dunno
[14:36:56] <nickstenn> or does it just sent a cookie with "Domain="?
[14:37:15] <nickstenn> seanh: look at the Set-Cookie headers on the response in the developer tools
[14:37:33] <nickstenn> For cookies to localhost to work, you'll need to send a Set-Cookie header without a domain specified
[14:37:43] <nickstenn> as I said, I get three back from login_generic
[14:38:03] <nickstenn> only one of them gets set by the browser on the next request, and it's the one without a domain set
[14:38:44] <seanh> I'm gonna have to get going, will have to come back to this later. I can't believe it's so hard to set a cookie! Will look into exactly what's in the Set-Cookie headers next. Maybe I'll try falling back on the stdlib Cookie module as well
[14:54:23] <nickstenn> so, datapusher
[14:54:47] <nickstenn> should the default datapusher plugin config push data to the datapusher configuration by default on upload?
[14:55:23] <nickstenn> and if not, is there a button I can push or a setting I need to set to make that happen?
[14:55:44] * nickstenn is playing with datapusher in the same container as ckan
[14:56:50] <nickstenn> It seems to work, insofar as the "/dataset/<dataset_id>/resource_data/<resource_id>" route exists and works, and I can manually click the "Upload to DataStore" button, but it doesn't seem to happen by default.
[14:56:50] <amercader> nickstenn: if the datapusher is working, it shoudl automatically upload csvs and excel files to the datastore
[14:57:08] <amercader> there is a tab on the resource admin page to fire it manually as well
[14:57:20] <amercader> let me look for a link
[14:57:27] <nickstenn> amercader: okay -- any idea how I can debug the fact that it isn't happening automatically?
[15:00:12] <amercader> nickstenn: On the datapusher side I think there is a datapusher option for defining  a log file
[15:00:35] <amercader> on ckan I guess it's pdb somewhere around here https://github.com/ckan/ckan/blob/master/ckanext/datapusher/plugin.py#L93 :)
[15:01:18] <nickstenn> amercader: thank you -- I'll have a poke around
[15:08:52] <nickstenn> ugh. ckan-service-provider. ugh.
[15:09:49] <rossjones> nickstenn any thoughts on which queue you'd replace it with? is rabbitmq a necessity?
[15:10:27] <rossjones> I mean it's a lot of install just for this particular feature, especially if you're not using harvesting
[15:12:06] <nickstenn> rossjones: not sure if you got that last... either rabbit or redis, and I probably have a mild preference for the latter
[15:12:20] <rossjones> Cool.
[15:12:29] <rossjones> Can also abuse it for sessions :)
[15:12:36] <nickstenn> mild preference for redis as it's simpler to administer and can also be used as a kv cache
[15:12:40] <nickstenn> exactly :)
[15:12:46] <amercader> rossjones: harvesting != ckan-service-provider
[15:13:14] <amercader> also harvesting supports redis backend, which gives better results than rabbitmq
[15:13:17] <rossjones> amercader I know, but harvesting uses rabbit no? Was suggesting if you don't need rabbit (because you're not running harvesting) then it's a lot to install just for datapusher
[15:13:30] <rossjones> oh, didn't know it worked with redis.
[15:13:35] <amercader> I need to update the docs to recommend it rather than rabbitmq
[15:13:53] <rossjones> Actually I did know that, I switched the celery queues on DGU to use redis. Old age == forgetful
[15:13:53] <amercader> rossjones: you don't need rabbitmq for datapusher
[15:14:11] <rossjones> amercader I know, and I wouldn't want rabbit for datapusher (which is what I was asking)
[15:14:20] <amercader> all happy then!
[15:14:35] <rossjones> not really, don't want ckan-service-provider either :P
[15:14:41] <rossjones> but redis seems a nice compromise
[15:14:53] <wardi> http://aphyr.com/posts/283-call-me-maybe-redis
[15:15:15] <nickstenn> amercader: well except for the fact that (as I keep saying) we have a shit reimplementation of half of celery in the form of datapusher, with weird upside-down dependencies to ckan-service-provider
[15:15:37] <wardi> this guy kicks the snot out of pretty much every queueing system out there
[15:15:40] <rossjones> Also http://antirez.com/news/55
[15:15:40] <nickstenn> wardi: lol, do you want me to ask Kyle to evaluate datapusher's queue implementation?
[15:16:09] <wardi> nickstenn: touche
[15:16:52] <nickstenn> wardi: and it's also very important to note that Kyle was investigating redis's *distributed* queue feature, Sentinel
[15:16:56] <wardi> let's use smtp and procfiles for queueing
[15:17:17] <rossjones> smtp? +1
[15:17:26] <nickstenn> not the use of a single redis server and a redis LIST datastructure as a FIFO queue
[15:17:34] <wardi> nickstenn: so you like redis in a non-distributed set up?
[15:18:12] <nickstenn> there are many different ways of using redis in a distributed way, and not all of them require internode communication
[15:18:30] <nickstenn> (i.e. sentinel)
[15:19:10] <nickstenn> I will make one claim, which is that whatever the failure modes of single-node redis as a queue, the failure modes of whatever ad-hoc bullshit is in datapusher are worse.
[15:41:01] <seanh> Eww, in the Firefox dev tools all my cookies are run together in one string, with no separators. Like: Set-Cookie: mycookie=myvaluemyothercooker=myothervalue
[15:41:52] <seanh> That's weird, I don't see how the browser can tell where one cookie ends and another begins, but it might just be a Firefox dev tools thing...
[15:42:17] <nickstenn> that doesn't sound right
[15:42:32] <nickstenn> it *might* be a display issue, but I doubt it
[15:43:02] <seanh> But looking at the actual cookies in ff, I'm not seeing the name of the next cookie running into the value of the previous, so I'm thinking it's a display issue ... Let's try with just one cookie
[15:49:54] <nickstenn> amercader: still stuck on this datapusher stuff
[15:50:03] <nickstenn> how is "ckan.datapusher.formats" used, and how are the formats determined
[15:50:14] <nickstenn> there's nothing in the datapusher logs from an upload of a CSV
[15:50:52] <nickstenn> but I don't know whether I need to explicitly declare the format, or predefine some formats, or what
[15:51:24] <nickstenn> ahhhh
[15:51:34] <amercader> nickstenn: there are some default formats defined I think https://github.com/ckan/ckan/blob/master/ckanext/datapusher/plugin.py#L16
[15:51:35] <nickstenn> okay, so if I explicitly set the format in the format field it works
[15:51:58] <amercader> nickstenn: maybe some dodgy logic here:
[15:51:58] <amercader> https://github.com/ckan/ckan/blob/master/ckanext/datapusher/plugin.py#L84
[15:52:41] <nickstenn> that looks ok to me
[15:52:55] <nickstenn> I think what I was missing was that I had to explicitly declare the format when I uploaded the file
[15:53:16] <nickstenn> I didn't realise that CKAN doesn't sniff the filetype
[15:53:38] <rossjones> nickstenn the qa extension does, but it isn't inline.
[15:54:08] <nickstenn> okay, in which case, I now have a fully dockerised CKAN+datapusher, with sessions in the database
[15:54:09] <nickstenn> woop!
[16:06:10] <amln> not determining the filetype (on upload) annoys me, a bit too :o(
[16:08:12] <seanh> nickstenn: Well done
[16:13:11] <amercader> amln, nickstenn: the file type is guessed for resources, at least on uploads
[16:13:16] <amercader> not sure about lnks
[16:13:41] <amercader> ah, it's on master, not 2.2
[16:13:56] <amercader> https://github.com/ckan/ckan/pull/1350
[16:14:07] <seanh> So looking at the standard CKAN session cookie, the Set-Cookie header has path=/ and no host. But my cookie's Set-Cookie is exactly the same as far as I can tell, and the browser doesn't send it back on the next request :/
[16:14:52] <seanh> I remain baffled by this, and it doesn't seem to be CKAN/Pylons's fault since the Set-Cookie headers look exactly the same in Firefox dev tools but one cookie works and the other doesn't. This is just one of those days
[16:24:03] <seanh> Hmm, ok
[16:24:23] <seanh> When I load the login page there are actually many get requests of course, to get all the images etc
[16:24:39] <seanh> The initial get for the /user/login html contains my set-cookie
[16:24:52] <seanh> Further gets for images etc contain my cookie in the request -as it should be
[16:25:45] <seanh> Then at some point, there is a get for /en and the response to that contains a Set-Cookie for my cookie that sets it to an empty string??
[16:25:57] <seanh> Which has the effect of deleting it hence when I load another page, it's gone
[16:27:40] <seanh> But afaik it's not my code that is doing that - I only set the cookie in one place, and not to the empty string, and that line of code executes once during the whole page load not twice
[16:28:01] <seanh> When I said "it doesn't seem to be CKAN's fault", a part of me knew
[16:37:54] <seanh> My cookie was called "ckanext-oauth2waad-state". If I change its name to something that doesn't start with CKAN, it works. My cookie is now called "fuck_ckan". This cost me half day. I will find the line of code responsible for this...
[16:39:19] <seanh> Well, that didn't take long: https://github.com/ckan/ckan/blob/master/ckan/lib/base.py#L355
[16:40:17] <wardi> hmm. kind of like me learning yesterday that nose runs any method with "test" anywhere in the name, and then fails with a useless traceback..
[16:43:54] <seanh> Does CKAN by default create any cookies other than the "ckan" cookie? I didn't think it did, but that line of code specifically looks for cookies whose name starts with "ckan" but that are not the "ckan" cookie and deletes them
[16:45:11] <wardi> my namespace. mine! maybe there were some old auth cookies that the committer wanted to remove
[16:46:34] <seanh> https://github.com/ckan/ckan/commit/5a1734a4fed955deda27242f12e401806624852
[16:47:15] <wardi> at least there was a smiley
[16:47:57] <seanh> I don't know why it was, but it seems a really bad idea to delete all cookies that start with CKAN. If there were specific cookie names that you wanted to delete, maybe
[16:50:19] <seanh> Well, I guess I can implement my CSRF protection now, just stick the GUID in a cookie in the user's browser, no need for anything db side. Right now I need a drink though
[17:11:32] <nickstenn> seanh: fuck me that's horrible -- well found
[17:11:45] <nickstenn> if you can be bothered I'd strongly suggest a patch to remove that code
[17:22:55] <seanh> nickstenn: Don't worry, I will murder it
[17:23:31] <seanh> This is why I defend our conservative approach to code review, rather than a merge it quickly and deal with the consequences later
[17:24:08] <seanh> There used to be a time when I would run across an issue like this in CKAN that would cost me hours a few times a week, and not only in old legacy code but in new code that people were actually adding
[17:24:47] <seanh> That changed when we moved to github and put in a process of pull request, code review in the open on the pull request, and then merge, and we started being quite tough with each other on the code reviews
[17:25:06] <seanh> The difference between now and my first year or so working in CKAN, is like night and day
[17:25:39] <seanh> The number of times I swore to myself I would quit simply because working with this sort of code all the time was so infuriating
[17:26:13] <seanh> Nowadays, there are still lots of these things hiding in CKAN but you come across them every few weeks not every day, and I think few if any new ones are being added
[17:26:56] <nickstenn> seanh: that's fair enough, but that has to be tensioned against getting contributions from people outside the core development team
[17:27:03] <seanh> (Before github, the code review would be done in private with the reviewer on skype)
[17:27:18] <nickstenn> i.e. if they perceive conservatism as stubbornness, they'll go away
[17:27:44] <seanh> Also, that particular bug, came from a hacky branch of code that was only meant to be used on demo.ckan.org and then at some point got merged into master presumably with little or no review ... I doubt that would get in, today
[17:29:06] <seanh> There's a balance, I agree, but I also maintain that we've never had a pull request from a new contributor who's then gone away because we were too tough on the review. A couple of times with contributions that we seriously didn't want, but never with anything potentially beneficial as far as I know. We always try to be as encouraging as possible
[17:30:04] <seanh> I do think it's possible that the contributing guide in the docs puts people off (and we never hear about it) though - that thing has grown a little out of hand, it's too long
[17:34:18] <wardi> if people read it
[17:46:10] <seanh> True

[05:00:33] <subway_sandwich> hey guys. i'm working to get a custom form up in CKAN for a totally different need (not related to the packages, resources etc..). where should i start? I could create the form, but I dont know how to create the 'controller' class
[06:14:57] <subway_sandwich> sorry; d/ced earlier. if there were any replies, please re-paste for me please :)
[09:32:29] <seanh> Start with the IRoutes plugin interface
[09:32:43] <seanh> Setup some routes that go to the controller class from your extension
[09:33:41] <seanh> And your controller class itself should probably subclass ckan.plugins.toolkit.BaseController
[09:34:00] <seanh> This extension has some custom controllers for examples: https://github.com/ckan/ckanext-datapackager
[09:34:25] <seanh> Implementing CSRF protection in ckanext-oauth2waad is harder than I thought
[09:35:43] <seanh> We have to generate a GUID that goes in the URL params when we redirect the user's browser to the OAuth server, this GUID goes as a URL param in a "Login with OAuth" link on the login page (a new GUID is generated each time the page is loaded)
[09:36:12] <seanh> The user goes to the OAuth server, logs in, and the server redirects their browser to make a request to CKAN with the same GUID in the request params
[09:36:25] <seanh> And we have to check that the GUID we receive is the same as the one we send
[09:37:04] <seanh> THe problem is you can't just store the GUID in the session because once the browser goes to the auth server and then comes back to CKAN, it'll be a new session
[09:38:00] <seanh> So we have to store them somewhere else ... And also if many users visit the login page at the same time they'll generate many GUIDs and we have to store all the ones that haven't been used yet, and probably have to expire unused ones after a time
[09:38:12] <seanh> Basically we're gonna need a db table for this I think
[09:44:54] <rossjones> seanh csrf across servers seems a bit strange/pointless?
[09:50:37] <seanh> rossjones: It's part of the OAuth 2.0 spec. I don't have a great head for security issues to be honest but it did seem a bit silly to me
[09:51:33] <seanh> The point is, I guess, that some malicious website could generate links to our OAuth 2.0 redirect URI and trick users into clicking on them
[09:52:59] <seanh> If our redirect URI will only work if the request to it contains a GUID that we generated, then we know the user is coming to our request URI after clicking on a link from our website (they click on a link to the oauth server on our site with a guid in it, go to the OAuth server and login, server redirects them back to our site again with the same guid in the requeast)
[09:54:27] <seanh> It seems that if a man in the middle can sniff the guid in the first request then they can fake the second one. But that is "beyond the scope" of the OAuth 2.0 spec I think. They're both https requests though
[09:59:36] <seanh> The easiest way would be if I can store it in the browser instead of in the db. Set the GUId as a cookie in the user's browser, but a cookie that persists when they browse away from CKAN to the auth server then back to CKAN  (which Pylons session items don't by default). Also need to know that malicious websites can just store their own value in the same cookie
[10:08:21] <amercader> seanh: can't we store any more details than the current ones when creating the ckan user in ckanext-oaut2waad? There is nothing right now that links to the email used to login in the waad server
[10:08:43] <amercader> We only store fullname afaict
[10:09:14] <seanh> User name and full name are all (that's interesting) that we get back from the auth server
[10:09:39] <amercader> I see, the oid thing is from waad
[10:09:56] <seanh> Maybe we can make another request to the platform API itself to get more details about the user? But that would be separate from the auth server
[10:10:15] <seanh> Yeah WAAD actually sends several unique IDs for each user, the OID seemed like the best choice
[10:10:26] <amln> WAAD only knows about username / password. the email addresses etc are in Metadata Services API
[10:10:48] <amercader> seanh: the email would be quite handy, as this is the actual user name on the platform
[10:10:53] <amln> s/are in/are exposed via/
[10:11:27] <seanh> Right, so getting more user info from Metadata Services API into CKAN is a separate feature, imo. Not sure if we'd implement that in ckanext-oauth2waad or elsewhere, it's not really a waad thing I think
[10:11:46] <amercader> seanh: no, it's a project thing
[10:12:29] <seanh> CKAN actually requires user accounts to have emails which is a problem because the WAAD server doesn't give us emails. Currently I'm setting each user's email address to "foo"!
[10:12:31] <amln> It won't be so portable. AFAICT, WAAD only stores username/password.
[10:13:33] <seanh> But a real fix would be to make CKAN accept user accounts without emails, either by a CKAN core change or by overriding the validator functions from our extension. Not sure if anything in CKAN would break if it hit a user with no value for their email address
[10:14:58] <amln> as part of the login process, for Glasgow, we should be (a) hitting WAAD for U+P, (b) hitting metadata/identity services API for the profile info (including organizations), caching those in CKAN's usual place, bingo.
[10:15:05] <amln> let me find the diagram we drew...
[10:15:46] <amercader> seanh: we still want emails for this users, we'll just hopefully gt them from the metadata api on user creation time,
[10:16:04] <amercader> anyway, this is probably for #commercial
[10:16:08] <amercader> :)
[10:17:36] <seanh> amercader: But ckanext-oauth2waad is creating the users, and we don't want to tie ckanext-oauth2waad to the Metadata API. So the oauth2waad needs to provide some sort of hook that a Metadata API plugin can hook into to get the email address and insert it into the user that we're going to create?
[10:18:02] <amercader> seanh: custom user_create on the project extension that wraps the core one
[10:18:40] <seanh> I suppose that would work, yeah
[10:19:21] <seanh> It needs to somehow know when you're creating a WAAD user vs when you're just creating a normal user, but otherwise it should work fine
[10:19:52] <amercader> "if you have a weird name and foo for email it's a waad user" :)
[10:20:15] <amercader> we will disallow ckan user creation anyway eventually
[10:25:25] <nigelb> FYI: I'm probably going to miss the dev meeting.
[10:25:38] <amercader> nigelb: have some rest!
[10:25:39] <amln> somewhere there's a user story about CKAN creating accounts against the WAAD. I think it may be I4.
[10:58:59] <wardi> http://pad.okfn.org/p/ckan-meeting
[10:59:14] <wardi> https://plus.google.com/hangouts/_/event/cb1vmkss426lkqicj94a3amvd1c?authuser=0&hl=en-GB
[10:59:35] <amercader> good lord I need a haircut
[11:55:01] <nickstenn> so I'm not entirely convinced by the SQL that set-permissions uses to set permissions for the datastore database
[11:55:56] <nickstenn> i just created a new database, and three new users (ckan, datastore, datastore_ro) in a blank postgres instance
[11:56:03] <nickstenn> I then ran the set-permissions sql (manually)
[11:56:11] <nickstenn> Then ran "paster db init"
[11:56:20] <nickstenn> and I'm getting the following when trying to upload a dataset:
[11:56:22] <nickstenn> ProgrammingError: (ProgrammingError) permission denied for relation _table_metadata
[11:56:22] <nickstenn> 'SELECT 1 FROM "_table_metadata" WHERE name = %s AND alias_of IS NULL' (u'e3ae13f3-70a1-4b4f-958d-263755f17cd8',)
[11:56:34] <nickstenn> And indeed, if I look at the permissions on that view:
[11:56:56] <nickstenn> public | _table_metadata | view |                   |
[11:57:14] <nickstenn> which is bloody weird
[11:57:30] <nickstenn> because the view was created by the datastore user:
[11:57:41] <nickstenn> ckan_datastore=# \dv
[11:57:41] <nickstenn> List of relations
[11:57:41] <nickstenn> Schema |      Name       | Type |   Owner
[11:57:41] <nickstenn> --------+-----------------+------+-----------
[11:57:42] <nickstenn> public | _table_metadata | view | datastore
[11:57:47] <rossjones> nickstenn did you check the sql? last time I saw one it was a template
[11:58:03] <nickstenn> rossjones: I'm currently trying to work out if it does the right thing
[11:58:35] <nickstenn> ALTER DEFAULT PRIVILEGES FOR USER "datastore" IN SCHEMA public
[11:58:35] <nickstenn> GRANT SELECT ON TABLES TO "datastore_ro";
[11:58:51] <nickstenn> ^^ this line should ensure that that view has read permissions for the datastore_ro user
[11:59:01] <nickstenn> but apparently it hadn't taken effect when the view was created
[11:59:28] <nickstenn> which clearly means I'm missing something, because I ran the set-permissions SQL before I ran db init...
[12:07:23] <nickstenn> this doesn't make any sense at all :(
[12:09:59] <nickstenn> ahhhhhh, hang on a minute
[12:10:37] <nickstenn> ALTER DEFAULT PRIVILEGES appears to apply to a particular database implicitly
[12:15:16] <nickstenn> hooray!
[12:15:34] <nickstenn> so that script has to be run while connected to the datastore database, not the main ckan database.
[12:33:46] <seanh> It looks like CKAN (or maybe Pylons) clears the Beaker session on each request when no one's logged-in
[12:34:23] <seanh> And when used in a WSGI app Beaker's WSGI middleware creates a single session object and inserts it into the wsgi env - so there's only one beaker session
[12:34:52] <seanh> So if you want a persistent cookie for browsers that are not logged-in, you can't use the beaker/pylons session
[13:00:14] <wardi> nickstenn: re drunkenly rewriting cli.py, I'm happy to buy you beer for the cause
[13:50:45] <seanh> Sigh, still just trying to set a cookie and get it back in the next request. The pylons.response object has .signed_cookie() and .set_cookie() methods, but even though I use them and I can see the cookie in my browser with the right domain, path='/' and an expires time in the future, the browser doesn't send the cookie back in the next request
[14:23:31] <nickstenn> seanh: is the cookie marked secure?
[14:23:37] <seanh> Yep
[14:23:48] <nickstenn> are you connecting over TLS?
[14:23:53] <seanh> I'm wondering if it's to do with CKAN running on port 5000?
[14:23:57] <seanh> Yeah
[14:24:09] <seanh> I an mark the cookie as secure or not, doesn't help
[14:24:12] <nickstenn> You are? Huh. No idea, then.
[14:24:23] <seanh> Yeah I'm kind of stumped as well
[14:24:42] <seanh> Gonna try running CKAN on localhost port 80 and see if that changes anything
[14:25:10] <nickstenn> seanh: port 80?
[14:25:20] <nickstenn> are you sure you're connecting over TLS...
[14:25:28] <seanh> Yeah
[14:25:36] <nickstenn> in theory at least, cookies aren't bound to ports
[14:25:39] <seanh> Actually I doubt the port is gonna help
[14:25:55] <nickstenn> and a cookie should (or could, at least) be sent to any port on a given domain
[14:26:12] <nickstenn> it's not an IP vs domain thing?
[14:26:31] <seanh> It seems to be that Firefox doesn't obey the path setting in the cookie, it sends each cookie back in the next request *if* it's a request for the same page, but a request for any other page doesn't contain the cookie, regardless of the cookie's path
[14:26:46] <seanh> You mean 127.0.0.1 vs localhost? I've tried it both ways
[14:26:47] <nickstenn> seanh: that sounds like the cookie just isn't being stored
[14:27:06] <nickstenn> ahhh
[14:27:06] <seanh> If I go to browse my cookies in Firefox, it's there, and with all the right settings
[14:27:25] <nickstenn> iirc setting domain on localhost cookies doesn't work
[14:27:37] <seanh> But if I look at the next http request in Firefox, no cookie in the headers
[14:27:40] <seanh> Hmm
[14:27:53] <nickstenn> either don't set the domain, or add an entry to /etc/hosts with at least two dots in
[14:28:01] <nickstenn> and use that as your domain
[14:28:15] <seanh> Can I just use 127.0.0.1?
[14:28:26] <seanh> Ok, I'll try an empty domain in the cookie for now...
[14:28:41] <nickstenn> seanh: see http://curl.haxx.se/rfc/cookie_spec.html and search for "domains must have at least"
[14:29:04] <seanh> But then how come CKAN's normal session cookie works?
[14:30:08] <nickstenn> good question
[14:32:39] <nickstenn> when I log in locally, I get three Set-Cookies from login_generic
[14:32:42] <nickstenn> one without a domain
[14:32:47] <nickstenn> one with a domain of localhost:5000
[14:32:54] <nickstenn> and one with a domain of .localhost:5000

2014-06-23
[12:41:07] <SkramX> I want to add a newsletter and SMS notifications (based on the data whereas newsletters would be like  blog posts) related to my CKAN instance. Any suggestions? Would be awesome to do it all the user management in CKAN but I'm not sure if that's more viable than adding this to WordPress
[12:50:15] <amln> SkramX: an extension that hits Mailchimp/Sendy/Twilio APIs, maybe?
[12:50:42] <SkramX> right.. im trying to decide if i should be extending CKAN or maybe instead extending Wordpress/whatever blog we choose
[12:51:30] <SkramX> wondering if anyone had something like that that already existed
[13:40:47] <seanh> SkramX: ckanext-pages gives you a blog inside CKAN
[13:40:52] <seanh> Not SMS notifications though
[13:41:03] <SkramX> yeah
[13:41:31] <SkramX> the researchers im working will see ckanext-pages and want so much more it makes sense to have a separate blog
[13:41:33] <SkramX> appreciate it though!
[13:41:36] <seanh> There is an email notifications feature in CKAN, where you can get an email when there's new activities on your dashboard, a plugin could potentially add SMS notifications to that
[13:42:02] <seanh> It could also just be an API client that sends out SMS messages
[13:42:04] <SkramX> interesting
[13:42:10] <SkramX> the SMS will be based on datastore-data
[13:42:39] <SkramX> so i could maybe extend the activities to include those notifications and then add SMS
[13:42:57] <SkramX> can user accounts have additional metadata such as user location? i want to only notify them based on their location
[13:43:09] <SkramX> this is all about air quality so obviously they only care about air quality near them
[13:43:28] <wardi> amercader: were you working on user extras? ^
[13:50:53] <wardi> is solr on travis just broken now?
[13:51:10] <wardi> (did they change their base image again?)
[13:58:34] <wardi> oh. what happened to our coverage
[14:02:48] <amercader> wardi: not yet, we may need it for a current project soon though
[14:03:12] <amercader> wardi: what's wrong with the tests? random solr connection issues
[14:03:13] <amercader> ?
[15:07:38] <wardi> amercader: I thought they became less random, but no, just the usual occasional failures
[15:17:05] <seanh> wardi: What's the status with CKAN and scaling these days? I remember it was having problems around about the hundreds of thousands of datasets scale, with adding new datasets getting too slow and also certain pages loading too slow, but can't remember what become of it
[15:17:53] <seanh> amercader: What happens if you try to use the CKAN harvester to harvest from CKAN sites that have different custom schemas? Does it just pull in the basic metadata and basically ignore extras and custom fields?
[15:18:34] <wardi> seanh: with the new db indexes it works well enough for us with 180k datasets.. but we don't use the user dashboard (I think those are one of the remainaing trouble spots) and probably a few other core pages
[15:19:09] <wardi> we also disable 20 or so actions because they're too slow for us
[15:21:44] <SkramX> wardi: just curious, who is "we"?
[15:21:52] <seanh> But you're not using any patches on top of ckan core anymore, to get acceptable performance with 180k?
[15:22:06] <seanh> I imagine to get it working with millions, would still be quite a task
[15:22:26] <wardi> SkramX: data.gc.ca
[15:22:42] <SkramX> cool
[15:23:06] <wardi> seanh: I've pushed all our performance-related stuff to core
[15:23:45] <amercader> seanh: the current implementation of the ckan harvester queries the old rest api, which does not support custom schemas anyway. The plan is to refactor it to use v3 (to support filtering, etc). In this case I guess we will use the "_validated_data_dict" =  False or similar that wardi added a while back, to get all custom fields as extras
[15:24:25] <SkramX> what's the status on user extras (for the UI and DB, not for harvesting)
[15:24:25] <wardi> seanh: internally we're building a much larger ckan instance, so hopefully we'll have more performance fixes to contribute too
[15:24:51] <seanh> amercader: I guessed it was something like that. So you can harvest from hundreds of different ckan sites even though they all have customizations, and you'll get something vaguely sensible out of them
[15:25:13] <seanh> wardi: Cool, what kind of scale?
[15:25:37] <seanh> I think scaling CKAN to millions of datasets or more would be pretty interesting technically, probably a big task though
[15:27:22] <amln> seanh: http://tla.mpi.nl/tla-news/ckan-tested-2-million-datasets/ may be of interst
[15:27:25] <amln> +e
[15:27:45] <wardi> seanh: they have about 60k datasets but each one has ~100 fields, some of them very large, and it's just growing from there
[15:27:53] <amln> that's the most recent thing I've seen
[15:28:03] <wardi> but I'm not working directly on that project, so I don't know that much about it
[15:29:19] <seanh> thanks
[15:30:20] <seanh> Hmm, I wish they had info about how different CKAN features perform with two million datasets, not just how long it takes to import them
[15:31:30] <seanh> Two weeks just to import two million into the db makes it hard to experiment with this stuff, and if the import time is still non-linear then playing with tens or hundreds of millions is just impractical even to test
[15:32:36] <amln> seanh: ask for more info?
[15:33:10] <wardi> if they did test the rest of ckan they would switch their answer back to "No"
[15:38:26] <joet> it'd be nice to know if they ran test searches and stuff. Be nice to know how the current solr setup holdsu p
[15:38:40] <wardi> solr doesn't have any problems
[15:39:17] <wardi> it's all the other (often unnecessary) stuff we're doing in the action functions
[15:41:07] <seanh> I remember people also alluding to some fundamental problems in the model/database design
[15:41:18] <seanh> And I guess revisions are probably a problem
[15:44:22] <wardi> very much so
[15:50:43] <rossjones> I think I am going mad.  If I modify default_resource_schema() it starts failing because 'created' is a datetime and can't be serialized.  Anyone seen that before?
[15:54:42] <wardi> rossjones: hmm. isn't default_resource_schema used in a few placed in different ways?
[15:55:45] <rossjones> used for show and update as far as I can tell.
[15:56:04] <rossjones> Doesn't help you can add random things to the html and it'll get auto-added as extras without your validators running :(
[15:56:17] * rossjones spent an hour looking at why his validators weren't running.
[15:58:45] <wardi> rossjones: the dataset validators still get run. maybe add something in one of the magic ones like __before
[15:59:01] <rossjones> I forgot to do the schema['resources'] = resource_schema
[15:59:02] <rossjones> :(
[15:59:13] <wardi> or remove the thing that automatically accepts the extras in resources
[15:59:16] <rossjones> Now I have, it dies
[15:59:36] <rossjones> when it tries to index the package :(
[16:00:23] <rossjones> or rather when it tries to dump validated_pkg_dict as json
[16:01:34] <wardi> hmm. does the api controller customize the json dump to support datetimes?
[16:01:40] <wardi> if so that code should too
[16:04:50] <rossjones> Weirdly, it is the MissingNullEncoder which causes the problem with a datetime being given to it.
[16:08:27] <rossjones> Needs an if instance(obj, datetime.datetime): return obj.isoformat() - fixed it for me.  building a repro for test will be a pain :(
[16:08:48] <rossjones> I'll log a ticket, but I'm gonna have to go with a monkeypatch for now :(
[16:13:59] <joet> rossjones, check which json library you are using
[16:14:07] <joet> json and simplejson don't like each other at times
[16:14:39] <joet> it could be somewhere in the code, the two have got mixed together
[16:17:30] <rossjones> joet don't think either of them will serialise a datetime will they? Think it's more likely that: a. I've done something stupid, b. there's a bug in the validation
[16:17:40] <rossjones> in that order probably
[16:21:19] <joet> sorry missread, thought you had an error from json encoding the Missing object
[16:21:40] <rossjones> :D
[18:49:28] <wardi> SkramX: no, but that sounds useful :-)
[18:49:45] <SkramX> :)
[19:10:59] <wardi> "soon we will" https://github.com/ckan/ckan/commit/3e7f6900#diff-ff0f992e623eb10f5f87fe4684ed15cdR8

2014-06-22
[16:07:46] <SkramX> rgrp: check out modeanalytics.com - looks like they are doing something similar to ckan explorer but having nothing to do with CKAN
[16:08:24] <rgrp> SkramX: actually i've chatted quite a bit with them a few months ago re Data packages, json table schema and the like so we know about it ...
[16:08:34] <SkramX> ah okay - just making sure
[16:09:03] <rgrp> SkramX: but thanks for the pointer :-)
[16:09:07] <SkramX> it's also very similar to my "fork" of your ckan-explorer at louisvilleairmap.com/wizard
[16:09:56] <rgrp> SkramX: wow that is looking nice :-)
[16:10:15] <SkramX> thanks. its all open source! dirty code modifications off of your ckan-explorer and more!
[16:10:35] <SkramX> i need to figure out a way to make querying friendly for non-SQL people but i think i want to ultimately keep it using SQL as it is the most robust way to query
[16:10:45] <rgrp> SkramX: what you really want right is to be able to save the "views" config you create back into ckan somehow (i.e. you want to save the query plus visual config ...)
[16:11:00] <SkramX> yeah
[16:11:01] <rgrp> SkramX: it would be pretty easy to create a query builder there using some basic stuff
[16:11:11] <SkramX> for where statements, yes
[16:11:20] <rgrp> SkramX: you would be interested in https://github.com/ckan/ideas-and-roadmap/issues/7
[16:11:21] <SkramX> when i start to think about group by and stuff my head starts to hurt
[16:11:28] <SkramX> yes - very
[16:11:35] <rgrp> SkramX: it would be really easy really to save stuff via a ckan extension ...
[16:11:37] <SkramX> but since i am not CKAN-savvy still i am building this outside of it
[16:11:43] <SkramX> :\
[16:11:58] <SkramX> for example, when you query and go to a different multiview view, it updates the URL hash and you can go back to it or even embed it
[16:12:00] <rgrp> SkramX: right but you'll need to persist the view config somewhere right ...
[16:12:12] <SkramX> right - ckan would be a good place to do that
[16:12:17] <rgrp> SkramX: ah ok - you're persisting into the view config - i did that originally with ckan data views ...
[16:12:26] <SkramX> right now the view config is a hacky use of URL params :-\
[16:12:42] <rgrp> not a bad a approach though it can get a bit painful and it would be nice to e.g. list views people have created ...
[16:12:52] <SkramX> yeah
[16:13:00] <SkramX> well for now we can have a list of URLs
[16:13:02] <SkramX> https://github.com/marks/airqualityegg.com/blob/data-viz-wizard/public/assets/js/wizard.js is the code
[16:13:20] <SkramX> this is all very MVP / let's get some basic functionality together to have something to show
[16:14:25] <rgrp> SkramX: definitely the right approach
[16:14:36] <SkramX> i figured ckan views were being rapidly developed by others and i needed something to show *now* so I'm hacking this up. If others can use it awesome but you all will probably come up with something way better and ill adopt it and add the features i need on top
[16:14:52] <rgrp> i'll think some more - but please do add a +1 on https://github.com/ckan/ideas-and-roadmap/issues/7 and maybe mention your use case for it
[16:15:01] <SkramX> will do!
[16:15:18] <SkramX> btw - have you seen the ckanext-odata? I am super excited about that -- letting people use Tableau to access CKAN data
[16:21:10] <SkramX> completely personal opinion: I am underwhelmed by Mode so far. Basically CKAN datastore + your ckan-explorer, rgrp
[16:23:35] <SkramX> yikes! I just did a catalog query and got a list of all their current user's tables.
[16:48:50] <rgrp> SkramX: yes i have seen ckanext-odata and very happy about it :-)
[16:49:05] <SkramX> :)
[16:49:36] <SkramX> ill be contributing more to it but we fixed something (yay collaboration) to make it work correctly Tableau.
[16:49:49] <rgrp> which also reminds me that i need to move forward https://github.com/ckan/ideas-and-roadmap/issues/22
[16:51:01] <SkramX> very nice
[17:00:31] <SkramX> rgrp: fyi, I just added ckanext-odata since I didnt see it on that list. didnt touch columns I wasn't quite sure about :)
[17:00:54] <rgrp> perfect - atm it sort of gets auto-generated but that is perfect ...
[17:01:38] <SkramX> if you need help going through to test or better document them, let me know. we're benefitting from CKAN and trying to contribute back but happy to do so in other ways too
[17:01:45] <SkramX> just putting that out there
[17:02:18] <rgrp> SkramX: that would be really useful - give me a mo - i'm just booting a repo for the extensions stuff right now which will have the plan more clearly
[17:03:40] <SkramX> sure thing - ill be back in a bit. lunchtime here in USA

2014-06-21

2014-06-20

[07:36:19] <rossjones> Anyone any idea what happened to the old python lib for using the ckan api? I can find github.com/ckan/ckanapi but this is wardi's version.
[07:37:19] <rossjones> https://github.com/okfn/ckanclient-deprecated
[08:19:14] <clemi> hey guys
[08:19:29] <clemi> i'm trying to upload a large resource file into my CKAN v2.2
[08:20:06] <clemi> of about 140mb. i've tried adding and changing the ckan.max_resource_size and ckan.storage.max_content_length variables in production.ini, and restarting the server
[08:20:28] <clemi> however it still doesn't accept the 140mb file, giving a 413 error: request entity too large
[08:20:57] <clemi> what should i do?
[08:46:11] <clemi> oh im also hosting through nginx
[08:53:11] <morty> clemi: try setting client_max_body_size 500M;
[08:54:23] <clemi> thanks! i've found that the problem is with that ngix and not CKAN
[08:58:14] <clemi> i've added it under the http scope .. http {... client_max_body_size 500M;  ..}
[08:58:29] <clemi> reloaded the nginx service
[08:58:32] <clemi> but to no avail
[08:58:33] <clemi> :(
[09:03:57] <amercader> clemi: this suggests putting it under server { ... }
[09:03:57] <amercader> http://docs.ckan.org/en/latest/maintaining/installing/deployment.html#create-the-nginx-config-file
[09:13:19] <clemi> got it! thanks so much for your help.
[09:18:28] <amercader> clemi: glad you got it working
[09:19:35] <clemi> :)
[09:35:00] <amercader> nigelb (and seanh, wardi, etc): I've been collecting tips and guidelines for managing releases branches here:
[09:35:01] <amercader> https://github.com/ckan/ckan/wiki/Release-branches-tips-and-tricks
[09:35:26] <amercader> in case I got hit by the proverbial bus ...
[10:14:08] <nickstenn> aaaaargh
[10:14:25] <nickstenn> why does subclassing CkanCommand and loading the config file try and connect to the sodding database?
[10:15:45] <nickstenn> oh wow
[10:16:01] <nickstenn> and now I've discovered that we parse the database url with a regex in ckan.lib.cli
[10:16:03] <nickstenn> hooray
[10:16:11] <wardi> nickstenn: is it that adorable 'oh have we created a site user yet?' bit of code?
[10:16:37] <nickstenn> wardi: yes
[10:16:48] <wardi> please kill it
[10:16:49] <nickstenn> exactly
[10:17:01] <nickstenn> I don't think I understand what it's doing or what uses it
[10:17:31] <wardi> it's making a special admin account at the wrong time
[10:18:22] <nickstenn> wardi: and you reckon that none of the extant commands depend on it?
[10:18:58] <wardi> no, i reckon we should create the site user as part of setting up the db
[10:19:24] <wardi> instead of checking for it just before running a command..
[10:19:56] <nickstenn> right, so it should just move into initdb?
[10:20:30] <wardi> maybe. i haven't visited that part of the code yet
[10:20:34] <nickstenn> ok
[10:20:35] <nickstenn> cheers
[10:24:06] <seanh> Damn, it seems I can't do a flash message from the login() method of my IAuthenticator plugin?
[10:24:25] <seanh> I can call helpers.flash_error() but nothing happens
[10:25:13] <nickstenn> so the real culprit for connecting to the database when just initializing the pylons app appears to be deep within a plugin somewhere
[10:25:18] <nickstenn> i'm going to ignore that for now
[10:30:27] <rossjones> nickstenn worth a ticket so it doesn't get forgotten?
[10:30:48] <nickstenn> rossjones: good call
[10:31:39] <rossjones> You don't fancy having a go at https://github.com/ckan/ideas-and-roadmap/issues/30 whilst you're trawling through the code ? ;)
[10:35:24] <nickstenn> rossjones: https://github.com/ckan/ckan/issues/1785
[10:35:52] <nickstenn> rossjones: erm
[10:36:03] <rossjones> gowon gowon
[10:36:08] <nickstenn> not *right* this moment, :)
[10:47:53] <seanh> Ok, so flash messages are broken in CKAN
[10:48:05] <seanh> As in, none of the flash messages are displaying, ever
[10:49:22] <seanh> Also, if my IAuthenticator plugin tries to show a flash message from its identify() method it ends up showing the same message three times, because CKAN calls each plugins' identify() three times per request instead of once!
[10:51:45] <seanh> I think nickstenn and I are having the same typical CKAN experience: You try to do one thing (my authenticator plugin needs to flash an error message if authentication fails) and you end up having to fix one thing after another: displaying flash messages are broken in CKAN, fixed, ok, the authenticator plugin interface is broken in CKAN, fixed, ah there are no tests for this.. Oh and no docs either...
[10:54:36] <wardi> tell me about it.. i've been yak shaving for months
[10:55:17] <wardi> at least we end up improving things on the way (ideally)
[10:56:19] <nickstenn> christ, ok -- so I've just worked out that I actually can't have --arguments to a paster command
[10:56:32] <nickstenn> because paster eats all the --options for itself
[11:05:51] <seanh> Wow, looks like aliceh75 goe there before me: https://github.com/ckan/ckan/commit/f3558a8f1c3659bf8c4f4c8b5062343a9e55d533
[11:26:34] <davidmiller> rossjones: I'm glad you raised that on 1 Apr.
[11:27:24] <rossjones> davidmiller nobody noticed.
[11:37:15] <davidmiller> Let's say I have a dataset, and want to transfer ownership - e.g. move it into an organisation w/out deleting & recreating.
[11:37:17] <davidmiller> Can I do this from the web UI?
[11:37:24] <davidmiller> I can't find the button :(
[11:37:47] <rossjones> davidmiller just edit the dataset, there should be a drop down with the orgs you have access to.
[11:48:30] <davidmiller> rossjones: only if I'm a sysadmin
[11:48:45] <davidmiller> rossjones: (Unless I'm missing something)
[11:51:00] <rossjones> If you go to the organization, and edit that, click on members tab, you can add users with a specific role to the organisation.
[11:51:16] <rossjones> davidmiller if you make them admin they can admin the org, if you make them editor they can add datasets.
[11:57:07] <davidmiller> rossjones: but only if they're a sysadmin or it hasn't been published?
[11:57:19] <davidmiller> https://github.com/ckan/ckan/blob/master/ckan/templates/package/snippets/package_basic_fields.html#L59
[11:57:49] <rossjones> ummm.
[11:58:23] <wardi> nickstenn: hmm. i've used those with pastet
[11:59:09] <nickstenn> wardi: you can add_options to the root command, but if you want (or have) subcommands, it gets tricky
[11:59:16] <wardi> ckanapi's cli loops back through paster when run locally and it has a bunch of those
[11:59:49] <wardi> oh, i don't use that argument parser. docopt is way better
[12:00:13] <rossjones> davidmiller that seems rather, erm, strange
[12:01:54] <nickstenn> wardi: well I'm trying to use argparse, but the problem is that if you have, for example
[12:01:55] <wardi> seems to prevent changes at the template.. i wonder why
[12:02:10] <rossjones> davidmiller I'd check h.organizations_available to see if it is just confused logic on L59
[12:02:16] <nickstenn> paster datastore -c dev.ini set-permissions -x
[12:02:25] <nickstenn> then "-x" gets eaten by the top-level command
[12:05:11] <wardi> does argparse even support subcommands?
[12:05:50] <nickstenn> yes
[12:05:56] <nickstenn> rather nicely, actually
[12:14:17] <wardi> so set-permissions is a sub-sub-command?
[12:59:13] <seanh> This is weird, I'm mocking the user_create action, and the mock object says it was called with one argument data_dict only, which is nonsense
[13:02:00] <seanh> If I add a foo(*args, **kwargs) function and set that as the side_effect of the mock user_create object, it does indeed get called with data_dict only
[13:02:28] <seanh> Ah, it's cause I mocked get_action as well and messed that up
[13:02:31] <seanh> Tricky
[13:15:20] <rparra> does anyone know which version of recline is used in CKAN? Particularly, has this issue fix been propagated to CKAN 2.2? https://github.com/okfn/recline/issues/380
[13:15:49] <rparra> I think I'm having the same problem as the OP
[13:54:48] <nickstenn> wardi: not really
[13:54:48] <nickstenn> there's "paster datastore", which is a CkanCommand
[13:54:48] <nickstenn> and "paster datastore set-permissions" which is a subcommand
[13:54:48] <nickstenn> just like "paster sysadmin add"
[13:55:48] <nickstenn> but the absurd thing is that it's essentially impossible to add --options for a specific subcommand, because the default option parser in CkanCommand parses all the way to the end of the line
[13:55:48] <nickstenn> and barfs if it finds options it doesn't recognise
[13:57:48] <nickstenn> which is I presume why almost all commands are forced to take an explicit ordering of options
[13:57:48] <nickstenn> e.g. "paster db send-rdf TALIS_STORE USERNAME PASSWORD"
[14:06:48] <nigelb> what happens if you don't subclass form CkanCommand?
[14:06:48] <nigelb> like use paster's base command clas
[14:16:48] <nickstenn> nigelb: there's far too much magic going on in CkanCommand for that to work, unfortunately
[14:18:48] <nigelb> aw hell.
[14:19:48] <rossjones> nickstenn Think everyone knows cli.py needs a re-write.
[14:20:48] <rossjones> Just nobody wants to do it :)
[14:23:48] <nigelb> wardi: wasn't there more places like the group_show which was doing a db query instead of solr query?
[14:23:48] <nigelb> i.e. calling all the packages in a group/organization
[15:13:48] <wardi> nigelb: probably. resource_search is I believe

2014-06-19
[19:06:53] <seanh> Ok, so there's pylons.session and ckan.common.session, the same object but two names, so you need to mock it twice
[19:07:10] <seanh> But then there are loads of modules in CKAN that do from * import sessiom
[19:07:39] <seanh> If you do that in helpers.py for example, now ckan.lib.helpers.session needs to be mocked as well, you've given it a new name
[19:07:57] <seanh> So if you want to mock the Pylons session for a CKAN request, you're gonna need several mocks
[19:08:48] <seanh> And if you want those mock objects to have side effects you're gonna have to add the same side effects to all of them (and then inspecting the mock later is broken)
[19:09:06] <seanh> There must be some way to mock several names with one mock object
[19:09:22] <seanh> Anyway, CKAN strikes again
[23:33:17] <SkramX> anyone used tobes' ckanext-odata extension?
[23:46:17] <SkramX> ah - reading source clearly still much a WIP
[23:54:17] <SkramX> ckan data in Tableau!!!

[12:57:15] <rgrp> e.g. https://github.com/orchardup/docker-postgresql
[12:58:15] <rossjones> sure. but you'll need to document how to get all the docker stuff working.
[12:58:15] <rossjones> or rather connected up.
[13:00:15] <rossjones> rgrp although I'd note that it is in docker-postgreql and not in https://github.com/postgres/postgres ;)
[13:00:15] <rgrp> but in a first instance could you not leave that to devs - e.g. some people may use postgres ex
[13:00:15] <rgrp> but in a first instance could you not leave that to devs - e.g. some people may use postgres docker x
[13:00:15] <rgrp> rossjones: *exactly* -
[13:01:15] <rossjones> Although I like the idea of docker, I think the pain is constant - it just moves around a lot :)
[13:02:15] <rossjones> In that there'll be a lot less python setup'ing but more docker run'ning
[13:02:15] <rgrp> a good epitaph for humanity ;-)
[13:02:15] <rgrp> pretty aphoristic ;-) "I think the pain is constant - it just moves around a lot :)"
[13:03:15] <rossjones> julian todd's.
[13:03:15] <rgrp> i can imagine ;-)
[13:03:15] <rossjones> The first thing we ever agreed on :)
[13:04:15] <rgrp> anyway overall point - let not the best be the enemy of the good - i'm sure it could be *even* better but we could see what this is like
[13:04:15] <rgrp> and get the PR merged and have further improvements later :-)
[13:04:15] <rossjones> You know, maybe I should even look at the PR :)
[13:05:15] <rossjones> #1755 ? travis failed.
[13:07:15] <rgrp> maybe pg 8.4 issues?
[13:09:15] <rossjones> Probably.
[13:10:15] <rossjones> Although complains about connecting to Solr, so perhaps a travis issue.
[13:10:15] <wardi> rossjones: that often goes away when the test is restarted :-/
[13:11:15] <seanh> nickstenn: It's not that we're providing support for master, but we require things to be documented, tested, reviewed before merge into master (not before a release) because amercader is the only release manager and he has very little time, and we struggle to get a couple of releases out each year
[13:12:15] <seanh> Adding more pressure onto the release process, by merging stuff into master that might have problems, is not good I think
[13:12:15] <seanh> Though if something like Docker can be clearly marked as "alpha" that might be a get-out
[13:56:15] <rgrp> seanh: let's mark it as alpha - that sounds a great idea
[13:57:15] <seanh> What exactly is holding it up at this point, that requires it to be alpha though? If it's something that can be fixed quickly we may as well fix it now
[13:58:15] <seanh> It should probably be marked as experimental in any case
[14:37:16] <nickstenn> god almighty datapusher is a hack on a stick
[14:40:16] <nickstenn> recommended mechanism of installation -- direct from a git repository in the "ckan" org, with a dependency on a git repository in the "okfn" org
[14:41:16] <nickstenn> configured with a python file that you're supposed to dump in the CWD of the running wsgi app
[14:41:16] <nickstenn> (or alternatively, through and environment variable called "JOB_CONFIG" ... not "DATAPUSHER_CONFIG", because that would be too obvious)
[14:42:16] <nickstenn> s/and/an/
[14:59:16] <seanh> What okfn repo does it depend on?
[15:02:16] <seanh> Ah, ckan-service-provider? That's out of date, the repo has actually been moved into the ckan org
[15:44:16] <ntoll__> how do you guys backup solr..?
[15:44:16] <ntoll__> davidmiller, ^^^ see..?
[15:45:16] <ntoll__> I mean... this afternoon I've been reading lots of docs and have ended up with something like this:
[15:45:16] <ntoll__> curl http://localhost:8983/solr/replication?command=backup&location=/home/ubuntu/backup/solr
[15:45:16] <ntoll__> which doesn't appear to do anything, despite there being an update to the index etc etc etc
[15:46:16] <joet> ntoll__, i wouldn't bother
[15:46:16] <joet> i'd just recreate the search index from the database?
[15:46:16] <ntoll__> Joel_re, that's what I think
[15:46:16] <ntoll__> i.e. just reindex
[15:46:16] <ntoll__> snap
[15:47:16] <ntoll__> joet, cool... that's a good enough confirmation for me
[15:47:16] <ntoll__> joet, so I guess that means configuring the DIH
[15:47:16] <davidmiller> ntoll__: I told you #ckan would solve all your problems ;)
[15:48:16] <ntoll__> so, anyone want to pay off my mortgage early..? cc/ davidmiller
[15:48:16] <ntoll__> ;-)
[15:49:16] <ntoll__> this: curl http://localhost:8983/solr/dataimport?command=full-import
[15:49:16] <ntoll__> returns a 404
[15:52:16] <joet> ntoll__, just run a 'paster search-index rebuild'
[15:52:16] <ntoll__> joet, cool
[15:52:16] <joet> see http://docs.ckan.org/en/latest/maintaining/paster.html
[15:53:16] <joet> http://docs.ckan.org/en/latest/maintaining/paster.html#search-index-rebuild-search-index
[15:53:16] <rossjones> ntoll__ don't worry, solr will eat all your ram and swap before it loses any data.
[15:54:16] <ntoll__> rossjones, right... but we need to say we have it covered ;-)
[15:54:16] <davidmiller> ntoll__: See also http://docs.ckan.org/en/latest/maintaining/paster.html#pay-off-mortgage
[15:54:16] <ntoll__> davidmiller, hah
[15:55:16] <rossjones> ntoll__ got the datastore and datapusher set up yet?
[15:55:16] <ntoll__> rossjones, yup
[15:55:16] <ntoll__> rossjones, we're just doing various devops-y bits and bobs
[15:56:16] <ntoll__> so we (hopefully) never have to think about this sort of thing again... "it should just work" (tm)
[15:56:16] <rossjones> bit early to be drinking, isn't it?
[15:56:16] <amln> pubs are open ;)
[15:56:16] <amln> oh, which mad person gave me ops?
[15:56:16] <rossjones> amln tempting ...

[10:52:14] <nigelb> nickstenn: what does setting up logging on botbot.me involve?
[10:52:14] <nigelb> /invite the bot?
[10:53:14] <nickstenn> nigelb: send a nice email to beep@botbot.me
[10:53:14] <nigelb> aha
[10:53:14] <nigelb> I filled up the form a while back
[10:53:14] <nigelb> is that slower than the email?
[10:54:14] <nigelb> wait, nvm.
[10:54:14] <nigelb> I must be imagining things.
[10:57:14] <amln> is there a link to the hangout?
[10:59:14] <wardi> https://plus.google.com/hangouts/_/event/cb1vmkss426lkqicj94a3amvd1c?authuser=0&hl=en-GB
[11:00:14] <wardi> http://pad.okfn.org/p/ckan-meeting
[11:05:14] <amln> cheers ;)
[11:33:15] <joet> i forgot amercader you mentioned earlier you wanted tot discuss 2.3?
[11:33:15] <joet> ^ nigelb
[11:36:15] <amercader> it was 2.2.1
[11:37:15] <joet> general release stuff anyway, I guess we can hold it over irc now or leave it till tuesday? I can add a note to the pad now
[11:38:15] <amercader> we talked with nigelb about splitting the work, but if someone wants to help here's a list of stuff that needs to be backported. By helping I mean reviewing and writing a comment "this looks good to be backported"
[11:38:15] <amercader> or "this might cause issues"
[11:38:15] <amercader> https://github.com/ckan/ckan/issues?direction=desc&labels=Backport+pending%2CBackport+2.2.1&page=2&sort=created&state=closed
[11:38:15] <joet> ok I will add that to the pad to remind everyone next tiem anyway
[11:39:15] <amercader> cool
[11:41:15] <rgrp> is docker going in :-) - love to see that ;-)
[11:41:15] <nigelb> everyone would love to.
[11:42:15] <nigelb> amercader: what's a clean way to get the ext_ query parameters in a helper?
[11:42:15] <nigelb> short of parsing the URL, that is.
[11:43:15] <amercader> nigelb: I don't think we are passing the query params to the templates
[11:43:15] <amercader> you can use request.params
[11:43:15] <joet> rgrp, nigelb has been assigned for review it, but I think more people will probably be looking over it anyway as many of us will probably end up using it when developing anyway
[11:44:15] <rgrp> any sense of eta?
[11:44:15] <nigelb> nope
[11:44:15] <nigelb> not in the next 2 weeks for sure if that helps.
[11:57:15] <nigelb> amercader: calling request inside the helper doesn't work. Trying other things.
[12:08:15] <amercader> nigelb: is this on th rendered search page? (ie /dataset?ext_xx=yyy)
[12:09:15] <nigelb> amercader: yes
[12:09:15] <amercader> if so pylons.request.params I'd expect have these values
[12:09:15] <nigelb> will look.
[12:09:15] <nigelb> it does
[12:09:15] <nigelb> but not from helpers
[12:09:15] <nigelb> weird.
[12:09:15] <nigelb> let me see if I'm doing something wrong.
[12:10:15] <amercader> might be some voodoo ckan override thing :)
[12:11:15] <nigelb> Heh.
[12:24:15] <wardi> rgrp: for development and simple installs docker image that has solr and postgres inside would still be my preference
[12:24:15] <wardi> nickstenn: ^
[12:24:15] <rgrp> wardi: maybe but right now you have a pull request waiting to go in ...
[12:24:15] <rgrp> afaict it doesn't make anything worse and it could make things better and be improved going forward ...
[12:24:15] <rgrp> you can't let the best be the enemy of the good ;-)
[12:25:15] <wardi> rgrp: as it stands it adds a third option for when we're supporting users "are you using package? source install? docker?"
[12:25:15] <wardi> and if docker the way it stands then we get into network configuration and firewall issues the
[12:27:15] <rgrp> wardi: right but all of that *could* come later - this is useful to get in surely and if imperfect it could be improved later as people use it
[12:27:15] <wardi> I don't want to do docker, firewall and network support on ckan-dev
[12:27:15] <rgrp> wardi: right but you also will end up not getting patches ;-)
[12:28:15] <nickstenn> well I don't particularly want to have to fight for weeks and weeks to get something that poses no risk to ckan's stability accepted
[12:28:15] <nickstenn> also, if you're providing support for the master branch you're already fucked
[12:29:15] <wardi> nickstenn: I think with reliable instructions for postgres+solr opening ports and listening on the right interfaces added to the docker install page it's good to go
[12:30:15] <wardi> that's the place I got stuck
[12:31:15] <wardi> then afterwards, as discussed we provide solr and postgres docker images that "just work" with the ckan one
[12:31:15] <rgrp> wardi: but most people can surely figure that out and doesn't vary across machines? i mean i might deploy this on mac or on digital ocean or even use a remote db?
[12:32:15] <rgrp> that said i've not walked through this in detail
[12:32:15] <wardi> rgrp: firewall and networking is hugely different from one os to another
[12:32:15] <nigelb> not sure how you can do lxc on a mac...
[12:33:15] <rossjones> nigelb boot2docker
[12:33:15] <wardi> and if we only support one os as the host.. where's the benefit?
[12:33:15] <rgrp> nigelb: https://docs.docker.com/installation/mac/
[12:34:15] <rossjones> perhaps is lack of dockerfile in master is blocking ckanexpress it should be put somewhere else until it's ready?
[12:34:15] <rossjones> where ready == documented + complete in more than one setup
[12:34:15] <wardi> so, my argument is that "let's put ckan+solr+postgres in the same instance" is the "good" and the direction nickstenn is going is the "best"
[12:34:15] <nigelb> anyway, right now, it's a matter of us having time to review the thing.
[12:35:15] <wardi> s/instance/image
[12:35:15] <nigelb> rossjones: sweet.
[12:37:15] <nigelb> I agree with rgrp that having something good for "right now" is better than "best".
[12:38:15] <wardi> me too
[12:39:15] <wardi> what nickstenn has now is good but might need lots of docs to be usable by an average sysadmin
[12:40:15] <nigelb> My point and I think what rgrp and nickstenn are saying is this
[12:40:15] <nigelb> we have it, we don't have to announce it yet.
[12:41:15] <nigelb> it can still be alpha support.
[12:41:15] <nigelb> i.e. it's *not* ready for public use and we can't support it very well.
[12:41:15] <wardi> right. as nickstenn said, we're not officially supporting master anyway
[12:41:15] <nigelb> And we'll prioritize cleaning up the docs by 2.3
[12:42:15] <nigelb> I can live with that. That's how we're doing our development anyway.
[12:42:15] <wardi> nigelb: ok, you think it can go in even if the docs aren't finished
[12:42:15] <nigelb> wardi: with zero support from us.
[12:44:15] <wardi> nigelb: I would like at least one line for "you make postgres and solr listen on the docker interface on ubuntu by editing these files .."
[12:44:15] <nigelb> wardi: I agree.
[12:44:15] <nigelb> I'd probably add it myself.
[12:44:15] <wardi> I didn't find the place for solr yet, or I would have too
[12:44:15] <rossjones> :(
[12:45:15] <wardi> I guess it's a jetty thing, buried in some xml file no doubt
[12:46:15] <nigelb> (I can see how frustrating it is for nick to have this pull request kept open)
[12:48:15] <nickstenn> sorry i disappeared
[12:49:15] <nickstenn> wardi: i think my omission here is related to the fact that I just don't think we can support postgres and solr
[12:49:15] <nigelb> there's also this thing about what it's for.
[12:49:15] <nickstenn> we can make deployment even easier by providing preconfigured docker images for postgres and solr, for sure
[12:49:15] <nigelb> I see it as a production thing in my head.
[12:49:15] <nickstenn> but that's a nice-to-have, imo
[12:49:15] <nigelb> Not as a development thing.
[12:52:15] <nickstenn> rossjones: as for ckan express, I'm already working on that in a separate repo
[12:53:15] <rossjones> nickstenn so why the rush to get it into master? I understand the speed of review thing - but pretty much *everyone* on core is part-time on it, no?
[12:53:15] <rossjones> yeah i saw the commits going into ckanexpress :)
[12:54:15] <rgrp> rossjones: for me this is about https://github.com/ckan/ideas-and-roadmap/issues/25 and https://github.com/ckan/ideas-and-roadmap/issues/23
[12:54:15] <nickstenn> rossjones: i don't think a projected time to merge of 2 weeks from now is what you could reasonably call "a rush"
[12:55:15] <rossjones> not if that's acceptable.
[12:55:15] <nickstenn> not when the PR has already been open (if, admittedly, not in a mergeable state) for more than a month
[12:55:15] <rgrp> rossjones: one of the major things people raise is simpler ways to deploy - this may not be perfect but its there :-)
[12:55:15] <rossjones> rgrp yes, I agree it does that well.
[12:56:15] <rgrp> rossjones: right :-)
[12:56:15] <rossjones> presumably someone is still going to have to manually set up postgres and solr?
[12:56:15] <rossjones> in the new quick-install via docker world.
[12:56:15] <rgrp> rossjones: and more importanlty when you ask about a rush the issue tends to be that if PRs sit around they go stale and end up dying ...
[12:56:15] <rossjones> rgrp this is true.
[12:57:15] <nickstenn> rossjones: or run three commands with preconfigured docker images for pg and solr as has been discussed
[12:57:15] <rossjones> same for tickets, except they just end up generating dupes
[12:57:15] <rgrp> rossjones: right :-)
[12:57:15] <seanh> I say just get the PR finished properly and then get it merged, I don't see what all the rushing and pushing on this is for, to be honest. Response to the PR has been overwhelmingly positive and people have only asked for a few relatively small tweaks. Seems not bad at all to me, it's quite a big addition after all.
[12:57:15] <rossjones> nickstenn cool, are those ready too?
[12:57:15] <rgrp> rossjones: 3rd parties have those right ;-)
[12:57:15] <rgrp> i mean we don't need to dockerize postgres!

2014-06-18
[16:57:44] <Guest81677> [travis-ci] wardi/ckan two-stage-dataset-create 47dcd08 http://travis-ci.org/wardi/ckan/builds/27880574 Ian Ward: The build was broken.
[17:44:44] <wardi> ok.. why am I getting a DetachedInstanceError in these other tests now?
[17:45:44] <wardi> I just switched my test to use a separate test app instance for each test
[17:45:44] <wardi> vitorbaptista: ^ thoughts?
[17:45:44] <wardi> should I make the same change to those tests too?
[18:02:44] <wardi> that's not going to be easy

[06:23:25] <nigelb> wah
[06:23:25] <nigelb> why do we allow anonymous access for user_update?
[06:23:25] <nigelb> I spent 30 minutes debugging a testfailure
[06:24:25] <nigelb> ah, password reset
[06:24:25] <nigelb> daaaaaaang
[06:50:25] <travis-ci> [travis-ci] ckan/ckan 1412-generate-apikey 9daaa36 http://travis-ci.org/ckan/ckan/builds/27838389 nigelb: The build was broken.
[06:54:25] <nigelb> AH HELL NO.
[06:56:25] <nigelb> phew, pep8 errors
[09:14:26] <davidmiller> Has anyone built something like http://csvlint.io/ for CKAN as part of the resource upload workflow for publishers?
[09:14:26] <davidmiller> My googling says no :(
[09:31:26] <seanh> Maybe you could write a CKAN plugin that integrates with csvlint.io itself?
[09:35:26] <davidmiller> seanh: Shure, although it's fallen over once this morning, which doesn't exactly fill me with confidence :)
[09:35:26] <davidmiller> Was more a query along the lines of "what existing workflows are there for publisher validation within CKAN that improve on the default"
[09:37:26] <rgrp> davidmiller: imagine you could even do something super simple in pure js here if one were so inclined (validation is relatively straightforward if you only sample, say, first 10k rows) - which would be nough for feedback
[09:38:26] <davidmiller> rgrp: Rite. I was hoping to write No Code though. I hate maintaining code.
[09:38:26] <rgrp> davidmiller: i know there is https://github.com/standard-analytics/jts-validator
[10:20:26] <nigelb> seanh: ran into a weirdness with tests for auth functions.
[10:20:26] <nigelb> the example you have only works for functions with allow_anonymous_access
[10:20:26] <nigelb> For the others, you need to add 'auth_user_obj' to the context.
[10:21:26] <seanh> Huh
[10:22:26] <seanh> Seems like it could be fixed in the helper function that the tests use to call the auth functions?
[10:24:26] <nigelb> should it?
[10:24:26] <nigelb> not having it it is useful for caes where you want to test not-logged in user.
[10:25:26] <nigelb> or perhaps the user should be handled by the helper without messing with the context in the test.
[10:26:26] <seanh> Not sure, I can't remember exactly how the tests work to be honest
[10:26:26] <nigelb> I do, I went through most of it today.
[10:26:26] <nigelb> I'll file a bug :)
[10:26:26] <nigelb> The apikey regeration thing has tests now.
[10:31:26] <seanh> Awesome :)
[11:22:26] <wardi> nigelb: sticking a 'user' in the context works for some auth functions, but not others?
[11:28:26] <nigelb> wardi: https://github.com/ckan/ckan/blob/master/ckan/new_authz.py#L170
[11:28:26] <nigelb> is_authorized needs auth_user_obj to know that the function is authorized.
[11:28:26] <nigelb> This is only for POST requests.
[11:29:26] <nigelb> though, now I'm amused.
[11:29:26] <nigelb> if I set it to just be true, that might work too.
[11:29:26] <nigelb> which is the weirdest thing.
[11:29:26] <wardi> seems sloppy. we should have a single "get the user object" function to call instead of our current mish mash of query-database-directly, use c.user, use context.auth_user_obj (and probably others)
[11:30:26] <nigelb> we abuse the context so much, it's making me feel sick.
[11:31:26] <wardi> nigelb: yeah, setting to True would work in this case. which is also terrible
[11:31:26] <nigelb> I'd love to have consistency.
[11:32:26] <nigelb> ah, auth_user_obj is thanks to our lovely api.
[11:37:26] <nigelb> If you sign in with github, this page provides an accurate summary on whether 2.3 in August is possible http://burndown.io/#ckan/ckan/5
[11:37:26] <nigelb> (spoiler, it's not)
[11:38:26] <nigelb> There are 83 open issues. we need to fix more than 1 issue per day to get there.
[11:38:26] <wardi> august is a hard time to do real work anyway
[11:39:26] <nigelb> wardi: wait, why?
[11:40:26] <nigelb> too pretty outside?
[11:40:26] <wardi> too hot here. need to be on the patio
[11:40:26] <wardi> also, vacation
[11:43:26] <nigelb> ah :)
[11:43:26] <nigelb> On the one hand, I want us to release something
[11:43:26] <nigelb> It may not be perfect
[11:44:26] <nigelb> but I don't want to wait 1 year for the "perfect" release.
[11:44:27] <nigelb> Instead do a "what we have now" release
[11:47:27] <wardi> that probably makes sense
[11:50:27] <nigelb> Lots of small things we can improve, going through the bugs.
[11:50:27] <nigelb> But it also needs to be sored for realisticness.
[11:50:27] <nigelb> I'd say with a few exceptions, big work that isn't started by July 1st can't go into 2.3.
[11:51:27] <nigelb> actually, let me rephrase. No exceptions.
[11:51:27] <nigelb> big work = changing interfaces/api/etc
[11:51:27] <nigelb> we won't have time to review and test everything by then.
[11:51:27] <wardi> so, a july feature freeze
[11:52:27] <nigelb> I'm saying "started". So, things that just need polishing like resource views should probably go in.
[11:52:27] <nigelb> adria and you would be better judges.
[11:52:27] <nigelb> I'll raise it tomorrow.
[11:53:27] <wardi> I think adria would be the best judge. there are still large swaths of ckan that I've never used
[11:54:27] <nigelb> there are large swaths I've used, but I'm scared to look.
[13:47:27] <nickstenn> if anyone's interested I've removed the [WIP] tag from my docker pull request, as there is now documentation: https://github.com/ckan/ckan/pull/1755
[14:29:27] <seanh> nickstenn: One tip about the docker thing though
[14:30:27] <seanh> I recommend decoupling getting docker into CKAN core from getting it ready for ckan express, if you aren't already
[14:30:27] <nickstenn> seanh: absolute
[14:30:27] <nickstenn> *ly
[14:30:27] <seanh> We can deploy ckan express using your docker stuff, even if the stuff hasn't been merged in ckan yet
[14:30:27] <nickstenn> agreed, and I'm certainly not planning on being blocked on review
[14:30:27] <seanh> (It just means we have to be willing to take the pain of updating our express deployment with any changes when it does get merged)
[14:30:27] <seanh> Cool
[14:31:27] <nickstenn> but I have to say I'm concerned more generally about the glacial pace of the review process
[14:31:27] <nickstenn> and in general I think the level of conservatism I see and hear is more likely to alienate potential contributors than ensure the ongoing stability of the CKAN project
[14:31:27] <nickstenn> :)
[14:32:27] <seanh> Sadly code review does tend to be a bottleneck and it is a problem, for example with all the ckan features I did for datapackager, they were done in ckanext-datapackager (and now, they will not be contributed back to ckan) because with the timeline we had getting them into ckan as a non-starter
[14:32:27] <nickstenn> I might make a proposal for some changes to the process on ckan-dev
[14:33:27] <seanh> I think deployment-related stuff hits more of this conservatism than most other changes would
[14:33:27] <seanh> But suggestions are welcome
[14:33:27] <seanh> There are also just very few core devs who each have very little time, I'd say that's the bigger cause of the bottleneck in most cases
[14:33:27] <nickstenn> there's a very real risk that the entire project will stagnate if we're as hostile to random contributors as we are to me :)
[14:34:27] <nickstenn> seanh: absolutely, time is the key thing here
[14:34:27] <nickstenn> but in which case I think we're aggravating the problem my making it revolve around concensus decisions in biweekly meetings
[14:34:27] <nickstenn> it might make more sense to adopt a policy where reviews can happen asynchronously
[14:34:27] <nickstenn> and the requirements for merge are clear: "two LGTM from core committers"
[14:34:27] <nickstenn> say
[14:35:27] <seanh> That sounds like a good idea to me
[14:36:27] <seanh> The reason the review process revolves around dev meetings though, is because it's at the meetings that we assign reviewers to PRs
[14:36:27] <seanh> You don't need consensus of the dev meeting to merge
[14:37:27] <seanh> And you could find a reviewer for a PR outside of the dev meeting and get them to review and merge it on their own (that just never happens - no one has extra time to take on more PRs for review, we each have a backlog)
[14:37:27] <wardi> nickstenn: I started to look at your docker work but got pulled away
[14:37:27] <wardi> I really would like to start using it for testing and development
[14:37:27] <nickstenn> seanh: I can't believe that making the process revolve around in person meetings helps that problem...
[14:38:27] <seanh> I don't think there are many examples of a contributor coming along and submitting a pull request, then being scared off by the dev team. (Please look through open and closed PRs for examples.) But there is a bottleneck and anything we can do to help it is good I think
[14:38:27] <wardi> nickstenn: most prs get assigned to one person and that person merges it, but yours is a little bigger than most prs
[14:38:27] <seanh> nickstenn: So we need a different way of assigning reviewers to PRs? Could help yes
[14:39:27] <nickstenn> wardi: just to be clear, I'm confusing the issue by conflating a) my PR, with b) concerns in my job role about whether our processes are right
[14:39:27] <seanh> But honestly, I get assigned PRs to review at dev meetings and then usually when the next dev meeting rolls around I still haven't managed to review them ... Getting me more time each week to review PRs, or getting more reviewers in, would help more than process tweaks imho (though process tweaks are also welcome)
[14:40:27] * wardi nods
[14:40:27] <nickstenn> right. but at the moment the cruft is just accumulating
[14:41:27] <nickstenn> we have open PRs from nearly 1.5 years ago
[14:41:27] <seanh> We always hover around 50ish open PRs ... which is a lot!
[14:41:27] <seanh> Open ones from 1.5 years ago are probably junk thouh
[14:41:27] <nickstenn> of course they are
[14:42:27] <wardi> nickstenn: also, I think we do go harder on people we know than people we dont (esp. wrt unit tests etc before merging)
[14:42:27] <nickstenn> wardi: ok, that's fair enough
[14:42:27] <nickstenn> i give as good as I get, so I'm not so bothered :)
[14:43:27] <seanh> So no one has had time to go through the open PRs and clean out junk for at least 1.5 years then :)

2014-06-17

[11:01:45] <nigelb> Hello
[11:02:45] <nigelb> wardi, seanh, joet - meeting!
[11:03:45] <nigelb> rossjones ^
[11:03:45] <rossjones> nigelb sorry, not today. will definitely make Thurs
[11:03:45] <nigelb> grrrrrrrr: ^^
[11:03:45] <joet> nigelb, in meeting with glasgow, feel free to randomly assign me things
[11:04:45] <wardi> link?
[11:04:45] <nigelb> hehsec
[11:13:45] <nigelb> https://gist.github.com/nigelbabu/076ad12c13b2071de8e1#file-ckan_nginx-conf-L33
[11:16:45] <grrrrrrrr> I'm pretty busy too :(
[11:17:45] <grrrrrrrr> did build the 14.04 package I'll add feedback as an issue
[11:17:45] <grrrrrrrr> also will be away on thurs
[11:19:45] <wardi> grrrrrrrr: are you familiar with owner_org_validator?
[11:19:45] <wardi> grrrrrrrr: maybe you could respond to #1775?
[11:50:46] <rgrp> hey folks - any progress re the docker PR - i for one would love to see that in ...
[12:06:46] <wardi> rgrp: it was a small meeting today
[12:21:44] * NOTICE: [freenode-info] if you're at a conference and other people are having trouble connecting, please mention it to staff: http://freenode.net/faq.shtml#gettinghelp
[12:34:42] <rparra> Hello all. If I have Apache/CKAN in a server and Postgres databases in another one, in which server do I install the Datapusher?
[12:36:41] <nigelb> rparra: I would recommend on the same server as apache
[12:36:47] <nigelb> that way you would only need one apache server.
[12:37:04] <nigelb> Just make sure the datapusher listens on localhost, not on 0.0.0.0
[12:39:52] <rparra> nigelb thanks, may I ask why the change in the Datapusher listening address? Under what conditions should I use 0.0.0.0 (like the docs do)?
[12:41:08] <nigelb> rparra: actually, you don't need that change. apologies.
[12:41:16] <nigelb> Just follow the docs.
[12:42:49] <rparra> nigelb, no problem.  Thanks a lot for your help. I suspected that Datapusher belonged to the app server, but wanted to check if it worked with remote databases. Again, thank you
[12:43:01] <nigelb> It does not work with remote databases.
[13:05:02] * NOTICE: [freenode-info] channel trolls and no channel staff around to help? please check with freenode support: http://freenode.net/faq.shtml#gettinghelp
[13:55:48] <grrrrrrrr> hi I've had problems in 2.2 getting the file upload to work
[13:55:48] <grrrrrrrr> i've added ckan.storage_path
[13:56:48] <grrrrrrrr> but I can't reproduce on a non 14.04 machine
[13:56:48] <grrrrrrrr> well any non ubuntu really
[13:57:48] <grrrrrrrr> wardi, i added a quick note to #1775
[13:57:48] <wardi> grrrrrrrr: thanks
[13:58:48] <grrrrrrrr> sorry I keep missing meetings
[14:01:48] <nigelb> grrrrrrrr: explain more?
[14:01:48] <nigelb> what's the error?
[14:03:48] <grrrrrrrr> nigelb, basically I can't see the upload button :(
[14:03:48] <nigelb> grrrrrrrr: that's weird. The only condition to see the upload button is ckan.storage_path setting being defined.
[14:03:48] <grrrrrrrr> looking at the templates I should just need the ckan.storage_path
[14:04:48] <grrrrrrrr> this is on a package install of 2.2 on 14.04
[14:04:48] <nigelb> You built your own package?
[14:04:48] <grrrrrrrr> I'll update the packaging git hub
[14:05:48] <grrrrrrrr> yeah was such fun
[14:05:48] <grrrrrrrr> but I need it for this job
[14:06:48] <nigelb> Are you sure you restarted the apache server after changing the setting?
[14:06:48] <grrrrrrrr> there are issues as noted with the apache config
[14:06:48] <grrrrrrrr> also on ubuntu 14.04 solr is sort of prefered on tomcat and that runs on port 8080
[14:06:48] <grrrrrrrr> so ckan clashes
[14:07:48] <grrrrrrrr> but the files need the .conf extension and security changes etc as people have said
[14:07:48] <grrrrrrrr> yeah I did many a restart
[14:07:48] <grrrrrrrr> maybe I misspelled it ;p
[14:09:48] <grrrrrrrr> but you would agree if we have that setting it should show up
[14:09:48] <grrrrrrrr> nothing else should be needed
[14:09:48] <nigelb> yes, I would agree.
[14:14:48] <grrrrrrrr> nigelb, thanks
[14:15:48] <grrrrrrrr> nigelb, https://github.com/ckan/ckan-packaging/issues/3
[14:16:48] <grrrrrrrr> I'll add better info when I get home in a few days
[14:17:48] <nigelb> grrrrrrrr: thank you!
[15:49:48] <rparra> nigelb sorry I've been away. what do you mean it doesn't work with remote databases? I'll rephrase my question, because I really need to be sure of this
[15:50:48] <nigelb> rparra: i.e. it doesn't need a remote database to work
[15:50:48] <nigelb> to be more clear.
[15:50:48] <rparra> I have Apache/CKAN in a server, and CKAN and Datastore postgres databases in another server
[15:51:48] <nigelb> sounds about right.
[15:51:48] <rparra> so if I install datapusher in the same server where Apache is running, will it work with the remote database server?
[15:51:48] <nigelb> the datapusher talks to the ckan database via the ckan api.
[15:51:48] <rparra> ok, I misunderstood and got scared for a moment
[15:51:48] <nigelb> over HTTP
[15:52:48] <nigelb> so, what I was trying to tell you
[15:52:48] <nigelb> is that postgres is not needed for datapusher
[15:52:48] <nigelb> obviously, I didn't do a good job. Forgive me. It's 9:20 pm and I should grab some dinner and get away from the computer :)
[15:52:48] <rparra> great. I understand now.
[15:55:48] <rparra> Understing things by chat is hard :) I really appreciate your help, enjoy your meal!

2014-06-16
[21:43:07] <SkramX> fixed it.. think it had to do with changing ports but not updating the ckan endpoint in the pylons config

[13:13:05] <wardi> if I want to add a user to an org in a test, should I make a factory or just use the action to add my user to my org?
[13:13:05] <wardi> (I'm not testing adding a user to an org)
[13:16:05] <wardi> oh.. I can just pass users to the factories.Organization call
[13:41:05] <travis-ci> [travis-ci] wardi/ckan fix-package-permissions 64fd260 http://travis-ci.org/wardi/ckan/builds/27680100 Ian Ward: The build was broken.
[14:35:06] <grrrrrrrr> what's the state of the ckan2.2 package?
[14:36:06] <grrrrrrrr> it seems broken
[14:36:06] <grrrrrrrr> may just be me though
[14:36:06] <grrrrrrrr> was it ever released?
[14:52:06] <nigelb> grrrrrrrr: broken how?
[14:53:06] <nigelb> There's a datapusher bug that I'd love to fix in the package, but for that I we need to release 2.2.1 because of how we do things.
[14:55:06] <grrrrrrrr> nigelb, I can't install using dpkg -i ...
[14:55:06] <nigelb> Do you have the dependencies installed?
[14:55:06] <grrrrrrrr> python can't do an import from logging
[14:55:06] <nigelb> wait, what.
[14:55:06] <nigelb> that shouldn't happen.
[14:55:06] <grrrrrrrr> yeah
[14:55:06] <grrrrrrrr> I think the virtalenv is broken
[14:55:06] <nigelb> are you trying this on 12.04 amd64?
[14:56:06] <nigelb> It won't work on 14.04 for more reasons than virtualenv being broken.
[14:57:06] <nigelb> I did this a long time ago, but I've been wanting to talk about this at a show and tell http://salaryconverter.nigelb.me/
[14:57:06] <nigelb> (more for the data bit than webdev bit though)
[14:58:06] <grrrrrrrr> ok 14.04 is the problem
[14:58:06] <grrrrrrrr> is this fixable?
[14:58:06] <nigelb> well, the "fix" is to build a package for 14.04
[14:58:06] <nigelb> We can't have one package work for both because the virtualenv has compiled libraries which will only work on 12.04.
[14:59:06] <grrrrrrrr> how easy is it to create a 14.04 package?
[15:00:06] <nigelb> There's a few changes to make to the ansible script for apache changes, and then you can run the script on a 14.04 machine to create a new package.
[15:00:06] <nigelb> Script - https://github.com/ckan/ckan-packaging
[15:00:06] <wardi> if something was deprecated two years ago can I consider it safe to remove?
[15:01:06] <nigelb> something to ask tomororw, I think (personally, I think we should kill it with fire, but that's just me)
[15:03:06] <grrrrrrrr> thanks
[15:03:06] <grrrrrrrr> hmmm i could really do with a 14.04 package
[15:15:06] <grrrrrrrr> wardi, what is it/
[15:16:06] <wardi> grrrrrrrr: https://github.com/ckan/ckan/commit/faa8b296
[15:17:06] <grrrrrrrr> this is for the legacy templates so probably should be removed with them or else you will break tests
[15:17:06] <wardi> grrrrrrrr: ah, thanks. good to know
[15:17:06] <grrrrrrrr> a lot of crap is related to them
[15:18:06] <wardi> I'd also like to stop populating c.form, and render the form from the template that needs it with a snippet
[15:18:06] <grrrrrrrr> yeah that is how it should be done
[15:18:06] <wardi> that hasn't been officially deprecated, but just seems tidier
[15:19:06] <wardi> if someone is using c.form in their templates it will break.. but I don't think people should be using c.form
[15:19:06] <grrrrrrrr> this is the whole we should kill c stuff but it is so embedded
[15:19:06] <wardi> one pr at a time
[15:19:06] <nigelb> One template at a time :)
[15:19:06] <grrrrrrrr> :) and nice small ones too
[15:21:06] <grrrrrrrr> nigelb, how do I bribe you to create a 14.04 package?
[15:22:06] <nigelb> grrrrrrrr: a time machine! If I had time to do it, I'd be doing it :(
[15:24:06] <grrrrrrrr> that script looks like it is tied to okf servers do you know if it works just locally?
[15:25:06] <grrrrrrrr> this is from reading the readme
[15:26:06] <nigelb> The only thing that's tied to okf servers is that there needs to be a /var/www/build
[15:26:06] <nigelb> otherwise, it will work on any machine
[15:26:06] <nigelb> Probably wise to run it on a vm though.
[15:29:06] <grrrrrrrr> yeah well I think i'll have to try this.  Is there any good info on the process?
[15:29:06] <grrrrrrrr> ie where ckan needs to live etc
[15:30:06] <nigelb> the config needs to live in /etc/ckan/default
[15:30:06] <nigelb> and ckan source needs to live in /usr/lib/ckan/default/
[15:30:06] <grrrrrrrr> ah ok the script pulls from git hub
[15:30:06] <nigelb> all that script does is setup ckan, setup apache, nginx, and bundle the whole thing into a package and run a post install script to setup some stuff
[15:31:06] <grrrrrrrr> i'll go set up a vm
[15:31:06] <grrrrrrrr> when you here till?
[15:31:06] <nigelb> another hour at most, 9 pm here.
[15:31:06] <grrrrrrrr> ok thanks I'll see how I get on
[15:42:06] <joet> argh
[15:43:06] <nigelb> what went wrong? :)
[15:44:06] <joet> contexts, bloody contexts
[15:44:06] <nigelb> ah.
[15:44:06] <joet> with a  sprinkling of my stupidity
[15:44:06] <nigelb> That's what I don't like about contexts.
[15:44:06] <nigelb> It feels fragile and easily breakable.
[15:46:06] <joet> i was running organization_create inside a loop, but i had created the context outside of the loop, because i just figured i needed model and session
[15:46:06] <joet> so i ended up just overwriting the same org over and over again, instead of building up a list of them
[15:48:06] * nigelb facepalms
[15:48:06] <wardi> ckanapi deliberately creates new ones each time for this reason
[15:49:06] <wardi> our interface is bad an we should feel bad
[15:52:06] <joet> because it adds group to the context, and if group is in the context,  group_dict_save will take that and assume you meant that was the one to overwrite
[15:53:06] <joet> btw grrrrrrrr you might want to be careful of the stuff mentioned in https://github.com/ckan/ckan/issues/1651
[15:54:06] <joet> some people were mentioning solr-jetty was broken, might be fixed now
[15:54:06] <wardi> joet: I think that was the exact problem someone here was struggling with for some time
[15:57:06] <wardi> let's just stop accepting and storing the group in the context of that call
[15:58:06] <joet> i'll have to see if the other _create actions behave in a similar way
[16:01:06] <wardi> or stop passing a context to the dictize functions..
[16:01:06] <wardi> if they need some parameters let's give them some parameters
[16:06:06] <grrrrrrrr> joet, thanks
[20:18:07] <travis-ci> [travis-ci] ckan/ckan 1251-resource-view 194d6c1 http://travis-ci.org/ckan/ckan/builds/27712619 Vitor Baptista: The build was broken.
[21:24:07] <SkramX> I'm getting "Upload error: Could not connect to DataPusher." in CKAN - what should I do to troubleshoot?

2014-06-15
[16:26:05] * NOTICE: [freenode-info] if you're at a conference and other people are having trouble connecting, please mention it to staff: http://freenode.net/faq.shtml#gettinghelp

